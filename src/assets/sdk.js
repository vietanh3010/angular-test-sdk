var __defProp=Object.defineProperty,__getOwnPropNames=Object.getOwnPropertyNames,__defNormalProp=(e,t,n)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,__commonJS=(e,t)=>function(){return t||(0,e[__getOwnPropNames(e)[0]])((t={exports:{}}).exports,t),t.exports},__publicField=(e,t,n)=>(__defNormalProp(e,"symbol"!=typeof t?t+"":t,n),n),require_sdk=__commonJS({"sdk.js"(exports,module){function _mergeNamespaces(e,t){for(var n=0;n<t.length;n++){const r=t[n];if("string"!=typeof r&&!Array.isArray(r))for(const t in r)if("default"!==t&&!(t in e)){const n=Object.getOwnPropertyDescriptor(r,t);n&&Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:()=>r[t]})}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}function bind(e,t){return function(){return e.apply(t,arguments)}}const{toString:toString$2}=Object.prototype,{getPrototypeOf:getPrototypeOf}=Object,kindOf=(cache=Object.create(null),e=>{const t=toString$2.call(e);return cache[t]||(cache[t]=t.slice(8,-1).toLowerCase())});var cache;const kindOfTest=e=>(e=e.toLowerCase(),t=>kindOf(t)===e),typeOfTest=e=>t=>typeof t===e,{isArray:isArray}=Array,isUndefined=typeOfTest("undefined");function isBuffer(e){return null!==e&&!isUndefined(e)&&null!==e.constructor&&!isUndefined(e.constructor)&&isFunction$3(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const isArrayBuffer=kindOfTest("ArrayBuffer");function isArrayBufferView$1(e){let t;return t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&isArrayBuffer(e.buffer),t}const isString$1=typeOfTest("string"),isFunction$3=typeOfTest("function"),isNumber$2=typeOfTest("number"),isObject$2=e=>null!==e&&"object"==typeof e,isBoolean$1=e=>!0===e||!1===e,isPlainObject=e=>{if("object"!==kindOf(e))return!1;const t=getPrototypeOf(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)},isDate=kindOfTest("Date"),isFile=kindOfTest("File"),isBlob=kindOfTest("Blob"),isFileList=kindOfTest("FileList"),isStream=e=>isObject$2(e)&&isFunction$3(e.pipe),isFormData=e=>{let t;return e&&("function"==typeof FormData&&e instanceof FormData||isFunction$3(e.append)&&("formdata"===(t=kindOf(e))||"object"===t&&isFunction$3(e.toString)&&"[object FormData]"===e.toString()))},isURLSearchParams=kindOfTest("URLSearchParams"),trim=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function forEach(e,t,{allOwnKeys:n=!1}={}){if(null==e)return;let r,a;if("object"!=typeof e&&(e=[e]),isArray(e))for(r=0,a=e.length;r<a;r++)t.call(null,e[r],r,e);else{const a=n?Object.getOwnPropertyNames(e):Object.keys(e),i=a.length;let s;for(r=0;r<i;r++)s=a[r],t.call(null,e[s],s,e)}}function findKey(e,t){t=t.toLowerCase();const n=Object.keys(e);let r,a=n.length;for(;a-- >0;)if(r=n[a],t===r.toLowerCase())return r;return null}const _global="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,isContextDefined=e=>!isUndefined(e)&&e!==_global;function merge$3(){const{caseless:e}=isContextDefined(this)&&this||{},t={},n=(n,r)=>{const a=e&&findKey(t,r)||r;isPlainObject(t[a])&&isPlainObject(n)?t[a]=merge$3(t[a],n):isPlainObject(n)?t[a]=merge$3({},n):isArray(n)?t[a]=n.slice():t[a]=n};for(let r=0,a=arguments.length;r<a;r++)arguments[r]&&forEach(arguments[r],n);return t}const extend=(e,t,n,{allOwnKeys:r}={})=>(forEach(t,((t,r)=>{n&&isFunction$3(t)?e[r]=bind(t,n):e[r]=t}),{allOwnKeys:r}),e),stripBOM=e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits=(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject=(e,t,n,r)=>{let a,i,s;const o={};if(t=t||{},null==e)return t;do{for(a=Object.getOwnPropertyNames(e),i=a.length;i-- >0;)s=a[i],r&&!r(s,e,t)||o[s]||(t[s]=e[s],o[s]=!0);e=!1!==n&&getPrototypeOf(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},endsWith=(e,t,n)=>{e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;const r=e.indexOf(t,n);return-1!==r&&r===n},toArray=e=>{if(!e)return null;if(isArray(e))return e;let t=e.length;if(!isNumber$2(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},isTypedArray$2=(TypedArray="undefined"!=typeof Uint8Array&&getPrototypeOf(Uint8Array),e=>TypedArray&&e instanceof TypedArray);var TypedArray;const forEachEntry=(e,t)=>{const n=(e&&e[Symbol.iterator]).call(e);let r;for(;(r=n.next())&&!r.done;){const n=r.value;t.call(e,n[0],n[1])}},matchAll=(e,t)=>{let n;const r=[];for(;null!==(n=e.exec(t));)r.push(n);return r},isHTMLForm=kindOfTest("HTMLFormElement"),toCamelCase$1=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(e,t,n){return t.toUpperCase()+n})),hasOwnProperty=(({hasOwnProperty:e})=>(t,n)=>e.call(t,n))(Object.prototype),isRegExp=kindOfTest("RegExp"),reduceDescriptors=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={};forEach(n,((n,a)=>{let i;!1!==(i=t(n,a,e))&&(r[a]=i||n)})),Object.defineProperties(e,r)},freezeMethods=e=>{reduceDescriptors(e,((t,n)=>{if(isFunction$3(e)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;const r=e[n];isFunction$3(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))}))},toObjectSet=(e,t)=>{const n={},r=e=>{e.forEach((e=>{n[e]=!0}))};return isArray(e)?r(e):r(String(e).split(t)),n},noop$2=()=>{},toFiniteNumber=(e,t)=>(e=+e,Number.isFinite(e)?e:t),ALPHA="abcdefghijklmnopqrstuvwxyz",DIGIT="0123456789",ALPHABET={DIGIT:DIGIT,ALPHA:ALPHA,ALPHA_DIGIT:ALPHA+ALPHA.toUpperCase()+DIGIT},generateString=(e=16,t=ALPHABET.ALPHA_DIGIT)=>{let n="";const{length:r}=t;for(;e--;)n+=t[Math.random()*r|0];return n};function isSpecCompliantForm(e){return!!(e&&isFunction$3(e.append)&&"FormData"===e[Symbol.toStringTag]&&e[Symbol.iterator])}const toJSONObject=e=>{const t=new Array(10),n=(e,r)=>{if(isObject$2(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[r]=e;const a=isArray(e)?[]:{};return forEach(e,((e,t)=>{const i=n(e,r+1);!isUndefined(i)&&(a[t]=i)})),t[r]=void 0,a}}return e};return n(e,0)},isAsyncFn=kindOfTest("AsyncFunction"),isThenable=e=>e&&(isObject$2(e)||isFunction$3(e))&&isFunction$3(e.then)&&isFunction$3(e.catch),utils$1={isArray:isArray,isArrayBuffer:isArrayBuffer,isBuffer:isBuffer,isFormData:isFormData,isArrayBufferView:isArrayBufferView$1,isString:isString$1,isNumber:isNumber$2,isBoolean:isBoolean$1,isObject:isObject$2,isPlainObject:isPlainObject,isUndefined:isUndefined,isDate:isDate,isFile:isFile,isBlob:isBlob,isRegExp:isRegExp,isFunction:isFunction$3,isStream:isStream,isURLSearchParams:isURLSearchParams,isTypedArray:isTypedArray$2,isFileList:isFileList,forEach:forEach,merge:merge$3,extend:extend,trim:trim,stripBOM:stripBOM,inherits:inherits,toFlatObject:toFlatObject,kindOf:kindOf,kindOfTest:kindOfTest,endsWith:endsWith,toArray:toArray,forEachEntry:forEachEntry,matchAll:matchAll,isHTMLForm:isHTMLForm,hasOwnProperty:hasOwnProperty,hasOwnProp:hasOwnProperty,reduceDescriptors:reduceDescriptors,freezeMethods:freezeMethods,toObjectSet:toObjectSet,toCamelCase:toCamelCase$1,noop:noop$2,toFiniteNumber:toFiniteNumber,findKey:findKey,global:_global,isContextDefined:isContextDefined,ALPHABET:ALPHABET,generateString:generateString,isSpecCompliantForm:isSpecCompliantForm,toJSONObject:toJSONObject,isAsyncFn:isAsyncFn,isThenable:isThenable};function AxiosError(e,t,n,r,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),a&&(this.response=a)}utils$1.inherits(AxiosError,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:utils$1.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const prototype$1=AxiosError.prototype,descriptors={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((e=>{descriptors[e]={value:e}})),Object.defineProperties(AxiosError,descriptors),Object.defineProperty(prototype$1,"isAxiosError",{value:!0}),AxiosError.from=(e,t,n,r,a,i)=>{const s=Object.create(prototype$1);return utils$1.toFlatObject(e,s,(function(e){return e!==Error.prototype}),(e=>"isAxiosError"!==e)),AxiosError.call(s,e.message,t,n,r,a),s.cause=e,s.name=e.name,i&&Object.assign(s,i),s};const httpAdapter=null;function isVisitable(e){return utils$1.isPlainObject(e)||utils$1.isArray(e)}function removeBrackets(e){return utils$1.endsWith(e,"[]")?e.slice(0,-2):e}function renderKey(e,t,n){return e?e.concat(t).map((function(e,t){return e=removeBrackets(e),!n&&t?"["+e+"]":e})).join(n?".":""):t}function isFlatArray(e){return utils$1.isArray(e)&&!e.some(isVisitable)}const predicates=utils$1.toFlatObject(utils$1,{},null,(function(e){return/^is[A-Z]/.test(e)}));function toFormData(e,t,n){if(!utils$1.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const r=(n=utils$1.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(e,t){return!utils$1.isUndefined(t[e])}))).metaTokens,a=n.visitor||u,i=n.dots,s=n.indexes,o=(n.Blob||"undefined"!=typeof Blob&&Blob)&&utils$1.isSpecCompliantForm(t);if(!utils$1.isFunction(a))throw new TypeError("visitor must be a function");function l(e){if(null===e)return"";if(utils$1.isDate(e))return e.toISOString();if(!o&&utils$1.isBlob(e))throw new AxiosError("Blob is not supported. Use a Buffer instead.");return utils$1.isArrayBuffer(e)||utils$1.isTypedArray(e)?o&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function u(e,n,a){let o=e;if(e&&!a&&"object"==typeof e)if(utils$1.endsWith(n,"{}"))n=r?n:n.slice(0,-2),e=JSON.stringify(e);else if(utils$1.isArray(e)&&isFlatArray(e)||(utils$1.isFileList(e)||utils$1.endsWith(n,"[]"))&&(o=utils$1.toArray(e)))return n=removeBrackets(n),o.forEach((function(e,r){!utils$1.isUndefined(e)&&null!==e&&t.append(!0===s?renderKey([n],r,i):null===s?n:n+"[]",l(e))})),!1;return!!isVisitable(e)||(t.append(renderKey(a,n,i),l(e)),!1)}const c=[],h=Object.assign(predicates,{defaultVisitor:u,convertValue:l,isVisitable:isVisitable});if(!utils$1.isObject(e))throw new TypeError("data must be an object");return function e(n,r){if(!utils$1.isUndefined(n)){if(-1!==c.indexOf(n))throw Error("Circular reference detected in "+r.join("."));c.push(n),utils$1.forEach(n,(function(n,i){!0===(!(utils$1.isUndefined(n)||null===n)&&a.call(t,n,utils$1.isString(i)?i.trim():i,r,h))&&e(n,r?r.concat(i):[i])})),c.pop()}}(e),t}function encode$1(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,(function(e){return t[e]}))}function AxiosURLSearchParams(e,t){this._pairs=[],e&&toFormData(e,this,t)}const prototype=AxiosURLSearchParams.prototype;function encode(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function buildURL(e,t,n){if(!t)return e;const r=n&&n.encode||encode,a=n&&n.serialize;let i;if(i=a?a(t,n):utils$1.isURLSearchParams(t)?t.toString():new AxiosURLSearchParams(t,n).toString(r),i){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+i}return e}prototype.append=function(e,t){this._pairs.push([e,t])},prototype.toString=function(e){const t=e?function(t){return e.call(this,t,encode$1)}:encode$1;return this._pairs.map((function(e){return t(e[0])+"="+t(e[1])}),"").join("&")};class InterceptorManager{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){utils$1.forEach(this.handlers,(function(t){null!==t&&e(t)}))}}const InterceptorManager$1=InterceptorManager,transitionalDefaults={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},URLSearchParams$1="undefined"!=typeof URLSearchParams?URLSearchParams:AxiosURLSearchParams,FormData$1="undefined"!=typeof FormData?FormData:null,Blob$1="undefined"!=typeof Blob?Blob:null,isStandardBrowserEnv=(()=>{let e;return("undefined"==typeof navigator||"ReactNative"!==(e=navigator.product)&&"NativeScript"!==e&&"NS"!==e)&&("undefined"!=typeof window&&"undefined"!=typeof document)})(),isStandardBrowserWebWorkerEnv="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,platform={isBrowser:!0,classes:{URLSearchParams:URLSearchParams$1,FormData:FormData$1,Blob:Blob$1},isStandardBrowserEnv:isStandardBrowserEnv,isStandardBrowserWebWorkerEnv:isStandardBrowserWebWorkerEnv,protocols:["http","https","file","blob","url","data"]};function toURLEncodedForm(e,t){return toFormData(e,new platform.classes.URLSearchParams,Object.assign({visitor:function(e,t,n,r){return platform.isNode&&utils$1.isBuffer(e)?(this.append(t,e.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)}},t))}function parsePropPath(e){return utils$1.matchAll(/\w+|\[(\w*)]/g,e).map((e=>"[]"===e[0]?"":e[1]||e[0]))}function arrayToObject(e){const t={},n=Object.keys(e);let r;const a=n.length;let i;for(r=0;r<a;r++)i=n[r],t[i]=e[i];return t}function formDataToJSON(e){function t(e,n,r,a){let i=e[a++];const s=Number.isFinite(+i),o=a>=e.length;if(i=!i&&utils$1.isArray(r)?r.length:i,o)return utils$1.hasOwnProp(r,i)?r[i]=[r[i],n]:r[i]=n,!s;r[i]&&utils$1.isObject(r[i])||(r[i]=[]);return t(e,n,r[i],a)&&utils$1.isArray(r[i])&&(r[i]=arrayToObject(r[i])),!s}if(utils$1.isFormData(e)&&utils$1.isFunction(e.entries)){const n={};return utils$1.forEachEntry(e,((e,r)=>{t(parsePropPath(e),r,n,0)})),n}return null}function stringifySafely(e,t,n){if(utils$1.isString(e))try{return(t||JSON.parse)(e),utils$1.trim(e)}catch(r){if("SyntaxError"!==r.name)throw r}return(n||JSON.stringify)(e)}const defaults$1={transitional:transitionalDefaults,adapter:["xhr","http"],transformRequest:[function(e,t){const n=t.getContentType()||"",r=n.indexOf("application/json")>-1,a=utils$1.isObject(e);a&&utils$1.isHTMLForm(e)&&(e=new FormData(e));if(utils$1.isFormData(e))return r&&r?JSON.stringify(formDataToJSON(e)):e;if(utils$1.isArrayBuffer(e)||utils$1.isBuffer(e)||utils$1.isStream(e)||utils$1.isFile(e)||utils$1.isBlob(e))return e;if(utils$1.isArrayBufferView(e))return e.buffer;if(utils$1.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let i;if(a){if(n.indexOf("application/x-www-form-urlencoded")>-1)return toURLEncodedForm(e,this.formSerializer).toString();if((i=utils$1.isFileList(e))||n.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return toFormData(i?{"files[]":e}:e,t&&new t,this.formSerializer)}}return a||r?(t.setContentType("application/json",!1),stringifySafely(e)):e}],transformResponse:[function(e){const t=this.transitional||defaults$1.transitional,n=t&&t.forcedJSONParsing,r="json"===this.responseType;if(e&&utils$1.isString(e)&&(n&&!this.responseType||r)){const n=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(a){if(n){if("SyntaxError"===a.name)throw AxiosError.from(a,AxiosError.ERR_BAD_RESPONSE,this,null,this.response);throw a}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:platform.classes.FormData,Blob:platform.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};utils$1.forEach(["delete","get","head","post","put","patch"],(e=>{defaults$1.headers[e]={}}));const defaults$2=defaults$1,ignoreDuplicateOf=utils$1.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),parseHeaders$1=e=>{const t={};let n,r,a;return e&&e.split("\n").forEach((function(e){a=e.indexOf(":"),n=e.substring(0,a).trim().toLowerCase(),r=e.substring(a+1).trim(),!n||t[n]&&ignoreDuplicateOf[n]||("set-cookie"===n?t[n]?t[n].push(r):t[n]=[r]:t[n]=t[n]?t[n]+", "+r:r)})),t},$internals=Symbol("internals");function normalizeHeader(e){return e&&String(e).trim().toLowerCase()}function normalizeValue(e){return!1===e||null==e?e:utils$1.isArray(e)?e.map(normalizeValue):String(e)}function parseTokens(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=n.exec(e);)t[r[1]]=r[2];return t}const isValidHeaderName=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function matchHeaderValue(e,t,n,r,a){return utils$1.isFunction(r)?r.call(this,t,n):(a&&(t=n),utils$1.isString(t)?utils$1.isString(r)?-1!==t.indexOf(r):utils$1.isRegExp(r)?r.test(t):void 0:void 0)}function formatHeader(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,((e,t,n)=>t.toUpperCase()+n))}function buildAccessors(e,t){const n=utils$1.toCamelCase(" "+t);["get","set","has"].forEach((r=>{Object.defineProperty(e,r+n,{value:function(e,n,a){return this[r].call(this,t,e,n,a)},configurable:!0})}))}class AxiosHeaders{constructor(e){e&&this.set(e)}set(e,t,n){const r=this;function a(e,t,n){const a=normalizeHeader(t);if(!a)throw new Error("header name must be a non-empty string");const i=utils$1.findKey(r,a);(!i||void 0===r[i]||!0===n||void 0===n&&!1!==r[i])&&(r[i||t]=normalizeValue(e))}const i=(e,t)=>utils$1.forEach(e,((e,n)=>a(e,n,t)));return utils$1.isPlainObject(e)||e instanceof this.constructor?i(e,t):utils$1.isString(e)&&(e=e.trim())&&!isValidHeaderName(e)?i(parseHeaders$1(e),t):null!=e&&a(t,e,n),this}get(e,t){if(e=normalizeHeader(e)){const n=utils$1.findKey(this,e);if(n){const e=this[n];if(!t)return e;if(!0===t)return parseTokens(e);if(utils$1.isFunction(t))return t.call(this,e,n);if(utils$1.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=normalizeHeader(e)){const n=utils$1.findKey(this,e);return!(!n||void 0===this[n]||t&&!matchHeaderValue(this,this[n],n,t))}return!1}delete(e,t){const n=this;let r=!1;function a(e){if(e=normalizeHeader(e)){const a=utils$1.findKey(n,e);!a||t&&!matchHeaderValue(n,n[a],a,t)||(delete n[a],r=!0)}}return utils$1.isArray(e)?e.forEach(a):a(e),r}clear(e){const t=Object.keys(this);let n=t.length,r=!1;for(;n--;){const a=t[n];e&&!matchHeaderValue(this,this[a],a,e,!0)||(delete this[a],r=!0)}return r}normalize(e){const t=this,n={};return utils$1.forEach(this,((r,a)=>{const i=utils$1.findKey(n,a);if(i)return t[i]=normalizeValue(r),void delete t[a];const s=e?formatHeader(a):String(a).trim();s!==a&&delete t[a],t[s]=normalizeValue(r),n[s]=!0})),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return utils$1.forEach(this,((n,r)=>{null!=n&&!1!==n&&(t[r]=e&&utils$1.isArray(n)?n.join(", "):n)})),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((([e,t])=>e+": "+t)).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const n=new this(e);return t.forEach((e=>n.set(e))),n}static accessor(e){const t=(this[$internals]=this[$internals]={accessors:{}}).accessors,n=this.prototype;function r(e){const r=normalizeHeader(e);t[r]||(buildAccessors(n,e),t[r]=!0)}return utils$1.isArray(e)?e.forEach(r):r(e),this}}AxiosHeaders.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),utils$1.reduceDescriptors(AxiosHeaders.prototype,(({value:e},t)=>{let n=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(e){this[n]=e}}})),utils$1.freezeMethods(AxiosHeaders);const AxiosHeaders$1=AxiosHeaders;function transformData(e,t){const n=this||defaults$2,r=t||n,a=AxiosHeaders$1.from(r.headers);let i=r.data;return utils$1.forEach(e,(function(e){i=e.call(n,i,a.normalize(),t?t.status:void 0)})),a.normalize(),i}function isCancel(e){return!(!e||!e.__CANCEL__)}function CanceledError(e,t,n){AxiosError.call(this,null==e?"canceled":e,AxiosError.ERR_CANCELED,t,n),this.name="CanceledError"}function settle(e,t,n){const r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new AxiosError("Request failed with status code "+n.status,[AxiosError.ERR_BAD_REQUEST,AxiosError.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}utils$1.inherits(CanceledError,AxiosError,{__CANCEL__:!0});const cookies=platform.isStandardBrowserEnv?{write:function(e,t,n,r,a,i){const s=[];s.push(e+"="+encodeURIComponent(t)),utils$1.isNumber(n)&&s.push("expires="+new Date(n).toGMTString()),utils$1.isString(r)&&s.push("path="+r),utils$1.isString(a)&&s.push("domain="+a),!0===i&&s.push("secure"),document.cookie=s.join("; ")},read:function(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}};function isAbsoluteURL(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function combineURLs(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}function buildFullPath(e,t){return e&&!isAbsoluteURL(t)?combineURLs(e,t):t}const isURLSameOrigin=platform.isStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a");let n;function r(n){let r=n;return e&&(t.setAttribute("href",r),r=t.href),t.setAttribute("href",r),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:"/"===t.pathname.charAt(0)?t.pathname:"/"+t.pathname}}return n=r(window.location.href),function(e){const t=utils$1.isString(e)?r(e):e;return t.protocol===n.protocol&&t.host===n.host}}():function(){return!0};function parseProtocol(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}function speedometer(e,t){e=e||10;const n=new Array(e),r=new Array(e);let a,i=0,s=0;return t=void 0!==t?t:1e3,function(o){const l=Date.now(),u=r[s];a||(a=l),n[i]=o,r[i]=l;let c=s,h=0;for(;c!==i;)h+=n[c++],c%=e;if(i=(i+1)%e,i===s&&(s=(s+1)%e),l-a<t)return;const d=u&&l-u;return d?Math.round(1e3*h/d):void 0}}function progressEventReducer(e,t){let n=0;const r=speedometer(50,250);return a=>{const i=a.loaded,s=a.lengthComputable?a.total:void 0,o=i-n,l=r(o);n=i;const u={loaded:i,total:s,progress:s?i/s:void 0,bytes:o,rate:l||void 0,estimated:l&&s&&i<=s?(s-i)/l:void 0,event:a};u[t?"download":"upload"]=!0,e(u)}}const isXHRAdapterSupported="undefined"!=typeof XMLHttpRequest,xhrAdapter=isXHRAdapterSupported&&function(e){return new Promise((function(t,n){let r=e.data;const a=AxiosHeaders$1.from(e.headers).normalize(),i=e.responseType;let s,o;function l(){e.cancelToken&&e.cancelToken.unsubscribe(s),e.signal&&e.signal.removeEventListener("abort",s)}utils$1.isFormData(r)&&(platform.isStandardBrowserEnv||platform.isStandardBrowserWebWorkerEnv?a.setContentType(!1):a.getContentType(/^\s*multipart\/form-data/)?utils$1.isString(o=a.getContentType())&&a.setContentType(o.replace(/^\s*(multipart\/form-data);+/,"$1")):a.setContentType("multipart/form-data"));let u=new XMLHttpRequest;if(e.auth){const t=e.auth.username||"",n=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";a.set("Authorization","Basic "+btoa(t+":"+n))}const c=buildFullPath(e.baseURL,e.url);function h(){if(!u)return;const r=AxiosHeaders$1.from("getAllResponseHeaders"in u&&u.getAllResponseHeaders());settle((function(e){t(e),l()}),(function(e){n(e),l()}),{data:i&&"text"!==i&&"json"!==i?u.response:u.responseText,status:u.status,statusText:u.statusText,headers:r,config:e,request:u}),u=null}if(u.open(e.method.toUpperCase(),buildURL(c,e.params,e.paramsSerializer),!0),u.timeout=e.timeout,"onloadend"in u?u.onloadend=h:u.onreadystatechange=function(){u&&4===u.readyState&&(0!==u.status||u.responseURL&&0===u.responseURL.indexOf("file:"))&&setTimeout(h)},u.onabort=function(){u&&(n(new AxiosError("Request aborted",AxiosError.ECONNABORTED,e,u)),u=null)},u.onerror=function(){n(new AxiosError("Network Error",AxiosError.ERR_NETWORK,e,u)),u=null},u.ontimeout=function(){let t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded";const r=e.transitional||transitionalDefaults;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),n(new AxiosError(t,r.clarifyTimeoutError?AxiosError.ETIMEDOUT:AxiosError.ECONNABORTED,e,u)),u=null},platform.isStandardBrowserEnv){const t=isURLSameOrigin(c)&&e.xsrfCookieName&&cookies.read(e.xsrfCookieName);t&&a.set(e.xsrfHeaderName,t)}void 0===r&&a.setContentType(null),"setRequestHeader"in u&&utils$1.forEach(a.toJSON(),(function(e,t){u.setRequestHeader(t,e)})),utils$1.isUndefined(e.withCredentials)||(u.withCredentials=!!e.withCredentials),i&&"json"!==i&&(u.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&u.addEventListener("progress",progressEventReducer(e.onDownloadProgress,!0)),"function"==typeof e.onUploadProgress&&u.upload&&u.upload.addEventListener("progress",progressEventReducer(e.onUploadProgress)),(e.cancelToken||e.signal)&&(s=t=>{u&&(n(!t||t.type?new CanceledError(null,e,u):t),u.abort(),u=null)},e.cancelToken&&e.cancelToken.subscribe(s),e.signal&&(e.signal.aborted?s():e.signal.addEventListener("abort",s)));const d=parseProtocol(c);d&&-1===platform.protocols.indexOf(d)?n(new AxiosError("Unsupported protocol "+d+":",AxiosError.ERR_BAD_REQUEST,e)):u.send(r||null)}))},knownAdapters={http:httpAdapter,xhr:xhrAdapter};utils$1.forEach(knownAdapters,((e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(n){}Object.defineProperty(e,"adapterName",{value:t})}}));const renderReason=e=>`- ${e}`,isResolvedHandle=e=>utils$1.isFunction(e)||null===e||!1===e,adapters={getAdapter:e=>{e=utils$1.isArray(e)?e:[e];const{length:t}=e;let n,r;const a={};for(let i=0;i<t;i++){let t;if(n=e[i],r=n,!isResolvedHandle(n)&&(r=knownAdapters[(t=String(n)).toLowerCase()],void 0===r))throw new AxiosError(`Unknown adapter '${t}'`);if(r)break;a[t||"#"+i]=r}if(!r){const e=Object.entries(a).map((([e,t])=>`adapter ${e} `+(!1===t?"is not supported by the environment":"is not available in the build")));throw new AxiosError("There is no suitable adapter to dispatch the request "+(t?e.length>1?"since :\n"+e.map(renderReason).join("\n"):" "+renderReason(e[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return r},adapters:knownAdapters};function throwIfCancellationRequested(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new CanceledError(null,e)}function dispatchRequest(e){throwIfCancellationRequested(e),e.headers=AxiosHeaders$1.from(e.headers),e.data=transformData.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);return adapters.getAdapter(e.adapter||defaults$2.adapter)(e).then((function(t){return throwIfCancellationRequested(e),t.data=transformData.call(e,e.transformResponse,t),t.headers=AxiosHeaders$1.from(t.headers),t}),(function(t){return isCancel(t)||(throwIfCancellationRequested(e),t&&t.response&&(t.response.data=transformData.call(e,e.transformResponse,t.response),t.response.headers=AxiosHeaders$1.from(t.response.headers))),Promise.reject(t)}))}const headersToObject=e=>e instanceof AxiosHeaders$1?e.toJSON():e;function mergeConfig(e,t){t=t||{};const n={};function r(e,t,n){return utils$1.isPlainObject(e)&&utils$1.isPlainObject(t)?utils$1.merge.call({caseless:n},e,t):utils$1.isPlainObject(t)?utils$1.merge({},t):utils$1.isArray(t)?t.slice():t}function a(e,t,n){return utils$1.isUndefined(t)?utils$1.isUndefined(e)?void 0:r(void 0,e,n):r(e,t,n)}function i(e,t){if(!utils$1.isUndefined(t))return r(void 0,t)}function s(e,t){return utils$1.isUndefined(t)?utils$1.isUndefined(e)?void 0:r(void 0,e):r(void 0,t)}function o(n,a,i){return i in t?r(n,a):i in e?r(void 0,n):void 0}const l={url:i,method:i,data:i,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:o,headers:(e,t)=>a(headersToObject(e),headersToObject(t),!0)};return utils$1.forEach(Object.keys(Object.assign({},e,t)),(function(r){const i=l[r]||a,s=i(e[r],t[r],r);utils$1.isUndefined(s)&&i!==o||(n[r]=s)})),n}const VERSION="1.6.0",validators$1={};["object","boolean","number","function","string","symbol"].forEach(((e,t)=>{validators$1[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));const deprecatedWarnings={};function assertOptions(e,t,n){if("object"!=typeof e)throw new AxiosError("options must be an object",AxiosError.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let a=r.length;for(;a-- >0;){const i=r[a],s=t[i];if(s){const t=e[i],n=void 0===t||s(t,i,e);if(!0!==n)throw new AxiosError("option "+i+" must be "+n,AxiosError.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new AxiosError("Unknown option "+i,AxiosError.ERR_BAD_OPTION)}}validators$1.transitional=function(e,t,n){function r(e,t){return"[Axios v"+VERSION+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return(n,a,i)=>{if(!1===e)throw new AxiosError(r(a," has been removed"+(t?" in "+t:"")),AxiosError.ERR_DEPRECATED);return t&&!deprecatedWarnings[a]&&(deprecatedWarnings[a]=!0,console.warn(r(a," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,a,i)}};const validator={assertOptions:assertOptions,validators:validators$1},validators=validator.validators;class Axios{constructor(e){this.defaults=e,this.interceptors={request:new InterceptorManager$1,response:new InterceptorManager$1}}request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=mergeConfig(this.defaults,t);const{transitional:n,paramsSerializer:r,headers:a}=t;void 0!==n&&validator.assertOptions(n,{silentJSONParsing:validators.transitional(validators.boolean),forcedJSONParsing:validators.transitional(validators.boolean),clarifyTimeoutError:validators.transitional(validators.boolean)},!1),null!=r&&(utils$1.isFunction(r)?t.paramsSerializer={serialize:r}:validator.assertOptions(r,{encode:validators.function,serialize:validators.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let i=a&&utils$1.merge(a.common,a[t.method]);a&&utils$1.forEach(["delete","get","head","post","put","patch","common"],(e=>{delete a[e]})),t.headers=AxiosHeaders$1.concat(i,a);const s=[];let o=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(o=o&&e.synchronous,s.unshift(e.fulfilled,e.rejected))}));const l=[];let u;this.interceptors.response.forEach((function(e){l.push(e.fulfilled,e.rejected)}));let c,h=0;if(!o){const e=[dispatchRequest.bind(this),void 0];for(e.unshift.apply(e,s),e.push.apply(e,l),c=e.length,u=Promise.resolve(t);h<c;)u=u.then(e[h++],e[h++]);return u}c=s.length;let d=t;for(h=0;h<c;){const e=s[h++],t=s[h++];try{d=e(d)}catch(p){t.call(this,p);break}}try{u=dispatchRequest.call(this,d)}catch(p){return Promise.reject(p)}for(h=0,c=l.length;h<c;)u=u.then(l[h++],l[h++]);return u}getUri(e){return buildURL(buildFullPath((e=mergeConfig(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}}utils$1.forEach(["delete","get","head","options"],(function(e){Axios.prototype[e]=function(t,n){return this.request(mergeConfig(n||{},{method:e,url:t,data:(n||{}).data}))}})),utils$1.forEach(["post","put","patch"],(function(e){function t(t){return function(n,r,a){return this.request(mergeConfig(a||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:r}))}}Axios.prototype[e]=t(),Axios.prototype[e+"Form"]=t(!0)}));const Axios$1=Axios;class CancelToken{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise((function(e){t=e}));const n=this;this.promise.then((e=>{if(!n._listeners)return;let t=n._listeners.length;for(;t-- >0;)n._listeners[t](e);n._listeners=null})),this.promise.then=e=>{let t;const r=new Promise((e=>{n.subscribe(e),t=e})).then(e);return r.cancel=function(){n.unsubscribe(t)},r},e((function(e,r,a){n.reason||(n.reason=new CanceledError(e,r,a),t(n.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}static source(){let e;return{token:new CancelToken((function(t){e=t})),cancel:e}}}const CancelToken$1=CancelToken;function spread(e){return function(t){return e.apply(null,t)}}function isAxiosError(e){return utils$1.isObject(e)&&!0===e.isAxiosError}const HttpStatusCode={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(HttpStatusCode).forEach((([e,t])=>{HttpStatusCode[t]=e}));const HttpStatusCode$1=HttpStatusCode;function createInstance(e){const t=new Axios$1(e),n=bind(Axios$1.prototype.request,t);return utils$1.extend(n,Axios$1.prototype,t,{allOwnKeys:!0}),utils$1.extend(n,t,null,{allOwnKeys:!0}),n.create=function(t){return createInstance(mergeConfig(e,t))},n}const axios=createInstance(defaults$2);axios.Axios=Axios$1,axios.CanceledError=CanceledError,axios.CancelToken=CancelToken$1,axios.isCancel=isCancel,axios.VERSION=VERSION,axios.toFormData=toFormData,axios.AxiosError=AxiosError,axios.Cancel=axios.CanceledError,axios.all=function(e){return Promise.all(e)},axios.spread=spread,axios.isAxiosError=isAxiosError,axios.mergeConfig=mergeConfig,axios.AxiosHeaders=AxiosHeaders$1,axios.formToJSON=e=>formDataToJSON(utils$1.isHTMLForm(e)?new FormData(e):e),axios.getAdapter=adapters.getAdapter,axios.HttpStatusCode=HttpStatusCode$1,axios.default=axios;const axios$1=axios;var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function getAugmentedNamespace(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var n=function e(){return this instanceof e?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,r.get?r:{enumerable:!0,get:function(){return e[t]}})})),n}var lodash={exports:{}},module2,exports2;
/**
     * @license
     * Lodash <https://lodash.com/>
     * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
     * Released under MIT license <https://lodash.com/license>
     * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
     * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
     */lodash.exports,module2=lodash,exports2=lodash.exports,function(){var e,t="Expected a function",n="__lodash_hash_undefined__",r="__lodash_placeholder__",a=16,i=32,s=64,o=128,l=256,u=1/0,c=9007199254740991,h=NaN,d=4294967295,p=[["ary",o],["bind",1],["bindKey",2],["curry",8],["curryRight",a],["flip",512],["partial",i],["partialRight",s],["rearg",l]],f="[object Arguments]",m="[object Array]",g="[object Boolean]",y="[object Date]",v="[object Error]",b="[object Function]",x="[object GeneratorFunction]",T="[object Map]",_="[object Number]",w="[object Object]",S="[object Promise]",C="[object RegExp]",E="[object Set]",k="[object String]",I="[object Symbol]",A="[object WeakMap]",N="[object ArrayBuffer]",$="[object DataView]",D="[object Float32Array]",P="[object Float64Array]",R="[object Int8Array]",M="[object Int16Array]",O="[object Int32Array]",F="[object Uint8Array]",L="[object Uint8ClampedArray]",B="[object Uint16Array]",V="[object Uint32Array]",U=/\b__p \+= '';/g,z=/\b(__p \+=) '' \+/g,G=/(__e\(.*?\)|\b__t\)) \+\n'';/g,W=/&(?:amp|lt|gt|quot|#39);/g,H=/[&<>"']/g,j=RegExp(W.source),q=RegExp(H.source),K=/<%-([\s\S]+?)%>/g,X=/<%([\s\S]+?)%>/g,Y=/<%=([\s\S]+?)%>/g,Z=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,J=/^\w*$/,Q=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ee=/[\\^$.*+?()[\]{}|]/g,te=RegExp(ee.source),ne=/^\s+/,re=/\s/,ae=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,ie=/\{\n\/\* \[wrapped with (.+)\] \*/,se=/,? & /,oe=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,le=/[()=,{}\[\]\/\s]/,ue=/\\(\\)?/g,ce=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,he=/\w*$/,de=/^[-+]0x[0-9a-f]+$/i,pe=/^0b[01]+$/i,fe=/^\[object .+?Constructor\]$/,me=/^0o[0-7]+$/i,ge=/^(?:0|[1-9]\d*)$/,ye=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,ve=/($^)/,be=/['\n\r\u2028\u2029\\]/g,xe="\\ud800-\\udfff",Te="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",_e="\\u2700-\\u27bf",we="a-z\\xdf-\\xf6\\xf8-\\xff",Se="A-Z\\xc0-\\xd6\\xd8-\\xde",Ce="\\ufe0e\\ufe0f",Ee="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",ke="['’]",Ie="["+xe+"]",Ae="["+Ee+"]",Ne="["+Te+"]",$e="\\d+",De="["+_e+"]",Pe="["+we+"]",Re="[^"+xe+Ee+$e+_e+we+Se+"]",Me="\\ud83c[\\udffb-\\udfff]",Oe="[^"+xe+"]",Fe="(?:\\ud83c[\\udde6-\\uddff]){2}",Le="[\\ud800-\\udbff][\\udc00-\\udfff]",Be="["+Se+"]",Ve="\\u200d",Ue="(?:"+Pe+"|"+Re+")",ze="(?:"+Be+"|"+Re+")",Ge="(?:['’](?:d|ll|m|re|s|t|ve))?",We="(?:['’](?:D|LL|M|RE|S|T|VE))?",He="(?:"+Ne+"|"+Me+")?",je="["+Ce+"]?",qe=je+He+"(?:"+Ve+"(?:"+[Oe,Fe,Le].join("|")+")"+je+He+")*",Ke="(?:"+[De,Fe,Le].join("|")+")"+qe,Xe="(?:"+[Oe+Ne+"?",Ne,Fe,Le,Ie].join("|")+")",Ye=RegExp(ke,"g"),Ze=RegExp(Ne,"g"),Je=RegExp(Me+"(?="+Me+")|"+Xe+qe,"g"),Qe=RegExp([Be+"?"+Pe+"+"+Ge+"(?="+[Ae,Be,"$"].join("|")+")",ze+"+"+We+"(?="+[Ae,Be+Ue,"$"].join("|")+")",Be+"?"+Ue+"+"+Ge,Be+"+"+We,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",$e,Ke].join("|"),"g"),et=RegExp("["+Ve+xe+Te+Ce+"]"),tt=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,nt=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],rt=-1,at={};at[D]=at[P]=at[R]=at[M]=at[O]=at[F]=at[L]=at[B]=at[V]=!0,at[f]=at[m]=at[N]=at[g]=at[$]=at[y]=at[v]=at[b]=at[T]=at[_]=at[w]=at[C]=at[E]=at[k]=at[A]=!1;var it={};it[f]=it[m]=it[N]=it[$]=it[g]=it[y]=it[D]=it[P]=it[R]=it[M]=it[O]=it[T]=it[_]=it[w]=it[C]=it[E]=it[k]=it[I]=it[F]=it[L]=it[B]=it[V]=!0,it[v]=it[b]=it[A]=!1;var st={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},ot=parseFloat,lt=parseInt,ut="object"==typeof commonjsGlobal&&commonjsGlobal&&commonjsGlobal.Object===Object&&commonjsGlobal,ct="object"==typeof self&&self&&self.Object===Object&&self,ht=ut||ct||Function("return this")(),dt=exports2&&!exports2.nodeType&&exports2,pt=dt&&module2&&!module2.nodeType&&module2,ft=pt&&pt.exports===dt,mt=ft&&ut.process,gt=function(){try{var e=pt&&pt.require&&pt.require("util").types;return e||mt&&mt.binding&&mt.binding("util")}catch(t){}}(),yt=gt&&gt.isArrayBuffer,vt=gt&&gt.isDate,bt=gt&&gt.isMap,xt=gt&&gt.isRegExp,Tt=gt&&gt.isSet,_t=gt&&gt.isTypedArray;function wt(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function St(e,t,n,r){for(var a=-1,i=null==e?0:e.length;++a<i;){var s=e[a];t(r,s,n(s),e)}return r}function Ct(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e}function Et(e,t){for(var n=null==e?0:e.length;n--&&!1!==t(e[n],n,e););return e}function kt(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}function It(e,t){for(var n=-1,r=null==e?0:e.length,a=0,i=[];++n<r;){var s=e[n];t(s,n,e)&&(i[a++]=s)}return i}function At(e,t){return!(null==e||!e.length)&&Bt(e,t,0)>-1}function Nt(e,t,n){for(var r=-1,a=null==e?0:e.length;++r<a;)if(n(t,e[r]))return!0;return!1}function $t(e,t){for(var n=-1,r=null==e?0:e.length,a=Array(r);++n<r;)a[n]=t(e[n],n,e);return a}function Dt(e,t){for(var n=-1,r=t.length,a=e.length;++n<r;)e[a+n]=t[n];return e}function Pt(e,t,n,r){var a=-1,i=null==e?0:e.length;for(r&&i&&(n=e[++a]);++a<i;)n=t(n,e[a],a,e);return n}function Rt(e,t,n,r){var a=null==e?0:e.length;for(r&&a&&(n=e[--a]);a--;)n=t(n,e[a],a,e);return n}function Mt(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}var Ot=Gt("length");function Ft(e,t,n){var r;return n(e,(function(e,n,a){if(t(e,n,a))return r=n,!1})),r}function Lt(e,t,n,r){for(var a=e.length,i=n+(r?1:-1);r?i--:++i<a;)if(t(e[i],i,e))return i;return-1}function Bt(e,t,n){return t==t?function(e,t,n){for(var r=n-1,a=e.length;++r<a;)if(e[r]===t)return r;return-1}(e,t,n):Lt(e,Ut,n)}function Vt(e,t,n,r){for(var a=n-1,i=e.length;++a<i;)if(r(e[a],t))return a;return-1}function Ut(e){return e!=e}function zt(e,t){var n=null==e?0:e.length;return n?jt(e,t)/n:h}function Gt(t){return function(n){return null==n?e:n[t]}}function Wt(t){return function(n){return null==t?e:t[n]}}function Ht(e,t,n,r,a){return a(e,(function(e,a,i){n=r?(r=!1,e):t(n,e,a,i)})),n}function jt(t,n){for(var r,a=-1,i=t.length;++a<i;){var s=n(t[a]);s!==e&&(r=r===e?s:r+s)}return r}function qt(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}function Kt(e){return e?e.slice(0,hn(e)+1).replace(ne,""):e}function Xt(e){return function(t){return e(t)}}function Yt(e,t){return $t(t,(function(t){return e[t]}))}function Zt(e,t){return e.has(t)}function Jt(e,t){for(var n=-1,r=e.length;++n<r&&Bt(t,e[n],0)>-1;);return n}function Qt(e,t){for(var n=e.length;n--&&Bt(t,e[n],0)>-1;);return n}var en=Wt({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"}),tn=Wt({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function nn(e){return"\\"+st[e]}function rn(e){return et.test(e)}function an(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n}function sn(e,t){return function(n){return e(t(n))}}function on(e,t){for(var n=-1,a=e.length,i=0,s=[];++n<a;){var o=e[n];o!==t&&o!==r||(e[n]=r,s[i++]=n)}return s}function ln(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}function un(e){return rn(e)?function(e){for(var t=Je.lastIndex=0;Je.test(e);)++t;return t}(e):Ot(e)}function cn(e){return rn(e)?function(e){return e.match(Je)||[]}(e):function(e){return e.split("")}(e)}function hn(e){for(var t=e.length;t--&&re.test(e.charAt(t)););return t}var dn=Wt({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),pn=function re(xe){var Te,_e=(xe=null==xe?ht:pn.defaults(ht.Object(),xe,pn.pick(ht,nt))).Array,we=xe.Date,Se=xe.Error,Ce=xe.Function,Ee=xe.Math,ke=xe.Object,Ie=xe.RegExp,Ae=xe.String,Ne=xe.TypeError,$e=_e.prototype,De=Ce.prototype,Pe=ke.prototype,Re=xe["__core-js_shared__"],Me=De.toString,Oe=Pe.hasOwnProperty,Fe=0,Le=(Te=/[^.]+$/.exec(Re&&Re.keys&&Re.keys.IE_PROTO||""))?"Symbol(src)_1."+Te:"",Be=Pe.toString,Ve=Me.call(ke),Ue=ht._,ze=Ie("^"+Me.call(Oe).replace(ee,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ge=ft?xe.Buffer:e,We=xe.Symbol,He=xe.Uint8Array,je=Ge?Ge.allocUnsafe:e,qe=sn(ke.getPrototypeOf,ke),Ke=ke.create,Xe=Pe.propertyIsEnumerable,Je=$e.splice,et=We?We.isConcatSpreadable:e,st=We?We.iterator:e,ut=We?We.toStringTag:e,ct=function(){try{var e=hi(ke,"defineProperty");return e({},"",{}),e}catch(t){}}(),dt=xe.clearTimeout!==ht.clearTimeout&&xe.clearTimeout,pt=we&&we.now!==ht.Date.now&&we.now,mt=xe.setTimeout!==ht.setTimeout&&xe.setTimeout,gt=Ee.ceil,Ot=Ee.floor,Wt=ke.getOwnPropertySymbols,fn=Ge?Ge.isBuffer:e,mn=xe.isFinite,gn=$e.join,yn=sn(ke.keys,ke),vn=Ee.max,bn=Ee.min,xn=we.now,Tn=xe.parseInt,_n=Ee.random,wn=$e.reverse,Sn=hi(xe,"DataView"),Cn=hi(xe,"Map"),En=hi(xe,"Promise"),kn=hi(xe,"Set"),In=hi(xe,"WeakMap"),An=hi(ke,"create"),Nn=In&&new In,$n={},Dn=Fi(Sn),Pn=Fi(Cn),Rn=Fi(En),Mn=Fi(kn),On=Fi(In),Fn=We?We.prototype:e,Ln=Fn?Fn.valueOf:e,Bn=Fn?Fn.toString:e;function Vn(e){if(eo(e)&&!Gs(e)&&!(e instanceof Wn)){if(e instanceof Gn)return e;if(Oe.call(e,"__wrapped__"))return Li(e)}return new Gn(e)}var Un=function(){function t(){}return function(n){if(!Qs(n))return{};if(Ke)return Ke(n);t.prototype=n;var r=new t;return t.prototype=e,r}}();function zn(){}function Gn(t,n){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!n,this.__index__=0,this.__values__=e}function Wn(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=d,this.__views__=[]}function Hn(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function jn(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function qn(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Kn(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new qn;++t<n;)this.add(e[t])}function Xn(e){var t=this.__data__=new jn(e);this.size=t.size}function Yn(e,t){var n=Gs(e),r=!n&&zs(e),a=!n&&!r&&qs(e),i=!n&&!r&&!a&&lo(e),s=n||r||a||i,o=s?qt(e.length,Ae):[],l=o.length;for(var u in e)!t&&!Oe.call(e,u)||s&&("length"==u||a&&("offset"==u||"parent"==u)||i&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||vi(u,l))||o.push(u);return o}function Zn(t){var n=t.length;return n?t[Kr(0,n-1)]:e}function Jn(e,t){return Ri(Aa(e),or(t,0,e.length))}function Qn(e){return Ri(Aa(e))}function er(t,n,r){(r!==e&&!Bs(t[n],r)||r===e&&!(n in t))&&ir(t,n,r)}function tr(t,n,r){var a=t[n];Oe.call(t,n)&&Bs(a,r)&&(r!==e||n in t)||ir(t,n,r)}function nr(e,t){for(var n=e.length;n--;)if(Bs(e[n][0],t))return n;return-1}function rr(e,t,n,r){return dr(e,(function(e,a,i){t(r,e,n(e),i)})),r}function ar(e,t){return e&&Na(t,$o(t),e)}function ir(e,t,n){"__proto__"==t&&ct?ct(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function sr(t,n){for(var r=-1,a=n.length,i=_e(a),s=null==t;++r<a;)i[r]=s?e:Eo(t,n[r]);return i}function or(t,n,r){return t==t&&(r!==e&&(t=t<=r?t:r),n!==e&&(t=t>=n?t:n)),t}function lr(t,n,r,a,i,s){var o,l=1&n,u=2&n,c=4&n;if(r&&(o=i?r(t,a,i,s):r(t)),o!==e)return o;if(!Qs(t))return t;var h=Gs(t);if(h){if(o=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&Oe.call(e,"index")&&(n.index=e.index,n.input=e.input),n}(t),!l)return Aa(t,o)}else{var d=fi(t),p=d==b||d==x;if(qs(t))return wa(t,l);if(d==w||d==f||p&&!i){if(o=u||p?{}:gi(t),!l)return u?function(e,t){return Na(e,pi(e),t)}(t,function(e,t){return e&&Na(t,Do(t),e)}(o,t)):function(e,t){return Na(e,di(e),t)}(t,ar(o,t))}else{if(!it[d])return i?t:{};o=function(e,t,n){var r,a=e.constructor;switch(t){case N:return Sa(e);case g:case y:return new a(+e);case $:return function(e,t){var n=t?Sa(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}(e,n);case D:case P:case R:case M:case O:case F:case L:case B:case V:return Ca(e,n);case T:return new a;case _:case k:return new a(e);case C:return function(e){var t=new e.constructor(e.source,he.exec(e));return t.lastIndex=e.lastIndex,t}(e);case E:return new a;case I:return r=e,Ln?ke(Ln.call(r)):{}}}(t,d,l)}}s||(s=new Xn);var m=s.get(t);if(m)return m;s.set(t,o),io(t)?t.forEach((function(e){o.add(lr(e,n,r,e,t,s))})):to(t)&&t.forEach((function(e,a){o.set(a,lr(e,n,r,a,t,s))}));var v=h?e:(c?u?ai:ri:u?Do:$o)(t);return Ct(v||t,(function(e,a){v&&(e=t[a=e]),tr(o,a,lr(e,n,r,a,t,s))})),o}function ur(t,n,r){var a=r.length;if(null==t)return!a;for(t=ke(t);a--;){var i=r[a],s=n[i],o=t[i];if(o===e&&!(i in t)||!s(o))return!1}return!0}function cr(n,r,a){if("function"!=typeof n)throw new Ne(t);return Ni((function(){n.apply(e,a)}),r)}function hr(e,t,n,r){var a=-1,i=At,s=!0,o=e.length,l=[],u=t.length;if(!o)return l;n&&(t=$t(t,Xt(n))),r?(i=Nt,s=!1):t.length>=200&&(i=Zt,s=!1,t=new Kn(t));e:for(;++a<o;){var c=e[a],h=null==n?c:n(c);if(c=r||0!==c?c:0,s&&h==h){for(var d=u;d--;)if(t[d]===h)continue e;l.push(c)}else i(t,h,r)||l.push(c)}return l}Vn.templateSettings={escape:K,evaluate:X,interpolate:Y,variable:"",imports:{_:Vn}},Vn.prototype=zn.prototype,Vn.prototype.constructor=Vn,Gn.prototype=Un(zn.prototype),Gn.prototype.constructor=Gn,Wn.prototype=Un(zn.prototype),Wn.prototype.constructor=Wn,Hn.prototype.clear=function(){this.__data__=An?An(null):{},this.size=0},Hn.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Hn.prototype.get=function(t){var r=this.__data__;if(An){var a=r[t];return a===n?e:a}return Oe.call(r,t)?r[t]:e},Hn.prototype.has=function(t){var n=this.__data__;return An?n[t]!==e:Oe.call(n,t)},Hn.prototype.set=function(t,r){var a=this.__data__;return this.size+=this.has(t)?0:1,a[t]=An&&r===e?n:r,this},jn.prototype.clear=function(){this.__data__=[],this.size=0},jn.prototype.delete=function(e){var t=this.__data__,n=nr(t,e);return!(n<0||(n==t.length-1?t.pop():Je.call(t,n,1),--this.size,0))},jn.prototype.get=function(t){var n=this.__data__,r=nr(n,t);return r<0?e:n[r][1]},jn.prototype.has=function(e){return nr(this.__data__,e)>-1},jn.prototype.set=function(e,t){var n=this.__data__,r=nr(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this},qn.prototype.clear=function(){this.size=0,this.__data__={hash:new Hn,map:new(Cn||jn),string:new Hn}},qn.prototype.delete=function(e){var t=ui(this,e).delete(e);return this.size-=t?1:0,t},qn.prototype.get=function(e){return ui(this,e).get(e)},qn.prototype.has=function(e){return ui(this,e).has(e)},qn.prototype.set=function(e,t){var n=ui(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this},Kn.prototype.add=Kn.prototype.push=function(e){return this.__data__.set(e,n),this},Kn.prototype.has=function(e){return this.__data__.has(e)},Xn.prototype.clear=function(){this.__data__=new jn,this.size=0},Xn.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},Xn.prototype.get=function(e){return this.__data__.get(e)},Xn.prototype.has=function(e){return this.__data__.has(e)},Xn.prototype.set=function(e,t){var n=this.__data__;if(n instanceof jn){var r=n.__data__;if(!Cn||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new qn(r)}return n.set(e,t),this.size=n.size,this};var dr=Pa(xr),pr=Pa(Tr,!0);function fr(e,t){var n=!0;return dr(e,(function(e,r,a){return n=!!t(e,r,a)})),n}function mr(t,n,r){for(var a=-1,i=t.length;++a<i;){var s=t[a],o=n(s);if(null!=o&&(l===e?o==o&&!oo(o):r(o,l)))var l=o,u=s}return u}function gr(e,t){var n=[];return dr(e,(function(e,r,a){t(e,r,a)&&n.push(e)})),n}function yr(e,t,n,r,a){var i=-1,s=e.length;for(n||(n=yi),a||(a=[]);++i<s;){var o=e[i];t>0&&n(o)?t>1?yr(o,t-1,n,r,a):Dt(a,o):r||(a[a.length]=o)}return a}var vr=Ra(),br=Ra(!0);function xr(e,t){return e&&vr(e,t,$o)}function Tr(e,t){return e&&br(e,t,$o)}function _r(e,t){return It(t,(function(t){return Ys(e[t])}))}function wr(t,n){for(var r=0,a=(n=ba(n,t)).length;null!=t&&r<a;)t=t[Oi(n[r++])];return r&&r==a?t:e}function Sr(e,t,n){var r=t(e);return Gs(e)?r:Dt(r,n(e))}function Cr(t){return null==t?t===e?"[object Undefined]":"[object Null]":ut&&ut in ke(t)?function(t){var n=Oe.call(t,ut),r=t[ut];try{t[ut]=e;var a=!0}catch(s){}var i=Be.call(t);return a&&(n?t[ut]=r:delete t[ut]),i}(t):function(e){return Be.call(e)}(t)}function Er(e,t){return e>t}function kr(e,t){return null!=e&&Oe.call(e,t)}function Ir(e,t){return null!=e&&t in ke(e)}function Ar(t,n,r){for(var a=r?Nt:At,i=t[0].length,s=t.length,o=s,l=_e(s),u=1/0,c=[];o--;){var h=t[o];o&&n&&(h=$t(h,Xt(n))),u=bn(h.length,u),l[o]=!r&&(n||i>=120&&h.length>=120)?new Kn(o&&h):e}h=t[0];var d=-1,p=l[0];e:for(;++d<i&&c.length<u;){var f=h[d],m=n?n(f):f;if(f=r||0!==f?f:0,!(p?Zt(p,m):a(c,m,r))){for(o=s;--o;){var g=l[o];if(!(g?Zt(g,m):a(t[o],m,r)))continue e}p&&p.push(m),c.push(f)}}return c}function Nr(t,n,r){var a=null==(t=ki(t,n=ba(n,t)))?t:t[Oi(Xi(n))];return null==a?e:wt(a,t,r)}function $r(e){return eo(e)&&Cr(e)==f}function Dr(t,n,r,a,i){return t===n||(null==t||null==n||!eo(t)&&!eo(n)?t!=t&&n!=n:function(t,n,r,a,i,s){var o=Gs(t),l=Gs(n),u=o?m:fi(t),c=l?m:fi(n),h=(u=u==f?w:u)==w,d=(c=c==f?w:c)==w,p=u==c;if(p&&qs(t)){if(!qs(n))return!1;o=!0,h=!1}if(p&&!h)return s||(s=new Xn),o||lo(t)?ti(t,n,r,a,i,s):function(e,t,n,r,a,i,s){switch(n){case $:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case N:return!(e.byteLength!=t.byteLength||!i(new He(e),new He(t)));case g:case y:case _:return Bs(+e,+t);case v:return e.name==t.name&&e.message==t.message;case C:case k:return e==t+"";case T:var o=an;case E:var l=1&r;if(o||(o=ln),e.size!=t.size&&!l)return!1;var u=s.get(e);if(u)return u==t;r|=2,s.set(e,t);var c=ti(o(e),o(t),r,a,i,s);return s.delete(e),c;case I:if(Ln)return Ln.call(e)==Ln.call(t)}return!1}(t,n,u,r,a,i,s);if(!(1&r)){var b=h&&Oe.call(t,"__wrapped__"),x=d&&Oe.call(n,"__wrapped__");if(b||x){var S=b?t.value():t,A=x?n.value():n;return s||(s=new Xn),i(S,A,r,a,s)}}return!!p&&(s||(s=new Xn),function(t,n,r,a,i,s){var o=1&r,l=ri(t),u=l.length,c=ri(n),h=c.length;if(u!=h&&!o)return!1;for(var d=u;d--;){var p=l[d];if(!(o?p in n:Oe.call(n,p)))return!1}var f=s.get(t),m=s.get(n);if(f&&m)return f==n&&m==t;var g=!0;s.set(t,n),s.set(n,t);for(var y=o;++d<u;){var v=t[p=l[d]],b=n[p];if(a)var x=o?a(b,v,p,n,t,s):a(v,b,p,t,n,s);if(!(x===e?v===b||i(v,b,r,a,s):x)){g=!1;break}y||(y="constructor"==p)}if(g&&!y){var T=t.constructor,_=n.constructor;T==_||!("constructor"in t)||!("constructor"in n)||"function"==typeof T&&T instanceof T&&"function"==typeof _&&_ instanceof _||(g=!1)}return s.delete(t),s.delete(n),g}(t,n,r,a,i,s))}(t,n,r,a,Dr,i))}function Pr(t,n,r,a){var i=r.length,s=i,o=!a;if(null==t)return!s;for(t=ke(t);i--;){var l=r[i];if(o&&l[2]?l[1]!==t[l[0]]:!(l[0]in t))return!1}for(;++i<s;){var u=(l=r[i])[0],c=t[u],h=l[1];if(o&&l[2]){if(c===e&&!(u in t))return!1}else{var d=new Xn;if(a)var p=a(c,h,u,t,n,d);if(!(p===e?Dr(h,c,3,a,d):p))return!1}}return!0}function Rr(e){return!(!Qs(e)||(t=e,Le&&Le in t))&&(Ys(e)?ze:fe).test(Fi(e));var t}function Mr(e){return"function"==typeof e?e:null==e?rl:"object"==typeof e?Gs(e)?Ur(e[0],e[1]):Vr(e):dl(e)}function Or(e){if(!wi(e))return yn(e);var t=[];for(var n in ke(e))Oe.call(e,n)&&"constructor"!=n&&t.push(n);return t}function Fr(e){if(!Qs(e))return function(e){var t=[];if(null!=e)for(var n in ke(e))t.push(n);return t}(e);var t=wi(e),n=[];for(var r in e)("constructor"!=r||!t&&Oe.call(e,r))&&n.push(r);return n}function Lr(e,t){return e<t}function Br(e,t){var n=-1,r=Hs(e)?_e(e.length):[];return dr(e,(function(e,a,i){r[++n]=t(e,a,i)})),r}function Vr(e){var t=ci(e);return 1==t.length&&t[0][2]?Ci(t[0][0],t[0][1]):function(n){return n===e||Pr(n,e,t)}}function Ur(t,n){return xi(t)&&Si(n)?Ci(Oi(t),n):function(r){var a=Eo(r,t);return a===e&&a===n?ko(r,t):Dr(n,a,3)}}function zr(t,n,r,a,i){t!==n&&vr(n,(function(s,o){if(i||(i=new Xn),Qs(s))!function(t,n,r,a,i,s,o){var l=Ii(t,r),u=Ii(n,r),c=o.get(u);if(c)er(t,r,c);else{var h=s?s(l,u,r+"",t,n,o):e,d=h===e;if(d){var p=Gs(u),f=!p&&qs(u),m=!p&&!f&&lo(u);h=u,p||f||m?Gs(l)?h=l:js(l)?h=Aa(l):f?(d=!1,h=wa(u,!0)):m?(d=!1,h=Ca(u,!0)):h=[]:ro(u)||zs(u)?(h=l,zs(l)?h=yo(l):Qs(l)&&!Ys(l)||(h=gi(u))):d=!1}d&&(o.set(u,h),i(h,u,a,s,o),o.delete(u)),er(t,r,h)}}(t,n,o,r,zr,a,i);else{var l=a?a(Ii(t,o),s,o+"",t,n,i):e;l===e&&(l=s),er(t,o,l)}}),Do)}function Gr(t,n){var r=t.length;if(r)return vi(n+=n<0?r:0,r)?t[n]:e}function Wr(e,t,n){t=t.length?$t(t,(function(e){return Gs(e)?function(t){return wr(t,1===e.length?e[0]:e)}:e})):[rl];var r=-1;return t=$t(t,Xt(li())),function(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}(Br(e,(function(e,n,a){return{criteria:$t(t,(function(t){return t(e)})),index:++r,value:e}})),(function(e,t){return function(e,t,n){for(var r=-1,a=e.criteria,i=t.criteria,s=a.length,o=n.length;++r<s;){var l=Ea(a[r],i[r]);if(l)return r>=o?l:l*("desc"==n[r]?-1:1)}return e.index-t.index}(e,t,n)}))}function Hr(e,t,n){for(var r=-1,a=t.length,i={};++r<a;){var s=t[r],o=wr(e,s);n(o,s)&&Qr(i,ba(s,e),o)}return i}function jr(e,t,n,r){var a=r?Vt:Bt,i=-1,s=t.length,o=e;for(e===t&&(t=Aa(t)),n&&(o=$t(e,Xt(n)));++i<s;)for(var l=0,u=t[i],c=n?n(u):u;(l=a(o,c,l,r))>-1;)o!==e&&Je.call(o,l,1),Je.call(e,l,1);return e}function qr(e,t){for(var n=e?t.length:0,r=n-1;n--;){var a=t[n];if(n==r||a!==i){var i=a;vi(a)?Je.call(e,a,1):ha(e,a)}}return e}function Kr(e,t){return e+Ot(_n()*(t-e+1))}function Xr(e,t){var n="";if(!e||t<1||t>c)return n;do{t%2&&(n+=e),(t=Ot(t/2))&&(e+=e)}while(t);return n}function Yr(e,t){return $i(Ei(e,t,rl),e+"")}function Zr(e){return Zn(Vo(e))}function Jr(e,t){var n=Vo(e);return Ri(n,or(t,0,n.length))}function Qr(t,n,r,a){if(!Qs(t))return t;for(var i=-1,s=(n=ba(n,t)).length,o=s-1,l=t;null!=l&&++i<s;){var u=Oi(n[i]),c=r;if("__proto__"===u||"constructor"===u||"prototype"===u)return t;if(i!=o){var h=l[u];(c=a?a(h,u,l):e)===e&&(c=Qs(h)?h:vi(n[i+1])?[]:{})}tr(l,u,c),l=l[u]}return t}var ea=Nn?function(e,t){return Nn.set(e,t),e}:rl,ta=ct?function(e,t){return ct(e,"toString",{configurable:!0,enumerable:!1,value:el(t),writable:!0})}:rl;function na(e){return Ri(Vo(e))}function ra(e,t,n){var r=-1,a=e.length;t<0&&(t=-t>a?0:a+t),(n=n>a?a:n)<0&&(n+=a),a=t>n?0:n-t>>>0,t>>>=0;for(var i=_e(a);++r<a;)i[r]=e[r+t];return i}function aa(e,t){var n;return dr(e,(function(e,r,a){return!(n=t(e,r,a))})),!!n}function ia(e,t,n){var r=0,a=null==e?r:e.length;if("number"==typeof t&&t==t&&a<=2147483647){for(;r<a;){var i=r+a>>>1,s=e[i];null!==s&&!oo(s)&&(n?s<=t:s<t)?r=i+1:a=i}return a}return sa(e,t,rl,n)}function sa(t,n,r,a){var i=0,s=null==t?0:t.length;if(0===s)return 0;for(var o=(n=r(n))!=n,l=null===n,u=oo(n),c=n===e;i<s;){var h=Ot((i+s)/2),d=r(t[h]),p=d!==e,f=null===d,m=d==d,g=oo(d);if(o)var y=a||m;else y=c?m&&(a||p):l?m&&p&&(a||!f):u?m&&p&&!f&&(a||!g):!f&&!g&&(a?d<=n:d<n);y?i=h+1:s=h}return bn(s,4294967294)}function oa(e,t){for(var n=-1,r=e.length,a=0,i=[];++n<r;){var s=e[n],o=t?t(s):s;if(!n||!Bs(o,l)){var l=o;i[a++]=0===s?0:s}}return i}function la(e){return"number"==typeof e?e:oo(e)?h:+e}function ua(e){if("string"==typeof e)return e;if(Gs(e))return $t(e,ua)+"";if(oo(e))return Bn?Bn.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function ca(e,t,n){var r=-1,a=At,i=e.length,s=!0,o=[],l=o;if(n)s=!1,a=Nt;else if(i>=200){var u=t?null:Xa(e);if(u)return ln(u);s=!1,a=Zt,l=new Kn}else l=t?[]:o;e:for(;++r<i;){var c=e[r],h=t?t(c):c;if(c=n||0!==c?c:0,s&&h==h){for(var d=l.length;d--;)if(l[d]===h)continue e;t&&l.push(h),o.push(c)}else a(l,h,n)||(l!==o&&l.push(h),o.push(c))}return o}function ha(e,t){return null==(e=ki(e,t=ba(t,e)))||delete e[Oi(Xi(t))]}function da(e,t,n,r){return Qr(e,t,n(wr(e,t)),r)}function pa(e,t,n,r){for(var a=e.length,i=r?a:-1;(r?i--:++i<a)&&t(e[i],i,e););return n?ra(e,r?0:i,r?i+1:a):ra(e,r?i+1:0,r?a:i)}function fa(e,t){var n=e;return n instanceof Wn&&(n=n.value()),Pt(t,(function(e,t){return t.func.apply(t.thisArg,Dt([e],t.args))}),n)}function ma(e,t,n){var r=e.length;if(r<2)return r?ca(e[0]):[];for(var a=-1,i=_e(r);++a<r;)for(var s=e[a],o=-1;++o<r;)o!=a&&(i[a]=hr(i[a]||s,e[o],t,n));return ca(yr(i,1),t,n)}function ga(t,n,r){for(var a=-1,i=t.length,s=n.length,o={};++a<i;){var l=a<s?n[a]:e;r(o,t[a],l)}return o}function ya(e){return js(e)?e:[]}function va(e){return"function"==typeof e?e:rl}function ba(e,t){return Gs(e)?e:xi(e,t)?[e]:Mi(vo(e))}var xa=Yr;function Ta(t,n,r){var a=t.length;return r=r===e?a:r,!n&&r>=a?t:ra(t,n,r)}var _a=dt||function(e){return ht.clearTimeout(e)};function wa(e,t){if(t)return e.slice();var n=e.length,r=je?je(n):new e.constructor(n);return e.copy(r),r}function Sa(e){var t=new e.constructor(e.byteLength);return new He(t).set(new He(e)),t}function Ca(e,t){var n=t?Sa(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function Ea(t,n){if(t!==n){var r=t!==e,a=null===t,i=t==t,s=oo(t),o=n!==e,l=null===n,u=n==n,c=oo(n);if(!l&&!c&&!s&&t>n||s&&o&&u&&!l&&!c||a&&o&&u||!r&&u||!i)return 1;if(!a&&!s&&!c&&t<n||c&&r&&i&&!a&&!s||l&&r&&i||!o&&i||!u)return-1}return 0}function ka(e,t,n,r){for(var a=-1,i=e.length,s=n.length,o=-1,l=t.length,u=vn(i-s,0),c=_e(l+u),h=!r;++o<l;)c[o]=t[o];for(;++a<s;)(h||a<i)&&(c[n[a]]=e[a]);for(;u--;)c[o++]=e[a++];return c}function Ia(e,t,n,r){for(var a=-1,i=e.length,s=-1,o=n.length,l=-1,u=t.length,c=vn(i-o,0),h=_e(c+u),d=!r;++a<c;)h[a]=e[a];for(var p=a;++l<u;)h[p+l]=t[l];for(;++s<o;)(d||a<i)&&(h[p+n[s]]=e[a++]);return h}function Aa(e,t){var n=-1,r=e.length;for(t||(t=_e(r));++n<r;)t[n]=e[n];return t}function Na(t,n,r,a){var i=!r;r||(r={});for(var s=-1,o=n.length;++s<o;){var l=n[s],u=a?a(r[l],t[l],l,r,t):e;u===e&&(u=t[l]),i?ir(r,l,u):tr(r,l,u)}return r}function $a(e,t){return function(n,r){var a=Gs(n)?St:rr,i=t?t():{};return a(n,e,li(r,2),i)}}function Da(t){return Yr((function(n,r){var a=-1,i=r.length,s=i>1?r[i-1]:e,o=i>2?r[2]:e;for(s=t.length>3&&"function"==typeof s?(i--,s):e,o&&bi(r[0],r[1],o)&&(s=i<3?e:s,i=1),n=ke(n);++a<i;){var l=r[a];l&&t(n,l,a,s)}return n}))}function Pa(e,t){return function(n,r){if(null==n)return n;if(!Hs(n))return e(n,r);for(var a=n.length,i=t?a:-1,s=ke(n);(t?i--:++i<a)&&!1!==r(s[i],i,s););return n}}function Ra(e){return function(t,n,r){for(var a=-1,i=ke(t),s=r(t),o=s.length;o--;){var l=s[e?o:++a];if(!1===n(i[l],l,i))break}return t}}function Ma(t){return function(n){var r=rn(n=vo(n))?cn(n):e,a=r?r[0]:n.charAt(0),i=r?Ta(r,1).join(""):n.slice(1);return a[t]()+i}}function Oa(e){return function(t){return Pt(Zo(Go(t).replace(Ye,"")),e,"")}}function Fa(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var n=Un(e.prototype),r=e.apply(n,t);return Qs(r)?r:n}}function La(t){return function(n,r,a){var i=ke(n);if(!Hs(n)){var s=li(r,3);n=$o(n),r=function(e){return s(i[e],e,i)}}var o=t(n,r,a);return o>-1?i[s?n[o]:o]:e}}function Ba(n){return ni((function(r){var a=r.length,i=a,s=Gn.prototype.thru;for(n&&r.reverse();i--;){var o=r[i];if("function"!=typeof o)throw new Ne(t);if(s&&!l&&"wrapper"==si(o))var l=new Gn([],!0)}for(i=l?i:a;++i<a;){var u=si(o=r[i]),c="wrapper"==u?ii(o):e;l=c&&Ti(c[0])&&424==c[1]&&!c[4].length&&1==c[9]?l[si(c[0])].apply(l,c[3]):1==o.length&&Ti(o)?l[u]():l.thru(o)}return function(){var e=arguments,t=e[0];if(l&&1==e.length&&Gs(t))return l.plant(t).value();for(var n=0,i=a?r[n].apply(this,e):t;++n<a;)i=r[n].call(this,i);return i}}))}function Va(t,n,r,a,i,s,l,u,c,h){var d=n&o,p=1&n,f=2&n,m=24&n,g=512&n,y=f?e:Fa(t);return function o(){for(var v=arguments.length,b=_e(v),x=v;x--;)b[x]=arguments[x];if(m)var T=oi(o),_=function(e,t){for(var n=e.length,r=0;n--;)e[n]===t&&++r;return r}(b,T);if(a&&(b=ka(b,a,i,m)),s&&(b=Ia(b,s,l,m)),v-=_,m&&v<h){var w=on(b,T);return qa(t,n,Va,o.placeholder,r,b,w,u,c,h-v)}var S=p?r:this,C=f?S[t]:t;return v=b.length,u?b=function(t,n){for(var r=t.length,a=bn(n.length,r),i=Aa(t);a--;){var s=n[a];t[a]=vi(s,r)?i[s]:e}return t}(b,u):g&&v>1&&b.reverse(),d&&c<v&&(b.length=c),this&&this!==ht&&this instanceof o&&(C=y||Fa(C)),C.apply(S,b)}}function Ua(e,t){return function(n,r){return function(e,t,n,r){return xr(e,(function(e,a,i){t(r,n(e),a,i)})),r}(n,e,t(r),{})}}function za(t,n){return function(r,a){var i;if(r===e&&a===e)return n;if(r!==e&&(i=r),a!==e){if(i===e)return a;"string"==typeof r||"string"==typeof a?(r=ua(r),a=ua(a)):(r=la(r),a=la(a)),i=t(r,a)}return i}}function Ga(e){return ni((function(t){return t=$t(t,Xt(li())),Yr((function(n){var r=this;return e(t,(function(e){return wt(e,r,n)}))}))}))}function Wa(t,n){var r=(n=n===e?" ":ua(n)).length;if(r<2)return r?Xr(n,t):n;var a=Xr(n,gt(t/un(n)));return rn(n)?Ta(cn(a),0,t).join(""):a.slice(0,t)}function Ha(t){return function(n,r,a){return a&&"number"!=typeof a&&bi(n,r,a)&&(r=a=e),n=po(n),r===e?(r=n,n=0):r=po(r),function(e,t,n,r){for(var a=-1,i=vn(gt((t-e)/(n||1)),0),s=_e(i);i--;)s[r?i:++a]=e,e+=n;return s}(n,r,a=a===e?n<r?1:-1:po(a),t)}}function ja(e){return function(t,n){return"string"==typeof t&&"string"==typeof n||(t=go(t),n=go(n)),e(t,n)}}function qa(t,n,r,a,o,l,u,c,h,d){var p=8&n;n|=p?i:s,4&(n&=~(p?s:i))||(n&=-4);var f=[t,n,o,p?l:e,p?u:e,p?e:l,p?e:u,c,h,d],m=r.apply(e,f);return Ti(t)&&Ai(m,f),m.placeholder=a,Di(m,t,n)}function Ka(e){var t=Ee[e];return function(e,n){if(e=go(e),(n=null==n?0:bn(fo(n),292))&&mn(e)){var r=(vo(e)+"e").split("e");return+((r=(vo(t(r[0]+"e"+(+r[1]+n)))+"e").split("e"))[0]+"e"+(+r[1]-n))}return t(e)}}var Xa=kn&&1/ln(new kn([,-0]))[1]==u?function(e){return new kn(e)}:ll;function Ya(e){return function(t){var n=fi(t);return n==T?an(t):n==E?function(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=[e,e]})),n}(t):function(e,t){return $t(t,(function(t){return[t,e[t]]}))}(t,e(t))}}function Za(n,u,c,h,d,p,f,m){var g=2&u;if(!g&&"function"!=typeof n)throw new Ne(t);var y=h?h.length:0;if(y||(u&=-97,h=d=e),f=f===e?f:vn(fo(f),0),m=m===e?m:fo(m),y-=d?d.length:0,u&s){var v=h,b=d;h=d=e}var x=g?e:ii(n),T=[n,u,c,h,d,v,b,p,f,m];if(x&&function(e,t){var n=e[1],a=t[1],i=n|a,s=i<131,u=a==o&&8==n||a==o&&n==l&&e[7].length<=t[8]||384==a&&t[7].length<=t[8]&&8==n;if(!s&&!u)return e;1&a&&(e[2]=t[2],i|=1&n?0:4);var c=t[3];if(c){var h=e[3];e[3]=h?ka(h,c,t[4]):c,e[4]=h?on(e[3],r):t[4]}(c=t[5])&&(h=e[5],e[5]=h?Ia(h,c,t[6]):c,e[6]=h?on(e[5],r):t[6]),(c=t[7])&&(e[7]=c),a&o&&(e[8]=null==e[8]?t[8]:bn(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=i}(T,x),n=T[0],u=T[1],c=T[2],h=T[3],d=T[4],!(m=T[9]=T[9]===e?g?0:n.length:vn(T[9]-y,0))&&24&u&&(u&=-25),u&&1!=u)_=8==u||u==a?function(t,n,r){var a=Fa(t);return function i(){for(var s=arguments.length,o=_e(s),l=s,u=oi(i);l--;)o[l]=arguments[l];var c=s<3&&o[0]!==u&&o[s-1]!==u?[]:on(o,u);return(s-=c.length)<r?qa(t,n,Va,i.placeholder,e,o,c,e,e,r-s):wt(this&&this!==ht&&this instanceof i?a:t,this,o)}}(n,u,m):u!=i&&33!=u||d.length?Va.apply(e,T):function(e,t,n,r){var a=1&t,i=Fa(e);return function t(){for(var s=-1,o=arguments.length,l=-1,u=r.length,c=_e(u+o),h=this&&this!==ht&&this instanceof t?i:e;++l<u;)c[l]=r[l];for(;o--;)c[l++]=arguments[++s];return wt(h,a?n:this,c)}}(n,u,c,h);else var _=function(e,t,n){var r=1&t,a=Fa(e);return function t(){return(this&&this!==ht&&this instanceof t?a:e).apply(r?n:this,arguments)}}(n,u,c);return Di((x?ea:Ai)(_,T),n,u)}function Ja(t,n,r,a){return t===e||Bs(t,Pe[r])&&!Oe.call(a,r)?n:t}function Qa(t,n,r,a,i,s){return Qs(t)&&Qs(n)&&(s.set(n,t),zr(t,n,e,Qa,s),s.delete(n)),t}function ei(t){return ro(t)?e:t}function ti(t,n,r,a,i,s){var o=1&r,l=t.length,u=n.length;if(l!=u&&!(o&&u>l))return!1;var c=s.get(t),h=s.get(n);if(c&&h)return c==n&&h==t;var d=-1,p=!0,f=2&r?new Kn:e;for(s.set(t,n),s.set(n,t);++d<l;){var m=t[d],g=n[d];if(a)var y=o?a(g,m,d,n,t,s):a(m,g,d,t,n,s);if(y!==e){if(y)continue;p=!1;break}if(f){if(!Mt(n,(function(e,t){if(!Zt(f,t)&&(m===e||i(m,e,r,a,s)))return f.push(t)}))){p=!1;break}}else if(m!==g&&!i(m,g,r,a,s)){p=!1;break}}return s.delete(t),s.delete(n),p}function ni(t){return $i(Ei(t,e,Wi),t+"")}function ri(e){return Sr(e,$o,di)}function ai(e){return Sr(e,Do,pi)}var ii=Nn?function(e){return Nn.get(e)}:ll;function si(e){for(var t=e.name+"",n=$n[t],r=Oe.call($n,t)?n.length:0;r--;){var a=n[r],i=a.func;if(null==i||i==e)return a.name}return t}function oi(e){return(Oe.call(Vn,"placeholder")?Vn:e).placeholder}function li(){var e=Vn.iteratee||al;return e=e===al?Mr:e,arguments.length?e(arguments[0],arguments[1]):e}function ui(e,t){var n,r,a=e.__data__;return("string"==(r=typeof(n=t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?a["string"==typeof t?"string":"hash"]:a.map}function ci(e){for(var t=$o(e),n=t.length;n--;){var r=t[n],a=e[r];t[n]=[r,a,Si(a)]}return t}function hi(t,n){var r=function(t,n){return null==t?e:t[n]}(t,n);return Rr(r)?r:e}var di=Wt?function(e){return null==e?[]:(e=ke(e),It(Wt(e),(function(t){return Xe.call(e,t)})))}:ml,pi=Wt?function(e){for(var t=[];e;)Dt(t,di(e)),e=qe(e);return t}:ml,fi=Cr;function mi(e,t,n){for(var r=-1,a=(t=ba(t,e)).length,i=!1;++r<a;){var s=Oi(t[r]);if(!(i=null!=e&&n(e,s)))break;e=e[s]}return i||++r!=a?i:!!(a=null==e?0:e.length)&&Js(a)&&vi(s,a)&&(Gs(e)||zs(e))}function gi(e){return"function"!=typeof e.constructor||wi(e)?{}:Un(qe(e))}function yi(e){return Gs(e)||zs(e)||!!(et&&e&&e[et])}function vi(e,t){var n=typeof e;return!!(t=null==t?c:t)&&("number"==n||"symbol"!=n&&ge.test(e))&&e>-1&&e%1==0&&e<t}function bi(e,t,n){if(!Qs(n))return!1;var r=typeof t;return!!("number"==r?Hs(n)&&vi(t,n.length):"string"==r&&t in n)&&Bs(n[t],e)}function xi(e,t){if(Gs(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!oo(e))||J.test(e)||!Z.test(e)||null!=t&&e in ke(t)}function Ti(e){var t=si(e),n=Vn[t];if("function"!=typeof n||!(t in Wn.prototype))return!1;if(e===n)return!0;var r=ii(n);return!!r&&e===r[0]}(Sn&&fi(new Sn(new ArrayBuffer(1)))!=$||Cn&&fi(new Cn)!=T||En&&fi(En.resolve())!=S||kn&&fi(new kn)!=E||In&&fi(new In)!=A)&&(fi=function(t){var n=Cr(t),r=n==w?t.constructor:e,a=r?Fi(r):"";if(a)switch(a){case Dn:return $;case Pn:return T;case Rn:return S;case Mn:return E;case On:return A}return n});var _i=Re?Ys:gl;function wi(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Pe)}function Si(e){return e==e&&!Qs(e)}function Ci(t,n){return function(r){return null!=r&&r[t]===n&&(n!==e||t in ke(r))}}function Ei(t,n,r){return n=vn(n===e?t.length-1:n,0),function(){for(var e=arguments,a=-1,i=vn(e.length-n,0),s=_e(i);++a<i;)s[a]=e[n+a];a=-1;for(var o=_e(n+1);++a<n;)o[a]=e[a];return o[n]=r(s),wt(t,this,o)}}function ki(e,t){return t.length<2?e:wr(e,ra(t,0,-1))}function Ii(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}var Ai=Pi(ea),Ni=mt||function(e,t){return ht.setTimeout(e,t)},$i=Pi(ta);function Di(e,t,n){var r=t+"";return $i(e,function(e,t){var n=t.length;if(!n)return e;var r=n-1;return t[r]=(n>1?"& ":"")+t[r],t=t.join(n>2?", ":" "),e.replace(ae,"{\n/* [wrapped with "+t+"] */\n")}(r,function(e,t){return Ct(p,(function(n){var r="_."+n[0];t&n[1]&&!At(e,r)&&e.push(r)})),e.sort()}(function(e){var t=e.match(ie);return t?t[1].split(se):[]}(r),n)))}function Pi(t){var n=0,r=0;return function(){var a=xn(),i=16-(a-r);if(r=a,i>0){if(++n>=800)return arguments[0]}else n=0;return t.apply(e,arguments)}}function Ri(t,n){var r=-1,a=t.length,i=a-1;for(n=n===e?a:n;++r<n;){var s=Kr(r,i),o=t[s];t[s]=t[r],t[r]=o}return t.length=n,t}var Mi=function(e){var t=Ps(e,(function(e){return 500===n.size&&n.clear(),e})),n=t.cache;return t}((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(Q,(function(e,n,r,a){t.push(r?a.replace(ue,"$1"):n||e)})),t}));function Oi(e){if("string"==typeof e||oo(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function Fi(e){if(null!=e){try{return Me.call(e)}catch(t){}try{return e+""}catch(t){}}return""}function Li(e){if(e instanceof Wn)return e.clone();var t=new Gn(e.__wrapped__,e.__chain__);return t.__actions__=Aa(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}var Bi=Yr((function(e,t){return js(e)?hr(e,yr(t,1,js,!0)):[]})),Vi=Yr((function(t,n){var r=Xi(n);return js(r)&&(r=e),js(t)?hr(t,yr(n,1,js,!0),li(r,2)):[]})),Ui=Yr((function(t,n){var r=Xi(n);return js(r)&&(r=e),js(t)?hr(t,yr(n,1,js,!0),e,r):[]}));function zi(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var a=null==n?0:fo(n);return a<0&&(a=vn(r+a,0)),Lt(e,li(t,3),a)}function Gi(t,n,r){var a=null==t?0:t.length;if(!a)return-1;var i=a-1;return r!==e&&(i=fo(r),i=r<0?vn(a+i,0):bn(i,a-1)),Lt(t,li(n,3),i,!0)}function Wi(e){return null!=e&&e.length?yr(e,1):[]}function Hi(t){return t&&t.length?t[0]:e}var ji=Yr((function(e){var t=$t(e,ya);return t.length&&t[0]===e[0]?Ar(t):[]})),qi=Yr((function(t){var n=Xi(t),r=$t(t,ya);return n===Xi(r)?n=e:r.pop(),r.length&&r[0]===t[0]?Ar(r,li(n,2)):[]})),Ki=Yr((function(t){var n=Xi(t),r=$t(t,ya);return(n="function"==typeof n?n:e)&&r.pop(),r.length&&r[0]===t[0]?Ar(r,e,n):[]}));function Xi(t){var n=null==t?0:t.length;return n?t[n-1]:e}var Yi=Yr(Zi);function Zi(e,t){return e&&e.length&&t&&t.length?jr(e,t):e}var Ji=ni((function(e,t){var n=null==e?0:e.length,r=sr(e,t);return qr(e,$t(t,(function(e){return vi(e,n)?+e:e})).sort(Ea)),r}));function Qi(e){return null==e?e:wn.call(e)}var es=Yr((function(e){return ca(yr(e,1,js,!0))})),ts=Yr((function(t){var n=Xi(t);return js(n)&&(n=e),ca(yr(t,1,js,!0),li(n,2))})),ns=Yr((function(t){var n=Xi(t);return n="function"==typeof n?n:e,ca(yr(t,1,js,!0),e,n)}));function rs(e){if(!e||!e.length)return[];var t=0;return e=It(e,(function(e){if(js(e))return t=vn(e.length,t),!0})),qt(t,(function(t){return $t(e,Gt(t))}))}function as(t,n){if(!t||!t.length)return[];var r=rs(t);return null==n?r:$t(r,(function(t){return wt(n,e,t)}))}var is=Yr((function(e,t){return js(e)?hr(e,t):[]})),ss=Yr((function(e){return ma(It(e,js))})),os=Yr((function(t){var n=Xi(t);return js(n)&&(n=e),ma(It(t,js),li(n,2))})),ls=Yr((function(t){var n=Xi(t);return n="function"==typeof n?n:e,ma(It(t,js),e,n)})),us=Yr(rs),cs=Yr((function(t){var n=t.length,r=n>1?t[n-1]:e;return r="function"==typeof r?(t.pop(),r):e,as(t,r)}));function hs(e){var t=Vn(e);return t.__chain__=!0,t}function ds(e,t){return t(e)}var ps=ni((function(t){var n=t.length,r=n?t[0]:0,a=this.__wrapped__,i=function(e){return sr(e,t)};return!(n>1||this.__actions__.length)&&a instanceof Wn&&vi(r)?((a=a.slice(r,+r+(n?1:0))).__actions__.push({func:ds,args:[i],thisArg:e}),new Gn(a,this.__chain__).thru((function(t){return n&&!t.length&&t.push(e),t}))):this.thru(i)})),fs=$a((function(e,t,n){Oe.call(e,n)?++e[n]:ir(e,n,1)})),ms=La(zi),gs=La(Gi);function ys(e,t){return(Gs(e)?Ct:dr)(e,li(t,3))}function vs(e,t){return(Gs(e)?Et:pr)(e,li(t,3))}var bs=$a((function(e,t,n){Oe.call(e,n)?e[n].push(t):ir(e,n,[t])})),xs=Yr((function(e,t,n){var r=-1,a="function"==typeof t,i=Hs(e)?_e(e.length):[];return dr(e,(function(e){i[++r]=a?wt(t,e,n):Nr(e,t,n)})),i})),Ts=$a((function(e,t,n){ir(e,n,t)}));function _s(e,t){return(Gs(e)?$t:Br)(e,li(t,3))}var ws=$a((function(e,t,n){e[n?0:1].push(t)}),(function(){return[[],[]]})),Ss=Yr((function(e,t){if(null==e)return[];var n=t.length;return n>1&&bi(e,t[0],t[1])?t=[]:n>2&&bi(t[0],t[1],t[2])&&(t=[t[0]]),Wr(e,yr(t,1),[])})),Cs=pt||function(){return ht.Date.now()};function Es(t,n,r){return n=r?e:n,n=t&&null==n?t.length:n,Za(t,o,e,e,e,e,n)}function ks(n,r){var a;if("function"!=typeof r)throw new Ne(t);return n=fo(n),function(){return--n>0&&(a=r.apply(this,arguments)),n<=1&&(r=e),a}}var Is=Yr((function(e,t,n){var r=1;if(n.length){var a=on(n,oi(Is));r|=i}return Za(e,r,t,n,a)})),As=Yr((function(e,t,n){var r=3;if(n.length){var a=on(n,oi(As));r|=i}return Za(t,r,e,n,a)}));function Ns(n,r,a){var i,s,o,l,u,c,h=0,d=!1,p=!1,f=!0;if("function"!=typeof n)throw new Ne(t);function m(t){var r=i,a=s;return i=s=e,h=t,l=n.apply(a,r)}function g(t){var n=t-c;return c===e||n>=r||n<0||p&&t-h>=o}function y(){var e=Cs();if(g(e))return v(e);u=Ni(y,function(e){var t=r-(e-c);return p?bn(t,o-(e-h)):t}(e))}function v(t){return u=e,f&&i?m(t):(i=s=e,l)}function b(){var t=Cs(),n=g(t);if(i=arguments,s=this,c=t,n){if(u===e)return function(e){return h=e,u=Ni(y,r),d?m(e):l}(c);if(p)return _a(u),u=Ni(y,r),m(c)}return u===e&&(u=Ni(y,r)),l}return r=go(r)||0,Qs(a)&&(d=!!a.leading,o=(p="maxWait"in a)?vn(go(a.maxWait)||0,r):o,f="trailing"in a?!!a.trailing:f),b.cancel=function(){u!==e&&_a(u),h=0,i=c=s=u=e},b.flush=function(){return u===e?l:v(Cs())},b}var $s=Yr((function(e,t){return cr(e,1,t)})),Ds=Yr((function(e,t,n){return cr(e,go(t)||0,n)}));function Ps(e,n){if("function"!=typeof e||null!=n&&"function"!=typeof n)throw new Ne(t);var r=function(){var t=arguments,a=n?n.apply(this,t):t[0],i=r.cache;if(i.has(a))return i.get(a);var s=e.apply(this,t);return r.cache=i.set(a,s)||i,s};return r.cache=new(Ps.Cache||qn),r}function Rs(e){if("function"!=typeof e)throw new Ne(t);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}Ps.Cache=qn;var Ms=xa((function(e,t){var n=(t=1==t.length&&Gs(t[0])?$t(t[0],Xt(li())):$t(yr(t,1),Xt(li()))).length;return Yr((function(r){for(var a=-1,i=bn(r.length,n);++a<i;)r[a]=t[a].call(this,r[a]);return wt(e,this,r)}))})),Os=Yr((function(t,n){var r=on(n,oi(Os));return Za(t,i,e,n,r)})),Fs=Yr((function(t,n){var r=on(n,oi(Fs));return Za(t,s,e,n,r)})),Ls=ni((function(t,n){return Za(t,l,e,e,e,n)}));function Bs(e,t){return e===t||e!=e&&t!=t}var Vs=ja(Er),Us=ja((function(e,t){return e>=t})),zs=$r(function(){return arguments}())?$r:function(e){return eo(e)&&Oe.call(e,"callee")&&!Xe.call(e,"callee")},Gs=_e.isArray,Ws=yt?Xt(yt):function(e){return eo(e)&&Cr(e)==N};function Hs(e){return null!=e&&Js(e.length)&&!Ys(e)}function js(e){return eo(e)&&Hs(e)}var qs=fn||gl,Ks=vt?Xt(vt):function(e){return eo(e)&&Cr(e)==y};function Xs(e){if(!eo(e))return!1;var t=Cr(e);return t==v||"[object DOMException]"==t||"string"==typeof e.message&&"string"==typeof e.name&&!ro(e)}function Ys(e){if(!Qs(e))return!1;var t=Cr(e);return t==b||t==x||"[object AsyncFunction]"==t||"[object Proxy]"==t}function Zs(e){return"number"==typeof e&&e==fo(e)}function Js(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=c}function Qs(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function eo(e){return null!=e&&"object"==typeof e}var to=bt?Xt(bt):function(e){return eo(e)&&fi(e)==T};function no(e){return"number"==typeof e||eo(e)&&Cr(e)==_}function ro(e){if(!eo(e)||Cr(e)!=w)return!1;var t=qe(e);if(null===t)return!0;var n=Oe.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&Me.call(n)==Ve}var ao=xt?Xt(xt):function(e){return eo(e)&&Cr(e)==C},io=Tt?Xt(Tt):function(e){return eo(e)&&fi(e)==E};function so(e){return"string"==typeof e||!Gs(e)&&eo(e)&&Cr(e)==k}function oo(e){return"symbol"==typeof e||eo(e)&&Cr(e)==I}var lo=_t?Xt(_t):function(e){return eo(e)&&Js(e.length)&&!!at[Cr(e)]},uo=ja(Lr),co=ja((function(e,t){return e<=t}));function ho(e){if(!e)return[];if(Hs(e))return so(e)?cn(e):Aa(e);if(st&&e[st])return function(e){for(var t,n=[];!(t=e.next()).done;)n.push(t.value);return n}(e[st]());var t=fi(e);return(t==T?an:t==E?ln:Vo)(e)}function po(e){return e?(e=go(e))===u||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}function fo(e){var t=po(e),n=t%1;return t==t?n?t-n:t:0}function mo(e){return e?or(fo(e),0,d):0}function go(e){if("number"==typeof e)return e;if(oo(e))return h;if(Qs(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Qs(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=Kt(e);var n=pe.test(e);return n||me.test(e)?lt(e.slice(2),n?2:8):de.test(e)?h:+e}function yo(e){return Na(e,Do(e))}function vo(e){return null==e?"":ua(e)}var bo=Da((function(e,t){if(wi(t)||Hs(t))Na(t,$o(t),e);else for(var n in t)Oe.call(t,n)&&tr(e,n,t[n])})),xo=Da((function(e,t){Na(t,Do(t),e)})),To=Da((function(e,t,n,r){Na(t,Do(t),e,r)})),_o=Da((function(e,t,n,r){Na(t,$o(t),e,r)})),wo=ni(sr),So=Yr((function(t,n){t=ke(t);var r=-1,a=n.length,i=a>2?n[2]:e;for(i&&bi(n[0],n[1],i)&&(a=1);++r<a;)for(var s=n[r],o=Do(s),l=-1,u=o.length;++l<u;){var c=o[l],h=t[c];(h===e||Bs(h,Pe[c])&&!Oe.call(t,c))&&(t[c]=s[c])}return t})),Co=Yr((function(t){return t.push(e,Qa),wt(Ro,e,t)}));function Eo(t,n,r){var a=null==t?e:wr(t,n);return a===e?r:a}function ko(e,t){return null!=e&&mi(e,t,Ir)}var Io=Ua((function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=Be.call(t)),e[t]=n}),el(rl)),Ao=Ua((function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=Be.call(t)),Oe.call(e,t)?e[t].push(n):e[t]=[n]}),li),No=Yr(Nr);function $o(e){return Hs(e)?Yn(e):Or(e)}function Do(e){return Hs(e)?Yn(e,!0):Fr(e)}var Po=Da((function(e,t,n){zr(e,t,n)})),Ro=Da((function(e,t,n,r){zr(e,t,n,r)})),Mo=ni((function(e,t){var n={};if(null==e)return n;var r=!1;t=$t(t,(function(t){return t=ba(t,e),r||(r=t.length>1),t})),Na(e,ai(e),n),r&&(n=lr(n,7,ei));for(var a=t.length;a--;)ha(n,t[a]);return n})),Oo=ni((function(e,t){return null==e?{}:function(e,t){return Hr(e,t,(function(t,n){return ko(e,n)}))}(e,t)}));function Fo(e,t){if(null==e)return{};var n=$t(ai(e),(function(e){return[e]}));return t=li(t),Hr(e,n,(function(e,n){return t(e,n[0])}))}var Lo=Ya($o),Bo=Ya(Do);function Vo(e){return null==e?[]:Yt(e,$o(e))}var Uo=Oa((function(e,t,n){return t=t.toLowerCase(),e+(n?zo(t):t)}));function zo(e){return Yo(vo(e).toLowerCase())}function Go(e){return(e=vo(e))&&e.replace(ye,en).replace(Ze,"")}var Wo=Oa((function(e,t,n){return e+(n?"-":"")+t.toLowerCase()})),Ho=Oa((function(e,t,n){return e+(n?" ":"")+t.toLowerCase()})),jo=Ma("toLowerCase"),qo=Oa((function(e,t,n){return e+(n?"_":"")+t.toLowerCase()})),Ko=Oa((function(e,t,n){return e+(n?" ":"")+Yo(t)})),Xo=Oa((function(e,t,n){return e+(n?" ":"")+t.toUpperCase()})),Yo=Ma("toUpperCase");function Zo(t,n,r){return t=vo(t),(n=r?e:n)===e?function(e){return tt.test(e)}(t)?function(e){return e.match(Qe)||[]}(t):function(e){return e.match(oe)||[]}(t):t.match(n)||[]}var Jo=Yr((function(t,n){try{return wt(t,e,n)}catch(r){return Xs(r)?r:new Se(r)}})),Qo=ni((function(e,t){return Ct(t,(function(t){t=Oi(t),ir(e,t,Is(e[t],e))})),e}));function el(e){return function(){return e}}var tl=Ba(),nl=Ba(!0);function rl(e){return e}function al(e){return Mr("function"==typeof e?e:lr(e,1))}var il=Yr((function(e,t){return function(n){return Nr(n,e,t)}})),sl=Yr((function(e,t){return function(n){return Nr(e,n,t)}}));function ol(e,t,n){var r=$o(t),a=_r(t,r);null!=n||Qs(t)&&(a.length||!r.length)||(n=t,t=e,e=this,a=_r(t,$o(t)));var i=!(Qs(n)&&"chain"in n&&!n.chain),s=Ys(e);return Ct(a,(function(n){var r=t[n];e[n]=r,s&&(e.prototype[n]=function(){var t=this.__chain__;if(i||t){var n=e(this.__wrapped__);return(n.__actions__=Aa(this.__actions__)).push({func:r,args:arguments,thisArg:e}),n.__chain__=t,n}return r.apply(e,Dt([this.value()],arguments))})})),e}function ll(){}var ul=Ga($t),cl=Ga(kt),hl=Ga(Mt);function dl(e){return xi(e)?Gt(Oi(e)):function(e){return function(t){return wr(t,e)}}(e)}var pl=Ha(),fl=Ha(!0);function ml(){return[]}function gl(){return!1}var yl,vl=za((function(e,t){return e+t}),0),bl=Ka("ceil"),xl=za((function(e,t){return e/t}),1),Tl=Ka("floor"),_l=za((function(e,t){return e*t}),1),wl=Ka("round"),Sl=za((function(e,t){return e-t}),0);return Vn.after=function(e,n){if("function"!=typeof n)throw new Ne(t);return e=fo(e),function(){if(--e<1)return n.apply(this,arguments)}},Vn.ary=Es,Vn.assign=bo,Vn.assignIn=xo,Vn.assignInWith=To,Vn.assignWith=_o,Vn.at=wo,Vn.before=ks,Vn.bind=Is,Vn.bindAll=Qo,Vn.bindKey=As,Vn.castArray=function(){if(!arguments.length)return[];var e=arguments[0];return Gs(e)?e:[e]},Vn.chain=hs,Vn.chunk=function(t,n,r){n=(r?bi(t,n,r):n===e)?1:vn(fo(n),0);var a=null==t?0:t.length;if(!a||n<1)return[];for(var i=0,s=0,o=_e(gt(a/n));i<a;)o[s++]=ra(t,i,i+=n);return o},Vn.compact=function(e){for(var t=-1,n=null==e?0:e.length,r=0,a=[];++t<n;){var i=e[t];i&&(a[r++]=i)}return a},Vn.concat=function(){var e=arguments.length;if(!e)return[];for(var t=_e(e-1),n=arguments[0],r=e;r--;)t[r-1]=arguments[r];return Dt(Gs(n)?Aa(n):[n],yr(t,1))},Vn.cond=function(e){var n=null==e?0:e.length,r=li();return e=n?$t(e,(function(e){if("function"!=typeof e[1])throw new Ne(t);return[r(e[0]),e[1]]})):[],Yr((function(t){for(var r=-1;++r<n;){var a=e[r];if(wt(a[0],this,t))return wt(a[1],this,t)}}))},Vn.conforms=function(e){return function(e){var t=$o(e);return function(n){return ur(n,e,t)}}(lr(e,1))},Vn.constant=el,Vn.countBy=fs,Vn.create=function(e,t){var n=Un(e);return null==t?n:ar(n,t)},Vn.curry=function t(n,r,a){var i=Za(n,8,e,e,e,e,e,r=a?e:r);return i.placeholder=t.placeholder,i},Vn.curryRight=function t(n,r,i){var s=Za(n,a,e,e,e,e,e,r=i?e:r);return s.placeholder=t.placeholder,s},Vn.debounce=Ns,Vn.defaults=So,Vn.defaultsDeep=Co,Vn.defer=$s,Vn.delay=Ds,Vn.difference=Bi,Vn.differenceBy=Vi,Vn.differenceWith=Ui,Vn.drop=function(t,n,r){var a=null==t?0:t.length;return a?ra(t,(n=r||n===e?1:fo(n))<0?0:n,a):[]},Vn.dropRight=function(t,n,r){var a=null==t?0:t.length;return a?ra(t,0,(n=a-(n=r||n===e?1:fo(n)))<0?0:n):[]},Vn.dropRightWhile=function(e,t){return e&&e.length?pa(e,li(t,3),!0,!0):[]},Vn.dropWhile=function(e,t){return e&&e.length?pa(e,li(t,3),!0):[]},Vn.fill=function(t,n,r,a){var i=null==t?0:t.length;return i?(r&&"number"!=typeof r&&bi(t,n,r)&&(r=0,a=i),function(t,n,r,a){var i=t.length;for((r=fo(r))<0&&(r=-r>i?0:i+r),(a=a===e||a>i?i:fo(a))<0&&(a+=i),a=r>a?0:mo(a);r<a;)t[r++]=n;return t}(t,n,r,a)):[]},Vn.filter=function(e,t){return(Gs(e)?It:gr)(e,li(t,3))},Vn.flatMap=function(e,t){return yr(_s(e,t),1)},Vn.flatMapDeep=function(e,t){return yr(_s(e,t),u)},Vn.flatMapDepth=function(t,n,r){return r=r===e?1:fo(r),yr(_s(t,n),r)},Vn.flatten=Wi,Vn.flattenDeep=function(e){return null!=e&&e.length?yr(e,u):[]},Vn.flattenDepth=function(t,n){return null!=t&&t.length?yr(t,n=n===e?1:fo(n)):[]},Vn.flip=function(e){return Za(e,512)},Vn.flow=tl,Vn.flowRight=nl,Vn.fromPairs=function(e){for(var t=-1,n=null==e?0:e.length,r={};++t<n;){var a=e[t];r[a[0]]=a[1]}return r},Vn.functions=function(e){return null==e?[]:_r(e,$o(e))},Vn.functionsIn=function(e){return null==e?[]:_r(e,Do(e))},Vn.groupBy=bs,Vn.initial=function(e){return null!=e&&e.length?ra(e,0,-1):[]},Vn.intersection=ji,Vn.intersectionBy=qi,Vn.intersectionWith=Ki,Vn.invert=Io,Vn.invertBy=Ao,Vn.invokeMap=xs,Vn.iteratee=al,Vn.keyBy=Ts,Vn.keys=$o,Vn.keysIn=Do,Vn.map=_s,Vn.mapKeys=function(e,t){var n={};return t=li(t,3),xr(e,(function(e,r,a){ir(n,t(e,r,a),e)})),n},Vn.mapValues=function(e,t){var n={};return t=li(t,3),xr(e,(function(e,r,a){ir(n,r,t(e,r,a))})),n},Vn.matches=function(e){return Vr(lr(e,1))},Vn.matchesProperty=function(e,t){return Ur(e,lr(t,1))},Vn.memoize=Ps,Vn.merge=Po,Vn.mergeWith=Ro,Vn.method=il,Vn.methodOf=sl,Vn.mixin=ol,Vn.negate=Rs,Vn.nthArg=function(e){return e=fo(e),Yr((function(t){return Gr(t,e)}))},Vn.omit=Mo,Vn.omitBy=function(e,t){return Fo(e,Rs(li(t)))},Vn.once=function(e){return ks(2,e)},Vn.orderBy=function(t,n,r,a){return null==t?[]:(Gs(n)||(n=null==n?[]:[n]),Gs(r=a?e:r)||(r=null==r?[]:[r]),Wr(t,n,r))},Vn.over=ul,Vn.overArgs=Ms,Vn.overEvery=cl,Vn.overSome=hl,Vn.partial=Os,Vn.partialRight=Fs,Vn.partition=ws,Vn.pick=Oo,Vn.pickBy=Fo,Vn.property=dl,Vn.propertyOf=function(t){return function(n){return null==t?e:wr(t,n)}},Vn.pull=Yi,Vn.pullAll=Zi,Vn.pullAllBy=function(e,t,n){return e&&e.length&&t&&t.length?jr(e,t,li(n,2)):e},Vn.pullAllWith=function(t,n,r){return t&&t.length&&n&&n.length?jr(t,n,e,r):t},Vn.pullAt=Ji,Vn.range=pl,Vn.rangeRight=fl,Vn.rearg=Ls,Vn.reject=function(e,t){return(Gs(e)?It:gr)(e,Rs(li(t,3)))},Vn.remove=function(e,t){var n=[];if(!e||!e.length)return n;var r=-1,a=[],i=e.length;for(t=li(t,3);++r<i;){var s=e[r];t(s,r,e)&&(n.push(s),a.push(r))}return qr(e,a),n},Vn.rest=function(n,r){if("function"!=typeof n)throw new Ne(t);return Yr(n,r=r===e?r:fo(r))},Vn.reverse=Qi,Vn.sampleSize=function(t,n,r){return n=(r?bi(t,n,r):n===e)?1:fo(n),(Gs(t)?Jn:Jr)(t,n)},Vn.set=function(e,t,n){return null==e?e:Qr(e,t,n)},Vn.setWith=function(t,n,r,a){return a="function"==typeof a?a:e,null==t?t:Qr(t,n,r,a)},Vn.shuffle=function(e){return(Gs(e)?Qn:na)(e)},Vn.slice=function(t,n,r){var a=null==t?0:t.length;return a?(r&&"number"!=typeof r&&bi(t,n,r)?(n=0,r=a):(n=null==n?0:fo(n),r=r===e?a:fo(r)),ra(t,n,r)):[]},Vn.sortBy=Ss,Vn.sortedUniq=function(e){return e&&e.length?oa(e):[]},Vn.sortedUniqBy=function(e,t){return e&&e.length?oa(e,li(t,2)):[]},Vn.split=function(t,n,r){return r&&"number"!=typeof r&&bi(t,n,r)&&(n=r=e),(r=r===e?d:r>>>0)?(t=vo(t))&&("string"==typeof n||null!=n&&!ao(n))&&!(n=ua(n))&&rn(t)?Ta(cn(t),0,r):t.split(n,r):[]},Vn.spread=function(e,n){if("function"!=typeof e)throw new Ne(t);return n=null==n?0:vn(fo(n),0),Yr((function(t){var r=t[n],a=Ta(t,0,n);return r&&Dt(a,r),wt(e,this,a)}))},Vn.tail=function(e){var t=null==e?0:e.length;return t?ra(e,1,t):[]},Vn.take=function(t,n,r){return t&&t.length?ra(t,0,(n=r||n===e?1:fo(n))<0?0:n):[]},Vn.takeRight=function(t,n,r){var a=null==t?0:t.length;return a?ra(t,(n=a-(n=r||n===e?1:fo(n)))<0?0:n,a):[]},Vn.takeRightWhile=function(e,t){return e&&e.length?pa(e,li(t,3),!1,!0):[]},Vn.takeWhile=function(e,t){return e&&e.length?pa(e,li(t,3)):[]},Vn.tap=function(e,t){return t(e),e},Vn.throttle=function(e,n,r){var a=!0,i=!0;if("function"!=typeof e)throw new Ne(t);return Qs(r)&&(a="leading"in r?!!r.leading:a,i="trailing"in r?!!r.trailing:i),Ns(e,n,{leading:a,maxWait:n,trailing:i})},Vn.thru=ds,Vn.toArray=ho,Vn.toPairs=Lo,Vn.toPairsIn=Bo,Vn.toPath=function(e){return Gs(e)?$t(e,Oi):oo(e)?[e]:Aa(Mi(vo(e)))},Vn.toPlainObject=yo,Vn.transform=function(e,t,n){var r=Gs(e),a=r||qs(e)||lo(e);if(t=li(t,4),null==n){var i=e&&e.constructor;n=a?r?new i:[]:Qs(e)&&Ys(i)?Un(qe(e)):{}}return(a?Ct:xr)(e,(function(e,r,a){return t(n,e,r,a)})),n},Vn.unary=function(e){return Es(e,1)},Vn.union=es,Vn.unionBy=ts,Vn.unionWith=ns,Vn.uniq=function(e){return e&&e.length?ca(e):[]},Vn.uniqBy=function(e,t){return e&&e.length?ca(e,li(t,2)):[]},Vn.uniqWith=function(t,n){return n="function"==typeof n?n:e,t&&t.length?ca(t,e,n):[]},Vn.unset=function(e,t){return null==e||ha(e,t)},Vn.unzip=rs,Vn.unzipWith=as,Vn.update=function(e,t,n){return null==e?e:da(e,t,va(n))},Vn.updateWith=function(t,n,r,a){return a="function"==typeof a?a:e,null==t?t:da(t,n,va(r),a)},Vn.values=Vo,Vn.valuesIn=function(e){return null==e?[]:Yt(e,Do(e))},Vn.without=is,Vn.words=Zo,Vn.wrap=function(e,t){return Os(va(t),e)},Vn.xor=ss,Vn.xorBy=os,Vn.xorWith=ls,Vn.zip=us,Vn.zipObject=function(e,t){return ga(e||[],t||[],tr)},Vn.zipObjectDeep=function(e,t){return ga(e||[],t||[],Qr)},Vn.zipWith=cs,Vn.entries=Lo,Vn.entriesIn=Bo,Vn.extend=xo,Vn.extendWith=To,ol(Vn,Vn),Vn.add=vl,Vn.attempt=Jo,Vn.camelCase=Uo,Vn.capitalize=zo,Vn.ceil=bl,Vn.clamp=function(t,n,r){return r===e&&(r=n,n=e),r!==e&&(r=(r=go(r))==r?r:0),n!==e&&(n=(n=go(n))==n?n:0),or(go(t),n,r)},Vn.clone=function(e){return lr(e,4)},Vn.cloneDeep=function(e){return lr(e,5)},Vn.cloneDeepWith=function(t,n){return lr(t,5,n="function"==typeof n?n:e)},Vn.cloneWith=function(t,n){return lr(t,4,n="function"==typeof n?n:e)},Vn.conformsTo=function(e,t){return null==t||ur(e,t,$o(t))},Vn.deburr=Go,Vn.defaultTo=function(e,t){return null==e||e!=e?t:e},Vn.divide=xl,Vn.endsWith=function(t,n,r){t=vo(t),n=ua(n);var a=t.length,i=r=r===e?a:or(fo(r),0,a);return(r-=n.length)>=0&&t.slice(r,i)==n},Vn.eq=Bs,Vn.escape=function(e){return(e=vo(e))&&q.test(e)?e.replace(H,tn):e},Vn.escapeRegExp=function(e){return(e=vo(e))&&te.test(e)?e.replace(ee,"\\$&"):e},Vn.every=function(t,n,r){var a=Gs(t)?kt:fr;return r&&bi(t,n,r)&&(n=e),a(t,li(n,3))},Vn.find=ms,Vn.findIndex=zi,Vn.findKey=function(e,t){return Ft(e,li(t,3),xr)},Vn.findLast=gs,Vn.findLastIndex=Gi,Vn.findLastKey=function(e,t){return Ft(e,li(t,3),Tr)},Vn.floor=Tl,Vn.forEach=ys,Vn.forEachRight=vs,Vn.forIn=function(e,t){return null==e?e:vr(e,li(t,3),Do)},Vn.forInRight=function(e,t){return null==e?e:br(e,li(t,3),Do)},Vn.forOwn=function(e,t){return e&&xr(e,li(t,3))},Vn.forOwnRight=function(e,t){return e&&Tr(e,li(t,3))},Vn.get=Eo,Vn.gt=Vs,Vn.gte=Us,Vn.has=function(e,t){return null!=e&&mi(e,t,kr)},Vn.hasIn=ko,Vn.head=Hi,Vn.identity=rl,Vn.includes=function(e,t,n,r){e=Hs(e)?e:Vo(e),n=n&&!r?fo(n):0;var a=e.length;return n<0&&(n=vn(a+n,0)),so(e)?n<=a&&e.indexOf(t,n)>-1:!!a&&Bt(e,t,n)>-1},Vn.indexOf=function(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var a=null==n?0:fo(n);return a<0&&(a=vn(r+a,0)),Bt(e,t,a)},Vn.inRange=function(t,n,r){return n=po(n),r===e?(r=n,n=0):r=po(r),function(e,t,n){return e>=bn(t,n)&&e<vn(t,n)}(t=go(t),n,r)},Vn.invoke=No,Vn.isArguments=zs,Vn.isArray=Gs,Vn.isArrayBuffer=Ws,Vn.isArrayLike=Hs,Vn.isArrayLikeObject=js,Vn.isBoolean=function(e){return!0===e||!1===e||eo(e)&&Cr(e)==g},Vn.isBuffer=qs,Vn.isDate=Ks,Vn.isElement=function(e){return eo(e)&&1===e.nodeType&&!ro(e)},Vn.isEmpty=function(e){if(null==e)return!0;if(Hs(e)&&(Gs(e)||"string"==typeof e||"function"==typeof e.splice||qs(e)||lo(e)||zs(e)))return!e.length;var t=fi(e);if(t==T||t==E)return!e.size;if(wi(e))return!Or(e).length;for(var n in e)if(Oe.call(e,n))return!1;return!0},Vn.isEqual=function(e,t){return Dr(e,t)},Vn.isEqualWith=function(t,n,r){var a=(r="function"==typeof r?r:e)?r(t,n):e;return a===e?Dr(t,n,e,r):!!a},Vn.isError=Xs,Vn.isFinite=function(e){return"number"==typeof e&&mn(e)},Vn.isFunction=Ys,Vn.isInteger=Zs,Vn.isLength=Js,Vn.isMap=to,Vn.isMatch=function(e,t){return e===t||Pr(e,t,ci(t))},Vn.isMatchWith=function(t,n,r){return r="function"==typeof r?r:e,Pr(t,n,ci(n),r)},Vn.isNaN=function(e){return no(e)&&e!=+e},Vn.isNative=function(e){if(_i(e))throw new Se("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return Rr(e)},Vn.isNil=function(e){return null==e},Vn.isNull=function(e){return null===e},Vn.isNumber=no,Vn.isObject=Qs,Vn.isObjectLike=eo,Vn.isPlainObject=ro,Vn.isRegExp=ao,Vn.isSafeInteger=function(e){return Zs(e)&&e>=-9007199254740991&&e<=c},Vn.isSet=io,Vn.isString=so,Vn.isSymbol=oo,Vn.isTypedArray=lo,Vn.isUndefined=function(t){return t===e},Vn.isWeakMap=function(e){return eo(e)&&fi(e)==A},Vn.isWeakSet=function(e){return eo(e)&&"[object WeakSet]"==Cr(e)},Vn.join=function(e,t){return null==e?"":gn.call(e,t)},Vn.kebabCase=Wo,Vn.last=Xi,Vn.lastIndexOf=function(t,n,r){var a=null==t?0:t.length;if(!a)return-1;var i=a;return r!==e&&(i=(i=fo(r))<0?vn(a+i,0):bn(i,a-1)),n==n?function(e,t,n){for(var r=n+1;r--;)if(e[r]===t)return r;return r}(t,n,i):Lt(t,Ut,i,!0)},Vn.lowerCase=Ho,Vn.lowerFirst=jo,Vn.lt=uo,Vn.lte=co,Vn.max=function(t){return t&&t.length?mr(t,rl,Er):e},Vn.maxBy=function(t,n){return t&&t.length?mr(t,li(n,2),Er):e},Vn.mean=function(e){return zt(e,rl)},Vn.meanBy=function(e,t){return zt(e,li(t,2))},Vn.min=function(t){return t&&t.length?mr(t,rl,Lr):e},Vn.minBy=function(t,n){return t&&t.length?mr(t,li(n,2),Lr):e},Vn.stubArray=ml,Vn.stubFalse=gl,Vn.stubObject=function(){return{}},Vn.stubString=function(){return""},Vn.stubTrue=function(){return!0},Vn.multiply=_l,Vn.nth=function(t,n){return t&&t.length?Gr(t,fo(n)):e},Vn.noConflict=function(){return ht._===this&&(ht._=Ue),this},Vn.noop=ll,Vn.now=Cs,Vn.pad=function(e,t,n){e=vo(e);var r=(t=fo(t))?un(e):0;if(!t||r>=t)return e;var a=(t-r)/2;return Wa(Ot(a),n)+e+Wa(gt(a),n)},Vn.padEnd=function(e,t,n){e=vo(e);var r=(t=fo(t))?un(e):0;return t&&r<t?e+Wa(t-r,n):e},Vn.padStart=function(e,t,n){e=vo(e);var r=(t=fo(t))?un(e):0;return t&&r<t?Wa(t-r,n)+e:e},Vn.parseInt=function(e,t,n){return n||null==t?t=0:t&&(t=+t),Tn(vo(e).replace(ne,""),t||0)},Vn.random=function(t,n,r){if(r&&"boolean"!=typeof r&&bi(t,n,r)&&(n=r=e),r===e&&("boolean"==typeof n?(r=n,n=e):"boolean"==typeof t&&(r=t,t=e)),t===e&&n===e?(t=0,n=1):(t=po(t),n===e?(n=t,t=0):n=po(n)),t>n){var a=t;t=n,n=a}if(r||t%1||n%1){var i=_n();return bn(t+i*(n-t+ot("1e-"+((i+"").length-1))),n)}return Kr(t,n)},Vn.reduce=function(e,t,n){var r=Gs(e)?Pt:Ht,a=arguments.length<3;return r(e,li(t,4),n,a,dr)},Vn.reduceRight=function(e,t,n){var r=Gs(e)?Rt:Ht,a=arguments.length<3;return r(e,li(t,4),n,a,pr)},Vn.repeat=function(t,n,r){return n=(r?bi(t,n,r):n===e)?1:fo(n),Xr(vo(t),n)},Vn.replace=function(){var e=arguments,t=vo(e[0]);return e.length<3?t:t.replace(e[1],e[2])},Vn.result=function(t,n,r){var a=-1,i=(n=ba(n,t)).length;for(i||(i=1,t=e);++a<i;){var s=null==t?e:t[Oi(n[a])];s===e&&(a=i,s=r),t=Ys(s)?s.call(t):s}return t},Vn.round=wl,Vn.runInContext=re,Vn.sample=function(e){return(Gs(e)?Zn:Zr)(e)},Vn.size=function(e){if(null==e)return 0;if(Hs(e))return so(e)?un(e):e.length;var t=fi(e);return t==T||t==E?e.size:Or(e).length},Vn.snakeCase=qo,Vn.some=function(t,n,r){var a=Gs(t)?Mt:aa;return r&&bi(t,n,r)&&(n=e),a(t,li(n,3))},Vn.sortedIndex=function(e,t){return ia(e,t)},Vn.sortedIndexBy=function(e,t,n){return sa(e,t,li(n,2))},Vn.sortedIndexOf=function(e,t){var n=null==e?0:e.length;if(n){var r=ia(e,t);if(r<n&&Bs(e[r],t))return r}return-1},Vn.sortedLastIndex=function(e,t){return ia(e,t,!0)},Vn.sortedLastIndexBy=function(e,t,n){return sa(e,t,li(n,2),!0)},Vn.sortedLastIndexOf=function(e,t){if(null!=e&&e.length){var n=ia(e,t,!0)-1;if(Bs(e[n],t))return n}return-1},Vn.startCase=Ko,Vn.startsWith=function(e,t,n){return e=vo(e),n=null==n?0:or(fo(n),0,e.length),t=ua(t),e.slice(n,n+t.length)==t},Vn.subtract=Sl,Vn.sum=function(e){return e&&e.length?jt(e,rl):0},Vn.sumBy=function(e,t){return e&&e.length?jt(e,li(t,2)):0},Vn.template=function(t,n,r){var a=Vn.templateSettings;r&&bi(t,n,r)&&(n=e),t=vo(t),n=To({},n,a,Ja);var i,s,o=To({},n.imports,a.imports,Ja),l=$o(o),u=Yt(o,l),c=0,h=n.interpolate||ve,d="__p += '",p=Ie((n.escape||ve).source+"|"+h.source+"|"+(h===Y?ce:ve).source+"|"+(n.evaluate||ve).source+"|$","g"),f="//# sourceURL="+(Oe.call(n,"sourceURL")?(n.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++rt+"]")+"\n";t.replace(p,(function(e,n,r,a,o,l){return r||(r=a),d+=t.slice(c,l).replace(be,nn),n&&(i=!0,d+="' +\n__e("+n+") +\n'"),o&&(s=!0,d+="';\n"+o+";\n__p += '"),r&&(d+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),c=l+e.length,e})),d+="';\n";var m=Oe.call(n,"variable")&&n.variable;if(m){if(le.test(m))throw new Se("Invalid `variable` option passed into `_.template`")}else d="with (obj) {\n"+d+"\n}\n";d=(s?d.replace(U,""):d).replace(z,"$1").replace(G,"$1;"),d="function("+(m||"obj")+") {\n"+(m?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(i?", __e = _.escape":"")+(s?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+d+"return __p\n}";var g=Jo((function(){return Ce(l,f+"return "+d).apply(e,u)}));if(g.source=d,Xs(g))throw g;return g},Vn.times=function(e,t){if((e=fo(e))<1||e>c)return[];var n=d,r=bn(e,d);t=li(t),e-=d;for(var a=qt(r,t);++n<e;)t(n);return a},Vn.toFinite=po,Vn.toInteger=fo,Vn.toLength=mo,Vn.toLower=function(e){return vo(e).toLowerCase()},Vn.toNumber=go,Vn.toSafeInteger=function(e){return e?or(fo(e),-9007199254740991,c):0===e?e:0},Vn.toString=vo,Vn.toUpper=function(e){return vo(e).toUpperCase()},Vn.trim=function(t,n,r){if((t=vo(t))&&(r||n===e))return Kt(t);if(!t||!(n=ua(n)))return t;var a=cn(t),i=cn(n);return Ta(a,Jt(a,i),Qt(a,i)+1).join("")},Vn.trimEnd=function(t,n,r){if((t=vo(t))&&(r||n===e))return t.slice(0,hn(t)+1);if(!t||!(n=ua(n)))return t;var a=cn(t);return Ta(a,0,Qt(a,cn(n))+1).join("")},Vn.trimStart=function(t,n,r){if((t=vo(t))&&(r||n===e))return t.replace(ne,"");if(!t||!(n=ua(n)))return t;var a=cn(t);return Ta(a,Jt(a,cn(n))).join("")},Vn.truncate=function(t,n){var r=30,a="...";if(Qs(n)){var i="separator"in n?n.separator:i;r="length"in n?fo(n.length):r,a="omission"in n?ua(n.omission):a}var s=(t=vo(t)).length;if(rn(t)){var o=cn(t);s=o.length}if(r>=s)return t;var l=r-un(a);if(l<1)return a;var u=o?Ta(o,0,l).join(""):t.slice(0,l);if(i===e)return u+a;if(o&&(l+=u.length-l),ao(i)){if(t.slice(l).search(i)){var c,h=u;for(i.global||(i=Ie(i.source,vo(he.exec(i))+"g")),i.lastIndex=0;c=i.exec(h);)var d=c.index;u=u.slice(0,d===e?l:d)}}else if(t.indexOf(ua(i),l)!=l){var p=u.lastIndexOf(i);p>-1&&(u=u.slice(0,p))}return u+a},Vn.unescape=function(e){return(e=vo(e))&&j.test(e)?e.replace(W,dn):e},Vn.uniqueId=function(e){var t=++Fe;return vo(e)+t},Vn.upperCase=Xo,Vn.upperFirst=Yo,Vn.each=ys,Vn.eachRight=vs,Vn.first=Hi,ol(Vn,(yl={},xr(Vn,(function(e,t){Oe.call(Vn.prototype,t)||(yl[t]=e)})),yl),{chain:!1}),Vn.VERSION="4.17.21",Ct(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(e){Vn[e].placeholder=Vn})),Ct(["drop","take"],(function(t,n){Wn.prototype[t]=function(r){r=r===e?1:vn(fo(r),0);var a=this.__filtered__&&!n?new Wn(this):this.clone();return a.__filtered__?a.__takeCount__=bn(r,a.__takeCount__):a.__views__.push({size:bn(r,d),type:t+(a.__dir__<0?"Right":"")}),a},Wn.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}})),Ct(["filter","map","takeWhile"],(function(e,t){var n=t+1,r=1==n||3==n;Wn.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:li(e,3),type:n}),t.__filtered__=t.__filtered__||r,t}})),Ct(["head","last"],(function(e,t){var n="take"+(t?"Right":"");Wn.prototype[e]=function(){return this[n](1).value()[0]}})),Ct(["initial","tail"],(function(e,t){var n="drop"+(t?"":"Right");Wn.prototype[e]=function(){return this.__filtered__?new Wn(this):this[n](1)}})),Wn.prototype.compact=function(){return this.filter(rl)},Wn.prototype.find=function(e){return this.filter(e).head()},Wn.prototype.findLast=function(e){return this.reverse().find(e)},Wn.prototype.invokeMap=Yr((function(e,t){return"function"==typeof e?new Wn(this):this.map((function(n){return Nr(n,e,t)}))})),Wn.prototype.reject=function(e){return this.filter(Rs(li(e)))},Wn.prototype.slice=function(t,n){t=fo(t);var r=this;return r.__filtered__&&(t>0||n<0)?new Wn(r):(t<0?r=r.takeRight(-t):t&&(r=r.drop(t)),n!==e&&(r=(n=fo(n))<0?r.dropRight(-n):r.take(n-t)),r)},Wn.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Wn.prototype.toArray=function(){return this.take(d)},xr(Wn.prototype,(function(t,n){var r=/^(?:filter|find|map|reject)|While$/.test(n),a=/^(?:head|last)$/.test(n),i=Vn[a?"take"+("last"==n?"Right":""):n],s=a||/^find/.test(n);i&&(Vn.prototype[n]=function(){var n=this.__wrapped__,o=a?[1]:arguments,l=n instanceof Wn,u=o[0],c=l||Gs(n),h=function(e){var t=i.apply(Vn,Dt([e],o));return a&&d?t[0]:t};c&&r&&"function"==typeof u&&1!=u.length&&(l=c=!1);var d=this.__chain__,p=!!this.__actions__.length,f=s&&!d,m=l&&!p;if(!s&&c){n=m?n:new Wn(this);var g=t.apply(n,o);return g.__actions__.push({func:ds,args:[h],thisArg:e}),new Gn(g,d)}return f&&m?t.apply(this,o):(g=this.thru(h),f?a?g.value()[0]:g.value():g)})})),Ct(["pop","push","shift","sort","splice","unshift"],(function(e){var t=$e[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",r=/^(?:pop|shift)$/.test(e);Vn.prototype[e]=function(){var e=arguments;if(r&&!this.__chain__){var a=this.value();return t.apply(Gs(a)?a:[],e)}return this[n]((function(n){return t.apply(Gs(n)?n:[],e)}))}})),xr(Wn.prototype,(function(e,t){var n=Vn[t];if(n){var r=n.name+"";Oe.call($n,r)||($n[r]=[]),$n[r].push({name:t,func:n})}})),$n[Va(e,2).name]=[{name:"wrapper",func:e}],Wn.prototype.clone=function(){var e=new Wn(this.__wrapped__);return e.__actions__=Aa(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=Aa(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=Aa(this.__views__),e},Wn.prototype.reverse=function(){if(this.__filtered__){var e=new Wn(this);e.__dir__=-1,e.__filtered__=!0}else(e=this.clone()).__dir__*=-1;return e},Wn.prototype.value=function(){var e=this.__wrapped__.value(),t=this.__dir__,n=Gs(e),r=t<0,a=n?e.length:0,i=function(e,t,n){for(var r=-1,a=n.length;++r<a;){var i=n[r],s=i.size;switch(i.type){case"drop":e+=s;break;case"dropRight":t-=s;break;case"take":t=bn(t,e+s);break;case"takeRight":e=vn(e,t-s)}}return{start:e,end:t}}(0,a,this.__views__),s=i.start,o=i.end,l=o-s,u=r?o:s-1,c=this.__iteratees__,h=c.length,d=0,p=bn(l,this.__takeCount__);if(!n||!r&&a==l&&p==l)return fa(e,this.__actions__);var f=[];e:for(;l--&&d<p;){for(var m=-1,g=e[u+=t];++m<h;){var y=c[m],v=y.iteratee,b=y.type,x=v(g);if(2==b)g=x;else if(!x){if(1==b)continue e;break e}}f[d++]=g}return f},Vn.prototype.at=ps,Vn.prototype.chain=function(){return hs(this)},Vn.prototype.commit=function(){return new Gn(this.value(),this.__chain__)},Vn.prototype.next=function(){this.__values__===e&&(this.__values__=ho(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?e:this.__values__[this.__index__++]}},Vn.prototype.plant=function(t){for(var n,r=this;r instanceof zn;){var a=Li(r);a.__index__=0,a.__values__=e,n?i.__wrapped__=a:n=a;var i=a;r=r.__wrapped__}return i.__wrapped__=t,n},Vn.prototype.reverse=function(){var t=this.__wrapped__;if(t instanceof Wn){var n=t;return this.__actions__.length&&(n=new Wn(this)),(n=n.reverse()).__actions__.push({func:ds,args:[Qi],thisArg:e}),new Gn(n,this.__chain__)}return this.thru(Qi)},Vn.prototype.toJSON=Vn.prototype.valueOf=Vn.prototype.value=function(){return fa(this.__wrapped__,this.__actions__)},Vn.prototype.first=Vn.prototype.head,st&&(Vn.prototype[st]=function(){return this}),Vn}();pt?((pt.exports=pn)._=pn,dt._=pn):ht._=pn}.call(commonjsGlobal);var lodashExports=lodash.exports;const pleaseSelectTypeOfEkyc$1="Please select type of eKYC",idCard$1="Identity card",passport$1="Passport",driverLicense$1="Driver license",frontside$1="Frontside",backside$1="Backside",selfie$1="Selfie",ocrWarn$1="* Please use real document. Make sure your document details are clear to read with no blur and glare.",takeVideoIn3s$1="Take your video in 3 seconds",uploadPhoto$1="Upload photo",capturePhoto$1="Capture photo",next$1="Next",back$1="Back",switchCam$1="Switch cam",capture$1="Capture",pleaseKeepYourHeadStraight$1="Please keep your head straight",pleaseKeepYourFaceStraight$1="Please keep your face straight",pleaseMoveYourFaceNaturally$1="Please keep move your face naturally",record$1="Record",holdStill$1="Hold still",previewVideo$1="Preview video",recapture$1="Recapture",processing$1="Processing",details$1="Details",fraudCheck$1="Fraud check",close$1="Close",pleaseTakePhotoOfBothSides$1="Please take photos of document for validating information",invalidImageIf$1="Invalid image if",captureSelectImage$1="Capture image",uploadSelectImage$1="Select image",tooSmall$1="Too small",missingDetails$1="Missing details",blurry$1="Blurry",pleaseKeepDocumentsInTheCaptureArea$1="Please keep documents in the capture area",takeASelfie$1="Take a selfie",selfieAniWarning$1="The image should be clear and have your face fully inside the frame",seconds$1="seconds",recording$1="Recording",headStraight$1="Please keep your head straight",faceStraight$1="Please keep your face straight",noFaceDetected$1="No face detected",recordVideoOfFace$1="Record video of face",pleaseKeepYourFaceInTheRecordingArea$1="Please keep your face in the recording area",ocrInformation$1="Document information",thereWasError$1="There was an error. Please try again",livenessLimitExceeded$1="Liveness record limit exceeded",continueTxt$1="Continue",yourSelfie$1="Your selfie",idealPose$1="Ideal pose",cancel$1="Cancel",initializingPleaseWait$1="Initializing SDK. Please wait",fileSizeCannotBeExceeded$1="File size cannot be exceeded",pleaseUploadDocuments$1="Please upload documents",clickHereToUpload$1="Click here to upload",version$9="Version",stepOcr$1="Ocr",stepSelfie$1="Selfie",stepReview$1="Review",en$1={pleaseSelectTypeOfEkyc:pleaseSelectTypeOfEkyc$1,idCard:idCard$1,passport:passport$1,driverLicense:driverLicense$1,frontside:frontside$1,backside:backside$1,selfie:selfie$1,ocrWarn:ocrWarn$1,takeVideoIn3s:takeVideoIn3s$1,uploadPhoto:uploadPhoto$1,capturePhoto:capturePhoto$1,next:next$1,back:back$1,switchCam:switchCam$1,capture:capture$1,pleaseKeepYourHeadStraight:pleaseKeepYourHeadStraight$1,pleaseKeepYourFaceStraight:pleaseKeepYourFaceStraight$1,pleaseMoveYourFaceNaturally:pleaseMoveYourFaceNaturally$1,record:record$1,holdStill:holdStill$1,previewVideo:previewVideo$1,recapture:recapture$1,processing:processing$1,details:details$1,fraudCheck:fraudCheck$1,close:close$1,pleaseTakePhotoOfBothSides:pleaseTakePhotoOfBothSides$1,invalidImageIf:invalidImageIf$1,captureSelectImage:captureSelectImage$1,uploadSelectImage:uploadSelectImage$1,tooSmall:tooSmall$1,missingDetails:missingDetails$1,blurry:blurry$1,pleaseKeepDocumentsInTheCaptureArea:pleaseKeepDocumentsInTheCaptureArea$1,takeASelfie:takeASelfie$1,selfieAniWarning:selfieAniWarning$1,seconds:seconds$1,recording:recording$1,headStraight:headStraight$1,faceStraight:faceStraight$1,noFaceDetected:noFaceDetected$1,recordVideoOfFace:recordVideoOfFace$1,pleaseKeepYourFaceInTheRecordingArea:pleaseKeepYourFaceInTheRecordingArea$1,ocrInformation:ocrInformation$1,thereWasError:thereWasError$1,livenessLimitExceeded:livenessLimitExceeded$1,continueTxt:continueTxt$1,yourSelfie:yourSelfie$1,idealPose:idealPose$1,cancel:cancel$1,initializingPleaseWait:initializingPleaseWait$1,fileSizeCannotBeExceeded:fileSizeCannotBeExceeded$1,pleaseUploadDocuments:pleaseUploadDocuments$1,clickHereToUpload:clickHereToUpload$1,version:version$9,stepOcr:stepOcr$1,stepSelfie:stepSelfie$1,stepReview:stepReview$1},enJson=Object.freeze(Object.defineProperty({__proto__:null,back:back$1,backside:backside$1,blurry:blurry$1,cancel:cancel$1,capture:capture$1,capturePhoto:capturePhoto$1,captureSelectImage:captureSelectImage$1,clickHereToUpload:clickHereToUpload$1,close:close$1,continueTxt:continueTxt$1,default:en$1,details:details$1,driverLicense:driverLicense$1,faceStraight:faceStraight$1,fileSizeCannotBeExceeded:fileSizeCannotBeExceeded$1,fraudCheck:fraudCheck$1,frontside:frontside$1,headStraight:headStraight$1,holdStill:holdStill$1,idCard:idCard$1,idealPose:idealPose$1,initializingPleaseWait:initializingPleaseWait$1,invalidImageIf:invalidImageIf$1,livenessLimitExceeded:livenessLimitExceeded$1,missingDetails:missingDetails$1,next:next$1,noFaceDetected:noFaceDetected$1,ocrInformation:ocrInformation$1,ocrWarn:ocrWarn$1,passport:passport$1,pleaseKeepDocumentsInTheCaptureArea:pleaseKeepDocumentsInTheCaptureArea$1,pleaseKeepYourFaceInTheRecordingArea:pleaseKeepYourFaceInTheRecordingArea$1,pleaseKeepYourFaceStraight:pleaseKeepYourFaceStraight$1,pleaseKeepYourHeadStraight:pleaseKeepYourHeadStraight$1,pleaseMoveYourFaceNaturally:pleaseMoveYourFaceNaturally$1,pleaseSelectTypeOfEkyc:pleaseSelectTypeOfEkyc$1,pleaseTakePhotoOfBothSides:pleaseTakePhotoOfBothSides$1,pleaseUploadDocuments:pleaseUploadDocuments$1,previewVideo:previewVideo$1,processing:processing$1,recapture:recapture$1,record:record$1,recordVideoOfFace:recordVideoOfFace$1,recording:recording$1,seconds:seconds$1,selfie:selfie$1,selfieAniWarning:selfieAniWarning$1,stepOcr:stepOcr$1,stepReview:stepReview$1,stepSelfie:stepSelfie$1,switchCam:switchCam$1,takeASelfie:takeASelfie$1,takeVideoIn3s:takeVideoIn3s$1,thereWasError:thereWasError$1,tooSmall:tooSmall$1,uploadPhoto:uploadPhoto$1,uploadSelectImage:uploadSelectImage$1,version:version$9,yourSelfie:yourSelfie$1},Symbol.toStringTag,{value:"Module"})),pleaseSelectTypeOfEkyc="Xin hãy chọn loại eKYC",idCard="Căn cước công dân/CMT",passport="Hộ chiếu",driverLicense="Bằng lái xe",frontside="Mặt trước",backside="Mặt sau",selfie="Chân dung",ocrWarn="* Xin hãy sử dụng giấy tờ thật. Đảm bảo các chi tiết của giấy tờ không bị mờ và chói.",takeVideoIn3s="Quay video trong 3 giây",uploadPhoto="Tải ảnh lên",capturePhoto="Chụp ảnh",next="Tiếp theo",back="Trở về",switchCam="Đổi camera",capture="Chụp",pleaseKeepYourHeadStraight="Xin hãy giữ thẳng đầu",pleaseKeepYourFaceStraight="Xin hãy giữ thẳng mặt",pleaseMoveYourFaceNaturally="Xin hãy di chuyển khuôn mặt tự nhiên",record="Quay",holdStill="Giữ vững",previewVideo="Xem video",recapture="Chụp lại",processing="Đang xử lý",details="Chi tiết",fraudCheck="Kiểm tra gian lận",close="Đóng",pleaseTakePhotoOfBothSides="Vui lòng chụp ảnh giấy tờ để xác thực thông tin của bạn",invalidImageIf="Ảnh không hợp lệ nếu",captureSelectImage="Chụp ảnh",uploadSelectImage="Chọn ảnh",tooSmall="Quá bé",missingDetails="Thiếu chi tiết",blurry="Không rõ nét",pleaseKeepDocumentsInTheCaptureArea="Xin hãy giữ giấy tờ ở vùng chụp",takeASelfie="Chụp ảnh chân dung",selfieAniWarning="Giữ khuôn mặt rõ nét bên trong khung hình",seconds=" giây",recording="Thu video",headStraight="Hãy giữ thẳng đầu",faceStraight="Hãy giữ thẳng mặt",noFaceDetected="Không tìm thấy khuôn mặt",recordVideoOfFace="Quay video khuôn mặt",pleaseKeepYourFaceInTheRecordingArea="Xin hãy giữ khuôn mặt trong vùng quay",ocrInformation="Thông tin trích xuất",thereWasError="Đã có lỗi xảy ra. Xin hãy thử lại",livenessLimitExceeded="Đã hết số lần quay liveness",continueTxt="Tiếp theo",yourSelfie="Ảnh của bạn",idealPose="Ảnh minh họa",cancel="Thoát",initializingPleaseWait="Khởi động SDK. Vui lòng chờ",fileSizeCannotBeExceeded="Kích cỡ tệp không được quá",pleaseUploadDocuments="Tải ảnh giấy tờ lên",clickHereToUpload="Nhấn vào đây để tải ảnh lên",version$8="Phiên bản",stepOcr="Ocr",stepSelfie="Selfie",stepReview="Review",vi$1={pleaseSelectTypeOfEkyc:pleaseSelectTypeOfEkyc,idCard:idCard,passport:passport,driverLicense:driverLicense,frontside:frontside,backside:backside,selfie:selfie,ocrWarn:ocrWarn,takeVideoIn3s:takeVideoIn3s,uploadPhoto:uploadPhoto,capturePhoto:capturePhoto,next:next,back:back,switchCam:switchCam,capture:capture,pleaseKeepYourHeadStraight:pleaseKeepYourHeadStraight,pleaseKeepYourFaceStraight:pleaseKeepYourFaceStraight,pleaseMoveYourFaceNaturally:pleaseMoveYourFaceNaturally,record:record,holdStill:holdStill,previewVideo:previewVideo,recapture:recapture,processing:processing,details:details,fraudCheck:fraudCheck,close:close,pleaseTakePhotoOfBothSides:pleaseTakePhotoOfBothSides,invalidImageIf:invalidImageIf,captureSelectImage:captureSelectImage,uploadSelectImage:uploadSelectImage,tooSmall:tooSmall,missingDetails:missingDetails,blurry:blurry,pleaseKeepDocumentsInTheCaptureArea:pleaseKeepDocumentsInTheCaptureArea,takeASelfie:takeASelfie,selfieAniWarning:selfieAniWarning,seconds:seconds,recording:recording,headStraight:headStraight,faceStraight:faceStraight,noFaceDetected:noFaceDetected,recordVideoOfFace:recordVideoOfFace,pleaseKeepYourFaceInTheRecordingArea:pleaseKeepYourFaceInTheRecordingArea,ocrInformation:ocrInformation,thereWasError:thereWasError,livenessLimitExceeded:livenessLimitExceeded,continueTxt:continueTxt,yourSelfie:yourSelfie,idealPose:idealPose,cancel:cancel,initializingPleaseWait:initializingPleaseWait,fileSizeCannotBeExceeded:fileSizeCannotBeExceeded,pleaseUploadDocuments:pleaseUploadDocuments,clickHereToUpload:clickHereToUpload,version:version$8,stepOcr:stepOcr,stepSelfie:stepSelfie,stepReview:stepReview},viJson=Object.freeze(Object.defineProperty({__proto__:null,back:back,backside:backside,blurry:blurry,cancel:cancel,capture:capture,capturePhoto:capturePhoto,captureSelectImage:captureSelectImage,clickHereToUpload:clickHereToUpload,close:close,continueTxt:continueTxt,default:vi$1,details:details,driverLicense:driverLicense,faceStraight:faceStraight,fileSizeCannotBeExceeded:fileSizeCannotBeExceeded,fraudCheck:fraudCheck,frontside:frontside,headStraight:headStraight,holdStill:holdStill,idCard:idCard,idealPose:idealPose,initializingPleaseWait:initializingPleaseWait,invalidImageIf:invalidImageIf,livenessLimitExceeded:livenessLimitExceeded,missingDetails:missingDetails,next:next,noFaceDetected:noFaceDetected,ocrInformation:ocrInformation,ocrWarn:ocrWarn,passport:passport,pleaseKeepDocumentsInTheCaptureArea:pleaseKeepDocumentsInTheCaptureArea,pleaseKeepYourFaceInTheRecordingArea:pleaseKeepYourFaceInTheRecordingArea,pleaseKeepYourFaceStraight:pleaseKeepYourFaceStraight,pleaseKeepYourHeadStraight:pleaseKeepYourHeadStraight,pleaseMoveYourFaceNaturally:pleaseMoveYourFaceNaturally,pleaseSelectTypeOfEkyc:pleaseSelectTypeOfEkyc,pleaseTakePhotoOfBothSides:pleaseTakePhotoOfBothSides,pleaseUploadDocuments:pleaseUploadDocuments,previewVideo:previewVideo,processing:processing,recapture:recapture,record:record,recordVideoOfFace:recordVideoOfFace,recording:recording,seconds:seconds,selfie:selfie,selfieAniWarning:selfieAniWarning,stepOcr:stepOcr,stepReview:stepReview,stepSelfie:stepSelfie,switchCam:switchCam,takeASelfie:takeASelfie,takeVideoIn3s:takeVideoIn3s,thereWasError:thereWasError,tooSmall:tooSmall,uploadPhoto:uploadPhoto,uploadSelectImage:uploadSelectImage,version:version$8,yourSelfie:yourSelfie},Symbol.toStringTag,{value:"Module"}));function i18n(e){switch(window.ekyc.config.lang){case"en":return lodashExports.get(enJson,e)??e;case"vi":return lodashExports.get(viJson,e)??e}}const index="";class Utils{static onDisconnectDom(e,t){if(!e)return;new MutationObserver((function(e){e.forEach((function(e){"childList"===e.type&&e.removedNodes.length>0&&t&&t()}))})).observe(e.parentElement,{childList:!0})}static handleStopStream(e){e&&(e.getVideoTracks&&e.getAudioTracks?(e.getVideoTracks().map((function(t){e.removeTrack(t),t.stop()})),e.getAudioTracks().map((function(t){e.removeTrack(t),t.stop()}))):e.stop&&e.stop())}static load(e,t,n){Utils.jq(e).html(t),setTimeout((()=>{n()}),10)}static jq(e){return{toggleClass:t=>{e.classList.contains(t)?e.classList.remove(t):e.classList.add(t)},addClass:t=>{e.classList.add(t)},removeClass:t=>{e.classList.remove(t)},html:t=>{e.innerHTML=t}}}}function initLoadingText(){const e=document.getElementById("fci-loading-text");e&&(e.innerText=i18n("processing"))}function initLoading(){initLoadingText()}function loadingHtml(){return'\n        <div class="fci-loading-ring-container">\n            <div class="fci-loading-ring">\n                <div></div>\n                <div></div>\n                <div></div>\n                <div></div>\n            </div>\n            <div id="fci-loading-text"></div>\n        </div>\n    '}function loadLoading(e){Utils.load(e,loadingHtml(),initLoading)}const STEPS=[{label:"stepOcr",checkActive:e=>e<=4},{label:"stepSelfie",checkActive:e=>e>4&&e<7},{label:"stepReview",checkActive:e=>e>=7}];function setVisActionStep(e){const t=document.getElementById("fci-action-step-container");t&&(t.style.display=e?"block":"none")}function actionStepHtml(){const e=STEPS.findIndex((e=>e.checkActive(window.ekyc.stepIndex)));return`\n        <ul class="fci-action-step">\n            ${STEPS.map(((t,n)=>`\n                    <li class="${e>=n&&"fci-action-step-active"} ${e-1>=n&&"fci-action-step-active-line"}">\n                        ${i18n(t.label)}\n                    </li>\n                `)).join("")}\n        </ul>\n    `}function loadActionStep(e){e.innerHTML=actionStepHtml()}var lottie$1={exports:{}};(function(module,exports){var factory2;"undefined"!=typeof navigator&&(factory2=function(){var svgNS="http://www.w3.org/2000/svg",locationHref="",_useWebWorker=!1,initialDefaultFrame=-999999,setWebWorker=function(e){_useWebWorker=!!e},getWebWorker=function(){return _useWebWorker},setLocationHref=function(e){locationHref=e},getLocationHref=function(){return locationHref};function createTag(e){return document.createElement(e)}function extendPrototype(e,t){var n,r,a=e.length;for(n=0;n<a;n+=1)for(var i in r=e[n].prototype)Object.prototype.hasOwnProperty.call(r,i)&&(t.prototype[i]=r[i])}function getDescriptor(e,t){return Object.getOwnPropertyDescriptor(e,t)}function createProxyFunction(e){function t(){}return t.prototype=e,t}var audioControllerFactory=function(){function e(e){this.audios=[],this.audioFactory=e,this._volume=1,this._isMuted=!1}return e.prototype={addAudio:function(e){this.audios.push(e)},pause:function(){var e,t=this.audios.length;for(e=0;e<t;e+=1)this.audios[e].pause()},resume:function(){var e,t=this.audios.length;for(e=0;e<t;e+=1)this.audios[e].resume()},setRate:function(e){var t,n=this.audios.length;for(t=0;t<n;t+=1)this.audios[t].setRate(e)},createAudio:function(e){return this.audioFactory?this.audioFactory(e):window.Howl?new window.Howl({src:[e]}):{isPlaying:!1,play:function(){this.isPlaying=!0},seek:function(){this.isPlaying=!1},playing:function(){},rate:function(){},setVolume:function(){}}},setAudioFactory:function(e){this.audioFactory=e},setVolume:function(e){this._volume=e,this._updateVolume()},mute:function(){this._isMuted=!0,this._updateVolume()},unmute:function(){this._isMuted=!1,this._updateVolume()},getVolume:function(){return this._volume},_updateVolume:function(){var e,t=this.audios.length;for(e=0;e<t;e+=1)this.audios[e].volume(this._volume*(this._isMuted?0:1))}},function(){return new e}}(),createTypedArray=function(){function e(e,t){var n,r=0,a=[];switch(e){case"int16":case"uint8c":n=1;break;default:n=1.1}for(r=0;r<t;r+=1)a.push(n);return a}return"function"==typeof Uint8ClampedArray&&"function"==typeof Float32Array?function(t,n){return"float32"===t?new Float32Array(n):"int16"===t?new Int16Array(n):"uint8c"===t?new Uint8ClampedArray(n):e(t,n)}:e}();function createSizedArray(e){return Array.apply(null,{length:e})}function _typeof$6(e){return(_typeof$6="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var subframeEnabled=!0,expressionsPlugin=null,expressionsInterfaces=null,idPrefix$1="",isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),bmPow=Math.pow,bmSqrt=Math.sqrt,bmFloor=Math.floor,bmMax=Math.max,bmMin=Math.min,BMMath={};!function(){var e,t=["abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","cbrt","expm1","clz32","cos","cosh","exp","floor","fround","hypot","imul","log","log1p","log2","log10","max","min","pow","random","round","sign","sin","sinh","sqrt","tan","tanh","trunc","E","LN10","LN2","LOG10E","LOG2E","PI","SQRT1_2","SQRT2"],n=t.length;for(e=0;e<n;e+=1)BMMath[t[e]]=Math[t[e]]}(),BMMath.random=Math.random,BMMath.abs=function(e){if("object"===_typeof$6(e)&&e.length){var t,n=createSizedArray(e.length),r=e.length;for(t=0;t<r;t+=1)n[t]=Math.abs(e[t]);return n}return Math.abs(e)};var defaultCurveSegments=150,degToRads=Math.PI/180,roundCorner=.5519;function styleDiv(e){e.style.position="absolute",e.style.top=0,e.style.left=0,e.style.display="block",e.style.transformOrigin="0 0",e.style.webkitTransformOrigin="0 0",e.style.backfaceVisibility="visible",e.style.webkitBackfaceVisibility="visible",e.style.transformStyle="preserve-3d",e.style.webkitTransformStyle="preserve-3d",e.style.mozTransformStyle="preserve-3d"}function BMEnterFrameEvent(e,t,n,r){this.type=e,this.currentTime=t,this.totalTime=n,this.direction=r<0?-1:1}function BMCompleteEvent(e,t){this.type=e,this.direction=t<0?-1:1}function BMCompleteLoopEvent(e,t,n,r){this.type=e,this.currentLoop=n,this.totalLoops=t,this.direction=r<0?-1:1}function BMSegmentStartEvent(e,t,n){this.type=e,this.firstFrame=t,this.totalFrames=n}function BMDestroyEvent(e,t){this.type=e,this.target=t}function BMRenderFrameErrorEvent(e,t){this.type="renderFrameError",this.nativeError=e,this.currentTime=t}function BMConfigErrorEvent(e){this.type="configError",this.nativeError=e}var createElementID=(_count=0,function(){return idPrefix$1+"__lottie_element_"+(_count+=1)}),_count;function HSVtoRGB(e,t,n){var r,a,i,s,o,l,u,c;switch(l=n*(1-t),u=n*(1-(o=6*e-(s=Math.floor(6*e)))*t),c=n*(1-(1-o)*t),s%6){case 0:r=n,a=c,i=l;break;case 1:r=u,a=n,i=l;break;case 2:r=l,a=n,i=c;break;case 3:r=l,a=u,i=n;break;case 4:r=c,a=l,i=n;break;case 5:r=n,a=l,i=u}return[r,a,i]}function RGBtoHSV(e,t,n){var r,a=Math.max(e,t,n),i=Math.min(e,t,n),s=a-i,o=0===a?0:s/a,l=a/255;switch(a){case i:r=0;break;case e:r=t-n+s*(t<n?6:0),r/=6*s;break;case t:r=n-e+2*s,r/=6*s;break;case n:r=e-t+4*s,r/=6*s}return[r,o,l]}function addSaturationToRGB(e,t){var n=RGBtoHSV(255*e[0],255*e[1],255*e[2]);return n[1]+=t,n[1]>1?n[1]=1:n[1]<=0&&(n[1]=0),HSVtoRGB(n[0],n[1],n[2])}function addBrightnessToRGB(e,t){var n=RGBtoHSV(255*e[0],255*e[1],255*e[2]);return n[2]+=t,n[2]>1?n[2]=1:n[2]<0&&(n[2]=0),HSVtoRGB(n[0],n[1],n[2])}function addHueToRGB(e,t){var n=RGBtoHSV(255*e[0],255*e[1],255*e[2]);return n[0]+=t/360,n[0]>1?n[0]-=1:n[0]<0&&(n[0]+=1),HSVtoRGB(n[0],n[1],n[2])}var rgbToHex=function(){var e,t,n=[];for(e=0;e<256;e+=1)t=e.toString(16),n[e]=1===t.length?"0"+t:t;return function(e,t,r){return e<0&&(e=0),t<0&&(t=0),r<0&&(r=0),"#"+n[e]+n[t]+n[r]}}(),setSubframeEnabled=function(e){subframeEnabled=!!e},getSubframeEnabled=function(){return subframeEnabled},setExpressionsPlugin=function(e){expressionsPlugin=e},getExpressionsPlugin=function(){return expressionsPlugin},setExpressionInterfaces=function(e){expressionsInterfaces=e},getExpressionInterfaces=function(){return expressionsInterfaces},setDefaultCurveSegments=function(e){defaultCurveSegments=e},getDefaultCurveSegments=function(){return defaultCurveSegments},setIdPrefix=function(e){idPrefix$1=e};function createNS(e){return document.createElementNS(svgNS,e)}function _typeof$5(e){return(_typeof$5="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var dataManager=function(){var e,t,n=1,r=[],a={onmessage:function(){},postMessage:function(t){e({data:t})}},i={postMessage:function(e){a.onmessage({data:e})}};function s(){t||((t=function(t){if(window.Worker&&window.Blob&&getWebWorker()){var n=new Blob(["var _workerSelf = self; self.onmessage = ",t.toString()],{type:"text/javascript"}),r=URL.createObjectURL(n);return new Worker(r)}return e=t,a}((function(e){if(i.dataManager||(i.dataManager=function(){function e(a,i){var s,o,l,u,c,d,p=a.length;for(o=0;o<p;o+=1)if("ks"in(s=a[o])&&!s.completed){if(s.completed=!0,s.hasMask){var f=s.masksProperties;for(u=f.length,l=0;l<u;l+=1)if(f[l].pt.k.i)r(f[l].pt.k);else for(d=f[l].pt.k.length,c=0;c<d;c+=1)f[l].pt.k[c].s&&r(f[l].pt.k[c].s[0]),f[l].pt.k[c].e&&r(f[l].pt.k[c].e[0])}0===s.ty?(s.layers=t(s.refId,i),e(s.layers,i)):4===s.ty?n(s.shapes):5===s.ty&&h(s)}}function t(e,t){var n=function(e,t){for(var n=0,r=t.length;n<r;){if(t[n].id===e)return t[n];n+=1}return null}(e,t);return n?n.layers.__used?JSON.parse(JSON.stringify(n.layers)):(n.layers.__used=!0,n.layers):null}function n(e){var t,a,i;for(t=e.length-1;t>=0;t-=1)if("sh"===e[t].ty)if(e[t].ks.k.i)r(e[t].ks.k);else for(i=e[t].ks.k.length,a=0;a<i;a+=1)e[t].ks.k[a].s&&r(e[t].ks.k[a].s[0]),e[t].ks.k[a].e&&r(e[t].ks.k[a].e[0]);else"gr"===e[t].ty&&n(e[t].it)}function r(e){var t,n=e.i.length;for(t=0;t<n;t+=1)e.i[t][0]+=e.v[t][0],e.i[t][1]+=e.v[t][1],e.o[t][0]+=e.v[t][0],e.o[t][1]+=e.v[t][1]}function a(e,t){var n=t?t.split("."):[100,100,100];return e[0]>n[0]||!(n[0]>e[0])&&(e[1]>n[1]||!(n[1]>e[1])&&(e[2]>n[2]||!(n[2]>e[2])&&null))}var i,s=function(){var e=[4,4,14];function t(e){var t,n,r,a=e.length;for(t=0;t<a;t+=1)5===e[t].ty&&(r=void 0,r=(n=e[t]).t.d,n.t.d={k:[{s:r,t:0}]})}return function(n){if(a(e,n.v)&&(t(n.layers),n.assets)){var r,i=n.assets.length;for(r=0;r<i;r+=1)n.assets[r].layers&&t(n.assets[r].layers)}}}(),o=(i=[4,7,99],function(e){if(e.chars&&!a(i,e.v)){var t,r=e.chars.length;for(t=0;t<r;t+=1){var s=e.chars[t];s.data&&s.data.shapes&&(n(s.data.shapes),s.data.ip=0,s.data.op=99999,s.data.st=0,s.data.sr=1,s.data.ks={p:{k:[0,0],a:0},s:{k:[100,100],a:0},a:{k:[0,0],a:0},r:{k:0,a:0},o:{k:100,a:0}},e.chars[t].t||(s.data.shapes.push({ty:"no"}),s.data.shapes[0].it.push({p:{k:[0,0],a:0},s:{k:[100,100],a:0},a:{k:[0,0],a:0},r:{k:0,a:0},o:{k:100,a:0},sk:{k:0,a:0},sa:{k:0,a:0},ty:"tr"})))}}}),l=function(){var e=[5,7,15];function t(e){var t,n,r=e.length;for(t=0;t<r;t+=1)5===e[t].ty&&(n=void 0,"number"==typeof(n=e[t].t.p).a&&(n.a={a:0,k:n.a}),"number"==typeof n.p&&(n.p={a:0,k:n.p}),"number"==typeof n.r&&(n.r={a:0,k:n.r}))}return function(n){if(a(e,n.v)&&(t(n.layers),n.assets)){var r,i=n.assets.length;for(r=0;r<i;r+=1)n.assets[r].layers&&t(n.assets[r].layers)}}}(),u=function(){var e=[4,1,9];function t(e){var n,r,a,i=e.length;for(n=0;n<i;n+=1)if("gr"===e[n].ty)t(e[n].it);else if("fl"===e[n].ty||"st"===e[n].ty)if(e[n].c.k&&e[n].c.k[0].i)for(a=e[n].c.k.length,r=0;r<a;r+=1)e[n].c.k[r].s&&(e[n].c.k[r].s[0]/=255,e[n].c.k[r].s[1]/=255,e[n].c.k[r].s[2]/=255,e[n].c.k[r].s[3]/=255),e[n].c.k[r].e&&(e[n].c.k[r].e[0]/=255,e[n].c.k[r].e[1]/=255,e[n].c.k[r].e[2]/=255,e[n].c.k[r].e[3]/=255);else e[n].c.k[0]/=255,e[n].c.k[1]/=255,e[n].c.k[2]/=255,e[n].c.k[3]/=255}function n(e){var n,r=e.length;for(n=0;n<r;n+=1)4===e[n].ty&&t(e[n].shapes)}return function(t){if(a(e,t.v)&&(n(t.layers),t.assets)){var r,i=t.assets.length;for(r=0;r<i;r+=1)t.assets[r].layers&&n(t.assets[r].layers)}}}(),c=function(){var e=[4,4,18];function t(e){var n,r,a;for(n=e.length-1;n>=0;n-=1)if("sh"===e[n].ty)if(e[n].ks.k.i)e[n].ks.k.c=e[n].closed;else for(a=e[n].ks.k.length,r=0;r<a;r+=1)e[n].ks.k[r].s&&(e[n].ks.k[r].s[0].c=e[n].closed),e[n].ks.k[r].e&&(e[n].ks.k[r].e[0].c=e[n].closed);else"gr"===e[n].ty&&t(e[n].it)}function n(e){var n,r,a,i,s,o,l=e.length;for(r=0;r<l;r+=1){if((n=e[r]).hasMask){var u=n.masksProperties;for(i=u.length,a=0;a<i;a+=1)if(u[a].pt.k.i)u[a].pt.k.c=u[a].cl;else for(o=u[a].pt.k.length,s=0;s<o;s+=1)u[a].pt.k[s].s&&(u[a].pt.k[s].s[0].c=u[a].cl),u[a].pt.k[s].e&&(u[a].pt.k[s].e[0].c=u[a].cl)}4===n.ty&&t(n.shapes)}}return function(t){if(a(e,t.v)&&(n(t.layers),t.assets)){var r,i=t.assets.length;for(r=0;r<i;r+=1)t.assets[r].layers&&n(t.assets[r].layers)}}}();function h(e){0===e.t.a.length&&e.t.p}var d={completeData:function(n){n.__complete||(u(n),s(n),o(n),l(n),c(n),e(n.layers,n.assets),function(n,r){if(n){var a=0,i=n.length;for(a=0;a<i;a+=1)1===n[a].t&&(n[a].data.layers=t(n[a].data.refId,r),e(n[a].data.layers,r))}}(n.chars,n.assets),n.__complete=!0)}};return d.checkColors=u,d.checkChars=o,d.checkPathProperties=l,d.checkShapes=c,d.completeLayers=e,d}()),i.assetLoader||(i.assetLoader=function(){function e(e){var t=e.getResponseHeader("content-type");return t&&"json"===e.responseType&&-1!==t.indexOf("json")||e.response&&"object"===_typeof$5(e.response)?e.response:e.response&&"string"==typeof e.response?JSON.parse(e.response):e.responseText?JSON.parse(e.responseText):null}return{load:function(t,n,r,a){var i,s=new XMLHttpRequest;try{s.responseType="json"}catch(o){}s.onreadystatechange=function(){if(4===s.readyState)if(200===s.status)i=e(s),r(i);else try{i=e(s),r(i)}catch(o){a&&a(o)}};try{s.open(["G","E","T"].join(""),t,!0)}catch(l){s.open(["G","E","T"].join(""),n+"/"+t,!0)}s.send()}}}()),"loadAnimation"===e.data.type)i.assetLoader.load(e.data.path,e.data.fullPath,(function(t){i.dataManager.completeData(t),i.postMessage({id:e.data.id,payload:t,status:"success"})}),(function(){i.postMessage({id:e.data.id,status:"error"})}));else if("complete"===e.data.type){var t=e.data.animation;i.dataManager.completeData(t),i.postMessage({id:e.data.id,payload:t,status:"success"})}else"loadData"===e.data.type&&i.assetLoader.load(e.data.path,e.data.fullPath,(function(t){i.postMessage({id:e.data.id,payload:t,status:"success"})}),(function(){i.postMessage({id:e.data.id,status:"error"})}))}))).onmessage=function(e){var t=e.data,n=t.id,a=r[n];r[n]=null,"success"===t.status?a.onComplete(t.payload):a.onError&&a.onError()})}function o(e,t){var a="processId_"+(n+=1);return r[a]={onComplete:e,onError:t},a}return{loadAnimation:function(e,n,r){s();var a=o(n,r);t.postMessage({type:"loadAnimation",path:e,fullPath:window.location.origin+window.location.pathname,id:a})},loadData:function(e,n,r){s();var a=o(n,r);t.postMessage({type:"loadData",path:e,fullPath:window.location.origin+window.location.pathname,id:a})},completeAnimation:function(e,n,r){s();var a=o(n,r);t.postMessage({type:"complete",animation:e,id:a})}}}(),ImagePreloader=function(){var e=function(){var e=createTag("canvas");e.width=1,e.height=1;var t=e.getContext("2d");return t.fillStyle="rgba(0,0,0,0)",t.fillRect(0,0,1,1),e}();function t(){this.loadedAssets+=1,this.loadedAssets===this.totalImages&&this.loadedFootagesCount===this.totalFootages&&this.imagesLoadedCb&&this.imagesLoadedCb(null)}function n(){this.loadedFootagesCount+=1,this.loadedAssets===this.totalImages&&this.loadedFootagesCount===this.totalFootages&&this.imagesLoadedCb&&this.imagesLoadedCb(null)}function r(e,t,n){var r="";if(e.e)r=e.p;else if(t){var a=e.p;-1!==a.indexOf("images/")&&(a=a.split("/")[1]),r=t+a}else r=n,r+=e.u?e.u:"",r+=e.p;return r}function a(e){var t=0,n=setInterval(function(){(e.getBBox().width||t>500)&&(this._imageLoaded(),clearInterval(n)),t+=1}.bind(this),50)}function i(e){var t={assetData:e},n=r(e,this.assetsPath,this.path);return dataManager.loadData(n,function(e){t.img=e,this._footageLoaded()}.bind(this),function(){t.img={},this._footageLoaded()}.bind(this)),t}function s(){this._imageLoaded=t.bind(this),this._footageLoaded=n.bind(this),this.testImageLoaded=a.bind(this),this.createFootageData=i.bind(this),this.assetsPath="",this.path="",this.totalImages=0,this.totalFootages=0,this.loadedAssets=0,this.loadedFootagesCount=0,this.imagesLoadedCb=null,this.images=[]}return s.prototype={loadAssets:function(e,t){var n;this.imagesLoadedCb=t;var r=e.length;for(n=0;n<r;n+=1)e[n].layers||(e[n].t&&"seq"!==e[n].t?3===e[n].t&&(this.totalFootages+=1,this.images.push(this.createFootageData(e[n]))):(this.totalImages+=1,this.images.push(this._createImageData(e[n]))))},setAssetsPath:function(e){this.assetsPath=e||""},setPath:function(e){this.path=e||""},loadedImages:function(){return this.totalImages===this.loadedAssets},loadedFootages:function(){return this.totalFootages===this.loadedFootagesCount},destroy:function(){this.imagesLoadedCb=null,this.images.length=0},getAsset:function(e){for(var t=0,n=this.images.length;t<n;){if(this.images[t].assetData===e)return this.images[t].img;t+=1}return null},createImgData:function(t){var n=r(t,this.assetsPath,this.path),a=createTag("img");a.crossOrigin="anonymous",a.addEventListener("load",this._imageLoaded,!1),a.addEventListener("error",function(){i.img=e,this._imageLoaded()}.bind(this),!1),a.src=n;var i={img:a,assetData:t};return i},createImageData:function(t){var n=r(t,this.assetsPath,this.path),a=createNS("image");isSafari?this.testImageLoaded(a):a.addEventListener("load",this._imageLoaded,!1),a.addEventListener("error",function(){i.img=e,this._imageLoaded()}.bind(this),!1),a.setAttributeNS("http://www.w3.org/1999/xlink","href",n),this._elementHelper.append?this._elementHelper.append(a):this._elementHelper.appendChild(a);var i={img:a,assetData:t};return i},imageLoaded:t,footageLoaded:n,setCacheType:function(e,t){"svg"===e?(this._elementHelper=t,this._createImageData=this.createImageData.bind(this)):this._createImageData=this.createImgData.bind(this)}},s}();function BaseEvent(){}BaseEvent.prototype={triggerEvent:function(e,t){if(this._cbs[e])for(var n=this._cbs[e],r=0;r<n.length;r+=1)n[r](t)},addEventListener:function(e,t){return this._cbs[e]||(this._cbs[e]=[]),this._cbs[e].push(t),function(){this.removeEventListener(e,t)}.bind(this)},removeEventListener:function(e,t){if(t){if(this._cbs[e]){for(var n=0,r=this._cbs[e].length;n<r;)this._cbs[e][n]===t&&(this._cbs[e].splice(n,1),n-=1,r-=1),n+=1;this._cbs[e].length||(this._cbs[e]=null)}}else this._cbs[e]=null}};var markerParser=function(){function e(e){for(var t,n=e.split("\r\n"),r={},a=0,i=0;i<n.length;i+=1)2===(t=n[i].split(":")).length&&(r[t[0]]=t[1].trim(),a+=1);if(0===a)throw new Error;return r}return function(t){for(var n=[],r=0;r<t.length;r+=1){var a=t[r],i={time:a.tm,duration:a.dr};try{i.payload=JSON.parse(t[r].cm)}catch(s){try{i.payload=e(t[r].cm)}catch(o){i.payload={name:t[r].cm}}}n.push(i)}return n}}(),ProjectInterface=function(){function e(e){this.compositions.push(e)}return function(){function t(e){for(var t=0,n=this.compositions.length;t<n;){if(this.compositions[t].data&&this.compositions[t].data.nm===e)return this.compositions[t].prepareFrame&&this.compositions[t].data.xt&&this.compositions[t].prepareFrame(this.currentFrame),this.compositions[t].compInterface;t+=1}return null}return t.compositions=[],t.currentFrame=0,t.registerComposition=e,t}}(),renderers={},registerRenderer=function(e,t){renderers[e]=t};function getRenderer(e){return renderers[e]}function getRegisteredRenderer(){if(renderers.canvas)return"canvas";for(var e in renderers)if(renderers[e])return e;return""}function _typeof$4(e){return(_typeof$4="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var AnimationItem=function(){this._cbs=[],this.name="",this.path="",this.isLoaded=!1,this.currentFrame=0,this.currentRawFrame=0,this.firstFrame=0,this.totalFrames=0,this.frameRate=0,this.frameMult=0,this.playSpeed=1,this.playDirection=1,this.playCount=0,this.animationData={},this.assets=[],this.isPaused=!0,this.autoplay=!1,this.loop=!0,this.renderer=null,this.animationID=createElementID(),this.assetsPath="",this.timeCompleted=0,this.segmentPos=0,this.isSubframeEnabled=getSubframeEnabled(),this.segments=[],this._idle=!0,this._completedLoop=!1,this.projectInterface=ProjectInterface(),this.imagePreloader=new ImagePreloader,this.audioController=audioControllerFactory(),this.markers=[],this.configAnimation=this.configAnimation.bind(this),this.onSetupError=this.onSetupError.bind(this),this.onSegmentComplete=this.onSegmentComplete.bind(this),this.drawnFrameEvent=new BMEnterFrameEvent("drawnFrame",0,0,0),this.expressionsPlugin=getExpressionsPlugin()};extendPrototype([BaseEvent],AnimationItem),AnimationItem.prototype.setParams=function(e){(e.wrapper||e.container)&&(this.wrapper=e.wrapper||e.container);var t="svg";e.animType?t=e.animType:e.renderer&&(t=e.renderer);var n=getRenderer(t);this.renderer=new n(this,e.rendererSettings),this.imagePreloader.setCacheType(t,this.renderer.globalData.defs),this.renderer.setProjectInterface(this.projectInterface),this.animType=t,""===e.loop||null===e.loop||void 0===e.loop||!0===e.loop?this.loop=!0:!1===e.loop?this.loop=!1:this.loop=parseInt(e.loop,10),this.autoplay=!("autoplay"in e)||e.autoplay,this.name=e.name?e.name:"",this.autoloadSegments=!Object.prototype.hasOwnProperty.call(e,"autoloadSegments")||e.autoloadSegments,this.assetsPath=e.assetsPath,this.initialSegment=e.initialSegment,e.audioFactory&&this.audioController.setAudioFactory(e.audioFactory),e.animationData?this.setupAnimation(e.animationData):e.path&&(-1!==e.path.lastIndexOf("\\")?this.path=e.path.substr(0,e.path.lastIndexOf("\\")+1):this.path=e.path.substr(0,e.path.lastIndexOf("/")+1),this.fileName=e.path.substr(e.path.lastIndexOf("/")+1),this.fileName=this.fileName.substr(0,this.fileName.lastIndexOf(".json")),dataManager.loadAnimation(e.path,this.configAnimation,this.onSetupError))},AnimationItem.prototype.onSetupError=function(){this.trigger("data_failed")},AnimationItem.prototype.setupAnimation=function(e){dataManager.completeAnimation(e,this.configAnimation)},AnimationItem.prototype.setData=function(e,t){t&&"object"!==_typeof$4(t)&&(t=JSON.parse(t));var n={wrapper:e,animationData:t},r=e.attributes;n.path=r.getNamedItem("data-animation-path")?r.getNamedItem("data-animation-path").value:r.getNamedItem("data-bm-path")?r.getNamedItem("data-bm-path").value:r.getNamedItem("bm-path")?r.getNamedItem("bm-path").value:"",n.animType=r.getNamedItem("data-anim-type")?r.getNamedItem("data-anim-type").value:r.getNamedItem("data-bm-type")?r.getNamedItem("data-bm-type").value:r.getNamedItem("bm-type")?r.getNamedItem("bm-type").value:r.getNamedItem("data-bm-renderer")?r.getNamedItem("data-bm-renderer").value:r.getNamedItem("bm-renderer")?r.getNamedItem("bm-renderer").value:getRegisteredRenderer()||"canvas";var a=r.getNamedItem("data-anim-loop")?r.getNamedItem("data-anim-loop").value:r.getNamedItem("data-bm-loop")?r.getNamedItem("data-bm-loop").value:r.getNamedItem("bm-loop")?r.getNamedItem("bm-loop").value:"";"false"===a?n.loop=!1:"true"===a?n.loop=!0:""!==a&&(n.loop=parseInt(a,10));var i=r.getNamedItem("data-anim-autoplay")?r.getNamedItem("data-anim-autoplay").value:r.getNamedItem("data-bm-autoplay")?r.getNamedItem("data-bm-autoplay").value:!r.getNamedItem("bm-autoplay")||r.getNamedItem("bm-autoplay").value;n.autoplay="false"!==i,n.name=r.getNamedItem("data-name")?r.getNamedItem("data-name").value:r.getNamedItem("data-bm-name")?r.getNamedItem("data-bm-name").value:r.getNamedItem("bm-name")?r.getNamedItem("bm-name").value:"","false"===(r.getNamedItem("data-anim-prerender")?r.getNamedItem("data-anim-prerender").value:r.getNamedItem("data-bm-prerender")?r.getNamedItem("data-bm-prerender").value:r.getNamedItem("bm-prerender")?r.getNamedItem("bm-prerender").value:"")&&(n.prerender=!1),n.path?this.setParams(n):this.trigger("destroy")},AnimationItem.prototype.includeLayers=function(e){e.op>this.animationData.op&&(this.animationData.op=e.op,this.totalFrames=Math.floor(e.op-this.animationData.ip));var t,n,r=this.animationData.layers,a=r.length,i=e.layers,s=i.length;for(n=0;n<s;n+=1)for(t=0;t<a;){if(r[t].id===i[n].id){r[t]=i[n];break}t+=1}if((e.chars||e.fonts)&&(this.renderer.globalData.fontManager.addChars(e.chars),this.renderer.globalData.fontManager.addFonts(e.fonts,this.renderer.globalData.defs)),e.assets)for(a=e.assets.length,t=0;t<a;t+=1)this.animationData.assets.push(e.assets[t]);this.animationData.__complete=!1,dataManager.completeAnimation(this.animationData,this.onSegmentComplete)},AnimationItem.prototype.onSegmentComplete=function(e){this.animationData=e;var t=getExpressionsPlugin();t&&t.initExpressions(this),this.loadNextSegment()},AnimationItem.prototype.loadNextSegment=function(){var e=this.animationData.segments;if(!e||0===e.length||!this.autoloadSegments)return this.trigger("data_ready"),void(this.timeCompleted=this.totalFrames);var t=e.shift();this.timeCompleted=t.time*this.frameRate;var n=this.path+this.fileName+"_"+this.segmentPos+".json";this.segmentPos+=1,dataManager.loadData(n,this.includeLayers.bind(this),function(){this.trigger("data_failed")}.bind(this))},AnimationItem.prototype.loadSegments=function(){this.animationData.segments||(this.timeCompleted=this.totalFrames),this.loadNextSegment()},AnimationItem.prototype.imagesLoaded=function(){this.trigger("loaded_images"),this.checkLoaded()},AnimationItem.prototype.preloadImages=function(){this.imagePreloader.setAssetsPath(this.assetsPath),this.imagePreloader.setPath(this.path),this.imagePreloader.loadAssets(this.animationData.assets,this.imagesLoaded.bind(this))},AnimationItem.prototype.configAnimation=function(e){if(this.renderer)try{this.animationData=e,this.initialSegment?(this.totalFrames=Math.floor(this.initialSegment[1]-this.initialSegment[0]),this.firstFrame=Math.round(this.initialSegment[0])):(this.totalFrames=Math.floor(this.animationData.op-this.animationData.ip),this.firstFrame=Math.round(this.animationData.ip)),this.renderer.configAnimation(e),e.assets||(e.assets=[]),this.assets=this.animationData.assets,this.frameRate=this.animationData.fr,this.frameMult=this.animationData.fr/1e3,this.renderer.searchExtraCompositions(e.assets),this.markers=markerParser(e.markers||[]),this.trigger("config_ready"),this.preloadImages(),this.loadSegments(),this.updaFrameModifier(),this.waitForFontsLoaded(),this.isPaused&&this.audioController.pause()}catch(t){this.triggerConfigError(t)}},AnimationItem.prototype.waitForFontsLoaded=function(){this.renderer&&(this.renderer.globalData.fontManager.isLoaded?this.checkLoaded():setTimeout(this.waitForFontsLoaded.bind(this),20))},AnimationItem.prototype.checkLoaded=function(){if(!this.isLoaded&&this.renderer.globalData.fontManager.isLoaded&&(this.imagePreloader.loadedImages()||"canvas"!==this.renderer.rendererType)&&this.imagePreloader.loadedFootages()){this.isLoaded=!0;var e=getExpressionsPlugin();e&&e.initExpressions(this),this.renderer.initItems(),setTimeout(function(){this.trigger("DOMLoaded")}.bind(this),0),this.gotoFrame(),this.autoplay&&this.play()}},AnimationItem.prototype.resize=function(e,t){var n="number"==typeof e?e:void 0,r="number"==typeof t?t:void 0;this.renderer.updateContainerSize(n,r)},AnimationItem.prototype.setSubframe=function(e){this.isSubframeEnabled=!!e},AnimationItem.prototype.gotoFrame=function(){this.currentFrame=this.isSubframeEnabled?this.currentRawFrame:~~this.currentRawFrame,this.timeCompleted!==this.totalFrames&&this.currentFrame>this.timeCompleted&&(this.currentFrame=this.timeCompleted),this.trigger("enterFrame"),this.renderFrame(),this.trigger("drawnFrame")},AnimationItem.prototype.renderFrame=function(){if(!1!==this.isLoaded&&this.renderer)try{this.expressionsPlugin&&this.expressionsPlugin.resetFrame(),this.renderer.renderFrame(this.currentFrame+this.firstFrame)}catch(e){this.triggerRenderFrameError(e)}},AnimationItem.prototype.play=function(e){e&&this.name!==e||!0===this.isPaused&&(this.isPaused=!1,this.trigger("_play"),this.audioController.resume(),this._idle&&(this._idle=!1,this.trigger("_active")))},AnimationItem.prototype.pause=function(e){e&&this.name!==e||!1===this.isPaused&&(this.isPaused=!0,this.trigger("_pause"),this._idle=!0,this.trigger("_idle"),this.audioController.pause())},AnimationItem.prototype.togglePause=function(e){e&&this.name!==e||(!0===this.isPaused?this.play():this.pause())},AnimationItem.prototype.stop=function(e){e&&this.name!==e||(this.pause(),this.playCount=0,this._completedLoop=!1,this.setCurrentRawFrameValue(0))},AnimationItem.prototype.getMarkerData=function(e){for(var t,n=0;n<this.markers.length;n+=1)if((t=this.markers[n]).payload&&t.payload.name===e)return t;return null},AnimationItem.prototype.goToAndStop=function(e,t,n){if(!n||this.name===n){var r=Number(e);if(isNaN(r)){var a=this.getMarkerData(e);a&&this.goToAndStop(a.time,!0)}else t?this.setCurrentRawFrameValue(e):this.setCurrentRawFrameValue(e*this.frameModifier);this.pause()}},AnimationItem.prototype.goToAndPlay=function(e,t,n){if(!n||this.name===n){var r=Number(e);if(isNaN(r)){var a=this.getMarkerData(e);a&&(a.duration?this.playSegments([a.time,a.time+a.duration],!0):this.goToAndStop(a.time,!0))}else this.goToAndStop(r,t,n);this.play()}},AnimationItem.prototype.advanceTime=function(e){if(!0!==this.isPaused&&!1!==this.isLoaded){var t=this.currentRawFrame+e*this.frameModifier,n=!1;t>=this.totalFrames-1&&this.frameModifier>0?this.loop&&this.playCount!==this.loop?t>=this.totalFrames?(this.playCount+=1,this.checkSegments(t%this.totalFrames)||(this.setCurrentRawFrameValue(t%this.totalFrames),this._completedLoop=!0,this.trigger("loopComplete"))):this.setCurrentRawFrameValue(t):this.checkSegments(t>this.totalFrames?t%this.totalFrames:0)||(n=!0,t=this.totalFrames-1):t<0?this.checkSegments(t%this.totalFrames)||(!this.loop||this.playCount--<=0&&!0!==this.loop?(n=!0,t=0):(this.setCurrentRawFrameValue(this.totalFrames+t%this.totalFrames),this._completedLoop?this.trigger("loopComplete"):this._completedLoop=!0)):this.setCurrentRawFrameValue(t),n&&(this.setCurrentRawFrameValue(t),this.pause(),this.trigger("complete"))}},AnimationItem.prototype.adjustSegment=function(e,t){this.playCount=0,e[1]<e[0]?(this.frameModifier>0&&(this.playSpeed<0?this.setSpeed(-this.playSpeed):this.setDirection(-1)),this.totalFrames=e[0]-e[1],this.timeCompleted=this.totalFrames,this.firstFrame=e[1],this.setCurrentRawFrameValue(this.totalFrames-.001-t)):e[1]>e[0]&&(this.frameModifier<0&&(this.playSpeed<0?this.setSpeed(-this.playSpeed):this.setDirection(1)),this.totalFrames=e[1]-e[0],this.timeCompleted=this.totalFrames,this.firstFrame=e[0],this.setCurrentRawFrameValue(.001+t)),this.trigger("segmentStart")},AnimationItem.prototype.setSegment=function(e,t){var n=-1;this.isPaused&&(this.currentRawFrame+this.firstFrame<e?n=e:this.currentRawFrame+this.firstFrame>t&&(n=t-e)),this.firstFrame=e,this.totalFrames=t-e,this.timeCompleted=this.totalFrames,-1!==n&&this.goToAndStop(n,!0)},AnimationItem.prototype.playSegments=function(e,t){if(t&&(this.segments.length=0),"object"===_typeof$4(e[0])){var n,r=e.length;for(n=0;n<r;n+=1)this.segments.push(e[n])}else this.segments.push(e);this.segments.length&&t&&this.adjustSegment(this.segments.shift(),0),this.isPaused&&this.play()},AnimationItem.prototype.resetSegments=function(e){this.segments.length=0,this.segments.push([this.animationData.ip,this.animationData.op]),e&&this.checkSegments(0)},AnimationItem.prototype.checkSegments=function(e){return!!this.segments.length&&(this.adjustSegment(this.segments.shift(),e),!0)},AnimationItem.prototype.destroy=function(e){e&&this.name!==e||!this.renderer||(this.renderer.destroy(),this.imagePreloader.destroy(),this.trigger("destroy"),this._cbs=null,this.onEnterFrame=null,this.onLoopComplete=null,this.onComplete=null,this.onSegmentStart=null,this.onDestroy=null,this.renderer=null,this.expressionsPlugin=null,this.imagePreloader=null,this.projectInterface=null)},AnimationItem.prototype.setCurrentRawFrameValue=function(e){this.currentRawFrame=e,this.gotoFrame()},AnimationItem.prototype.setSpeed=function(e){this.playSpeed=e,this.updaFrameModifier()},AnimationItem.prototype.setDirection=function(e){this.playDirection=e<0?-1:1,this.updaFrameModifier()},AnimationItem.prototype.setLoop=function(e){this.loop=e},AnimationItem.prototype.setVolume=function(e,t){t&&this.name!==t||this.audioController.setVolume(e)},AnimationItem.prototype.getVolume=function(){return this.audioController.getVolume()},AnimationItem.prototype.mute=function(e){e&&this.name!==e||this.audioController.mute()},AnimationItem.prototype.unmute=function(e){e&&this.name!==e||this.audioController.unmute()},AnimationItem.prototype.updaFrameModifier=function(){this.frameModifier=this.frameMult*this.playSpeed*this.playDirection,this.audioController.setRate(this.playSpeed*this.playDirection)},AnimationItem.prototype.getPath=function(){return this.path},AnimationItem.prototype.getAssetsPath=function(e){var t="";if(e.e)t=e.p;else if(this.assetsPath){var n=e.p;-1!==n.indexOf("images/")&&(n=n.split("/")[1]),t=this.assetsPath+n}else t=this.path,t+=e.u?e.u:"",t+=e.p;return t},AnimationItem.prototype.getAssetData=function(e){for(var t=0,n=this.assets.length;t<n;){if(e===this.assets[t].id)return this.assets[t];t+=1}return null},AnimationItem.prototype.hide=function(){this.renderer.hide()},AnimationItem.prototype.show=function(){this.renderer.show()},AnimationItem.prototype.getDuration=function(e){return e?this.totalFrames:this.totalFrames/this.frameRate},AnimationItem.prototype.updateDocumentData=function(e,t,n){try{this.renderer.getElementByPath(e).updateDocumentData(t,n)}catch(r){}},AnimationItem.prototype.trigger=function(e){if(this._cbs&&this._cbs[e])switch(e){case"enterFrame":this.triggerEvent(e,new BMEnterFrameEvent(e,this.currentFrame,this.totalFrames,this.frameModifier));break;case"drawnFrame":this.drawnFrameEvent.currentTime=this.currentFrame,this.drawnFrameEvent.totalTime=this.totalFrames,this.drawnFrameEvent.direction=this.frameModifier,this.triggerEvent(e,this.drawnFrameEvent);break;case"loopComplete":this.triggerEvent(e,new BMCompleteLoopEvent(e,this.loop,this.playCount,this.frameMult));break;case"complete":this.triggerEvent(e,new BMCompleteEvent(e,this.frameMult));break;case"segmentStart":this.triggerEvent(e,new BMSegmentStartEvent(e,this.firstFrame,this.totalFrames));break;case"destroy":this.triggerEvent(e,new BMDestroyEvent(e,this));break;default:this.triggerEvent(e)}"enterFrame"===e&&this.onEnterFrame&&this.onEnterFrame.call(this,new BMEnterFrameEvent(e,this.currentFrame,this.totalFrames,this.frameMult)),"loopComplete"===e&&this.onLoopComplete&&this.onLoopComplete.call(this,new BMCompleteLoopEvent(e,this.loop,this.playCount,this.frameMult)),"complete"===e&&this.onComplete&&this.onComplete.call(this,new BMCompleteEvent(e,this.frameMult)),"segmentStart"===e&&this.onSegmentStart&&this.onSegmentStart.call(this,new BMSegmentStartEvent(e,this.firstFrame,this.totalFrames)),"destroy"===e&&this.onDestroy&&this.onDestroy.call(this,new BMDestroyEvent(e,this))},AnimationItem.prototype.triggerRenderFrameError=function(e){var t=new BMRenderFrameErrorEvent(e,this.currentFrame);this.triggerEvent("error",t),this.onError&&this.onError.call(this,t)},AnimationItem.prototype.triggerConfigError=function(e){var t=new BMConfigErrorEvent(e,this.currentFrame);this.triggerEvent("error",t),this.onError&&this.onError.call(this,t)};var animationManager=function(){var e={},t=[],n=0,r=0,a=0,i=!0,s=!1;function o(e){for(var n=0,a=e.target;n<r;)t[n].animation===a&&(t.splice(n,1),n-=1,r-=1,a.isPaused||c()),n+=1}function l(e,n){if(!e)return null;for(var a=0;a<r;){if(t[a].elem===e&&null!==t[a].elem)return t[a].animation;a+=1}var i=new AnimationItem;return h(i,e),i.setData(e,n),i}function u(){a+=1,f()}function c(){a-=1}function h(e,n){e.addEventListener("destroy",o),e.addEventListener("_active",u),e.addEventListener("_idle",c),t.push({elem:n,animation:e}),r+=1}function d(e){var o,l=e-n;for(o=0;o<r;o+=1)t[o].animation.advanceTime(l);n=e,a&&!s?window.requestAnimationFrame(d):i=!0}function p(e){n=e,window.requestAnimationFrame(d)}function f(){!s&&a&&i&&(window.requestAnimationFrame(p),i=!1)}return e.registerAnimation=l,e.loadAnimation=function(e){var t=new AnimationItem;return h(t,null),t.setParams(e),t},e.setSpeed=function(e,n){var a;for(a=0;a<r;a+=1)t[a].animation.setSpeed(e,n)},e.setDirection=function(e,n){var a;for(a=0;a<r;a+=1)t[a].animation.setDirection(e,n)},e.play=function(e){var n;for(n=0;n<r;n+=1)t[n].animation.play(e)},e.pause=function(e){var n;for(n=0;n<r;n+=1)t[n].animation.pause(e)},e.stop=function(e){var n;for(n=0;n<r;n+=1)t[n].animation.stop(e)},e.togglePause=function(e){var n;for(n=0;n<r;n+=1)t[n].animation.togglePause(e)},e.searchAnimations=function(e,t,n){var r,a=[].concat([].slice.call(document.getElementsByClassName("lottie")),[].slice.call(document.getElementsByClassName("bodymovin"))),i=a.length;for(r=0;r<i;r+=1)n&&a[r].setAttribute("data-bm-type",n),l(a[r],e);if(t&&0===i){n||(n="svg");var s=document.getElementsByTagName("body")[0];s.innerText="";var o=createTag("div");o.style.width="100%",o.style.height="100%",o.setAttribute("data-bm-type",n),s.appendChild(o),l(o,e)}},e.resize=function(){var e;for(e=0;e<r;e+=1)t[e].animation.resize()},e.goToAndStop=function(e,n,a){var i;for(i=0;i<r;i+=1)t[i].animation.goToAndStop(e,n,a)},e.destroy=function(e){var n;for(n=r-1;n>=0;n-=1)t[n].animation.destroy(e)},e.freeze=function(){s=!0},e.unfreeze=function(){s=!1,f()},e.setVolume=function(e,n){var a;for(a=0;a<r;a+=1)t[a].animation.setVolume(e,n)},e.mute=function(e){var n;for(n=0;n<r;n+=1)t[n].animation.mute(e)},e.unmute=function(e){var n;for(n=0;n<r;n+=1)t[n].animation.unmute(e)},e.getRegisteredAnimations=function(){var e,n=t.length,r=[];for(e=0;e<n;e+=1)r.push(t[e].animation);return r},e}(),BezierFactory=function(){var e={getBezierEasing:function(e,n,r,a,i){var s=i||("bez_"+e+"_"+n+"_"+r+"_"+a).replace(/\./g,"p");if(t[s])return t[s];var o=new c([e,n,r,a]);return t[s]=o,o}},t={},n=11,r=1/(n-1),a="function"==typeof Float32Array;function i(e,t){return 1-3*t+3*e}function s(e,t){return 3*t-6*e}function o(e){return 3*e}function l(e,t,n){return((i(t,n)*e+s(t,n))*e+o(t))*e}function u(e,t,n){return 3*i(t,n)*e*e+2*s(t,n)*e+o(t)}function c(e){this._p=e,this._mSampleValues=a?new Float32Array(n):new Array(n),this._precomputed=!1,this.get=this.get.bind(this)}return c.prototype={get:function(e){var t=this._p[0],n=this._p[1],r=this._p[2],a=this._p[3];return this._precomputed||this._precompute(),t===n&&r===a?e:0===e?0:1===e?1:l(this._getTForX(e),n,a)},_precompute:function(){var e=this._p[0],t=this._p[1],n=this._p[2],r=this._p[3];this._precomputed=!0,e===t&&n===r||this._calcSampleValues()},_calcSampleValues:function(){for(var e=this._p[0],t=this._p[2],a=0;a<n;++a)this._mSampleValues[a]=l(a*r,e,t)},_getTForX:function(e){for(var t=this._p[0],a=this._p[2],i=this._mSampleValues,s=0,o=1,c=n-1;o!==c&&i[o]<=e;++o)s+=r;var h=s+(e-i[--o])/(i[o+1]-i[o])*r,d=u(h,t,a);return d>=.001?function(e,t,n,r){for(var a=0;a<4;++a){var i=u(t,n,r);if(0===i)return t;t-=(l(t,n,r)-e)/i}return t}(e,h,t,a):0===d?h:function(e,t,n,r,a){var i,s,o=0;do{(i=l(s=t+(n-t)/2,r,a)-e)>0?n=s:t=s}while(Math.abs(i)>1e-7&&++o<10);return s}(e,s,s+r,t,a)}},e}(),pooling={double:function(e){return e.concat(createSizedArray(e.length))}},poolFactory=function(e,t,n){var r=0,a=e,i=createSizedArray(a);return{newElement:function(){return r?i[r-=1]:t()},release:function(e){r===a&&(i=pooling.double(i),a*=2),n&&n(e),i[r]=e,r+=1}}},bezierLengthPool=poolFactory(8,(function(){return{addedLength:0,percents:createTypedArray("float32",getDefaultCurveSegments()),lengths:createTypedArray("float32",getDefaultCurveSegments())}})),segmentsLengthPool=poolFactory(8,(function(){return{lengths:[],totalLength:0}}),(function(e){var t,n=e.lengths.length;for(t=0;t<n;t+=1)bezierLengthPool.release(e.lengths[t]);e.lengths.length=0}));function bezFunction(){var e=Math;function t(e,t,n,r,a,i){var s=e*r+t*a+n*i-a*r-i*e-n*t;return s>-.001&&s<.001}var n=function(e,t,n,r){var a,i,s,o,l,u,c=getDefaultCurveSegments(),h=0,d=[],p=[],f=bezierLengthPool.newElement();for(s=n.length,a=0;a<c;a+=1){for(l=a/(c-1),u=0,i=0;i<s;i+=1)o=bmPow(1-l,3)*e[i]+3*bmPow(1-l,2)*l*n[i]+3*(1-l)*bmPow(l,2)*r[i]+bmPow(l,3)*t[i],d[i]=o,null!==p[i]&&(u+=bmPow(d[i]-p[i],2)),p[i]=d[i];u&&(h+=u=bmSqrt(u)),f.percents[a]=l,f.lengths[a]=h}return f.addedLength=h,f};function r(e){this.segmentLength=0,this.points=new Array(e)}function a(e,t){this.partialLength=e,this.point=t}var i,s=(i={},function(e,n,s,o){var l=(e[0]+"_"+e[1]+"_"+n[0]+"_"+n[1]+"_"+s[0]+"_"+s[1]+"_"+o[0]+"_"+o[1]).replace(/\./g,"p");if(!i[l]){var u,c,h,d,p,f,m,g=getDefaultCurveSegments(),y=0,v=null;2===e.length&&(e[0]!==n[0]||e[1]!==n[1])&&t(e[0],e[1],n[0],n[1],e[0]+s[0],e[1]+s[1])&&t(e[0],e[1],n[0],n[1],n[0]+o[0],n[1]+o[1])&&(g=2);var b=new r(g);for(h=s.length,u=0;u<g;u+=1){for(m=createSizedArray(h),p=u/(g-1),f=0,c=0;c<h;c+=1)d=bmPow(1-p,3)*e[c]+3*bmPow(1-p,2)*p*(e[c]+s[c])+3*(1-p)*bmPow(p,2)*(n[c]+o[c])+bmPow(p,3)*n[c],m[c]=d,null!==v&&(f+=bmPow(m[c]-v[c],2));y+=f=bmSqrt(f),b.points[u]=new a(f,m),v=m}b.segmentLength=y,i[l]=b}return i[l]});function o(e,t){var n=t.percents,r=t.lengths,a=n.length,i=bmFloor((a-1)*e),s=e*t.addedLength,o=0;if(i===a-1||0===i||s===r[i])return n[i];for(var l=r[i]>s?-1:1,u=!0;u;)if(r[i]<=s&&r[i+1]>s?(o=(s-r[i])/(r[i+1]-r[i]),u=!1):i+=l,i<0||i>=a-1){if(i===a-1)return n[i];u=!1}return n[i]+(n[i+1]-n[i])*o}var l=createTypedArray("float32",8);return{getSegmentsLength:function(e){var t,r=segmentsLengthPool.newElement(),a=e.c,i=e.v,s=e.o,o=e.i,l=e._length,u=r.lengths,c=0;for(t=0;t<l-1;t+=1)u[t]=n(i[t],i[t+1],s[t],o[t+1]),c+=u[t].addedLength;return a&&l&&(u[t]=n(i[t],i[0],s[t],o[0]),c+=u[t].addedLength),r.totalLength=c,r},getNewSegment:function(t,n,r,a,i,s,u){i<0?i=0:i>1&&(i=1);var c,h=o(i,u),d=o(s=s>1?1:s,u),p=t.length,f=1-h,m=1-d,g=f*f*f,y=h*f*f*3,v=h*h*f*3,b=h*h*h,x=f*f*m,T=h*f*m+f*h*m+f*f*d,_=h*h*m+f*h*d+h*f*d,w=h*h*d,S=f*m*m,C=h*m*m+f*d*m+f*m*d,E=h*d*m+f*d*d+h*m*d,k=h*d*d,I=m*m*m,A=d*m*m+m*d*m+m*m*d,N=d*d*m+m*d*d+d*m*d,$=d*d*d;for(c=0;c<p;c+=1)l[4*c]=e.round(1e3*(g*t[c]+y*r[c]+v*a[c]+b*n[c]))/1e3,l[4*c+1]=e.round(1e3*(x*t[c]+T*r[c]+_*a[c]+w*n[c]))/1e3,l[4*c+2]=e.round(1e3*(S*t[c]+C*r[c]+E*a[c]+k*n[c]))/1e3,l[4*c+3]=e.round(1e3*(I*t[c]+A*r[c]+N*a[c]+$*n[c]))/1e3;return l},getPointInSegment:function(t,n,r,a,i,s){var l=o(i,s),u=1-l;return[e.round(1e3*(u*u*u*t[0]+(l*u*u+u*l*u+u*u*l)*r[0]+(l*l*u+u*l*l+l*u*l)*a[0]+l*l*l*n[0]))/1e3,e.round(1e3*(u*u*u*t[1]+(l*u*u+u*l*u+u*u*l)*r[1]+(l*l*u+u*l*l+l*u*l)*a[1]+l*l*l*n[1]))/1e3]},buildBezierData:s,pointOnLine2D:t,pointOnLine3D:function(n,r,a,i,s,o,l,u,c){if(0===a&&0===o&&0===c)return t(n,r,i,s,l,u);var h,d=e.sqrt(e.pow(i-n,2)+e.pow(s-r,2)+e.pow(o-a,2)),p=e.sqrt(e.pow(l-n,2)+e.pow(u-r,2)+e.pow(c-a,2)),f=e.sqrt(e.pow(l-i,2)+e.pow(u-s,2)+e.pow(c-o,2));return(h=d>p?d>f?d-p-f:f-p-d:f>p?f-p-d:p-d-f)>-1e-4&&h<1e-4}}}var bez=bezFunction(),initFrame=initialDefaultFrame,mathAbs=Math.abs;function interpolateValue(e,t){var n,r=this.offsetTime;"multidimensional"===this.propType&&(n=createTypedArray("float32",this.pv.length));for(var a,i,s,o,l,u,c,h,d,p=t.lastIndex,f=p,m=this.keyframes.length-1,g=!0;g;){if(a=this.keyframes[f],i=this.keyframes[f+1],f===m-1&&e>=i.t-r){a.h&&(a=i),p=0;break}if(i.t-r>e){p=f;break}f<m-1?f+=1:(p=0,g=!1)}s=this.keyframesMetadata[f]||{};var y,v=i.t-r,b=a.t-r;if(a.to){s.bezierData||(s.bezierData=bez.buildBezierData(a.s,i.s||a.e,a.to,a.ti));var x=s.bezierData;if(e>=v||e<b){var T=e>=v?x.points.length-1:0;for(l=x.points[T].point.length,o=0;o<l;o+=1)n[o]=x.points[T].point[o]}else{s.__fnct?d=s.__fnct:(d=BezierFactory.getBezierEasing(a.o.x,a.o.y,a.i.x,a.i.y,a.n).get,s.__fnct=d),u=d((e-b)/(v-b));var _,w=x.segmentLength*u,S=t.lastFrame<e&&t._lastKeyframeIndex===f?t._lastAddedLength:0;for(h=t.lastFrame<e&&t._lastKeyframeIndex===f?t._lastPoint:0,g=!0,c=x.points.length;g;){if(S+=x.points[h].partialLength,0===w||0===u||h===x.points.length-1){for(l=x.points[h].point.length,o=0;o<l;o+=1)n[o]=x.points[h].point[o];break}if(w>=S&&w<S+x.points[h+1].partialLength){for(_=(w-S)/x.points[h+1].partialLength,l=x.points[h].point.length,o=0;o<l;o+=1)n[o]=x.points[h].point[o]+(x.points[h+1].point[o]-x.points[h].point[o])*_;break}h<c-1?h+=1:g=!1}t._lastPoint=h,t._lastAddedLength=S-x.points[h].partialLength,t._lastKeyframeIndex=f}}else{var C,E,k,I,A;if(m=a.s.length,y=i.s||a.e,this.sh&&1!==a.h)e>=v?(n[0]=y[0],n[1]=y[1],n[2]=y[2]):e<=b?(n[0]=a.s[0],n[1]=a.s[1],n[2]=a.s[2]):quaternionToEuler(n,slerp(createQuaternion(a.s),createQuaternion(y),(e-b)/(v-b)));else for(f=0;f<m;f+=1)1!==a.h&&(e>=v?u=1:e<b?u=0:(a.o.x.constructor===Array?(s.__fnct||(s.__fnct=[]),s.__fnct[f]?d=s.__fnct[f]:(C=void 0===a.o.x[f]?a.o.x[0]:a.o.x[f],E=void 0===a.o.y[f]?a.o.y[0]:a.o.y[f],k=void 0===a.i.x[f]?a.i.x[0]:a.i.x[f],I=void 0===a.i.y[f]?a.i.y[0]:a.i.y[f],d=BezierFactory.getBezierEasing(C,E,k,I).get,s.__fnct[f]=d)):s.__fnct?d=s.__fnct:(C=a.o.x,E=a.o.y,k=a.i.x,I=a.i.y,d=BezierFactory.getBezierEasing(C,E,k,I).get,a.keyframeMetadata=d),u=d((e-b)/(v-b)))),y=i.s||a.e,A=1===a.h?a.s[f]:a.s[f]+(y[f]-a.s[f])*u,"multidimensional"===this.propType?n[f]=A:n=A}return t.lastIndex=p,n}function slerp(e,t,n){var r,a,i,s,o,l=[],u=e[0],c=e[1],h=e[2],d=e[3],p=t[0],f=t[1],m=t[2],g=t[3];return(a=u*p+c*f+h*m+d*g)<0&&(a=-a,p=-p,f=-f,m=-m,g=-g),1-a>1e-6?(r=Math.acos(a),i=Math.sin(r),s=Math.sin((1-n)*r)/i,o=Math.sin(n*r)/i):(s=1-n,o=n),l[0]=s*u+o*p,l[1]=s*c+o*f,l[2]=s*h+o*m,l[3]=s*d+o*g,l}function quaternionToEuler(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],s=Math.atan2(2*r*i-2*n*a,1-2*r*r-2*a*a),o=Math.asin(2*n*r+2*a*i),l=Math.atan2(2*n*i-2*r*a,1-2*n*n-2*a*a);e[0]=s/degToRads,e[1]=o/degToRads,e[2]=l/degToRads}function createQuaternion(e){var t=e[0]*degToRads,n=e[1]*degToRads,r=e[2]*degToRads,a=Math.cos(t/2),i=Math.cos(n/2),s=Math.cos(r/2),o=Math.sin(t/2),l=Math.sin(n/2),u=Math.sin(r/2);return[o*l*s+a*i*u,o*i*s+a*l*u,a*l*s-o*i*u,a*i*s-o*l*u]}function getValueAtCurrentTime(){var e=this.comp.renderedFrame-this.offsetTime,t=this.keyframes[0].t-this.offsetTime,n=this.keyframes[this.keyframes.length-1].t-this.offsetTime;if(!(e===this._caching.lastFrame||this._caching.lastFrame!==initFrame&&(this._caching.lastFrame>=n&&e>=n||this._caching.lastFrame<t&&e<t))){this._caching.lastFrame>=e&&(this._caching._lastKeyframeIndex=-1,this._caching.lastIndex=0);var r=this.interpolateValue(e,this._caching);this.pv=r}return this._caching.lastFrame=e,this.pv}function setVValue(e){var t;if("unidimensional"===this.propType)t=e*this.mult,mathAbs(this.v-t)>1e-5&&(this.v=t,this._mdf=!0);else for(var n=0,r=this.v.length;n<r;)t=e[n]*this.mult,mathAbs(this.v[n]-t)>1e-5&&(this.v[n]=t,this._mdf=!0),n+=1}function processEffectsSequence(){if(this.elem.globalData.frameId!==this.frameId&&this.effectsSequence.length)if(this.lock)this.setVValue(this.pv);else{var e;this.lock=!0,this._mdf=this._isFirstFrame;var t=this.effectsSequence.length,n=this.kf?this.pv:this.data.k;for(e=0;e<t;e+=1)n=this.effectsSequence[e](n);this.setVValue(n),this._isFirstFrame=!1,this.lock=!1,this.frameId=this.elem.globalData.frameId}}function addEffect(e){this.effectsSequence.push(e),this.container.addDynamicProperty(this)}function ValueProperty(e,t,n,r){this.propType="unidimensional",this.mult=n||1,this.data=t,this.v=n?t.k*n:t.k,this.pv=t.k,this._mdf=!1,this.elem=e,this.container=r,this.comp=e.comp,this.k=!1,this.kf=!1,this.vel=0,this.effectsSequence=[],this._isFirstFrame=!0,this.getValue=processEffectsSequence,this.setVValue=setVValue,this.addEffect=addEffect}function MultiDimensionalProperty(e,t,n,r){var a;this.propType="multidimensional",this.mult=n||1,this.data=t,this._mdf=!1,this.elem=e,this.container=r,this.comp=e.comp,this.k=!1,this.kf=!1,this.frameId=-1;var i=t.k.length;for(this.v=createTypedArray("float32",i),this.pv=createTypedArray("float32",i),this.vel=createTypedArray("float32",i),a=0;a<i;a+=1)this.v[a]=t.k[a]*this.mult,this.pv[a]=t.k[a];this._isFirstFrame=!0,this.effectsSequence=[],this.getValue=processEffectsSequence,this.setVValue=setVValue,this.addEffect=addEffect}function KeyframedValueProperty(e,t,n,r){this.propType="unidimensional",this.keyframes=t.k,this.keyframesMetadata=[],this.offsetTime=e.data.st,this.frameId=-1,this._caching={lastFrame:initFrame,lastIndex:0,value:0,_lastKeyframeIndex:-1},this.k=!0,this.kf=!0,this.data=t,this.mult=n||1,this.elem=e,this.container=r,this.comp=e.comp,this.v=initFrame,this.pv=initFrame,this._isFirstFrame=!0,this.getValue=processEffectsSequence,this.setVValue=setVValue,this.interpolateValue=interpolateValue,this.effectsSequence=[getValueAtCurrentTime.bind(this)],this.addEffect=addEffect}function KeyframedMultidimensionalProperty(e,t,n,r){var a;this.propType="multidimensional";var i,s,o,l,u=t.k.length;for(a=0;a<u-1;a+=1)t.k[a].to&&t.k[a].s&&t.k[a+1]&&t.k[a+1].s&&(i=t.k[a].s,s=t.k[a+1].s,o=t.k[a].to,l=t.k[a].ti,(2===i.length&&(i[0]!==s[0]||i[1]!==s[1])&&bez.pointOnLine2D(i[0],i[1],s[0],s[1],i[0]+o[0],i[1]+o[1])&&bez.pointOnLine2D(i[0],i[1],s[0],s[1],s[0]+l[0],s[1]+l[1])||3===i.length&&(i[0]!==s[0]||i[1]!==s[1]||i[2]!==s[2])&&bez.pointOnLine3D(i[0],i[1],i[2],s[0],s[1],s[2],i[0]+o[0],i[1]+o[1],i[2]+o[2])&&bez.pointOnLine3D(i[0],i[1],i[2],s[0],s[1],s[2],s[0]+l[0],s[1]+l[1],s[2]+l[2]))&&(t.k[a].to=null,t.k[a].ti=null),i[0]===s[0]&&i[1]===s[1]&&0===o[0]&&0===o[1]&&0===l[0]&&0===l[1]&&(2===i.length||i[2]===s[2]&&0===o[2]&&0===l[2])&&(t.k[a].to=null,t.k[a].ti=null));this.effectsSequence=[getValueAtCurrentTime.bind(this)],this.data=t,this.keyframes=t.k,this.keyframesMetadata=[],this.offsetTime=e.data.st,this.k=!0,this.kf=!0,this._isFirstFrame=!0,this.mult=n||1,this.elem=e,this.container=r,this.comp=e.comp,this.getValue=processEffectsSequence,this.setVValue=setVValue,this.interpolateValue=interpolateValue,this.frameId=-1;var c=t.k[0].s.length;for(this.v=createTypedArray("float32",c),this.pv=createTypedArray("float32",c),a=0;a<c;a+=1)this.v[a]=initFrame,this.pv[a]=initFrame;this._caching={lastFrame:initFrame,lastIndex:0,value:createTypedArray("float32",c)},this.addEffect=addEffect}var PropertyFactory={getProp:function(e,t,n,r,a){var i;if(t.sid&&(t=e.globalData.slotManager.getProp(t)),t.k.length)if("number"==typeof t.k[0])i=new MultiDimensionalProperty(e,t,r,a);else switch(n){case 0:i=new KeyframedValueProperty(e,t,r,a);break;case 1:i=new KeyframedMultidimensionalProperty(e,t,r,a)}else i=new ValueProperty(e,t,r,a);return i.effectsSequence.length&&a.addDynamicProperty(i),i}};function DynamicPropertyContainer(){}DynamicPropertyContainer.prototype={addDynamicProperty:function(e){-1===this.dynamicProperties.indexOf(e)&&(this.dynamicProperties.push(e),this.container.addDynamicProperty(this),this._isAnimated=!0)},iterateDynamicProperties:function(){var e;this._mdf=!1;var t=this.dynamicProperties.length;for(e=0;e<t;e+=1)this.dynamicProperties[e].getValue(),this.dynamicProperties[e]._mdf&&(this._mdf=!0)},initDynamicPropertyContainer:function(e){this.container=e,this.dynamicProperties=[],this._mdf=!1,this._isAnimated=!1}};var pointPool=poolFactory(8,(function(){return createTypedArray("float32",2)}));function ShapePath(){this.c=!1,this._length=0,this._maxLength=8,this.v=createSizedArray(this._maxLength),this.o=createSizedArray(this._maxLength),this.i=createSizedArray(this._maxLength)}ShapePath.prototype.setPathData=function(e,t){this.c=e,this.setLength(t);for(var n=0;n<t;)this.v[n]=pointPool.newElement(),this.o[n]=pointPool.newElement(),this.i[n]=pointPool.newElement(),n+=1},ShapePath.prototype.setLength=function(e){for(;this._maxLength<e;)this.doubleArrayLength();this._length=e},ShapePath.prototype.doubleArrayLength=function(){this.v=this.v.concat(createSizedArray(this._maxLength)),this.i=this.i.concat(createSizedArray(this._maxLength)),this.o=this.o.concat(createSizedArray(this._maxLength)),this._maxLength*=2},ShapePath.prototype.setXYAt=function(e,t,n,r,a){var i;switch(this._length=Math.max(this._length,r+1),this._length>=this._maxLength&&this.doubleArrayLength(),n){case"v":i=this.v;break;case"i":i=this.i;break;case"o":i=this.o;break;default:i=[]}(!i[r]||i[r]&&!a)&&(i[r]=pointPool.newElement()),i[r][0]=e,i[r][1]=t},ShapePath.prototype.setTripleAt=function(e,t,n,r,a,i,s,o){this.setXYAt(e,t,"v",s,o),this.setXYAt(n,r,"o",s,o),this.setXYAt(a,i,"i",s,o)},ShapePath.prototype.reverse=function(){var e=new ShapePath;e.setPathData(this.c,this._length);var t=this.v,n=this.o,r=this.i,a=0;this.c&&(e.setTripleAt(t[0][0],t[0][1],r[0][0],r[0][1],n[0][0],n[0][1],0,!1),a=1);var i,s=this._length-1,o=this._length;for(i=a;i<o;i+=1)e.setTripleAt(t[s][0],t[s][1],r[s][0],r[s][1],n[s][0],n[s][1],i,!1),s-=1;return e},ShapePath.prototype.length=function(){return this._length};var shapePool=(factory2=poolFactory(4,(function(){return new ShapePath}),(function(e){var t,n=e._length;for(t=0;t<n;t+=1)pointPool.release(e.v[t]),pointPool.release(e.i[t]),pointPool.release(e.o[t]),e.v[t]=null,e.i[t]=null,e.o[t]=null;e._length=0,e.c=!1})),factory2.clone=function(e){var t,n=factory2.newElement(),r=void 0===e._length?e.v.length:e._length;for(n.setLength(r),n.c=e.c,t=0;t<r;t+=1)n.setTripleAt(e.v[t][0],e.v[t][1],e.o[t][0],e.o[t][1],e.i[t][0],e.i[t][1],t);return n},factory2),factory2;function ShapeCollection(){this._length=0,this._maxLength=4,this.shapes=createSizedArray(this._maxLength)}ShapeCollection.prototype.addShape=function(e){this._length===this._maxLength&&(this.shapes=this.shapes.concat(createSizedArray(this._maxLength)),this._maxLength*=2),this.shapes[this._length]=e,this._length+=1},ShapeCollection.prototype.releaseShapes=function(){var e;for(e=0;e<this._length;e+=1)shapePool.release(this.shapes[e]);this._length=0};var shapeCollectionPool=(ob2={newShapeCollection:function(){return _length?pool2[_length-=1]:new ShapeCollection},release:function(e){var t,n=e._length;for(t=0;t<n;t+=1)shapePool.release(e.shapes[t]);e._length=0,_length===_maxLength&&(pool2=pooling.double(pool2),_maxLength*=2),pool2[_length]=e,_length+=1}},_length=0,_maxLength=4,pool2=createSizedArray(_maxLength),ob2),ob2,_length,_maxLength,pool2,ShapePropertyFactory=function(){var e=-999999;function t(e,t,n){var r,a,i,s,o,l,u,c,h,d=n.lastIndex,p=this.keyframes;if(e<p[0].t-this.offsetTime)r=p[0].s[0],i=!0,d=0;else if(e>=p[p.length-1].t-this.offsetTime)r=p[p.length-1].s?p[p.length-1].s[0]:p[p.length-2].e[0],i=!0;else{for(var f,m,g,y=d,v=p.length-1,b=!0;b&&(f=p[y],!((m=p[y+1]).t-this.offsetTime>e));)y<v-1?y+=1:b=!1;if(g=this.keyframesMetadata[y]||{},d=y,!(i=1===f.h)){if(e>=m.t-this.offsetTime)c=1;else if(e<f.t-this.offsetTime)c=0;else{var x;g.__fnct?x=g.__fnct:(x=BezierFactory.getBezierEasing(f.o.x,f.o.y,f.i.x,f.i.y).get,g.__fnct=x),c=x((e-(f.t-this.offsetTime))/(m.t-this.offsetTime-(f.t-this.offsetTime)))}a=m.s?m.s[0]:f.e[0]}r=f.s[0]}for(l=t._length,u=r.i[0].length,n.lastIndex=d,s=0;s<l;s+=1)for(o=0;o<u;o+=1)h=i?r.i[s][o]:r.i[s][o]+(a.i[s][o]-r.i[s][o])*c,t.i[s][o]=h,h=i?r.o[s][o]:r.o[s][o]+(a.o[s][o]-r.o[s][o])*c,t.o[s][o]=h,h=i?r.v[s][o]:r.v[s][o]+(a.v[s][o]-r.v[s][o])*c,t.v[s][o]=h}function n(){var t=this.comp.renderedFrame-this.offsetTime,n=this.keyframes[0].t-this.offsetTime,r=this.keyframes[this.keyframes.length-1].t-this.offsetTime,a=this._caching.lastFrame;return a!==e&&(a<n&&t<n||a>r&&t>r)||(this._caching.lastIndex=a<t?this._caching.lastIndex:0,this.interpolateShape(t,this.pv,this._caching)),this._caching.lastFrame=t,this.pv}function r(){this.paths=this.localShapeCollection}function a(e){(function(e,t){if(e._length!==t._length||e.c!==t.c)return!1;var n,r=e._length;for(n=0;n<r;n+=1)if(e.v[n][0]!==t.v[n][0]||e.v[n][1]!==t.v[n][1]||e.o[n][0]!==t.o[n][0]||e.o[n][1]!==t.o[n][1]||e.i[n][0]!==t.i[n][0]||e.i[n][1]!==t.i[n][1])return!1;return!0})(this.v,e)||(this.v=shapePool.clone(e),this.localShapeCollection.releaseShapes(),this.localShapeCollection.addShape(this.v),this._mdf=!0,this.paths=this.localShapeCollection)}function i(){if(this.elem.globalData.frameId!==this.frameId)if(this.effectsSequence.length)if(this.lock)this.setVValue(this.pv);else{var e,t;this.lock=!0,this._mdf=!1,e=this.kf?this.pv:this.data.ks?this.data.ks.k:this.data.pt.k;var n=this.effectsSequence.length;for(t=0;t<n;t+=1)e=this.effectsSequence[t](e);this.setVValue(e),this.lock=!1,this.frameId=this.elem.globalData.frameId}else this._mdf=!1}function s(e,t,n){this.propType="shape",this.comp=e.comp,this.container=e,this.elem=e,this.data=t,this.k=!1,this.kf=!1,this._mdf=!1;var a=3===n?t.pt.k:t.ks.k;this.v=shapePool.clone(a),this.pv=shapePool.clone(this.v),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.paths.addShape(this.v),this.reset=r,this.effectsSequence=[]}function o(e){this.effectsSequence.push(e),this.container.addDynamicProperty(this)}function l(t,a,i){this.propType="shape",this.comp=t.comp,this.elem=t,this.container=t,this.offsetTime=t.data.st,this.keyframes=3===i?a.pt.k:a.ks.k,this.keyframesMetadata=[],this.k=!0,this.kf=!0;var s=this.keyframes[0].s[0].i.length;this.v=shapePool.newElement(),this.v.setPathData(this.keyframes[0].s[0].c,s),this.pv=shapePool.clone(this.v),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.paths.addShape(this.v),this.lastFrame=e,this.reset=r,this._caching={lastFrame:e,lastIndex:0},this.effectsSequence=[n.bind(this)]}s.prototype.interpolateShape=t,s.prototype.getValue=i,s.prototype.setVValue=a,s.prototype.addEffect=o,l.prototype.getValue=i,l.prototype.interpolateShape=t,l.prototype.setVValue=a,l.prototype.addEffect=o;var u=function(){var e=roundCorner;function t(e,t){this.v=shapePool.newElement(),this.v.setPathData(!0,4),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.localShapeCollection.addShape(this.v),this.d=t.d,this.elem=e,this.comp=e.comp,this.frameId=-1,this.initDynamicPropertyContainer(e),this.p=PropertyFactory.getProp(e,t.p,1,0,this),this.s=PropertyFactory.getProp(e,t.s,1,0,this),this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertEllToPath())}return t.prototype={reset:r,getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertEllToPath())},convertEllToPath:function(){var t=this.p.v[0],n=this.p.v[1],r=this.s.v[0]/2,a=this.s.v[1]/2,i=3!==this.d,s=this.v;s.v[0][0]=t,s.v[0][1]=n-a,s.v[1][0]=i?t+r:t-r,s.v[1][1]=n,s.v[2][0]=t,s.v[2][1]=n+a,s.v[3][0]=i?t-r:t+r,s.v[3][1]=n,s.i[0][0]=i?t-r*e:t+r*e,s.i[0][1]=n-a,s.i[1][0]=i?t+r:t-r,s.i[1][1]=n-a*e,s.i[2][0]=i?t+r*e:t-r*e,s.i[2][1]=n+a,s.i[3][0]=i?t-r:t+r,s.i[3][1]=n+a*e,s.o[0][0]=i?t+r*e:t-r*e,s.o[0][1]=n-a,s.o[1][0]=i?t+r:t-r,s.o[1][1]=n+a*e,s.o[2][0]=i?t-r*e:t+r*e,s.o[2][1]=n+a,s.o[3][0]=i?t-r:t+r,s.o[3][1]=n-a*e}},extendPrototype([DynamicPropertyContainer],t),t}(),c=function(){function e(e,t){this.v=shapePool.newElement(),this.v.setPathData(!0,0),this.elem=e,this.comp=e.comp,this.data=t,this.frameId=-1,this.d=t.d,this.initDynamicPropertyContainer(e),1===t.sy?(this.ir=PropertyFactory.getProp(e,t.ir,0,0,this),this.is=PropertyFactory.getProp(e,t.is,0,.01,this),this.convertToPath=this.convertStarToPath):this.convertToPath=this.convertPolygonToPath,this.pt=PropertyFactory.getProp(e,t.pt,0,0,this),this.p=PropertyFactory.getProp(e,t.p,1,0,this),this.r=PropertyFactory.getProp(e,t.r,0,degToRads,this),this.or=PropertyFactory.getProp(e,t.or,0,0,this),this.os=PropertyFactory.getProp(e,t.os,0,.01,this),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.localShapeCollection.addShape(this.v),this.paths=this.localShapeCollection,this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertToPath())}return e.prototype={reset:r,getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertToPath())},convertStarToPath:function(){var e,t,n,r,a=2*Math.floor(this.pt.v),i=2*Math.PI/a,s=!0,o=this.or.v,l=this.ir.v,u=this.os.v,c=this.is.v,h=2*Math.PI*o/(2*a),d=2*Math.PI*l/(2*a),p=-Math.PI/2;p+=this.r.v;var f=3===this.data.d?-1:1;for(this.v._length=0,e=0;e<a;e+=1){n=s?u:c,r=s?h:d;var m=(t=s?o:l)*Math.cos(p),g=t*Math.sin(p),y=0===m&&0===g?0:g/Math.sqrt(m*m+g*g),v=0===m&&0===g?0:-m/Math.sqrt(m*m+g*g);m+=+this.p.v[0],g+=+this.p.v[1],this.v.setTripleAt(m,g,m-y*r*n*f,g-v*r*n*f,m+y*r*n*f,g+v*r*n*f,e,!0),s=!s,p+=i*f}},convertPolygonToPath:function(){var e,t=Math.floor(this.pt.v),n=2*Math.PI/t,r=this.or.v,a=this.os.v,i=2*Math.PI*r/(4*t),s=.5*-Math.PI,o=3===this.data.d?-1:1;for(s+=this.r.v,this.v._length=0,e=0;e<t;e+=1){var l=r*Math.cos(s),u=r*Math.sin(s),c=0===l&&0===u?0:u/Math.sqrt(l*l+u*u),h=0===l&&0===u?0:-l/Math.sqrt(l*l+u*u);l+=+this.p.v[0],u+=+this.p.v[1],this.v.setTripleAt(l,u,l-c*i*a*o,u-h*i*a*o,l+c*i*a*o,u+h*i*a*o,e,!0),s+=n*o}this.paths.length=0,this.paths[0]=this.v}},extendPrototype([DynamicPropertyContainer],e),e}(),h=function(){function e(e,t){this.v=shapePool.newElement(),this.v.c=!0,this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.localShapeCollection.addShape(this.v),this.paths=this.localShapeCollection,this.elem=e,this.comp=e.comp,this.frameId=-1,this.d=t.d,this.initDynamicPropertyContainer(e),this.p=PropertyFactory.getProp(e,t.p,1,0,this),this.s=PropertyFactory.getProp(e,t.s,1,0,this),this.r=PropertyFactory.getProp(e,t.r,0,0,this),this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertRectToPath())}return e.prototype={convertRectToPath:function(){var e=this.p.v[0],t=this.p.v[1],n=this.s.v[0]/2,r=this.s.v[1]/2,a=bmMin(n,r,this.r.v),i=a*(1-roundCorner);this.v._length=0,2===this.d||1===this.d?(this.v.setTripleAt(e+n,t-r+a,e+n,t-r+a,e+n,t-r+i,0,!0),this.v.setTripleAt(e+n,t+r-a,e+n,t+r-i,e+n,t+r-a,1,!0),0!==a?(this.v.setTripleAt(e+n-a,t+r,e+n-a,t+r,e+n-i,t+r,2,!0),this.v.setTripleAt(e-n+a,t+r,e-n+i,t+r,e-n+a,t+r,3,!0),this.v.setTripleAt(e-n,t+r-a,e-n,t+r-a,e-n,t+r-i,4,!0),this.v.setTripleAt(e-n,t-r+a,e-n,t-r+i,e-n,t-r+a,5,!0),this.v.setTripleAt(e-n+a,t-r,e-n+a,t-r,e-n+i,t-r,6,!0),this.v.setTripleAt(e+n-a,t-r,e+n-i,t-r,e+n-a,t-r,7,!0)):(this.v.setTripleAt(e-n,t+r,e-n+i,t+r,e-n,t+r,2),this.v.setTripleAt(e-n,t-r,e-n,t-r+i,e-n,t-r,3))):(this.v.setTripleAt(e+n,t-r+a,e+n,t-r+i,e+n,t-r+a,0,!0),0!==a?(this.v.setTripleAt(e+n-a,t-r,e+n-a,t-r,e+n-i,t-r,1,!0),this.v.setTripleAt(e-n+a,t-r,e-n+i,t-r,e-n+a,t-r,2,!0),this.v.setTripleAt(e-n,t-r+a,e-n,t-r+a,e-n,t-r+i,3,!0),this.v.setTripleAt(e-n,t+r-a,e-n,t+r-i,e-n,t+r-a,4,!0),this.v.setTripleAt(e-n+a,t+r,e-n+a,t+r,e-n+i,t+r,5,!0),this.v.setTripleAt(e+n-a,t+r,e+n-i,t+r,e+n-a,t+r,6,!0),this.v.setTripleAt(e+n,t+r-a,e+n,t+r-a,e+n,t+r-i,7,!0)):(this.v.setTripleAt(e-n,t-r,e-n+i,t-r,e-n,t-r,1,!0),this.v.setTripleAt(e-n,t+r,e-n,t+r-i,e-n,t+r,2,!0),this.v.setTripleAt(e+n,t+r,e+n-i,t+r,e+n,t+r,3,!0)))},getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertRectToPath())},reset:r},extendPrototype([DynamicPropertyContainer],e),e}(),d={getShapeProp:function(e,t,n){var r;return 3===n||4===n?r=(3===n?t.pt:t.ks).k.length?new l(e,t,n):new s(e,t,n):5===n?r=new h(e,t):6===n?r=new u(e,t):7===n&&(r=new c(e,t)),r.k&&e.addDynamicProperty(r),r},getConstructorFunction:function(){return s},getKeyframedConstructorFunction:function(){return l}};return d}(),Matrix=function(){var e=Math.cos,t=Math.sin,n=Math.tan,r=Math.round;function a(){return this.props[0]=1,this.props[1]=0,this.props[2]=0,this.props[3]=0,this.props[4]=0,this.props[5]=1,this.props[6]=0,this.props[7]=0,this.props[8]=0,this.props[9]=0,this.props[10]=1,this.props[11]=0,this.props[12]=0,this.props[13]=0,this.props[14]=0,this.props[15]=1,this}function i(n){if(0===n)return this;var r=e(n),a=t(n);return this._t(r,-a,0,0,a,r,0,0,0,0,1,0,0,0,0,1)}function s(n){if(0===n)return this;var r=e(n),a=t(n);return this._t(1,0,0,0,0,r,-a,0,0,a,r,0,0,0,0,1)}function o(n){if(0===n)return this;var r=e(n),a=t(n);return this._t(r,0,a,0,0,1,0,0,-a,0,r,0,0,0,0,1)}function l(n){if(0===n)return this;var r=e(n),a=t(n);return this._t(r,-a,0,0,a,r,0,0,0,0,1,0,0,0,0,1)}function u(e,t){return this._t(1,t,e,1,0,0)}function c(e,t){return this.shear(n(e),n(t))}function h(r,a){var i=e(a),s=t(a);return this._t(i,s,0,0,-s,i,0,0,0,0,1,0,0,0,0,1)._t(1,0,0,0,n(r),1,0,0,0,0,1,0,0,0,0,1)._t(i,-s,0,0,s,i,0,0,0,0,1,0,0,0,0,1)}function d(e,t,n){return n||0===n||(n=1),1===e&&1===t&&1===n?this:this._t(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1)}function p(e,t,n,r,a,i,s,o,l,u,c,h,d,p,f,m){return this.props[0]=e,this.props[1]=t,this.props[2]=n,this.props[3]=r,this.props[4]=a,this.props[5]=i,this.props[6]=s,this.props[7]=o,this.props[8]=l,this.props[9]=u,this.props[10]=c,this.props[11]=h,this.props[12]=d,this.props[13]=p,this.props[14]=f,this.props[15]=m,this}function f(e,t,n){return n=n||0,0!==e||0!==t||0!==n?this._t(1,0,0,0,0,1,0,0,0,0,1,0,e,t,n,1):this}function m(e,t,n,r,a,i,s,o,l,u,c,h,d,p,f,m){var g=this.props;if(1===e&&0===t&&0===n&&0===r&&0===a&&1===i&&0===s&&0===o&&0===l&&0===u&&1===c&&0===h)return g[12]=g[12]*e+g[15]*d,g[13]=g[13]*i+g[15]*p,g[14]=g[14]*c+g[15]*f,g[15]*=m,this._identityCalculated=!1,this;var y=g[0],v=g[1],b=g[2],x=g[3],T=g[4],_=g[5],w=g[6],S=g[7],C=g[8],E=g[9],k=g[10],I=g[11],A=g[12],N=g[13],$=g[14],D=g[15];return g[0]=y*e+v*a+b*l+x*d,g[1]=y*t+v*i+b*u+x*p,g[2]=y*n+v*s+b*c+x*f,g[3]=y*r+v*o+b*h+x*m,g[4]=T*e+_*a+w*l+S*d,g[5]=T*t+_*i+w*u+S*p,g[6]=T*n+_*s+w*c+S*f,g[7]=T*r+_*o+w*h+S*m,g[8]=C*e+E*a+k*l+I*d,g[9]=C*t+E*i+k*u+I*p,g[10]=C*n+E*s+k*c+I*f,g[11]=C*r+E*o+k*h+I*m,g[12]=A*e+N*a+$*l+D*d,g[13]=A*t+N*i+$*u+D*p,g[14]=A*n+N*s+$*c+D*f,g[15]=A*r+N*o+$*h+D*m,this._identityCalculated=!1,this}function g(e){var t=e.props;return this.transform(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function y(){return this._identityCalculated||(this._identity=!(1!==this.props[0]||0!==this.props[1]||0!==this.props[2]||0!==this.props[3]||0!==this.props[4]||1!==this.props[5]||0!==this.props[6]||0!==this.props[7]||0!==this.props[8]||0!==this.props[9]||1!==this.props[10]||0!==this.props[11]||0!==this.props[12]||0!==this.props[13]||0!==this.props[14]||1!==this.props[15]),this._identityCalculated=!0),this._identity}function v(e){for(var t=0;t<16;){if(e.props[t]!==this.props[t])return!1;t+=1}return!0}function b(e){var t;for(t=0;t<16;t+=1)e.props[t]=this.props[t];return e}function x(e){var t;for(t=0;t<16;t+=1)this.props[t]=e[t]}function T(e,t,n){return{x:e*this.props[0]+t*this.props[4]+n*this.props[8]+this.props[12],y:e*this.props[1]+t*this.props[5]+n*this.props[9]+this.props[13],z:e*this.props[2]+t*this.props[6]+n*this.props[10]+this.props[14]}}function _(e,t,n){return e*this.props[0]+t*this.props[4]+n*this.props[8]+this.props[12]}function w(e,t,n){return e*this.props[1]+t*this.props[5]+n*this.props[9]+this.props[13]}function S(e,t,n){return e*this.props[2]+t*this.props[6]+n*this.props[10]+this.props[14]}function C(){var e=this.props[0]*this.props[5]-this.props[1]*this.props[4],t=this.props[5]/e,n=-this.props[1]/e,r=-this.props[4]/e,a=this.props[0]/e,i=(this.props[4]*this.props[13]-this.props[5]*this.props[12])/e,s=-(this.props[0]*this.props[13]-this.props[1]*this.props[12])/e,o=new Matrix;return o.props[0]=t,o.props[1]=n,o.props[4]=r,o.props[5]=a,o.props[12]=i,o.props[13]=s,o}function E(e){return this.getInverseMatrix().applyToPointArray(e[0],e[1],e[2]||0)}function k(e){var t,n=e.length,r=[];for(t=0;t<n;t+=1)r[t]=E(e[t]);return r}function I(e,t,n){var r=createTypedArray("float32",6);if(this.isIdentity())r[0]=e[0],r[1]=e[1],r[2]=t[0],r[3]=t[1],r[4]=n[0],r[5]=n[1];else{var a=this.props[0],i=this.props[1],s=this.props[4],o=this.props[5],l=this.props[12],u=this.props[13];r[0]=e[0]*a+e[1]*s+l,r[1]=e[0]*i+e[1]*o+u,r[2]=t[0]*a+t[1]*s+l,r[3]=t[0]*i+t[1]*o+u,r[4]=n[0]*a+n[1]*s+l,r[5]=n[0]*i+n[1]*o+u}return r}function A(e,t,n){return this.isIdentity()?[e,t,n]:[e*this.props[0]+t*this.props[4]+n*this.props[8]+this.props[12],e*this.props[1]+t*this.props[5]+n*this.props[9]+this.props[13],e*this.props[2]+t*this.props[6]+n*this.props[10]+this.props[14]]}function N(e,t){if(this.isIdentity())return e+","+t;var n=this.props;return Math.round(100*(e*n[0]+t*n[4]+n[12]))/100+","+Math.round(100*(e*n[1]+t*n[5]+n[13]))/100}function $(){for(var e=0,t=this.props,n="matrix3d(";e<16;)n+=r(1e4*t[e])/1e4,n+=15===e?")":",",e+=1;return n}function D(e){return e<1e-6&&e>0||e>-1e-6&&e<0?r(1e4*e)/1e4:e}function P(){var e=this.props;return"matrix("+D(e[0])+","+D(e[1])+","+D(e[4])+","+D(e[5])+","+D(e[12])+","+D(e[13])+")"}return function(){this.reset=a,this.rotate=i,this.rotateX=s,this.rotateY=o,this.rotateZ=l,this.skew=c,this.skewFromAxis=h,this.shear=u,this.scale=d,this.setTransform=p,this.translate=f,this.transform=m,this.multiply=g,this.applyToPoint=T,this.applyToX=_,this.applyToY=w,this.applyToZ=S,this.applyToPointArray=A,this.applyToTriplePoints=I,this.applyToPointStringified=N,this.toCSS=$,this.to2dCSS=P,this.clone=b,this.cloneFromProps=x,this.equals=v,this.inversePoints=k,this.inversePoint=E,this.getInverseMatrix=C,this._t=this.transform,this.isIdentity=y,this._identity=!0,this._identityCalculated=!1,this.props=createTypedArray("float32",16),this.reset()}}();function _typeof$3(e){return(_typeof$3="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var lottie={};function setLocation(e){setLocationHref(e)}function searchAnimations(){animationManager.searchAnimations()}function setSubframeRendering(e){setSubframeEnabled(e)}function setPrefix(e){setIdPrefix(e)}function loadAnimation(e){return animationManager.loadAnimation(e)}function setQuality(e){if("string"==typeof e)switch(e){case"high":setDefaultCurveSegments(200);break;default:case"medium":setDefaultCurveSegments(50);break;case"low":setDefaultCurveSegments(10)}else!isNaN(e)&&e>1&&setDefaultCurveSegments(e)}function inBrowser(){return"undefined"!=typeof navigator}function installPlugin(e,t){"expressions"===e&&setExpressionsPlugin(t)}function getFactory(e){switch(e){case"propertyFactory":return PropertyFactory;case"shapePropertyFactory":return ShapePropertyFactory;case"matrix":return Matrix;default:return null}}function checkReady(){"complete"===document.readyState&&(clearInterval(readyStateCheckInterval),searchAnimations())}function getQueryVariable(e){for(var t=queryString.split("&"),n=0;n<t.length;n+=1){var r=t[n].split("=");if(decodeURIComponent(r[0])==e)return decodeURIComponent(r[1])}return null}lottie.play=animationManager.play,lottie.pause=animationManager.pause,lottie.setLocationHref=setLocation,lottie.togglePause=animationManager.togglePause,lottie.setSpeed=animationManager.setSpeed,lottie.setDirection=animationManager.setDirection,lottie.stop=animationManager.stop,lottie.searchAnimations=searchAnimations,lottie.registerAnimation=animationManager.registerAnimation,lottie.loadAnimation=loadAnimation,lottie.setSubframeRendering=setSubframeRendering,lottie.resize=animationManager.resize,lottie.goToAndStop=animationManager.goToAndStop,lottie.destroy=animationManager.destroy,lottie.setQuality=setQuality,lottie.inBrowser=inBrowser,lottie.installPlugin=installPlugin,lottie.freeze=animationManager.freeze,lottie.unfreeze=animationManager.unfreeze,lottie.setVolume=animationManager.setVolume,lottie.mute=animationManager.mute,lottie.unmute=animationManager.unmute,lottie.getRegisteredAnimations=animationManager.getRegisteredAnimations,lottie.useWebWorker=setWebWorker,lottie.setIDPrefix=setPrefix,lottie.__getFactory=getFactory,lottie.version="5.12.2";var queryString="",scripts=document.getElementsByTagName("script"),index=scripts.length-1,myScript=scripts[index]||{src:""};queryString=myScript.src?myScript.src.replace(/^[^\?]+\??/,""):"",getQueryVariable("renderer");var readyStateCheckInterval=setInterval(checkReady,100);try{"object"!==_typeof$3(exports)&&(window.bodymovin=lottie)}catch(err){}var ShapeModifiers=function(){var e={},t={};return e.registerModifier=function(e,n){t[e]||(t[e]=n)},e.getModifier=function(e,n,r){return new t[e](n,r)},e}();function ShapeModifier(){}function TrimModifier(){}function PuckerAndBloatModifier(){}ShapeModifier.prototype.initModifierProperties=function(){},ShapeModifier.prototype.addShapeToModifier=function(){},ShapeModifier.prototype.addShape=function(e){if(!this.closed){e.sh.container.addDynamicProperty(e.sh);var t={shape:e.sh,data:e,localShapeCollection:shapeCollectionPool.newShapeCollection()};this.shapes.push(t),this.addShapeToModifier(t),this._isAnimated&&e.setAsAnimated()}},ShapeModifier.prototype.init=function(e,t){this.shapes=[],this.elem=e,this.initDynamicPropertyContainer(e),this.initModifierProperties(e,t),this.frameId=initialDefaultFrame,this.closed=!1,this.k=!1,this.dynamicProperties.length?this.k=!0:this.getValue(!0)},ShapeModifier.prototype.processKeys=function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties())},extendPrototype([DynamicPropertyContainer],ShapeModifier),extendPrototype([ShapeModifier],TrimModifier),TrimModifier.prototype.initModifierProperties=function(e,t){this.s=PropertyFactory.getProp(e,t.s,0,.01,this),this.e=PropertyFactory.getProp(e,t.e,0,.01,this),this.o=PropertyFactory.getProp(e,t.o,0,0,this),this.sValue=0,this.eValue=0,this.getValue=this.processKeys,this.m=t.m,this._isAnimated=!!this.s.effectsSequence.length||!!this.e.effectsSequence.length||!!this.o.effectsSequence.length},TrimModifier.prototype.addShapeToModifier=function(e){e.pathsData=[]},TrimModifier.prototype.calculateShapeEdges=function(e,t,n,r,a){var i=[];t<=1?i.push({s:e,e:t}):e>=1?i.push({s:e-1,e:t-1}):(i.push({s:e,e:1}),i.push({s:0,e:t-1}));var s,o,l=[],u=i.length;for(s=0;s<u;s+=1){var c,h;(o=i[s]).e*a<r||o.s*a>r+n||(c=o.s*a<=r?0:(o.s*a-r)/n,h=o.e*a>=r+n?1:(o.e*a-r)/n,l.push([c,h]))}return l.length||l.push([0,0]),l},TrimModifier.prototype.releasePathsData=function(e){var t,n=e.length;for(t=0;t<n;t+=1)segmentsLengthPool.release(e[t]);return e.length=0,e},TrimModifier.prototype.processShapes=function(e){var t,n,r,a;if(this._mdf||e){var i=this.o.v%360/360;if(i<0&&(i+=1),(t=this.s.v>1?1+i:this.s.v<0?0+i:this.s.v+i)>(n=this.e.v>1?1+i:this.e.v<0?0+i:this.e.v+i)){var s=t;t=n,n=s}t=1e-4*Math.round(1e4*t),n=1e-4*Math.round(1e4*n),this.sValue=t,this.eValue=n}else t=this.sValue,n=this.eValue;var o,l,u,c,h,d=this.shapes.length,p=0;if(n===t)for(a=0;a<d;a+=1)this.shapes[a].localShapeCollection.releaseShapes(),this.shapes[a].shape._mdf=!0,this.shapes[a].shape.paths=this.shapes[a].localShapeCollection,this._mdf&&(this.shapes[a].pathsData.length=0);else if(1===n&&0===t||0===n&&1===t){if(this._mdf)for(a=0;a<d;a+=1)this.shapes[a].pathsData.length=0,this.shapes[a].shape._mdf=!0}else{var f,m,g=[];for(a=0;a<d;a+=1)if((f=this.shapes[a]).shape._mdf||this._mdf||e||2===this.m){if(l=(r=f.shape.paths)._length,h=0,!f.shape._mdf&&f.pathsData.length)h=f.totalShapeLength;else{for(u=this.releasePathsData(f.pathsData),o=0;o<l;o+=1)c=bez.getSegmentsLength(r.shapes[o]),u.push(c),h+=c.totalLength;f.totalShapeLength=h,f.pathsData=u}p+=h,f.shape._mdf=!0}else f.shape.paths=f.localShapeCollection;var y,v=t,b=n,x=0;for(a=d-1;a>=0;a-=1)if((f=this.shapes[a]).shape._mdf){for((m=f.localShapeCollection).releaseShapes(),2===this.m&&d>1?(y=this.calculateShapeEdges(t,n,f.totalShapeLength,x,p),x+=f.totalShapeLength):y=[[v,b]],l=y.length,o=0;o<l;o+=1){v=y[o][0],b=y[o][1],g.length=0,b<=1?g.push({s:f.totalShapeLength*v,e:f.totalShapeLength*b}):v>=1?g.push({s:f.totalShapeLength*(v-1),e:f.totalShapeLength*(b-1)}):(g.push({s:f.totalShapeLength*v,e:f.totalShapeLength}),g.push({s:0,e:f.totalShapeLength*(b-1)}));var T=this.addShapes(f,g[0]);if(g[0].s!==g[0].e){if(g.length>1)if(f.shape.paths.shapes[f.shape.paths._length-1].c){var _=T.pop();this.addPaths(T,m),T=this.addShapes(f,g[1],_)}else this.addPaths(T,m),T=this.addShapes(f,g[1]);this.addPaths(T,m)}}f.shape.paths=m}}},TrimModifier.prototype.addPaths=function(e,t){var n,r=e.length;for(n=0;n<r;n+=1)t.addShape(e[n])},TrimModifier.prototype.addSegment=function(e,t,n,r,a,i,s){a.setXYAt(t[0],t[1],"o",i),a.setXYAt(n[0],n[1],"i",i+1),s&&a.setXYAt(e[0],e[1],"v",i),a.setXYAt(r[0],r[1],"v",i+1)},TrimModifier.prototype.addSegmentFromArray=function(e,t,n,r){t.setXYAt(e[1],e[5],"o",n),t.setXYAt(e[2],e[6],"i",n+1),r&&t.setXYAt(e[0],e[4],"v",n),t.setXYAt(e[3],e[7],"v",n+1)},TrimModifier.prototype.addShapes=function(e,t,n){var r,a,i,s,o,l,u,c,h=e.pathsData,d=e.shape.paths.shapes,p=e.shape.paths._length,f=0,m=[],g=!0;for(n?(o=n._length,c=n._length):(n=shapePool.newElement(),o=0,c=0),m.push(n),r=0;r<p;r+=1){for(l=h[r].lengths,n.c=d[r].c,i=d[r].c?l.length:l.length+1,a=1;a<i;a+=1)if(f+(s=l[a-1]).addedLength<t.s)f+=s.addedLength,n.c=!1;else{if(f>t.e){n.c=!1;break}t.s<=f&&t.e>=f+s.addedLength?(this.addSegment(d[r].v[a-1],d[r].o[a-1],d[r].i[a],d[r].v[a],n,o,g),g=!1):(u=bez.getNewSegment(d[r].v[a-1],d[r].v[a],d[r].o[a-1],d[r].i[a],(t.s-f)/s.addedLength,(t.e-f)/s.addedLength,l[a-1]),this.addSegmentFromArray(u,n,o,g),g=!1,n.c=!1),f+=s.addedLength,o+=1}if(d[r].c&&l.length){if(s=l[a-1],f<=t.e){var y=l[a-1].addedLength;t.s<=f&&t.e>=f+y?(this.addSegment(d[r].v[a-1],d[r].o[a-1],d[r].i[0],d[r].v[0],n,o,g),g=!1):(u=bez.getNewSegment(d[r].v[a-1],d[r].v[0],d[r].o[a-1],d[r].i[0],(t.s-f)/y,(t.e-f)/y,l[a-1]),this.addSegmentFromArray(u,n,o,g),g=!1,n.c=!1)}else n.c=!1;f+=s.addedLength,o+=1}if(n._length&&(n.setXYAt(n.v[c][0],n.v[c][1],"i",c),n.setXYAt(n.v[n._length-1][0],n.v[n._length-1][1],"o",n._length-1)),f>t.e)break;r<p-1&&(n=shapePool.newElement(),g=!0,m.push(n),o=0)}return m},extendPrototype([ShapeModifier],PuckerAndBloatModifier),PuckerAndBloatModifier.prototype.initModifierProperties=function(e,t){this.getValue=this.processKeys,this.amount=PropertyFactory.getProp(e,t.a,0,null,this),this._isAnimated=!!this.amount.effectsSequence.length},PuckerAndBloatModifier.prototype.processPath=function(e,t){var n=t/100,r=[0,0],a=e._length,i=0;for(i=0;i<a;i+=1)r[0]+=e.v[i][0],r[1]+=e.v[i][1];r[0]/=a,r[1]/=a;var s,o,l,u,c,h,d=shapePool.newElement();for(d.c=e.c,i=0;i<a;i+=1)s=e.v[i][0]+(r[0]-e.v[i][0])*n,o=e.v[i][1]+(r[1]-e.v[i][1])*n,l=e.o[i][0]+(r[0]-e.o[i][0])*-n,u=e.o[i][1]+(r[1]-e.o[i][1])*-n,c=e.i[i][0]+(r[0]-e.i[i][0])*-n,h=e.i[i][1]+(r[1]-e.i[i][1])*-n,d.setTripleAt(s,o,l,u,c,h,i);return d},PuckerAndBloatModifier.prototype.processShapes=function(e){var t,n,r,a,i,s,o=this.shapes.length,l=this.amount.v;if(0!==l)for(n=0;n<o;n+=1){if(s=(i=this.shapes[n]).localShapeCollection,i.shape._mdf||this._mdf||e)for(s.releaseShapes(),i.shape._mdf=!0,t=i.shape.paths.shapes,a=i.shape.paths._length,r=0;r<a;r+=1)s.addShape(this.processPath(t[r],l));i.shape.paths=i.localShapeCollection}this.dynamicProperties.length||(this._mdf=!1)};var TransformPropertyFactory=function(){var e=[0,0];function t(e,t,n){if(this.elem=e,this.frameId=-1,this.propType="transform",this.data=t,this.v=new Matrix,this.pre=new Matrix,this.appliedTransformations=0,this.initDynamicPropertyContainer(n||e),t.p&&t.p.s?(this.px=PropertyFactory.getProp(e,t.p.x,0,0,this),this.py=PropertyFactory.getProp(e,t.p.y,0,0,this),t.p.z&&(this.pz=PropertyFactory.getProp(e,t.p.z,0,0,this))):this.p=PropertyFactory.getProp(e,t.p||{k:[0,0,0]},1,0,this),t.rx){if(this.rx=PropertyFactory.getProp(e,t.rx,0,degToRads,this),this.ry=PropertyFactory.getProp(e,t.ry,0,degToRads,this),this.rz=PropertyFactory.getProp(e,t.rz,0,degToRads,this),t.or.k[0].ti){var r,a=t.or.k.length;for(r=0;r<a;r+=1)t.or.k[r].to=null,t.or.k[r].ti=null}this.or=PropertyFactory.getProp(e,t.or,1,degToRads,this),this.or.sh=!0}else this.r=PropertyFactory.getProp(e,t.r||{k:0},0,degToRads,this);t.sk&&(this.sk=PropertyFactory.getProp(e,t.sk,0,degToRads,this),this.sa=PropertyFactory.getProp(e,t.sa,0,degToRads,this)),this.a=PropertyFactory.getProp(e,t.a||{k:[0,0,0]},1,0,this),this.s=PropertyFactory.getProp(e,t.s||{k:[100,100,100]},1,.01,this),t.o?this.o=PropertyFactory.getProp(e,t.o,0,.01,e):this.o={_mdf:!1,v:1},this._isDirty=!0,this.dynamicProperties.length||this.getValue(!0)}return t.prototype={applyToMatrix:function(e){var t=this._mdf;this.iterateDynamicProperties(),this._mdf=this._mdf||t,this.a&&e.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.s&&e.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.sk&&e.skewFromAxis(-this.sk.v,this.sa.v),this.r?e.rotate(-this.r.v):e.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.data.p.s?this.data.p.z?e.translate(this.px.v,this.py.v,-this.pz.v):e.translate(this.px.v,this.py.v,0):e.translate(this.p.v[0],this.p.v[1],-this.p.v[2])},getValue:function(t){if(this.elem.globalData.frameId!==this.frameId){if(this._isDirty&&(this.precalculateMatrix(),this._isDirty=!1),this.iterateDynamicProperties(),this._mdf||t){var n;if(this.v.cloneFromProps(this.pre.props),this.appliedTransformations<1&&this.v.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.appliedTransformations<2&&this.v.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.sk&&this.appliedTransformations<3&&this.v.skewFromAxis(-this.sk.v,this.sa.v),this.r&&this.appliedTransformations<4?this.v.rotate(-this.r.v):!this.r&&this.appliedTransformations<4&&this.v.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.autoOriented){var r,a;if(n=this.elem.globalData.frameRate,this.p&&this.p.keyframes&&this.p.getValueAtTime)this.p._caching.lastFrame+this.p.offsetTime<=this.p.keyframes[0].t?(r=this.p.getValueAtTime((this.p.keyframes[0].t+.01)/n,0),a=this.p.getValueAtTime(this.p.keyframes[0].t/n,0)):this.p._caching.lastFrame+this.p.offsetTime>=this.p.keyframes[this.p.keyframes.length-1].t?(r=this.p.getValueAtTime(this.p.keyframes[this.p.keyframes.length-1].t/n,0),a=this.p.getValueAtTime((this.p.keyframes[this.p.keyframes.length-1].t-.05)/n,0)):(r=this.p.pv,a=this.p.getValueAtTime((this.p._caching.lastFrame+this.p.offsetTime-.01)/n,this.p.offsetTime));else if(this.px&&this.px.keyframes&&this.py.keyframes&&this.px.getValueAtTime&&this.py.getValueAtTime){r=[],a=[];var i=this.px,s=this.py;i._caching.lastFrame+i.offsetTime<=i.keyframes[0].t?(r[0]=i.getValueAtTime((i.keyframes[0].t+.01)/n,0),r[1]=s.getValueAtTime((s.keyframes[0].t+.01)/n,0),a[0]=i.getValueAtTime(i.keyframes[0].t/n,0),a[1]=s.getValueAtTime(s.keyframes[0].t/n,0)):i._caching.lastFrame+i.offsetTime>=i.keyframes[i.keyframes.length-1].t?(r[0]=i.getValueAtTime(i.keyframes[i.keyframes.length-1].t/n,0),r[1]=s.getValueAtTime(s.keyframes[s.keyframes.length-1].t/n,0),a[0]=i.getValueAtTime((i.keyframes[i.keyframes.length-1].t-.01)/n,0),a[1]=s.getValueAtTime((s.keyframes[s.keyframes.length-1].t-.01)/n,0)):(r=[i.pv,s.pv],a[0]=i.getValueAtTime((i._caching.lastFrame+i.offsetTime-.01)/n,i.offsetTime),a[1]=s.getValueAtTime((s._caching.lastFrame+s.offsetTime-.01)/n,s.offsetTime))}else r=a=e;this.v.rotate(-Math.atan2(r[1]-a[1],r[0]-a[0]))}this.data.p&&this.data.p.s?this.data.p.z?this.v.translate(this.px.v,this.py.v,-this.pz.v):this.v.translate(this.px.v,this.py.v,0):this.v.translate(this.p.v[0],this.p.v[1],-this.p.v[2])}this.frameId=this.elem.globalData.frameId}},precalculateMatrix:function(){if(this.appliedTransformations=0,this.pre.reset(),!this.a.effectsSequence.length&&(this.pre.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.appliedTransformations=1,!this.s.effectsSequence.length)){if(this.pre.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.appliedTransformations=2,this.sk){if(this.sk.effectsSequence.length||this.sa.effectsSequence.length)return;this.pre.skewFromAxis(-this.sk.v,this.sa.v),this.appliedTransformations=3}this.r?this.r.effectsSequence.length||(this.pre.rotate(-this.r.v),this.appliedTransformations=4):this.rz.effectsSequence.length||this.ry.effectsSequence.length||this.rx.effectsSequence.length||this.or.effectsSequence.length||(this.pre.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.appliedTransformations=4)}},autoOrient:function(){}},extendPrototype([DynamicPropertyContainer],t),t.prototype.addDynamicProperty=function(e){this._addDynamicProperty(e),this.elem.addDynamicProperty(e),this._isDirty=!0},t.prototype._addDynamicProperty=DynamicPropertyContainer.prototype.addDynamicProperty,{getTransformProperty:function(e,n,r){return new t(e,n,r)}}}();function RepeaterModifier(){}function RoundCornersModifier(){}function floatEqual(e,t){return 1e5*Math.abs(e-t)<=Math.min(Math.abs(e),Math.abs(t))}function floatZero(e){return Math.abs(e)<=1e-5}function lerp(e,t,n){return e*(1-n)+t*n}function lerpPoint(e,t,n){return[lerp(e[0],t[0],n),lerp(e[1],t[1],n)]}function quadRoots(e,t,n){if(0===e)return[];var r=t*t-4*e*n;if(r<0)return[];var a=-t/(2*e);if(0===r)return[a];var i=Math.sqrt(r)/(2*e);return[a-i,a+i]}function polynomialCoefficients(e,t,n,r){return[3*t-e-3*n+r,3*e-6*t+3*n,-3*e+3*t,e]}function singlePoint(e){return new PolynomialBezier(e,e,e,e,!1)}function PolynomialBezier(e,t,n,r,a){a&&pointEqual(e,t)&&(t=lerpPoint(e,r,1/3)),a&&pointEqual(n,r)&&(n=lerpPoint(e,r,2/3));var i=polynomialCoefficients(e[0],t[0],n[0],r[0]),s=polynomialCoefficients(e[1],t[1],n[1],r[1]);this.a=[i[0],s[0]],this.b=[i[1],s[1]],this.c=[i[2],s[2]],this.d=[i[3],s[3]],this.points=[e,t,n,r]}function extrema(e,t){var n=e.points[0][t],r=e.points[e.points.length-1][t];if(n>r){var a=r;r=n,n=a}for(var i=quadRoots(3*e.a[t],2*e.b[t],e.c[t]),s=0;s<i.length;s+=1)if(i[s]>0&&i[s]<1){var o=e.point(i[s])[t];o<n?n=o:o>r&&(r=o)}return{min:n,max:r}}function intersectData(e,t,n){var r=e.boundingBox();return{cx:r.cx,cy:r.cy,width:r.width,height:r.height,bez:e,t:(t+n)/2,t1:t,t2:n}}function splitData(e){var t=e.bez.split(.5);return[intersectData(t[0],e.t1,e.t),intersectData(t[1],e.t,e.t2)]}function boxIntersect(e,t){return 2*Math.abs(e.cx-t.cx)<e.width+t.width&&2*Math.abs(e.cy-t.cy)<e.height+t.height}function intersectsImpl(e,t,n,r,a,i){if(boxIntersect(e,t))if(n>=i||e.width<=r&&e.height<=r&&t.width<=r&&t.height<=r)a.push([e.t,t.t]);else{var s=splitData(e),o=splitData(t);intersectsImpl(s[0],o[0],n+1,r,a,i),intersectsImpl(s[0],o[1],n+1,r,a,i),intersectsImpl(s[1],o[0],n+1,r,a,i),intersectsImpl(s[1],o[1],n+1,r,a,i)}}function crossProduct(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function lineIntersection(e,t,n,r){var a=[e[0],e[1],1],i=[t[0],t[1],1],s=[n[0],n[1],1],o=[r[0],r[1],1],l=crossProduct(crossProduct(a,i),crossProduct(s,o));return floatZero(l[2])?null:[l[0]/l[2],l[1]/l[2]]}function polarOffset(e,t,n){return[e[0]+Math.cos(t)*n,e[1]-Math.sin(t)*n]}function pointDistance(e,t){return Math.hypot(e[0]-t[0],e[1]-t[1])}function pointEqual(e,t){return floatEqual(e[0],t[0])&&floatEqual(e[1],t[1])}function ZigZagModifier(){}function setPoint(e,t,n,r,a,i,s){var o=n-Math.PI/2,l=n+Math.PI/2,u=t[0]+Math.cos(n)*r*a,c=t[1]-Math.sin(n)*r*a;e.setTripleAt(u,c,u+Math.cos(o)*i,c-Math.sin(o)*i,u+Math.cos(l)*s,c-Math.sin(l)*s,e.length())}function getPerpendicularVector(e,t){var n=[t[0]-e[0],t[1]-e[1]],r=.5*-Math.PI;return[Math.cos(r)*n[0]-Math.sin(r)*n[1],Math.sin(r)*n[0]+Math.cos(r)*n[1]]}function getProjectingAngle(e,t){var n=0===t?e.length()-1:t-1,r=(t+1)%e.length(),a=getPerpendicularVector(e.v[n],e.v[r]);return Math.atan2(0,1)-Math.atan2(a[1],a[0])}function zigZagCorner(e,t,n,r,a,i,s){var o=getProjectingAngle(t,n),l=t.v[n%t._length],u=t.v[0===n?t._length-1:n-1],c=t.v[(n+1)%t._length],h=2===i?Math.sqrt(Math.pow(l[0]-u[0],2)+Math.pow(l[1]-u[1],2)):0,d=2===i?Math.sqrt(Math.pow(l[0]-c[0],2)+Math.pow(l[1]-c[1],2)):0;setPoint(e,t.v[n%t._length],o,s,r,d/(2*(a+1)),h/(2*(a+1)))}function zigZagSegment(e,t,n,r,a,i){for(var s=0;s<r;s+=1){var o=(s+1)/(r+1),l=2===a?Math.sqrt(Math.pow(t.points[3][0]-t.points[0][0],2)+Math.pow(t.points[3][1]-t.points[0][1],2)):0,u=t.normalAngle(o);setPoint(e,t.point(o),u,i,n,l/(2*(r+1)),l/(2*(r+1))),i=-i}return i}function linearOffset(e,t,n){var r=Math.atan2(t[0]-e[0],t[1]-e[1]);return[polarOffset(e,r,n),polarOffset(t,r,n)]}function offsetSegment(e,t){var n,r,a,i,s,o,l;n=(l=linearOffset(e.points[0],e.points[1],t))[0],r=l[1],a=(l=linearOffset(e.points[1],e.points[2],t))[0],i=l[1],s=(l=linearOffset(e.points[2],e.points[3],t))[0],o=l[1];var u=lineIntersection(n,r,a,i);null===u&&(u=r);var c=lineIntersection(s,o,a,i);return null===c&&(c=s),new PolynomialBezier(n,u,c,o)}function joinLines(e,t,n,r,a){var i=t.points[3],s=n.points[0];if(3===r)return i;if(pointEqual(i,s))return i;if(2===r){var o=-t.tangentAngle(1),l=-n.tangentAngle(0)+Math.PI,u=lineIntersection(i,polarOffset(i,o+Math.PI/2,100),s,polarOffset(s,o+Math.PI/2,100)),c=u?pointDistance(u,i):pointDistance(i,s)/2,h=polarOffset(i,o,2*c*roundCorner);return e.setXYAt(h[0],h[1],"o",e.length()-1),h=polarOffset(s,l,2*c*roundCorner),e.setTripleAt(s[0],s[1],s[0],s[1],h[0],h[1],e.length()),s}var d=lineIntersection(pointEqual(i,t.points[2])?t.points[0]:t.points[2],i,s,pointEqual(s,n.points[1])?n.points[3]:n.points[1]);return d&&pointDistance(d,i)<a?(e.setTripleAt(d[0],d[1],d[0],d[1],d[0],d[1],e.length()),d):i}function getIntersection(e,t){var n=e.intersections(t);return n.length&&floatEqual(n[0][0],1)&&n.shift(),n.length?n[0]:null}function pruneSegmentIntersection(e,t){var n=e.slice(),r=t.slice(),a=getIntersection(e[e.length-1],t[0]);return a&&(n[e.length-1]=e[e.length-1].split(a[0])[0],r[0]=t[0].split(a[1])[1]),e.length>1&&t.length>1&&(a=getIntersection(e[0],t[t.length-1]))?[[e[0].split(a[0])[0]],[t[t.length-1].split(a[1])[1]]]:[n,r]}function pruneIntersections(e){for(var t,n=1;n<e.length;n+=1)t=pruneSegmentIntersection(e[n-1],e[n]),e[n-1]=t[0],e[n]=t[1];return e.length>1&&(t=pruneSegmentIntersection(e[e.length-1],e[0]),e[e.length-1]=t[0],e[0]=t[1]),e}function offsetSegmentSplit(e,t){var n,r,a,i,s=e.inflectionPoints();if(0===s.length)return[offsetSegment(e,t)];if(1===s.length||floatEqual(s[1],1))return n=(a=e.split(s[0]))[0],r=a[1],[offsetSegment(n,t),offsetSegment(r,t)];n=(a=e.split(s[0]))[0];var o=(s[1]-s[0])/(1-s[0]);return i=(a=a[1].split(o))[0],r=a[1],[offsetSegment(n,t),offsetSegment(i,t),offsetSegment(r,t)]}function OffsetPathModifier(){}function getFontProperties(e){for(var t=e.fStyle?e.fStyle.split(" "):[],n="normal",r="normal",a=t.length,i=0;i<a;i+=1)switch(t[i].toLowerCase()){case"italic":r="italic";break;case"bold":n="700";break;case"black":n="900";break;case"medium":n="500";break;case"regular":case"normal":n="400";break;case"light":case"thin":n="200"}return{style:r,weight:e.fWeight||n}}extendPrototype([ShapeModifier],RepeaterModifier),RepeaterModifier.prototype.initModifierProperties=function(e,t){this.getValue=this.processKeys,this.c=PropertyFactory.getProp(e,t.c,0,null,this),this.o=PropertyFactory.getProp(e,t.o,0,null,this),this.tr=TransformPropertyFactory.getTransformProperty(e,t.tr,this),this.so=PropertyFactory.getProp(e,t.tr.so,0,.01,this),this.eo=PropertyFactory.getProp(e,t.tr.eo,0,.01,this),this.data=t,this.dynamicProperties.length||this.getValue(!0),this._isAnimated=!!this.dynamicProperties.length,this.pMatrix=new Matrix,this.rMatrix=new Matrix,this.sMatrix=new Matrix,this.tMatrix=new Matrix,this.matrix=new Matrix},RepeaterModifier.prototype.applyTransforms=function(e,t,n,r,a,i){var s=i?-1:1,o=r.s.v[0]+(1-r.s.v[0])*(1-a),l=r.s.v[1]+(1-r.s.v[1])*(1-a);e.translate(r.p.v[0]*s*a,r.p.v[1]*s*a,r.p.v[2]),t.translate(-r.a.v[0],-r.a.v[1],r.a.v[2]),t.rotate(-r.r.v*s*a),t.translate(r.a.v[0],r.a.v[1],r.a.v[2]),n.translate(-r.a.v[0],-r.a.v[1],r.a.v[2]),n.scale(i?1/o:o,i?1/l:l),n.translate(r.a.v[0],r.a.v[1],r.a.v[2])},RepeaterModifier.prototype.init=function(e,t,n,r){for(this.elem=e,this.arr=t,this.pos=n,this.elemsData=r,this._currentCopies=0,this._elements=[],this._groups=[],this.frameId=-1,this.initDynamicPropertyContainer(e),this.initModifierProperties(e,t[n]);n>0;)n-=1,this._elements.unshift(t[n]);this.dynamicProperties.length?this.k=!0:this.getValue(!0)},RepeaterModifier.prototype.resetElements=function(e){var t,n=e.length;for(t=0;t<n;t+=1)e[t]._processed=!1,"gr"===e[t].ty&&this.resetElements(e[t].it)},RepeaterModifier.prototype.cloneElements=function(e){var t=JSON.parse(JSON.stringify(e));return this.resetElements(t),t},RepeaterModifier.prototype.changeGroupRender=function(e,t){var n,r=e.length;for(n=0;n<r;n+=1)e[n]._render=t,"gr"===e[n].ty&&this.changeGroupRender(e[n].it,t)},RepeaterModifier.prototype.processShapes=function(e){var t,n,r,a,i,s=!1;if(this._mdf||e){var o,l=Math.ceil(this.c.v);if(this._groups.length<l){for(;this._groups.length<l;){var u={it:this.cloneElements(this._elements),ty:"gr"};u.it.push({a:{a:0,ix:1,k:[0,0]},nm:"Transform",o:{a:0,ix:7,k:100},p:{a:0,ix:2,k:[0,0]},r:{a:1,ix:6,k:[{s:0,e:0,t:0},{s:0,e:0,t:1}]},s:{a:0,ix:3,k:[100,100]},sa:{a:0,ix:5,k:0},sk:{a:0,ix:4,k:0},ty:"tr"}),this.arr.splice(0,0,u),this._groups.splice(0,0,u),this._currentCopies+=1}this.elem.reloadShapes(),s=!0}for(i=0,r=0;r<=this._groups.length-1;r+=1){if(o=i<l,this._groups[r]._render=o,this.changeGroupRender(this._groups[r].it,o),!o){var c=this.elemsData[r].it,h=c[c.length-1];0!==h.transform.op.v?(h.transform.op._mdf=!0,h.transform.op.v=0):h.transform.op._mdf=!1}i+=1}this._currentCopies=l;var d=this.o.v,p=d%1,f=d>0?Math.floor(d):Math.ceil(d),m=this.pMatrix.props,g=this.rMatrix.props,y=this.sMatrix.props;this.pMatrix.reset(),this.rMatrix.reset(),this.sMatrix.reset(),this.tMatrix.reset(),this.matrix.reset();var v,b,x=0;if(d>0){for(;x<f;)this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!1),x+=1;p&&(this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,p,!1),x+=p)}else if(d<0){for(;x>f;)this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!0),x-=1;p&&(this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,-p,!0),x-=p)}for(r=1===this.data.m?0:this._currentCopies-1,a=1===this.data.m?1:-1,i=this._currentCopies;i;){if(b=(n=(t=this.elemsData[r].it)[t.length-1].transform.mProps.v.props).length,t[t.length-1].transform.mProps._mdf=!0,t[t.length-1].transform.op._mdf=!0,t[t.length-1].transform.op.v=1===this._currentCopies?this.so.v:this.so.v+(this.eo.v-this.so.v)*(r/(this._currentCopies-1)),0!==x){for((0!==r&&1===a||r!==this._currentCopies-1&&-1===a)&&this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!1),this.matrix.transform(g[0],g[1],g[2],g[3],g[4],g[5],g[6],g[7],g[8],g[9],g[10],g[11],g[12],g[13],g[14],g[15]),this.matrix.transform(y[0],y[1],y[2],y[3],y[4],y[5],y[6],y[7],y[8],y[9],y[10],y[11],y[12],y[13],y[14],y[15]),this.matrix.transform(m[0],m[1],m[2],m[3],m[4],m[5],m[6],m[7],m[8],m[9],m[10],m[11],m[12],m[13],m[14],m[15]),v=0;v<b;v+=1)n[v]=this.matrix.props[v];this.matrix.reset()}else for(this.matrix.reset(),v=0;v<b;v+=1)n[v]=this.matrix.props[v];x+=1,i-=1,r+=a}}else for(i=this._currentCopies,r=0,a=1;i;)n=(t=this.elemsData[r].it)[t.length-1].transform.mProps.v.props,t[t.length-1].transform.mProps._mdf=!1,t[t.length-1].transform.op._mdf=!1,i-=1,r+=a;return s},RepeaterModifier.prototype.addShape=function(){},extendPrototype([ShapeModifier],RoundCornersModifier),RoundCornersModifier.prototype.initModifierProperties=function(e,t){this.getValue=this.processKeys,this.rd=PropertyFactory.getProp(e,t.r,0,null,this),this._isAnimated=!!this.rd.effectsSequence.length},RoundCornersModifier.prototype.processPath=function(e,t){var n,r=shapePool.newElement();r.c=e.c;var a,i,s,o,l,u,c,h,d,p,f,m,g=e._length,y=0;for(n=0;n<g;n+=1)a=e.v[n],s=e.o[n],i=e.i[n],a[0]===s[0]&&a[1]===s[1]&&a[0]===i[0]&&a[1]===i[1]?0!==n&&n!==g-1||e.c?(o=0===n?e.v[g-1]:e.v[n-1],u=(l=Math.sqrt(Math.pow(a[0]-o[0],2)+Math.pow(a[1]-o[1],2)))?Math.min(l/2,t)/l:0,c=f=a[0]+(o[0]-a[0])*u,h=m=a[1]-(a[1]-o[1])*u,d=c-(c-a[0])*roundCorner,p=h-(h-a[1])*roundCorner,r.setTripleAt(c,h,d,p,f,m,y),y+=1,o=n===g-1?e.v[0]:e.v[n+1],u=(l=Math.sqrt(Math.pow(a[0]-o[0],2)+Math.pow(a[1]-o[1],2)))?Math.min(l/2,t)/l:0,c=d=a[0]+(o[0]-a[0])*u,h=p=a[1]+(o[1]-a[1])*u,f=c-(c-a[0])*roundCorner,m=h-(h-a[1])*roundCorner,r.setTripleAt(c,h,d,p,f,m,y),y+=1):(r.setTripleAt(a[0],a[1],s[0],s[1],i[0],i[1],y),y+=1):(r.setTripleAt(e.v[n][0],e.v[n][1],e.o[n][0],e.o[n][1],e.i[n][0],e.i[n][1],y),y+=1);return r},RoundCornersModifier.prototype.processShapes=function(e){var t,n,r,a,i,s,o=this.shapes.length,l=this.rd.v;if(0!==l)for(n=0;n<o;n+=1){if(s=(i=this.shapes[n]).localShapeCollection,i.shape._mdf||this._mdf||e)for(s.releaseShapes(),i.shape._mdf=!0,t=i.shape.paths.shapes,a=i.shape.paths._length,r=0;r<a;r+=1)s.addShape(this.processPath(t[r],l));i.shape.paths=i.localShapeCollection}this.dynamicProperties.length||(this._mdf=!1)},PolynomialBezier.prototype.point=function(e){return[((this.a[0]*e+this.b[0])*e+this.c[0])*e+this.d[0],((this.a[1]*e+this.b[1])*e+this.c[1])*e+this.d[1]]},PolynomialBezier.prototype.derivative=function(e){return[(3*e*this.a[0]+2*this.b[0])*e+this.c[0],(3*e*this.a[1]+2*this.b[1])*e+this.c[1]]},PolynomialBezier.prototype.tangentAngle=function(e){var t=this.derivative(e);return Math.atan2(t[1],t[0])},PolynomialBezier.prototype.normalAngle=function(e){var t=this.derivative(e);return Math.atan2(t[0],t[1])},PolynomialBezier.prototype.inflectionPoints=function(){var e=this.a[1]*this.b[0]-this.a[0]*this.b[1];if(floatZero(e))return[];var t=-.5*(this.a[1]*this.c[0]-this.a[0]*this.c[1])/e,n=t*t-1/3*(this.b[1]*this.c[0]-this.b[0]*this.c[1])/e;if(n<0)return[];var r=Math.sqrt(n);return floatZero(r)?r>0&&r<1?[t]:[]:[t-r,t+r].filter((function(e){return e>0&&e<1}))},PolynomialBezier.prototype.split=function(e){if(e<=0)return[singlePoint(this.points[0]),this];if(e>=1)return[this,singlePoint(this.points[this.points.length-1])];var t=lerpPoint(this.points[0],this.points[1],e),n=lerpPoint(this.points[1],this.points[2],e),r=lerpPoint(this.points[2],this.points[3],e),a=lerpPoint(t,n,e),i=lerpPoint(n,r,e),s=lerpPoint(a,i,e);return[new PolynomialBezier(this.points[0],t,a,s,!0),new PolynomialBezier(s,i,r,this.points[3],!0)]},PolynomialBezier.prototype.bounds=function(){return{x:extrema(this,0),y:extrema(this,1)}},PolynomialBezier.prototype.boundingBox=function(){var e=this.bounds();return{left:e.x.min,right:e.x.max,top:e.y.min,bottom:e.y.max,width:e.x.max-e.x.min,height:e.y.max-e.y.min,cx:(e.x.max+e.x.min)/2,cy:(e.y.max+e.y.min)/2}},PolynomialBezier.prototype.intersections=function(e,t,n){void 0===t&&(t=2),void 0===n&&(n=7);var r=[];return intersectsImpl(intersectData(this,0,1),intersectData(e,0,1),0,t,r,n),r},PolynomialBezier.shapeSegment=function(e,t){var n=(t+1)%e.length();return new PolynomialBezier(e.v[t],e.o[t],e.i[n],e.v[n],!0)},PolynomialBezier.shapeSegmentInverted=function(e,t){var n=(t+1)%e.length();return new PolynomialBezier(e.v[n],e.i[n],e.o[t],e.v[t],!0)},extendPrototype([ShapeModifier],ZigZagModifier),ZigZagModifier.prototype.initModifierProperties=function(e,t){this.getValue=this.processKeys,this.amplitude=PropertyFactory.getProp(e,t.s,0,null,this),this.frequency=PropertyFactory.getProp(e,t.r,0,null,this),this.pointsType=PropertyFactory.getProp(e,t.pt,0,null,this),this._isAnimated=0!==this.amplitude.effectsSequence.length||0!==this.frequency.effectsSequence.length||0!==this.pointsType.effectsSequence.length},ZigZagModifier.prototype.processPath=function(e,t,n,r){var a=e._length,i=shapePool.newElement();if(i.c=e.c,e.c||(a-=1),0===a)return i;var s=-1,o=PolynomialBezier.shapeSegment(e,0);zigZagCorner(i,e,0,t,n,r,s);for(var l=0;l<a;l+=1)s=zigZagSegment(i,o,t,n,r,-s),o=l!==a-1||e.c?PolynomialBezier.shapeSegment(e,(l+1)%a):null,zigZagCorner(i,e,l+1,t,n,r,s);return i},ZigZagModifier.prototype.processShapes=function(e){var t,n,r,a,i,s,o=this.shapes.length,l=this.amplitude.v,u=Math.max(0,Math.round(this.frequency.v)),c=this.pointsType.v;if(0!==l)for(n=0;n<o;n+=1){if(s=(i=this.shapes[n]).localShapeCollection,i.shape._mdf||this._mdf||e)for(s.releaseShapes(),i.shape._mdf=!0,t=i.shape.paths.shapes,a=i.shape.paths._length,r=0;r<a;r+=1)s.addShape(this.processPath(t[r],l,u,c));i.shape.paths=i.localShapeCollection}this.dynamicProperties.length||(this._mdf=!1)},extendPrototype([ShapeModifier],OffsetPathModifier),OffsetPathModifier.prototype.initModifierProperties=function(e,t){this.getValue=this.processKeys,this.amount=PropertyFactory.getProp(e,t.a,0,null,this),this.miterLimit=PropertyFactory.getProp(e,t.ml,0,null,this),this.lineJoin=t.lj,this._isAnimated=0!==this.amount.effectsSequence.length},OffsetPathModifier.prototype.processPath=function(e,t,n,r){var a=shapePool.newElement();a.c=e.c;var i,s,o,l=e.length();e.c||(l-=1);var u=[];for(i=0;i<l;i+=1)o=PolynomialBezier.shapeSegment(e,i),u.push(offsetSegmentSplit(o,t));if(!e.c)for(i=l-1;i>=0;i-=1)o=PolynomialBezier.shapeSegmentInverted(e,i),u.push(offsetSegmentSplit(o,t));u=pruneIntersections(u);var c=null,h=null;for(i=0;i<u.length;i+=1){var d=u[i];for(h&&(c=joinLines(a,h,d[0],n,r)),h=d[d.length-1],s=0;s<d.length;s+=1)o=d[s],c&&pointEqual(o.points[0],c)?a.setXYAt(o.points[1][0],o.points[1][1],"o",a.length()-1):a.setTripleAt(o.points[0][0],o.points[0][1],o.points[1][0],o.points[1][1],o.points[0][0],o.points[0][1],a.length()),a.setTripleAt(o.points[3][0],o.points[3][1],o.points[3][0],o.points[3][1],o.points[2][0],o.points[2][1],a.length()),c=o.points[3]}return u.length&&joinLines(a,h,u[0][0],n,r),a},OffsetPathModifier.prototype.processShapes=function(e){var t,n,r,a,i,s,o=this.shapes.length,l=this.amount.v,u=this.miterLimit.v,c=this.lineJoin;if(0!==l)for(n=0;n<o;n+=1){if(s=(i=this.shapes[n]).localShapeCollection,i.shape._mdf||this._mdf||e)for(s.releaseShapes(),i.shape._mdf=!0,t=i.shape.paths.shapes,a=i.shape.paths._length,r=0;r<a;r+=1)s.addShape(this.processPath(t[r],l,c,u));i.shape.paths=i.localShapeCollection}this.dynamicProperties.length||(this._mdf=!1)};var FontManager=function(){var e={w:0,size:0,shapes:[],data:{shapes:[]}},t=[];t=t.concat([2304,2305,2306,2307,2362,2363,2364,2364,2366,2367,2368,2369,2370,2371,2372,2373,2374,2375,2376,2377,2378,2379,2380,2381,2382,2383,2387,2388,2389,2390,2391,2402,2403]);var n=127988,r=127462,a=127487,i=["d83cdffb","d83cdffc","d83cdffd","d83cdffe","d83cdfff"];function s(e,t){var n=createTag("span");n.setAttribute("aria-hidden",!0),n.style.fontFamily=t;var r=createTag("span");r.innerText="giItT1WQy@!-/#",n.style.position="absolute",n.style.left="-10000px",n.style.top="-10000px",n.style.fontSize="300px",n.style.fontVariant="normal",n.style.fontStyle="normal",n.style.fontWeight="normal",n.style.letterSpacing="0",n.appendChild(r),document.body.appendChild(n);var a=r.offsetWidth;return r.style.fontFamily=function(e){var t,n=e.split(","),r=n.length,a=[];for(t=0;t<r;t+=1)"sans-serif"!==n[t]&&"monospace"!==n[t]&&a.push(n[t]);return a.join(",")}(e)+", "+t,{node:r,w:a,parent:n}}function o(e,t){var n,r=document.body&&t?"svg":"canvas",a=getFontProperties(e);if("svg"===r){var i=createNS("text");i.style.fontSize="100px",i.setAttribute("font-family",e.fFamily),i.setAttribute("font-style",a.style),i.setAttribute("font-weight",a.weight),i.textContent="1",e.fClass?(i.style.fontFamily="inherit",i.setAttribute("class",e.fClass)):i.style.fontFamily=e.fFamily,t.appendChild(i),n=i}else{var s=new OffscreenCanvas(500,500).getContext("2d");s.font=a.style+" "+a.weight+" 100px "+e.fFamily,n=s}return{measureText:function(e){return"svg"===r?(n.textContent=e,n.getComputedTextLength()):n.measureText(e).width}}}function l(e){var t=0,n=e.charCodeAt(0);if(n>=55296&&n<=56319){var r=e.charCodeAt(1);r>=56320&&r<=57343&&(t=1024*(n-55296)+r-56320+65536)}return t}function u(e){var t=l(e);return t>=r&&t<=a}var c=function(){this.fonts=[],this.chars=null,this.typekitLoaded=0,this.isLoaded=!1,this._warned=!1,this.initTime=Date.now(),this.setIsLoadedBinded=this.setIsLoaded.bind(this),this.checkLoadedFontsBinded=this.checkLoadedFonts.bind(this)};return c.isModifier=function(e,t){var n=e.toString(16)+t.toString(16);return-1!==i.indexOf(n)},c.isZeroWidthJoiner=function(e){return 8205===e},c.isFlagEmoji=function(e){return u(e.substr(0,2))&&u(e.substr(2,2))},c.isRegionalCode=u,c.isCombinedCharacter=function(e){return-1!==t.indexOf(e)},c.isRegionalFlag=function(e,t){var r=l(e.substr(t,2));if(r!==n)return!1;var a=0;for(t+=2;a<5;){if((r=l(e.substr(t,2)))<917601||r>917626)return!1;a+=1,t+=2}return 917631===l(e.substr(t,2))},c.isVariationSelector=function(e){return 65039===e},c.BLACK_FLAG_CODE_POINT=n,c.prototype={addChars:function(e){if(e){var t;this.chars||(this.chars=[]);var n,r,a=e.length,i=this.chars.length;for(t=0;t<a;t+=1){for(n=0,r=!1;n<i;)this.chars[n].style===e[t].style&&this.chars[n].fFamily===e[t].fFamily&&this.chars[n].ch===e[t].ch&&(r=!0),n+=1;r||(this.chars.push(e[t]),i+=1)}}},addFonts:function(e,t){if(e){if(this.chars)return this.isLoaded=!0,void(this.fonts=e.list);if(!document.body)return this.isLoaded=!0,e.list.forEach((function(e){e.helper=o(e),e.cache={}})),void(this.fonts=e.list);var n,r=e.list,a=r.length,i=a;for(n=0;n<a;n+=1){var l,u,c=!0;if(r[n].loaded=!1,r[n].monoCase=s(r[n].fFamily,"monospace"),r[n].sansCase=s(r[n].fFamily,"sans-serif"),r[n].fPath){if("p"===r[n].fOrigin||3===r[n].origin){if((l=document.querySelectorAll('style[f-forigin="p"][f-family="'+r[n].fFamily+'"], style[f-origin="3"][f-family="'+r[n].fFamily+'"]')).length>0&&(c=!1),c){var h=createTag("style");h.setAttribute("f-forigin",r[n].fOrigin),h.setAttribute("f-origin",r[n].origin),h.setAttribute("f-family",r[n].fFamily),h.type="text/css",h.innerText="@font-face {font-family: "+r[n].fFamily+"; font-style: normal; src: url('"+r[n].fPath+"');}",t.appendChild(h)}}else if("g"===r[n].fOrigin||1===r[n].origin){for(l=document.querySelectorAll('link[f-forigin="g"], link[f-origin="1"]'),u=0;u<l.length;u+=1)-1!==l[u].href.indexOf(r[n].fPath)&&(c=!1);if(c){var d=createTag("link");d.setAttribute("f-forigin",r[n].fOrigin),d.setAttribute("f-origin",r[n].origin),d.type="text/css",d.rel="stylesheet",d.href=r[n].fPath,document.body.appendChild(d)}}else if("t"===r[n].fOrigin||2===r[n].origin){for(l=document.querySelectorAll('script[f-forigin="t"], script[f-origin="2"]'),u=0;u<l.length;u+=1)r[n].fPath===l[u].src&&(c=!1);if(c){var p=createTag("link");p.setAttribute("f-forigin",r[n].fOrigin),p.setAttribute("f-origin",r[n].origin),p.setAttribute("rel","stylesheet"),p.setAttribute("href",r[n].fPath),t.appendChild(p)}}}else r[n].loaded=!0,i-=1;r[n].helper=o(r[n],t),r[n].cache={},this.fonts.push(r[n])}0===i?this.isLoaded=!0:setTimeout(this.checkLoadedFonts.bind(this),100)}else this.isLoaded=!0},getCharData:function(t,n,r){for(var a=0,i=this.chars.length;a<i;){if(this.chars[a].ch===t&&this.chars[a].style===n&&this.chars[a].fFamily===r)return this.chars[a];a+=1}return("string"==typeof t&&13!==t.charCodeAt(0)||!t)&&console&&console.warn&&!this._warned&&(this._warned=!0,console.warn("Missing character from exported characters list: ",t,n,r)),e},getFontByName:function(e){for(var t=0,n=this.fonts.length;t<n;){if(this.fonts[t].fName===e)return this.fonts[t];t+=1}return this.fonts[0]},measureText:function(e,t,n){var r=this.getFontByName(t),a=e;if(!r.cache[a]){var i=r.helper;if(" "===e){var s=i.measureText("|"+e+"|"),o=i.measureText("||");r.cache[a]=(s-o)/100}else r.cache[a]=i.measureText(e)/100}return r.cache[a]*n},checkLoadedFonts:function(){var e,t,n,r=this.fonts.length,a=r;for(e=0;e<r;e+=1)this.fonts[e].loaded?a-=1:"n"===this.fonts[e].fOrigin||0===this.fonts[e].origin?this.fonts[e].loaded=!0:(t=this.fonts[e].monoCase.node,n=this.fonts[e].monoCase.w,t.offsetWidth!==n?(a-=1,this.fonts[e].loaded=!0):(t=this.fonts[e].sansCase.node,n=this.fonts[e].sansCase.w,t.offsetWidth!==n&&(a-=1,this.fonts[e].loaded=!0)),this.fonts[e].loaded&&(this.fonts[e].sansCase.parent.parentNode.removeChild(this.fonts[e].sansCase.parent),this.fonts[e].monoCase.parent.parentNode.removeChild(this.fonts[e].monoCase.parent)));0!==a&&Date.now()-this.initTime<5e3?setTimeout(this.checkLoadedFontsBinded,20):setTimeout(this.setIsLoadedBinded,10)},setIsLoaded:function(){this.isLoaded=!0}},c}();function SlotManager(e){this.animationData=e}function slotFactory(e){return new SlotManager(e)}function RenderableElement(){}SlotManager.prototype.getProp=function(e){return this.animationData.slots&&this.animationData.slots[e.sid]?Object.assign(e,this.animationData.slots[e.sid].p):e},RenderableElement.prototype={initRenderable:function(){this.isInRange=!1,this.hidden=!1,this.isTransparent=!1,this.renderableComponents=[]},addRenderableComponent:function(e){-1===this.renderableComponents.indexOf(e)&&this.renderableComponents.push(e)},removeRenderableComponent:function(e){-1!==this.renderableComponents.indexOf(e)&&this.renderableComponents.splice(this.renderableComponents.indexOf(e),1)},prepareRenderableFrame:function(e){this.checkLayerLimits(e)},checkTransparency:function(){this.finalTransform.mProp.o.v<=0?!this.isTransparent&&this.globalData.renderConfig.hideOnTransparent&&(this.isTransparent=!0,this.hide()):this.isTransparent&&(this.isTransparent=!1,this.show())},checkLayerLimits:function(e){this.data.ip-this.data.st<=e&&this.data.op-this.data.st>e?!0!==this.isInRange&&(this.globalData._mdf=!0,this._mdf=!0,this.isInRange=!0,this.show()):!1!==this.isInRange&&(this.globalData._mdf=!0,this.isInRange=!1,this.hide())},renderRenderable:function(){var e,t=this.renderableComponents.length;for(e=0;e<t;e+=1)this.renderableComponents[e].renderFrame(this._isFirstFrame)},sourceRectAtTime:function(){return{top:0,left:0,width:100,height:100}},getLayerSize:function(){return 5===this.data.ty?{w:this.data.textData.width,h:this.data.textData.height}:{w:this.data.width,h:this.data.height}}};var getBlendMode=(blendModeEnums={0:"source-over",1:"multiply",2:"screen",3:"overlay",4:"darken",5:"lighten",6:"color-dodge",7:"color-burn",8:"hard-light",9:"soft-light",10:"difference",11:"exclusion",12:"hue",13:"saturation",14:"color",15:"luminosity"},function(e){return blendModeEnums[e]||""}),blendModeEnums;function SliderEffect(e,t,n){this.p=PropertyFactory.getProp(t,e.v,0,0,n)}function AngleEffect(e,t,n){this.p=PropertyFactory.getProp(t,e.v,0,0,n)}function ColorEffect(e,t,n){this.p=PropertyFactory.getProp(t,e.v,1,0,n)}function PointEffect(e,t,n){this.p=PropertyFactory.getProp(t,e.v,1,0,n)}function LayerIndexEffect(e,t,n){this.p=PropertyFactory.getProp(t,e.v,0,0,n)}function MaskIndexEffect(e,t,n){this.p=PropertyFactory.getProp(t,e.v,0,0,n)}function CheckboxEffect(e,t,n){this.p=PropertyFactory.getProp(t,e.v,0,0,n)}function NoValueEffect(){this.p={}}function EffectsManager(e,t){var n,r=e.ef||[];this.effectElements=[];var a,i=r.length;for(n=0;n<i;n+=1)a=new GroupEffect(r[n],t),this.effectElements.push(a)}function GroupEffect(e,t){this.init(e,t)}function BaseElement(){}function FrameElement(){}function FootageElement(e,t,n){this.initFrame(),this.initRenderable(),this.assetData=t.getAssetData(e.refId),this.footageData=t.imageLoader.getAsset(this.assetData),this.initBaseData(e,t,n)}function AudioElement(e,t,n){this.initFrame(),this.initRenderable(),this.assetData=t.getAssetData(e.refId),this.initBaseData(e,t,n),this._isPlaying=!1,this._canPlay=!1;var r=this.globalData.getAssetsPath(this.assetData);this.audio=this.globalData.audioController.createAudio(r),this._currentTime=0,this.globalData.audioController.addAudio(this),this._volumeMultiplier=1,this._volume=1,this._previousVolume=null,this.tm=e.tm?PropertyFactory.getProp(this,e.tm,0,t.frameRate,this):{_placeholder:!0},this.lv=PropertyFactory.getProp(this,e.au&&e.au.lv?e.au.lv:{k:[100]},1,.01,this)}function BaseRenderer(){}extendPrototype([DynamicPropertyContainer],GroupEffect),GroupEffect.prototype.getValue=GroupEffect.prototype.iterateDynamicProperties,GroupEffect.prototype.init=function(e,t){var n;this.data=e,this.effectElements=[],this.initDynamicPropertyContainer(t);var r,a=this.data.ef.length,i=this.data.ef;for(n=0;n<a;n+=1){switch(r=null,i[n].ty){case 0:r=new SliderEffect(i[n],t,this);break;case 1:r=new AngleEffect(i[n],t,this);break;case 2:r=new ColorEffect(i[n],t,this);break;case 3:r=new PointEffect(i[n],t,this);break;case 4:case 7:r=new CheckboxEffect(i[n],t,this);break;case 10:r=new LayerIndexEffect(i[n],t,this);break;case 11:r=new MaskIndexEffect(i[n],t,this);break;case 5:r=new EffectsManager(i[n],t);break;default:r=new NoValueEffect(i[n])}r&&this.effectElements.push(r)}},BaseElement.prototype={checkMasks:function(){if(!this.data.hasMask)return!1;for(var e=0,t=this.data.masksProperties.length;e<t;){if("n"!==this.data.masksProperties[e].mode&&!1!==this.data.masksProperties[e].cl)return!0;e+=1}return!1},initExpressions:function(){var e=getExpressionInterfaces();if(e){var t=e("layer"),n=e("effects"),r=e("shape"),a=e("text"),i=e("comp");this.layerInterface=t(this),this.data.hasMask&&this.maskManager&&this.layerInterface.registerMaskInterface(this.maskManager);var s=n.createEffectsInterface(this,this.layerInterface);this.layerInterface.registerEffectsInterface(s),0===this.data.ty||this.data.xt?this.compInterface=i(this):4===this.data.ty?(this.layerInterface.shapeInterface=r(this.shapesData,this.itemsData,this.layerInterface),this.layerInterface.content=this.layerInterface.shapeInterface):5===this.data.ty&&(this.layerInterface.textInterface=a(this),this.layerInterface.text=this.layerInterface.textInterface)}},setBlendMode:function(){var e=getBlendMode(this.data.bm);(this.baseElement||this.layerElement).style["mix-blend-mode"]=e},initBaseData:function(e,t,n){this.globalData=t,this.comp=n,this.data=e,this.layerId=createElementID(),this.data.sr||(this.data.sr=1),this.effectsManager=new EffectsManager(this.data,this,this.dynamicProperties)},getType:function(){return this.type},sourceRectAtTime:function(){}},FrameElement.prototype={initFrame:function(){this._isFirstFrame=!1,this.dynamicProperties=[],this._mdf=!1},prepareProperties:function(e,t){var n,r=this.dynamicProperties.length;for(n=0;n<r;n+=1)(t||this._isParent&&"transform"===this.dynamicProperties[n].propType)&&(this.dynamicProperties[n].getValue(),this.dynamicProperties[n]._mdf&&(this.globalData._mdf=!0,this._mdf=!0))},addDynamicProperty:function(e){-1===this.dynamicProperties.indexOf(e)&&this.dynamicProperties.push(e)}},FootageElement.prototype.prepareFrame=function(){},extendPrototype([RenderableElement,BaseElement,FrameElement],FootageElement),FootageElement.prototype.getBaseElement=function(){return null},FootageElement.prototype.renderFrame=function(){},FootageElement.prototype.destroy=function(){},FootageElement.prototype.initExpressions=function(){var e=getExpressionInterfaces();if(e){var t=e("footage");this.layerInterface=t(this)}},FootageElement.prototype.getFootageData=function(){return this.footageData},AudioElement.prototype.prepareFrame=function(e){if(this.prepareRenderableFrame(e,!0),this.prepareProperties(e,!0),this.tm._placeholder)this._currentTime=e/this.data.sr;else{var t=this.tm.v;this._currentTime=t}this._volume=this.lv.v[0];var n=this._volume*this._volumeMultiplier;this._previousVolume!==n&&(this._previousVolume=n,this.audio.volume(n))},extendPrototype([RenderableElement,BaseElement,FrameElement],AudioElement),AudioElement.prototype.renderFrame=function(){this.isInRange&&this._canPlay&&(this._isPlaying?(!this.audio.playing()||Math.abs(this._currentTime/this.globalData.frameRate-this.audio.seek())>.1)&&this.audio.seek(this._currentTime/this.globalData.frameRate):(this.audio.play(),this.audio.seek(this._currentTime/this.globalData.frameRate),this._isPlaying=!0))},AudioElement.prototype.show=function(){},AudioElement.prototype.hide=function(){this.audio.pause(),this._isPlaying=!1},AudioElement.prototype.pause=function(){this.audio.pause(),this._isPlaying=!1,this._canPlay=!1},AudioElement.prototype.resume=function(){this._canPlay=!0},AudioElement.prototype.setRate=function(e){this.audio.rate(e)},AudioElement.prototype.volume=function(e){this._volumeMultiplier=e,this._previousVolume=e*this._volume,this.audio.volume(this._previousVolume)},AudioElement.prototype.getBaseElement=function(){return null},AudioElement.prototype.destroy=function(){},AudioElement.prototype.sourceRectAtTime=function(){},AudioElement.prototype.initExpressions=function(){},BaseRenderer.prototype.checkLayers=function(e){var t,n,r=this.layers.length;for(this.completeLayers=!0,t=r-1;t>=0;t-=1)this.elements[t]||(n=this.layers[t]).ip-n.st<=e-this.layers[t].st&&n.op-n.st>e-this.layers[t].st&&this.buildItem(t),this.completeLayers=!!this.elements[t]&&this.completeLayers;this.checkPendingElements()},BaseRenderer.prototype.createItem=function(e){switch(e.ty){case 2:return this.createImage(e);case 0:return this.createComp(e);case 1:return this.createSolid(e);case 3:default:return this.createNull(e);case 4:return this.createShape(e);case 5:return this.createText(e);case 6:return this.createAudio(e);case 13:return this.createCamera(e);case 15:return this.createFootage(e)}},BaseRenderer.prototype.createCamera=function(){throw new Error("You're using a 3d camera. Try the html renderer.")},BaseRenderer.prototype.createAudio=function(e){return new AudioElement(e,this.globalData,this)},BaseRenderer.prototype.createFootage=function(e){return new FootageElement(e,this.globalData,this)},BaseRenderer.prototype.buildAllItems=function(){var e,t=this.layers.length;for(e=0;e<t;e+=1)this.buildItem(e);this.checkPendingElements()},BaseRenderer.prototype.includeLayers=function(e){var t;this.completeLayers=!1;var n,r=e.length,a=this.layers.length;for(t=0;t<r;t+=1)for(n=0;n<a;){if(this.layers[n].id===e[t].id){this.layers[n]=e[t];break}n+=1}},BaseRenderer.prototype.setProjectInterface=function(e){this.globalData.projectInterface=e},BaseRenderer.prototype.initItems=function(){this.globalData.progressiveLoad||this.buildAllItems()},BaseRenderer.prototype.buildElementParenting=function(e,t,n){for(var r=this.elements,a=this.layers,i=0,s=a.length;i<s;)a[i].ind==t&&(r[i]&&!0!==r[i]?(n.push(r[i]),r[i].setAsParent(),void 0!==a[i].parent?this.buildElementParenting(e,a[i].parent,n):e.setHierarchy(n)):(this.buildItem(i),this.addPendingElement(e))),i+=1},BaseRenderer.prototype.addPendingElement=function(e){this.pendingElements.push(e)},BaseRenderer.prototype.searchExtraCompositions=function(e){var t,n=e.length;for(t=0;t<n;t+=1)if(e[t].xt){var r=this.createComp(e[t]);r.initExpressions(),this.globalData.projectInterface.registerComposition(r)}},BaseRenderer.prototype.getElementById=function(e){var t,n=this.elements.length;for(t=0;t<n;t+=1)if(this.elements[t].data.ind===e)return this.elements[t];return null},BaseRenderer.prototype.getElementByPath=function(e){var t,n=e.shift();if("number"==typeof n)t=this.elements[n];else{var r,a=this.elements.length;for(r=0;r<a;r+=1)if(this.elements[r].data.nm===n){t=this.elements[r];break}}return 0===e.length?t:t.getElementByPath(e)},BaseRenderer.prototype.setupGlobalData=function(e,t){this.globalData.fontManager=new FontManager,this.globalData.slotManager=slotFactory(e),this.globalData.fontManager.addChars(e.chars),this.globalData.fontManager.addFonts(e.fonts,t),this.globalData.getAssetData=this.animationItem.getAssetData.bind(this.animationItem),this.globalData.getAssetsPath=this.animationItem.getAssetsPath.bind(this.animationItem),this.globalData.imageLoader=this.animationItem.imagePreloader,this.globalData.audioController=this.animationItem.audioController,this.globalData.frameId=0,this.globalData.frameRate=e.fr,this.globalData.nm=e.nm,this.globalData.compSize={w:e.w,h:e.h}};var effectTypes={TRANSFORM_EFFECT:"transformEFfect"};function TransformElement(){}function MaskElement(e,t,n){this.data=e,this.element=t,this.globalData=n,this.storedData=[],this.masksProperties=this.data.masksProperties||[],this.maskElement=null;var r,a,i=this.globalData.defs,s=this.masksProperties?this.masksProperties.length:0;this.viewData=createSizedArray(s),this.solidPath="";var o,l,u,c,h,d,p=this.masksProperties,f=0,m=[],g=createElementID(),y="clipPath",v="clip-path";for(r=0;r<s;r+=1)if(("a"!==p[r].mode&&"n"!==p[r].mode||p[r].inv||100!==p[r].o.k||p[r].o.x)&&(y="mask",v="mask"),"s"!==p[r].mode&&"i"!==p[r].mode||0!==f?u=null:((u=createNS("rect")).setAttribute("fill","#ffffff"),u.setAttribute("width",this.element.comp.data.w||0),u.setAttribute("height",this.element.comp.data.h||0),m.push(u)),a=createNS("path"),"n"===p[r].mode)this.viewData[r]={op:PropertyFactory.getProp(this.element,p[r].o,0,.01,this.element),prop:ShapePropertyFactory.getShapeProp(this.element,p[r],3),elem:a,lastPath:""},i.appendChild(a);else{var b;if(f+=1,a.setAttribute("fill","s"===p[r].mode?"#000000":"#ffffff"),a.setAttribute("clip-rule","nonzero"),0!==p[r].x.k?(y="mask",v="mask",d=PropertyFactory.getProp(this.element,p[r].x,0,null,this.element),b=createElementID(),(c=createNS("filter")).setAttribute("id",b),(h=createNS("feMorphology")).setAttribute("operator","erode"),h.setAttribute("in","SourceGraphic"),h.setAttribute("radius","0"),c.appendChild(h),i.appendChild(c),a.setAttribute("stroke","s"===p[r].mode?"#000000":"#ffffff")):(h=null,d=null),this.storedData[r]={elem:a,x:d,expan:h,lastPath:"",lastOperator:"",filterId:b,lastRadius:0},"i"===p[r].mode){l=m.length;var x=createNS("g");for(o=0;o<l;o+=1)x.appendChild(m[o]);var T=createNS("mask");T.setAttribute("mask-type","alpha"),T.setAttribute("id",g+"_"+f),T.appendChild(a),i.appendChild(T),x.setAttribute("mask","url("+getLocationHref()+"#"+g+"_"+f+")"),m.length=0,m.push(x)}else m.push(a);p[r].inv&&!this.solidPath&&(this.solidPath=this.createLayerSolidPath()),this.viewData[r]={elem:a,lastPath:"",op:PropertyFactory.getProp(this.element,p[r].o,0,.01,this.element),prop:ShapePropertyFactory.getShapeProp(this.element,p[r],3),invRect:u},this.viewData[r].prop.k||this.drawPath(p[r],this.viewData[r].prop.v,this.viewData[r])}for(this.maskElement=createNS(y),s=m.length,r=0;r<s;r+=1)this.maskElement.appendChild(m[r]);f>0&&(this.maskElement.setAttribute("id",g),this.element.maskedElement.setAttribute(v,"url("+getLocationHref()+"#"+g+")"),i.appendChild(this.maskElement)),this.viewData.length&&this.element.addRenderableComponent(this)}TransformElement.prototype={initTransform:function(){var e=new Matrix;this.finalTransform={mProp:this.data.ks?TransformPropertyFactory.getTransformProperty(this,this.data.ks,this):{o:0},_matMdf:!1,_localMatMdf:!1,_opMdf:!1,mat:e,localMat:e,localOpacity:1},this.data.ao&&(this.finalTransform.mProp.autoOriented=!0),this.data.ty},renderTransform:function(){if(this.finalTransform._opMdf=this.finalTransform.mProp.o._mdf||this._isFirstFrame,this.finalTransform._matMdf=this.finalTransform.mProp._mdf||this._isFirstFrame,this.hierarchy){var e,t=this.finalTransform.mat,n=0,r=this.hierarchy.length;if(!this.finalTransform._matMdf)for(;n<r;){if(this.hierarchy[n].finalTransform.mProp._mdf){this.finalTransform._matMdf=!0;break}n+=1}if(this.finalTransform._matMdf)for(e=this.finalTransform.mProp.v.props,t.cloneFromProps(e),n=0;n<r;n+=1)t.multiply(this.hierarchy[n].finalTransform.mProp.v)}this.finalTransform._matMdf&&(this.finalTransform._localMatMdf=this.finalTransform._matMdf),this.finalTransform._opMdf&&(this.finalTransform.localOpacity=this.finalTransform.mProp.o.v)},renderLocalTransform:function(){if(this.localTransforms){var e=0,t=this.localTransforms.length;if(this.finalTransform._localMatMdf=this.finalTransform._matMdf,!this.finalTransform._localMatMdf||!this.finalTransform._opMdf)for(;e<t;)this.localTransforms[e]._mdf&&(this.finalTransform._localMatMdf=!0),this.localTransforms[e]._opMdf&&!this.finalTransform._opMdf&&(this.finalTransform.localOpacity=this.finalTransform.mProp.o.v,this.finalTransform._opMdf=!0),e+=1;if(this.finalTransform._localMatMdf){var n=this.finalTransform.localMat;for(this.localTransforms[0].matrix.clone(n),e=1;e<t;e+=1){var r=this.localTransforms[e].matrix;n.multiply(r)}n.multiply(this.finalTransform.mat)}if(this.finalTransform._opMdf){var a=this.finalTransform.localOpacity;for(e=0;e<t;e+=1)a*=.01*this.localTransforms[e].opacity;this.finalTransform.localOpacity=a}}},searchEffectTransforms:function(){if(this.renderableEffectsManager){var e=this.renderableEffectsManager.getEffects(effectTypes.TRANSFORM_EFFECT);if(e.length){this.localTransforms=[],this.finalTransform.localMat=new Matrix;var t=0,n=e.length;for(t=0;t<n;t+=1)this.localTransforms.push(e[t])}}},globalToLocal:function(e){var t=[];t.push(this.finalTransform);for(var n,r=!0,a=this.comp;r;)a.finalTransform?(a.data.hasMask&&t.splice(0,0,a.finalTransform),a=a.comp):r=!1;var i,s=t.length;for(n=0;n<s;n+=1)i=t[n].mat.applyToPointArray(0,0,0),e=[e[0]-i[0],e[1]-i[1],0];return e},mHelper:new Matrix},MaskElement.prototype.getMaskProperty=function(e){return this.viewData[e].prop},MaskElement.prototype.renderFrame=function(e){var t,n=this.element.finalTransform.mat,r=this.masksProperties.length;for(t=0;t<r;t+=1)if((this.viewData[t].prop._mdf||e)&&this.drawPath(this.masksProperties[t],this.viewData[t].prop.v,this.viewData[t]),(this.viewData[t].op._mdf||e)&&this.viewData[t].elem.setAttribute("fill-opacity",this.viewData[t].op.v),"n"!==this.masksProperties[t].mode&&(this.viewData[t].invRect&&(this.element.finalTransform.mProp._mdf||e)&&this.viewData[t].invRect.setAttribute("transform",n.getInverseMatrix().to2dCSS()),this.storedData[t].x&&(this.storedData[t].x._mdf||e))){var a=this.storedData[t].expan;this.storedData[t].x.v<0?("erode"!==this.storedData[t].lastOperator&&(this.storedData[t].lastOperator="erode",this.storedData[t].elem.setAttribute("filter","url("+getLocationHref()+"#"+this.storedData[t].filterId+")")),a.setAttribute("radius",-this.storedData[t].x.v)):("dilate"!==this.storedData[t].lastOperator&&(this.storedData[t].lastOperator="dilate",this.storedData[t].elem.setAttribute("filter",null)),this.storedData[t].elem.setAttribute("stroke-width",2*this.storedData[t].x.v))}},MaskElement.prototype.getMaskelement=function(){return this.maskElement},MaskElement.prototype.createLayerSolidPath=function(){var e="M0,0 ";return e+=" h"+this.globalData.compSize.w,e+=" v"+this.globalData.compSize.h,e+=" h-"+this.globalData.compSize.w,e+=" v-"+this.globalData.compSize.h+" "},MaskElement.prototype.drawPath=function(e,t,n){var r,a,i=" M"+t.v[0][0]+","+t.v[0][1];for(a=t._length,r=1;r<a;r+=1)i+=" C"+t.o[r-1][0]+","+t.o[r-1][1]+" "+t.i[r][0]+","+t.i[r][1]+" "+t.v[r][0]+","+t.v[r][1];if(t.c&&a>1&&(i+=" C"+t.o[r-1][0]+","+t.o[r-1][1]+" "+t.i[0][0]+","+t.i[0][1]+" "+t.v[0][0]+","+t.v[0][1]),n.lastPath!==i){var s="";n.elem&&(t.c&&(s=e.inv?this.solidPath+i:i),n.elem.setAttribute("d",s)),n.lastPath=i}},MaskElement.prototype.destroy=function(){this.element=null,this.globalData=null,this.maskElement=null,this.data=null,this.masksProperties=null};var filtersFactory=function(){var e={createFilter:function(e,t){var n=createNS("filter");return n.setAttribute("id",e),!0!==t&&(n.setAttribute("filterUnits","objectBoundingBox"),n.setAttribute("x","0%"),n.setAttribute("y","0%"),n.setAttribute("width","100%"),n.setAttribute("height","100%")),n},createAlphaToLuminanceFilter:function(){var e=createNS("feColorMatrix");return e.setAttribute("type","matrix"),e.setAttribute("color-interpolation-filters","sRGB"),e.setAttribute("values","0 0 0 1 0  0 0 0 1 0  0 0 0 1 0  0 0 0 1 1"),e}};return e}(),featureSupport=function(){var e={maskType:!0,svgLumaHidden:!0,offscreenCanvas:"undefined"!=typeof OffscreenCanvas};return(/MSIE 10/i.test(navigator.userAgent)||/MSIE 9/i.test(navigator.userAgent)||/rv:11.0/i.test(navigator.userAgent)||/Edge\/\d./i.test(navigator.userAgent))&&(e.maskType=!1),/firefox/i.test(navigator.userAgent)&&(e.svgLumaHidden=!1),e}(),registeredEffects$1={},idPrefix="filter_result_";function SVGEffects(e){var t,n,r="SourceGraphic",a=e.data.ef?e.data.ef.length:0,i=createElementID(),s=filtersFactory.createFilter(i,!0),o=0;for(this.filters=[],t=0;t<a;t+=1){n=null;var l=e.data.ef[t].ty;registeredEffects$1[l]&&(n=new(0,registeredEffects$1[l].effect)(s,e.effectsManager.effectElements[t],e,idPrefix+o,r),r=idPrefix+o,registeredEffects$1[l].countsAsEffect&&(o+=1)),n&&this.filters.push(n)}o&&(e.globalData.defs.appendChild(s),e.layerElement.setAttribute("filter","url("+getLocationHref()+"#"+i+")")),this.filters.length&&e.addRenderableComponent(this)}function registerEffect$1(e,t,n){registeredEffects$1[e]={effect:t,countsAsEffect:n}}function SVGBaseElement(){}function HierarchyElement(){}function RenderableDOMElement(){}function IImageElement(e,t,n){this.assetData=t.getAssetData(e.refId),this.assetData&&this.assetData.sid&&(this.assetData=t.slotManager.getProp(this.assetData)),this.initElement(e,t,n),this.sourceRect={top:0,left:0,width:this.assetData.w,height:this.assetData.h}}function ProcessedElement(e,t){this.elem=e,this.pos=t}function IShapeElement(){}SVGEffects.prototype.renderFrame=function(e){var t,n=this.filters.length;for(t=0;t<n;t+=1)this.filters[t].renderFrame(e)},SVGEffects.prototype.getEffects=function(e){var t,n=this.filters.length,r=[];for(t=0;t<n;t+=1)this.filters[t].type===e&&r.push(this.filters[t]);return r},SVGBaseElement.prototype={initRendererElement:function(){this.layerElement=createNS("g")},createContainerElements:function(){this.matteElement=createNS("g"),this.transformedElement=this.layerElement,this.maskedElement=this.layerElement,this._sizeChanged=!1;var e=null;if(this.data.td){this.matteMasks={};var t=createNS("g");t.setAttribute("id",this.layerId),t.appendChild(this.layerElement),e=t,this.globalData.defs.appendChild(t)}else this.data.tt?(this.matteElement.appendChild(this.layerElement),e=this.matteElement,this.baseElement=this.matteElement):this.baseElement=this.layerElement;if(this.data.ln&&this.layerElement.setAttribute("id",this.data.ln),this.data.cl&&this.layerElement.setAttribute("class",this.data.cl),0===this.data.ty&&!this.data.hd){var n=createNS("clipPath"),r=createNS("path");r.setAttribute("d","M0,0 L"+this.data.w+",0 L"+this.data.w+","+this.data.h+" L0,"+this.data.h+"z");var a=createElementID();if(n.setAttribute("id",a),n.appendChild(r),this.globalData.defs.appendChild(n),this.checkMasks()){var i=createNS("g");i.setAttribute("clip-path","url("+getLocationHref()+"#"+a+")"),i.appendChild(this.layerElement),this.transformedElement=i,e?e.appendChild(this.transformedElement):this.baseElement=this.transformedElement}else this.layerElement.setAttribute("clip-path","url("+getLocationHref()+"#"+a+")")}0!==this.data.bm&&this.setBlendMode()},renderElement:function(){this.finalTransform._localMatMdf&&this.transformedElement.setAttribute("transform",this.finalTransform.localMat.to2dCSS()),this.finalTransform._opMdf&&this.transformedElement.setAttribute("opacity",this.finalTransform.localOpacity)},destroyBaseElement:function(){this.layerElement=null,this.matteElement=null,this.maskManager.destroy()},getBaseElement:function(){return this.data.hd?null:this.baseElement},createRenderableComponents:function(){this.maskManager=new MaskElement(this.data,this,this.globalData),this.renderableEffectsManager=new SVGEffects(this),this.searchEffectTransforms()},getMatte:function(e){if(this.matteMasks||(this.matteMasks={}),!this.matteMasks[e]){var t,n,r,a,i=this.layerId+"_"+e;if(1===e||3===e){var s=createNS("mask");s.setAttribute("id",i),s.setAttribute("mask-type",3===e?"luminance":"alpha"),(r=createNS("use")).setAttributeNS("http://www.w3.org/1999/xlink","href","#"+this.layerId),s.appendChild(r),this.globalData.defs.appendChild(s),featureSupport.maskType||1!==e||(s.setAttribute("mask-type","luminance"),t=createElementID(),n=filtersFactory.createFilter(t),this.globalData.defs.appendChild(n),n.appendChild(filtersFactory.createAlphaToLuminanceFilter()),(a=createNS("g")).appendChild(r),s.appendChild(a),a.setAttribute("filter","url("+getLocationHref()+"#"+t+")"))}else if(2===e){var o=createNS("mask");o.setAttribute("id",i),o.setAttribute("mask-type","alpha");var l=createNS("g");o.appendChild(l),t=createElementID(),n=filtersFactory.createFilter(t);var u=createNS("feComponentTransfer");u.setAttribute("in","SourceGraphic"),n.appendChild(u);var c=createNS("feFuncA");c.setAttribute("type","table"),c.setAttribute("tableValues","1.0 0.0"),u.appendChild(c),this.globalData.defs.appendChild(n);var h=createNS("rect");h.setAttribute("width",this.comp.data.w),h.setAttribute("height",this.comp.data.h),h.setAttribute("x","0"),h.setAttribute("y","0"),h.setAttribute("fill","#ffffff"),h.setAttribute("opacity","0"),l.setAttribute("filter","url("+getLocationHref()+"#"+t+")"),l.appendChild(h),(r=createNS("use")).setAttributeNS("http://www.w3.org/1999/xlink","href","#"+this.layerId),l.appendChild(r),featureSupport.maskType||(o.setAttribute("mask-type","luminance"),n.appendChild(filtersFactory.createAlphaToLuminanceFilter()),a=createNS("g"),l.appendChild(h),a.appendChild(this.layerElement),l.appendChild(a)),this.globalData.defs.appendChild(o)}this.matteMasks[e]=i}return this.matteMasks[e]},setMatte:function(e){this.matteElement&&this.matteElement.setAttribute("mask","url("+getLocationHref()+"#"+e+")")}},HierarchyElement.prototype={initHierarchy:function(){this.hierarchy=[],this._isParent=!1,this.checkParenting()},setHierarchy:function(e){this.hierarchy=e},setAsParent:function(){this._isParent=!0},checkParenting:function(){void 0!==this.data.parent&&this.comp.buildElementParenting(this,this.data.parent,[])}},extendPrototype([RenderableElement,createProxyFunction({initElement:function(e,t,n){this.initFrame(),this.initBaseData(e,t,n),this.initTransform(e,t,n),this.initHierarchy(),this.initRenderable(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),this.createContent(),this.hide()},hide:function(){this.hidden||this.isInRange&&!this.isTransparent||((this.baseElement||this.layerElement).style.display="none",this.hidden=!0)},show:function(){this.isInRange&&!this.isTransparent&&(this.data.hd||((this.baseElement||this.layerElement).style.display="block"),this.hidden=!1,this._isFirstFrame=!0)},renderFrame:function(){this.data.hd||this.hidden||(this.renderTransform(),this.renderRenderable(),this.renderLocalTransform(),this.renderElement(),this.renderInnerContent(),this._isFirstFrame&&(this._isFirstFrame=!1))},renderInnerContent:function(){},prepareFrame:function(e){this._mdf=!1,this.prepareRenderableFrame(e),this.prepareProperties(e,this.isInRange),this.checkTransparency()},destroy:function(){this.innerElem=null,this.destroyBaseElement()}})],RenderableDOMElement),extendPrototype([BaseElement,TransformElement,SVGBaseElement,HierarchyElement,FrameElement,RenderableDOMElement],IImageElement),IImageElement.prototype.createContent=function(){var e=this.globalData.getAssetsPath(this.assetData);this.innerElem=createNS("image"),this.innerElem.setAttribute("width",this.assetData.w+"px"),this.innerElem.setAttribute("height",this.assetData.h+"px"),this.innerElem.setAttribute("preserveAspectRatio",this.assetData.pr||this.globalData.renderConfig.imagePreserveAspectRatio),this.innerElem.setAttributeNS("http://www.w3.org/1999/xlink","href",e),this.layerElement.appendChild(this.innerElem)},IImageElement.prototype.sourceRectAtTime=function(){return this.sourceRect},IShapeElement.prototype={addShapeToModifiers:function(e){var t,n=this.shapeModifiers.length;for(t=0;t<n;t+=1)this.shapeModifiers[t].addShape(e)},isShapeInAnimatedModifiers:function(e){for(var t=this.shapeModifiers.length;0<t;)if(this.shapeModifiers[0].isAnimatedWithShape(e))return!0;return!1},renderModifiers:function(){if(this.shapeModifiers.length){var e,t=this.shapes.length;for(e=0;e<t;e+=1)this.shapes[e].sh.reset();for(e=(t=this.shapeModifiers.length)-1;e>=0&&!this.shapeModifiers[e].processShapes(this._isFirstFrame);e-=1);}},searchProcessedElement:function(e){for(var t=this.processedElements,n=0,r=t.length;n<r;){if(t[n].elem===e)return t[n].pos;n+=1}return 0},addProcessedElement:function(e,t){for(var n=this.processedElements,r=n.length;r;)if(n[r-=1].elem===e)return void(n[r].pos=t);n.push(new ProcessedElement(e,t))},prepareFrame:function(e){this.prepareRenderableFrame(e),this.prepareProperties(e,this.isInRange)}};var lineCapEnum={1:"butt",2:"round",3:"square"},lineJoinEnum={1:"miter",2:"round",3:"bevel"};function SVGShapeData(e,t,n){this.caches=[],this.styles=[],this.transformers=e,this.lStr="",this.sh=n,this.lvl=t,this._isAnimated=!!n.k;for(var r=0,a=e.length;r<a;){if(e[r].mProps.dynamicProperties.length){this._isAnimated=!0;break}r+=1}}function SVGStyleData(e,t){this.data=e,this.type=e.ty,this.d="",this.lvl=t,this._mdf=!1,this.closed=!0===e.hd,this.pElem=createNS("path"),this.msElem=null}function DashProperty(e,t,n,r){var a;this.elem=e,this.frameId=-1,this.dataProps=createSizedArray(t.length),this.renderer=n,this.k=!1,this.dashStr="",this.dashArray=createTypedArray("float32",t.length?t.length-1:0),this.dashoffset=createTypedArray("float32",1),this.initDynamicPropertyContainer(r);var i,s=t.length||0;for(a=0;a<s;a+=1)i=PropertyFactory.getProp(e,t[a].v,0,0,this),this.k=i.k||this.k,this.dataProps[a]={n:t[a].n,p:i};this.k||this.getValue(!0),this._isAnimated=this.k}function SVGStrokeStyleData(e,t,n){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.o=PropertyFactory.getProp(e,t.o,0,.01,this),this.w=PropertyFactory.getProp(e,t.w,0,null,this),this.d=new DashProperty(e,t.d||{},"svg",this),this.c=PropertyFactory.getProp(e,t.c,1,255,this),this.style=n,this._isAnimated=!!this._isAnimated}function SVGFillStyleData(e,t,n){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.o=PropertyFactory.getProp(e,t.o,0,.01,this),this.c=PropertyFactory.getProp(e,t.c,1,255,this),this.style=n}function SVGNoStyleData(e,t,n){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.style=n}function GradientProperty(e,t,n){this.data=t,this.c=createTypedArray("uint8c",4*t.p);var r=t.k.k[0].s?t.k.k[0].s.length-4*t.p:t.k.k.length-4*t.p;this.o=createTypedArray("float32",r),this._cmdf=!1,this._omdf=!1,this._collapsable=this.checkCollapsable(),this._hasOpacity=r,this.initDynamicPropertyContainer(n),this.prop=PropertyFactory.getProp(e,t.k,1,null,this),this.k=this.prop.k,this.getValue(!0)}function SVGGradientFillStyleData(e,t,n){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.initGradientData(e,t,n)}function SVGGradientStrokeStyleData(e,t,n){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.w=PropertyFactory.getProp(e,t.w,0,null,this),this.d=new DashProperty(e,t.d||{},"svg",this),this.initGradientData(e,t,n),this._isAnimated=!!this._isAnimated}function ShapeGroupData(){this.it=[],this.prevViewData=[],this.gr=createNS("g")}function SVGTransformData(e,t,n){this.transform={mProps:e,op:t,container:n},this.elements=[],this._isAnimated=this.transform.mProps.dynamicProperties.length||this.transform.op.effectsSequence.length}SVGShapeData.prototype.setAsAnimated=function(){this._isAnimated=!0},SVGStyleData.prototype.reset=function(){this.d="",this._mdf=!1},DashProperty.prototype.getValue=function(e){if((this.elem.globalData.frameId!==this.frameId||e)&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf=this._mdf||e,this._mdf)){var t=0,n=this.dataProps.length;for("svg"===this.renderer&&(this.dashStr=""),t=0;t<n;t+=1)"o"!==this.dataProps[t].n?"svg"===this.renderer?this.dashStr+=" "+this.dataProps[t].p.v:this.dashArray[t]=this.dataProps[t].p.v:this.dashoffset[0]=this.dataProps[t].p.v}},extendPrototype([DynamicPropertyContainer],DashProperty),extendPrototype([DynamicPropertyContainer],SVGStrokeStyleData),extendPrototype([DynamicPropertyContainer],SVGFillStyleData),extendPrototype([DynamicPropertyContainer],SVGNoStyleData),GradientProperty.prototype.comparePoints=function(e,t){for(var n=0,r=this.o.length/2;n<r;){if(Math.abs(e[4*n]-e[4*t+2*n])>.01)return!1;n+=1}return!0},GradientProperty.prototype.checkCollapsable=function(){if(this.o.length/2!=this.c.length/4)return!1;if(this.data.k.k[0].s)for(var e=0,t=this.data.k.k.length;e<t;){if(!this.comparePoints(this.data.k.k[e].s,this.data.p))return!1;e+=1}else if(!this.comparePoints(this.data.k.k,this.data.p))return!1;return!0},GradientProperty.prototype.getValue=function(e){if(this.prop.getValue(),this._mdf=!1,this._cmdf=!1,this._omdf=!1,this.prop._mdf||e){var t,n,r,a=4*this.data.p;for(t=0;t<a;t+=1)n=t%4==0?100:255,r=Math.round(this.prop.v[t]*n),this.c[t]!==r&&(this.c[t]=r,this._cmdf=!e);if(this.o.length)for(a=this.prop.v.length,t=4*this.data.p;t<a;t+=1)n=t%2==0?100:1,r=t%2==0?Math.round(100*this.prop.v[t]):this.prop.v[t],this.o[t-4*this.data.p]!==r&&(this.o[t-4*this.data.p]=r,this._omdf=!e);this._mdf=!e}},extendPrototype([DynamicPropertyContainer],GradientProperty),SVGGradientFillStyleData.prototype.initGradientData=function(e,t,n){this.o=PropertyFactory.getProp(e,t.o,0,.01,this),this.s=PropertyFactory.getProp(e,t.s,1,null,this),this.e=PropertyFactory.getProp(e,t.e,1,null,this),this.h=PropertyFactory.getProp(e,t.h||{k:0},0,.01,this),this.a=PropertyFactory.getProp(e,t.a||{k:0},0,degToRads,this),this.g=new GradientProperty(e,t.g,this),this.style=n,this.stops=[],this.setGradientData(n.pElem,t),this.setGradientOpacity(t,n),this._isAnimated=!!this._isAnimated},SVGGradientFillStyleData.prototype.setGradientData=function(e,t){var n=createElementID(),r=createNS(1===t.t?"linearGradient":"radialGradient");r.setAttribute("id",n),r.setAttribute("spreadMethod","pad"),r.setAttribute("gradientUnits","userSpaceOnUse");var a,i,s,o=[];for(s=4*t.g.p,i=0;i<s;i+=4)a=createNS("stop"),r.appendChild(a),o.push(a);e.setAttribute("gf"===t.ty?"fill":"stroke","url("+getLocationHref()+"#"+n+")"),this.gf=r,this.cst=o},SVGGradientFillStyleData.prototype.setGradientOpacity=function(e,t){if(this.g._hasOpacity&&!this.g._collapsable){var n,r,a,i=createNS("mask"),s=createNS("path");i.appendChild(s);var o=createElementID(),l=createElementID();i.setAttribute("id",l);var u=createNS(1===e.t?"linearGradient":"radialGradient");u.setAttribute("id",o),u.setAttribute("spreadMethod","pad"),u.setAttribute("gradientUnits","userSpaceOnUse"),a=e.g.k.k[0].s?e.g.k.k[0].s.length:e.g.k.k.length;var c=this.stops;for(r=4*e.g.p;r<a;r+=2)(n=createNS("stop")).setAttribute("stop-color","rgb(255,255,255)"),u.appendChild(n),c.push(n);s.setAttribute("gf"===e.ty?"fill":"stroke","url("+getLocationHref()+"#"+o+")"),"gs"===e.ty&&(s.setAttribute("stroke-linecap",lineCapEnum[e.lc||2]),s.setAttribute("stroke-linejoin",lineJoinEnum[e.lj||2]),1===e.lj&&s.setAttribute("stroke-miterlimit",e.ml)),this.of=u,this.ms=i,this.ost=c,this.maskId=l,t.msElem=s}},extendPrototype([DynamicPropertyContainer],SVGGradientFillStyleData),extendPrototype([SVGGradientFillStyleData,DynamicPropertyContainer],SVGGradientStrokeStyleData);var buildShapeString=function(e,t,n,r){if(0===t)return"";var a,i=e.o,s=e.i,o=e.v,l=" M"+r.applyToPointStringified(o[0][0],o[0][1]);for(a=1;a<t;a+=1)l+=" C"+r.applyToPointStringified(i[a-1][0],i[a-1][1])+" "+r.applyToPointStringified(s[a][0],s[a][1])+" "+r.applyToPointStringified(o[a][0],o[a][1]);return n&&t&&(l+=" C"+r.applyToPointStringified(i[a-1][0],i[a-1][1])+" "+r.applyToPointStringified(s[0][0],s[0][1])+" "+r.applyToPointStringified(o[0][0],o[0][1]),l+="z"),l},SVGElementsRenderer=function(){var e=new Matrix,t=new Matrix;function n(e,t,n){(n||t.transform.op._mdf)&&t.transform.container.setAttribute("opacity",t.transform.op.v),(n||t.transform.mProps._mdf)&&t.transform.container.setAttribute("transform",t.transform.mProps.v.to2dCSS())}function r(){}function a(n,r,a){var i,s,o,l,u,c,h,d,p,f,m=r.styles.length,g=r.lvl;for(c=0;c<m;c+=1){if(l=r.sh._mdf||a,r.styles[c].lvl<g){for(d=t.reset(),p=g-r.styles[c].lvl,f=r.transformers.length-1;!l&&p>0;)l=r.transformers[f].mProps._mdf||l,p-=1,f-=1;if(l)for(p=g-r.styles[c].lvl,f=r.transformers.length-1;p>0;)d.multiply(r.transformers[f].mProps.v),p-=1,f-=1}else d=e;if(s=(h=r.sh.paths)._length,l){for(o="",i=0;i<s;i+=1)(u=h.shapes[i])&&u._length&&(o+=buildShapeString(u,u._length,u.c,d));r.caches[c]=o}else o=r.caches[c];r.styles[c].d+=!0===n.hd?"":o,r.styles[c]._mdf=l||r.styles[c]._mdf}}function i(e,t,n){var r=t.style;(t.c._mdf||n)&&r.pElem.setAttribute("fill","rgb("+bmFloor(t.c.v[0])+","+bmFloor(t.c.v[1])+","+bmFloor(t.c.v[2])+")"),(t.o._mdf||n)&&r.pElem.setAttribute("fill-opacity",t.o.v)}function s(e,t,n){o(e,t,n),l(0,t,n)}function o(e,t,n){var r,a,i,s,o,l=t.gf,u=t.g._hasOpacity,c=t.s.v,h=t.e.v;if(t.o._mdf||n){var d="gf"===e.ty?"fill-opacity":"stroke-opacity";t.style.pElem.setAttribute(d,t.o.v)}if(t.s._mdf||n){var p=1===e.t?"x1":"cx",f="x1"===p?"y1":"cy";l.setAttribute(p,c[0]),l.setAttribute(f,c[1]),u&&!t.g._collapsable&&(t.of.setAttribute(p,c[0]),t.of.setAttribute(f,c[1]))}if(t.g._cmdf||n){r=t.cst;var m=t.g.c;for(i=r.length,a=0;a<i;a+=1)(s=r[a]).setAttribute("offset",m[4*a]+"%"),s.setAttribute("stop-color","rgb("+m[4*a+1]+","+m[4*a+2]+","+m[4*a+3]+")")}if(u&&(t.g._omdf||n)){var g=t.g.o;for(i=(r=t.g._collapsable?t.cst:t.ost).length,a=0;a<i;a+=1)s=r[a],t.g._collapsable||s.setAttribute("offset",g[2*a]+"%"),s.setAttribute("stop-opacity",g[2*a+1])}if(1===e.t)(t.e._mdf||n)&&(l.setAttribute("x2",h[0]),l.setAttribute("y2",h[1]),u&&!t.g._collapsable&&(t.of.setAttribute("x2",h[0]),t.of.setAttribute("y2",h[1])));else if((t.s._mdf||t.e._mdf||n)&&(o=Math.sqrt(Math.pow(c[0]-h[0],2)+Math.pow(c[1]-h[1],2)),l.setAttribute("r",o),u&&!t.g._collapsable&&t.of.setAttribute("r",o)),t.e._mdf||t.h._mdf||t.a._mdf||n){o||(o=Math.sqrt(Math.pow(c[0]-h[0],2)+Math.pow(c[1]-h[1],2)));var y=Math.atan2(h[1]-c[1],h[0]-c[0]),v=t.h.v;v>=1?v=.99:v<=-1&&(v=-.99);var b=o*v,x=Math.cos(y+t.a.v)*b+c[0],T=Math.sin(y+t.a.v)*b+c[1];l.setAttribute("fx",x),l.setAttribute("fy",T),u&&!t.g._collapsable&&(t.of.setAttribute("fx",x),t.of.setAttribute("fy",T))}}function l(e,t,n){var r=t.style,a=t.d;a&&(a._mdf||n)&&a.dashStr&&(r.pElem.setAttribute("stroke-dasharray",a.dashStr),r.pElem.setAttribute("stroke-dashoffset",a.dashoffset[0])),t.c&&(t.c._mdf||n)&&r.pElem.setAttribute("stroke","rgb("+bmFloor(t.c.v[0])+","+bmFloor(t.c.v[1])+","+bmFloor(t.c.v[2])+")"),(t.o._mdf||n)&&r.pElem.setAttribute("stroke-opacity",t.o.v),(t.w._mdf||n)&&(r.pElem.setAttribute("stroke-width",t.w.v),r.msElem&&r.msElem.setAttribute("stroke-width",t.w.v))}return{createRenderFunction:function(e){switch(e.ty){case"fl":return i;case"gf":return o;case"gs":return s;case"st":return l;case"sh":case"el":case"rc":case"sr":return a;case"tr":return n;case"no":return r;default:return null}}}}();function SVGShapeElement(e,t,n){this.shapes=[],this.shapesData=e.shapes,this.stylesList=[],this.shapeModifiers=[],this.itemsData=[],this.processedElements=[],this.animatedContents=[],this.initElement(e,t,n),this.prevViewData=[]}function LetterProps(e,t,n,r,a,i){this.o=e,this.sw=t,this.sc=n,this.fc=r,this.m=a,this.p=i,this._mdf={o:!0,sw:!!t,sc:!!n,fc:!!r,m:!0,p:!0}}function TextProperty(e,t){this._frameId=initialDefaultFrame,this.pv="",this.v="",this.kf=!1,this._isFirstFrame=!0,this._mdf=!1,t.d&&t.d.sid&&(t.d=e.globalData.slotManager.getProp(t.d)),this.data=t,this.elem=e,this.comp=this.elem.comp,this.keysIndex=0,this.canResize=!1,this.minimumFontSize=1,this.effectsSequence=[],this.currentData={ascent:0,boxWidth:this.defaultBoxWidth,f:"",fStyle:"",fWeight:"",fc:"",j:"",justifyOffset:"",l:[],lh:0,lineWidths:[],ls:"",of:"",s:"",sc:"",sw:0,t:0,tr:0,sz:0,ps:null,fillColorAnim:!1,strokeColorAnim:!1,strokeWidthAnim:!1,yOffset:0,finalSize:0,finalText:[],finalLineHeight:0,__complete:!1},this.copyData(this.currentData,this.data.d.k[0].s),this.searchProperty()||this.completeTextData(this.currentData)}extendPrototype([BaseElement,TransformElement,SVGBaseElement,IShapeElement,HierarchyElement,FrameElement,RenderableDOMElement],SVGShapeElement),SVGShapeElement.prototype.initSecondaryElement=function(){},SVGShapeElement.prototype.identityMatrix=new Matrix,SVGShapeElement.prototype.buildExpressionInterface=function(){},SVGShapeElement.prototype.createContent=function(){this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.layerElement,0,[],!0),this.filterUniqueShapes()},SVGShapeElement.prototype.filterUniqueShapes=function(){var e,t,n,r,a=this.shapes.length,i=this.stylesList.length,s=[],o=!1;for(n=0;n<i;n+=1){for(r=this.stylesList[n],o=!1,s.length=0,e=0;e<a;e+=1)-1!==(t=this.shapes[e]).styles.indexOf(r)&&(s.push(t),o=t._isAnimated||o);s.length>1&&o&&this.setShapesAsAnimated(s)}},SVGShapeElement.prototype.setShapesAsAnimated=function(e){var t,n=e.length;for(t=0;t<n;t+=1)e[t].setAsAnimated()},SVGShapeElement.prototype.createStyleElement=function(e,t){var n,r=new SVGStyleData(e,t),a=r.pElem;return"st"===e.ty?n=new SVGStrokeStyleData(this,e,r):"fl"===e.ty?n=new SVGFillStyleData(this,e,r):"gf"===e.ty||"gs"===e.ty?(n=new("gf"===e.ty?SVGGradientFillStyleData:SVGGradientStrokeStyleData)(this,e,r),this.globalData.defs.appendChild(n.gf),n.maskId&&(this.globalData.defs.appendChild(n.ms),this.globalData.defs.appendChild(n.of),a.setAttribute("mask","url("+getLocationHref()+"#"+n.maskId+")"))):"no"===e.ty&&(n=new SVGNoStyleData(this,e,r)),"st"!==e.ty&&"gs"!==e.ty||(a.setAttribute("stroke-linecap",lineCapEnum[e.lc||2]),a.setAttribute("stroke-linejoin",lineJoinEnum[e.lj||2]),a.setAttribute("fill-opacity","0"),1===e.lj&&a.setAttribute("stroke-miterlimit",e.ml)),2===e.r&&a.setAttribute("fill-rule","evenodd"),e.ln&&a.setAttribute("id",e.ln),e.cl&&a.setAttribute("class",e.cl),e.bm&&(a.style["mix-blend-mode"]=getBlendMode(e.bm)),this.stylesList.push(r),this.addToAnimatedContents(e,n),n},SVGShapeElement.prototype.createGroupElement=function(e){var t=new ShapeGroupData;return e.ln&&t.gr.setAttribute("id",e.ln),e.cl&&t.gr.setAttribute("class",e.cl),e.bm&&(t.gr.style["mix-blend-mode"]=getBlendMode(e.bm)),t},SVGShapeElement.prototype.createTransformElement=function(e,t){var n=TransformPropertyFactory.getTransformProperty(this,e,this),r=new SVGTransformData(n,n.o,t);return this.addToAnimatedContents(e,r),r},SVGShapeElement.prototype.createShapeElement=function(e,t,n){var r=4;"rc"===e.ty?r=5:"el"===e.ty?r=6:"sr"===e.ty&&(r=7);var a=new SVGShapeData(t,n,ShapePropertyFactory.getShapeProp(this,e,r,this));return this.shapes.push(a),this.addShapeToModifiers(a),this.addToAnimatedContents(e,a),a},SVGShapeElement.prototype.addToAnimatedContents=function(e,t){for(var n=0,r=this.animatedContents.length;n<r;){if(this.animatedContents[n].element===t)return;n+=1}this.animatedContents.push({fn:SVGElementsRenderer.createRenderFunction(e),element:t,data:e})},SVGShapeElement.prototype.setElementStyles=function(e){var t,n=e.styles,r=this.stylesList.length;for(t=0;t<r;t+=1)this.stylesList[t].closed||n.push(this.stylesList[t])},SVGShapeElement.prototype.reloadShapes=function(){var e;this._isFirstFrame=!0;var t=this.itemsData.length;for(e=0;e<t;e+=1)this.prevViewData[e]=this.itemsData[e];for(this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.layerElement,0,[],!0),this.filterUniqueShapes(),t=this.dynamicProperties.length,e=0;e<t;e+=1)this.dynamicProperties[e].getValue();this.renderModifiers()},SVGShapeElement.prototype.searchShapes=function(e,t,n,r,a,i,s){var o,l,u,c,h,d,p=[].concat(i),f=e.length-1,m=[],g=[];for(o=f;o>=0;o-=1){if((d=this.searchProcessedElement(e[o]))?t[o]=n[d-1]:e[o]._render=s,"fl"===e[o].ty||"st"===e[o].ty||"gf"===e[o].ty||"gs"===e[o].ty||"no"===e[o].ty)d?t[o].style.closed=!1:t[o]=this.createStyleElement(e[o],a),e[o]._render&&t[o].style.pElem.parentNode!==r&&r.appendChild(t[o].style.pElem),m.push(t[o].style);else if("gr"===e[o].ty){if(d)for(u=t[o].it.length,l=0;l<u;l+=1)t[o].prevViewData[l]=t[o].it[l];else t[o]=this.createGroupElement(e[o]);this.searchShapes(e[o].it,t[o].it,t[o].prevViewData,t[o].gr,a+1,p,s),e[o]._render&&t[o].gr.parentNode!==r&&r.appendChild(t[o].gr)}else"tr"===e[o].ty?(d||(t[o]=this.createTransformElement(e[o],r)),c=t[o].transform,p.push(c)):"sh"===e[o].ty||"rc"===e[o].ty||"el"===e[o].ty||"sr"===e[o].ty?(d||(t[o]=this.createShapeElement(e[o],p,a)),this.setElementStyles(t[o])):"tm"===e[o].ty||"rd"===e[o].ty||"ms"===e[o].ty||"pb"===e[o].ty||"zz"===e[o].ty||"op"===e[o].ty?(d?(h=t[o]).closed=!1:((h=ShapeModifiers.getModifier(e[o].ty)).init(this,e[o]),t[o]=h,this.shapeModifiers.push(h)),g.push(h)):"rp"===e[o].ty&&(d?(h=t[o]).closed=!0:(h=ShapeModifiers.getModifier(e[o].ty),t[o]=h,h.init(this,e,o,t),this.shapeModifiers.push(h),s=!1),g.push(h));this.addProcessedElement(e[o],o+1)}for(f=m.length,o=0;o<f;o+=1)m[o].closed=!0;for(f=g.length,o=0;o<f;o+=1)g[o].closed=!0},SVGShapeElement.prototype.renderInnerContent=function(){var e;this.renderModifiers();var t=this.stylesList.length;for(e=0;e<t;e+=1)this.stylesList[e].reset();for(this.renderShape(),e=0;e<t;e+=1)(this.stylesList[e]._mdf||this._isFirstFrame)&&(this.stylesList[e].msElem&&(this.stylesList[e].msElem.setAttribute("d",this.stylesList[e].d),this.stylesList[e].d="M0 0"+this.stylesList[e].d),this.stylesList[e].pElem.setAttribute("d",this.stylesList[e].d||"M0 0"))},SVGShapeElement.prototype.renderShape=function(){var e,t,n=this.animatedContents.length;for(e=0;e<n;e+=1)t=this.animatedContents[e],(this._isFirstFrame||t.element._isAnimated)&&!0!==t.data&&t.fn(t.data,t.element,this._isFirstFrame)},SVGShapeElement.prototype.destroy=function(){this.destroyBaseElement(),this.shapesData=null,this.itemsData=null},LetterProps.prototype.update=function(e,t,n,r,a,i){this._mdf.o=!1,this._mdf.sw=!1,this._mdf.sc=!1,this._mdf.fc=!1,this._mdf.m=!1,this._mdf.p=!1;var s=!1;return this.o!==e&&(this.o=e,this._mdf.o=!0,s=!0),this.sw!==t&&(this.sw=t,this._mdf.sw=!0,s=!0),this.sc!==n&&(this.sc=n,this._mdf.sc=!0,s=!0),this.fc!==r&&(this.fc=r,this._mdf.fc=!0,s=!0),this.m!==a&&(this.m=a,this._mdf.m=!0,s=!0),!i.length||this.p[0]===i[0]&&this.p[1]===i[1]&&this.p[4]===i[4]&&this.p[5]===i[5]&&this.p[12]===i[12]&&this.p[13]===i[13]||(this.p=i,this._mdf.p=!0,s=!0),s},TextProperty.prototype.defaultBoxWidth=[0,0],TextProperty.prototype.copyData=function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},TextProperty.prototype.setCurrentData=function(e){e.__complete||this.completeTextData(e),this.currentData=e,this.currentData.boxWidth=this.currentData.boxWidth||this.defaultBoxWidth,this._mdf=!0},TextProperty.prototype.searchProperty=function(){return this.searchKeyframes()},TextProperty.prototype.searchKeyframes=function(){return this.kf=this.data.d.k.length>1,this.kf&&this.addEffect(this.getKeyframeValue.bind(this)),this.kf},TextProperty.prototype.addEffect=function(e){this.effectsSequence.push(e),this.elem.addDynamicProperty(this)},TextProperty.prototype.getValue=function(e){if(this.elem.globalData.frameId!==this.frameId&&this.effectsSequence.length||e){this.currentData.t=this.data.d.k[this.keysIndex].s.t;var t=this.currentData,n=this.keysIndex;if(this.lock)this.setCurrentData(this.currentData);else{var r;this.lock=!0,this._mdf=!1;var a=this.effectsSequence.length,i=e||this.data.d.k[this.keysIndex].s;for(r=0;r<a;r+=1)i=n!==this.keysIndex?this.effectsSequence[r](i,i.t):this.effectsSequence[r](this.currentData,i.t);t!==i&&this.setCurrentData(i),this.v=this.currentData,this.pv=this.v,this.lock=!1,this.frameId=this.elem.globalData.frameId}}},TextProperty.prototype.getKeyframeValue=function(){for(var e=this.data.d.k,t=this.elem.comp.renderedFrame,n=0,r=e.length;n<=r-1&&!(n===r-1||e[n+1].t>t);)n+=1;return this.keysIndex!==n&&(this.keysIndex=n),this.data.d.k[this.keysIndex].s},TextProperty.prototype.buildFinalText=function(e){for(var t,n,r=[],a=0,i=e.length,s=!1,o=!1,l="";a<i;)s=o,o=!1,t=e.charCodeAt(a),l=e.charAt(a),FontManager.isCombinedCharacter(t)?s=!0:t>=55296&&t<=56319?FontManager.isRegionalFlag(e,a)?l=e.substr(a,14):(n=e.charCodeAt(a+1))>=56320&&n<=57343&&(FontManager.isModifier(t,n)?(l=e.substr(a,2),s=!0):l=FontManager.isFlagEmoji(e.substr(a,4))?e.substr(a,4):e.substr(a,2)):t>56319?(n=e.charCodeAt(a+1),FontManager.isVariationSelector(t)&&(s=!0)):FontManager.isZeroWidthJoiner(t)&&(s=!0,o=!0),s?(r[r.length-1]+=l,s=!1):r.push(l),a+=l.length;return r},TextProperty.prototype.completeTextData=function(e){e.__complete=!0;var t,n,r,a,i,s,o,l=this.elem.globalData.fontManager,u=this.data,c=[],h=0,d=u.m.g,p=0,f=0,m=0,g=[],y=0,v=0,b=l.getFontByName(e.f),x=0,T=getFontProperties(b);e.fWeight=T.weight,e.fStyle=T.style,e.finalSize=e.s,e.finalText=this.buildFinalText(e.t),n=e.finalText.length,e.finalLineHeight=e.lh;var _,w=e.tr/1e3*e.finalSize;if(e.sz)for(var S,C,E=!0,k=e.sz[0],I=e.sz[1];E;){S=0,y=0,n=(C=this.buildFinalText(e.t)).length,w=e.tr/1e3*e.finalSize;var A=-1;for(t=0;t<n;t+=1)_=C[t].charCodeAt(0),r=!1," "===C[t]?A=t:13!==_&&3!==_||(y=0,r=!0,S+=e.finalLineHeight||1.2*e.finalSize),l.chars?(o=l.getCharData(C[t],b.fStyle,b.fFamily),x=r?0:o.w*e.finalSize/100):x=l.measureText(C[t],e.f,e.finalSize),y+x>k&&" "!==C[t]?(-1===A?n+=1:t=A,S+=e.finalLineHeight||1.2*e.finalSize,C.splice(t,A===t?1:0,"\r"),A=-1,y=0):(y+=x,y+=w);S+=b.ascent*e.finalSize/100,this.canResize&&e.finalSize>this.minimumFontSize&&I<S?(e.finalSize-=1,e.finalLineHeight=e.finalSize*e.lh/e.s):(e.finalText=C,n=e.finalText.length,E=!1)}y=-w,x=0;var N,$=0;for(t=0;t<n;t+=1)if(r=!1,13===(_=(N=e.finalText[t]).charCodeAt(0))||3===_?($=0,g.push(y),v=y>v?y:v,y=-2*w,a="",r=!0,m+=1):a=N,l.chars?(o=l.getCharData(N,b.fStyle,l.getFontByName(e.f).fFamily),x=r?0:o.w*e.finalSize/100):x=l.measureText(a,e.f,e.finalSize)," "===N?$+=x+w:(y+=x+w+$,$=0),c.push({l:x,an:x,add:p,n:r,anIndexes:[],val:a,line:m,animatorJustifyOffset:0}),2==d){if(p+=x,""===a||" "===a||t===n-1){for(""!==a&&" "!==a||(p-=x);f<=t;)c[f].an=p,c[f].ind=h,c[f].extra=x,f+=1;h+=1,p=0}}else if(3==d){if(p+=x,""===a||t===n-1){for(""===a&&(p-=x);f<=t;)c[f].an=p,c[f].ind=h,c[f].extra=x,f+=1;p=0,h+=1}}else c[h].ind=h,c[h].extra=0,h+=1;if(e.l=c,v=y>v?y:v,g.push(y),e.sz)e.boxWidth=e.sz[0],e.justifyOffset=0;else switch(e.boxWidth=v,e.j){case 1:e.justifyOffset=-e.boxWidth;break;case 2:e.justifyOffset=-e.boxWidth/2;break;default:e.justifyOffset=0}e.lineWidths=g;var D,P,R,M,O=u.a;s=O.length;var F=[];for(i=0;i<s;i+=1){for((D=O[i]).a.sc&&(e.strokeColorAnim=!0),D.a.sw&&(e.strokeWidthAnim=!0),(D.a.fc||D.a.fh||D.a.fs||D.a.fb)&&(e.fillColorAnim=!0),M=0,R=D.s.b,t=0;t<n;t+=1)(P=c[t]).anIndexes[i]=M,(1==R&&""!==P.val||2==R&&""!==P.val&&" "!==P.val||3==R&&(P.n||" "==P.val||t==n-1)||4==R&&(P.n||t==n-1))&&(1===D.s.rn&&F.push(M),M+=1);u.a[i].s.totalChars=M;var L,B=-1;if(1===D.s.rn)for(t=0;t<n;t+=1)B!=(P=c[t]).anIndexes[i]&&(B=P.anIndexes[i],L=F.splice(Math.floor(Math.random()*F.length),1)[0]),P.anIndexes[i]=L}e.yOffset=e.finalLineHeight||1.2*e.finalSize,e.ls=e.ls||0,e.ascent=b.ascent*e.finalSize/100},TextProperty.prototype.updateDocumentData=function(e,t){t=void 0===t?this.keysIndex:t;var n=this.copyData({},this.data.d.k[t].s);n=this.copyData(n,e),this.data.d.k[t].s=n,this.recalculate(t),this.setCurrentData(n),this.elem.addDynamicProperty(this)},TextProperty.prototype.recalculate=function(e){var t=this.data.d.k[e].s;t.__complete=!1,this.keysIndex=0,this._isFirstFrame=!0,this.getValue(t)},TextProperty.prototype.canResizeFont=function(e){this.canResize=e,this.recalculate(this.keysIndex),this.elem.addDynamicProperty(this)},TextProperty.prototype.setMinimumFontSize=function(e){this.minimumFontSize=Math.floor(e)||1,this.recalculate(this.keysIndex),this.elem.addDynamicProperty(this)};var TextSelectorProp=function(){var e=Math.max,t=Math.min,n=Math.floor;function r(e,t){this._currentTextLength=-1,this.k=!1,this.data=t,this.elem=e,this.comp=e.comp,this.finalS=0,this.finalE=0,this.initDynamicPropertyContainer(e),this.s=PropertyFactory.getProp(e,t.s||{k:0},0,0,this),this.e="e"in t?PropertyFactory.getProp(e,t.e,0,0,this):{v:100},this.o=PropertyFactory.getProp(e,t.o||{k:0},0,0,this),this.xe=PropertyFactory.getProp(e,t.xe||{k:0},0,0,this),this.ne=PropertyFactory.getProp(e,t.ne||{k:0},0,0,this),this.sm=PropertyFactory.getProp(e,t.sm||{k:100},0,0,this),this.a=PropertyFactory.getProp(e,t.a,0,.01,this),this.dynamicProperties.length||this.getValue()}return r.prototype={getMult:function(r){this._currentTextLength!==this.elem.textProperty.currentData.l.length&&this.getValue();var a=0,i=0,s=1,o=1;this.ne.v>0?a=this.ne.v/100:i=-this.ne.v/100,this.xe.v>0?s=1-this.xe.v/100:o=1+this.xe.v/100;var l=BezierFactory.getBezierEasing(a,i,s,o).get,u=0,c=this.finalS,h=this.finalE,d=this.data.sh;if(2===d)u=l(u=h===c?r>=h?1:0:e(0,t(.5/(h-c)+(r-c)/(h-c),1)));else if(3===d)u=l(u=h===c?r>=h?0:1:1-e(0,t(.5/(h-c)+(r-c)/(h-c),1)));else if(4===d)h===c?u=0:(u=e(0,t(.5/(h-c)+(r-c)/(h-c),1)))<.5?u*=2:u=1-2*(u-.5),u=l(u);else if(5===d){if(h===c)u=0;else{var p=h-c,f=-p/2+(r=t(e(0,r+.5-c),h-c)),m=p/2;u=Math.sqrt(1-f*f/(m*m))}u=l(u)}else 6===d?(h===c?u=0:(r=t(e(0,r+.5-c),h-c),u=(1+Math.cos(Math.PI+2*Math.PI*r/(h-c)))/2),u=l(u)):(r>=n(c)&&(u=e(0,t(r-c<0?t(h,1)-(c-r):h-r,1))),u=l(u));if(100!==this.sm.v){var g=.01*this.sm.v;0===g&&(g=1e-8);var y=.5-.5*g;u<y?u=0:(u=(u-y)/g)>1&&(u=1)}return u*this.a.v},getValue:function(e){this.iterateDynamicProperties(),this._mdf=e||this._mdf,this._currentTextLength=this.elem.textProperty.currentData.l.length||0,e&&2===this.data.r&&(this.e.v=this._currentTextLength);var t=2===this.data.r?1:100/this.data.totalChars,n=this.o.v/t,r=this.s.v/t+n,a=this.e.v/t+n;if(r>a){var i=r;r=a,a=i}this.finalS=r,this.finalE=a}},extendPrototype([DynamicPropertyContainer],r),{getTextSelectorProp:function(e,t,n){return new r(e,t)}}}();function TextAnimatorDataProperty(e,t,n){var r={propType:!1},a=PropertyFactory.getProp,i=t.a;this.a={r:i.r?a(e,i.r,0,degToRads,n):r,rx:i.rx?a(e,i.rx,0,degToRads,n):r,ry:i.ry?a(e,i.ry,0,degToRads,n):r,sk:i.sk?a(e,i.sk,0,degToRads,n):r,sa:i.sa?a(e,i.sa,0,degToRads,n):r,s:i.s?a(e,i.s,1,.01,n):r,a:i.a?a(e,i.a,1,0,n):r,o:i.o?a(e,i.o,0,.01,n):r,p:i.p?a(e,i.p,1,0,n):r,sw:i.sw?a(e,i.sw,0,0,n):r,sc:i.sc?a(e,i.sc,1,0,n):r,fc:i.fc?a(e,i.fc,1,0,n):r,fh:i.fh?a(e,i.fh,0,0,n):r,fs:i.fs?a(e,i.fs,0,.01,n):r,fb:i.fb?a(e,i.fb,0,.01,n):r,t:i.t?a(e,i.t,0,0,n):r},this.s=TextSelectorProp.getTextSelectorProp(e,t.s,n),this.s.t=t.s.t}function TextAnimatorProperty(e,t,n){this._isFirstFrame=!0,this._hasMaskedPath=!1,this._frameId=-1,this._textData=e,this._renderType=t,this._elem=n,this._animatorsData=createSizedArray(this._textData.a.length),this._pathData={},this._moreOptions={alignment:{}},this.renderedLetters=[],this.lettersChangedFlag=!1,this.initDynamicPropertyContainer(n)}function ITextElement(){}TextAnimatorProperty.prototype.searchProperties=function(){var e,t,n=this._textData.a.length,r=PropertyFactory.getProp;for(e=0;e<n;e+=1)t=this._textData.a[e],this._animatorsData[e]=new TextAnimatorDataProperty(this._elem,t,this);this._textData.p&&"m"in this._textData.p?(this._pathData={a:r(this._elem,this._textData.p.a,0,0,this),f:r(this._elem,this._textData.p.f,0,0,this),l:r(this._elem,this._textData.p.l,0,0,this),r:r(this._elem,this._textData.p.r,0,0,this),p:r(this._elem,this._textData.p.p,0,0,this),m:this._elem.maskManager.getMaskProperty(this._textData.p.m)},this._hasMaskedPath=!0):this._hasMaskedPath=!1,this._moreOptions.alignment=r(this._elem,this._textData.m.a,1,0,this)},TextAnimatorProperty.prototype.getMeasures=function(e,t){if(this.lettersChangedFlag=t,this._mdf||this._isFirstFrame||t||this._hasMaskedPath&&this._pathData.m._mdf){this._isFirstFrame=!1;var n,r,a,i,s,o,l,u,c,h,d,p,f,m,g,y,v,b,x,T=this._moreOptions.alignment.v,_=this._animatorsData,w=this._textData,S=this.mHelper,C=this._renderType,E=this.renderedLetters.length,k=e.l;if(this._hasMaskedPath){if(x=this._pathData.m,!this._pathData.n||this._pathData._mdf){var I,A=x.v;for(this._pathData.r.v&&(A=A.reverse()),s={tLength:0,segments:[]},i=A._length-1,y=0,a=0;a<i;a+=1)I=bez.buildBezierData(A.v[a],A.v[a+1],[A.o[a][0]-A.v[a][0],A.o[a][1]-A.v[a][1]],[A.i[a+1][0]-A.v[a+1][0],A.i[a+1][1]-A.v[a+1][1]]),s.tLength+=I.segmentLength,s.segments.push(I),y+=I.segmentLength;a=i,x.v.c&&(I=bez.buildBezierData(A.v[a],A.v[0],[A.o[a][0]-A.v[a][0],A.o[a][1]-A.v[a][1]],[A.i[0][0]-A.v[0][0],A.i[0][1]-A.v[0][1]]),s.tLength+=I.segmentLength,s.segments.push(I),y+=I.segmentLength),this._pathData.pi=s}if(s=this._pathData.pi,o=this._pathData.f.v,d=0,h=1,u=0,c=!0,m=s.segments,o<0&&x.v.c)for(s.tLength<Math.abs(o)&&(o=-Math.abs(o)%s.tLength),h=(f=m[d=m.length-1].points).length-1;o<0;)o+=f[h].partialLength,(h-=1)<0&&(h=(f=m[d-=1].points).length-1);p=(f=m[d].points)[h-1],g=(l=f[h]).partialLength}i=k.length,n=0,r=0;var N,$,D,P,R,M=1.2*e.finalSize*.714,O=!0;D=_.length;var F,L,B,V,U,z,G,W,H,j,q,K,X=-1,Y=o,Z=d,J=h,Q=-1,ee="",te=this.defaultPropsArray;if(2===e.j||1===e.j){var ne=0,re=0,ae=2===e.j?-.5:-1,ie=0,se=!0;for(a=0;a<i;a+=1)if(k[a].n){for(ne&&(ne+=re);ie<a;)k[ie].animatorJustifyOffset=ne,ie+=1;ne=0,se=!0}else{for($=0;$<D;$+=1)(N=_[$].a).t.propType&&(se&&2===e.j&&(re+=N.t.v*ae),(R=_[$].s.getMult(k[a].anIndexes[$],w.a[$].s.totalChars)).length?ne+=N.t.v*R[0]*ae:ne+=N.t.v*R*ae);se=!1}for(ne&&(ne+=re);ie<a;)k[ie].animatorJustifyOffset=ne,ie+=1}for(a=0;a<i;a+=1){if(S.reset(),V=1,k[a].n)n=0,r+=e.yOffset,r+=O?1:0,o=Y,O=!1,this._hasMaskedPath&&(h=J,p=(f=m[d=Z].points)[h-1],g=(l=f[h]).partialLength,u=0),ee="",q="",H="",K="",te=this.defaultPropsArray;else{if(this._hasMaskedPath){if(Q!==k[a].line){switch(e.j){case 1:o+=y-e.lineWidths[k[a].line];break;case 2:o+=(y-e.lineWidths[k[a].line])/2}Q=k[a].line}X!==k[a].ind&&(k[X]&&(o+=k[X].extra),o+=k[a].an/2,X=k[a].ind),o+=T[0]*k[a].an*.005;var oe=0;for($=0;$<D;$+=1)(N=_[$].a).p.propType&&((R=_[$].s.getMult(k[a].anIndexes[$],w.a[$].s.totalChars)).length?oe+=N.p.v[0]*R[0]:oe+=N.p.v[0]*R),N.a.propType&&((R=_[$].s.getMult(k[a].anIndexes[$],w.a[$].s.totalChars)).length?oe+=N.a.v[0]*R[0]:oe+=N.a.v[0]*R);for(c=!0,this._pathData.a.v&&(o=.5*k[0].an+(y-this._pathData.f.v-.5*k[0].an-.5*k[k.length-1].an)*X/(i-1),o+=this._pathData.f.v);c;)u+g>=o+oe||!f?(v=(o+oe-u)/l.partialLength,L=p.point[0]+(l.point[0]-p.point[0])*v,B=p.point[1]+(l.point[1]-p.point[1])*v,S.translate(-T[0]*k[a].an*.005,-T[1]*M*.01),c=!1):f&&(u+=l.partialLength,(h+=1)>=f.length&&(h=0,m[d+=1]?f=m[d].points:x.v.c?(h=0,f=m[d=0].points):(u-=l.partialLength,f=null)),f&&(p=l,g=(l=f[h]).partialLength));F=k[a].an/2-k[a].add,S.translate(-F,0,0)}else F=k[a].an/2-k[a].add,S.translate(-F,0,0),S.translate(-T[0]*k[a].an*.005,-T[1]*M*.01,0);for($=0;$<D;$+=1)(N=_[$].a).t.propType&&(R=_[$].s.getMult(k[a].anIndexes[$],w.a[$].s.totalChars),0===n&&0===e.j||(this._hasMaskedPath?R.length?o+=N.t.v*R[0]:o+=N.t.v*R:R.length?n+=N.t.v*R[0]:n+=N.t.v*R));for(e.strokeWidthAnim&&(z=e.sw||0),e.strokeColorAnim&&(U=e.sc?[e.sc[0],e.sc[1],e.sc[2]]:[0,0,0]),e.fillColorAnim&&e.fc&&(G=[e.fc[0],e.fc[1],e.fc[2]]),$=0;$<D;$+=1)(N=_[$].a).a.propType&&((R=_[$].s.getMult(k[a].anIndexes[$],w.a[$].s.totalChars)).length?S.translate(-N.a.v[0]*R[0],-N.a.v[1]*R[1],N.a.v[2]*R[2]):S.translate(-N.a.v[0]*R,-N.a.v[1]*R,N.a.v[2]*R));for($=0;$<D;$+=1)(N=_[$].a).s.propType&&((R=_[$].s.getMult(k[a].anIndexes[$],w.a[$].s.totalChars)).length?S.scale(1+(N.s.v[0]-1)*R[0],1+(N.s.v[1]-1)*R[1],1):S.scale(1+(N.s.v[0]-1)*R,1+(N.s.v[1]-1)*R,1));for($=0;$<D;$+=1){if(N=_[$].a,R=_[$].s.getMult(k[a].anIndexes[$],w.a[$].s.totalChars),N.sk.propType&&(R.length?S.skewFromAxis(-N.sk.v*R[0],N.sa.v*R[1]):S.skewFromAxis(-N.sk.v*R,N.sa.v*R)),N.r.propType&&(R.length?S.rotateZ(-N.r.v*R[2]):S.rotateZ(-N.r.v*R)),N.ry.propType&&(R.length?S.rotateY(N.ry.v*R[1]):S.rotateY(N.ry.v*R)),N.rx.propType&&(R.length?S.rotateX(N.rx.v*R[0]):S.rotateX(N.rx.v*R)),N.o.propType&&(R.length?V+=(N.o.v*R[0]-V)*R[0]:V+=(N.o.v*R-V)*R),e.strokeWidthAnim&&N.sw.propType&&(R.length?z+=N.sw.v*R[0]:z+=N.sw.v*R),e.strokeColorAnim&&N.sc.propType)for(W=0;W<3;W+=1)R.length?U[W]+=(N.sc.v[W]-U[W])*R[0]:U[W]+=(N.sc.v[W]-U[W])*R;if(e.fillColorAnim&&e.fc){if(N.fc.propType)for(W=0;W<3;W+=1)R.length?G[W]+=(N.fc.v[W]-G[W])*R[0]:G[W]+=(N.fc.v[W]-G[W])*R;N.fh.propType&&(G=R.length?addHueToRGB(G,N.fh.v*R[0]):addHueToRGB(G,N.fh.v*R)),N.fs.propType&&(G=R.length?addSaturationToRGB(G,N.fs.v*R[0]):addSaturationToRGB(G,N.fs.v*R)),N.fb.propType&&(G=R.length?addBrightnessToRGB(G,N.fb.v*R[0]):addBrightnessToRGB(G,N.fb.v*R))}}for($=0;$<D;$+=1)(N=_[$].a).p.propType&&(R=_[$].s.getMult(k[a].anIndexes[$],w.a[$].s.totalChars),this._hasMaskedPath?R.length?S.translate(0,N.p.v[1]*R[0],-N.p.v[2]*R[1]):S.translate(0,N.p.v[1]*R,-N.p.v[2]*R):R.length?S.translate(N.p.v[0]*R[0],N.p.v[1]*R[1],-N.p.v[2]*R[2]):S.translate(N.p.v[0]*R,N.p.v[1]*R,-N.p.v[2]*R));if(e.strokeWidthAnim&&(H=z<0?0:z),e.strokeColorAnim&&(j="rgb("+Math.round(255*U[0])+","+Math.round(255*U[1])+","+Math.round(255*U[2])+")"),e.fillColorAnim&&e.fc&&(q="rgb("+Math.round(255*G[0])+","+Math.round(255*G[1])+","+Math.round(255*G[2])+")"),this._hasMaskedPath){if(S.translate(0,-e.ls),S.translate(0,T[1]*M*.01+r,0),this._pathData.p.v){b=(l.point[1]-p.point[1])/(l.point[0]-p.point[0]);var le=180*Math.atan(b)/Math.PI;l.point[0]<p.point[0]&&(le+=180),S.rotate(-le*Math.PI/180)}S.translate(L,B,0),o-=T[0]*k[a].an*.005,k[a+1]&&X!==k[a+1].ind&&(o+=k[a].an/2,o+=.001*e.tr*e.finalSize)}else{switch(S.translate(n,r,0),e.ps&&S.translate(e.ps[0],e.ps[1]+e.ascent,0),e.j){case 1:S.translate(k[a].animatorJustifyOffset+e.justifyOffset+(e.boxWidth-e.lineWidths[k[a].line]),0,0);break;case 2:S.translate(k[a].animatorJustifyOffset+e.justifyOffset+(e.boxWidth-e.lineWidths[k[a].line])/2,0,0)}S.translate(0,-e.ls),S.translate(F,0,0),S.translate(T[0]*k[a].an*.005,T[1]*M*.01,0),n+=k[a].l+.001*e.tr*e.finalSize}"html"===C?ee=S.toCSS():"svg"===C?ee=S.to2dCSS():te=[S.props[0],S.props[1],S.props[2],S.props[3],S.props[4],S.props[5],S.props[6],S.props[7],S.props[8],S.props[9],S.props[10],S.props[11],S.props[12],S.props[13],S.props[14],S.props[15]],K=V}E<=a?(P=new LetterProps(K,H,j,q,ee,te),this.renderedLetters.push(P),E+=1,this.lettersChangedFlag=!0):(P=this.renderedLetters[a],this.lettersChangedFlag=P.update(K,H,j,q,ee,te)||this.lettersChangedFlag)}}},TextAnimatorProperty.prototype.getValue=function(){this._elem.globalData.frameId!==this._frameId&&(this._frameId=this._elem.globalData.frameId,this.iterateDynamicProperties())},TextAnimatorProperty.prototype.mHelper=new Matrix,TextAnimatorProperty.prototype.defaultPropsArray=[],extendPrototype([DynamicPropertyContainer],TextAnimatorProperty),ITextElement.prototype.initElement=function(e,t,n){this.lettersChangedFlag=!0,this.initFrame(),this.initBaseData(e,t,n),this.textProperty=new TextProperty(this,e.t,this.dynamicProperties),this.textAnimator=new TextAnimatorProperty(e.t,this.renderType,this),this.initTransform(e,t,n),this.initHierarchy(),this.initRenderable(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),this.createContent(),this.hide(),this.textAnimator.searchProperties(this.dynamicProperties)},ITextElement.prototype.prepareFrame=function(e){this._mdf=!1,this.prepareRenderableFrame(e),this.prepareProperties(e,this.isInRange)},ITextElement.prototype.createPathShape=function(e,t){var n,r,a=t.length,i="";for(n=0;n<a;n+=1)"sh"===t[n].ty&&(r=t[n].ks.k,i+=buildShapeString(r,r.i.length,!0,e));return i},ITextElement.prototype.updateDocumentData=function(e,t){this.textProperty.updateDocumentData(e,t)},ITextElement.prototype.canResizeFont=function(e){this.textProperty.canResizeFont(e)},ITextElement.prototype.setMinimumFontSize=function(e){this.textProperty.setMinimumFontSize(e)},ITextElement.prototype.applyTextPropertiesToMatrix=function(e,t,n,r,a){switch(e.ps&&t.translate(e.ps[0],e.ps[1]+e.ascent,0),t.translate(0,-e.ls,0),e.j){case 1:t.translate(e.justifyOffset+(e.boxWidth-e.lineWidths[n]),0,0);break;case 2:t.translate(e.justifyOffset+(e.boxWidth-e.lineWidths[n])/2,0,0)}t.translate(r,a,0)},ITextElement.prototype.buildColor=function(e){return"rgb("+Math.round(255*e[0])+","+Math.round(255*e[1])+","+Math.round(255*e[2])+")"},ITextElement.prototype.emptyProp=new LetterProps,ITextElement.prototype.destroy=function(){},ITextElement.prototype.validateText=function(){(this.textProperty._mdf||this.textProperty._isFirstFrame)&&(this.buildNewText(),this.textProperty._isFirstFrame=!1,this.textProperty._mdf=!1)};var emptyShapeData={shapes:[]};function SVGTextLottieElement(e,t,n){this.textSpans=[],this.renderType="svg",this.initElement(e,t,n)}function ISolidElement(e,t,n){this.initElement(e,t,n)}function NullElement(e,t,n){this.initFrame(),this.initBaseData(e,t,n),this.initFrame(),this.initTransform(e,t,n),this.initHierarchy()}function SVGRendererBase(){}function ICompElement(){}function SVGCompElement(e,t,n){this.layers=e.layers,this.supports3d=!0,this.completeLayers=!1,this.pendingElements=[],this.elements=this.layers?createSizedArray(this.layers.length):[],this.initElement(e,t,n),this.tm=e.tm?PropertyFactory.getProp(this,e.tm,0,t.frameRate,this):{_placeholder:!0}}function SVGRenderer(e,t){this.animationItem=e,this.layers=null,this.renderedFrame=-1,this.svgElement=createNS("svg");var n="";if(t&&t.title){var r=createNS("title"),a=createElementID();r.setAttribute("id",a),r.textContent=t.title,this.svgElement.appendChild(r),n+=a}if(t&&t.description){var i=createNS("desc"),s=createElementID();i.setAttribute("id",s),i.textContent=t.description,this.svgElement.appendChild(i),n+=" "+s}n&&this.svgElement.setAttribute("aria-labelledby",n);var o=createNS("defs");this.svgElement.appendChild(o);var l=createNS("g");this.svgElement.appendChild(l),this.layerElement=l,this.renderConfig={preserveAspectRatio:t&&t.preserveAspectRatio||"xMidYMid meet",imagePreserveAspectRatio:t&&t.imagePreserveAspectRatio||"xMidYMid slice",contentVisibility:t&&t.contentVisibility||"visible",progressiveLoad:t&&t.progressiveLoad||!1,hideOnTransparent:!(t&&!1===t.hideOnTransparent),viewBoxOnly:t&&t.viewBoxOnly||!1,viewBoxSize:t&&t.viewBoxSize||!1,className:t&&t.className||"",id:t&&t.id||"",focusable:t&&t.focusable,filterSize:{width:t&&t.filterSize&&t.filterSize.width||"100%",height:t&&t.filterSize&&t.filterSize.height||"100%",x:t&&t.filterSize&&t.filterSize.x||"0%",y:t&&t.filterSize&&t.filterSize.y||"0%"},width:t&&t.width,height:t&&t.height,runExpressions:!t||void 0===t.runExpressions||t.runExpressions},this.globalData={_mdf:!1,frameNum:-1,defs:o,renderConfig:this.renderConfig},this.elements=[],this.pendingElements=[],this.destroyed=!1,this.rendererType="svg"}function ShapeTransformManager(){this.sequences={},this.sequenceList=[],this.transform_key_count=0}extendPrototype([BaseElement,TransformElement,SVGBaseElement,HierarchyElement,FrameElement,RenderableDOMElement,ITextElement],SVGTextLottieElement),SVGTextLottieElement.prototype.createContent=function(){this.data.singleShape&&!this.globalData.fontManager.chars&&(this.textContainer=createNS("text"))},SVGTextLottieElement.prototype.buildTextContents=function(e){for(var t=0,n=e.length,r=[],a="";t<n;)e[t]===String.fromCharCode(13)||e[t]===String.fromCharCode(3)?(r.push(a),a=""):a+=e[t],t+=1;return r.push(a),r},SVGTextLottieElement.prototype.buildShapeData=function(e,t){if(e.shapes&&e.shapes.length){var n=e.shapes[0];if(n.it){var r=n.it[n.it.length-1];r.s&&(r.s.k[0]=t,r.s.k[1]=t)}}return e},SVGTextLottieElement.prototype.buildNewText=function(){var e,t;this.addDynamicProperty(this);var n=this.textProperty.currentData;this.renderedLetters=createSizedArray(n?n.l.length:0),n.fc?this.layerElement.setAttribute("fill",this.buildColor(n.fc)):this.layerElement.setAttribute("fill","rgba(0,0,0,0)"),n.sc&&(this.layerElement.setAttribute("stroke",this.buildColor(n.sc)),this.layerElement.setAttribute("stroke-width",n.sw)),this.layerElement.setAttribute("font-size",n.finalSize);var r=this.globalData.fontManager.getFontByName(n.f);if(r.fClass)this.layerElement.setAttribute("class",r.fClass);else{this.layerElement.setAttribute("font-family",r.fFamily);var a=n.fWeight,i=n.fStyle;this.layerElement.setAttribute("font-style",i),this.layerElement.setAttribute("font-weight",a)}this.layerElement.setAttribute("aria-label",n.t);var s,o=n.l||[],l=!!this.globalData.fontManager.chars;t=o.length;var u=this.mHelper,c=this.data.singleShape,h=0,d=0,p=!0,f=.001*n.tr*n.finalSize;if(!c||l||n.sz){var m,g=this.textSpans.length;for(e=0;e<t;e+=1){if(this.textSpans[e]||(this.textSpans[e]={span:null,childSpan:null,glyph:null}),!l||!c||0===e){if(s=g>e?this.textSpans[e].span:createNS(l?"g":"text"),g<=e){if(s.setAttribute("stroke-linecap","butt"),s.setAttribute("stroke-linejoin","round"),s.setAttribute("stroke-miterlimit","4"),this.textSpans[e].span=s,l){var y=createNS("g");s.appendChild(y),this.textSpans[e].childSpan=y}this.textSpans[e].span=s,this.layerElement.appendChild(s)}s.style.display="inherit"}if(u.reset(),c&&(o[e].n&&(h=-f,d+=n.yOffset,d+=p?1:0,p=!1),this.applyTextPropertiesToMatrix(n,u,o[e].line,h,d),h+=o[e].l||0,h+=f),l){var v;if(1===(m=this.globalData.fontManager.getCharData(n.finalText[e],r.fStyle,this.globalData.fontManager.getFontByName(n.f).fFamily)).t)v=new SVGCompElement(m.data,this.globalData,this);else{var b=emptyShapeData;m.data&&m.data.shapes&&(b=this.buildShapeData(m.data,n.finalSize)),v=new SVGShapeElement(b,this.globalData,this)}if(this.textSpans[e].glyph){var x=this.textSpans[e].glyph;this.textSpans[e].childSpan.removeChild(x.layerElement),x.destroy()}this.textSpans[e].glyph=v,v._debug=!0,v.prepareFrame(0),v.renderFrame(),this.textSpans[e].childSpan.appendChild(v.layerElement),1===m.t&&this.textSpans[e].childSpan.setAttribute("transform","scale("+n.finalSize/100+","+n.finalSize/100+")")}else c&&s.setAttribute("transform","translate("+u.props[12]+","+u.props[13]+")"),s.textContent=o[e].val,s.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve")}c&&s&&s.setAttribute("d","")}else{var T=this.textContainer,_="start";switch(n.j){case 1:_="end";break;case 2:_="middle";break;default:_="start"}T.setAttribute("text-anchor",_),T.setAttribute("letter-spacing",f);var w=this.buildTextContents(n.finalText);for(t=w.length,d=n.ps?n.ps[1]+n.ascent:0,e=0;e<t;e+=1)(s=this.textSpans[e].span||createNS("tspan")).textContent=w[e],s.setAttribute("x",0),s.setAttribute("y",d),s.style.display="inherit",T.appendChild(s),this.textSpans[e]||(this.textSpans[e]={span:null,glyph:null}),this.textSpans[e].span=s,d+=n.finalLineHeight;this.layerElement.appendChild(T)}for(;e<this.textSpans.length;)this.textSpans[e].span.style.display="none",e+=1;this._sizeChanged=!0},SVGTextLottieElement.prototype.sourceRectAtTime=function(){if(this.prepareFrame(this.comp.renderedFrame-this.data.st),this.renderInnerContent(),this._sizeChanged){this._sizeChanged=!1;var e=this.layerElement.getBBox();this.bbox={top:e.y,left:e.x,width:e.width,height:e.height}}return this.bbox},SVGTextLottieElement.prototype.getValue=function(){var e,t,n=this.textSpans.length;for(this.renderedFrame=this.comp.renderedFrame,e=0;e<n;e+=1)(t=this.textSpans[e].glyph)&&(t.prepareFrame(this.comp.renderedFrame-this.data.st),t._mdf&&(this._mdf=!0))},SVGTextLottieElement.prototype.renderInnerContent=function(){if(this.validateText(),(!this.data.singleShape||this._mdf)&&(this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag),this.lettersChangedFlag||this.textAnimator.lettersChangedFlag)){var e,t;this._sizeChanged=!0;var n,r,a,i=this.textAnimator.renderedLetters,s=this.textProperty.currentData.l;for(t=s.length,e=0;e<t;e+=1)s[e].n||(n=i[e],r=this.textSpans[e].span,(a=this.textSpans[e].glyph)&&a.renderFrame(),n._mdf.m&&r.setAttribute("transform",n.m),n._mdf.o&&r.setAttribute("opacity",n.o),n._mdf.sw&&r.setAttribute("stroke-width",n.sw),n._mdf.sc&&r.setAttribute("stroke",n.sc),n._mdf.fc&&r.setAttribute("fill",n.fc))}},extendPrototype([IImageElement],ISolidElement),ISolidElement.prototype.createContent=function(){var e=createNS("rect");e.setAttribute("width",this.data.sw),e.setAttribute("height",this.data.sh),e.setAttribute("fill",this.data.sc),this.layerElement.appendChild(e)},NullElement.prototype.prepareFrame=function(e){this.prepareProperties(e,!0)},NullElement.prototype.renderFrame=function(){},NullElement.prototype.getBaseElement=function(){return null},NullElement.prototype.destroy=function(){},NullElement.prototype.sourceRectAtTime=function(){},NullElement.prototype.hide=function(){},extendPrototype([BaseElement,TransformElement,HierarchyElement,FrameElement],NullElement),extendPrototype([BaseRenderer],SVGRendererBase),SVGRendererBase.prototype.createNull=function(e){return new NullElement(e,this.globalData,this)},SVGRendererBase.prototype.createShape=function(e){return new SVGShapeElement(e,this.globalData,this)},SVGRendererBase.prototype.createText=function(e){return new SVGTextLottieElement(e,this.globalData,this)},SVGRendererBase.prototype.createImage=function(e){return new IImageElement(e,this.globalData,this)},SVGRendererBase.prototype.createSolid=function(e){return new ISolidElement(e,this.globalData,this)},SVGRendererBase.prototype.configAnimation=function(e){this.svgElement.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.svgElement.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),this.renderConfig.viewBoxSize?this.svgElement.setAttribute("viewBox",this.renderConfig.viewBoxSize):this.svgElement.setAttribute("viewBox","0 0 "+e.w+" "+e.h),this.renderConfig.viewBoxOnly||(this.svgElement.setAttribute("width",e.w),this.svgElement.setAttribute("height",e.h),this.svgElement.style.width="100%",this.svgElement.style.height="100%",this.svgElement.style.transform="translate3d(0,0,0)",this.svgElement.style.contentVisibility=this.renderConfig.contentVisibility),this.renderConfig.width&&this.svgElement.setAttribute("width",this.renderConfig.width),this.renderConfig.height&&this.svgElement.setAttribute("height",this.renderConfig.height),this.renderConfig.className&&this.svgElement.setAttribute("class",this.renderConfig.className),this.renderConfig.id&&this.svgElement.setAttribute("id",this.renderConfig.id),void 0!==this.renderConfig.focusable&&this.svgElement.setAttribute("focusable",this.renderConfig.focusable),this.svgElement.setAttribute("preserveAspectRatio",this.renderConfig.preserveAspectRatio),this.animationItem.wrapper.appendChild(this.svgElement);var t=this.globalData.defs;this.setupGlobalData(e,t),this.globalData.progressiveLoad=this.renderConfig.progressiveLoad,this.data=e;var n=createNS("clipPath"),r=createNS("rect");r.setAttribute("width",e.w),r.setAttribute("height",e.h),r.setAttribute("x",0),r.setAttribute("y",0);var a=createElementID();n.setAttribute("id",a),n.appendChild(r),this.layerElement.setAttribute("clip-path","url("+getLocationHref()+"#"+a+")"),t.appendChild(n),this.layers=e.layers,this.elements=createSizedArray(e.layers.length)},SVGRendererBase.prototype.destroy=function(){var e;this.animationItem.wrapper&&(this.animationItem.wrapper.innerText=""),this.layerElement=null,this.globalData.defs=null;var t=this.layers?this.layers.length:0;for(e=0;e<t;e+=1)this.elements[e]&&this.elements[e].destroy&&this.elements[e].destroy();this.elements.length=0,this.destroyed=!0,this.animationItem=null},SVGRendererBase.prototype.updateContainerSize=function(){},SVGRendererBase.prototype.findIndexByInd=function(e){var t=0,n=this.layers.length;for(t=0;t<n;t+=1)if(this.layers[t].ind===e)return t;return-1},SVGRendererBase.prototype.buildItem=function(e){var t=this.elements;if(!t[e]&&99!==this.layers[e].ty){t[e]=!0;var n=this.createItem(this.layers[e]);if(t[e]=n,getExpressionsPlugin()&&(0===this.layers[e].ty&&this.globalData.projectInterface.registerComposition(n),n.initExpressions()),this.appendElementInPos(n,e),this.layers[e].tt){var r="tp"in this.layers[e]?this.findIndexByInd(this.layers[e].tp):e-1;if(-1===r)return;if(this.elements[r]&&!0!==this.elements[r]){var a=t[r].getMatte(this.layers[e].tt);n.setMatte(a)}else this.buildItem(r),this.addPendingElement(n)}}},SVGRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;){var e=this.pendingElements.pop();if(e.checkParenting(),e.data.tt)for(var t=0,n=this.elements.length;t<n;){if(this.elements[t]===e){var r="tp"in e.data?this.findIndexByInd(e.data.tp):t-1,a=this.elements[r].getMatte(this.layers[t].tt);e.setMatte(a);break}t+=1}}},SVGRendererBase.prototype.renderFrame=function(e){if(this.renderedFrame!==e&&!this.destroyed){var t;null===e?e=this.renderedFrame:this.renderedFrame=e,this.globalData.frameNum=e,this.globalData.frameId+=1,this.globalData.projectInterface.currentFrame=e,this.globalData._mdf=!1;var n=this.layers.length;for(this.completeLayers||this.checkLayers(e),t=n-1;t>=0;t-=1)(this.completeLayers||this.elements[t])&&this.elements[t].prepareFrame(e-this.layers[t].st);if(this.globalData._mdf)for(t=0;t<n;t+=1)(this.completeLayers||this.elements[t])&&this.elements[t].renderFrame()}},SVGRendererBase.prototype.appendElementInPos=function(e,t){var n=e.getBaseElement();if(n){for(var r,a=0;a<t;)this.elements[a]&&!0!==this.elements[a]&&this.elements[a].getBaseElement()&&(r=this.elements[a].getBaseElement()),a+=1;r?this.layerElement.insertBefore(n,r):this.layerElement.appendChild(n)}},SVGRendererBase.prototype.hide=function(){this.layerElement.style.display="none"},SVGRendererBase.prototype.show=function(){this.layerElement.style.display="block"},extendPrototype([BaseElement,TransformElement,HierarchyElement,FrameElement,RenderableDOMElement],ICompElement),ICompElement.prototype.initElement=function(e,t,n){this.initFrame(),this.initBaseData(e,t,n),this.initTransform(e,t,n),this.initRenderable(),this.initHierarchy(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),!this.data.xt&&t.progressiveLoad||this.buildAllItems(),this.hide()},ICompElement.prototype.prepareFrame=function(e){if(this._mdf=!1,this.prepareRenderableFrame(e),this.prepareProperties(e,this.isInRange),this.isInRange||this.data.xt){if(this.tm._placeholder)this.renderedFrame=e/this.data.sr;else{var t=this.tm.v;t===this.data.op&&(t=this.data.op-1),this.renderedFrame=t}var n,r=this.elements.length;for(this.completeLayers||this.checkLayers(this.renderedFrame),n=r-1;n>=0;n-=1)(this.completeLayers||this.elements[n])&&(this.elements[n].prepareFrame(this.renderedFrame-this.layers[n].st),this.elements[n]._mdf&&(this._mdf=!0))}},ICompElement.prototype.renderInnerContent=function(){var e,t=this.layers.length;for(e=0;e<t;e+=1)(this.completeLayers||this.elements[e])&&this.elements[e].renderFrame()},ICompElement.prototype.setElements=function(e){this.elements=e},ICompElement.prototype.getElements=function(){return this.elements},ICompElement.prototype.destroyElements=function(){var e,t=this.layers.length;for(e=0;e<t;e+=1)this.elements[e]&&this.elements[e].destroy()},ICompElement.prototype.destroy=function(){this.destroyElements(),this.destroyBaseElement()},extendPrototype([SVGRendererBase,ICompElement,SVGBaseElement],SVGCompElement),SVGCompElement.prototype.createComp=function(e){return new SVGCompElement(e,this.globalData,this)},extendPrototype([SVGRendererBase],SVGRenderer),SVGRenderer.prototype.createComp=function(e){return new SVGCompElement(e,this.globalData,this)},ShapeTransformManager.prototype={addTransformSequence:function(e){var t,n=e.length,r="_";for(t=0;t<n;t+=1)r+=e[t].transform.key+"_";var a=this.sequences[r];return a||(a={transforms:[].concat(e),finalTransform:new Matrix,_mdf:!1},this.sequences[r]=a,this.sequenceList.push(a)),a},processSequence:function(e,t){for(var n=0,r=e.transforms.length,a=t;n<r&&!t;){if(e.transforms[n].transform.mProps._mdf){a=!0;break}n+=1}if(a)for(e.finalTransform.reset(),n=r-1;n>=0;n-=1)e.finalTransform.multiply(e.transforms[n].transform.mProps.v);e._mdf=a},processSequences:function(e){var t,n=this.sequenceList.length;for(t=0;t<n;t+=1)this.processSequence(this.sequenceList[t],e)},getNewKey:function(){return this.transform_key_count+=1,"_"+this.transform_key_count}};var lumaLoader=function(){var e="__lottie_element_luma_buffer",t=null,n=null,r=null;function a(){var a,i,s;t||(a=createNS("svg"),i=createNS("filter"),s=createNS("feColorMatrix"),i.setAttribute("id",e),s.setAttribute("type","matrix"),s.setAttribute("color-interpolation-filters","sRGB"),s.setAttribute("values","0.3, 0.3, 0.3, 0, 0, 0.3, 0.3, 0.3, 0, 0, 0.3, 0.3, 0.3, 0, 0, 0.3, 0.3, 0.3, 0, 0"),i.appendChild(s),a.appendChild(i),a.setAttribute("id",e+"_svg"),featureSupport.svgLumaHidden&&(a.style.display="none"),r=a,document.body.appendChild(r),t=createTag("canvas"),(n=t.getContext("2d")).filter="url(#"+e+")",n.fillStyle="rgba(0,0,0,0)",n.fillRect(0,0,1,1))}return{load:a,get:function(r){return t||a(),t.width=r.width,t.height=r.height,n.filter="url(#"+e+")",t}}};function createCanvas(e,t){if(featureSupport.offscreenCanvas)return new OffscreenCanvas(e,t);var n=createTag("canvas");return n.width=e,n.height=t,n}var assetLoader={loadLumaCanvas:lumaLoader.load,getLumaCanvas:lumaLoader.get,createCanvas:createCanvas},registeredEffects={};function CVEffects(e){var t,n,r=e.data.ef?e.data.ef.length:0;for(this.filters=[],t=0;t<r;t+=1){n=null;var a=e.data.ef[t].ty;registeredEffects[a]&&(n=new(0,registeredEffects[a].effect)(e.effectsManager.effectElements[t],e)),n&&this.filters.push(n)}this.filters.length&&e.addRenderableComponent(this)}function registerEffect(e,t){registeredEffects[e]={effect:t}}function CVMaskElement(e,t){var n;this.data=e,this.element=t,this.masksProperties=this.data.masksProperties||[],this.viewData=createSizedArray(this.masksProperties.length);var r=this.masksProperties.length,a=!1;for(n=0;n<r;n+=1)"n"!==this.masksProperties[n].mode&&(a=!0),this.viewData[n]=ShapePropertyFactory.getShapeProp(this.element,this.masksProperties[n],3);this.hasMasks=a,a&&this.element.addRenderableComponent(this)}function CVBaseElement(){}CVEffects.prototype.renderFrame=function(e){var t,n=this.filters.length;for(t=0;t<n;t+=1)this.filters[t].renderFrame(e)},CVEffects.prototype.getEffects=function(e){var t,n=this.filters.length,r=[];for(t=0;t<n;t+=1)this.filters[t].type===e&&r.push(this.filters[t]);return r},CVMaskElement.prototype.renderFrame=function(){if(this.hasMasks){var e,t,n,r,a=this.element.finalTransform.mat,i=this.element.canvasContext,s=this.masksProperties.length;for(i.beginPath(),e=0;e<s;e+=1)if("n"!==this.masksProperties[e].mode){var o;this.masksProperties[e].inv&&(i.moveTo(0,0),i.lineTo(this.element.globalData.compSize.w,0),i.lineTo(this.element.globalData.compSize.w,this.element.globalData.compSize.h),i.lineTo(0,this.element.globalData.compSize.h),i.lineTo(0,0)),r=this.viewData[e].v,t=a.applyToPointArray(r.v[0][0],r.v[0][1],0),i.moveTo(t[0],t[1]);var l=r._length;for(o=1;o<l;o+=1)n=a.applyToTriplePoints(r.o[o-1],r.i[o],r.v[o]),i.bezierCurveTo(n[0],n[1],n[2],n[3],n[4],n[5]);n=a.applyToTriplePoints(r.o[o-1],r.i[0],r.v[0]),i.bezierCurveTo(n[0],n[1],n[2],n[3],n[4],n[5])}this.element.globalData.renderer.save(!0),i.clip()}},CVMaskElement.prototype.getMaskProperty=MaskElement.prototype.getMaskProperty,CVMaskElement.prototype.destroy=function(){this.element=null};var operationsMap={1:"source-in",2:"source-out",3:"source-in",4:"source-out"};function CVShapeData(e,t,n,r){this.styledShapes=[],this.tr=[0,0,0,0,0,0];var a,i=4;"rc"===t.ty?i=5:"el"===t.ty?i=6:"sr"===t.ty&&(i=7),this.sh=ShapePropertyFactory.getShapeProp(e,t,i,e);var s,o=n.length;for(a=0;a<o;a+=1)n[a].closed||(s={transforms:r.addTransformSequence(n[a].transforms),trNodes:[]},this.styledShapes.push(s),n[a].elements.push(s))}function CVShapeElement(e,t,n){this.shapes=[],this.shapesData=e.shapes,this.stylesList=[],this.itemsData=[],this.prevViewData=[],this.shapeModifiers=[],this.processedElements=[],this.transformsManager=new ShapeTransformManager,this.initElement(e,t,n)}function CVTextElement(e,t,n){this.textSpans=[],this.yOffset=0,this.fillColorAnim=!1,this.strokeColorAnim=!1,this.strokeWidthAnim=!1,this.stroke=!1,this.fill=!1,this.justifyOffset=0,this.currentRender=null,this.renderType="canvas",this.values={fill:"rgba(0,0,0,0)",stroke:"rgba(0,0,0,0)",sWidth:0,fValue:""},this.initElement(e,t,n)}function CVImageElement(e,t,n){this.assetData=t.getAssetData(e.refId),this.img=t.imageLoader.getAsset(this.assetData),this.initElement(e,t,n)}function CVSolidElement(e,t,n){this.initElement(e,t,n)}function CanvasRendererBase(){}function CanvasContext(){this.opacity=-1,this.transform=createTypedArray("float32",16),this.fillStyle="",this.strokeStyle="",this.lineWidth="",this.lineCap="",this.lineJoin="",this.miterLimit="",this.id=Math.random()}function CVContextData(){var e;for(this.stack=[],this.cArrPos=0,this.cTr=new Matrix,e=0;e<15;e+=1){var t=new CanvasContext;this.stack[e]=t}this._length=15,this.nativeContext=null,this.transformMat=new Matrix,this.currentOpacity=1,this.currentFillStyle="",this.appliedFillStyle="",this.currentStrokeStyle="",this.appliedStrokeStyle="",this.currentLineWidth="",this.appliedLineWidth="",this.currentLineCap="",this.appliedLineCap="",this.currentLineJoin="",this.appliedLineJoin="",this.appliedMiterLimit="",this.currentMiterLimit=""}function CVCompElement(e,t,n){this.completeLayers=!1,this.layers=e.layers,this.pendingElements=[],this.elements=createSizedArray(this.layers.length),this.initElement(e,t,n),this.tm=e.tm?PropertyFactory.getProp(this,e.tm,0,t.frameRate,this):{_placeholder:!0}}function CanvasRenderer(e,t){this.animationItem=e,this.renderConfig={clearCanvas:!t||void 0===t.clearCanvas||t.clearCanvas,context:t&&t.context||null,progressiveLoad:t&&t.progressiveLoad||!1,preserveAspectRatio:t&&t.preserveAspectRatio||"xMidYMid meet",imagePreserveAspectRatio:t&&t.imagePreserveAspectRatio||"xMidYMid slice",contentVisibility:t&&t.contentVisibility||"visible",className:t&&t.className||"",id:t&&t.id||"",runExpressions:!t||void 0===t.runExpressions||t.runExpressions},this.renderConfig.dpr=t&&t.dpr||1,this.animationItem.wrapper&&(this.renderConfig.dpr=t&&t.dpr||window.devicePixelRatio||1),this.renderedFrame=-1,this.globalData={frameNum:-1,_mdf:!1,renderConfig:this.renderConfig,currentGlobalAlpha:-1},this.contextData=new CVContextData,this.elements=[],this.pendingElements=[],this.transformMat=new Matrix,this.completeLayers=!1,this.rendererType="canvas",this.renderConfig.clearCanvas&&(this.ctxTransform=this.contextData.transform.bind(this.contextData),this.ctxOpacity=this.contextData.opacity.bind(this.contextData),this.ctxFillStyle=this.contextData.fillStyle.bind(this.contextData),this.ctxStrokeStyle=this.contextData.strokeStyle.bind(this.contextData),this.ctxLineWidth=this.contextData.lineWidth.bind(this.contextData),this.ctxLineCap=this.contextData.lineCap.bind(this.contextData),this.ctxLineJoin=this.contextData.lineJoin.bind(this.contextData),this.ctxMiterLimit=this.contextData.miterLimit.bind(this.contextData),this.ctxFill=this.contextData.fill.bind(this.contextData),this.ctxFillRect=this.contextData.fillRect.bind(this.contextData),this.ctxStroke=this.contextData.stroke.bind(this.contextData),this.save=this.contextData.save.bind(this.contextData))}function HBaseElement(){}function HSolidElement(e,t,n){this.initElement(e,t,n)}function HShapeElement(e,t,n){this.shapes=[],this.shapesData=e.shapes,this.stylesList=[],this.shapeModifiers=[],this.itemsData=[],this.processedElements=[],this.animatedContents=[],this.shapesContainer=createNS("g"),this.initElement(e,t,n),this.prevViewData=[],this.currentBBox={x:999999,y:-999999,h:0,w:0}}function HTextElement(e,t,n){this.textSpans=[],this.textPaths=[],this.currentBBox={x:999999,y:-999999,h:0,w:0},this.renderType="svg",this.isMasked=!1,this.initElement(e,t,n)}function HCameraElement(e,t,n){this.initFrame(),this.initBaseData(e,t,n),this.initHierarchy();var r=PropertyFactory.getProp;if(this.pe=r(this,e.pe,0,0,this),e.ks.p.s?(this.px=r(this,e.ks.p.x,1,0,this),this.py=r(this,e.ks.p.y,1,0,this),this.pz=r(this,e.ks.p.z,1,0,this)):this.p=r(this,e.ks.p,1,0,this),e.ks.a&&(this.a=r(this,e.ks.a,1,0,this)),e.ks.or.k.length&&e.ks.or.k[0].to){var a,i=e.ks.or.k.length;for(a=0;a<i;a+=1)e.ks.or.k[a].to=null,e.ks.or.k[a].ti=null}this.or=r(this,e.ks.or,1,degToRads,this),this.or.sh=!0,this.rx=r(this,e.ks.rx,0,degToRads,this),this.ry=r(this,e.ks.ry,0,degToRads,this),this.rz=r(this,e.ks.rz,0,degToRads,this),this.mat=new Matrix,this._prevMat=new Matrix,this._isFirstFrame=!0,this.finalTransform={mProp:this}}function HImageElement(e,t,n){this.assetData=t.getAssetData(e.refId),this.initElement(e,t,n)}function HybridRendererBase(e,t){this.animationItem=e,this.layers=null,this.renderedFrame=-1,this.renderConfig={className:t&&t.className||"",imagePreserveAspectRatio:t&&t.imagePreserveAspectRatio||"xMidYMid slice",hideOnTransparent:!(t&&!1===t.hideOnTransparent),filterSize:{width:t&&t.filterSize&&t.filterSize.width||"400%",height:t&&t.filterSize&&t.filterSize.height||"400%",x:t&&t.filterSize&&t.filterSize.x||"-100%",y:t&&t.filterSize&&t.filterSize.y||"-100%"}},this.globalData={_mdf:!1,frameNum:-1,renderConfig:this.renderConfig},this.pendingElements=[],this.elements=[],this.threeDElements=[],this.destroyed=!1,this.camera=null,this.supports3d=!0,this.rendererType="html"}function HCompElement(e,t,n){this.layers=e.layers,this.supports3d=!e.hasMask,this.completeLayers=!1,this.pendingElements=[],this.elements=this.layers?createSizedArray(this.layers.length):[],this.initElement(e,t,n),this.tm=e.tm?PropertyFactory.getProp(this,e.tm,0,t.frameRate,this):{_placeholder:!0}}function HybridRenderer(e,t){this.animationItem=e,this.layers=null,this.renderedFrame=-1,this.renderConfig={className:t&&t.className||"",imagePreserveAspectRatio:t&&t.imagePreserveAspectRatio||"xMidYMid slice",hideOnTransparent:!(t&&!1===t.hideOnTransparent),filterSize:{width:t&&t.filterSize&&t.filterSize.width||"400%",height:t&&t.filterSize&&t.filterSize.height||"400%",x:t&&t.filterSize&&t.filterSize.x||"-100%",y:t&&t.filterSize&&t.filterSize.y||"-100%"},runExpressions:!t||void 0===t.runExpressions||t.runExpressions},this.globalData={_mdf:!1,frameNum:-1,renderConfig:this.renderConfig},this.pendingElements=[],this.elements=[],this.threeDElements=[],this.destroyed=!1,this.camera=null,this.supports3d=!0,this.rendererType="html"}CVBaseElement.prototype={createElements:function(){},initRendererElement:function(){},createContainerElements:function(){if(this.data.tt>=1){this.buffers=[];var e=this.globalData.canvasContext,t=assetLoader.createCanvas(e.canvas.width,e.canvas.height);this.buffers.push(t);var n=assetLoader.createCanvas(e.canvas.width,e.canvas.height);this.buffers.push(n),this.data.tt>=3&&!document._isProxy&&assetLoader.loadLumaCanvas()}this.canvasContext=this.globalData.canvasContext,this.transformCanvas=this.globalData.transformCanvas,this.renderableEffectsManager=new CVEffects(this),this.searchEffectTransforms()},createContent:function(){},setBlendMode:function(){var e=this.globalData;if(e.blendMode!==this.data.bm){e.blendMode=this.data.bm;var t=getBlendMode(this.data.bm);e.canvasContext.globalCompositeOperation=t}},createRenderableComponents:function(){this.maskManager=new CVMaskElement(this.data,this),this.transformEffects=this.renderableEffectsManager.getEffects(effectTypes.TRANSFORM_EFFECT)},hideElement:function(){this.hidden||this.isInRange&&!this.isTransparent||(this.hidden=!0)},showElement:function(){this.isInRange&&!this.isTransparent&&(this.hidden=!1,this._isFirstFrame=!0,this.maskManager._isFirstFrame=!0)},clearCanvas:function(e){e.clearRect(this.transformCanvas.tx,this.transformCanvas.ty,this.transformCanvas.w*this.transformCanvas.sx,this.transformCanvas.h*this.transformCanvas.sy)},prepareLayer:function(){if(this.data.tt>=1){var e=this.buffers[0].getContext("2d");this.clearCanvas(e),e.drawImage(this.canvasContext.canvas,0,0),this.currentTransform=this.canvasContext.getTransform(),this.canvasContext.setTransform(1,0,0,1,0,0),this.clearCanvas(this.canvasContext),this.canvasContext.setTransform(this.currentTransform)}},exitLayer:function(){if(this.data.tt>=1){var e=this.buffers[1],t=e.getContext("2d");if(this.clearCanvas(t),t.drawImage(this.canvasContext.canvas,0,0),this.canvasContext.setTransform(1,0,0,1,0,0),this.clearCanvas(this.canvasContext),this.canvasContext.setTransform(this.currentTransform),this.comp.getElementById("tp"in this.data?this.data.tp:this.data.ind-1).renderFrame(!0),this.canvasContext.setTransform(1,0,0,1,0,0),this.data.tt>=3&&!document._isProxy){var n=assetLoader.getLumaCanvas(this.canvasContext.canvas);n.getContext("2d").drawImage(this.canvasContext.canvas,0,0),this.clearCanvas(this.canvasContext),this.canvasContext.drawImage(n,0,0)}this.canvasContext.globalCompositeOperation=operationsMap[this.data.tt],this.canvasContext.drawImage(e,0,0),this.canvasContext.globalCompositeOperation="destination-over",this.canvasContext.drawImage(this.buffers[0],0,0),this.canvasContext.setTransform(this.currentTransform),this.canvasContext.globalCompositeOperation="source-over"}},renderFrame:function(e){if(!this.hidden&&!this.data.hd&&(1!==this.data.td||e)){this.renderTransform(),this.renderRenderable(),this.renderLocalTransform(),this.setBlendMode();var t=0===this.data.ty;this.prepareLayer(),this.globalData.renderer.save(t),this.globalData.renderer.ctxTransform(this.finalTransform.localMat.props),this.globalData.renderer.ctxOpacity(this.finalTransform.localOpacity),this.renderInnerContent(),this.globalData.renderer.restore(t),this.exitLayer(),this.maskManager.hasMasks&&this.globalData.renderer.restore(!0),this._isFirstFrame&&(this._isFirstFrame=!1)}},destroy:function(){this.canvasContext=null,this.data=null,this.globalData=null,this.maskManager.destroy()},mHelper:new Matrix},CVBaseElement.prototype.hide=CVBaseElement.prototype.hideElement,CVBaseElement.prototype.show=CVBaseElement.prototype.showElement,CVShapeData.prototype.setAsAnimated=SVGShapeData.prototype.setAsAnimated,extendPrototype([BaseElement,TransformElement,CVBaseElement,IShapeElement,HierarchyElement,FrameElement,RenderableElement],CVShapeElement),CVShapeElement.prototype.initElement=RenderableDOMElement.prototype.initElement,CVShapeElement.prototype.transformHelper={opacity:1,_opMdf:!1},CVShapeElement.prototype.dashResetter=[],CVShapeElement.prototype.createContent=function(){this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,!0,[])},CVShapeElement.prototype.createStyleElement=function(e,t){var n={data:e,type:e.ty,preTransforms:this.transformsManager.addTransformSequence(t),transforms:[],elements:[],closed:!0===e.hd},r={};if("fl"===e.ty||"st"===e.ty?(r.c=PropertyFactory.getProp(this,e.c,1,255,this),r.c.k||(n.co="rgb("+bmFloor(r.c.v[0])+","+bmFloor(r.c.v[1])+","+bmFloor(r.c.v[2])+")")):"gf"!==e.ty&&"gs"!==e.ty||(r.s=PropertyFactory.getProp(this,e.s,1,null,this),r.e=PropertyFactory.getProp(this,e.e,1,null,this),r.h=PropertyFactory.getProp(this,e.h||{k:0},0,.01,this),r.a=PropertyFactory.getProp(this,e.a||{k:0},0,degToRads,this),r.g=new GradientProperty(this,e.g,this)),r.o=PropertyFactory.getProp(this,e.o,0,.01,this),"st"===e.ty||"gs"===e.ty){if(n.lc=lineCapEnum[e.lc||2],n.lj=lineJoinEnum[e.lj||2],1==e.lj&&(n.ml=e.ml),r.w=PropertyFactory.getProp(this,e.w,0,null,this),r.w.k||(n.wi=r.w.v),e.d){var a=new DashProperty(this,e.d,"canvas",this);r.d=a,r.d.k||(n.da=r.d.dashArray,n.do=r.d.dashoffset[0])}}else n.r=2===e.r?"evenodd":"nonzero";return this.stylesList.push(n),r.style=n,r},CVShapeElement.prototype.createGroupElement=function(){return{it:[],prevViewData:[]}},CVShapeElement.prototype.createTransformElement=function(e){return{transform:{opacity:1,_opMdf:!1,key:this.transformsManager.getNewKey(),op:PropertyFactory.getProp(this,e.o,0,.01,this),mProps:TransformPropertyFactory.getTransformProperty(this,e,this)}}},CVShapeElement.prototype.createShapeElement=function(e){var t=new CVShapeData(this,e,this.stylesList,this.transformsManager);return this.shapes.push(t),this.addShapeToModifiers(t),t},CVShapeElement.prototype.reloadShapes=function(){var e;this._isFirstFrame=!0;var t=this.itemsData.length;for(e=0;e<t;e+=1)this.prevViewData[e]=this.itemsData[e];for(this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,!0,[]),t=this.dynamicProperties.length,e=0;e<t;e+=1)this.dynamicProperties[e].getValue();this.renderModifiers(),this.transformsManager.processSequences(this._isFirstFrame)},CVShapeElement.prototype.addTransformToStyleList=function(e){var t,n=this.stylesList.length;for(t=0;t<n;t+=1)this.stylesList[t].closed||this.stylesList[t].transforms.push(e)},CVShapeElement.prototype.removeTransformFromStyleList=function(){var e,t=this.stylesList.length;for(e=0;e<t;e+=1)this.stylesList[e].closed||this.stylesList[e].transforms.pop()},CVShapeElement.prototype.closeStyles=function(e){var t,n=e.length;for(t=0;t<n;t+=1)e[t].closed=!0},CVShapeElement.prototype.searchShapes=function(e,t,n,r,a){var i,s,o,l,u,c,h=e.length-1,d=[],p=[],f=[].concat(a);for(i=h;i>=0;i-=1){if((l=this.searchProcessedElement(e[i]))?t[i]=n[l-1]:e[i]._shouldRender=r,"fl"===e[i].ty||"st"===e[i].ty||"gf"===e[i].ty||"gs"===e[i].ty)l?t[i].style.closed=!1:t[i]=this.createStyleElement(e[i],f),d.push(t[i].style);else if("gr"===e[i].ty){if(l)for(o=t[i].it.length,s=0;s<o;s+=1)t[i].prevViewData[s]=t[i].it[s];else t[i]=this.createGroupElement(e[i]);this.searchShapes(e[i].it,t[i].it,t[i].prevViewData,r,f)}else"tr"===e[i].ty?(l||(c=this.createTransformElement(e[i]),t[i]=c),f.push(t[i]),this.addTransformToStyleList(t[i])):"sh"===e[i].ty||"rc"===e[i].ty||"el"===e[i].ty||"sr"===e[i].ty?l||(t[i]=this.createShapeElement(e[i])):"tm"===e[i].ty||"rd"===e[i].ty||"pb"===e[i].ty||"zz"===e[i].ty||"op"===e[i].ty?(l?(u=t[i]).closed=!1:((u=ShapeModifiers.getModifier(e[i].ty)).init(this,e[i]),t[i]=u,this.shapeModifiers.push(u)),p.push(u)):"rp"===e[i].ty&&(l?(u=t[i]).closed=!0:(u=ShapeModifiers.getModifier(e[i].ty),t[i]=u,u.init(this,e,i,t),this.shapeModifiers.push(u),r=!1),p.push(u));this.addProcessedElement(e[i],i+1)}for(this.removeTransformFromStyleList(),this.closeStyles(d),h=p.length,i=0;i<h;i+=1)p[i].closed=!0},CVShapeElement.prototype.renderInnerContent=function(){this.transformHelper.opacity=1,this.transformHelper._opMdf=!1,this.renderModifiers(),this.transformsManager.processSequences(this._isFirstFrame),this.renderShape(this.transformHelper,this.shapesData,this.itemsData,!0)},CVShapeElement.prototype.renderShapeTransform=function(e,t){(e._opMdf||t.op._mdf||this._isFirstFrame)&&(t.opacity=e.opacity,t.opacity*=t.op.v,t._opMdf=!0)},CVShapeElement.prototype.drawLayer=function(){var e,t,n,r,a,i,s,o,l,u=this.stylesList.length,c=this.globalData.renderer,h=this.globalData.canvasContext;for(e=0;e<u;e+=1)if(("st"!==(o=(l=this.stylesList[e]).type)&&"gs"!==o||0!==l.wi)&&l.data._shouldRender&&0!==l.coOp&&0!==this.globalData.currentGlobalAlpha){for(c.save(),i=l.elements,"st"===o||"gs"===o?(c.ctxStrokeStyle("st"===o?l.co:l.grd),c.ctxLineWidth(l.wi),c.ctxLineCap(l.lc),c.ctxLineJoin(l.lj),c.ctxMiterLimit(l.ml||0)):c.ctxFillStyle("fl"===o?l.co:l.grd),c.ctxOpacity(l.coOp),"st"!==o&&"gs"!==o&&h.beginPath(),c.ctxTransform(l.preTransforms.finalTransform.props),n=i.length,t=0;t<n;t+=1){for("st"!==o&&"gs"!==o||(h.beginPath(),l.da&&(h.setLineDash(l.da),h.lineDashOffset=l.do)),a=(s=i[t].trNodes).length,r=0;r<a;r+=1)"m"===s[r].t?h.moveTo(s[r].p[0],s[r].p[1]):"c"===s[r].t?h.bezierCurveTo(s[r].pts[0],s[r].pts[1],s[r].pts[2],s[r].pts[3],s[r].pts[4],s[r].pts[5]):h.closePath();"st"!==o&&"gs"!==o||(c.ctxStroke(),l.da&&h.setLineDash(this.dashResetter))}"st"!==o&&"gs"!==o&&this.globalData.renderer.ctxFill(l.r),c.restore()}},CVShapeElement.prototype.renderShape=function(e,t,n,r){var a,i;for(i=e,a=t.length-1;a>=0;a-=1)"tr"===t[a].ty?(i=n[a].transform,this.renderShapeTransform(e,i)):"sh"===t[a].ty||"el"===t[a].ty||"rc"===t[a].ty||"sr"===t[a].ty?this.renderPath(t[a],n[a]):"fl"===t[a].ty?this.renderFill(t[a],n[a],i):"st"===t[a].ty?this.renderStroke(t[a],n[a],i):"gf"===t[a].ty||"gs"===t[a].ty?this.renderGradientFill(t[a],n[a],i):"gr"===t[a].ty?this.renderShape(i,t[a].it,n[a].it):t[a].ty;r&&this.drawLayer()},CVShapeElement.prototype.renderStyledShape=function(e,t){if(this._isFirstFrame||t._mdf||e.transforms._mdf){var n,r,a,i=e.trNodes,s=t.paths,o=s._length;i.length=0;var l=e.transforms.finalTransform;for(a=0;a<o;a+=1){var u=s.shapes[a];if(u&&u.v){for(r=u._length,n=1;n<r;n+=1)1===n&&i.push({t:"m",p:l.applyToPointArray(u.v[0][0],u.v[0][1],0)}),i.push({t:"c",pts:l.applyToTriplePoints(u.o[n-1],u.i[n],u.v[n])});1===r&&i.push({t:"m",p:l.applyToPointArray(u.v[0][0],u.v[0][1],0)}),u.c&&r&&(i.push({t:"c",pts:l.applyToTriplePoints(u.o[n-1],u.i[0],u.v[0])}),i.push({t:"z"}))}}e.trNodes=i}},CVShapeElement.prototype.renderPath=function(e,t){if(!0!==e.hd&&e._shouldRender){var n,r=t.styledShapes.length;for(n=0;n<r;n+=1)this.renderStyledShape(t.styledShapes[n],t.sh)}},CVShapeElement.prototype.renderFill=function(e,t,n){var r=t.style;(t.c._mdf||this._isFirstFrame)&&(r.co="rgb("+bmFloor(t.c.v[0])+","+bmFloor(t.c.v[1])+","+bmFloor(t.c.v[2])+")"),(t.o._mdf||n._opMdf||this._isFirstFrame)&&(r.coOp=t.o.v*n.opacity)},CVShapeElement.prototype.renderGradientFill=function(e,t,n){var r,a=t.style;if(!a.grd||t.g._mdf||t.s._mdf||t.e._mdf||1!==e.t&&(t.h._mdf||t.a._mdf)){var i,s=this.globalData.canvasContext,o=t.s.v,l=t.e.v;if(1===e.t)r=s.createLinearGradient(o[0],o[1],l[0],l[1]);else{var u=Math.sqrt(Math.pow(o[0]-l[0],2)+Math.pow(o[1]-l[1],2)),c=Math.atan2(l[1]-o[1],l[0]-o[0]),h=t.h.v;h>=1?h=.99:h<=-1&&(h=-.99);var d=u*h,p=Math.cos(c+t.a.v)*d+o[0],f=Math.sin(c+t.a.v)*d+o[1];r=s.createRadialGradient(p,f,0,o[0],o[1],u)}var m=e.g.p,g=t.g.c,y=1;for(i=0;i<m;i+=1)t.g._hasOpacity&&t.g._collapsable&&(y=t.g.o[2*i+1]),r.addColorStop(g[4*i]/100,"rgba("+g[4*i+1]+","+g[4*i+2]+","+g[4*i+3]+","+y+")");a.grd=r}a.coOp=t.o.v*n.opacity},CVShapeElement.prototype.renderStroke=function(e,t,n){var r=t.style,a=t.d;a&&(a._mdf||this._isFirstFrame)&&(r.da=a.dashArray,r.do=a.dashoffset[0]),(t.c._mdf||this._isFirstFrame)&&(r.co="rgb("+bmFloor(t.c.v[0])+","+bmFloor(t.c.v[1])+","+bmFloor(t.c.v[2])+")"),(t.o._mdf||n._opMdf||this._isFirstFrame)&&(r.coOp=t.o.v*n.opacity),(t.w._mdf||this._isFirstFrame)&&(r.wi=t.w.v)},CVShapeElement.prototype.destroy=function(){this.shapesData=null,this.globalData=null,this.canvasContext=null,this.stylesList.length=0,this.itemsData.length=0},extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement,ITextElement],CVTextElement),CVTextElement.prototype.tHelper=createTag("canvas").getContext("2d"),CVTextElement.prototype.buildNewText=function(){var e=this.textProperty.currentData;this.renderedLetters=createSizedArray(e.l?e.l.length:0);var t=!1;e.fc?(t=!0,this.values.fill=this.buildColor(e.fc)):this.values.fill="rgba(0,0,0,0)",this.fill=t;var n=!1;e.sc&&(n=!0,this.values.stroke=this.buildColor(e.sc),this.values.sWidth=e.sw);var r,a,i,s,o,l,u,c,h,d,p,f,m=this.globalData.fontManager.getFontByName(e.f),g=e.l,y=this.mHelper;this.stroke=n,this.values.fValue=e.finalSize+"px "+this.globalData.fontManager.getFontByName(e.f).fFamily,a=e.finalText.length;var v=this.data.singleShape,b=.001*e.tr*e.finalSize,x=0,T=0,_=!0,w=0;for(r=0;r<a;r+=1){s=(i=this.globalData.fontManager.getCharData(e.finalText[r],m.fStyle,this.globalData.fontManager.getFontByName(e.f).fFamily))&&i.data||{},y.reset(),v&&g[r].n&&(x=-b,T+=e.yOffset,T+=_?1:0,_=!1),h=(u=s.shapes?s.shapes[0].it:[]).length,y.scale(e.finalSize/100,e.finalSize/100),v&&this.applyTextPropertiesToMatrix(e,y,g[r].line,x,T),p=createSizedArray(h-1);var S=0;for(c=0;c<h;c+=1)if("sh"===u[c].ty){for(l=u[c].ks.k.i.length,d=u[c].ks.k,f=[],o=1;o<l;o+=1)1===o&&f.push(y.applyToX(d.v[0][0],d.v[0][1],0),y.applyToY(d.v[0][0],d.v[0][1],0)),f.push(y.applyToX(d.o[o-1][0],d.o[o-1][1],0),y.applyToY(d.o[o-1][0],d.o[o-1][1],0),y.applyToX(d.i[o][0],d.i[o][1],0),y.applyToY(d.i[o][0],d.i[o][1],0),y.applyToX(d.v[o][0],d.v[o][1],0),y.applyToY(d.v[o][0],d.v[o][1],0));f.push(y.applyToX(d.o[o-1][0],d.o[o-1][1],0),y.applyToY(d.o[o-1][0],d.o[o-1][1],0),y.applyToX(d.i[0][0],d.i[0][1],0),y.applyToY(d.i[0][0],d.i[0][1],0),y.applyToX(d.v[0][0],d.v[0][1],0),y.applyToY(d.v[0][0],d.v[0][1],0)),p[S]=f,S+=1}v&&(x+=g[r].l,x+=b),this.textSpans[w]?this.textSpans[w].elem=p:this.textSpans[w]={elem:p},w+=1}},CVTextElement.prototype.renderInnerContent=function(){var e,t,n,r,a,i;this.validateText(),this.canvasContext.font=this.values.fValue,this.globalData.renderer.ctxLineCap("butt"),this.globalData.renderer.ctxLineJoin("miter"),this.globalData.renderer.ctxMiterLimit(4),this.data.singleShape||this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag);var s,o=this.textAnimator.renderedLetters,l=this.textProperty.currentData.l;t=l.length;var u,c,h=null,d=null,p=null,f=this.globalData.renderer;for(e=0;e<t;e+=1)if(!l[e].n){if((s=o[e])&&(f.save(),f.ctxTransform(s.p),f.ctxOpacity(s.o)),this.fill){for(s&&s.fc?h!==s.fc&&(f.ctxFillStyle(s.fc),h=s.fc):h!==this.values.fill&&(h=this.values.fill,f.ctxFillStyle(this.values.fill)),r=(u=this.textSpans[e].elem).length,this.globalData.canvasContext.beginPath(),n=0;n<r;n+=1)for(i=(c=u[n]).length,this.globalData.canvasContext.moveTo(c[0],c[1]),a=2;a<i;a+=6)this.globalData.canvasContext.bezierCurveTo(c[a],c[a+1],c[a+2],c[a+3],c[a+4],c[a+5]);this.globalData.canvasContext.closePath(),f.ctxFill()}if(this.stroke){for(s&&s.sw?p!==s.sw&&(p=s.sw,f.ctxLineWidth(s.sw)):p!==this.values.sWidth&&(p=this.values.sWidth,f.ctxLineWidth(this.values.sWidth)),s&&s.sc?d!==s.sc&&(d=s.sc,f.ctxStrokeStyle(s.sc)):d!==this.values.stroke&&(d=this.values.stroke,f.ctxStrokeStyle(this.values.stroke)),r=(u=this.textSpans[e].elem).length,this.globalData.canvasContext.beginPath(),n=0;n<r;n+=1)for(i=(c=u[n]).length,this.globalData.canvasContext.moveTo(c[0],c[1]),a=2;a<i;a+=6)this.globalData.canvasContext.bezierCurveTo(c[a],c[a+1],c[a+2],c[a+3],c[a+4],c[a+5]);this.globalData.canvasContext.closePath(),f.ctxStroke()}s&&this.globalData.renderer.restore()}},extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement],CVImageElement),CVImageElement.prototype.initElement=SVGShapeElement.prototype.initElement,CVImageElement.prototype.prepareFrame=IImageElement.prototype.prepareFrame,CVImageElement.prototype.createContent=function(){if(this.img.width&&(this.assetData.w!==this.img.width||this.assetData.h!==this.img.height)){var e=createTag("canvas");e.width=this.assetData.w,e.height=this.assetData.h;var t,n,r=e.getContext("2d"),a=this.img.width,i=this.img.height,s=a/i,o=this.assetData.w/this.assetData.h,l=this.assetData.pr||this.globalData.renderConfig.imagePreserveAspectRatio;s>o&&"xMidYMid slice"===l||s<o&&"xMidYMid slice"!==l?t=(n=i)*o:n=(t=a)/o,r.drawImage(this.img,(a-t)/2,(i-n)/2,t,n,0,0,this.assetData.w,this.assetData.h),this.img=e}},CVImageElement.prototype.renderInnerContent=function(){this.canvasContext.drawImage(this.img,0,0)},CVImageElement.prototype.destroy=function(){this.img=null},extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement],CVSolidElement),CVSolidElement.prototype.initElement=SVGShapeElement.prototype.initElement,CVSolidElement.prototype.prepareFrame=IImageElement.prototype.prepareFrame,CVSolidElement.prototype.renderInnerContent=function(){this.globalData.renderer.ctxFillStyle(this.data.sc),this.globalData.renderer.ctxFillRect(0,0,this.data.sw,this.data.sh)},extendPrototype([BaseRenderer],CanvasRendererBase),CanvasRendererBase.prototype.createShape=function(e){return new CVShapeElement(e,this.globalData,this)},CanvasRendererBase.prototype.createText=function(e){return new CVTextElement(e,this.globalData,this)},CanvasRendererBase.prototype.createImage=function(e){return new CVImageElement(e,this.globalData,this)},CanvasRendererBase.prototype.createSolid=function(e){return new CVSolidElement(e,this.globalData,this)},CanvasRendererBase.prototype.createNull=SVGRenderer.prototype.createNull,CanvasRendererBase.prototype.ctxTransform=function(e){1===e[0]&&0===e[1]&&0===e[4]&&1===e[5]&&0===e[12]&&0===e[13]||this.canvasContext.transform(e[0],e[1],e[4],e[5],e[12],e[13])},CanvasRendererBase.prototype.ctxOpacity=function(e){this.canvasContext.globalAlpha*=e<0?0:e},CanvasRendererBase.prototype.ctxFillStyle=function(e){this.canvasContext.fillStyle=e},CanvasRendererBase.prototype.ctxStrokeStyle=function(e){this.canvasContext.strokeStyle=e},CanvasRendererBase.prototype.ctxLineWidth=function(e){this.canvasContext.lineWidth=e},CanvasRendererBase.prototype.ctxLineCap=function(e){this.canvasContext.lineCap=e},CanvasRendererBase.prototype.ctxLineJoin=function(e){this.canvasContext.lineJoin=e},CanvasRendererBase.prototype.ctxMiterLimit=function(e){this.canvasContext.miterLimit=e},CanvasRendererBase.prototype.ctxFill=function(e){this.canvasContext.fill(e)},CanvasRendererBase.prototype.ctxFillRect=function(e,t,n,r){this.canvasContext.fillRect(e,t,n,r)},CanvasRendererBase.prototype.ctxStroke=function(){this.canvasContext.stroke()},CanvasRendererBase.prototype.reset=function(){this.renderConfig.clearCanvas?this.contextData.reset():this.canvasContext.restore()},CanvasRendererBase.prototype.save=function(){this.canvasContext.save()},CanvasRendererBase.prototype.restore=function(e){this.renderConfig.clearCanvas?(e&&(this.globalData.blendMode="source-over"),this.contextData.restore(e)):this.canvasContext.restore()},CanvasRendererBase.prototype.configAnimation=function(e){if(this.animationItem.wrapper){this.animationItem.container=createTag("canvas");var t=this.animationItem.container.style;t.width="100%",t.height="100%";var n="0px 0px 0px";t.transformOrigin=n,t.mozTransformOrigin=n,t.webkitTransformOrigin=n,t["-webkit-transform"]=n,t.contentVisibility=this.renderConfig.contentVisibility,this.animationItem.wrapper.appendChild(this.animationItem.container),this.canvasContext=this.animationItem.container.getContext("2d"),this.renderConfig.className&&this.animationItem.container.setAttribute("class",this.renderConfig.className),this.renderConfig.id&&this.animationItem.container.setAttribute("id",this.renderConfig.id)}else this.canvasContext=this.renderConfig.context;this.contextData.setContext(this.canvasContext),this.data=e,this.layers=e.layers,this.transformCanvas={w:e.w,h:e.h,sx:0,sy:0,tx:0,ty:0},this.setupGlobalData(e,document.body),this.globalData.canvasContext=this.canvasContext,this.globalData.renderer=this,this.globalData.isDashed=!1,this.globalData.progressiveLoad=this.renderConfig.progressiveLoad,this.globalData.transformCanvas=this.transformCanvas,this.elements=createSizedArray(e.layers.length),this.updateContainerSize()},CanvasRendererBase.prototype.updateContainerSize=function(e,t){var n,r,a,i;if(this.reset(),e?(n=e,r=t,this.canvasContext.canvas.width=n,this.canvasContext.canvas.height=r):(this.animationItem.wrapper&&this.animationItem.container?(n=this.animationItem.wrapper.offsetWidth,r=this.animationItem.wrapper.offsetHeight):(n=this.canvasContext.canvas.width,r=this.canvasContext.canvas.height),this.canvasContext.canvas.width=n*this.renderConfig.dpr,this.canvasContext.canvas.height=r*this.renderConfig.dpr),-1!==this.renderConfig.preserveAspectRatio.indexOf("meet")||-1!==this.renderConfig.preserveAspectRatio.indexOf("slice")){var s=this.renderConfig.preserveAspectRatio.split(" "),o=s[1]||"meet",l=s[0]||"xMidYMid",u=l.substr(0,4),c=l.substr(4);a=n/r,(i=this.transformCanvas.w/this.transformCanvas.h)>a&&"meet"===o||i<a&&"slice"===o?(this.transformCanvas.sx=n/(this.transformCanvas.w/this.renderConfig.dpr),this.transformCanvas.sy=n/(this.transformCanvas.w/this.renderConfig.dpr)):(this.transformCanvas.sx=r/(this.transformCanvas.h/this.renderConfig.dpr),this.transformCanvas.sy=r/(this.transformCanvas.h/this.renderConfig.dpr)),this.transformCanvas.tx="xMid"===u&&(i<a&&"meet"===o||i>a&&"slice"===o)?(n-this.transformCanvas.w*(r/this.transformCanvas.h))/2*this.renderConfig.dpr:"xMax"===u&&(i<a&&"meet"===o||i>a&&"slice"===o)?(n-this.transformCanvas.w*(r/this.transformCanvas.h))*this.renderConfig.dpr:0,this.transformCanvas.ty="YMid"===c&&(i>a&&"meet"===o||i<a&&"slice"===o)?(r-this.transformCanvas.h*(n/this.transformCanvas.w))/2*this.renderConfig.dpr:"YMax"===c&&(i>a&&"meet"===o||i<a&&"slice"===o)?(r-this.transformCanvas.h*(n/this.transformCanvas.w))*this.renderConfig.dpr:0}else"none"===this.renderConfig.preserveAspectRatio?(this.transformCanvas.sx=n/(this.transformCanvas.w/this.renderConfig.dpr),this.transformCanvas.sy=r/(this.transformCanvas.h/this.renderConfig.dpr),this.transformCanvas.tx=0,this.transformCanvas.ty=0):(this.transformCanvas.sx=this.renderConfig.dpr,this.transformCanvas.sy=this.renderConfig.dpr,this.transformCanvas.tx=0,this.transformCanvas.ty=0);this.transformCanvas.props=[this.transformCanvas.sx,0,0,0,0,this.transformCanvas.sy,0,0,0,0,1,0,this.transformCanvas.tx,this.transformCanvas.ty,0,1],this.ctxTransform(this.transformCanvas.props),this.canvasContext.beginPath(),this.canvasContext.rect(0,0,this.transformCanvas.w,this.transformCanvas.h),this.canvasContext.closePath(),this.canvasContext.clip(),this.renderFrame(this.renderedFrame,!0)},CanvasRendererBase.prototype.destroy=function(){var e;for(this.renderConfig.clearCanvas&&this.animationItem.wrapper&&(this.animationItem.wrapper.innerText=""),e=(this.layers?this.layers.length:0)-1;e>=0;e-=1)this.elements[e]&&this.elements[e].destroy&&this.elements[e].destroy();this.elements.length=0,this.globalData.canvasContext=null,this.animationItem.container=null,this.destroyed=!0},CanvasRendererBase.prototype.renderFrame=function(e,t){if((this.renderedFrame!==e||!0!==this.renderConfig.clearCanvas||t)&&!this.destroyed&&-1!==e){var n;this.renderedFrame=e,this.globalData.frameNum=e-this.animationItem._isFirstFrame,this.globalData.frameId+=1,this.globalData._mdf=!this.renderConfig.clearCanvas||t,this.globalData.projectInterface.currentFrame=e;var r=this.layers.length;for(this.completeLayers||this.checkLayers(e),n=r-1;n>=0;n-=1)(this.completeLayers||this.elements[n])&&this.elements[n].prepareFrame(e-this.layers[n].st);if(this.globalData._mdf){for(!0===this.renderConfig.clearCanvas?this.canvasContext.clearRect(0,0,this.transformCanvas.w,this.transformCanvas.h):this.save(),n=r-1;n>=0;n-=1)(this.completeLayers||this.elements[n])&&this.elements[n].renderFrame();!0!==this.renderConfig.clearCanvas&&this.restore()}}},CanvasRendererBase.prototype.buildItem=function(e){var t=this.elements;if(!t[e]&&99!==this.layers[e].ty){var n=this.createItem(this.layers[e],this,this.globalData);t[e]=n,n.initExpressions()}},CanvasRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;)this.pendingElements.pop().checkParenting()},CanvasRendererBase.prototype.hide=function(){this.animationItem.container.style.display="none"},CanvasRendererBase.prototype.show=function(){this.animationItem.container.style.display="block"},CVContextData.prototype.duplicate=function(){var e=2*this._length,t=0;for(t=this._length;t<e;t+=1)this.stack[t]=new CanvasContext;this._length=e},CVContextData.prototype.reset=function(){this.cArrPos=0,this.cTr.reset(),this.stack[this.cArrPos].opacity=1},CVContextData.prototype.restore=function(e){this.cArrPos-=1;var t,n=this.stack[this.cArrPos],r=n.transform,a=this.cTr.props;for(t=0;t<16;t+=1)a[t]=r[t];if(e){this.nativeContext.restore();var i=this.stack[this.cArrPos+1];this.appliedFillStyle=i.fillStyle,this.appliedStrokeStyle=i.strokeStyle,this.appliedLineWidth=i.lineWidth,this.appliedLineCap=i.lineCap,this.appliedLineJoin=i.lineJoin,this.appliedMiterLimit=i.miterLimit}this.nativeContext.setTransform(r[0],r[1],r[4],r[5],r[12],r[13]),(e||-1!==n.opacity&&this.currentOpacity!==n.opacity)&&(this.nativeContext.globalAlpha=n.opacity,this.currentOpacity=n.opacity),this.currentFillStyle=n.fillStyle,this.currentStrokeStyle=n.strokeStyle,this.currentLineWidth=n.lineWidth,this.currentLineCap=n.lineCap,this.currentLineJoin=n.lineJoin,this.currentMiterLimit=n.miterLimit},CVContextData.prototype.save=function(e){e&&this.nativeContext.save();var t=this.cTr.props;this._length<=this.cArrPos&&this.duplicate();var n,r=this.stack[this.cArrPos];for(n=0;n<16;n+=1)r.transform[n]=t[n];this.cArrPos+=1;var a=this.stack[this.cArrPos];a.opacity=r.opacity,a.fillStyle=r.fillStyle,a.strokeStyle=r.strokeStyle,a.lineWidth=r.lineWidth,a.lineCap=r.lineCap,a.lineJoin=r.lineJoin,a.miterLimit=r.miterLimit},CVContextData.prototype.setOpacity=function(e){this.stack[this.cArrPos].opacity=e},CVContextData.prototype.setContext=function(e){this.nativeContext=e},CVContextData.prototype.fillStyle=function(e){this.stack[this.cArrPos].fillStyle!==e&&(this.currentFillStyle=e,this.stack[this.cArrPos].fillStyle=e)},CVContextData.prototype.strokeStyle=function(e){this.stack[this.cArrPos].strokeStyle!==e&&(this.currentStrokeStyle=e,this.stack[this.cArrPos].strokeStyle=e)},CVContextData.prototype.lineWidth=function(e){this.stack[this.cArrPos].lineWidth!==e&&(this.currentLineWidth=e,this.stack[this.cArrPos].lineWidth=e)},CVContextData.prototype.lineCap=function(e){this.stack[this.cArrPos].lineCap!==e&&(this.currentLineCap=e,this.stack[this.cArrPos].lineCap=e)},CVContextData.prototype.lineJoin=function(e){this.stack[this.cArrPos].lineJoin!==e&&(this.currentLineJoin=e,this.stack[this.cArrPos].lineJoin=e)},CVContextData.prototype.miterLimit=function(e){this.stack[this.cArrPos].miterLimit!==e&&(this.currentMiterLimit=e,this.stack[this.cArrPos].miterLimit=e)},CVContextData.prototype.transform=function(e){this.transformMat.cloneFromProps(e);var t=this.cTr;this.transformMat.multiply(t),t.cloneFromProps(this.transformMat.props);var n=t.props;this.nativeContext.setTransform(n[0],n[1],n[4],n[5],n[12],n[13])},CVContextData.prototype.opacity=function(e){var t=this.stack[this.cArrPos].opacity;t*=e<0?0:e,this.stack[this.cArrPos].opacity!==t&&(this.currentOpacity!==e&&(this.nativeContext.globalAlpha=e,this.currentOpacity=e),this.stack[this.cArrPos].opacity=t)},CVContextData.prototype.fill=function(e){this.appliedFillStyle!==this.currentFillStyle&&(this.appliedFillStyle=this.currentFillStyle,this.nativeContext.fillStyle=this.appliedFillStyle),this.nativeContext.fill(e)},CVContextData.prototype.fillRect=function(e,t,n,r){this.appliedFillStyle!==this.currentFillStyle&&(this.appliedFillStyle=this.currentFillStyle,this.nativeContext.fillStyle=this.appliedFillStyle),this.nativeContext.fillRect(e,t,n,r)},CVContextData.prototype.stroke=function(){this.appliedStrokeStyle!==this.currentStrokeStyle&&(this.appliedStrokeStyle=this.currentStrokeStyle,this.nativeContext.strokeStyle=this.appliedStrokeStyle),this.appliedLineWidth!==this.currentLineWidth&&(this.appliedLineWidth=this.currentLineWidth,this.nativeContext.lineWidth=this.appliedLineWidth),this.appliedLineCap!==this.currentLineCap&&(this.appliedLineCap=this.currentLineCap,this.nativeContext.lineCap=this.appliedLineCap),this.appliedLineJoin!==this.currentLineJoin&&(this.appliedLineJoin=this.currentLineJoin,this.nativeContext.lineJoin=this.appliedLineJoin),this.appliedMiterLimit!==this.currentMiterLimit&&(this.appliedMiterLimit=this.currentMiterLimit,this.nativeContext.miterLimit=this.appliedMiterLimit),this.nativeContext.stroke()},extendPrototype([CanvasRendererBase,ICompElement,CVBaseElement],CVCompElement),CVCompElement.prototype.renderInnerContent=function(){var e,t=this.canvasContext;for(t.beginPath(),t.moveTo(0,0),t.lineTo(this.data.w,0),t.lineTo(this.data.w,this.data.h),t.lineTo(0,this.data.h),t.lineTo(0,0),t.clip(),e=this.layers.length-1;e>=0;e-=1)(this.completeLayers||this.elements[e])&&this.elements[e].renderFrame()},CVCompElement.prototype.destroy=function(){var e;for(e=this.layers.length-1;e>=0;e-=1)this.elements[e]&&this.elements[e].destroy();this.layers=null,this.elements=null},CVCompElement.prototype.createComp=function(e){return new CVCompElement(e,this.globalData,this)},extendPrototype([CanvasRendererBase],CanvasRenderer),CanvasRenderer.prototype.createComp=function(e){return new CVCompElement(e,this.globalData,this)},HBaseElement.prototype={checkBlendMode:function(){},initRendererElement:function(){this.baseElement=createTag(this.data.tg||"div"),this.data.hasMask?(this.svgElement=createNS("svg"),this.layerElement=createNS("g"),this.maskedElement=this.layerElement,this.svgElement.appendChild(this.layerElement),this.baseElement.appendChild(this.svgElement)):this.layerElement=this.baseElement,styleDiv(this.baseElement)},createContainerElements:function(){this.renderableEffectsManager=new CVEffects(this),this.transformedElement=this.baseElement,this.maskedElement=this.layerElement,this.data.ln&&this.layerElement.setAttribute("id",this.data.ln),this.data.cl&&this.layerElement.setAttribute("class",this.data.cl),0!==this.data.bm&&this.setBlendMode()},renderElement:function(){var e=this.transformedElement?this.transformedElement.style:{};if(this.finalTransform._matMdf){var t=this.finalTransform.mat.toCSS();e.transform=t,e.webkitTransform=t}this.finalTransform._opMdf&&(e.opacity=this.finalTransform.mProp.o.v)},renderFrame:function(){this.data.hd||this.hidden||(this.renderTransform(),this.renderRenderable(),this.renderElement(),this.renderInnerContent(),this._isFirstFrame&&(this._isFirstFrame=!1))},destroy:function(){this.layerElement=null,this.transformedElement=null,this.matteElement&&(this.matteElement=null),this.maskManager&&(this.maskManager.destroy(),this.maskManager=null)},createRenderableComponents:function(){this.maskManager=new MaskElement(this.data,this,this.globalData)},addEffects:function(){},setMatte:function(){}},HBaseElement.prototype.getBaseElement=SVGBaseElement.prototype.getBaseElement,HBaseElement.prototype.destroyBaseElement=HBaseElement.prototype.destroy,HBaseElement.prototype.buildElementParenting=BaseRenderer.prototype.buildElementParenting,extendPrototype([BaseElement,TransformElement,HBaseElement,HierarchyElement,FrameElement,RenderableDOMElement],HSolidElement),HSolidElement.prototype.createContent=function(){var e;this.data.hasMask?((e=createNS("rect")).setAttribute("width",this.data.sw),e.setAttribute("height",this.data.sh),e.setAttribute("fill",this.data.sc),this.svgElement.setAttribute("width",this.data.sw),this.svgElement.setAttribute("height",this.data.sh)):((e=createTag("div")).style.width=this.data.sw+"px",e.style.height=this.data.sh+"px",e.style.backgroundColor=this.data.sc),this.layerElement.appendChild(e)},extendPrototype([BaseElement,TransformElement,HSolidElement,SVGShapeElement,HBaseElement,HierarchyElement,FrameElement,RenderableElement],HShapeElement),HShapeElement.prototype._renderShapeFrame=HShapeElement.prototype.renderInnerContent,HShapeElement.prototype.createContent=function(){var e;if(this.baseElement.style.fontSize=0,this.data.hasMask)this.layerElement.appendChild(this.shapesContainer),e=this.svgElement;else{e=createNS("svg");var t=this.comp.data?this.comp.data:this.globalData.compSize;e.setAttribute("width",t.w),e.setAttribute("height",t.h),e.appendChild(this.shapesContainer),this.layerElement.appendChild(e)}this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.shapesContainer,0,[],!0),this.filterUniqueShapes(),this.shapeCont=e},HShapeElement.prototype.getTransformedPoint=function(e,t){var n,r=e.length;for(n=0;n<r;n+=1)t=e[n].mProps.v.applyToPointArray(t[0],t[1],0);return t},HShapeElement.prototype.calculateShapeBoundingBox=function(e,t){var n,r,a,i,s,o=e.sh.v,l=e.transformers,u=o._length;if(!(u<=1)){for(n=0;n<u-1;n+=1)r=this.getTransformedPoint(l,o.v[n]),a=this.getTransformedPoint(l,o.o[n]),i=this.getTransformedPoint(l,o.i[n+1]),s=this.getTransformedPoint(l,o.v[n+1]),this.checkBounds(r,a,i,s,t);o.c&&(r=this.getTransformedPoint(l,o.v[n]),a=this.getTransformedPoint(l,o.o[n]),i=this.getTransformedPoint(l,o.i[0]),s=this.getTransformedPoint(l,o.v[0]),this.checkBounds(r,a,i,s,t))}},HShapeElement.prototype.checkBounds=function(e,t,n,r,a){this.getBoundsOfCurve(e,t,n,r);var i=this.shapeBoundingBox;a.x=bmMin(i.left,a.x),a.xMax=bmMax(i.right,a.xMax),a.y=bmMin(i.top,a.y),a.yMax=bmMax(i.bottom,a.yMax)},HShapeElement.prototype.shapeBoundingBox={left:0,right:0,top:0,bottom:0},HShapeElement.prototype.tempBoundingBox={x:0,xMax:0,y:0,yMax:0,width:0,height:0},HShapeElement.prototype.getBoundsOfCurve=function(e,t,n,r){for(var a,i,s,o,l,u,c,h=[[e[0],r[0]],[e[1],r[1]]],d=0;d<2;++d)i=6*e[d]-12*t[d]+6*n[d],a=-3*e[d]+9*t[d]-9*n[d]+3*r[d],s=3*t[d]-3*e[d],i|=0,s|=0,0==(a|=0)&&0===i||(0===a?(o=-s/i)>0&&o<1&&h[d].push(this.calculateF(o,e,t,n,r,d)):(l=i*i-4*s*a)>=0&&((u=(-i+bmSqrt(l))/(2*a))>0&&u<1&&h[d].push(this.calculateF(u,e,t,n,r,d)),(c=(-i-bmSqrt(l))/(2*a))>0&&c<1&&h[d].push(this.calculateF(c,e,t,n,r,d))));this.shapeBoundingBox.left=bmMin.apply(null,h[0]),this.shapeBoundingBox.top=bmMin.apply(null,h[1]),this.shapeBoundingBox.right=bmMax.apply(null,h[0]),this.shapeBoundingBox.bottom=bmMax.apply(null,h[1])},HShapeElement.prototype.calculateF=function(e,t,n,r,a,i){return bmPow(1-e,3)*t[i]+3*bmPow(1-e,2)*e*n[i]+3*(1-e)*bmPow(e,2)*r[i]+bmPow(e,3)*a[i]},HShapeElement.prototype.calculateBoundingBox=function(e,t){var n,r=e.length;for(n=0;n<r;n+=1)e[n]&&e[n].sh?this.calculateShapeBoundingBox(e[n],t):e[n]&&e[n].it?this.calculateBoundingBox(e[n].it,t):e[n]&&e[n].style&&e[n].w&&this.expandStrokeBoundingBox(e[n].w,t)},HShapeElement.prototype.expandStrokeBoundingBox=function(e,t){var n=0;if(e.keyframes){for(var r=0;r<e.keyframes.length;r+=1){var a=e.keyframes[r].s;a>n&&(n=a)}n*=e.mult}else n=e.v*e.mult;t.x-=n,t.xMax+=n,t.y-=n,t.yMax+=n},HShapeElement.prototype.currentBoxContains=function(e){return this.currentBBox.x<=e.x&&this.currentBBox.y<=e.y&&this.currentBBox.width+this.currentBBox.x>=e.x+e.width&&this.currentBBox.height+this.currentBBox.y>=e.y+e.height},HShapeElement.prototype.renderInnerContent=function(){if(this._renderShapeFrame(),!this.hidden&&(this._isFirstFrame||this._mdf)){var e=this.tempBoundingBox,t=999999;if(e.x=t,e.xMax=-t,e.y=t,e.yMax=-t,this.calculateBoundingBox(this.itemsData,e),e.width=e.xMax<e.x?0:e.xMax-e.x,e.height=e.yMax<e.y?0:e.yMax-e.y,this.currentBoxContains(e))return;var n=!1;if(this.currentBBox.w!==e.width&&(this.currentBBox.w=e.width,this.shapeCont.setAttribute("width",e.width),n=!0),this.currentBBox.h!==e.height&&(this.currentBBox.h=e.height,this.shapeCont.setAttribute("height",e.height),n=!0),n||this.currentBBox.x!==e.x||this.currentBBox.y!==e.y){this.currentBBox.w=e.width,this.currentBBox.h=e.height,this.currentBBox.x=e.x,this.currentBBox.y=e.y,this.shapeCont.setAttribute("viewBox",this.currentBBox.x+" "+this.currentBBox.y+" "+this.currentBBox.w+" "+this.currentBBox.h);var r=this.shapeCont.style,a="translate("+this.currentBBox.x+"px,"+this.currentBBox.y+"px)";r.transform=a,r.webkitTransform=a}}},extendPrototype([BaseElement,TransformElement,HBaseElement,HierarchyElement,FrameElement,RenderableDOMElement,ITextElement],HTextElement),HTextElement.prototype.createContent=function(){if(this.isMasked=this.checkMasks(),this.isMasked){this.renderType="svg",this.compW=this.comp.data.w,this.compH=this.comp.data.h,this.svgElement.setAttribute("width",this.compW),this.svgElement.setAttribute("height",this.compH);var e=createNS("g");this.maskedElement.appendChild(e),this.innerElem=e}else this.renderType="html",this.innerElem=this.layerElement;this.checkParenting()},HTextElement.prototype.buildNewText=function(){var e=this.textProperty.currentData;this.renderedLetters=createSizedArray(e.l?e.l.length:0);var t=this.innerElem.style,n=e.fc?this.buildColor(e.fc):"rgba(0,0,0,0)";t.fill=n,t.color=n,e.sc&&(t.stroke=this.buildColor(e.sc),t.strokeWidth=e.sw+"px");var r,a,i=this.globalData.fontManager.getFontByName(e.f);if(!this.globalData.fontManager.chars)if(t.fontSize=e.finalSize+"px",t.lineHeight=e.finalSize+"px",i.fClass)this.innerElem.className=i.fClass;else{t.fontFamily=i.fFamily;var s=e.fWeight,o=e.fStyle;t.fontStyle=o,t.fontWeight=s}var l,u,c,h=e.l;a=h.length;var d,p=this.mHelper,f="",m=0;for(r=0;r<a;r+=1){if(this.globalData.fontManager.chars?(this.textPaths[m]?l=this.textPaths[m]:((l=createNS("path")).setAttribute("stroke-linecap",lineCapEnum[1]),l.setAttribute("stroke-linejoin",lineJoinEnum[2]),l.setAttribute("stroke-miterlimit","4")),this.isMasked||(this.textSpans[m]?c=(u=this.textSpans[m]).children[0]:((u=createTag("div")).style.lineHeight=0,(c=createNS("svg")).appendChild(l),styleDiv(u)))):this.isMasked?l=this.textPaths[m]?this.textPaths[m]:createNS("text"):this.textSpans[m]?(u=this.textSpans[m],l=this.textPaths[m]):(styleDiv(u=createTag("span")),styleDiv(l=createTag("span")),u.appendChild(l)),this.globalData.fontManager.chars){var g,y=this.globalData.fontManager.getCharData(e.finalText[r],i.fStyle,this.globalData.fontManager.getFontByName(e.f).fFamily);if(g=y?y.data:null,p.reset(),g&&g.shapes&&g.shapes.length&&(d=g.shapes[0].it,p.scale(e.finalSize/100,e.finalSize/100),f=this.createPathShape(p,d),l.setAttribute("d",f)),this.isMasked)this.innerElem.appendChild(l);else{if(this.innerElem.appendChild(u),g&&g.shapes){document.body.appendChild(c);var v=c.getBBox();c.setAttribute("width",v.width+2),c.setAttribute("height",v.height+2),c.setAttribute("viewBox",v.x-1+" "+(v.y-1)+" "+(v.width+2)+" "+(v.height+2));var b=c.style,x="translate("+(v.x-1)+"px,"+(v.y-1)+"px)";b.transform=x,b.webkitTransform=x,h[r].yOffset=v.y-1}else c.setAttribute("width",1),c.setAttribute("height",1);u.appendChild(c)}}else if(l.textContent=h[r].val,l.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),this.isMasked)this.innerElem.appendChild(l);else{this.innerElem.appendChild(u);var T=l.style,_="translate3d(0,"+-e.finalSize/1.2+"px,0)";T.transform=_,T.webkitTransform=_}this.isMasked?this.textSpans[m]=l:this.textSpans[m]=u,this.textSpans[m].style.display="block",this.textPaths[m]=l,m+=1}for(;m<this.textSpans.length;)this.textSpans[m].style.display="none",m+=1},HTextElement.prototype.renderInnerContent=function(){var e;if(this.validateText(),this.data.singleShape){if(!this._isFirstFrame&&!this.lettersChangedFlag)return;if(this.isMasked&&this.finalTransform._matMdf){this.svgElement.setAttribute("viewBox",-this.finalTransform.mProp.p.v[0]+" "+-this.finalTransform.mProp.p.v[1]+" "+this.compW+" "+this.compH),e=this.svgElement.style;var t="translate("+-this.finalTransform.mProp.p.v[0]+"px,"+-this.finalTransform.mProp.p.v[1]+"px)";e.transform=t,e.webkitTransform=t}}if(this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag),this.lettersChangedFlag||this.textAnimator.lettersChangedFlag){var n,r,a,i,s,o=0,l=this.textAnimator.renderedLetters,u=this.textProperty.currentData.l;for(r=u.length,n=0;n<r;n+=1)u[n].n?o+=1:(i=this.textSpans[n],s=this.textPaths[n],a=l[o],o+=1,a._mdf.m&&(this.isMasked?i.setAttribute("transform",a.m):(i.style.webkitTransform=a.m,i.style.transform=a.m)),i.style.opacity=a.o,a.sw&&a._mdf.sw&&s.setAttribute("stroke-width",a.sw),a.sc&&a._mdf.sc&&s.setAttribute("stroke",a.sc),a.fc&&a._mdf.fc&&(s.setAttribute("fill",a.fc),s.style.color=a.fc));if(this.innerElem.getBBox&&!this.hidden&&(this._isFirstFrame||this._mdf)){var c=this.innerElem.getBBox();if(this.currentBBox.w!==c.width&&(this.currentBBox.w=c.width,this.svgElement.setAttribute("width",c.width)),this.currentBBox.h!==c.height&&(this.currentBBox.h=c.height,this.svgElement.setAttribute("height",c.height)),this.currentBBox.w!==c.width+2||this.currentBBox.h!==c.height+2||this.currentBBox.x!==c.x-1||this.currentBBox.y!==c.y-1){this.currentBBox.w=c.width+2,this.currentBBox.h=c.height+2,this.currentBBox.x=c.x-1,this.currentBBox.y=c.y-1,this.svgElement.setAttribute("viewBox",this.currentBBox.x+" "+this.currentBBox.y+" "+this.currentBBox.w+" "+this.currentBBox.h),e=this.svgElement.style;var h="translate("+this.currentBBox.x+"px,"+this.currentBBox.y+"px)";e.transform=h,e.webkitTransform=h}}}},extendPrototype([BaseElement,FrameElement,HierarchyElement],HCameraElement),HCameraElement.prototype.setup=function(){var e,t,n,r,a=this.comp.threeDElements.length;for(e=0;e<a;e+=1)if("3d"===(t=this.comp.threeDElements[e]).type){n=t.perspectiveElem.style,r=t.container.style;var i=this.pe.v+"px",s="0px 0px 0px",o="matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)";n.perspective=i,n.webkitPerspective=i,r.transformOrigin=s,r.mozTransformOrigin=s,r.webkitTransformOrigin=s,n.transform=o,n.webkitTransform=o}},HCameraElement.prototype.createElements=function(){},HCameraElement.prototype.hide=function(){},HCameraElement.prototype.renderFrame=function(){var e,t,n=this._isFirstFrame;if(this.hierarchy)for(t=this.hierarchy.length,e=0;e<t;e+=1)n=this.hierarchy[e].finalTransform.mProp._mdf||n;if(n||this.pe._mdf||this.p&&this.p._mdf||this.px&&(this.px._mdf||this.py._mdf||this.pz._mdf)||this.rx._mdf||this.ry._mdf||this.rz._mdf||this.or._mdf||this.a&&this.a._mdf){if(this.mat.reset(),this.hierarchy)for(e=t=this.hierarchy.length-1;e>=0;e-=1){var r=this.hierarchy[e].finalTransform.mProp;this.mat.translate(-r.p.v[0],-r.p.v[1],r.p.v[2]),this.mat.rotateX(-r.or.v[0]).rotateY(-r.or.v[1]).rotateZ(r.or.v[2]),this.mat.rotateX(-r.rx.v).rotateY(-r.ry.v).rotateZ(r.rz.v),this.mat.scale(1/r.s.v[0],1/r.s.v[1],1/r.s.v[2]),this.mat.translate(r.a.v[0],r.a.v[1],r.a.v[2])}if(this.p?this.mat.translate(-this.p.v[0],-this.p.v[1],this.p.v[2]):this.mat.translate(-this.px.v,-this.py.v,this.pz.v),this.a){var a;a=this.p?[this.p.v[0]-this.a.v[0],this.p.v[1]-this.a.v[1],this.p.v[2]-this.a.v[2]]:[this.px.v-this.a.v[0],this.py.v-this.a.v[1],this.pz.v-this.a.v[2]];var i=Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)),s=[a[0]/i,a[1]/i,a[2]/i],o=Math.sqrt(s[2]*s[2]+s[0]*s[0]),l=Math.atan2(s[1],o),u=Math.atan2(s[0],-s[2]);this.mat.rotateY(u).rotateX(-l)}this.mat.rotateX(-this.rx.v).rotateY(-this.ry.v).rotateZ(this.rz.v),this.mat.rotateX(-this.or.v[0]).rotateY(-this.or.v[1]).rotateZ(this.or.v[2]),this.mat.translate(this.globalData.compSize.w/2,this.globalData.compSize.h/2,0),this.mat.translate(0,0,this.pe.v);var c=!this._prevMat.equals(this.mat);if((c||this.pe._mdf)&&this.comp.threeDElements){var h,d,p;for(t=this.comp.threeDElements.length,e=0;e<t;e+=1)if("3d"===(h=this.comp.threeDElements[e]).type){if(c){var f=this.mat.toCSS();(p=h.container.style).transform=f,p.webkitTransform=f}this.pe._mdf&&((d=h.perspectiveElem.style).perspective=this.pe.v+"px",d.webkitPerspective=this.pe.v+"px")}this.mat.clone(this._prevMat)}}this._isFirstFrame=!1},HCameraElement.prototype.prepareFrame=function(e){this.prepareProperties(e,!0)},HCameraElement.prototype.destroy=function(){},HCameraElement.prototype.getBaseElement=function(){return null},extendPrototype([BaseElement,TransformElement,HBaseElement,HSolidElement,HierarchyElement,FrameElement,RenderableElement],HImageElement),HImageElement.prototype.createContent=function(){var e=this.globalData.getAssetsPath(this.assetData),t=new Image;this.data.hasMask?(this.imageElem=createNS("image"),this.imageElem.setAttribute("width",this.assetData.w+"px"),this.imageElem.setAttribute("height",this.assetData.h+"px"),this.imageElem.setAttributeNS("http://www.w3.org/1999/xlink","href",e),this.layerElement.appendChild(this.imageElem),this.baseElement.setAttribute("width",this.assetData.w),this.baseElement.setAttribute("height",this.assetData.h)):this.layerElement.appendChild(t),t.crossOrigin="anonymous",t.src=e,this.data.ln&&this.baseElement.setAttribute("id",this.data.ln)},extendPrototype([BaseRenderer],HybridRendererBase),HybridRendererBase.prototype.buildItem=SVGRenderer.prototype.buildItem,HybridRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;)this.pendingElements.pop().checkParenting()},HybridRendererBase.prototype.appendElementInPos=function(e,t){var n=e.getBaseElement();if(n){var r=this.layers[t];if(r.ddd&&this.supports3d)this.addTo3dContainer(n,t);else if(this.threeDElements)this.addTo3dContainer(n,t);else{for(var a,i,s=0;s<t;)this.elements[s]&&!0!==this.elements[s]&&this.elements[s].getBaseElement&&(i=this.elements[s],a=(this.layers[s].ddd?this.getThreeDContainerByPos(s):i.getBaseElement())||a),s+=1;a?r.ddd&&this.supports3d||this.layerElement.insertBefore(n,a):r.ddd&&this.supports3d||this.layerElement.appendChild(n)}}},HybridRendererBase.prototype.createShape=function(e){return this.supports3d?new HShapeElement(e,this.globalData,this):new SVGShapeElement(e,this.globalData,this)},HybridRendererBase.prototype.createText=function(e){return this.supports3d?new HTextElement(e,this.globalData,this):new SVGTextLottieElement(e,this.globalData,this)},HybridRendererBase.prototype.createCamera=function(e){return this.camera=new HCameraElement(e,this.globalData,this),this.camera},HybridRendererBase.prototype.createImage=function(e){return this.supports3d?new HImageElement(e,this.globalData,this):new IImageElement(e,this.globalData,this)},HybridRendererBase.prototype.createSolid=function(e){return this.supports3d?new HSolidElement(e,this.globalData,this):new ISolidElement(e,this.globalData,this)},HybridRendererBase.prototype.createNull=SVGRenderer.prototype.createNull,HybridRendererBase.prototype.getThreeDContainerByPos=function(e){for(var t=0,n=this.threeDElements.length;t<n;){if(this.threeDElements[t].startPos<=e&&this.threeDElements[t].endPos>=e)return this.threeDElements[t].perspectiveElem;t+=1}return null},HybridRendererBase.prototype.createThreeDContainer=function(e,t){var n,r,a=createTag("div");styleDiv(a);var i=createTag("div");if(styleDiv(i),"3d"===t){(n=a.style).width=this.globalData.compSize.w+"px",n.height=this.globalData.compSize.h+"px";var s="50% 50%";n.webkitTransformOrigin=s,n.mozTransformOrigin=s,n.transformOrigin=s;var o="matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)";(r=i.style).transform=o,r.webkitTransform=o}a.appendChild(i);var l={container:i,perspectiveElem:a,startPos:e,endPos:e,type:t};return this.threeDElements.push(l),l},HybridRendererBase.prototype.build3dContainers=function(){var e,t,n=this.layers.length,r="";for(e=0;e<n;e+=1)this.layers[e].ddd&&3!==this.layers[e].ty?("3d"!==r&&(r="3d",t=this.createThreeDContainer(e,"3d")),t.endPos=Math.max(t.endPos,e)):("2d"!==r&&(r="2d",t=this.createThreeDContainer(e,"2d")),t.endPos=Math.max(t.endPos,e));for(e=(n=this.threeDElements.length)-1;e>=0;e-=1)this.resizerElem.appendChild(this.threeDElements[e].perspectiveElem)},HybridRendererBase.prototype.addTo3dContainer=function(e,t){for(var n=0,r=this.threeDElements.length;n<r;){if(t<=this.threeDElements[n].endPos){for(var a,i=this.threeDElements[n].startPos;i<t;)this.elements[i]&&this.elements[i].getBaseElement&&(a=this.elements[i].getBaseElement()),i+=1;a?this.threeDElements[n].container.insertBefore(e,a):this.threeDElements[n].container.appendChild(e);break}n+=1}},HybridRendererBase.prototype.configAnimation=function(e){var t=createTag("div"),n=this.animationItem.wrapper,r=t.style;r.width=e.w+"px",r.height=e.h+"px",this.resizerElem=t,styleDiv(t),r.transformStyle="flat",r.mozTransformStyle="flat",r.webkitTransformStyle="flat",this.renderConfig.className&&t.setAttribute("class",this.renderConfig.className),n.appendChild(t),r.overflow="hidden";var a=createNS("svg");a.setAttribute("width","1"),a.setAttribute("height","1"),styleDiv(a),this.resizerElem.appendChild(a);var i=createNS("defs");a.appendChild(i),this.data=e,this.setupGlobalData(e,a),this.globalData.defs=i,this.layers=e.layers,this.layerElement=this.resizerElem,this.build3dContainers(),this.updateContainerSize()},HybridRendererBase.prototype.destroy=function(){var e;this.animationItem.wrapper&&(this.animationItem.wrapper.innerText=""),this.animationItem.container=null,this.globalData.defs=null;var t=this.layers?this.layers.length:0;for(e=0;e<t;e+=1)this.elements[e]&&this.elements[e].destroy&&this.elements[e].destroy();this.elements.length=0,this.destroyed=!0,this.animationItem=null},HybridRendererBase.prototype.updateContainerSize=function(){var e,t,n,r,a=this.animationItem.wrapper.offsetWidth,i=this.animationItem.wrapper.offsetHeight,s=a/i;this.globalData.compSize.w/this.globalData.compSize.h>s?(e=a/this.globalData.compSize.w,t=a/this.globalData.compSize.w,n=0,r=(i-this.globalData.compSize.h*(a/this.globalData.compSize.w))/2):(e=i/this.globalData.compSize.h,t=i/this.globalData.compSize.h,n=(a-this.globalData.compSize.w*(i/this.globalData.compSize.h))/2,r=0);var o=this.resizerElem.style;o.webkitTransform="matrix3d("+e+",0,0,0,0,"+t+",0,0,0,0,1,0,"+n+","+r+",0,1)",o.transform=o.webkitTransform},HybridRendererBase.prototype.renderFrame=SVGRenderer.prototype.renderFrame,HybridRendererBase.prototype.hide=function(){this.resizerElem.style.display="none"},HybridRendererBase.prototype.show=function(){this.resizerElem.style.display="block"},HybridRendererBase.prototype.initItems=function(){if(this.buildAllItems(),this.camera)this.camera.setup();else{var e,t=this.globalData.compSize.w,n=this.globalData.compSize.h,r=this.threeDElements.length;for(e=0;e<r;e+=1){var a=this.threeDElements[e].perspectiveElem.style;a.webkitPerspective=Math.sqrt(Math.pow(t,2)+Math.pow(n,2))+"px",a.perspective=a.webkitPerspective}}},HybridRendererBase.prototype.searchExtraCompositions=function(e){var t,n=e.length,r=createTag("div");for(t=0;t<n;t+=1)if(e[t].xt){var a=this.createComp(e[t],r,this.globalData.comp,null);a.initExpressions(),this.globalData.projectInterface.registerComposition(a)}},extendPrototype([HybridRendererBase,ICompElement,HBaseElement],HCompElement),HCompElement.prototype._createBaseContainerElements=HCompElement.prototype.createContainerElements,HCompElement.prototype.createContainerElements=function(){this._createBaseContainerElements(),this.data.hasMask?(this.svgElement.setAttribute("width",this.data.w),this.svgElement.setAttribute("height",this.data.h),this.transformedElement=this.baseElement):this.transformedElement=this.layerElement},HCompElement.prototype.addTo3dContainer=function(e,t){for(var n,r=0;r<t;)this.elements[r]&&this.elements[r].getBaseElement&&(n=this.elements[r].getBaseElement()),r+=1;n?this.layerElement.insertBefore(e,n):this.layerElement.appendChild(e)},HCompElement.prototype.createComp=function(e){return this.supports3d?new HCompElement(e,this.globalData,this):new SVGCompElement(e,this.globalData,this)},extendPrototype([HybridRendererBase],HybridRenderer),HybridRenderer.prototype.createComp=function(e){return this.supports3d?new HCompElement(e,this.globalData,this):new SVGCompElement(e,this.globalData,this)};var CompExpressionInterface=function(e){function t(t){for(var n=0,r=e.layers.length;n<r;){if(e.layers[n].nm===t||e.layers[n].ind===t)return e.elements[n].layerInterface;n+=1}return null}return Object.defineProperty(t,"_name",{value:e.data.nm}),t.layer=t,t.pixelAspect=1,t.height=e.data.h||e.globalData.compSize.h,t.width=e.data.w||e.globalData.compSize.w,t.pixelAspect=1,t.frameDuration=1/e.globalData.frameRate,t.displayStartTime=0,t.numLayers=e.layers.length,t};function _typeof$2(e){return(_typeof$2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function seedRandom(e,t){var n=this,r=256,a="random",i=t.pow(r,6),s=t.pow(2,52),o=2*s,l=r-1;function u(e){var t,n=e.length,a=this,i=0,s=a.i=a.j=0,o=a.S=[];for(n||(e=[n++]);i<r;)o[i]=i++;for(i=0;i<r;i++)o[i]=o[s=l&s+e[i%n]+(t=o[i])],o[s]=t;a.g=function(e){for(var t,n=0,i=a.i,s=a.j,o=a.S;e--;)t=o[i=l&i+1],n=n*r+o[l&(o[i]=o[s=l&s+t])+(o[s]=t)];return a.i=i,a.j=s,n}}function c(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function h(e,t){var n,r=[],a=_typeof$2(e);if(t&&"object"==a)for(n in e)try{r.push(h(e[n],t-1))}catch(i){}return r.length?r:"string"==a?e:e+"\0"}function d(e,t){for(var n,r=e+"",a=0;a<r.length;)t[l&a]=l&(n^=19*t[l&a])+r.charCodeAt(a++);return p(t)}function p(e){return String.fromCharCode.apply(0,e)}t["seed"+a]=function(l,f,m){var g=[],y=d(h((f=!0===f?{entropy:!0}:f||{}).entropy?[l,p(e)]:null===l?function(){try{var t=new Uint8Array(r);return(n.crypto||n.msCrypto).getRandomValues(t),p(t)}catch(s){var a=n.navigator,i=a&&a.plugins;return[+new Date,n,i,n.screen,p(e)]}}():l,3),g),v=new u(g),b=function(){for(var e=v.g(6),t=i,n=0;e<s;)e=(e+n)*r,t*=r,n=v.g(1);for(;e>=o;)e/=2,t/=2,n>>>=1;return(e+n)/t};return b.int32=function(){return 0|v.g(4)},b.quick=function(){return v.g(4)/4294967296},b.double=b,d(p(v.S),e),(f.pass||m||function(e,n,r,i){return i&&(i.S&&c(i,v),e.state=function(){return c(v,{})}),r?(t[a]=e,n):e})(b,y,"global"in f?f.global:this==t,f.state)},d(t.random(),e)}function initialize$2(e){seedRandom([],e)}var propTypes={SHAPE:"shape"};function _typeof$1(e){return(_typeof$1="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var ExpressionManager=function(){var ob={},Math=BMMath,window=null,document=null,XMLHttpRequest=null,fetch=null,frames=null,_lottieGlobal={};function resetFrame(){_lottieGlobal={}}function $bm_isInstanceOfArray(e){return e.constructor===Array||e.constructor===Float32Array}function isNumerable(e,t){return"number"===e||t instanceof Number||"boolean"===e||"string"===e}function $bm_neg(e){var t=_typeof$1(e);if("number"===t||e instanceof Number||"boolean"===t)return-e;if($bm_isInstanceOfArray(e)){var n,r=e.length,a=[];for(n=0;n<r;n+=1)a[n]=-e[n];return a}return e.propType?e.v:-e}initialize$2(BMMath);var easeInBez=BezierFactory.getBezierEasing(.333,0,.833,.833,"easeIn").get,easeOutBez=BezierFactory.getBezierEasing(.167,.167,.667,1,"easeOut").get,easeInOutBez=BezierFactory.getBezierEasing(.33,0,.667,1,"easeInOut").get;function sum(e,t){var n=_typeof$1(e),r=_typeof$1(t);if(isNumerable(n,e)&&isNumerable(r,t)||"string"===n||"string"===r)return e+t;if($bm_isInstanceOfArray(e)&&isNumerable(r,t))return(e=e.slice(0))[0]+=t,e;if(isNumerable(n,e)&&$bm_isInstanceOfArray(t))return(t=t.slice(0))[0]=e+t[0],t;if($bm_isInstanceOfArray(e)&&$bm_isInstanceOfArray(t)){for(var a=0,i=e.length,s=t.length,o=[];a<i||a<s;)("number"==typeof e[a]||e[a]instanceof Number)&&("number"==typeof t[a]||t[a]instanceof Number)?o[a]=e[a]+t[a]:o[a]=void 0===t[a]?e[a]:e[a]||t[a],a+=1;return o}return 0}var add=sum;function sub(e,t){var n=_typeof$1(e),r=_typeof$1(t);if(isNumerable(n,e)&&isNumerable(r,t))return"string"===n&&(e=parseInt(e,10)),"string"===r&&(t=parseInt(t,10)),e-t;if($bm_isInstanceOfArray(e)&&isNumerable(r,t))return(e=e.slice(0))[0]-=t,e;if(isNumerable(n,e)&&$bm_isInstanceOfArray(t))return(t=t.slice(0))[0]=e-t[0],t;if($bm_isInstanceOfArray(e)&&$bm_isInstanceOfArray(t)){for(var a=0,i=e.length,s=t.length,o=[];a<i||a<s;)("number"==typeof e[a]||e[a]instanceof Number)&&("number"==typeof t[a]||t[a]instanceof Number)?o[a]=e[a]-t[a]:o[a]=void 0===t[a]?e[a]:e[a]||t[a],a+=1;return o}return 0}function mul(e,t){var n,r,a,i=_typeof$1(e),s=_typeof$1(t);if(isNumerable(i,e)&&isNumerable(s,t))return e*t;if($bm_isInstanceOfArray(e)&&isNumerable(s,t)){for(a=e.length,n=createTypedArray("float32",a),r=0;r<a;r+=1)n[r]=e[r]*t;return n}if(isNumerable(i,e)&&$bm_isInstanceOfArray(t)){for(a=t.length,n=createTypedArray("float32",a),r=0;r<a;r+=1)n[r]=e*t[r];return n}return 0}function div(e,t){var n,r,a,i=_typeof$1(e),s=_typeof$1(t);if(isNumerable(i,e)&&isNumerable(s,t))return e/t;if($bm_isInstanceOfArray(e)&&isNumerable(s,t)){for(a=e.length,n=createTypedArray("float32",a),r=0;r<a;r+=1)n[r]=e[r]/t;return n}if(isNumerable(i,e)&&$bm_isInstanceOfArray(t)){for(a=t.length,n=createTypedArray("float32",a),r=0;r<a;r+=1)n[r]=e/t[r];return n}return 0}function mod(e,t){return"string"==typeof e&&(e=parseInt(e,10)),"string"==typeof t&&(t=parseInt(t,10)),e%t}var $bm_sum=sum,$bm_sub=sub,$bm_mul=mul,$bm_div=div,$bm_mod=mod;function clamp(e,t,n){if(t>n){var r=n;n=t,t=r}return Math.min(Math.max(e,t),n)}function radiansToDegrees(e){return e/degToRads}var radians_to_degrees=radiansToDegrees;function degreesToRadians(e){return e*degToRads}var degrees_to_radians=radiansToDegrees,helperLengthArray=[0,0,0,0,0,0];function length(e,t){if("number"==typeof e||e instanceof Number)return t=t||0,Math.abs(e-t);var n;t||(t=helperLengthArray);var r=Math.min(e.length,t.length),a=0;for(n=0;n<r;n+=1)a+=Math.pow(t[n]-e[n],2);return Math.sqrt(a)}function normalize(e){return div(e,length(e))}function rgbToHsl(e){var t,n,r=e[0],a=e[1],i=e[2],s=Math.max(r,a,i),o=Math.min(r,a,i),l=(s+o)/2;if(s===o)t=0,n=0;else{var u=s-o;switch(n=l>.5?u/(2-s-o):u/(s+o),s){case r:t=(a-i)/u+(a<i?6:0);break;case a:t=(i-r)/u+2;break;case i:t=(r-a)/u+4}t/=6}return[t,n,l,e[3]]}function hue2rgb(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function hslToRgb(e){var t,n,r,a=e[0],i=e[1],s=e[2];if(0===i)t=s,r=s,n=s;else{var o=s<.5?s*(1+i):s+i-s*i,l=2*s-o;t=hue2rgb(l,o,a+1/3),n=hue2rgb(l,o,a),r=hue2rgb(l,o,a-1/3)}return[t,n,r,e[3]]}function linear(e,t,n,r,a){if(void 0!==r&&void 0!==a||(r=t,a=n,t=0,n=1),n<t){var i=n;n=t,t=i}if(e<=t)return r;if(e>=n)return a;var s,o=n===t?0:(e-t)/(n-t);if(!r.length)return r+(a-r)*o;var l=r.length,u=createTypedArray("float32",l);for(s=0;s<l;s+=1)u[s]=r[s]+(a[s]-r[s])*o;return u}function random(e,t){if(void 0===t&&(void 0===e?(e=0,t=1):(t=e,e=void 0)),t.length){var n,r=t.length;e||(e=createTypedArray("float32",r));var a=createTypedArray("float32",r),i=BMMath.random();for(n=0;n<r;n+=1)a[n]=e[n]+i*(t[n]-e[n]);return a}return void 0===e&&(e=0),e+BMMath.random()*(t-e)}function createPath(e,t,n,r){var a,i=e.length,s=shapePool.newElement();s.setPathData(!!r,i);var o,l,u=[0,0];for(a=0;a<i;a+=1)o=t&&t[a]?t[a]:u,l=n&&n[a]?n[a]:u,s.setTripleAt(e[a][0],e[a][1],l[0]+e[a][0],l[1]+e[a][1],o[0]+e[a][0],o[1]+e[a][1],a,!0);return s}function initiateExpression(elem,data,property){function noOp(e){return e}if(!elem.globalData.renderConfig.runExpressions)return noOp;var val=data.x,needsVelocity=/velocity(?![\w\d])/.test(val),_needsRandom=-1!==val.indexOf("random"),elemType=elem.data.ty,transform,$bm_transform,content,effect,thisProperty=property;thisProperty.valueAtTime=thisProperty.getValueAtTime,Object.defineProperty(thisProperty,"value",{get:function(){return thisProperty.v}}),elem.comp.frameDuration=1/elem.comp.globalData.frameRate,elem.comp.displayStartTime=0;var inPoint=elem.data.ip/elem.comp.globalData.frameRate,outPoint=elem.data.op/elem.comp.globalData.frameRate,width=elem.data.sw?elem.data.sw:0,height=elem.data.sh?elem.data.sh:0,name=elem.data.nm,loopIn,loop_in,loopOut,loop_out,smooth,toWorld,fromWorld,fromComp,toComp,fromCompToSurface,position,rotation,anchorPoint,scale,thisLayer,thisComp,mask,valueAtTime,velocityAtTime,scoped_bm_rt,expression_function=eval("[function _expression_function(){"+val+";scoped_bm_rt=$bm_rt}]")[0],numKeys=property.kf?data.k.length:0,active=!this.data||!0!==this.data.hd,wiggle=function(e,t){var n,r,a=this.pv.length?this.pv.length:1,i=createTypedArray("float32",a),s=Math.floor(5*time);for(n=0,r=0;n<s;){for(r=0;r<a;r+=1)i[r]+=-t+2*t*BMMath.random();n+=1}var o=5*time,l=o-Math.floor(o),u=createTypedArray("float32",a);if(a>1){for(r=0;r<a;r+=1)u[r]=this.pv[r]+i[r]+(-t+2*t*BMMath.random())*l;return u}return this.pv+i[0]+(-t+2*t*BMMath.random())*l}.bind(this);function loopInDuration(e,t){return loopIn(e,t,!0)}function loopOutDuration(e,t){return loopOut(e,t,!0)}thisProperty.loopIn&&(loopIn=thisProperty.loopIn.bind(thisProperty),loop_in=loopIn),thisProperty.loopOut&&(loopOut=thisProperty.loopOut.bind(thisProperty),loop_out=loopOut),thisProperty.smooth&&(smooth=thisProperty.smooth.bind(thisProperty)),this.getValueAtTime&&(valueAtTime=this.getValueAtTime.bind(this)),this.getVelocityAtTime&&(velocityAtTime=this.getVelocityAtTime.bind(this));var comp=elem.comp.globalData.projectInterface.bind(elem.comp.globalData.projectInterface),time,velocity,value,text,textIndex,textTotal,selectorValue;function lookAt(e,t){var n=[t[0]-e[0],t[1]-e[1],t[2]-e[2]],r=Math.atan2(n[0],Math.sqrt(n[1]*n[1]+n[2]*n[2]))/degToRads;return[-Math.atan2(n[1],n[2])/degToRads,r,0]}function easeOut(e,t,n,r,a){return applyEase(easeOutBez,e,t,n,r,a)}function easeIn(e,t,n,r,a){return applyEase(easeInBez,e,t,n,r,a)}function ease(e,t,n,r,a){return applyEase(easeInOutBez,e,t,n,r,a)}function applyEase(e,t,n,r,a,i){void 0===a?(a=n,i=r):t=(t-n)/(r-n),t>1?t=1:t<0&&(t=0);var s=e(t);if($bm_isInstanceOfArray(a)){var o,l=a.length,u=createTypedArray("float32",l);for(o=0;o<l;o+=1)u[o]=(i[o]-a[o])*s+a[o];return u}return(i-a)*s+a}function nearestKey(e){var t,n,r,a=data.k.length;if(data.k.length&&"number"!=typeof data.k[0])if(n=-1,(e*=elem.comp.globalData.frameRate)<data.k[0].t)n=1,r=data.k[0].t;else{for(t=0;t<a-1;t+=1){if(e===data.k[t].t){n=t+1,r=data.k[t].t;break}if(e>data.k[t].t&&e<data.k[t+1].t){e-data.k[t].t>data.k[t+1].t-e?(n=t+2,r=data.k[t+1].t):(n=t+1,r=data.k[t].t);break}}-1===n&&(n=t+1,r=data.k[t].t)}else n=0,r=0;var i={};return i.index=n,i.time=r/elem.comp.globalData.frameRate,i}function key(e){var t,n,r;if(!data.k.length||"number"==typeof data.k[0])throw new Error("The property has no keyframe at index "+e);e-=1,t={time:data.k[e].t/elem.comp.globalData.frameRate,value:[]};var a=Object.prototype.hasOwnProperty.call(data.k[e],"s")?data.k[e].s:data.k[e-1].e;for(r=a.length,n=0;n<r;n+=1)t[n]=a[n],t.value[n]=a[n];return t}function framesToTime(e,t){return t||(t=elem.comp.globalData.frameRate),e/t}function timeToFrames(e,t){return e||0===e||(e=time),t||(t=elem.comp.globalData.frameRate),e*t}function seedRandom(e){BMMath.seedrandom(randSeed+e)}function sourceRectAtTime(){return elem.sourceRectAtTime()}function substring(e,t){return"string"==typeof value?void 0===t?value.substring(e):value.substring(e,t):""}function substr(e,t){return"string"==typeof value?void 0===t?value.substr(e):value.substr(e,t):""}function posterizeTime(e){time=0===e?0:Math.floor(time*e)/e,value=valueAtTime(time)}var index=elem.data.ind,hasParent=!(!elem.hierarchy||!elem.hierarchy.length),parent,randSeed=Math.floor(1e6*Math.random()),globalData=elem.globalData;function executeExpression(e){return value=e,this.frameExpressionId===elem.globalData.frameId&&"textSelector"!==this.propType?value:("textSelector"===this.propType&&(textIndex=this.textIndex,textTotal=this.textTotal,selectorValue=this.selectorValue),thisLayer||(text=elem.layerInterface.text,thisLayer=elem.layerInterface,thisComp=elem.comp.compInterface,toWorld=thisLayer.toWorld.bind(thisLayer),fromWorld=thisLayer.fromWorld.bind(thisLayer),fromComp=thisLayer.fromComp.bind(thisLayer),toComp=thisLayer.toComp.bind(thisLayer),mask=thisLayer.mask?thisLayer.mask.bind(thisLayer):null,fromCompToSurface=fromComp),transform||(transform=elem.layerInterface("ADBE Transform Group"),$bm_transform=transform,transform&&(anchorPoint=transform.anchorPoint)),4!==elemType||content||(content=thisLayer("ADBE Root Vectors Group")),effect||(effect=thisLayer(4)),(hasParent=!(!elem.hierarchy||!elem.hierarchy.length))&&!parent&&(parent=elem.hierarchy[0].layerInterface),time=this.comp.renderedFrame/this.comp.globalData.frameRate,_needsRandom&&seedRandom(randSeed+time),needsVelocity&&(velocity=velocityAtTime(time)),expression_function(),this.frameExpressionId=elem.globalData.frameId,scoped_bm_rt=scoped_bm_rt.propType===propTypes.SHAPE?scoped_bm_rt.v:scoped_bm_rt)}return executeExpression.__preventDeadCodeRemoval=[$bm_transform,anchorPoint,time,velocity,inPoint,outPoint,width,height,name,loop_in,loop_out,smooth,toComp,fromCompToSurface,toWorld,fromWorld,mask,position,rotation,scale,thisComp,numKeys,active,wiggle,loopInDuration,loopOutDuration,comp,lookAt,easeOut,easeIn,ease,nearestKey,key,text,textIndex,textTotal,selectorValue,framesToTime,timeToFrames,sourceRectAtTime,substring,substr,posterizeTime,index,globalData],executeExpression}return ob.initiateExpression=initiateExpression,ob.__preventDeadCodeRemoval=[window,document,XMLHttpRequest,fetch,frames,$bm_neg,add,$bm_sum,$bm_sub,$bm_mul,$bm_div,$bm_mod,clamp,radians_to_degrees,degreesToRadians,degrees_to_radians,normalize,rgbToHsl,hslToRgb,linear,random,createPath,_lottieGlobal],ob.resetFrame=resetFrame,ob}(),Expressions=function(){var e={initExpressions:function(e){var t=0,n=[];e.renderer.compInterface=CompExpressionInterface(e.renderer),e.renderer.globalData.projectInterface.registerComposition(e.renderer),e.renderer.globalData.pushExpression=function(){t+=1},e.renderer.globalData.popExpression=function(){0==(t-=1)&&function(){var e,t=n.length;for(e=0;e<t;e+=1)n[e].release();n.length=0}()},e.renderer.globalData.registerExpressionProperty=function(e){-1===n.indexOf(e)&&n.push(e)}}};return e.resetFrame=ExpressionManager.resetFrame,e}(),MaskManagerInterface=function(){function e(e,t){this._mask=e,this._data=t}return Object.defineProperty(e.prototype,"maskPath",{get:function(){return this._mask.prop.k&&this._mask.prop.getValue(),this._mask.prop}}),Object.defineProperty(e.prototype,"maskOpacity",{get:function(){return this._mask.op.k&&this._mask.op.getValue(),100*this._mask.op.v}}),function(t){var n,r=createSizedArray(t.viewData.length),a=t.viewData.length;for(n=0;n<a;n+=1)r[n]=new e(t.viewData[n],t.masksProperties[n]);return function(e){for(n=0;n<a;){if(t.masksProperties[n].nm===e)return r[n];n+=1}return null}}}(),ExpressionPropertyInterface=function(){var e={pv:0,v:0,mult:1},t={pv:[0,0,0],v:[0,0,0],mult:1};function n(e,t,n){Object.defineProperty(e,"velocity",{get:function(){return t.getVelocityAtTime(t.comp.currentFrame)}}),e.numKeys=t.keyframes?t.keyframes.length:0,e.key=function(r){if(!e.numKeys)return 0;var a="";a="s"in t.keyframes[r-1]?t.keyframes[r-1].s:"e"in t.keyframes[r-2]?t.keyframes[r-2].e:t.keyframes[r-2].s;var i="unidimensional"===n?new Number(a):Object.assign({},a);return i.time=t.keyframes[r-1].t/t.elem.comp.globalData.frameRate,i.value="unidimensional"===n?a[0]:a,i},e.valueAtTime=t.getValueAtTime,e.speedAtTime=t.getSpeedAtTime,e.velocityAtTime=t.getVelocityAtTime,e.propertyGroup=t.propertyGroup}function r(){return e}return function(a){return a?"unidimensional"===a.propType?function(t){t&&"pv"in t||(t=e);var r=1/t.mult,a=t.pv*r,i=new Number(a);return i.value=a,n(i,t,"unidimensional"),function(){return t.k&&t.getValue(),a=t.v*r,i.value!==a&&((i=new Number(a)).value=a,n(i,t,"unidimensional")),i}}(a):function(e){e&&"pv"in e||(e=t);var r=1/e.mult,a=e.data&&e.data.l||e.pv.length,i=createTypedArray("float32",a),s=createTypedArray("float32",a);return i.value=s,n(i,e,"multidimensional"),function(){e.k&&e.getValue();for(var t=0;t<a;t+=1)s[t]=e.v[t]*r,i[t]=s[t];return i}}(a):r}}(),TransformExpressionInterface=function(e){function t(e){switch(e){case"scale":case"Scale":case"ADBE Scale":case 6:return t.scale;case"rotation":case"Rotation":case"ADBE Rotation":case"ADBE Rotate Z":case 10:return t.rotation;case"ADBE Rotate X":return t.xRotation;case"ADBE Rotate Y":return t.yRotation;case"position":case"Position":case"ADBE Position":case 2:return t.position;case"ADBE Position_0":return t.xPosition;case"ADBE Position_1":return t.yPosition;case"ADBE Position_2":return t.zPosition;case"anchorPoint":case"AnchorPoint":case"Anchor Point":case"ADBE AnchorPoint":case 1:return t.anchorPoint;case"opacity":case"Opacity":case 11:return t.opacity;default:return null}}var n,r,a,i;return Object.defineProperty(t,"rotation",{get:ExpressionPropertyInterface(e.r||e.rz)}),Object.defineProperty(t,"zRotation",{get:ExpressionPropertyInterface(e.rz||e.r)}),Object.defineProperty(t,"xRotation",{get:ExpressionPropertyInterface(e.rx)}),Object.defineProperty(t,"yRotation",{get:ExpressionPropertyInterface(e.ry)}),Object.defineProperty(t,"scale",{get:ExpressionPropertyInterface(e.s)}),e.p?i=ExpressionPropertyInterface(e.p):(n=ExpressionPropertyInterface(e.px),r=ExpressionPropertyInterface(e.py),e.pz&&(a=ExpressionPropertyInterface(e.pz))),Object.defineProperty(t,"position",{get:function(){return e.p?i():[n(),r(),a?a():0]}}),Object.defineProperty(t,"xPosition",{get:ExpressionPropertyInterface(e.px)}),Object.defineProperty(t,"yPosition",{get:ExpressionPropertyInterface(e.py)}),Object.defineProperty(t,"zPosition",{get:ExpressionPropertyInterface(e.pz)}),Object.defineProperty(t,"anchorPoint",{get:ExpressionPropertyInterface(e.a)}),Object.defineProperty(t,"opacity",{get:ExpressionPropertyInterface(e.o)}),Object.defineProperty(t,"skew",{get:ExpressionPropertyInterface(e.sk)}),Object.defineProperty(t,"skewAxis",{get:ExpressionPropertyInterface(e.sa)}),Object.defineProperty(t,"orientation",{get:ExpressionPropertyInterface(e.or)}),t},LayerExpressionInterface=function(){function e(e){var t=new Matrix;return void 0!==e?this._elem.finalTransform.mProp.getValueAtTime(e).clone(t):this._elem.finalTransform.mProp.applyToMatrix(t),t}function t(e,t){var n=this.getMatrix(t);return n.props[12]=0,n.props[13]=0,n.props[14]=0,this.applyPoint(n,e)}function n(e,t){var n=this.getMatrix(t);return this.applyPoint(n,e)}function r(e,t){var n=this.getMatrix(t);return n.props[12]=0,n.props[13]=0,n.props[14]=0,this.invertPoint(n,e)}function a(e,t){var n=this.getMatrix(t);return this.invertPoint(n,e)}function i(e,t){if(this._elem.hierarchy&&this._elem.hierarchy.length){var n,r=this._elem.hierarchy.length;for(n=0;n<r;n+=1)this._elem.hierarchy[n].finalTransform.mProp.applyToMatrix(e)}return e.applyToPointArray(t[0],t[1],t[2]||0)}function s(e,t){if(this._elem.hierarchy&&this._elem.hierarchy.length){var n,r=this._elem.hierarchy.length;for(n=0;n<r;n+=1)this._elem.hierarchy[n].finalTransform.mProp.applyToMatrix(e)}return e.inversePoint(t)}function o(e){var t=new Matrix;if(t.reset(),this._elem.finalTransform.mProp.applyToMatrix(t),this._elem.hierarchy&&this._elem.hierarchy.length){var n,r=this._elem.hierarchy.length;for(n=0;n<r;n+=1)this._elem.hierarchy[n].finalTransform.mProp.applyToMatrix(t);return t.inversePoint(e)}return t.inversePoint(e)}function l(){return[1,1,1,1]}return function(u){var c;function h(e){switch(e){case"ADBE Root Vectors Group":case"Contents":case 2:return h.shapeInterface;case 1:case 6:case"Transform":case"transform":case"ADBE Transform Group":return c;case 4:case"ADBE Effect Parade":case"effects":case"Effects":return h.effect;case"ADBE Text Properties":return h.textInterface;default:return null}}h.getMatrix=e,h.invertPoint=s,h.applyPoint=i,h.toWorld=n,h.toWorldVec=t,h.fromWorld=a,h.fromWorldVec=r,h.toComp=n,h.fromComp=o,h.sampleImage=l,h.sourceRectAtTime=u.sourceRectAtTime.bind(u),h._elem=u;var d=getDescriptor(c=TransformExpressionInterface(u.finalTransform.mProp),"anchorPoint");return Object.defineProperties(h,{hasParent:{get:function(){return u.hierarchy.length}},parent:{get:function(){return u.hierarchy[0].layerInterface}},rotation:getDescriptor(c,"rotation"),scale:getDescriptor(c,"scale"),position:getDescriptor(c,"position"),opacity:getDescriptor(c,"opacity"),anchorPoint:d,anchor_point:d,transform:{get:function(){return c}},active:{get:function(){return u.isInRange}}}),h.startTime=u.data.st,h.index=u.data.ind,h.source=u.data.refId,h.height=0===u.data.ty?u.data.h:100,h.width=0===u.data.ty?u.data.w:100,h.inPoint=u.data.ip/u.comp.globalData.frameRate,h.outPoint=u.data.op/u.comp.globalData.frameRate,h._name=u.data.nm,h.registerMaskInterface=function(e){h.mask=new MaskManagerInterface(e,u)},h.registerEffectsInterface=function(e){h.effect=e},h}}(),propertyGroupFactory=function(e,t){return function(n){return(n=void 0===n?1:n)<=0?e:t(n-1)}},PropertyInterface=function(e,t){var n={_name:e};return function(e){return(e=void 0===e?1:e)<=0?n:t(e-1)}},EffectsExpressionInterface=function(){function e(n,r,a,i){function s(e){for(var t=n.ef,r=0,a=t.length;r<a;){if(e===t[r].nm||e===t[r].mn||e===t[r].ix)return 5===t[r].ty?u[r]:u[r]();r+=1}throw new Error}var o,l=propertyGroupFactory(s,a),u=[],c=n.ef.length;for(o=0;o<c;o+=1)5===n.ef[o].ty?u.push(e(n.ef[o],r.effectElements[o],r.effectElements[o].propertyGroup,i)):u.push(t(r.effectElements[o],n.ef[o].ty,i,l));return"ADBE Color Control"===n.mn&&Object.defineProperty(s,"color",{get:function(){return u[0]()}}),Object.defineProperties(s,{numProperties:{get:function(){return n.np}},_name:{value:n.nm},propertyGroup:{value:l}}),s.enabled=0!==n.en,s.active=s.enabled,s}function t(e,t,n,r){var a=ExpressionPropertyInterface(e.p);return e.p.setGroupProperty&&e.p.setGroupProperty(PropertyInterface("",r)),function(){return 10===t?n.comp.compInterface(e.p.v):a()}}return{createEffectsInterface:function(t,n){if(t.effectsManager){var r,a=[],i=t.data.ef,s=t.effectsManager.effectElements.length;for(r=0;r<s;r+=1)a.push(e(i[r],t.effectsManager.effectElements[r],n,t));var o=t.data.ef||[],l=function(e){for(r=0,s=o.length;r<s;){if(e===o[r].nm||e===o[r].mn||e===o[r].ix)return a[r];r+=1}return null};return Object.defineProperty(l,"numProperties",{get:function(){return o.length}}),l}return null}}}(),ShapePathInterface=function(e,t,n){var r=t.sh;function a(e){return"Shape"===e||"shape"===e||"Path"===e||"path"===e||"ADBE Vector Shape"===e||2===e?a.path:null}var i=propertyGroupFactory(a,n);return r.setGroupProperty(PropertyInterface("Path",i)),Object.defineProperties(a,{path:{get:function(){return r.k&&r.getValue(),r}},shape:{get:function(){return r.k&&r.getValue(),r}},_name:{value:e.nm},ix:{value:e.ix},propertyIndex:{value:e.ix},mn:{value:e.mn},propertyGroup:{value:n}}),a},ShapeExpressionInterface=function(){function e(e,s,d){var p,f=[],m=e?e.length:0;for(p=0;p<m;p+=1)"gr"===e[p].ty?f.push(t(e[p],s[p],d)):"fl"===e[p].ty?f.push(n(e[p],s[p],d)):"st"===e[p].ty?f.push(a(e[p],s[p],d)):"tm"===e[p].ty?f.push(i(e[p],s[p],d)):"tr"===e[p].ty||("el"===e[p].ty?f.push(o(e[p],s[p],d)):"sr"===e[p].ty?f.push(l(e[p],s[p],d)):"sh"===e[p].ty?f.push(ShapePathInterface(e[p],s[p],d)):"rc"===e[p].ty?f.push(u(e[p],s[p],d)):"rd"===e[p].ty?f.push(c(e[p],s[p],d)):"rp"===e[p].ty?f.push(h(e[p],s[p],d)):"gf"===e[p].ty?f.push(r(e[p],s[p],d)):f.push((e[p],s[p],function(){return null})));return f}function t(t,n,r){var a=function(e){switch(e){case"ADBE Vectors Group":case"Contents":case 2:return a.content;default:return a.transform}};a.propertyGroup=propertyGroupFactory(a,r);var i=function(t,n,r){var a,i=function(e){for(var t=0,n=a.length;t<n;){if(a[t]._name===e||a[t].mn===e||a[t].propertyIndex===e||a[t].ix===e||a[t].ind===e)return a[t];t+=1}return"number"==typeof e?a[e-1]:null};i.propertyGroup=propertyGroupFactory(i,r),a=e(t.it,n.it,i.propertyGroup),i.numProperties=a.length;var o=s(t.it[t.it.length-1],n.it[n.it.length-1],i.propertyGroup);return i.transform=o,i.propertyIndex=t.cix,i._name=t.nm,i}(t,n,a.propertyGroup),o=s(t.it[t.it.length-1],n.it[n.it.length-1],a.propertyGroup);return a.content=i,a.transform=o,Object.defineProperty(a,"_name",{get:function(){return t.nm}}),a.numProperties=t.np,a.propertyIndex=t.ix,a.nm=t.nm,a.mn=t.mn,a}function n(e,t,n){function r(e){return"Color"===e||"color"===e?r.color:"Opacity"===e||"opacity"===e?r.opacity:null}return Object.defineProperties(r,{color:{get:ExpressionPropertyInterface(t.c)},opacity:{get:ExpressionPropertyInterface(t.o)},_name:{value:e.nm},mn:{value:e.mn}}),t.c.setGroupProperty(PropertyInterface("Color",n)),t.o.setGroupProperty(PropertyInterface("Opacity",n)),r}function r(e,t,n){function r(e){return"Start Point"===e||"start point"===e?r.startPoint:"End Point"===e||"end point"===e?r.endPoint:"Opacity"===e||"opacity"===e?r.opacity:null}return Object.defineProperties(r,{startPoint:{get:ExpressionPropertyInterface(t.s)},endPoint:{get:ExpressionPropertyInterface(t.e)},opacity:{get:ExpressionPropertyInterface(t.o)},type:{get:function(){return"a"}},_name:{value:e.nm},mn:{value:e.mn}}),t.s.setGroupProperty(PropertyInterface("Start Point",n)),t.e.setGroupProperty(PropertyInterface("End Point",n)),t.o.setGroupProperty(PropertyInterface("Opacity",n)),r}function a(e,t,n){var r,a,i=propertyGroupFactory(u,n),s=propertyGroupFactory(l,i),o=e.d?e.d.length:0,l={};for(r=0;r<o;r+=1)a=r,Object.defineProperty(l,e.d[a].nm,{get:ExpressionPropertyInterface(t.d.dataProps[a].p)}),t.d.dataProps[r].p.setGroupProperty(s);function u(e){return"Color"===e||"color"===e?u.color:"Opacity"===e||"opacity"===e?u.opacity:"Stroke Width"===e||"stroke width"===e?u.strokeWidth:null}return Object.defineProperties(u,{color:{get:ExpressionPropertyInterface(t.c)},opacity:{get:ExpressionPropertyInterface(t.o)},strokeWidth:{get:ExpressionPropertyInterface(t.w)},dash:{get:function(){return l}},_name:{value:e.nm},mn:{value:e.mn}}),t.c.setGroupProperty(PropertyInterface("Color",i)),t.o.setGroupProperty(PropertyInterface("Opacity",i)),t.w.setGroupProperty(PropertyInterface("Stroke Width",i)),u}function i(e,t,n){function r(t){return t===e.e.ix||"End"===t||"end"===t?r.end:t===e.s.ix?r.start:t===e.o.ix?r.offset:null}var a=propertyGroupFactory(r,n);return r.propertyIndex=e.ix,t.s.setGroupProperty(PropertyInterface("Start",a)),t.e.setGroupProperty(PropertyInterface("End",a)),t.o.setGroupProperty(PropertyInterface("Offset",a)),r.propertyIndex=e.ix,r.propertyGroup=n,Object.defineProperties(r,{start:{get:ExpressionPropertyInterface(t.s)},end:{get:ExpressionPropertyInterface(t.e)},offset:{get:ExpressionPropertyInterface(t.o)},_name:{value:e.nm}}),r.mn=e.mn,r}function s(e,t,n){function r(t){return e.a.ix===t||"Anchor Point"===t?r.anchorPoint:e.o.ix===t||"Opacity"===t?r.opacity:e.p.ix===t||"Position"===t?r.position:e.r.ix===t||"Rotation"===t||"ADBE Vector Rotation"===t?r.rotation:e.s.ix===t||"Scale"===t?r.scale:e.sk&&e.sk.ix===t||"Skew"===t?r.skew:e.sa&&e.sa.ix===t||"Skew Axis"===t?r.skewAxis:null}var a=propertyGroupFactory(r,n);return t.transform.mProps.o.setGroupProperty(PropertyInterface("Opacity",a)),t.transform.mProps.p.setGroupProperty(PropertyInterface("Position",a)),t.transform.mProps.a.setGroupProperty(PropertyInterface("Anchor Point",a)),t.transform.mProps.s.setGroupProperty(PropertyInterface("Scale",a)),t.transform.mProps.r.setGroupProperty(PropertyInterface("Rotation",a)),t.transform.mProps.sk&&(t.transform.mProps.sk.setGroupProperty(PropertyInterface("Skew",a)),t.transform.mProps.sa.setGroupProperty(PropertyInterface("Skew Angle",a))),t.transform.op.setGroupProperty(PropertyInterface("Opacity",a)),Object.defineProperties(r,{opacity:{get:ExpressionPropertyInterface(t.transform.mProps.o)},position:{get:ExpressionPropertyInterface(t.transform.mProps.p)},anchorPoint:{get:ExpressionPropertyInterface(t.transform.mProps.a)},scale:{get:ExpressionPropertyInterface(t.transform.mProps.s)},rotation:{get:ExpressionPropertyInterface(t.transform.mProps.r)},skew:{get:ExpressionPropertyInterface(t.transform.mProps.sk)},skewAxis:{get:ExpressionPropertyInterface(t.transform.mProps.sa)},_name:{value:e.nm}}),r.ty="tr",r.mn=e.mn,r.propertyGroup=n,r}function o(e,t,n){function r(t){return e.p.ix===t?r.position:e.s.ix===t?r.size:null}var a=propertyGroupFactory(r,n);r.propertyIndex=e.ix;var i="tm"===t.sh.ty?t.sh.prop:t.sh;return i.s.setGroupProperty(PropertyInterface("Size",a)),i.p.setGroupProperty(PropertyInterface("Position",a)),Object.defineProperties(r,{size:{get:ExpressionPropertyInterface(i.s)},position:{get:ExpressionPropertyInterface(i.p)},_name:{value:e.nm}}),r.mn=e.mn,r}function l(e,t,n){function r(t){return e.p.ix===t?r.position:e.r.ix===t?r.rotation:e.pt.ix===t?r.points:e.or.ix===t||"ADBE Vector Star Outer Radius"===t?r.outerRadius:e.os.ix===t?r.outerRoundness:!e.ir||e.ir.ix!==t&&"ADBE Vector Star Inner Radius"!==t?e.is&&e.is.ix===t?r.innerRoundness:null:r.innerRadius}var a=propertyGroupFactory(r,n),i="tm"===t.sh.ty?t.sh.prop:t.sh;return r.propertyIndex=e.ix,i.or.setGroupProperty(PropertyInterface("Outer Radius",a)),i.os.setGroupProperty(PropertyInterface("Outer Roundness",a)),i.pt.setGroupProperty(PropertyInterface("Points",a)),i.p.setGroupProperty(PropertyInterface("Position",a)),i.r.setGroupProperty(PropertyInterface("Rotation",a)),e.ir&&(i.ir.setGroupProperty(PropertyInterface("Inner Radius",a)),i.is.setGroupProperty(PropertyInterface("Inner Roundness",a))),Object.defineProperties(r,{position:{get:ExpressionPropertyInterface(i.p)},rotation:{get:ExpressionPropertyInterface(i.r)},points:{get:ExpressionPropertyInterface(i.pt)},outerRadius:{get:ExpressionPropertyInterface(i.or)},outerRoundness:{get:ExpressionPropertyInterface(i.os)},innerRadius:{get:ExpressionPropertyInterface(i.ir)},innerRoundness:{get:ExpressionPropertyInterface(i.is)},_name:{value:e.nm}}),r.mn=e.mn,r}function u(e,t,n){function r(t){return e.p.ix===t?r.position:e.r.ix===t?r.roundness:e.s.ix===t||"Size"===t||"ADBE Vector Rect Size"===t?r.size:null}var a=propertyGroupFactory(r,n),i="tm"===t.sh.ty?t.sh.prop:t.sh;return r.propertyIndex=e.ix,i.p.setGroupProperty(PropertyInterface("Position",a)),i.s.setGroupProperty(PropertyInterface("Size",a)),i.r.setGroupProperty(PropertyInterface("Rotation",a)),Object.defineProperties(r,{position:{get:ExpressionPropertyInterface(i.p)},roundness:{get:ExpressionPropertyInterface(i.r)},size:{get:ExpressionPropertyInterface(i.s)},_name:{value:e.nm}}),r.mn=e.mn,r}function c(e,t,n){function r(t){return e.r.ix===t||"Round Corners 1"===t?r.radius:null}var a=propertyGroupFactory(r,n),i=t;return r.propertyIndex=e.ix,i.rd.setGroupProperty(PropertyInterface("Radius",a)),Object.defineProperties(r,{radius:{get:ExpressionPropertyInterface(i.rd)},_name:{value:e.nm}}),r.mn=e.mn,r}function h(e,t,n){function r(t){return e.c.ix===t||"Copies"===t?r.copies:e.o.ix===t||"Offset"===t?r.offset:null}var a=propertyGroupFactory(r,n),i=t;return r.propertyIndex=e.ix,i.c.setGroupProperty(PropertyInterface("Copies",a)),i.o.setGroupProperty(PropertyInterface("Offset",a)),Object.defineProperties(r,{copies:{get:ExpressionPropertyInterface(i.c)},offset:{get:ExpressionPropertyInterface(i.o)},_name:{value:e.nm}}),r.mn=e.mn,r}return function(t,n,r){var a;function i(e){if("number"==typeof e)return 0===(e=void 0===e?1:e)?r:a[e-1];for(var t=0,n=a.length;t<n;){if(a[t]._name===e)return a[t];t+=1}return null}return i.propertyGroup=propertyGroupFactory(i,(function(){return r})),a=e(t,n,i.propertyGroup),i.numProperties=a.length,i._name="Contents",i}}(),TextExpressionInterface=function(e){var t;function n(e){return"ADBE Text Document"===e?n.sourceText:null}return Object.defineProperty(n,"sourceText",{get:function(){e.textProperty.getValue();var n=e.textProperty.currentData.t;return t&&n===t.value||((t=new String(n)).value=n||new String(n),Object.defineProperty(t,"style",{get:function(){return{fillColor:e.textProperty.currentData.fc}}})),t}}),n};function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var FootageInterface=(dataInterfaceFactory=function(e){function t(e){return"Outline"===e?t.outlineInterface():null}return t._name="Outline",t.outlineInterface=function(e){var t="",n=e.getFootageData();function r(e){if(n[e])return t=e,"object"===_typeof(n=n[e])?r:n;var a=e.indexOf(t);if(-1!==a){var i=parseInt(e.substr(a+t.length),10);return"object"===_typeof(n=n[i])?r:n}return""}return function(){return t="",n=e.getFootageData(),r}}(e),t},function(e){function t(e){return"Data"===e?t.dataInterface:null}return t._name="Data",t.dataInterface=dataInterfaceFactory(e),t}),dataInterfaceFactory,interfaces={layer:LayerExpressionInterface,effects:EffectsExpressionInterface,comp:CompExpressionInterface,shape:ShapeExpressionInterface,text:TextExpressionInterface,footage:FootageInterface};function getInterface(e){return interfaces[e]||null}var expressionHelpers={searchExpressions:function(e,t,n){t.x&&(n.k=!0,n.x=!0,n.initiateExpression=ExpressionManager.initiateExpression,n.effectsSequence.push(n.initiateExpression(e,t,n).bind(n)))},getSpeedAtTime:function(e){var t=this.getValueAtTime(e),n=this.getValueAtTime(e+-.01),r=0;if(t.length){var a;for(a=0;a<t.length;a+=1)r+=Math.pow(n[a]-t[a],2);r=100*Math.sqrt(r)}else r=0;return r},getVelocityAtTime:function(e){if(void 0!==this.vel)return this.vel;var t,n,r=-.001,a=this.getValueAtTime(e),i=this.getValueAtTime(e+r);if(a.length)for(t=createTypedArray("float32",a.length),n=0;n<a.length;n+=1)t[n]=(i[n]-a[n])/r;else t=(i-a)/r;return t},getValueAtTime:function(e){return e*=this.elem.globalData.frameRate,(e-=this.offsetTime)!==this._cachingAtTime.lastFrame&&(this._cachingAtTime.lastIndex=this._cachingAtTime.lastFrame<e?this._cachingAtTime.lastIndex:0,this._cachingAtTime.value=this.interpolateValue(e,this._cachingAtTime),this._cachingAtTime.lastFrame=e),this._cachingAtTime.value},getStaticValueAtTime:function(){return this.pv},setGroupProperty:function(e){this.propertyGroup=e}};function addPropertyDecorator(){function e(e,t,n){if(!this.k||!this.keyframes)return this.pv;e=e?e.toLowerCase():"";var r,a,i,s,o,l=this.comp.renderedFrame,u=this.keyframes,c=u[u.length-1].t;if(l<=c)return this.pv;if(n?a=c-(r=t?Math.abs(c-this.elem.comp.globalData.frameRate*t):Math.max(0,c-this.elem.data.ip)):((!t||t>u.length-1)&&(t=u.length-1),r=c-(a=u[u.length-1-t].t)),"pingpong"===e){if(Math.floor((l-a)/r)%2!=0)return this.getValueAtTime((r-(l-a)%r+a)/this.comp.globalData.frameRate,0)}else{if("offset"===e){var h=this.getValueAtTime(a/this.comp.globalData.frameRate,0),d=this.getValueAtTime(c/this.comp.globalData.frameRate,0),p=this.getValueAtTime(((l-a)%r+a)/this.comp.globalData.frameRate,0),f=Math.floor((l-a)/r);if(this.pv.length){for(s=(o=new Array(h.length)).length,i=0;i<s;i+=1)o[i]=(d[i]-h[i])*f+p[i];return o}return(d-h)*f+p}if("continue"===e){var m=this.getValueAtTime(c/this.comp.globalData.frameRate,0),g=this.getValueAtTime((c-.001)/this.comp.globalData.frameRate,0);if(this.pv.length){for(s=(o=new Array(m.length)).length,i=0;i<s;i+=1)o[i]=m[i]+(m[i]-g[i])*((l-c)/this.comp.globalData.frameRate)/5e-4;return o}return m+(l-c)/.001*(m-g)}}return this.getValueAtTime(((l-a)%r+a)/this.comp.globalData.frameRate,0)}function t(e,t,n){if(!this.k)return this.pv;e=e?e.toLowerCase():"";var r,a,i,s,o,l=this.comp.renderedFrame,u=this.keyframes,c=u[0].t;if(l>=c)return this.pv;if(n?a=c+(r=t?Math.abs(this.elem.comp.globalData.frameRate*t):Math.max(0,this.elem.data.op-c)):((!t||t>u.length-1)&&(t=u.length-1),r=(a=u[t].t)-c),"pingpong"===e){if(Math.floor((c-l)/r)%2==0)return this.getValueAtTime(((c-l)%r+c)/this.comp.globalData.frameRate,0)}else{if("offset"===e){var h=this.getValueAtTime(c/this.comp.globalData.frameRate,0),d=this.getValueAtTime(a/this.comp.globalData.frameRate,0),p=this.getValueAtTime((r-(c-l)%r+c)/this.comp.globalData.frameRate,0),f=Math.floor((c-l)/r)+1;if(this.pv.length){for(s=(o=new Array(h.length)).length,i=0;i<s;i+=1)o[i]=p[i]-(d[i]-h[i])*f;return o}return p-(d-h)*f}if("continue"===e){var m=this.getValueAtTime(c/this.comp.globalData.frameRate,0),g=this.getValueAtTime((c+.001)/this.comp.globalData.frameRate,0);if(this.pv.length){for(s=(o=new Array(m.length)).length,i=0;i<s;i+=1)o[i]=m[i]+(m[i]-g[i])*(c-l)/.001;return o}return m+(m-g)*(c-l)/.001}}return this.getValueAtTime((r-((c-l)%r+c))/this.comp.globalData.frameRate,0)}function n(e,t){if(!this.k)return this.pv;if(e=.5*(e||.4),(t=Math.floor(t||5))<=1)return this.pv;var n,r,a=this.comp.renderedFrame/this.comp.globalData.frameRate,i=a-e,s=t>1?(a+e-i)/(t-1):1,o=0,l=0;for(n=this.pv.length?createTypedArray("float32",this.pv.length):0;o<t;){if(r=this.getValueAtTime(i+o*s),this.pv.length)for(l=0;l<this.pv.length;l+=1)n[l]+=r[l];else n+=r;o+=1}if(this.pv.length)for(l=0;l<this.pv.length;l+=1)n[l]/=t;else n/=t;return n}function r(e){this._transformCachingAtTime||(this._transformCachingAtTime={v:new Matrix});var t=this._transformCachingAtTime.v;if(t.cloneFromProps(this.pre.props),this.appliedTransformations<1){var n=this.a.getValueAtTime(e);t.translate(-n[0]*this.a.mult,-n[1]*this.a.mult,n[2]*this.a.mult)}if(this.appliedTransformations<2){var r=this.s.getValueAtTime(e);t.scale(r[0]*this.s.mult,r[1]*this.s.mult,r[2]*this.s.mult)}if(this.sk&&this.appliedTransformations<3){var a=this.sk.getValueAtTime(e),i=this.sa.getValueAtTime(e);t.skewFromAxis(-a*this.sk.mult,i*this.sa.mult)}if(this.r&&this.appliedTransformations<4){var s=this.r.getValueAtTime(e);t.rotate(-s*this.r.mult)}else if(!this.r&&this.appliedTransformations<4){var o=this.rz.getValueAtTime(e),l=this.ry.getValueAtTime(e),u=this.rx.getValueAtTime(e),c=this.or.getValueAtTime(e);t.rotateZ(-o*this.rz.mult).rotateY(l*this.ry.mult).rotateX(u*this.rx.mult).rotateZ(-c[2]*this.or.mult).rotateY(c[1]*this.or.mult).rotateX(c[0]*this.or.mult)}if(this.data.p&&this.data.p.s){var h=this.px.getValueAtTime(e),d=this.py.getValueAtTime(e);if(this.data.p.z){var p=this.pz.getValueAtTime(e);t.translate(h*this.px.mult,d*this.py.mult,-p*this.pz.mult)}else t.translate(h*this.px.mult,d*this.py.mult,0)}else{var f=this.p.getValueAtTime(e);t.translate(f[0]*this.p.mult,f[1]*this.p.mult,-f[2]*this.p.mult)}return t}function a(){return this.v.clone(new Matrix)}var i=TransformPropertyFactory.getTransformProperty;TransformPropertyFactory.getTransformProperty=function(e,t,n){var s=i(e,t,n);return s.dynamicProperties.length?s.getValueAtTime=r.bind(s):s.getValueAtTime=a.bind(s),s.setGroupProperty=expressionHelpers.setGroupProperty,s};var s=PropertyFactory.getProp;PropertyFactory.getProp=function(r,a,i,o,l){var u=s(r,a,i,o,l);u.kf?u.getValueAtTime=expressionHelpers.getValueAtTime.bind(u):u.getValueAtTime=expressionHelpers.getStaticValueAtTime.bind(u),u.setGroupProperty=expressionHelpers.setGroupProperty,u.loopOut=e,u.loopIn=t,u.smooth=n,u.getVelocityAtTime=expressionHelpers.getVelocityAtTime.bind(u),u.getSpeedAtTime=expressionHelpers.getSpeedAtTime.bind(u),u.numKeys=1===a.a?a.k.length:0,u.propertyIndex=a.ix;var c=0;return 0!==i&&(c=createTypedArray("float32",1===a.a?a.k[0].s.length:a.k.length)),u._cachingAtTime={lastFrame:initialDefaultFrame,lastIndex:0,value:c},expressionHelpers.searchExpressions(r,a,u),u.k&&l.addDynamicProperty(u),u};var o=ShapePropertyFactory.getConstructorFunction(),l=ShapePropertyFactory.getKeyframedConstructorFunction();function u(){}u.prototype={vertices:function(e,t){this.k&&this.getValue();var n,r=this.v;void 0!==t&&(r=this.getValueAtTime(t,0));var a=r._length,i=r[e],s=r.v,o=createSizedArray(a);for(n=0;n<a;n+=1)o[n]="i"===e||"o"===e?[i[n][0]-s[n][0],i[n][1]-s[n][1]]:[i[n][0],i[n][1]];return o},points:function(e){return this.vertices("v",e)},inTangents:function(e){return this.vertices("i",e)},outTangents:function(e){return this.vertices("o",e)},isClosed:function(){return this.v.c},pointOnPath:function(e,t){var n=this.v;void 0!==t&&(n=this.getValueAtTime(t,0)),this._segmentsLength||(this._segmentsLength=bez.getSegmentsLength(n));for(var r,a=this._segmentsLength,i=a.lengths,s=a.totalLength*e,o=0,l=i.length,u=0;o<l;){if(u+i[o].addedLength>s){var c=o,h=n.c&&o===l-1?0:o+1,d=(s-u)/i[o].addedLength;r=bez.getPointInSegment(n.v[c],n.v[h],n.o[c],n.i[h],d,i[o]);break}u+=i[o].addedLength,o+=1}return r||(r=n.c?[n.v[0][0],n.v[0][1]]:[n.v[n._length-1][0],n.v[n._length-1][1]]),r},vectorOnPath:function(e,t,n){1==e?e=this.v.c:0==e&&(e=.999);var r=this.pointOnPath(e,t),a=this.pointOnPath(e+.001,t),i=a[0]-r[0],s=a[1]-r[1],o=Math.sqrt(Math.pow(i,2)+Math.pow(s,2));return 0===o?[0,0]:"tangent"===n?[i/o,s/o]:[-s/o,i/o]},tangentOnPath:function(e,t){return this.vectorOnPath(e,t,"tangent")},normalOnPath:function(e,t){return this.vectorOnPath(e,t,"normal")},setGroupProperty:expressionHelpers.setGroupProperty,getValueAtTime:expressionHelpers.getStaticValueAtTime},extendPrototype([u],o),extendPrototype([u],l),l.prototype.getValueAtTime=function(e){return this._cachingAtTime||(this._cachingAtTime={shapeValue:shapePool.clone(this.pv),lastIndex:0,lastTime:initialDefaultFrame}),e*=this.elem.globalData.frameRate,(e-=this.offsetTime)!==this._cachingAtTime.lastTime&&(this._cachingAtTime.lastIndex=this._cachingAtTime.lastTime<e?this._caching.lastIndex:0,this._cachingAtTime.lastTime=e,this.interpolateShape(e,this._cachingAtTime.shapeValue,this._cachingAtTime)),this._cachingAtTime.shapeValue},l.prototype.initiateExpression=ExpressionManager.initiateExpression;var c=ShapePropertyFactory.getShapeProp;ShapePropertyFactory.getShapeProp=function(e,t,n,r,a){var i=c(e,t,n,r,a);return i.propertyIndex=t.ix,i.lock=!1,3===n?expressionHelpers.searchExpressions(e,t.pt,i):4===n&&expressionHelpers.searchExpressions(e,t.ks,i),i.k&&e.addDynamicProperty(i),i}}function initialize$1(){addPropertyDecorator()}function addDecorator(){TextProperty.prototype.getExpressionValue=function(e,t){var n=this.calculateExpression(t);if(e.t!==n){var r={};return this.copyData(r,e),r.t=n.toString(),r.__complete=!1,r}return e},TextProperty.prototype.searchProperty=function(){var e=this.searchKeyframes(),t=this.searchExpressions();return this.kf=e||t,this.kf},TextProperty.prototype.searchExpressions=function(){return this.data.d.x?(this.calculateExpression=ExpressionManager.initiateExpression.bind(this)(this.elem,this.data.d,this),this.addEffect(this.getExpressionValue.bind(this)),!0):null}}function initialize(){addDecorator()}function SVGComposableEffect(){}SVGComposableEffect.prototype={createMergeNode:function(e,t){var n,r,a=createNS("feMerge");for(a.setAttribute("result",e),r=0;r<t.length;r+=1)(n=createNS("feMergeNode")).setAttribute("in",t[r]),a.appendChild(n),a.appendChild(n);return a}};var linearFilterValue="0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0";function SVGTintFilter(e,t,n,r,a){this.filterManager=t;var i=createNS("feColorMatrix");i.setAttribute("type","matrix"),i.setAttribute("color-interpolation-filters","linearRGB"),i.setAttribute("values",linearFilterValue+" 1 0"),this.linearFilter=i,i.setAttribute("result",r+"_tint_1"),e.appendChild(i),(i=createNS("feColorMatrix")).setAttribute("type","matrix"),i.setAttribute("color-interpolation-filters","sRGB"),i.setAttribute("values","1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 1 0"),i.setAttribute("result",r+"_tint_2"),e.appendChild(i),this.matrixFilter=i;var s=this.createMergeNode(r,[a,r+"_tint_1",r+"_tint_2"]);e.appendChild(s)}function SVGFillFilter(e,t,n,r){this.filterManager=t;var a=createNS("feColorMatrix");a.setAttribute("type","matrix"),a.setAttribute("color-interpolation-filters","sRGB"),a.setAttribute("values","1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 1 0"),a.setAttribute("result",r),e.appendChild(a),this.matrixFilter=a}function SVGStrokeEffect(e,t,n){this.initialized=!1,this.filterManager=t,this.elem=n,this.paths=[]}function SVGTritoneFilter(e,t,n,r){this.filterManager=t;var a=createNS("feColorMatrix");a.setAttribute("type","matrix"),a.setAttribute("color-interpolation-filters","linearRGB"),a.setAttribute("values","0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0"),e.appendChild(a);var i=createNS("feComponentTransfer");i.setAttribute("color-interpolation-filters","sRGB"),i.setAttribute("result",r),this.matrixFilter=i;var s=createNS("feFuncR");s.setAttribute("type","table"),i.appendChild(s),this.feFuncR=s;var o=createNS("feFuncG");o.setAttribute("type","table"),i.appendChild(o),this.feFuncG=o;var l=createNS("feFuncB");l.setAttribute("type","table"),i.appendChild(l),this.feFuncB=l,e.appendChild(i)}function SVGProLevelsFilter(e,t,n,r){this.filterManager=t;var a=this.filterManager.effectElements,i=createNS("feComponentTransfer");(a[10].p.k||0!==a[10].p.v||a[11].p.k||1!==a[11].p.v||a[12].p.k||1!==a[12].p.v||a[13].p.k||0!==a[13].p.v||a[14].p.k||1!==a[14].p.v)&&(this.feFuncR=this.createFeFunc("feFuncR",i)),(a[17].p.k||0!==a[17].p.v||a[18].p.k||1!==a[18].p.v||a[19].p.k||1!==a[19].p.v||a[20].p.k||0!==a[20].p.v||a[21].p.k||1!==a[21].p.v)&&(this.feFuncG=this.createFeFunc("feFuncG",i)),(a[24].p.k||0!==a[24].p.v||a[25].p.k||1!==a[25].p.v||a[26].p.k||1!==a[26].p.v||a[27].p.k||0!==a[27].p.v||a[28].p.k||1!==a[28].p.v)&&(this.feFuncB=this.createFeFunc("feFuncB",i)),(a[31].p.k||0!==a[31].p.v||a[32].p.k||1!==a[32].p.v||a[33].p.k||1!==a[33].p.v||a[34].p.k||0!==a[34].p.v||a[35].p.k||1!==a[35].p.v)&&(this.feFuncA=this.createFeFunc("feFuncA",i)),(this.feFuncR||this.feFuncG||this.feFuncB||this.feFuncA)&&(i.setAttribute("color-interpolation-filters","sRGB"),e.appendChild(i)),(a[3].p.k||0!==a[3].p.v||a[4].p.k||1!==a[4].p.v||a[5].p.k||1!==a[5].p.v||a[6].p.k||0!==a[6].p.v||a[7].p.k||1!==a[7].p.v)&&((i=createNS("feComponentTransfer")).setAttribute("color-interpolation-filters","sRGB"),i.setAttribute("result",r),e.appendChild(i),this.feFuncRComposed=this.createFeFunc("feFuncR",i),this.feFuncGComposed=this.createFeFunc("feFuncG",i),this.feFuncBComposed=this.createFeFunc("feFuncB",i))}function SVGDropShadowEffect(e,t,n,r,a){var i=t.container.globalData.renderConfig.filterSize,s=t.data.fs||i;e.setAttribute("x",s.x||i.x),e.setAttribute("y",s.y||i.y),e.setAttribute("width",s.width||i.width),e.setAttribute("height",s.height||i.height),this.filterManager=t;var o=createNS("feGaussianBlur");o.setAttribute("in","SourceAlpha"),o.setAttribute("result",r+"_drop_shadow_1"),o.setAttribute("stdDeviation","0"),this.feGaussianBlur=o,e.appendChild(o);var l=createNS("feOffset");l.setAttribute("dx","25"),l.setAttribute("dy","0"),l.setAttribute("in",r+"_drop_shadow_1"),l.setAttribute("result",r+"_drop_shadow_2"),this.feOffset=l,e.appendChild(l);var u=createNS("feFlood");u.setAttribute("flood-color","#00ff00"),u.setAttribute("flood-opacity","1"),u.setAttribute("result",r+"_drop_shadow_3"),this.feFlood=u,e.appendChild(u);var c=createNS("feComposite");c.setAttribute("in",r+"_drop_shadow_3"),c.setAttribute("in2",r+"_drop_shadow_2"),c.setAttribute("operator","in"),c.setAttribute("result",r+"_drop_shadow_4"),e.appendChild(c);var h=this.createMergeNode(r,[r+"_drop_shadow_4",a]);e.appendChild(h)}extendPrototype([SVGComposableEffect],SVGTintFilter),SVGTintFilter.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var t=this.filterManager.effectElements[0].p.v,n=this.filterManager.effectElements[1].p.v,r=this.filterManager.effectElements[2].p.v/100;this.linearFilter.setAttribute("values",linearFilterValue+" "+r+" 0"),this.matrixFilter.setAttribute("values",n[0]-t[0]+" 0 0 0 "+t[0]+" "+(n[1]-t[1])+" 0 0 0 "+t[1]+" "+(n[2]-t[2])+" 0 0 0 "+t[2]+" 0 0 0 1 0")}},SVGFillFilter.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var t=this.filterManager.effectElements[2].p.v,n=this.filterManager.effectElements[6].p.v;this.matrixFilter.setAttribute("values","0 0 0 0 "+t[0]+" 0 0 0 0 "+t[1]+" 0 0 0 0 "+t[2]+" 0 0 0 "+n+" 0")}},SVGStrokeEffect.prototype.initialize=function(){var e,t,n,r,a=this.elem.layerElement.children||this.elem.layerElement.childNodes;for(1===this.filterManager.effectElements[1].p.v?(r=this.elem.maskManager.masksProperties.length,n=0):r=1+(n=this.filterManager.effectElements[0].p.v-1),(t=createNS("g")).setAttribute("fill","none"),t.setAttribute("stroke-linecap","round"),t.setAttribute("stroke-dashoffset",1);n<r;n+=1)e=createNS("path"),t.appendChild(e),this.paths.push({p:e,m:n});if(3===this.filterManager.effectElements[10].p.v){var i=createNS("mask"),s=createElementID();i.setAttribute("id",s),i.setAttribute("mask-type","alpha"),i.appendChild(t),this.elem.globalData.defs.appendChild(i);var o=createNS("g");for(o.setAttribute("mask","url("+getLocationHref()+"#"+s+")");a[0];)o.appendChild(a[0]);this.elem.layerElement.appendChild(o),this.masker=i,t.setAttribute("stroke","#fff")}else if(1===this.filterManager.effectElements[10].p.v||2===this.filterManager.effectElements[10].p.v){if(2===this.filterManager.effectElements[10].p.v)for(a=this.elem.layerElement.children||this.elem.layerElement.childNodes;a.length;)this.elem.layerElement.removeChild(a[0]);this.elem.layerElement.appendChild(t),this.elem.layerElement.removeAttribute("mask"),t.setAttribute("stroke","#fff")}this.initialized=!0,this.pathMasker=t},SVGStrokeEffect.prototype.renderFrame=function(e){var t;this.initialized||this.initialize();var n,r,a=this.paths.length;for(t=0;t<a;t+=1)if(-1!==this.paths[t].m&&(n=this.elem.maskManager.viewData[this.paths[t].m],r=this.paths[t].p,(e||this.filterManager._mdf||n.prop._mdf)&&r.setAttribute("d",n.lastPath),e||this.filterManager.effectElements[9].p._mdf||this.filterManager.effectElements[4].p._mdf||this.filterManager.effectElements[7].p._mdf||this.filterManager.effectElements[8].p._mdf||n.prop._mdf)){var i;if(0!==this.filterManager.effectElements[7].p.v||100!==this.filterManager.effectElements[8].p.v){var s=.01*Math.min(this.filterManager.effectElements[7].p.v,this.filterManager.effectElements[8].p.v),o=.01*Math.max(this.filterManager.effectElements[7].p.v,this.filterManager.effectElements[8].p.v),l=r.getTotalLength();i="0 0 0 "+l*s+" ";var u,c=l*(o-s),h=1+2*this.filterManager.effectElements[4].p.v*this.filterManager.effectElements[9].p.v*.01,d=Math.floor(c/h);for(u=0;u<d;u+=1)i+="1 "+2*this.filterManager.effectElements[4].p.v*this.filterManager.effectElements[9].p.v*.01+" ";i+="0 "+10*l+" 0 0"}else i="1 "+2*this.filterManager.effectElements[4].p.v*this.filterManager.effectElements[9].p.v*.01;r.setAttribute("stroke-dasharray",i)}if((e||this.filterManager.effectElements[4].p._mdf)&&this.pathMasker.setAttribute("stroke-width",2*this.filterManager.effectElements[4].p.v),(e||this.filterManager.effectElements[6].p._mdf)&&this.pathMasker.setAttribute("opacity",this.filterManager.effectElements[6].p.v),(1===this.filterManager.effectElements[10].p.v||2===this.filterManager.effectElements[10].p.v)&&(e||this.filterManager.effectElements[3].p._mdf)){var p=this.filterManager.effectElements[3].p.v;this.pathMasker.setAttribute("stroke","rgb("+bmFloor(255*p[0])+","+bmFloor(255*p[1])+","+bmFloor(255*p[2])+")")}},SVGTritoneFilter.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var t=this.filterManager.effectElements[0].p.v,n=this.filterManager.effectElements[1].p.v,r=this.filterManager.effectElements[2].p.v,a=r[0]+" "+n[0]+" "+t[0],i=r[1]+" "+n[1]+" "+t[1],s=r[2]+" "+n[2]+" "+t[2];this.feFuncR.setAttribute("tableValues",a),this.feFuncG.setAttribute("tableValues",i),this.feFuncB.setAttribute("tableValues",s)}},SVGProLevelsFilter.prototype.createFeFunc=function(e,t){var n=createNS(e);return n.setAttribute("type","table"),t.appendChild(n),n},SVGProLevelsFilter.prototype.getTableValue=function(e,t,n,r,a){for(var i,s,o=0,l=Math.min(e,t),u=Math.max(e,t),c=Array.call(null,{length:256}),h=0,d=a-r,p=t-e;o<=256;)s=(i=o/256)<=l?p<0?a:r:i>=u?p<0?r:a:r+d*Math.pow((i-e)/p,1/n),c[h]=s,h+=1,o+=256/255;return c.join(" ")},SVGProLevelsFilter.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var t,n=this.filterManager.effectElements;this.feFuncRComposed&&(e||n[3].p._mdf||n[4].p._mdf||n[5].p._mdf||n[6].p._mdf||n[7].p._mdf)&&(t=this.getTableValue(n[3].p.v,n[4].p.v,n[5].p.v,n[6].p.v,n[7].p.v),this.feFuncRComposed.setAttribute("tableValues",t),this.feFuncGComposed.setAttribute("tableValues",t),this.feFuncBComposed.setAttribute("tableValues",t)),this.feFuncR&&(e||n[10].p._mdf||n[11].p._mdf||n[12].p._mdf||n[13].p._mdf||n[14].p._mdf)&&(t=this.getTableValue(n[10].p.v,n[11].p.v,n[12].p.v,n[13].p.v,n[14].p.v),this.feFuncR.setAttribute("tableValues",t)),this.feFuncG&&(e||n[17].p._mdf||n[18].p._mdf||n[19].p._mdf||n[20].p._mdf||n[21].p._mdf)&&(t=this.getTableValue(n[17].p.v,n[18].p.v,n[19].p.v,n[20].p.v,n[21].p.v),this.feFuncG.setAttribute("tableValues",t)),this.feFuncB&&(e||n[24].p._mdf||n[25].p._mdf||n[26].p._mdf||n[27].p._mdf||n[28].p._mdf)&&(t=this.getTableValue(n[24].p.v,n[25].p.v,n[26].p.v,n[27].p.v,n[28].p.v),this.feFuncB.setAttribute("tableValues",t)),this.feFuncA&&(e||n[31].p._mdf||n[32].p._mdf||n[33].p._mdf||n[34].p._mdf||n[35].p._mdf)&&(t=this.getTableValue(n[31].p.v,n[32].p.v,n[33].p.v,n[34].p.v,n[35].p.v),this.feFuncA.setAttribute("tableValues",t))}},extendPrototype([SVGComposableEffect],SVGDropShadowEffect),SVGDropShadowEffect.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){if((e||this.filterManager.effectElements[4].p._mdf)&&this.feGaussianBlur.setAttribute("stdDeviation",this.filterManager.effectElements[4].p.v/4),e||this.filterManager.effectElements[0].p._mdf){var t=this.filterManager.effectElements[0].p.v;this.feFlood.setAttribute("flood-color",rgbToHex(Math.round(255*t[0]),Math.round(255*t[1]),Math.round(255*t[2])))}if((e||this.filterManager.effectElements[1].p._mdf)&&this.feFlood.setAttribute("flood-opacity",this.filterManager.effectElements[1].p.v/255),e||this.filterManager.effectElements[2].p._mdf||this.filterManager.effectElements[3].p._mdf){var n=this.filterManager.effectElements[3].p.v,r=(this.filterManager.effectElements[2].p.v-90)*degToRads,a=n*Math.cos(r),i=n*Math.sin(r);this.feOffset.setAttribute("dx",a),this.feOffset.setAttribute("dy",i)}}};var _svgMatteSymbols=[];function SVGMatte3Effect(e,t,n){this.initialized=!1,this.filterManager=t,this.filterElem=e,this.elem=n,n.matteElement=createNS("g"),n.matteElement.appendChild(n.layerElement),n.matteElement.appendChild(n.transformedElement),n.baseElement=n.matteElement}function SVGGaussianBlurEffect(e,t,n,r){e.setAttribute("x","-100%"),e.setAttribute("y","-100%"),e.setAttribute("width","300%"),e.setAttribute("height","300%"),this.filterManager=t;var a=createNS("feGaussianBlur");a.setAttribute("result",r),e.appendChild(a),this.feGaussianBlur=a}function TransformEffect(){}function SVGTransformEffect(e,t){this.init(t)}function CVTransformEffect(e){this.init(e)}return SVGMatte3Effect.prototype.findSymbol=function(e){for(var t=0,n=_svgMatteSymbols.length;t<n;){if(_svgMatteSymbols[t]===e)return _svgMatteSymbols[t];t+=1}return null},SVGMatte3Effect.prototype.replaceInParent=function(e,t){var n=e.layerElement.parentNode;if(n){for(var r,a=n.children,i=0,s=a.length;i<s&&a[i]!==e.layerElement;)i+=1;i<=s-2&&(r=a[i+1]);var o=createNS("use");o.setAttribute("href","#"+t),r?n.insertBefore(o,r):n.appendChild(o)}},SVGMatte3Effect.prototype.setElementAsMask=function(e,t){if(!this.findSymbol(t)){var n=createElementID(),r=createNS("mask");r.setAttribute("id",t.layerId),r.setAttribute("mask-type","alpha"),_svgMatteSymbols.push(t);var a=e.globalData.defs;a.appendChild(r);var i=createNS("symbol");i.setAttribute("id",n),this.replaceInParent(t,n),i.appendChild(t.layerElement),a.appendChild(i);var s=createNS("use");s.setAttribute("href","#"+n),r.appendChild(s),t.data.hd=!1,t.show()}e.setMatte(t.layerId)},SVGMatte3Effect.prototype.initialize=function(){for(var e=this.filterManager.effectElements[0].p.v,t=this.elem.comp.elements,n=0,r=t.length;n<r;)t[n]&&t[n].data.ind===e&&this.setElementAsMask(this.elem,t[n]),n+=1;this.initialized=!0},SVGMatte3Effect.prototype.renderFrame=function(){this.initialized||this.initialize()},SVGGaussianBlurEffect.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var t=.3*this.filterManager.effectElements[0].p.v,n=this.filterManager.effectElements[1].p.v,r=3==n?0:t,a=2==n?0:t;this.feGaussianBlur.setAttribute("stdDeviation",r+" "+a);var i=1==this.filterManager.effectElements[2].p.v?"wrap":"duplicate";this.feGaussianBlur.setAttribute("edgeMode",i)}},TransformEffect.prototype.init=function(e){this.effectsManager=e,this.type=effectTypes.TRANSFORM_EFFECT,this.matrix=new Matrix,this.opacity=-1,this._mdf=!1,this._opMdf=!1},TransformEffect.prototype.renderFrame=function(e){if(this._opMdf=!1,this._mdf=!1,e||this.effectsManager._mdf){var t=this.effectsManager.effectElements,n=t[0].p.v,r=t[1].p.v,a=1===t[2].p.v,i=t[3].p.v,s=a?i:t[4].p.v,o=t[5].p.v,l=t[6].p.v,u=t[7].p.v;this.matrix.reset(),this.matrix.translate(-n[0],-n[1],n[2]),this.matrix.scale(.01*s,.01*i,1),this.matrix.rotate(-u*degToRads),this.matrix.skewFromAxis(-o*degToRads,(l+90)*degToRads),this.matrix.translate(r[0],r[1],0),this._mdf=!0,this.opacity!==t[8].p.v&&(this.opacity=t[8].p.v,this._opMdf=!0)}},extendPrototype([TransformEffect],SVGTransformEffect),extendPrototype([TransformEffect],CVTransformEffect),registerRenderer("canvas",CanvasRenderer),registerRenderer("html",HybridRenderer),registerRenderer("svg",SVGRenderer),ShapeModifiers.registerModifier("tm",TrimModifier),ShapeModifiers.registerModifier("pb",PuckerAndBloatModifier),ShapeModifiers.registerModifier("rp",RepeaterModifier),ShapeModifiers.registerModifier("rd",RoundCornersModifier),ShapeModifiers.registerModifier("zz",ZigZagModifier),ShapeModifiers.registerModifier("op",OffsetPathModifier),setExpressionsPlugin(Expressions),setExpressionInterfaces(getInterface),initialize$1(),initialize(),registerEffect$1(20,SVGTintFilter,!0),registerEffect$1(21,SVGFillFilter,!0),registerEffect$1(22,SVGStrokeEffect,!1),registerEffect$1(23,SVGTritoneFilter,!0),registerEffect$1(24,SVGProLevelsFilter,!0),registerEffect$1(25,SVGDropShadowEffect,!0),registerEffect$1(28,SVGMatte3Effect,!1),registerEffect$1(29,SVGGaussianBlurEffect,!0),registerEffect$1(35,SVGTransformEffect,!1),registerEffect(35,CVTransformEffect),lottie},module.exports=factory2())})(lottie$1,lottie$1.exports);var lottieExports=lottie$1.exports;const lottie=getDefaultExportFromCjs(lottieExports);var ShowGuideEnum=(e=>(e[e.Off=0]="Off",e[e.Ocr=1]="Ocr",e[e.Liveness=2]="Liveness",e[e.Both=3]="Both",e))(ShowGuideEnum||{});function initAnimation$1(){const e=document.getElementById("fci-ocr-animation-guide");e&&lottie.loadAnimation({container:e,renderer:"canvas",loop:!0,autoplay:!0,path:window.ekyc._assets_config.animation_ocr_guide_path})}function initTopTitle(){const e=document.getElementById("fci-ocr-animation-top-title");e&&(e.innerText=i18n("pleaseTakePhotoOfBothSides"))}function initBottomTitle$1(){const e=document.getElementById("fci-ocr-animation-bottom-title");e&&(e.innerText=i18n("invalidImageIf"))}function initSamples(){const e=document.getElementById("fci-ocr-animation-samples");if(!e)return;const t=[{src:window.ekyc._assets_config.invalid_image_size,label:"tooSmall"},{src:window.ekyc._assets_config.invalid_image_missing_details,label:"missingDetails"},{src:window.ekyc._assets_config.invalid_image_blur,label:"blurry"}];e.innerHTML=`\n    ${t.map((e=>`<div class="fci-ocr-animation-sample-item">\n            <img src="${e.src}"/>\n            <span>${i18n(e.label)}</span>\n        </div>\n        `)).join("")}\n    `}function initNextBtn$1(){const e=document.getElementById("fci-ocr-animation-next-btn");e&&(e.innerText=i18n("upload"===window.ekyc.config.upload_type?"uploadSelectImage":"captureSelectImage"),e.onclick=()=>{window.ekyc.onChangeNextStep(),handleChangeLayout()})}function initAnimationGuide(){initAnimation$1(),initTopTitle(),initBottomTitle$1(),initSamples(),initNextBtn$1()}function animationGuideHtml(){return'\n        <div id="fci-ocr-animation-container">\n            <div id="fci-ocr-animation-top-title"></div>\n            <div id="fci-ocr-animation-guide"></div>\n            <div id="fci-ocr-animation-bottom-container">\n                <div id="fci-ocr-animation-bottom-title"></div>\n                <div id="fci-ocr-animation-samples"></div>\n                <button class="fci-btn"\n                    id="fci-ocr-animation-next-btn"></button>\n            </div>\n        </div>\n        '}function loadAnimationGuide(e){window.ekyc.config_setting.show_guide===ShowGuideEnum.Ocr||window.ekyc.config_setting.show_guide===ShowGuideEnum.Both?Utils.load(e,animationGuideHtml(),initAnimationGuide):(window.ekyc.onChangeNextStep(),handleChangeLayout())}function initAnimation(){const e=document.getElementById("fci-liveness-animation-guide");if(!e)return;lottie.loadAnimation({container:e,renderer:"canvas",loop:!0,autoplay:!0,path:window.ekyc._assets_config.animation_liveness_path}).setSpeed(1.5)}function initTitle$1(){const e=document.getElementById("fci-liveness-animation-bottom-title");e&&(e.innerText=i18n("takeASelfie"))}function initDetails(){const e=document.getElementById("fci-liveness-animation-bottom-details");e&&(e.innerText=i18n("selfieAniWarning"))}function initNextBtn(){const e=document.getElementById("fci-liveness-animation-next-btn");e&&(e.innerText=i18n("takeASelfie"),e.onclick=()=>{window.ekyc.onChangeNextStep(),handleChangeLayout()})}function initAnimationLiveness(){initAnimation(),initTitle$1(),initDetails(),initNextBtn()}function animationLivenessHtml(){return'\n        <div id="fci-liveness-animation-wrapper">\n            <div id="fci-liveness-animation-guide"></div>\n            <div id="fci-liveness-animation-bottom-container">\n                <div id="fci-liveness-animation-bottom-title"></div>\n                <div id="fci-liveness-animation-bottom-details"></div>\n                <button class="fci-btn"\n                    id="fci-liveness-animation-next-btn"></button>\n            </div>\n        </div>\n        '}function loadAnimationLiveness(e){window.ekyc.config_setting.show_guide===ShowGuideEnum.Liveness||window.ekyc.config_setting.show_guide===ShowGuideEnum.Both?Utils.load(e,animationLivenessHtml(),initAnimationLiveness):(window.ekyc.onChangeNextStep(),handleChangeLayout())}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,n)};function e(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}function n(e,t,n,r){return new(n||(n=Promise))((function(a,i){function s(e){try{l(r.next(e))}catch(t){i(t)}}function o(e){try{l(r.throw(e))}catch(t){i(t)}}function l(e){e.done?a(e.value):new n((function(t){t(e.value)})).then(s,o)}l((r=r.apply(e,t||[])).next())}))}function r(e,t){var n,r,a,i,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(i){return function(o){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(a=(a=s.trys).length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){s.label=i[1];break}if(6===i[0]&&s.label<a[1]){s.label=a[1],a=i;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(i);break}a[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(o){i=[6,o],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,o])}}}var o=function(){function e(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return e.prototype.setPlatform=function(e,t){null!=this.platform&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=e,this.platform=t},e.prototype.registerFlag=function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){var r=this.urlFlags[e];console.warn("Setting feature override from URL "+e+": "+r+"."),this.set(e,r)}},e.prototype.get=function(e){return e in this.flags||(this.flags[e]=this.evaluateFlag(e)),this.flags[e]},e.prototype.getNumber=function(e){return this.get(e)},e.prototype.getBool=function(e){return this.get(e)},e.prototype.getFlags=function(){return this.flags},Object.defineProperty(e.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),e.prototype.set=function(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)},e.prototype.evaluateFlag=function(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},e.prototype.setFlags=function(e){this.flags=Object.assign({},e)},e.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},e.prototype.populateURLFlags=function(){var e=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var t,n,r=(t=this.global.location.search,n={},t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return a(n,t[0],t[1]),t.join("=")})),n);"tfjsflags"in r&&r.tfjsflags.split(",").forEach((function(t){var n=t.split(":"),r=n[0],a=n[1];e.urlFlags[r]=function(e,t){if("true"===(t=t.toLowerCase())||"false"===t)return"true"===t;if(""+ +t===t)return+t;throw new Error("Could not parse value flag value "+t+" for flag "+e+".")}(r,a)}))}},e}();function a(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}function i(){return s}var s=null,u=new Map,c=new Map;function l(e,t){var n=g(e,t);return u.get(n)}function h(e){return c.get(e)}function f(e){for(var t=u.entries(),n=[];;){var r=t.next(),a=r.done,i=r.value;if(a)break;var s=i[0],o=i[1];s.split("_")[0]===e&&n.push(o)}return n}function d(e){var t=e.kernelName,n=e.backendName,r=g(t,n);if(u.has(r))throw new Error("The kernel '"+t+"' for backend '"+n+"' is already registered");u.set(r,e)}function p$1(e){var t=e.kernelName;c.has(t)&&console.warn("Overriding the gradient for '"+t+"'"),c.set(t,e)}function g(e,t){return t+"_"+e}function x(e,t,n){return Math.max(e,Math.min(t,n))}function b(e){return e%2==0?e:e+1}function w(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function C(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function E(e,t,n){void 0===n&&(n=""),C(S(e,t),(function(){return n+" Shapes "+e+" and "+t+" must match"}))}function R(e){C(null!=e,(function(){return"The input to the tensor constructor must be a non-null value."}))}function I(e,t,n){if(void 0===t&&(t=[]),void 0===n&&(n=!1),null==t&&(t=[]),Array.isArray(e)||V(e)&&!n)for(var r=0;r<e.length;++r)I(e[r],t,n);else t.push(e);return t}function k(e){if(0===e.length)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function S(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function A(e){return e%1==0}function D(e){if(null!=Math.tanh)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var t=Math.exp(2*e);return(t-1)/(t+1)}function T(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function N(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function F(e,t,n){return void 0===t&&(t=function(e){return 0}),new Promise((function(r,a){var i=0,s=function(){if(e())r();else{i++;var o=t(i);null!=n&&i>=n?a():setTimeout(s,o)}};s()}))}function _(e,t){for(var n=1,r=-1,a=0;a<e.length;++a)if(e[a]>=0)n*=e[a];else if(-1===e[a]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+a);r=a}else if(e[a]<0)throw Error("Shapes can not be < 0. Found "+e[a]+" at dim "+a);if(-1===r){if(t>0&&t!==n)throw Error("Size("+t+") must match the product of shape "+e);return e}if(0===n)throw Error("Cannot infer the missing size in ["+e+"] when there are 0 elements");if(t%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+t+" / "+n);var i=e.slice();return i[r]=t/n,i}function O(e,t){var n=t.length;return C((e=null==e?t.map((function(e,t){return t})):[].concat(e)).every((function(e){return e>=-n&&e<n})),(function(){return"All values in axis param must be in range [-"+n+", "+n+") but got axis "+e})),C(e.every((function(e){return A(e)})),(function(){return"All values in axis param must be integers but got axis "+e})),e.map((function(e){return e<0?n+e:e}))}function M(e,t){for(var n=[],r=[],a=null!=t&&Array.isArray(t)&&0===t.length,i=null==t||a?null:O(t,e).sort(),s=0,o=0;o<e.length;++o){if(null!=i){if(i[s]===o&&1!==e[o])throw new Error("Can't squeeze axis "+o+" since its dim '"+e[o]+"' is not 1");(null==i[s]||i[s]>o)&&1===e[o]&&(n.push(e[o]),r.push(o)),i[s]<=o&&s++}1!==e[o]&&(n.push(e[o]),r.push(o))}return{newShape:n,keptDims:r}}function B(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error("Unknown data type "+e);n=new Uint8Array(t)}return n}function P(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type "+e);n=new Array(t)}return n}function L(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+t+" being uploaded contains "+r+".")}}function W(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}function U(e,t){return!("complex64"===t||"float32"===t&&"complex64"!==e||"int32"===t&&"float32"!==e&&"complex64"!==e||"bool"===t&&"bool"===e)}function V(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function z(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype "+e)}function G(e){if(null==e)return 0;var t=0;return e.forEach((function(e){return t+=e.length})),t}function H(e){return"string"==typeof e||e instanceof String}function q(e){return"boolean"==typeof e}function K(e){return"number"==typeof e}function j(e){return Array.isArray(e)?j(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array?"int32":K(e)?"float32":H(e)?"string":q(e)?"bool":"float32"}function X(e){return!!(e&&e.constructor&&e.call&&e.apply)}function Y(e,t){for(var n=t;n<e;++n)if(e%n==0)return n;return e}function $$1(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function Q(e,t,n){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=I(e)),n&&L(e,t),a=t,(r=e)instanceof Float32Array&&"float32"===a||r instanceof Int32Array&&"int32"===a||r instanceof Uint8Array&&"bool"===a)return e;var r,a;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){for(var i=new Uint8Array(e.length),s=0;s<i.length;++s)0!==Math.round(e[s])&&(i[s]=1);return i}throw new Error("Unknown data type "+t)}function J(e,t){if(0===e.length)return t[0];var n=e.reduce((function(e,t){return e*t}));if(0===n)return[];if(n!==t.length)throw new Error("["+e+"] does not match the input size.");return function e(t,n,r){var a=new Array;if(1===n.length)for(var i=n[0],s=0;s<i;s++)a[s]=r[t+s];else{i=n[0];var o=n.slice(1),l=o.reduce((function(e,t){return e*t}));for(s=0;s<i;s++)a[s]=e(t+s*l,o,r)}return a}(0,e,t)}function Z(e,t){for(var n=tt(e,t),r=0;r<n.length;r++)n[r]=1;return n}function tt(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type "+t)}function et(){return i().platform.now()}function nt(e){e.forEach((function(t){C(Number.isInteger(t)&&t>=0,(function(){return"Tensor must have a shape comprised of positive integers but got shape ["+e+"]."}))}))}function rt(e,t){return void 0===t&&(t="utf-8"),t=t||"utf-8",i().platform.encode(e,t)}function ot(e,t){return void 0===t&&(t="utf-8"),t=t||"utf-8",i().platform.decode(e,t)}function at(e,t,n){if(0===t)return 0;if(1===t)return e[0];for(var r=e[e.length-1],a=0;a<e.length-1;++a)r+=n[a]*e[a];return r}function it(e,t,n){if(0===t)return[];if(1===t)return[e];for(var r=new Array(t),a=0;a<r.length-1;++a)r[a]=Math.floor(e/n[a]),e-=r[a]*n[a];return r[r.length-1]=e,r}var ut=function(){function e(e,t){this.backendTimer=e,this.logger=t,null==t&&(this.logger=new ct)}return e.prototype.profileKernel=function(e,t,n){var r,a=this,i=this.backendTimer.time((function(){r=n()}));return r.forEach((function(n){n.data().then((function(r){!function(e,t,n){if("float32"!==t)return!1;for(var r=0;r<e.length;r++){var a=e[r];if(isNaN(a)||!isFinite(a))return console.warn("Found "+a+" in the result of '"+n+"'"),!0}}(r,n.dtype,e),i.then((function(i){var s="";null!=i.getExtraProfileInfo&&(s=i.getExtraProfileInfo()),a.logger.logKernelProfile(e,n,r,i.kernelMs,t,s)}))}))})),r},e}(),ct=function(){function e(){}return e.prototype.logKernelProfile=function(e,t,n,r,a,i){var s="number"==typeof r?N(r+"ms",9):r.error,o=N(e,25),l=t.rank,u=t.size,c=N(t.shape.toString(),14),h="";for(var d in a){var p=a[d].shape||t.shape,f=p.length;h+=d+": "+f+"D "+(f>0?p:"")+" "}console.log("%c"+o+"\t%c"+s+"\t%c"+l+"D "+c+"\t%c"+u+"\t%c"+h+"\t%c"+i,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},e}(),lt=20,ht=3,ft=7;function dt(e,t,n,r){var a=$$1(t),i=function(e,t,n,r){var a=k(t),i=r[r.length-1],s=new Array(i).fill(0),o=t.length,l="complex64"===n?mt(e):e;if(o>1)for(var u=0;u<a/i;u++)for(var c=u*i,h=0;h<i;h++)s[h]=Math.max(s[h],pt(l[c+h],0,n).length);return s}(e,t,n,a),s=t.length,o=function e(t,n,r,a,i,s){void 0===s&&(s=!0);var o="complex64"===r?2:1,l=n[0],u=n.length;if(0===u)return"complex64"===r?[pt(mt(t)[0],0,r)]:"bool"===r?[vt(t[0])]:[t[0].toString()];if(1===u){if(l>lt){var c=ht*o,h=Array.from(t.slice(0,c)),d=Array.from(t.slice((l-ht)*o,l*o));return"complex64"===r&&(h=mt(h),d=mt(d)),["["+h.map((function(e,t){return pt(e,i[t],r)})).join(", ")+", ..., "+d.map((function(e,t){return pt(e,i[l-ht+t],r)})).join(", ")+"]"]}return["["+("complex64"===r?mt(t):Array.from(t)).map((function(e,t){return pt(e,i[t],r)})).join(", ")+"]"]}var p=n.slice(1),f=a.slice(1),m=a[0]*o,g=[];if(l>lt){for(var y=0;y<ht;y++){var v=(b=y*m)+m;g.push.apply(g,e(t.slice(b,v),p,r,f,i,!1))}for(g.push("..."),y=l-ht;y<l;y++)v=(b=y*m)+m,g.push.apply(g,e(t.slice(b,v),p,r,f,i,y===l-1))}else for(y=0;y<l;y++){var b;v=(b=y*m)+m,g.push.apply(g,e(t.slice(b,v),p,r,f,i,y===l-1))}var x=2===u?",":"";for(g[0]="["+g[0]+x,y=1;y<g.length-1;y++)g[y]=" "+g[y]+x;var T=",\n";for(y=2;y<u;y++)T+="\n";return g[g.length-1]=" "+g[g.length-1]+"]"+(s?"":T),g}(e,t,n,a,i),l=["Tensor"];return r&&(l.push("  dtype: "+n),l.push("  rank: "+s),l.push("  shape: ["+t+"]"),l.push("  values:")),l.push(o.map((function(e){return"    "+e})).join("\n")),l.join("\n")}function pt(e,t,n){return N(Array.isArray(e)?parseFloat(e[0].toFixed(ft))+" + "+parseFloat(e[1].toFixed(ft))+"j":H(e)?"'"+e+"'":"bool"===n?vt(e):parseFloat(e.toFixed(ft)).toString(),t)}function vt(e){return 0===e?"false":"true"}function mt(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var gt=function(){function e(e,t,n){var r=this;if(this.dtype=t,this.shape=e.slice(),this.size=k(e),null!=n){var a=n.length;C(a===this.size,(function(){return"Length of values '"+a+"' does not match the size inferred by the shape '"+r.size+"'."}))}if("complex64"===t)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||P(t,this.size),this.strides=$$1(e)}return e.prototype.set=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];0===n.length&&(n=[0]),C(n.length===this.rank,(function(){return"The number of provided coordinates ("+n.length+") must match the rank ("+t.rank+")"}));var a=this.locToIndex(n);this.values[a]=e},e.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];0===e.length&&(e=[0]);for(var n=0,r=0,a=e;r<a.length;r++){var i=a[r];if(i<0||i>=this.shape[n]){var s="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(s)}n++}for(var o=e[e.length-1],l=0;l<e.length-1;++l)o+=this.strides[l]*e[l];return this.values[o]},e.prototype.locToIndex=function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},e.prototype.indexToLoc=function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.toTensor=function(){return yt().makeTensor(this.values,this.shape,this.dtype)},e}(),yt=null,xt=null,bt=null,wt=function(){function e(e,t,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=k(e),this.strides=$$1(e),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}return e.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},e.prototype.asScalar=function(){return this.throwIfDisposed(),C(1===this.size,(function(){return"The array must have only 1 element."})),this.reshape([])},e.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},e.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},e.prototype.as3D=function(e,t,n){return this.throwIfDisposed(),this.reshape([e,t,n])},e.prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),this.reshape([e,t,n,r])},e.prototype.as5D=function(e,t,n,r,a){return this.throwIfDisposed(),this.reshape([e,t,n,r,a])},e.prototype.asType=function(e){return this.throwIfDisposed(),xt.cast(this,e)},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.buffer=function(){return n(this,void 0,void 0,(function(){var e;return r(this,(function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,xt.buffer(this.shape,this.dtype,e)]}}))}))},e.prototype.bufferSync=function(){return xt.buffer(this.shape,this.dtype,this.dataSync())},e.prototype.array=function(){return n(this,void 0,void 0,(function(){var e;return r(this,(function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,J(this.shape,e)]}}))}))},e.prototype.arraySync=function(){return J(this.shape,this.dataSync())},e.prototype.data=function(){return n(this,void 0,void 0,(function(){var e,t;return r(this,(function(n){switch(n.label){case 0:return this.throwIfDisposed(),e=yt().read(this.dataId),"string"!==this.dtype?[3,2]:[4,e];case 1:t=n.sent();try{return[2,t.map((function(e){return ot(e)}))]}catch(r){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}n.label=2;case 2:return[2,e]}}))}))},e.prototype.dataSync=function(){this.throwIfDisposed();var e=yt().readSync(this.dataId);if("string"===this.dtype)try{return e.map((function(e){return ot(e)}))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},e.prototype.bytes=function(){return n(this,void 0,void 0,(function(){var e;return r(this,(function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,yt().read(this.dataId)];case 1:return e=t.sent(),"string"===this.dtype?[2,e]:[2,new Uint8Array(e.buffer)]}}))}))},e.prototype.dispose=function(){this.isDisposed||(yt().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),e.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},e.prototype.toFloat=function(){return this.asType("float32")},e.prototype.toInt=function(){return this.asType("int32")},e.prototype.toBool=function(){return this.asType("bool")},e.prototype.print=function(e){return void 0===e&&(e=!1),xt.print(this,e)},e.prototype.reshape=function(e){return this.throwIfDisposed(),xt.reshape(this,e)},e.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},e.prototype.expandDims=function(e){return void 0===e&&(e=0),xt.expandDims(this,e)},e.prototype.cumsum=function(e,t,n){return void 0===e&&(e=0),void 0===t&&(t=!1),void 0===n&&(n=!1),xt.cumsum(this,e,t,n)},e.prototype.squeeze=function(e){return this.throwIfDisposed(),xt.squeeze(this,e)},e.prototype.clone=function(){return this.throwIfDisposed(),xt.clone(this)},e.prototype.oneHot=function(e,t,n){return this.throwIfDisposed(),xt.oneHot(this,e,t,n)},e.prototype.toString=function(e){return void 0===e&&(e=!1),dt(this.dataSync(),this.shape,this.dtype,e)},e.prototype.tile=function(e){return this.throwIfDisposed(),xt.tile(this,e)},e.prototype.gather=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),xt.gather(this,e,t)},e.prototype.matMul=function(e,t,n){return void 0===t&&(t=!1),void 0===n&&(n=!1),this.throwIfDisposed(),xt.matMul(this,e,t,n)},e.prototype.dot=function(e){return this.throwIfDisposed(),xt.dot(this,e)},e.prototype.norm=function(e,t,n){return void 0===e&&(e="euclidean"),void 0===t&&(t=null),void 0===n&&(n=!1),this.throwIfDisposed(),xt.norm(this,e,t,n)},e.prototype.slice=function(e,t){return this.throwIfDisposed(),xt.slice(this,e,t)},e.prototype.reverse=function(e){return this.throwIfDisposed(),xt.reverse(this,e)},e.prototype.concat=function(t,n){return void 0===n&&(n=0),this.throwIfDisposed(),t instanceof e&&(t=[t]),xt.concat([this].concat(t),n)},e.prototype.split=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),xt.split(this,e,t)},e.prototype.stack=function(e,t){return void 0===t&&(t=0),xt.stack([this,e],t)},e.prototype.unstack=function(e){return void 0===e&&(e=0),xt.unstack(this,e)},e.prototype.pad=function(e,t){return void 0===t&&(t=0),xt.pad(this,e,t)},e.prototype.batchNormalization=function(e,t,n,r,a){return void 0===n&&(n=.001),bt("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,t,a,r,n)},e.prototype.batchNorm=function(e,t,n,r,a){return void 0===a&&(a=.001),this.throwIfDisposed(),xt.batchNorm(this,e,t,n,r,a)},e.prototype.all=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),xt.all(this,e,t)},e.prototype.any=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),xt.any(this,e,t)},e.prototype.logSumExp=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),xt.logSumExp(this,e,t)},e.prototype.sum=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),xt.sum(this,e,t)},e.prototype.prod=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),xt.prod(this,e,t)},e.prototype.mean=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),xt.mean(this,e,t)},e.prototype.min=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),xt.min(this,e,t)},e.prototype.max=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),xt.max(this,e,t)},e.prototype.argMin=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),xt.argMin(this,e)},e.prototype.argMax=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),xt.argMax(this,e)},e.prototype.cast=function(e){return this.throwIfDisposed(),xt.cast(this,e)},e.prototype.add=function(e){return this.throwIfDisposed(),xt.add(this,e)},e.prototype.addStrict=function(e){return this.throwIfDisposed(),xt.addStrict(this,e)},e.prototype.atan2=function(e){return this.throwIfDisposed(),xt.atan2(this,e)},e.prototype.sub=function(e){return this.throwIfDisposed(),xt.sub(this,e)},e.prototype.subStrict=function(e){return this.throwIfDisposed(),xt.subStrict(this,e)},e.prototype.pow=function(e){return this.throwIfDisposed(),xt.pow(this,e)},e.prototype.powStrict=function(e){return this.throwIfDisposed(),xt.powStrict(this,e)},e.prototype.mul=function(e){return this.throwIfDisposed(),xt.mul(this,e)},e.prototype.mulStrict=function(e){return this.throwIfDisposed(),xt.mulStrict(this,e)},e.prototype.div=function(e){return this.throwIfDisposed(),xt.div(this,e)},e.prototype.divNoNan=function(e){return this.throwIfDisposed(),xt.divNoNan(this,e)},e.prototype.floorDiv=function(e){return this.throwIfDisposed(),xt.floorDiv(this,e)},e.prototype.divStrict=function(e){return this.throwIfDisposed(),xt.divStrict(this,e)},e.prototype.minimum=function(e){return this.throwIfDisposed(),xt.minimum(this,e)},e.prototype.minimumStrict=function(e){return this.throwIfDisposed(),xt.minimumStrict(this,e)},e.prototype.maximum=function(e){return this.throwIfDisposed(),xt.maximum(this,e)},e.prototype.maximumStrict=function(e){return this.throwIfDisposed(),xt.maximumStrict(this,e)},e.prototype.mod=function(e){return this.throwIfDisposed(),xt.mod(this,e)},e.prototype.modStrict=function(e){return this.throwIfDisposed(),xt.modStrict(this,e)},e.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),xt.squaredDifferenceStrict(this,e)},e.prototype.transpose=function(e){return this.throwIfDisposed(),xt.transpose(this,e)},e.prototype.notEqual=function(e){return this.throwIfDisposed(),xt.notEqual(this,e)},e.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),xt.notEqualStrict(this,e)},e.prototype.less=function(e){return this.throwIfDisposed(),xt.less(this,e)},e.prototype.lessStrict=function(e){return this.throwIfDisposed(),xt.lessStrict(this,e)},e.prototype.equal=function(e){return this.throwIfDisposed(),xt.equal(this,e)},e.prototype.equalStrict=function(e){return this.throwIfDisposed(),xt.equalStrict(this,e)},e.prototype.lessEqual=function(e){return this.throwIfDisposed(),xt.lessEqual(this,e)},e.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),xt.lessEqualStrict(this,e)},e.prototype.greater=function(e){return this.throwIfDisposed(),xt.greater(this,e)},e.prototype.greaterStrict=function(e){return this.throwIfDisposed(),xt.greaterStrict(this,e)},e.prototype.greaterEqual=function(e){return this.throwIfDisposed(),xt.greaterEqual(this,e)},e.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),xt.greaterEqualStrict(this,e)},e.prototype.logicalAnd=function(e){return this.throwIfDisposed(),xt.logicalAnd(this,e)},e.prototype.logicalOr=function(e){return this.throwIfDisposed(),xt.logicalOr(this,e)},e.prototype.logicalNot=function(){return this.throwIfDisposed(),xt.logicalNot(this)},e.prototype.logicalXor=function(e){return this.throwIfDisposed(),xt.logicalXor(this,e)},e.prototype.where=function(e,t){return this.throwIfDisposed(),xt.where(e,this,t)},e.prototype.neg=function(){return this.throwIfDisposed(),xt.neg(this)},e.prototype.ceil=function(){return this.throwIfDisposed(),xt.ceil(this)},e.prototype.floor=function(){return this.throwIfDisposed(),xt.floor(this)},e.prototype.sign=function(){return this.throwIfDisposed(),xt.sign(this)},e.prototype.isNaN=function(){return this.throwIfDisposed(),xt.isNaN(this)},e.prototype.isInf=function(){return this.throwIfDisposed(),xt.isInf(this)},e.prototype.isFinite=function(){return this.throwIfDisposed(),xt.isFinite(this)},e.prototype.exp=function(){return this.throwIfDisposed(),xt.exp(this)},e.prototype.expm1=function(){return this.throwIfDisposed(),xt.expm1(this)},e.prototype.log=function(){return this.throwIfDisposed(),xt.log(this)},e.prototype.log1p=function(){return this.throwIfDisposed(),xt.log1p(this)},e.prototype.sqrt=function(){return this.throwIfDisposed(),xt.sqrt(this)},e.prototype.rsqrt=function(){return this.throwIfDisposed(),xt.rsqrt(this)},e.prototype.square=function(){return this.throwIfDisposed(),xt.square(this)},e.prototype.reciprocal=function(){return this.throwIfDisposed(),xt.reciprocal(this)},e.prototype.abs=function(){return this.throwIfDisposed(),xt.abs(this)},e.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),xt.clipByValue(this,e,t)},e.prototype.relu=function(){return this.throwIfDisposed(),xt.relu(this)},e.prototype.relu6=function(){return this.throwIfDisposed(),xt.relu6(this)},e.prototype.elu=function(){return this.throwIfDisposed(),xt.elu(this)},e.prototype.selu=function(){return this.throwIfDisposed(),xt.selu(this)},e.prototype.leakyRelu=function(e){return void 0===e&&(e=.2),this.throwIfDisposed(),xt.leakyRelu(this,e)},e.prototype.prelu=function(e){return this.throwIfDisposed(),xt.prelu(this,e)},e.prototype.sigmoid=function(){return this.throwIfDisposed(),xt.sigmoid(this)},e.prototype.logSigmoid=function(){return this.throwIfDisposed(),xt.logSigmoid(this)},e.prototype.softplus=function(){return this.throwIfDisposed(),xt.softplus(this)},e.prototype.zerosLike=function(){return this.throwIfDisposed(),xt.zerosLike(this)},e.prototype.onesLike=function(){return this.throwIfDisposed(),xt.onesLike(this)},e.prototype.sin=function(){return this.throwIfDisposed(),xt.sin(this)},e.prototype.cos=function(){return this.throwIfDisposed(),xt.cos(this)},e.prototype.tan=function(){return this.throwIfDisposed(),xt.tan(this)},e.prototype.asin=function(){return this.throwIfDisposed(),xt.asin(this)},e.prototype.acos=function(){return this.throwIfDisposed(),xt.acos(this)},e.prototype.atan=function(){return this.throwIfDisposed(),xt.atan(this)},e.prototype.sinh=function(){return this.throwIfDisposed(),xt.sinh(this)},e.prototype.cosh=function(){return this.throwIfDisposed(),xt.cosh(this)},e.prototype.tanh=function(){return this.throwIfDisposed(),xt.tanh(this)},e.prototype.asinh=function(){return this.throwIfDisposed(),xt.asinh(this)},e.prototype.acosh=function(){return this.throwIfDisposed(),xt.acosh(this)},e.prototype.atanh=function(){return this.throwIfDisposed(),xt.atanh(this)},e.prototype.erf=function(){return this.throwIfDisposed(),xt.erf(this)},e.prototype.round=function(){return this.throwIfDisposed(),xt.round(this)},e.prototype.step=function(e){return void 0===e&&(e=0),this.throwIfDisposed(),xt.step(this,e)},e.prototype.softmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),xt.softmax(this,e)},e.prototype.logSoftmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),xt.logSoftmax(this,e)},e.prototype.resizeBilinear=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),xt.image.resizeBilinear(this,e,t)},e.prototype.resizeNearestNeighbor=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),xt.image.resizeNearestNeighbor(this,e,t)},e.prototype.conv1d=function(e,t,n,r,a,i){return void 0===r&&(r="NWC"),void 0===a&&(a=1),this.throwIfDisposed(),xt.conv1d(this,e,t,n,r,a,i)},e.prototype.conv2d=function(e,t,n,r,a,i){return void 0===r&&(r="NHWC"),void 0===a&&(a=[1,1]),this.throwIfDisposed(),xt.conv2d(this,e,t,n,r,a,i)},e.prototype.conv2dTranspose=function(e,t,n,r,a){return this.throwIfDisposed(),xt.conv2dTranspose(this,e,t,n,r,a)},e.prototype.depthwiseConv2D=function(e,t,n,r,a,i){return void 0===r&&(r="NHWC"),void 0===a&&(a=[1,1]),this.throwIfDisposed(),xt.depthwiseConv2d(this,e,t,n,r,a,i)},e.prototype.separableConv2d=function(e,t,n,r,a,i){return void 0===a&&(a=[1,1]),void 0===i&&(i="NHWC"),this.throwIfDisposed(),xt.separableConv2d(this,e,t,n,r,a,i)},e.prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),xt.avgPool(this,e,t,n,r)},e.prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),xt.maxPool(this,e,t,n,r)},e.prototype.localResponseNormalization=function(e,t,n,r){return void 0===e&&(e=5),void 0===t&&(t=1),void 0===n&&(n=1),void 0===r&&(r=.5),xt.localResponseNormalization(this,e,t,n,r)},e.prototype.pool=function(e,t,n,r,a){return this.throwIfDisposed(),xt.pool(this,e,t,n,r,a)},e.prototype.variable=function(e,t,n){return void 0===e&&(e=!0),this.throwIfDisposed(),yt().makeVariable(this,e,t,n)},e.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),xt.unsortedSegmentSum(this,e,t)},e.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),xt.batchToSpaceND(this,e,t)},e.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),xt.spaceToBatchND(this,e,t)},e.prototype.topk=function(e,t){return void 0===e&&(e=1),void 0===t&&(t=!0),this.throwIfDisposed(),xt.topk(this,e,t)},e.prototype.stridedSlice=function(e,t,n,r,a,i,s,o){return void 0===r&&(r=0),void 0===a&&(a=0),void 0===i&&(i=0),void 0===s&&(s=0),void 0===o&&(o=0),this.throwIfDisposed(),xt.stridedSlice(this,e,t,n,r,a,i,s,o)},e.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),xt.depthToSpace(this,e,t)},e.prototype.fft=function(){return this.throwIfDisposed(),xt.spectral.fft(this)},e.prototype.ifft=function(){return this.throwIfDisposed(),xt.spectral.ifft(this)},e.prototype.rfft=function(){return this.throwIfDisposed(),xt.spectral.rfft(this)},e.prototype.irfft=function(){return this.throwIfDisposed(),xt.spectral.irfft(this)},e}();Object.defineProperty(wt,Symbol.hasInstance,{value:function(e){return!!e&&null!=e.dataId&&null!=e.shape&&null!=e.dtype}});var Ct,Et,Rt,It,kt,St=function(t){function n(e,n,r,a){var i=t.call(this,e.shape,e.dtype,e.dataId,a)||this;return i.trainable=n,i.name=r,i}return e(n,t),n.prototype.assign=function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value ("+e.dtype+") and previous value ("+this.dtype+") must match");if(!S(e.shape,this.shape))throw new Error("shape of the new value ("+e.shape+") and previous value ("+this.shape+") must match");yt().disposeTensor(this),this.dataId=e.dataId,yt().incRef(this,null)},n.prototype.dispose=function(){yt().disposeVariable(this),this.isDisposedInternal=!0},n}(wt),t2;Object.defineProperty(St,Symbol.hasInstance,{value:function(e){return e instanceof wt&&null!=e.assign&&e.assign instanceof Function}}),t2=Ct||(Ct={}),t2.R0="R0",t2.R1="R1",t2.R2="R2",t2.R3="R3",t2.R4="R4",t2.R5="R5",t2.R6="R6",function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(Et||(Et={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(Rt||(Rt={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(It||(It={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(kt||(kt={}));var At={float32:It,int32:Et,bool:Rt,complex64:kt};function Dt(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast "+e+" with "+t)}return At[e][t]}function Tt(e){return Dt(e,"int32")}function Nt(e,t){if(e.dtype===t.dtype)return[e,t];var n=Dt(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function Ft(e,t){C(e.dtype===t.dtype,(function(){return"The dtypes of the first("+e.dtype+") and second("+t.dtype+") input must match"}))}function _t(e){var t=[];return function e(t,n,r){if(null!=t)if(t instanceof wt)n.push(t);else if(a=t,Array.isArray(a)||"object"==typeof a){var a,i=t;for(var s in i){var o=i[s];r.has(o)||(r.add(o),e(o,n,r))}}}(e,t,new Set),t}var Ot,Bt=function(){function e(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return e.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},e}(),Pt=function(){function e(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Bt}return e.prototype.ready=function(){return n(this,void 0,void 0,(function(){var e,t,n;return r(this,(function(r){switch(r.label){case 0:if(null!=this.pendingBackendInit)return[2,this.pendingBackendInit.then((function(){}))];if(null!=this.backendInstance)return[2];e=this.getSortedBackends(),t=0,r.label=1;case 1:return t<e.length?(n=e[t],[4,this.initializeBackend(n).success]):[3,5];case 2:return r.sent()?[4,this.setBackend(n)]:[3,4];case 3:return r.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}}))}))},Object.defineProperty(e.prototype,"backend",{get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),e.prototype.backendNames=function(){return Object.keys(this.registryFactory)},e.prototype.findBackend=function(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;if(this.initializeBackend(e).asyncInit)return null}return this.registry[e]},e.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},e.prototype.registerBackend=function(e,t,n){return void 0===n&&(n=1),e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)},e.prototype.setBackend=function(e){return n(this,void 0,void 0,(function(){var t,n,a;return r(this,(function(r){switch(r.label){case 0:if(null==this.registryFactory[e])throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,null!=this.registry[e]?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),n=t.success,t.asyncInit?[4,n]:[3,2]);case 1:return a=r.sent(),[3,3];case 2:a=n,r.label=3;case 3:if(!a)return[2,!1];r.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new ut(this.backendInstance),[2,!0]}}))}))},e.prototype.setupRegisteredKernels=function(){var e=this;f(this.backendName).forEach((function(t){null!=t.setupFunc&&t.setupFunc(e.backendInstance)}))},e.prototype.disposeRegisteredKernels=function(e){var t=this;f(e).forEach((function(n){null!=n.disposeFunc&&n.disposeFunc(t.registry[e])}))},e.prototype.initializeBackend=function(e){var t=this,n=this.registryFactory[e];if(null==n)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var r=n.factory();if(Promise.resolve(r)===r){var a=++this.pendingBackendInitId,i=r.then((function(n){return!(a<t.pendingBackendInitId||(t.registry[e]=n,t.pendingBackendInit=null,0))})).catch((function(n){return!(a<t.pendingBackendInitId||(t.pendingBackendInit=null,console.warn("Initialization of backend "+e+" failed"),console.warn(n.stack||n.message),1))}));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}return this.registry[e]=r,{success:!0,asyncInit:!1}}catch(s){return console.warn("Initialization of backend "+e+" failed"),console.warn(s.stack||s.message),{success:!1,asyncInit:!1}}},e.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},e.prototype.getSortedBackends=function(){var e=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority}))},e.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],r=this.initializeBackend(n),a=r.success,i=r.asyncInit;if(i||a)return{name:n,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")},e.prototype.moveData=function(e,t){var n=this.state.tensorInfo.get(t),r=n.backend,a=this.readSync(t);r.disposeData(t),n.backend=e,e.move(t,a,n.shape,n.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},e.prototype.tidy=function(e,t){var n,r=this,a=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}return this.scopedRun((function(){return r.startScope(a)}),(function(){return r.endScope(n)}),(function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n}))},e.prototype.scopedRun=function(e,t,n){e();try{var r=n();return t(),r}catch(a){throw t(),a}},e.prototype.nextTensorId=function(){return e.nextTensorId++},e.prototype.nextVariableId=function(){return e.nextVariableId++},e.prototype.clone=function(e){var t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],(function(e){return{x:function(){return e.toFloat()}}}),[]),t},e.prototype.runKernel=function(e,t,n,r,a){return this.runKernelFunc(null,t,null,e,n,r,a)},e.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},e.prototype.checkKernelForMemLeak=function(e,t,n){var r=this.backend.numDataIds(),a=0;n.forEach((function(e){a+="complex64"===e.dtype?3:1}));var i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=r-t-a-i;if(s>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+s+" data ids) after running '"+e+"'")},e.prototype.runKernelFunc=function(e,t,n,r,a,i,s){var o,u=this;void 0===i&&(i=[]),void 0===s&&(s=[]);var c=[],h=this.isTapeOn();null==r&&(r=null!=this.state.activeScope?this.state.activeScope.name:"");var d,p=function(e){h&&(c=e.map((function(e){return u.keep(u.clone(e))})))},f=this.state.numBytes,m=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var g,y=l(r,this.backendName);return d=null!=y?function(){var e=u.backend.numDataIds();g=y.kernelFunc({inputs:t,attrs:a,backend:u.backend});var n=Array.isArray(g)?g:[g];u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,e,n);var o=n.map((function(e){var t=e.dataId,n=e.shape,r=e.dtype;return u.makeTensorFromDataId(t,n,r)})),l=o.filter((function(e,t){return s[t]}));return p((i||[]).slice().concat(l)),o}:function(){var t=u.backend.numDataIds();g=u.tidy((function(){return e(u.backend,p)}));var n=Array.isArray(g)?g:[g];return u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,t,n),n},this.scopedRun((function(){return u.state.kernelDepth++}),(function(){return u.state.kernelDepth--}),(function(){o=u.ENV.getBool("DEBUG")?u.profiler.profileKernel(r,t,(function(){return d()})):d()})),h&&this.addTapeNode(r,t,o,n,c),this.state.profiling&&this.state.activeProfile.kernels.push({name:r,bytesAdded:this.state.numBytes-f,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-m,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map((function(e){return t[e].shape})),outputShapes:o.map((function(e){return e.shape}))}),Array.isArray(g)?o:o[0]},e.prototype.makeTensor=function(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;var a=e;"string"===n&&H(e[0])&&(a=e.map((function(e){return rt(e)})));var i=r.write(a,t,n),s=new wt(t,n,i,this.nextTensorId());if(this.incRef(s,r),"string"===n){var o=this.state.tensorInfo.get(i),l=G(a);this.state.numBytes+=l-o.bytes,o.bytes=l}return s},e.prototype.makeTensorFromDataId=function(e,t,n,r){var a=new wt(t,n=n||"float32",e,this.nextTensorId());return this.incRef(a,r),a},e.prototype.makeVariable=function(e,t,n,r){void 0===t&&(t=!0),n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.asType(r));var a=new St(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[a.name])throw new Error("Variable with name "+a.name+" was already registered");return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a},e.prototype.incRef=function(e,t){var n=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++,0===n){this.state.numDataBuffers++;var r=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(r=e.size*z(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:r,refCount:0}),this.state.numBytes+=r}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof St||this.track(e)},e.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,"string"===e.dtype&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?("complex64"!==e.dtype&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}},e.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},e.prototype.disposeVariable=function(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]},e.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},e.prototype.profile=function(e){return n(this,void 0,void 0,(function(){var t,n;return r(this,(function(r){return this.state.profiling=!0,t=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map((function(e){return e.totalBytesSnapshot}))),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n,[2,this.state.activeProfile]}))}))},e.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth},e.prototype.addTapeNode=function(e,t,n,r,a){var i=this,s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:a},o=h(e);null!=o&&(r=o.gradFunc),null!=r&&(s.gradient=function(e){return e=e.map((function(e,t){if(null==e){var r=n[t],a=tt(r.size,r.dtype);return i.makeTensor(a,r.shape,r.dtype)}return e})),r(e.length>1?e:e[0],a)}),this.state.activeTape.push(s)},e.prototype.keep=function(e){return e.kept=!0,e},e.prototype.startTape=function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++},e.prototype.endTape=function(){this.state.gradientDepth--},e.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},e.prototype.endScope=function(e){for(var t=this,n=_t(e),r=new Set(n.map((function(e){return e.id}))),a=0;a<this.state.activeScope.track.length;a++){var i=this.state.activeScope.track[a];i.kept||r.has(i.id)||i.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach((function(e){e.kept||e.scopeId!==s.id||t.track(e)}))},e.prototype.gradients=function(e,t,n,r){var a=this;if(void 0===r&&(r=!1),C(t.length>0,(function(){return"gradients() received an empty list of xs."})),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");var i=this.scopedRun((function(){return a.startTape()}),(function(){return a.endTape()}),(function(){return a.tidy("forward",e)}));C(i instanceof wt,(function(){return"The result y returned by f() must be a tensor."}));var s=function(e,t,n){for(var r={},a={},i=0;i<t.length;i++)r[t[i].id]=!0;for(i=0;i<e.length;i++){var s=(f=e[i]).inputs;for(var o in s){for(var l=s[o],u=!1,c=0;c<t.length;c++)if(r[l.id]){f.outputs.forEach((function(e){return r[e.id]=!0})),u=!0,a[f.id]=!0;break}if(u)break}}var h={};h[n.id]=!0;var d={};for(i=e.length-1;i>=0;i--)for(s=(f=e[i]).inputs,c=0;c<f.outputs.length;c++)if(h[f.outputs[c].id]){for(var o in s)h[s[o].id]=!0,d[f.id]=!0;break}var p=[];for(i=0;i<e.length;i++){var f;if(a[(f=e[i]).id]&&d[f.id]){var m={};for(var o in f.inputs){var g=f.inputs[o];r[g.id]&&(m[o]=g)}var y=Object.assign({},f);y.inputs=m,y.outputs=f.outputs,p.push(y)}}return p}(this.state.activeTape,t,i);if(!r&&0===s.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var e,r,o={};o[i.id]=null==n?(r=Z(k(e=i.shape),"float32"),Lt.makeTensor(r,e,"float32")):n,function(e,t,n){for(var r=function(n){var r=t[n],i=[];if(r.outputs.forEach((function(t){var n=e[t.id];null!=n?i.push(n):i.push(null)})),null==r.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+r.kernelName+".");var s=r.gradient(i),o=function(t){if(!(t in s))throw new Error("Cannot backprop through input "+t+". Available gradients found: "+Object.keys(s)+".");var n=function(e){return a.tidy(e)}((function(){return s[t]()}));if("float32"!==n.dtype)throw new Error("Error in gradient for op "+r.kernelName+". The gradient of input "+t+" must have 'float32' dtype, but has '"+n.dtype+"'");var i=r.inputs[t];if(!S(n.shape,i.shape))throw new Error("Error in gradient for op "+r.kernelName+". The gradient of input '"+t+"' has shape '"+n.shape+"', which does not match the shape of the input '"+i.shape+"'");if(null==e[i.id])e[i.id]=n;else{var o=e[i.id];e[i.id]=o.add(n),o.dispose()}};for(var l in r.inputs)o(l)},i=t.length-1;i>=0;i--)r(i)}(o,s);var l=t.map((function(e){return o[e.id]}));return 0===a.state.gradientDepth&&(a.state.activeTape.forEach((function(e){for(var t=0,n=e.saved;t<n.length;t++)n[t].dispose()})),a.state.activeTape=null),{value:i,grads:l}}))},e.prototype.customGrad=function(e){var t=this;return C(X(e),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var n,r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];C(r.every((function(e){return e instanceof wt})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var i={};return r.forEach((function(e,t){i[t]=e})),t.runKernelFunc((function(t,a){return C((n=e.apply(void 0,r.concat([a]))).value instanceof wt,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),C(X(n.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),n.value}),i,(function(e,t){var a=n.gradFunc(e,t),i=Array.isArray(a)?a:[a];C(i.length===r.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),C(i.every((function(e){return e instanceof wt})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var s={};return i.forEach((function(e,t){s[t]=function(){return e}})),s}))}},e.prototype.readSync=function(e){return this.state.tensorInfo.get(e).backend.readSync(e)},e.prototype.read=function(e){return this.state.tensorInfo.get(e).backend.read(e)},e.prototype.time=function(e){return n(this,void 0,void 0,(function(){var t,n;return r(this,(function(r){switch(r.label){case 0:return t=et(),[4,this.backend.time(e)];case 1:return(n=r.sent()).wallMs=et()-t,[2,n]}}))}))},e.prototype.track=function(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(e.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),e.prototype.reset=function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Bt,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},e.nextTensorId=0,e.nextVariableId=0,e}(),Lt=function(){var e,t=function(){if(null==Ot){var e=void 0;if("undefined"!=typeof window)e=window;else if("undefined"!=typeof global)e=global;else if("undefined"!=typeof process)e=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");e=self}Ot=e}return Ot}();if(null==t._tfengine){var n=new o(t);t._tfengine=new Pt(n)}return e=t._tfengine.ENV,s=e,yt=function(){return t._tfengine},t._tfengine}();function Wt(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}var Ut=i();Ut.registerFlag("DEBUG",(function(){return!1}),(function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),Ut.registerFlag("IS_BROWSER",(function(){return Wt()})),Ut.registerFlag("IS_NODE",(function(){return"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node})),Ut.registerFlag("IS_CHROME",(function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),Ut.registerFlag("PROD",(function(){return!1})),Ut.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return Ut.getBool("DEBUG")})),Ut.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),Ut.registerFlag("IS_TEST",(function(){return!1}));var Vt,zt,Gt,Ht={},qt={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function Kt(e,t){Ht[e]=t}function jt(e){e in Ht||(Ht[e]=function(e){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var t=function(e){if("undefined"!=typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e);return t.addEventListener("webglcontextlost",(function(t){t.preventDefault(),delete Ht[e]}),!1),1===e?t.getContext("webgl",qt)||t.getContext("experimental-webgl",qt):t.getContext("webgl2",qt)}(e));var t=Ht[e];return t.isContextLost()?(delete Ht[e],jt(e)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),Ht[e])}function Xt(e,t){return[t,e]}function Yt(e){var t=k(e);return T(Math.ceil(t/4))}function $t(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function Qt(e,t){var n,r,a,s,o,l,u,c,h,d=e;return 2===i().getNumber("WEBGL_VERSION")?(n=d.R32F,r=d.R16F,a=d.RGBA16F,s=d.RGBA32F,o=d.RED,l=4,u=1,c=d.HALF_FLOAT,h=d.FLOAT):(n=e.RGBA,r=e.RGBA,a=e.RGBA,s=d.RGBA,o=e.RGBA,l=4,u=4,c=null!=t?t.HALF_FLOAT_OES:null,h=e.FLOAT),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:a,internalFormatPackedFloat:s,textureFormatFloat:o,downloadTextureFormat:e.RGBA,downloadUnpackNumChannels:l,defaultNumChannels:u,textureTypeHalfFloat:c,textureTypeFloat:h}}function Jt(e,t,n){var r=n();return t&&function(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+ne(e,t))}(e),r}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(Vt||(Vt={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(zt||(zt={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Gt||(Gt={}));var Zt=5.96e-8,te=65504;function ee(e){return!!(i().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||Zt<Math.abs(e)&&Math.abs(e)<te)}function ne(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+t}}function re(e,t,n){return ke(e,t,(function(){return e.getExtension(n)}),'Extension "'+n+'" not supported on this browser.')}function oe(e,t,n){var r=ke(e,t,(function(){return e.createShader(e.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if(Jt(e,t,(function(){return e.shaderSource(r,n)})),Jt(e,t,(function(){return e.compileShader(r)})),!1===e.getShaderParameter(r,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function ae(e,t,n){var r=ke(e,t,(function(){return e.createShader(e.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if(Jt(e,t,(function(){return e.shaderSource(r,n)})),Jt(e,t,(function(){return e.compileShader(r)})),!1===e.getShaderParameter(r,e.COMPILE_STATUS))throw function(e,t){var n=ue.exec(t);if(null==n)return console.log("Couldn't parse line number in error: "+t),void console.log(e);for(var r=+n[1],a=e.split("\n"),i=a.length.toString().length+2,s=a.map((function(e,t){return N((t+1).toString(),i)+e})),o=0,l=0;l<s.length;l++)o=Math.max(s[l].length,o);var u=s.slice(0,r-1),c=s.slice(r-1,r),h=s.slice(r);console.log(u.join("\n")),console.log(t.split("\n")[0]),console.log("%c "+N(c[0],o),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(h.join("\n"))}(n,e.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var ie,se,ue=/ERROR: [0-9]+:([0-9]+):/g;function ce(e,t){return ke(e,t,(function(){return e.createProgram()}),"Unable to create WebGLProgram.")}function le(e,t,n){if(Jt(e,t,(function(){return e.linkProgram(n)})),!1===e.getProgramParameter(n,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(n)),new Error("Failed to link vertex and fragment shaders.")}function he(e,t,n){if(Jt(e,t,(function(){return e.validateProgram(n)})),!1===e.getProgramParameter(n,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(n)),new Error("Shader program validation failed.")}function fe(e,t,n){var r=ke(e,t,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return Jt(e,t,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),Jt(e,t,(function(){return e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW)})),r}function de(e,t,n){var r=ke(e,t,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return Jt(e,t,(function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r)})),Jt(e,t,(function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,n,e.STATIC_DRAW)})),r}function pe(e,t){return ke(e,t,(function(){return e.createTexture()}),"Unable to create WebGLTexture.")}function ve(e,t){var n=i().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){var r="["+e+"x"+t+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n)throw r="["+e+"x"+t+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU ["+n+"x"+n+"].")}function me(e,t){return ke(e,t,(function(){return e.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}function ge(e,t,n,r,a,i,s,o){var l=e.getAttribLocation(n,r);return-1!==l&&(Jt(e,t,(function(){return e.bindBuffer(e.ARRAY_BUFFER,a)})),Jt(e,t,(function(){return e.vertexAttribPointer(l,i,e.FLOAT,!1,s,o)})),Jt(e,t,(function(){return e.enableVertexAttribArray(l)})),!0)}function ye(e,t,n,r){Se(e,r),Jt(e,t,(function(){return e.activeTexture(e.TEXTURE0+r)})),Jt(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,n)}))}function xe(e,t,n,r){return ke(e,t,(function(){return e.getUniformLocation(n,r)}),'uniform "'+r+'" not present in program.')}function be(e,t,n){return e.getUniformLocation(t,n)}function we(e,t,n,r,a,i){Jt(e,t,(function(){return ye(e,t,r,i)})),Jt(e,t,(function(){return e.uniform1i(a,i)}))}function Ce(e,t,n,r){Jt(e,t,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,r)})),Jt(e,t,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)}))}function Ee(e,t,n){Jt(e,t,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)})),Jt(e,t,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)}))}function Re(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+Ie(e,t))}function Ie(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+t}}function ke(e,t,n,r){var a=Jt(e,t,(function(){return n()}));if(null==a)throw new Error(r);return a}function Se(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+n+"].")}function Ae(e,t){return void 0===t&&(t=2),k(e.slice(0,e.length-t))}function De(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function Te(e){var t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[Ae(e)].concat(De(e))),t}function Ne(e,t){var n;void 0===t&&(t=!1);var r=i().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(r*=2,1===(e=e.map((function(t,n){return n>=e.length-2?b(e[n]):e[n]}))).length&&(e=[2,e[0]])),2!==e.length){var a=M(e);e=a.newShape}var s=k(e);if(e.length<=1&&s<=r)return[1,s];if(2===e.length&&e[0]<=r&&e[1]<=r)return e;if(3===e.length&&e[0]*e[1]<=r&&e[2]<=r)return[e[0]*e[1],e[2]];if(3===e.length&&e[0]<=r&&e[1]*e[2]<=r)return[e[0],e[1]*e[2]];if(4===e.length&&e[0]*e[1]*e[2]<=r&&e[3]<=r)return[e[0]*e[1]*e[2],e[3]];if(4===e.length&&e[0]<=r&&e[1]*e[2]*e[3]<=r)return[e[0],e[1]*e[2]*e[3]];if(t){var o=Ae(e),l=2,u=2;return e.length&&(l=(n=De(e))[0],u=n[1]),T(s=o*(l/2)*(u/2)).map((function(e){return 2*e}))}return T(s)}function Fe(e){return e%2==0}function _e(e,t){if(S(e=e.slice(-2),t=t.slice(-2)))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){var n=e.slice(-1)[0],r=t.slice(-1)[0];if(n===r)return!0;if(Fe(n)&&Fe(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&Fe(e[0])&&Fe(t[0])}function Oe(e){if(null==ie){var t=jt(e);ie=t.getParameter(t.MAX_TEXTURE_SIZE)}return ie}function Me(e){if(null==se){var t=jt(e);se=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,se)}function Be(e){if(0===e)return 0;var t=jt(e);return Pe(t,"EXT_disjoint_timer_query_webgl2")&&2===e?2:Pe(t,"EXT_disjoint_timer_query")?1:0}function Pe(e,t){return null!=e.getExtension(t)}function Le(e){try{if(null!=jt(e))return!0}catch(t){return!1}return!1}function We(e){if(0===e)return!1;var t=jt(e);if(1===e){if(!Pe(t,"OES_texture_float"))return!1}else if(!Pe(t,"EXT_color_buffer_float"))return!1;return Ve(t)}function Ue(e){if(0===e)return!1;var t=jt(e);if(1!==e){if(Pe(t,"EXT_color_buffer_float"))return Ve(t);if(Pe(t,"EXT_color_buffer_half_float")){var n=t.getExtension("EXT_color_buffer_half_float");return function(e,t){var n=Qt(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);var a=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,a),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);var i=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(a),i}(t,n)}return!1}return!!Pe(t,"OES_texture_float")&&!!Pe(t,"WEBGL_color_buffer_float")&&Ve(t)}function Ve(e){var t=Qt(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),a}function ze(e){return 2===e&&null!=jt(e).fenceSync}var He=i();function Xe(e){i().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Ze(e,t){return Lt.tidy(e,t)}function tn(e){_t(e).forEach((function(e){return e.dispose()}))}function en(e){return Lt.keep(e)}function dn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];i().getBool("IS_TEST")||console.warn.apply(console,e)}function pn(e,t){var n=e;if(V(e))return"string"===t?[]:[e.length];if(!Array.isArray(e))return[];for(var r=[];Array.isArray(n)||V(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&i().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function e(t,n,r){if(r=r||[],Array.isArray(t)||V(t)){C(n.length>0,(function(){return"Element arr["+r.join("][")+"] should be a primitive, but is an array of "+t.length+" elements"})),C(t.length===n[0],(function(){return"Element arr["+r.join("][")+"] should have "+n[0]+" elements, but has "+t.length+" elements"}));for(var a=n.slice(1),i=0;i<t.length;++i)e(t[i],a,r.concat(i))}else C(0===n.length,(function(){return"Element arr["+r.join("][")+"] is a primitive, but should be an array/TypedArray of "+n[0]+" elements"}))}(e,r,[]),r}function vn(e,t,n,r){if(null!=e&&("numeric"!==e&&e!==t||"numeric"===e&&"string"===t))throw new Error("Argument '"+n+"' passed to '"+r+"' must be "+e+" tensor, but got "+t+" tensor")}function mn(e,t,n,r){if(void 0===r&&(r="numeric"),e instanceof wt)return vn(r,e.dtype,t,n),e;var a=j(e);if("string"!==a&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),vn(r,a,t,n),null==e||!V(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e){var s=null==e?"null":e.constructor.name;throw new Error("Argument '"+t+"' passed to '"+n+"' must be a Tensor or TensorLike, but got '"+s+"'")}var o=pn(e,a);V(e)||Array.isArray(e)||(e=[e]);var l="string"!==a?Q(e,a,i().getBool("DEBUG")):I(e,[],!0);return Lt.makeTensor(l,o,a)}function gn(e,t,n,r){if(void 0===r&&(r="numeric"),!Array.isArray(e))throw new Error("Argument "+t+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");return e.map((function(e,r){return mn(e,t+"["+r+"]",n)}),r)}function yn(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function xn(e,t,n){for(var r=e.length+t.length,a=[],i=0,s=0,o=0;o<r;o++)-1===n.indexOf(o)?a.push(e[i++]):a.push(t[s++]);return a}function bn(e,t){for(var n=[],r=e.length,a=0;a<r;a++)-1===t.indexOf(a)&&n.push(e[a]);return[n,t.map((function(t){return e[t]}))]}function wn(e,t){return xn(e,t.map((function(e){return 1})),t)}function Cn(e,t,n){C(yn(t,n),(function(){return e+" supports only inner-most axes for now. Got axes "+t+" and rank-"+n+" input."}))}function En(e,t){if(yn(e,t))return null;for(var n=[],r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach((function(e){return n.push(e)})),n}function Rn(e){return e.map((function(e,t){return[t,e]})).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}))}function In(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}function kn(e,t){var n=e[0].length;e.forEach((function(e,t){C(e.length===n,(function(){return"Error in concat"+n+"D: rank of tensors["+t+"] must be the same as the rank of the rest ("+n+")"}))})),C(t>=0&&t<n,(function(){return"Error in concat"+n+"D: axis must be between 0 and "+(n-1)+"."}));var r=e[0];e.forEach((function(e,a){for(var i=0;i<n;i++)C(i===t||e[i]===r[i],(function(){return"Error in concat"+n+"D: Shape of tensors["+a+"] ("+e+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+a+"."}))}))}function Sn(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}function An(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));var a=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];Lt.startScope(n);try{var a=r.apply(void 0,e);return a instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),Lt.endScope(a),a}catch(i){throw Lt.endScope(null),i}};return Object.defineProperty(a,"name",{value:n,configurable:!0}),a}He.registerFlag("HAS_WEBGL",(function(){return He.getNumber("WEBGL_VERSION")>0})),He.registerFlag("WEBGL_VERSION",(function(){return Le(2)?2:Le(1)?1:0})),He.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return 2===He.get("WEBGL_VERSION")})),He.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),He.registerFlag("WEBGL_FORCE_F16_TEXTURES",(function(){return!1})),He.registerFlag("WEBGL_PACK",(function(){return He.getBool("HAS_WEBGL")})),He.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return He.getBool("WEBGL_PACK")})),He.registerFlag("WEBGL_PACK_CLIP",(function(){return He.getBool("WEBGL_PACK")})),He.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return!1})),He.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return He.getBool("WEBGL_PACK")})),He.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(function(){return He.getBool("WEBGL_PACK")})),He.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return He.getBool("WEBGL_PACK")})),He.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return He.getBool("WEBGL_PACK")})),He.registerFlag("WEBGL_PACK_REDUCE",(function(){return He.getBool("WEBGL_PACK")})),He.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return He.getBool("WEBGL_PACK")})),He.registerFlag("WEBGL_CONV_IM2COL",(function(){return He.getBool("WEBGL_PACK")})),He.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return Oe(He.getNumber("WEBGL_VERSION"))})),He.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return Me(He.getNumber("WEBGL_VERSION"))})),He.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var e=He.getNumber("WEBGL_VERSION");return 0===e?0:Be(e)})),He.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return He.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(e=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))));var e})),He.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(function(){return We(He.getNumber("WEBGL_VERSION"))})),He.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return!He.getBool("WEBGL_FORCE_F16_TEXTURES")&&He.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")})),He.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return Ue(He.getNumber("WEBGL_VERSION"))})),He.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return ze(He.getNumber("WEBGL_VERSION"))})),He.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){return He.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0})),bt=Xe;var Dn=An({complex_:function(e,t){var n=mn(e,"real","complex"),r=mn(t,"imag","complex");return E(n.shape,r.shape,"real and imag shapes, "+n.shape+" and "+r.shape+", must match in call to tf.complex()."),Lt.runKernelFunc((function(e){return e.complex(n,r)}),{$real:n,$imag:r})}}),Tn=An({real_:function(e){var t=mn(e,"input","real");return Lt.runKernelFunc((function(e){return e.real(t)}),{$input:t})}}),Nn=An({imag_:function(e){var t=mn(e,"input","imag");return Lt.runKernelFunc((function(e){return e.imag(t)}),{$input:t})}});function Fn$1(e,t,n){return _n(e,t,pn(e,n),n)}function _n(e,t,n,r){if(null==r&&(r=j(e)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!V(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){nt(t);var a=k(t),s=k(n);C(a===s,(function(){return"Based on the provided shape, ["+t+"], the tensor should have "+a+" values but has "+s}));for(var o=0;o<n.length;++o){var l=n[o],u=o!==n.length-1||l!==k(t.slice(o));C(n[o]===t[o]||!u,(function(){return"Error creating a new Tensor. Inferred shape ("+n+") does not match the provided shape ("+t+"). "}))}}return V(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==r?Q(e,r,i().getBool("DEBUG")):I(e,[],!0),Lt.makeTensor(e,t,r)}function On(e,t){if((V(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&V(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return _n(e,[],[],t)}function Mn(e,t){R(e);var n=pn(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return _n(e,null,n,t)}function Bn(e,t,n){if(R(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=pn(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return _n(e,t,r,n)}function Pn(e,t,n){if(R(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");var r=pn(e,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return _n(e,t,r,n)}function Ln(e,t,n){if(R(e),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");var r=pn(e,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return _n(e,t,r,n)}function Wn(e,t,n){if(R(e),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");var r=pn(e,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return _n(e,t,r,n)}function Un(e,t,n){if(R(e),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");var r=pn(e,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return _n(e,t=t||r,r,n)}function Vn(e,t,n,r){return void 0===t&&(t=!0),Lt.makeVariable(e,t,n,r)}function zn(e,t){if(void 0===t&&(t="float32"),"complex64"===t){var n=zn(e,"float32"),r=Gn(e,"float32");return Dn(n,r)}var a=Z(k(e),t);return Lt.makeTensor(a,e,t)}function Gn(e,t){if(void 0===t&&(t="float32"),"complex64"===t){var n=Gn(e,"float32"),r=Gn(e,"float32");return Dn(n,r)}var a=tt(k(e),t);return Lt.makeTensor(a,e,t)}function Hn(e,t,n){return Lt.runKernelFunc((function(r){return r.fill(e,t,n)}),{})}function qn(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");return Lt.runKernelFunc((function(r){return r.linspace(e,t,n)}),{})}function Kn(e,t,n,r){if(void 0===n&&(n=1),void 0===r&&(r="float32"),0===n)throw new Error("Cannot have a step of zero");if(e===t||e<t&&n<0||t<e&&n>1)return Gn([0],r);var a=tt(Math.abs(Math.ceil((t-e)/n)),r);t<e&&1===n&&(n=-1),a[0]=e;for(var i=1;i<a.length;i++)a[i]=a[i-1]+n;return Mn(a,r)}var jn=An({onesLike_:function(e){var t=mn(e,"x","onesLike");if("complex64"===t.dtype){var n=jn(Tn(t)),r=Xn(Nn(t));return Dn(n,r)}return Lt.runKernelFunc((function(e){return e.onesLike(t)}),{$x:t},(function(e,t){return{$x:function(){return Xn(e)}}}))}}),Xn=An({zerosLike_:function(e){var t=mn(e,"x","zerosLike");return Lt.runKernelFunc((function(e){return e.zerosLike(t)}),{$x:t},(function(e,t){return{$x:function(){return Xn(e)}}}))}}),Yn=An({concat_:function(e,t){void 0===t&&(t=0),C(e.length>=1,(function(){return"Pass at least one tensor to concat"}));var n=gn(e,"tensors","concat");"complex64"===n[0].dtype&&n.forEach((function(e){if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype "+e.dtype+". ")})),t=O(t,n[0].shape)[0];var r=Sn(n.map((function(e){return e.shape})),t);if(0===k(r))return Fn$1([],r);if(1===(n=n.filter((function(e){return e.size>0}))).length)return n[0];var a=n.map((function(e){return e.shape}));kn(a,t);var i=n,s={axis:t};return Lt.runKernelFunc((function(e){return e.concat(n,t)}),i,(function(e){var n=a.map((function(e){return e[t]}));return tr(e,n,t).map((function(e){return function(){return e}}))}),"Concat",s)}}),$n=An({concat1d_:function(e){return Yn(e,0)}}),Qn=An({concat2d_:function(e,t){return Yn(e,t)}}),Jn=An({concat3d_:function(e,t){return Yn(e,t)}}),Zn=An({concat4d_:function(e,t){return Yn(e,t)}}),tr=An({split_:function(e,t,n){void 0===n&&(n=0);var r,a=mn(e,"x","split");return n=O(n,a.shape)[0],"number"==typeof t?(C(a.shape[n]%t==0,(function(){return"Number of splits must evenly divide the axis."})),r=new Array(t).fill(a.shape[n]/t)):(C(a.shape[n]===t.reduce((function(e,t){return e+t})),(function(){return"The sum of sizes must match the size of the axis dimension."})),r=t),Lt.runKernelFunc((function(e){return e.split(a,r,n)}),{$x:a},(function(e){return{$x:function(){return Yn(e,n)}}}))}});function er(e,t){return e(t={exports:{}},t.exports),t.exports}var nr=er((function(e){!function(e,t,n){function r(e){var t,n=this,r=(t=4022871197,function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)});n.next=function(){var e=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=e-(n.c=0|e)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(e),n.s0<0&&(n.s0+=1),n.s1-=r(e),n.s1<0&&(n.s1+=1),n.s2-=r(e),n.s2<0&&(n.s2+=1),r=null}function a(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function i(e,t){var n=new r(e),i=t&&t.state,s=n.next;return s.int32=function(){return 4294967296*n.next()|0},s.double=function(){return s()+11102230246251565e-32*(2097152*s()|0)},s.quick=s,i&&("object"==typeof i&&a(i,n),s.state=function(){return a(n,{})}),s}t&&t.exports?t.exports=i:this.alea=i}(0,e)})),rr=er((function(e){!function(e,t,n){function r(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function a(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function i(e,t){var n=new r(e),i=t&&t.state,s=function(){return(n.next()>>>0)/4294967296};return s.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},s.int32=n.next,s.quick=s,i&&("object"==typeof i&&a(i,n),s.state=function(){return a(n,{})}),s}t&&t.exports?t.exports=i:this.xor128=i}(0,e)})),or=er((function(e){!function(e,t,n){function r(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function a(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function i(e,t){var n=new r(e),i=t&&t.state,s=function(){return(n.next()>>>0)/4294967296};return s.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},s.int32=n.next,s.quick=s,i&&("object"==typeof i&&a(i,n),s.state=function(){return a(n,{})}),s}t&&t.exports?t.exports=i:this.xorwow=i}(0,e)})),ar=er((function(e){!function(e,t,n){function r(e){var t=this;t.next=function(){var e,n,r=t.x,a=t.i;return e=r[a],n=(e^=e>>>7)^e<<24,n^=(e=r[a+1&7])^e>>>10,n^=(e=r[a+3&7])^e>>>3,n^=(e=r[a+4&7])^e<<7,e=r[a+7&7],n^=(e^=e<<13)^e<<9,r[a]=n,t.i=a+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function a(e,t){return t.x=e.x.slice(),t.i=e.i,t}function i(e,t){null==e&&(e=+new Date);var n=new r(e),i=t&&t.state,s=function(){return(n.next()>>>0)/4294967296};return s.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},s.int32=n.next,s.quick=s,i&&(i.x&&a(i,n),s.state=function(){return a(n,{})}),s}t&&t.exports?t.exports=i:this.xorshift7=i}(0,e)})),ir=er((function(e){!function(e,t,n){function r(e){var t=this;t.next=function(){var e,n,r=t.w,a=t.X,i=t.i;return t.w=r=r+1640531527|0,n=a[i+34&127],e=a[i=i+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=a[i]=n^e,t.i=i,n+(r^r>>>16)|0},function(e,t){var n,r,a,i,s,o=[],l=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,l=Math.max(l,t.length)),a=0,i=-32;i<l;++i)t&&(r^=t.charCodeAt((i+32)%t.length)),0===i&&(s=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,i>=0&&(s=s+1640531527|0,a=0==(n=o[127&i]^=r+s)?a+1:0);for(a>=128&&(o[127&(t&&t.length||0)]=-1),a=127,i=512;i>0;--i)r=o[a+34&127],n=o[a=a+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,o[a]=r^n;e.w=s,e.X=o,e.i=a}(t,e)}function a(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function i(e,t){null==e&&(e=+new Date);var n=new r(e),i=t&&t.state,s=function(){return(n.next()>>>0)/4294967296};return s.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},s.int32=n.next,s.quick=s,i&&(i.X&&a(i,n),s.state=function(){return a(n,{})}),s}t&&t.exports?t.exports=i:this.xor4096=i}(0,e)})),sr$1=er((function(e){!function(e,t,n){function r(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,a=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^a,a=a-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^a,t.a=a-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function a(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function i(e,t){var n=new r(e),i=t&&t.state,s=function(){return(n.next()>>>0)/4294967296};return s.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},s.int32=n.next,s.quick=s,i&&("object"==typeof i&&a(i,n),s.state=function(){return a(n,{})}),s}t&&t.exports?t.exports=i:this.tychei=i}(0,e)})),ur=er((function(e){!function(t,n){var r,a=this,i=256,s="random",o=n.pow(i,6),l=n.pow(2,52),u=2*l,c=i-1;function h(e,c,h){var g=[],y=f(function e(t,n){var r,a=[],i=typeof t;if(n&&"object"==i)for(r in t)try{a.push(e(t[r],n-1))}catch(s){}return a.length?a:"string"==i?t:t+"\0"}((c=1==c?{entropy:!0}:c||{}).entropy?[e,m(t)]:null==e?function(){try{var e;return r&&(e=r.randomBytes)?e=e(i):(e=new Uint8Array(i),(a.crypto||a.msCrypto).getRandomValues(e)),m(e)}catch(o){var n=a.navigator,s=n&&n.plugins;return[+new Date,a,s,a.screen,m(t)]}}():e,3),g),v=new d(g),b=function(){for(var e=v.g(6),t=o,n=0;e<l;)e=(e+n)*i,t*=i,n=v.g(1);for(;e>=u;)e/=2,t/=2,n>>>=1;return(e+n)/t};return b.int32=function(){return 0|v.g(4)},b.quick=function(){return v.g(4)/4294967296},b.double=b,f(m(v.S),t),(c.pass||h||function(e,t,r,a){return a&&(a.S&&p(a,v),e.state=function(){return p(v,{})}),r?(n[s]=e,t):e})(b,y,"global"in c?c.global:this==n,c.state)}function d(e){var t,n=e.length,r=this,a=0,s=r.i=r.j=0,o=r.S=[];for(n||(e=[n++]);a<i;)o[a]=a++;for(a=0;a<i;a++)o[a]=o[s=c&s+e[a%n]+(t=o[a])],o[s]=t;(r.g=function(e){for(var t,n=0,a=r.i,s=r.j,o=r.S;e--;)t=o[a=c&a+1],n=n*i+o[c&(o[a]=o[s=c&s+t])+(o[s]=t)];return r.i=a,r.j=s,n})(i)}function p(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function f(e,t){for(var n,r=e+"",a=0;a<r.length;)t[c&a]=c&(n^=19*t[c&a])+r.charCodeAt(a++);return m(t)}function m(e){return String.fromCharCode.apply(0,e)}if(n["seed"+s]=h,f(n.random(),t),e.exports){e.exports=h;try{r=require("crypto")}catch(g){}}}([],Math)}));ur.alea=nr,ur.xor128=rr,ur.xorwow=or,ur.xorshift7=ar,ur.xor4096=ir,ur.tychei=sr$1;var cr=ur.alea,lr=function(){function e(e,t,n,r,a){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var i=a||Math.random();this.random=cr(i.toString())}return e.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,r=!1;!r;){var a=void 0,i=void 0,s=void 0;do{s=(a=2*this.random()-1)*a+(i=2*this.random()-1)*i}while(s>=1||0===s);var o=Math.sqrt(-2*Math.log(s)/s);t=this.mean+this.stdDev*a*o,n=this.mean+this.stdDev*i*o,this.truncated&&!this.isValidTruncated(t)||(r=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(t)},e.prototype.convertValue=function(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)},e.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},e}(),hr=function(){function e(e,t,n,r){this.alpha=e,this.beta=1/t,this.dtype=n;var a=r||Math.random();this.randu=cr(a.toString()),this.randn=new lr(0,1,n,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}return e.prototype.nextValue=function(){for(var e,t,n,r,a,i;;){do{r=this.randn.nextValue(),i=1+this.c*r}while(i<=0);if(i*=i*i,t=1-.331*(e=r*r)*e,n=.5*e+this.d*(1-i+Math.log(i)),(a=this.randu())<t||Math.log(a)<n)break}return i=1/this.beta*this.d*i,this.alpha<1&&(i*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(i)},e.prototype.convertValue=function(e){return"float32"===this.dtype?e:Math.round(e)},e}(),fr=function(){function e(e,t,n,r){var a=this;if(void 0===e&&(e=0),void 0===t&&(t=1),this.canReturnFloat=function(){return null==a.dtype||"float32"===a.dtype},this.min=e,this.range=t-e,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=cr(r)}return e.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},e.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},e}();function dr(e,t,n){return void 0===t&&(t="float32"),t=t||"float32",nt(e),new gt(e,t,n)}function pr(e,t){void 0===t&&(t=!1),console.log(e.toString(t))}var vr=An({batchToSpaceND_:function(e,t,n){var r=mn(e,"x","batchToSpaceND"),a=t.reduce((function(e,t){return e*t}));return C(r.rank>=1+t.length,(function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+t.length})),C(n.length===t.length,(function(){return"crops.length is "+n.length+" but should be equal to blockShape.length  "+t.length})),C(r.shape[0]%a==0,(function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+t.join(" * ")+" === "+a})),Lt.runKernelFunc((function(e){return e.batchToSpaceND(r,t,n)}),{$x:r},(function(e){return{$x:function(){return e.spaceToBatchND(t,n)}}}))}}),mr=An({broadcastTo_:function(e,t){var n=mn(e,"broadcastTo","x"),r=n.shape;if(t.some((function(e){return!(e>0)||e%1!=0})))throw new Error("broadcastTo(): Invalid broadcast shape ["+t+"].");if(t.length<n.rank)throw new Error("broadcastTo(): shape.length="+t.length+" < input.rank="+n.rank+".");if(t.length>n.rank){for(var a=n.shape.slice();a.length<t.length;)a.unshift(1);n=n.reshape(a)}for(var i=Array.from(t),s=t.length-1;s>=0;s--)if(n.shape[s]===t[s])i[s]=1;else if(1!==n.shape[s])throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+t+"].");var o=i.map((function(e,t){return e>1?t:-1})).filter((function(e){return e>=0}));return 0===o.length?n.clone():Lt.runKernelFunc((function(e){return e.tile(n,i)}),{input:n},(function(e){return{input:function(){return e.sum(o,!0)}}}))}}),gr=An({cast_:function(e,t){var n=mn(e,"x","cast");if(!W(t))throw new Error("Failed to cast to unknown dtype "+t);if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");var r={dtype:t};return Lt.runKernelFunc((function(e){return e.cast(n,t)}),{x:n},(function(e){return{x:function(){return e.clone()}}}),"Cast",r)}}),yr=An({clone_:function(e){var t=mn(e,"x","clone",null);return Lt.runKernelFunc((function(){return Lt.makeTensorFromDataId(t.dataId,t.shape,t.dtype)}),{$x:t},(function(e){return{$x:function(){return e.toFloat()}}}))}}),xr=An({cumsum_:function(e,t,n,r){void 0===t&&(t=0),void 0===n&&(n=!1),void 0===r&&(r=!1);var a=mn(e,"x","cumsum"),i=En([t|=0],a.rank),s=a;null!=i&&(s=a.transpose(i));var o=In(1,a.rank)[0],l=Lt.runKernelFunc((function(e){return e.cumsum(s,o,n,r)}),{permutedX:s},(function(e){return{permutedX:function(){return e.cumsum(t,n,!r)}}}));return null!=i&&(l=l.transpose(i)),l}}),br=An({depthToSpace_:function(e,t,n){void 0===n&&(n="NHWC");var r=mn(e,"x","depthToSpace"),a="NHWC"===n?r.shape[1]:r.shape[2],i="NHWC"===n?r.shape[2]:r.shape[3],s="NHWC"===n?r.shape[3]:r.shape[1];return C(a*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n      "+a+" and "+t+"  for depthToSpace with input shape\n      "+r.shape})),C(i*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n      "+i+" and "+t+" for depthToSpace with input shape\n          "+r.shape})),C(s%(t*t)==0,(function(){return"Dimension size must be evenly divisible by "+t*t+" but is "+s+" for depthToSpace with input shape "+r.shape})),Lt.runKernelFunc((function(e){return e.depthToSpace(r,t,n)}),{$x:r})}}),wr=An({expandDims_:function(e,t){void 0===t&&(t=0);var n=mn(e,"x","expandDims",null);C(t<=n.rank,(function(){return"Axis must be <= rank of the tensor"}));var r=n.shape.slice();return t<0&&(C(-(n.rank+1)<=t,(function(){return"Axis must be in the interval ["+-(n.rank+1)+", "+n.rank+"]"})),t=n.rank+t+1),r.splice(t,0,1),Or(n,r)}}),Cr=An({eye_:function(e,t,n,r){void 0===r&&(r="float32"),null==t&&(t=e);for(var a=dr([e,t],r),i=e<=t?e:t,s=0;s<i;++s)a.set(1,s,s);var o=a.toTensor().as2D(e,t);if(null==n)return o;if(1===n.length)return Lr(wr(o,0),[n[0],1,1]);if(2===n.length)return Lr(wr(wr(o,0),0),[n[0],n[1],1,1]);if(3===n.length)return Lr(wr(wr(wr(o,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+n.length+"D.")}}),Er=An({multinomial_:function(e,t,n,r){void 0===r&&(r=!1);var a=mn(e,"logits","multinomial"),i=a.size,s=a.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+i+".");if(s>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+s);n=n||Math.random();var o=1===s?a.as2D(1,-1):a,l=Lt.runKernelFunc((function(e){return e.multinomial(o,r,t,n)}),{logits2D:o});return 1===s?l.as1D():l}}),Rr=An({oneHot_:function(e,t,n,r){if(void 0===n&&(n=1),void 0===r&&(r=0),t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);var a=mn(e,"indices","oneHot","int32"),i=a.shape.concat([t]);return a=a.flatten(),Lt.runKernelFunc((function(e){return e.oneHot(a,t,n,r)}),{$indices:a},(function(e){return{$indices:function(){return Gn(a.shape,"float32")}}})).reshape(i)}}),Ir=An({pad_:function(e,t,n){void 0===n&&(n=0);var r=mn(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:t,constantValue:n};return Lt.runKernelFunc((function(e){return e.pad(r,t,n)}),{x:r},(function(e){var n=t.map((function(e){return e[0]}));return{x:function(){return e.slice(n,r.shape)}}}),"PadV2",a)}}),kr=An({pad1d_:function(e,t,n){return void 0===n&&(n=0),C(2===t.length,(function(){return"Invalid number of paddings. Must be length of 2."})),Ir(e,[t],n)}}),Sr=An({pad2d_:function(e,t,n){return void 0===n&&(n=0),C(2===t.length&&2===t[0].length&&2===t[1].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),Ir(e,t,n)}}),Ar=An({pad3d_:function(e,t,n){return void 0===n&&(n=0),C(3===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),Ir(e,t,n)}}),Dr=An({pad4d_:function(e,t,n){return void 0===n&&(n=0),C(4===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length&&2===t[3].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),Ir(e,t,n)}}),Tr=An({rand_:function(e,t,n){var r=k(e),a=null;if(null==n||"float32"===n)a=new Float32Array(r);else if("int32"===n)a=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type "+n);a=new Uint8Array(r)}for(var i=0;i<r;i++)a[i]=t();return Lt.makeTensor(a,e,n)}}),Nr=An({randomNormal_:function(e,t,n,r,a){if(void 0===t&&(t=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var i=new lr(t,n,r,!1,a),s=dr(e,r),o=0;o<s.values.length;o++)s.values[o]=i.nextValue();return s.toTensor()}}),Fr=An({randomGamma_:function(e,t,n,r,a){if(void 0===n&&(n=1),void 0===r&&(r="float32"),null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type "+r);for(var i=new hr(t,n,r,a),s=dr(e,r),o=0;o<s.values.length;o++)s.values[o]=i.nextValue();return s.toTensor()}}),_r=An({randomUniform_:function(e,t,n,r,a){void 0===t&&(t=0),void 0===n&&(n=1),void 0===r&&(r="float32");for(var i=dr(e,r),s=new fr(t,n,null,a),o=0;o<i.values.length;o++)i.values[o]=s.nextValue();return i.toTensor()}}),Or=An({reshape_:function(e,t){var n=mn(e,"x","reshape",null);t=_(t,n.size),C(n.size===k(t),(function(){return"new shape and old shape must have the same number of elements."}));var r={shape:t};return Lt.runKernelFunc((function(e){return e.reshape(n,t)}),{x:n},(function(e){return{x:function(){return e.reshape(n.shape)}}}),"Reshape",r)}}),Mr=An({spaceToBatchND_:function(e,t,n){var r=mn(e,"x","spaceToBatchND");return C(r.rank>=1+t.length,(function(){return"input rank "+r.rank+" should be > than [blockShape] "+t.length})),C(n.length===t.length,(function(){return"paddings.shape[0] "+n.length+" must be equal to [blockShape] "+t.length})),C(r.shape.reduce((function(e,r,a){return a>0&&a<=t.length?e&&(r+n[a-1][0]+n[a-1][1])%t[a-1]==0:e}),!0),(function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+n.toString()+" must be divisible by blockShapes "+t.toString()})),Lt.runKernelFunc((function(e){return e.spaceToBatchND(r,t,n)}),{$x:r},(function(e){return{$x:function(){return e.batchToSpaceND(t,n)}}}))}}),Br=An({squeeze_:function(e,t){var n=mn(e,"x","squeeze");return Or(n,M(n.shape,t).newShape)}}),Pr=An({stack_:function(e,t){void 0===t&&(t=0);var n=gn(e,"tensors","stack");if(C(n.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),1===n.length)return n[0].expandDims(t);var r=n[0].rank,a=n[0].shape,i=n[0].dtype;C(t<=r,(function(){return"Axis must be <= rank of the tensor"})),n.forEach((function(e){E(a,e.shape,"All tensors passed to stack must have matching shapes")})),n.forEach((function(e){C(i===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var s=n.map((function(e){return e.expandDims(t)}));return Yn(s,t)}}),Lr=An({tile_:function(e,t){var n=mn(e,"x","tile",null);C(n.rank===t.length,(function(){return"Error in transpose: rank of input "+n.rank+" must match length of reps "+t+"."}));var r=[n],a={reps:t};return Lt.runKernelFunc((function(e,r){var a=e.tile(n,t);return r([n]),a}),{x:n},(function(e,n){var r=n[0];return{x:function(){var n=Xn(r);if(1===r.rank)for(var a=0;a<t[0];++a)n=n.add(e.slice([a*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(a=0;a<t[0];++a)for(var i=0;i<t[1];++i)n=n.add(e.slice([a*r.shape[0],i*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(a=0;a<t[0];++a)for(i=0;i<t[1];++i)for(var s=0;s<t[2];++s)n=n.add(e.slice([a*r.shape[0],i*r.shape[1],s*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+r.rank+" tensors yet.");for(a=0;a<t[0];++a)for(i=0;i<t[1];++i)for(s=0;s<t[2];++s)for(var o=0;o<t[3];++o)n=n.add(e.slice([a*r.shape[0],i*r.shape[1],s*r.shape[2],o*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return n}}}),"Tile",a,r)}}),Wr=An({truncatedNormal_:function(e,t,n,r,a){if(void 0===t&&(t=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var i=new lr(t,n,r,!0,a),s=dr(e,r),o=0;o<s.values.length;o++)s.values[o]=i.nextValue();return s.toTensor()}}),Ur=An({unstack_:function(e,t){void 0===t&&(t=0),t=t||0;var n=mn(e,"x","unstack");C(t>=-n.shape.length&&t<n.shape.length,(function(){return"Axis = "+t+" is not in [-"+n.shape.length+", "+n.shape.length+")"})),t<0&&(t+=n.shape.length);var r={axis:t};return Lt.runKernelFunc((function(e){return e.unstack(n,t)}),{x:n},(function(e){return{x:function(){return Pr(e,t)}}}),"Unpack",r)}}),Vr=function(e,t){return n(this,void 0,void 0,(function(){var n,a,i,s,o,l,u,c,h,d;return r(this,(function(r){switch(r.label){case 0:return n=mn(e,"x","setdiff1d"),a=mn(t,"y","setdiff1d"),C(n.dtype===a.dtype,(function(){return"x and y should have the same dtype, but got x ("+n.dtype+") and y ("+a.dtype+")."})),C(1===n.rank,(function(){return"x should be 1D tensor, but got x ("+n.shape+")."})),C(1===a.rank,(function(){return"y should be 1D tensor, but got y ("+a.shape+")."})),[4,n.data()];case 1:return i=r.sent(),[4,a.data()];case 2:for(s=r.sent(),o=new Set(s),l=0,h=0;h<i.length;h++)o.has(i[h])||l++;for(u=new gt([l],n.dtype),c=new gt([l],"int32"),h=0,d=0;h<i.length;h++)o.has(i[h])||(u.values[d]=i[h],c.values[d]=h,d++);return[2,[u.toTensor(),c.toTensor()]]}}))}))};function zr(e,t,n,r){void 0===r&&(r=!0);var a=[];if(r)(a=a.concat(t.slice(0))).push(e[0]/n),a=a.concat(e.slice(1));else{a=a.concat(e[0]);for(var i=t.length,s=0;s<i;++s)a=a.concat([e[s+1]/t[s],t[s]]);a=a.concat(e.slice(i+1))}return a}function Gr(e,t,n){void 0===n&&(n=!0);var r=[];if(n){r.push(t);for(var a=t+1;a<e;++a)a<=2*t?(r.push(a),r.push(a-(t+1))):r.push(a)}else{var i=[],s=[];for(a=1;a<e;++a)a>=2*t+1||a%2==1?s.push(a):i.push(a);r.push.apply(r,i),r.push(0),r.push.apply(r,s)}return r}function Hr(e,t,n,r){void 0===r&&(r=!0);var a=[];r?a.push(e[0]/n):a.push(e[0]*n);for(var i=1;i<e.length;++i)i<=t.length?r?a.push(t[i-1]*e[i]):a.push(e[i]/t[i-1]):a.push(e[i]);return a}function qr$1(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}function Kr(e,t,n){for(var r=e.slice(0,1),a=0;a<n;++a)r.push(e[a+1]-t[a][0]-t[a][1]);return r}function jr(e,t){if(e.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+e.rank+".");if(t.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.shape[t.rank-1]>e.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+t.shape[t.rank-1]+" vs. "+e.rank);if(0===e.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+e.shape+".");for(var n=t.shape,r=n[n.length-1],a=1,i=0;i<n.length-1;++i)a*=n[i];var s=e.shape,o=n.slice();o.pop();var l=1;for(i=r;i<e.rank;++i)l*=s[i],o.push(s[i]);var u=$$1(e.shape).map((function(e){return e/l})).concat([1]).slice(0,r);return[o,a,l,u]}var Yr=30;function $r(e){return e<=Yr?e:Y(e,Math.floor(Math.sqrt(e)))}function Qr(e,t,n){var r=t.rank>1?t.shape[t.rank-1]:1,a=t.rank>1?t.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+", indices.shape: "+t.shape+", shape: "+e+", sliceDim: "+r+", and batchDim: "+a+".";if(n.rank<a)throw new Error(i+" update.rank < "+a+". ");if(e.length<r+(n.rank-a))throw new Error(i+" Output shape length < "+(r+(n.rank-a)));if(n.rank!==a+e.length-r)throw new Error(i+" update.rank != "+(a+e.length-r));for(var s=0;s<a;++s)if(n.shape[s]!==t.shape[s])throw new Error(i+" updates.shape["+s+"] ("+n.shape[s]+") != indices.shape["+s+"] ("+t.shape[s]+").");for(s=0;s<n.rank-a;++s)if(n.shape[s+a]!==e[s+r])throw new Error(i+" updates.shape["+(s+a)+"] ("+n.shape[s+a]+") != shape["+(s+a)+"] ("+e[s+a]+")")}function Jr(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+e.rank+".");if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+t.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(0===n.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: "+t.shape);if(0===e.size)throw new Error("Updates specified for empty output. updates shape: "+e.shape)}Qr(n,t,e)}function Zr(e,t,n){for(var r=t.shape.length,a=r>1?t.shape[r-1]:1,i=n.length,s=1,o=a;o<i;++o)s*=n[o];var l=a<1?1:a;return{sliceRank:a,numUpdates:k(t.shape)/l,sliceSize:s,strides:$$1(n.slice(0,a)).concat([1]),outputSize:k(n)}}function eo(e,t,n){C(e.rank===t.length,(function(){return"Error in slice"+e.rank+"D: Length of begin "+t+" must match the rank of the array ("+e.rank+")."})),C(e.rank===n.length,(function(){return"Error in slice"+e.rank+"D: Length of size "+n+" must match the rank of the array ("+e.rank+")."}));for(var r=function(r){C(t[r]+n[r]<=e.shape[r],(function(){return"Error in slice"+e.rank+"D: begin["+r+"] + size["+r+"] ("+(t[r]+n[r])+") would overflow input.shape["+r+"] ("+e.shape[r]+")"}))},a=0;a<e.rank;++a)r(a)}function no(e){for(var t=[],n=0;e>0;)1&e&&t.push(n),e/=2,n++;return t}function ro(e,t,n){for(var r=[],a=0;a<e.length;a++)r[a]=Math.ceil((t[a]-e[a])/n[a]);return r}function oo(e,t,n,r,a){var i=t[a],s=n[a]||1;(e&1<<a||null==i)&&(i=s>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var o=r[a];return i<0&&(i+=o),x(0,i,o-1)}function ao(e,t,n,r,a){var i=t[a],s=n[a]||1;(e&1<<a||null==i)&&(i=s>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var o=r[a];return i<0&&(i+=o),s>0?x(0,i,o):x(-1,i,o-1)}function io$1(e,t,n){for(var r=n.length,a=0;a<n.length;a++)if(n[a]>1){r=a;break}for(a=r+1;a<n.length;a++)if(t[a]>0||n[a]!==e[a])return!1;return!0}function so(e,t){for(var n=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function po(e,t){C(X(e),(function(){return"The f passed in variableGrads(f) must be a function"})),C(null==t||Array.isArray(t)&&t.every((function(e){return e instanceof St})),(function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}));var n=null!=t;if(!n)for(var r in t=[],Lt.registeredVariables)t.push(Lt.registeredVariables[r]);var a=n?t.filter((function(e){return!e.trainable})):null,i=t.length;C((t=t.filter((function(e){return e.trainable}))).length>0,(function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+i+" variables is trainable."}));var s=Lt.gradients(e,t,null,!0),o=s.value,l=s.grads;C(l.some((function(e){return null!=e})),(function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."})),C(0===o.rank,(function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+o.rank+" tensor"}));var u={};return t.forEach((function(e,t){null!=l[t]&&(u[e.name]=l[t])})),null!=a&&a.forEach((function(e){return u[e.name]=null})),{value:o,grads:u}}function vo(e){return Lt.customGrad(e)}var go=An({softmax_:function(e,t){void 0===t&&(t=-1);var n=mn(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and dim was "+t);return Lt.runKernelFunc((function(e,r){var a=e.softmax(n,t);return r([a]),a}),{logits:n},(function(e,n){var r=n[0],a=e.mul(r);return{logits:function(){return a.sub(a.sum([t],!0).mul(r))}}}),"Softmax",{dim:t},[],[!0])}}),yo=An({logSoftmax_:function(e,t){void 0===t&&(t=-1);var n=mn(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and axis was "+t);return vo((function(e,n){var r=e.max(t,!0),a=e.sub(r),i=a.toFloat().sub(a.exp().sum(t,!0).log());return n([i]),{value:i,gradFunc:function(e,n){var r=n[0].exp();return e.sub(e.sum(t,!0).mul(r))}}}))(n)}}),xo=function(){function e(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return e.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},e.prototype.set=function(e,t){this.dataIdsCount++,this.data.set(e,t)},e.prototype.has=function(e){return this.data.has(e)},e.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},e.prototype.numDataIds=function(){return this.dataIdsCount},e}(),bo=function(){function e(){}return e.prototype.time=function(e){return wo("time")},e.prototype.read=function(e){return wo("read")},e.prototype.readSync=function(e){return wo("readSync")},e.prototype.numDataIds=function(){return wo("numDataIds")},e.prototype.disposeData=function(e){return wo("disposeData")},e.prototype.write=function(e,t,n){return wo("write")},e.prototype.move=function(e,t,n,r){return wo("move")},e.prototype.memory=function(){return wo("memory")},e.prototype.floatPrecision=function(){return wo("floatPrecision")},e.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},e.prototype.batchMatMul=function(e,t,n,r){return wo("batchMatMul")},e.prototype.fusedBatchMatMul=function(e){return e.a,e.b,e.transposeA,e.transposeB,e.bias,e.activation,e.preluActivationWeights,wo("fusedBatchMatMul")},e.prototype.slice=function(e,t,n){return wo("slice")},e.prototype.stridedSlice=function(e,t,n,r){return wo("stridedSlice")},e.prototype.unstack=function(e,t){return wo("unstack")},e.prototype.reverse=function(e,t){return wo("reverse")},e.prototype.concat=function(e,t){return wo("concat")},e.prototype.neg=function(e){return wo("neg")},e.prototype.add=function(e,t){return wo("add")},e.prototype.addN=function(e){return wo("addN")},e.prototype.subtract=function(e,t){return wo("subtract")},e.prototype.multiply=function(e,t){return wo("multiply")},e.prototype.realDivide=function(e,t){return wo("realDivide")},e.prototype.floorDiv=function(e,t){return wo("floorDiv")},e.prototype.sum=function(e,t){return wo("sum")},e.prototype.prod=function(e,t){return wo("prod")},e.prototype.unsortedSegmentSum=function(e,t,n){return wo("unsortedSegmentSum")},e.prototype.argMin=function(e,t){return wo("argMin")},e.prototype.argMax=function(e,t){return wo("argMax")},e.prototype.equal=function(e,t){return wo("equal")},e.prototype.notEqual=function(e,t){return wo("notEqual")},e.prototype.less=function(e,t){return wo("less")},e.prototype.lessEqual=function(e,t){return wo("lessEqual")},e.prototype.greater=function(e,t){return wo("greater")},e.prototype.greaterEqual=function(e,t){return wo("greaterEqual")},e.prototype.logicalNot=function(e){return wo("logicalNot")},e.prototype.logicalAnd=function(e,t){return wo("logicalAnd")},e.prototype.logicalOr=function(e,t){return wo("logicalOr")},e.prototype.where=function(e){return wo("where")},e.prototype.select=function(e,t,n){return wo("select")},e.prototype.topk=function(e,t,n){return wo("topk")},e.prototype.min=function(e,t){return wo("min")},e.prototype.minimum=function(e,t){return wo("minimum")},e.prototype.mod=function(e,t){return wo("mod")},e.prototype.max=function(e,t){return wo("max")},e.prototype.maximum=function(e,t){return wo("maximum")},e.prototype.all=function(e,t){return wo("all")},e.prototype.any=function(e,t){return wo("any")},e.prototype.squaredDifference=function(e,t){return wo("squaredDifference")},e.prototype.ceil=function(e){return wo("ceil")},e.prototype.floor=function(e){return wo("floor")},e.prototype.round=function(e){return wo("round")},e.prototype.sign=function(e){return wo("sign")},e.prototype.isNaN=function(e){return wo("isNaN")},e.prototype.isInf=function(e){return wo("isInf")},e.prototype.isFinite=function(e){return wo("isFinite")},e.prototype.pow=function(e,t){return wo("pow")},e.prototype.exp=function(e){return wo("exp")},e.prototype.expm1=function(e){return wo("expm1")},e.prototype.softmax=function(e,t){return wo("softmax")},e.prototype.log=function(e){return wo("log")},e.prototype.log1p=function(e){return wo("log1p")},e.prototype.sqrt=function(e){return wo("sqrt")},e.prototype.rsqrt=function(e){return wo("rsqrt")},e.prototype.square=function(e){return wo("square")},e.prototype.reciprocal=function(e){return wo("reciprocal")},e.prototype.relu=function(e){return wo("relu")},e.prototype.relu6=function(e){return wo("relu6")},e.prototype.prelu=function(e,t){return wo("prelu")},e.prototype.elu=function(e){return wo("elu")},e.prototype.eluDer=function(e,t){return wo("eluDer")},e.prototype.selu=function(e){return wo("selu")},e.prototype.int=function(e){return wo("int")},e.prototype.clip=function(e,t,n){return wo("clip")},e.prototype.abs=function(e){return wo("abs")},e.prototype.complexAbs=function(e){return wo("complexAbs")},e.prototype.sigmoid=function(e){return wo("sigmoid")},e.prototype.softplus=function(e){return wo("softplus")},e.prototype.sin=function(e){return wo("sin")},e.prototype.cos=function(e){return wo("cos")},e.prototype.tan=function(e){return wo("tan")},e.prototype.asin=function(e){return wo("asin")},e.prototype.acos=function(e){return wo("acos")},e.prototype.atan=function(e){return wo("atan")},e.prototype.atan2=function(e,t){return wo("atan2")},e.prototype.sinh=function(e){return wo("sinh")},e.prototype.cosh=function(e){return wo("cosh")},e.prototype.tanh=function(e){return wo("tanh")},e.prototype.asinh=function(e){return wo("asinh")},e.prototype.acosh=function(e){return wo("acosh")},e.prototype.atanh=function(e){return wo("atanh")},e.prototype.erf=function(e){return wo("erf")},e.prototype.step=function(e,t){return wo("step")},e.prototype.fusedConv2d=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,wo("fusedConv2d")},e.prototype.conv2d=function(e,t,n){return wo("conv2d")},e.prototype.conv2dDerInput=function(e,t,n){return wo("conv2dDerInput")},e.prototype.conv2dDerFilter=function(e,t,n){return wo("conv2dDerFilter")},e.prototype.fusedDepthwiseConv2D=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,wo("fusedDepthwiseConv2D")},e.prototype.depthwiseConv2D=function(e,t,n){return wo("depthwiseConv2D")},e.prototype.depthwiseConv2DDerInput=function(e,t,n){return wo("depthwiseConv2DDerInput")},e.prototype.depthwiseConv2DDerFilter=function(e,t,n){return wo("depthwiseConv2DDerFilter")},e.prototype.conv3d=function(e,t,n){return wo("conv3d")},e.prototype.conv3dDerInput=function(e,t,n){return wo("conv3dDerInput")},e.prototype.conv3dDerFilter=function(e,t,n){return wo("conv3dDerFilter")},e.prototype.maxPool=function(e,t){return wo("maxPool")},e.prototype.maxPoolBackprop=function(e,t,n,r){return wo("maxPoolBackprop")},e.prototype.avgPool=function(e,t){return wo("avgPool")},e.prototype.avgPoolBackprop=function(e,t,n){return wo("avgPoolBackprop")},e.prototype.avgPool3d=function(e,t){return wo("avgPool3d")},e.prototype.avgPool3dBackprop=function(e,t,n){return wo("avgPool3dBackprop")},e.prototype.maxPool3d=function(e,t){return wo("maxPool3d")},e.prototype.maxPool3dBackprop=function(e,t,n,r){return wo("maxPool3dBackprop")},e.prototype.reshape=function(e,t){return wo("reshape")},e.prototype.cast=function(e,t){return wo("cast")},e.prototype.tile=function(e,t){return wo("tile")},e.prototype.pad=function(e,t,n){return wo("pad")},e.prototype.transpose=function(e,t){return wo("transpose")},e.prototype.gather=function(e,t,n){return wo("gather")},e.prototype.gatherND=function(e,t){return wo("gatherND")},e.prototype.scatterND=function(e,t,n){return wo("scatterND")},e.prototype.batchToSpaceND=function(e,t,n){return wo("batchToSpaceND")},e.prototype.spaceToBatchND=function(e,t,n){return wo("spaceToBatchND")},e.prototype.resizeBilinear=function(e,t,n,r){return wo("resizeBilinear")},e.prototype.resizeBilinearBackprop=function(e,t,n){return wo("resizeBilinearBackprop")},e.prototype.resizeNearestNeighbor=function(e,t,n,r){return wo("resizeNearestNeighbor")},e.prototype.resizeNearestNeighborBackprop=function(e,t,n){return wo("resizeNearestNeighborBackprop")},e.prototype.batchNormalization=function(e,t,n,r,a,i){return wo("batchNormalization")},e.prototype.localResponseNormalization4D=function(e,t,n,r,a){return wo("localResponseNormalization4D")},e.prototype.LRNGrad=function(e,t,n,r,a,i,s){return wo("LRNGrad")},e.prototype.multinomial=function(e,t,n,r){return wo("multinomial")},e.prototype.oneHot=function(e,t,n,r){return wo("oneHot")},e.prototype.cumsum=function(e,t,n,r){return wo("cumsum")},e.prototype.nonMaxSuppression=function(e,t,n,r,a){return wo("nonMaxSuppression")},e.prototype.fft=function(e){return wo("fft")},e.prototype.ifft=function(e){return wo("ifft")},e.prototype.complex=function(e,t){return wo("complex")},e.prototype.real=function(e){return wo("real")},e.prototype.imag=function(e){return wo("imag")},e.prototype.cropAndResize=function(e,t,n,r,a,i){return wo("cropAndResize")},e.prototype.depthToSpace=function(e,t,n){return wo("depthToSpace")},e.prototype.split=function(e,t,n){return wo("split")},e.prototype.sparseToDense=function(e,t,n,r){return wo("sparseToDense")},e.prototype.diag=function(e){return wo("diag")},e.prototype.fill=function(e,t,n){return wo("fill")},e.prototype.onesLike=function(e){return wo("onesLike")},e.prototype.zerosLike=function(e){return wo("zerosLike")},e.prototype.linspace=function(e,t,n){return wo("linspace")},e.prototype.dispose=function(){return wo("dispose")},e}();function wo(e){throw new Error("'"+e+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function Co(e,t){for(var n=e.length,r=[],a=0;a<n;a++){var i=n-1-a,s=e[i]||1;(t[t.length-1-a]||1)>1&&1===s&&r.unshift(i)}return r}function Eo(e,t){for(var n=[],r=0;r<t.length;r++){var a=e[e.length-r-1],i=t.length-r-1,s=t[i];(null==a||1===a&&s>1)&&n.unshift(i)}return n}function Ro(e,t){for(var n=[],r=Math.max(e.length,t.length),a=0;a<r;a++){var i=e[e.length-a-1];null==i&&(i=1);var s=t[t.length-a-1];if(null==s&&(s=1),1===i)n.unshift(s);else if(1===s)n.unshift(i);else{if(i!==s)throw Error("Operands could not be broadcast together with shapes "+e+" and "+t+".");n.unshift(i)}}return n}function Io(e,t,n,r,a,i,s){void 0===s&&(s="channelsLast");var o,l=To(t),u=l[0],c=l[1];if("channelsLast"===s)o=[u,c,e[3],e[3]];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);o=[u,c,e[1],e[1]]}return So(e,o,n,r,a,i,!1,s)}function ko(e,t,n,r,a,i,s){void 0===s&&(s="NDHWC");var o,l,u=No(t),c=u[0],h=u[1],d=u[2];if("NDHWC"===s)l="channelsLast",o=[c,h,d,e[4],e[4]];else{if("NCDHW"!==s)throw new Error("Unknown dataFormat "+s);l="channelsFirst",o=[c,h,d,e[1],e[1]]}return Ao(e,o,n,r,a,!1,l,i)}function So(e,t,n,r,a,i,s,o){void 0===s&&(s=!1),void 0===o&&(o="channelsLast");var l=[-1,-1,-1,-1],u=l[0],c=l[1],h=l[2],d=l[3];if("channelsLast"===o)u=e[0],c=e[1],h=e[2],d=e[3];else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat "+o);u=e[0],d=e[1],c=e[2],h=e[3]}var p,f=t[0],m=t[1],g=t[3],y=To(n),v=y[0],b=y[1],x=To(r),T=x[0],_=x[1],w=Fo(f,T),S=Fo(m,_),E=function(e,t,n,r,a,i,s,o){var l,u,c;if("number"==typeof e){l={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};var h=function(e,t,n,r,a){null==r&&(r=Do(e,t,n));var i=e[1],s=_o((e[0]-t+2*r)/n+1,a);C(A(s),(function(){return"The output # of rows ("+s+") must be an integer. Change the stride and/or zero pad parameters"}));var o=_o((i-t+2*r)/n+1,a);return C(A(o),(function(){return"The output # of columns ("+o+") must be an integer. Change the stride and/or zero pad parameters"})),[s,o]}([t,n],i,r,e,o);u=h[0],c=h[1]}else if("same"===e){u=Math.ceil(t/r),c=Math.ceil(n/a);var d=Math.max(0,(u-1)*r+i-t),p=Math.max(0,(c-1)*a+s-n),f=Math.floor(d/2),m=d-f,g=Math.floor(p/2);l={top:f,bottom:m,left:g,right:p-g,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);l={top:0,bottom:0,left:0,right:0,type:"VALID"},u=Math.ceil((t-i+1)/r),c=Math.ceil((n-s+1)/a)}return{padInfo:l,outHeight:u,outWidth:c}}(a,c,h,v,b,w,S,i),k=E.padInfo,I=E.outHeight,N=E.outWidth,$=s?g*d:g;return"channelsFirst"===o?p=[u,$,I,N]:"channelsLast"===o&&(p=[u,I,N,$]),{batchSize:u,dataFormat:o,inHeight:c,inWidth:h,inChannels:d,outHeight:I,outWidth:N,outChannels:$,padInfo:k,strideHeight:v,strideWidth:b,filterHeight:f,filterWidth:m,effectiveFilterHeight:w,effectiveFilterWidth:S,dilationHeight:T,dilationWidth:_,inShape:e,outShape:p,filterShape:t}}function Ao(e,t,n,r,a,i,s,o){void 0===i&&(i=!1),void 0===s&&(s="channelsLast");var l=[-1,-1,-1,-1,-1],u=l[0],c=l[1],h=l[2],d=l[3],p=l[4];if("channelsLast"===s)u=e[0],c=e[1],h=e[2],d=e[3],p=e[4];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);u=e[0],p=e[1],c=e[2],h=e[3],d=e[4]}var f,m=t[0],g=t[1],y=t[2],v=t[4],b=No(n),x=b[0],T=b[1],_=b[2],w=No(r),S=w[0],E=w[1],k=w[2],I=Fo(m,S),N=Fo(g,E),$=Fo(y,k),D=function(e,t,n,r,a,i,s,o,l,u,c){var h,d,p,f;if("number"==typeof e){h={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};var m=function(e,t,n,r,a,i){null==a&&(a=Do(e,t,r));var s=e[1],o=e[2],l=_o((e[0]-t+2*a)/r+1,i);C(A(l),(function(){return"The output # of depths ("+l+") must be an integer. Change the stride and/or zero pad parameters"}));var u=_o((s-t+2*a)/r+1,i);C(A(u),(function(){return"The output # of rows ("+u+") must be an integer. Change the stride and/or zero pad parameters"}));var c=_o((o-t+2*a)/r+1,i);return C(A(c),(function(){return"The output # of columns ("+c+") must be an integer. Change the stride and/or zero pad parameters"})),[l,u,c,1]}([t,n,r,1],o,0,a,e,c);d=m[0],p=m[1],f=m[2]}else if("same"===e){var g=((d=Math.ceil(t/a))-1)*a+o-t,y=((p=Math.ceil(n/i))-1)*i+l-n,v=((f=Math.ceil(r/s))-1)*s+u-r,b=Math.floor(g/2),x=g-b,T=Math.floor(y/2),_=y-T,w=Math.floor(v/2);h={top:T,bottom:_,left:w,right:v-w,front:b,back:x,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);h={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},d=Math.ceil((t-o+1)/a),p=Math.ceil((n-l+1)/i),f=Math.ceil((r-u+1)/s)}return{padInfo:h,outDepth:d,outHeight:p,outWidth:f}}(a,c,h,d,x,T,_,I,N,$,o),P=D.padInfo,R=D.outDepth,M=D.outHeight,O=D.outWidth,F=i?v*p:v;return"channelsFirst"===s?f=[u,F,R,M,O]:"channelsLast"===s&&(f=[u,R,M,O,F]),{batchSize:u,dataFormat:s,inDepth:c,inHeight:h,inWidth:d,inChannels:p,outDepth:R,outHeight:M,outWidth:O,outChannels:F,padInfo:P,strideDepth:x,strideHeight:T,strideWidth:_,filterDepth:m,filterHeight:g,filterWidth:y,effectiveFilterDepth:I,effectiveFilterHeight:N,effectiveFilterWidth:$,dilationDepth:S,dilationHeight:E,dilationWidth:k,inShape:e,outShape:f,filterShape:t}}function Do(e,t,n,r){void 0===r&&(r=1);var a=Fo(t,r);return Math.floor((e[0]*(n-1)-n+a)/2)}function To(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function No(e){return"number"==typeof e?[e,e,e]:e}function Fo(e,t){return t<=1?e:e+(e-1)*(t-1)}function _o(e,t){if(!t)return e;switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode "+t)}}function Oo(e){var t=To(e),n=t[0],r=t[1],a=t[2];return 1===n&&1===r&&1===a}function Mo(e,t){return Oo(e)||Oo(t)}function Bo(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat "+e)}function Po(e,t,n){if("complex64"===t){if("complex64"===e.dtype)return e.clone();var r=Gn(e.shape),a=e.toFloat(),i=n.complex(a,r);return r.dispose(),a.dispose(),i}if(!U(e.dtype,t))return Lt.makeTensorFromDataId(e.dataId,e.shape,t);if("complex64"===e.dtype){var s=n.real(e);return i=s.cast(t),s.dispose(),i}if("int32"===t)return n.int(e);if("bool"===t){var o=On(0,e.dtype);return i=n.notEqual(e,o),o.dispose(),i}throw new Error("Error in Cast: failed to cast "+e.dtype+" to "+t)}function Lo(e,t){return Lt.makeTensorFromDataId(e.dataId,t,e.dtype)}function Wo(e,t,n){var r=(t-e)/(n-1),a=tt(n,"float32");a[0]=e;for(var i=1;i<a.length;i++)a[i]=a[i-1]+r;return Mn(a,"float32")}function Vo(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+e.length+", imag: "+t.length+".");for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function zo(e,t){return{real:e[2*t],imag:e[2*t+1]}}function Go(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function Ho(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}function qo(e,t,n){var r=function(e,t,n){for(var r=0,a=e.length,i=0,s=!1;r<a;){var o=n(t,e[i=r+(a-r>>>1)]);o>0?r=i+1:(a=i,s=!o)}return s?r:-r-1}(e,t,n||Ko),a=r<0?-(r+1):r;e.splice(a,0,t)}function Ko(e,t){return e>t?1:e<t?-1:0}function jo(e,t,n,r,a){return Yo(e,t,n,r,a,0).selectedIndices}function Xo(e,t,n,r,a,i){var s=Yo(e,t,n,r,a,i);return s.numValidOutputs.dispose(),{selectedIndices:s.selectedIndices,selectedScores:s.selectedScores}}function Yo(e,t,n,r,a,i,s,o){void 0===o&&(o=!1);for(var l=Array.from(t).map((function(e,t){return{score:e,boxIndex:t,suppressBeginIndex:0}})).filter((function(e){return e.score>a})).sort(Jo),u=i>0?-.5/i:0,c=[],h=[];c.length<n&&l.length>0;){var d=l.pop(),p=d.score,f=d.boxIndex,m=d.suppressBeginIndex;if(p<a)break;for(var g=!1,y=c.length-1;y>=m;--y){var v=$o(e,f,c[y]);if(v>=r){g=!0;break}if(d.score=d.score*Qo(r,u,v),d.score<=a)break}d.suppressBeginIndex=c.length,g||(d.score===p?(c.push(f),h.push(d.score)):d.score>a&&qo(l,d,Jo))}var b=c.length;return o&&(c.fill(0,b),h.fill(0,b)),{selectedIndices:Mn(c,"int32"),selectedScores:Mn(h,"float32"),numValidOutputs:On(b,"int32")}}function $o(e,t,n){var r=e.subarray(4*t,4*t+4),a=e.subarray(4*n,4*n+4),i=Math.min(r[0],r[2]),s=Math.min(r[1],r[3]),o=Math.max(r[0],r[2]),l=Math.max(r[1],r[3]),u=Math.min(a[0],a[2]),c=Math.min(a[1],a[3]),h=Math.max(a[0],a[2]),d=Math.max(a[1],a[3]),p=(o-i)*(l-s),f=(h-u)*(d-c);if(p<=0||f<=0)return 0;var m=Math.max(i,u),g=Math.max(s,c),y=Math.min(o,h),v=Math.min(l,d),b=Math.max(y-m,0)*Math.max(v-g,0);return b/(p+f-b)}function Qo(e,t,n){var r=Math.exp(t*n*n);return n<=e?r:0}function Jo(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}function Zo(e,t,n){var r=new Array(e.rank).fill(0),a=e.shape.slice();return t.map((function(t){a[n]=t;var i=e.slice(r,a);return r[n]+=t,i}))}function ta(e,t){for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];var a=dr(n,e.dtype);for(r=0;r<a.values.length;++r){for(var i=a.indexToLoc(r),s=new Array(e.rank),o=0;o<s.length;o++)s[o]=i[o]%e.shape[o];var l=e.locToIndex(s);a.values[r]=e.values[l]}return a.toTensor()}function ea(e,t,n,r,a){for(var i=t[t.length-1],s=[e.length/i,i],o=s[0],l=s[1],u=B(n,o*r),c=B("int32",o*r),h=0;h<o;h++){for(var d=h*l,p=e.subarray(d,d+l),f=[],m=0;m<p.length;m++)f.push({value:p[m],index:m});f.sort((function(e,t){return t.value-e.value}));var g=h*r,y=u.subarray(g,g+r),v=c.subarray(g,g+r);for(m=0;m<r;m++)y[m]=f[m].value,v[m]=f[m].index}var b=t.slice();return b[b.length-1]=r,[Fn$1(u,b,n),Fn$1(c,b,"int32")]}function na(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);var a=dr(e,"int32"),i=dr([n.length,e.length],"int32");for(r=0;r<n.length;r++){var s=a.indexToLoc(n[r]),o=r*e.length;i.values.set(s,o)}return i.toTensor()}var ra=function(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((function(e,t){return"T"+t}));var n=[];this.variableNames.forEach((function(e){n.push("float v"+e+" = get"+e+"AtOutCoords();")}));var r=this.variableNames.map((function(e){return"v"+e})).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        float result = "+r+";\n        setOutput(result);\n      }\n    "},oa=function(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((function(e,t){return"T"+t}));var n=[];this.variableNames.forEach((function(e){n.push("vec4 v"+e+" = get"+e+"AtOutCoords();")}));var r=this.variableNames.map((function(e){return"v"+e})).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        vec4 result = "+r+";\n        setOutput(result);\n      }\n    "},aa=function(e,t,n){this.variableNames=["A"];var r=e.windowSize,a=e.batchSize,i=e.inSize,s=Math.ceil(i/r);n||this.variableNames.push("bestIndicesA"),this.outputShape=[a,s];var o="max"===t?">":"<",l=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+r+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+r+"; i++) {\n          int inIdx = "+l+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+o+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "};function ia(e,t){return["x","y","z","w","u","v"].slice(0,t).map((function(t){return e+"."+t}))}function sa(e,t){return 1===t?[e]:ia(e,t)}function ua(){var e,t,n,r,a,s,o,l,u,c;return 2===i().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",a="texture",s="outputColor",o="out vec4 outputColor;",l="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",u="",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",a="texture2D",s="gl_FragColor",o="",l="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:a,output:s,defineOutput:o,defineSpecialNaN:l,defineSpecialInf:u,defineRound:c}}function ca(e,t,n){void 0===n&&(n="index");var r=$$1(t);return r.map((function(t,a){return"int "+e[a]+" = "+n+" / "+t+"; "+(a===r.length-1?"int "+e[a+1]+" = "+n+" - "+e[a]+" * "+t:"index -= "+e[a]+" * "+t)+";"})).join("")}function la(e){var t=$$1(e).map((function(e){return e.toString()}));return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * "+t[0]+" + coords.y * "+t[1]+" + coords.z;\n  }\n"}var ha="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n";function fa(e,t,n,r){var a=[];e.forEach((function(e){var t=k(e.shapeInfo.logicalShape);e.shapeInfo.isUniform?a.push("uniform float "+e.name+(t>1?"["+t+"]":"")+";"):(a.push("uniform sampler2D "+e.name+";"),a.push("uniform int offset"+e.name+";"))}));var i,s,o=a.join("\n"),l=e.map((function(e){return function(e,t,n){void 0===n&&(n=!1);var r="";r+=n?pa(e):da(e);var a=e.shapeInfo.logicalShape,i=t.logicalShape;return a.length<=i.length&&(r+=n?function(e,t){var n,r=e.name,a=r.charAt(0).toUpperCase()+r.slice(1),i="get"+a+"AtOutCoords",s=e.shapeInfo.logicalShape.length,o=t.logicalShape.length,l=Co(e.shapeInfo.logicalShape,t.logicalShape),u=wa(o),c=o-s,h=["x","y","z","w","u","v"];n=0===s?"":o<2&&l.length>=1?"coords = 0;":l.map((function(e){return"coords."+h[e+c]+" = 0;"})).join("\n");var d;d=o<2&&s>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords."+h[t+c]})).join(", ");var p="return outputValue;",f=1===k(e.shapeInfo.logicalShape),m=1===k(t.logicalShape);if(1!==s||f||m){if(f&&!m)p=1===o?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(l.length){var g=s-2,y=s-1;l.indexOf(g)>-1&&l.indexOf(y)>-1?p="return vec4(outputValue.x);":l.indexOf(g)>-1?p="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":l.indexOf(y)>-1&&(p="return vec4(outputValue.xx, outputValue.zz);")}}else p="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 "+i+"() {\n      "+u+" coords = getOutputCoords();\n      "+n+"\n      vec4 outputValue = get"+a+"("+d+");\n      "+p+"\n    }\n  "}(e,t):function(e,t){var n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),a="get"+r+"AtOutCoords",i=t.texShape,s=e.shapeInfo.texShape,o=e.shapeInfo.logicalShape.length,l=t.logicalShape.length;if(!e.shapeInfo.isUniform&&o===l&&null==e.shapeInfo.flatOffset&&S(s,i))return"\n      float "+a+"() {\n        return sampleTexture("+n+", resultUV);\n      }\n    ";var u=wa(l),c=Co(e.shapeInfo.logicalShape,t.logicalShape),h=l-o,d=["x","y","z","w","u","v"];return"\n    float "+a+"() {\n      "+u+" coords = getOutputCoords();\n      "+(0===o?"":l<2&&c.length>=1?"coords = 0;":c.map((function(e){return"coords."+d[e+h]+" = 0;"})).join("\n"))+"\n      return get"+r+"("+(l<2&&o>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords."+d[t+h]})).join(", "))+");\n    }\n  "}(e,t)),r}(e,t,r)})).join("\n"),u=t.texShape,c=ua(),h="\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return "+c.texture2D+"(textureSampler, uv).r;\n    }\n  ",d=function(e){return e.version+"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    "+e.varyingFs+" vec2 resultUV;\n    "+e.defineOutput+"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    "+e.defineSpecialNaN+"\n    "+e.defineSpecialInf+"\n    "+e.defineRound+"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    "+va+"\n    "+ma+"\n    "+ga+"\n  "}(c);return t.isPacked?(i=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return n=t,1===(r=[Math.ceil(n[0]/2),Math.ceil(n[1]/2)])[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+r[1]+".0);\n      }\n    ":1===r[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+r[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+r[0]+", "+r[1]+"));\n      return 2 * (resTexRC.x * "+r[1]+" + resTexRC.y);\n    }\n  ";case 2:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(S(e,t))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+n[0]+", "+n[1]+"));\n      }\n    ";var r=Math.ceil(e[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}(e,t);case 3:return a=e,i=t,s=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],l=(o=Math.ceil(a[2]/2))*Math.ceil(a[1]/2),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+s[0]+", "+s[1]+"));\n      int index = resTexRC.x * "+s[1]+" + resTexRC.y;\n\n      int b = index / "+l+";\n      index -= b * "+l+";\n\n      int r = 2 * (index / "+o+");\n      int c = imod(index, "+o+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";default:return function(e,t){for(var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[e.length-1]/2),a=r*Math.ceil(e[e.length-2]/2),i=a,s="",o="b, r, c",l=2;l<e.length-1;l++)s="\n      int b"+l+" = index / "+(i*=e[e.length-l-1])+";\n      index -= b"+l+" * "+i+";\n    "+s,o="b"+l+", "+o;return"\n    ivec"+e.length+" getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n\n      "+s+"\n\n      int b = index / "+a+";\n      index -= b * "+a+";\n\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec"+e.length+"("+o+");\n    }\n  "}(e,t)}var n,r,a,i,s,o,l}(t.logicalShape,u),s=function(e){return"\n    void setOutput(vec4 val) {\n      "+e.output+" = val;\n    }\n  "}(c)):(i=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return 1===(n=t)[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+n[1]+".0);\n      }\n    ":1===n[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+n[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      return resTexRC.x * "+n[1]+" + resTexRC.y;\n    }\n  ";case 2:return function(e,t){return S(e,t)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+t[0]+", "+t[1]+"));\n      }\n    ":1===e[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+t[0]+", "+t[1]+"));\n        int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===e[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+t[0]+", "+t[1]+"));\n        int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      int r = index / "+e[1]+";\n      int c = index - r * "+e[1]+";\n      return ivec2(r, c);\n    }\n  "}(e,t);case 3:return r=t,a=ca(["r","c","d"],e),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+r[0]+", "+r[1]+"));\n      int index = resTexRC.x * "+r[1]+" + resTexRC.y;\n      "+a+"\n      return ivec3(r, c, d);\n    }\n  ";case 4:return function(e,t){var n=ca(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      "+n+"\n      return ivec4(r, c, d, d2);\n    }\n  "}(e,t);case 5:return function(e,t){var n=ca(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+t[0]+",\n                             "+t[1]+"));\n\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}(e,t);case 6:return function(e,t){var n=ca(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}(e,t);default:throw new Error(e.length+"-D output sampling is not yet supported")}var n,r,a}(t.logicalShape,u),s=function(e){return"\n    void setOutput(float val) {\n      "+e.output+" = vec4(val, 0, 0, 0);\n    }\n  "}(c)),r&&(d+=ya),[d,h,s,o,i,l,n].join("\n")}function da(e){var t=e.shapeInfo.logicalShape;switch(t.length){case 0:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"float "+n+"() {return "+t+";}";var r=e.shapeInfo.texShape,a=r[0],i=r[1];if(1===a&&1===i)return"\n      float "+n+"() {\n        return sampleTexture("+t+", halfCR);\n      }\n    ";var s=e.shapeInfo.texShape;return"\n    float "+n+"() {\n      vec2 uv = uvFromFlat("+s[0]+", "+s[1]+", "+xa(t)+");\n      return sampleTexture("+t+", uv);\n    }\n  "}(e);case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"\n      float "+n+"(int index) {\n        "+ba(e)+"\n      }\n    ";var r=e.shapeInfo.texShape,a=r[0],i=r[1];if(1===i&&1===a)return"\n      float "+n+"(int index) {\n        return sampleTexture("+t+", halfCR);\n      }\n    ";var s=xa(t);return 1===i?"\n      float "+n+"(int index) {\n        vec2 uv = vec2(0.5, (float(index + "+s+") + 0.5) / "+a+".0);\n        return sampleTexture("+t+", uv);\n      }\n    ":1===a?"\n      float "+n+"(int index) {\n        vec2 uv = vec2((float(index + "+s+") + 0.5) / "+i+".0, 0.5);\n        return sampleTexture("+t+", uv);\n      }\n    ":"\n    float "+n+"(int index) {\n      vec2 uv = uvFromFlat("+a+", "+i+", index + "+s+");\n      return sampleTexture("+t+", uv);\n    }\n  "}(e);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape;if(null!=a&&S(t,a)){var i=a[0];return"\n    float "+r+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+a[1]+".0, "+i+".0);\n      return sampleTexture("+n+", uv);\n    }\n  "}var s=M(t),o=s.newShape,l=s.keptDims,u=o;if(u.length<t.length)return"\n      "+da(Ca(e,u))+"\n      float "+r+"(int row, int col) {\n        return "+r+"("+Ea(["row","col"],l)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2("+t[1]+", 1)));\n        "+ba(e)+"\n      }\n    ";var c=a[0],h=a[1],d=xa(n);return 1===h?"\n    float "+r+"(int row, int col) {\n      float index = dot(vec3(row, col, "+d+"), vec3("+t[1]+", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+c+".0);\n      return sampleTexture("+n+", uv);\n    }\n  ":1===c?"\n    float "+r+"(int row, int col) {\n      float index = dot(vec3(row, col, "+d+"), vec3("+t[1]+", 1, 1));\n      vec2 uv = vec2((index + 0.5) / "+h+".0, 0.5);\n      return sampleTexture("+n+", uv);\n    }\n  ":"\n  float "+r+"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * "+t[1]+" + col + "+d+";\n    vec2 uv = uvFromFlat("+c+", "+h+", index);\n    return sampleTexture("+n+", uv);\n  }\n"}(e);case 3:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[1]*t[2],i=t[2],s=M(t),o=s.newShape,l=s.keptDims,u=o;if(u.length<t.length)return"\n        "+da(Ca(e,u))+"\n        float "+r+"(int row, int col, int depth) {\n          return "+r+"("+Ea(["row","col","depth"],l)+");\n        }\n      ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3("+a+", "+i+", 1)));\n        "+ba(e)+"\n      }\n    ";var c=e.shapeInfo.texShape,h=c[0],d=c[1],p=e.shapeInfo.flatOffset;return d===a&&null==p?"\n        float "+r+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+i+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+d+".0, "+h+".0);\n          return sampleTexture("+n+", uv);\n        }\n      ":d===i&&null==p?"\n    float "+r+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+t[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+d+".0, "+h+".0);\n      return sampleTexture("+n+", uv);\n    }\n  ":"\n      float "+r+"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * "+a+" + col * "+i+" + depth + "+xa(n)+";\n        vec2 uv = uvFromFlat("+h+", "+d+", index);\n        return sampleTexture("+n+", uv);\n      }\n  "}(e);case 4:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[3],i=t[2]*a,s=t[1]*i,o=M(t),l=o.newShape,u=o.keptDims;if(l.length<t.length)return"\n      "+da(Ca(e,l))+"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        return "+r+"("+Ea(["row","col","depth","depth2"],u)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4("+s+", "+i+", "+a+", 1)));\n        "+ba(e)+"\n      }\n    ";var c=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,d=h[0],p=h[1];return p===s&&null==c?"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3("+i+", "+a+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+p+".0, "+d+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":p===a&&null==c?"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+t[1]*t[2]+", "+t[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+p+".0, "+d+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+s+" + col * "+i+" +\n          depth * "+a+" + depth2;\n      vec2 uv = uvFromFlat("+d+", "+p+", index + "+xa(n)+");\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);case 5:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[4],i=t[3]*a,s=t[2]*i,o=t[1]*s,l=M(t),u=l.newShape,c=l.keptDims;if(u.length<t.length)return"\n      "+da(Ca(e,u))+"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+r+"("+Ea(["row","col","depth","depth2","depth3"],c)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+o+", "+s+", "+i+", "+a+")) +\n          depth3;\n        "+ba(e)+"\n      }\n    ";var h=e.shapeInfo.flatOffset,d=e.shapeInfo.texShape,p=d[0],f=d[1];return f===o&&null==h?"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4("+s+", "+i+", "+a+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+f+".0, "+p+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":f===a&&null==h?"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+t[1]*t[2]*t[3]+",\n               "+t[2]*t[3]+", "+t[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+f+".0, "+p+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+o+" + col * "+s+" + depth * "+i+" +\n          depth2 * "+a+" + depth3 + "+xa(n)+";\n      vec2 uv = uvFromFlat("+p+", "+f+", index);\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);case 6:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=M(t),i=a.newShape,s=a.keptDims;if(i.length<t.length)return"\n      "+da(Ca(e,i))+"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+r+"("+Ea(["row","col","depth","depth2","depth3","depth4"],s)+");\n      }\n    ";var o=t[5],l=t[4]*o,u=t[3]*l,c=t[2]*u,h=t[1]*c;if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4("+h+", "+c+", "+u+", "+l+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+o+", 1)));\n        "+ba(e)+"\n      }\n    ";var d=e.shapeInfo.flatOffset,p=e.shapeInfo.texShape,f=p[0],m=p[1];return m===h&&null==d?"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4("+c+", "+u+", "+l+", "+o+")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+m+".0, "+f+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":m===o&&null==d?"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4("+t[1]*t[2]*t[3]*t[4]+",\n               "+t[2]*t[3]*t[4]+",\n               "+t[3]*t[4]+",\n               "+t[4]+")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+m+".0, "+f+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+h+" + col * "+c+" + depth * "+u+" +\n          depth2 * "+l+" + depth3 * "+o+" + depth4 + "+xa(n)+";\n      vec2 uv = uvFromFlat("+f+", "+m+", index);\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);default:throw new Error(t.length+"-D input sampling is not yet supported")}}function pa(e){var t,n,r,a,i,s,o;switch(e.shapeInfo.logicalShape.length){case 0:return"\n    vec4 "+("get"+(t=e.name).charAt(0).toUpperCase()+t.slice(1))+"() {\n      return "+ua().texture2D+"("+t+", halfCR);\n    }\n  ";case 1:return r=(n=e).name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n.shapeInfo.texShape,s=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],o=ua(),"\n    vec4 "+a+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+s[0]+", "+s[1]+", index);\n      return "+o.texture2D+"("+r+", uv);\n    }\n  ";case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape,i=a[0],s=a[1],o=ua();if(null!=a&&S(t,a))return"\n      vec4 "+r+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+s+".0, "+i+".0);\n\n        return "+o.texture2D+"("+n+", uv);\n      }\n    ";var l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];return"\n    vec4 "+r+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+Math.ceil(t[1]/2)+", "+l[0]+", "+l[1]+", row, col);\n      return "+o.texture2D+"("+n+", uv);\n    }\n  "}(e);case 3:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape,i=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];if(1===t[0])return"\n        "+pa(Ca(e,t.slice(1)))+"\n        vec4 "+r+"(int b, int row, int col) {\n          return "+r+"("+Ea(["b","row","col"],[1,2])+");\n        }\n      ";var s=i[0],o=i[1],l=Math.ceil(t[2]/2);return"\n    vec4 "+r+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+s+", "+o+", "+l*Math.ceil(t[1]/2)+", "+l+", b, row, col);\n      return "+ua().texture2D+"("+n+", uv);\n    }\n  "}(e);default:return function(e){for(var t=e.shapeInfo.logicalShape,n=t.length,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,s=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],o=s[0],l=s[1],u=Math.ceil(t[n-1]/2),c=u*Math.ceil(t[n-2]/2),h="int b, int row, int col",d="b * "+c+" + (row / 2) * "+u+" + (col / 2)",p=2;p<n-1;p++)h="int b"+p+", "+h,d="b"+p+" * "+(c*=t[n-p-1])+" + "+d;return"\n    vec4 "+a+"("+h+") {\n      int index = "+d+";\n      int texR = index / "+l+";\n      int texC = index - texR * "+l+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+l+", "+o+");\n      return "+ua().texture2D+"("+r+", uv);\n    }\n  "}(e)}}var va="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",ma="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",ga="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",ya="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function xa(e){return"offset"+e}function ba(e){var t=e.name,n=k(e.shapeInfo.logicalShape);return n<2?"return "+t+";":"\n    for (int i = 0; i < "+n+"; i++) {\n      if (i == index) {\n        return "+t+"[i];\n      }\n    }\n  "}function wa(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank "+e+" is not yet supported")}function Ca(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function Ea(e,t){return t.map((function(t){return e[t]})).join(", ")}var Ra=function(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,C(e.length>2,(function(){return"Packed arg"+(n.charAt(0).toUpperCase()+n.slice(1))+" supports only inputs with rank above 2."}));var a=e[e.length-1],i=Math.ceil(a/t);this.outputShape=e.slice(0,-1),i>1&&this.outputShape.push(i),r||this.variableNames.push("bestIndicesA");var s,o,l=this.outputShape,u=l.length,c=wa(u),h=sa("coords",u);if(1===i){var d=wa(o=u+1);s="\n        "+d+" sourceLocR = "+d+"("+h.join()+", 0);\n        ++"+h[u-1]+";\n        "+d+" sourceLocG = "+d+"("+h.join()+", 0);\n        ++"+h[u-2]+";\n        "+d+" sourceLocA = "+d+"("+h.join()+", 0);\n        --"+h[u-1]+";\n        "+d+" sourceLocB = "+d+"("+h.join()+", 0);\n        --"+h[u-2]+";"}else o=u,s="\n        "+c+" sourceLocR = coords;\n        ++"+h[u-1]+";\n        "+c+" sourceLocG = coords;\n        ++"+h[u-2]+";\n        "+c+" sourceLocA = coords;\n        --"+h[u-1]+";\n        "+c+" sourceLocB = coords;\n        --"+h[u-2]+";";var p=["x","y","z","w","u","v"].slice(0,o),f="."+p[o-1],m=p.map((function(e){return"int "+e})),g=sa("sourceLocR",o-1).concat("inIdx.r"),y=sa("sourceLocG",o-1).concat("inIdx.g"),v=sa("sourceLocB",o-1).concat("inIdx.b"),b=sa("sourceLocA",o-1).concat("inIdx.a"),x="max"===n?"greaterThan":"lessThan",T=r?"":"\n          inIdx = round(vec4(getBestIndicesAChannel("+g.join()+"),\n                             getBestIndicesAChannel("+y.join()+"),\n                             getBestIndicesAChannel("+v.join()+"),\n                             getBestIndicesAChannel("+b.join()+")));",_="vec4(\n            getAChannel("+g.join()+"),\n            hasNextCol ? getAChannel("+y.join()+") : 0.,\n            hasNextRow ? getAChannel("+v.join()+") : 0.,\n            hasNextRow && hasNextCol ? getAChannel("+b.join()+") : 0.)",w=r?"":"\n      float getBestIndicesAChannel("+m.join()+") {\n        return getChannel(getBestIndicesA("+p.join()+"),\n                                          vec2("+p.slice(-2).join()+"));\n      }";this.userCode="\n      float getAChannel("+m.join()+") {\n        return getChannel(getA("+p.join()+"),\n                               vec2("+p.slice(-2).join()+"));\n      }\n      "+w+"\n      void main() {\n        "+c+" coords = getOutputCoords();\n        bool hasNextCol = "+h[u-1]+" < "+(l[u-1]-1)+";\n        bool hasNextRow = "+h[u-2]+" < "+(l[u-2]-1)+";\n        "+s+"\n        ivec4 srcIdx = ivec4(sourceLocR"+f+", sourceLocG"+f+",\n          sourceLocB"+f+", sourceLocA"+f+") * "+t+";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = "+_+";\n\n        for (int i = 0; i < "+t+"; i++) {\n          inIdx = srcIdx;\n          "+T+"\n          vec4 candidate = "+_+";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4("+x+"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    "},Ia=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,i=e.dilationHeight,s=e.dilationWidth,o=e.effectiveFilterHeight,l=e.effectiveFilterWidth,u=o-1-e.padInfo.top,c=l-1-e.padInfo.left,h=1/(t*n);this.userCode="\n      const ivec2 pads = ivec2("+u+", "+c+");\n      const float avgMultiplier = float("+h+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+o+";\n            wR += "+i+") {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+l+";\n            wC+= "+s+") {\n            float dyC = float(dyCCorner + wC) / "+a+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},ka=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,a=e.strideDepth,i=e.strideHeight,s=e.strideWidth,o=e.dilationDepth,l=e.dilationHeight,u=e.dilationWidth,c=e.effectiveFilterDepth,h=e.effectiveFilterHeight,d=e.effectiveFilterWidth,p=c-1-e.padInfo.front,f=h-1-e.padInfo.top,m=d-1-e.padInfo.left,g=1/(t*n*r);this.userCode="\n      const ivec3 pads = ivec3("+p+", "+f+", "+m+");\n      const float avgMultiplier = float("+g+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+c+";\n            wD += "+o+") {\n          float dyD = float(dyDCorner + wD) / "+a+".0;\n\n          if (dyD < 0.0 || dyD >= "+e.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+h+";\n              wR += "+l+") {\n            float dyR = float(dyRCorner + wR) / "+i+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+d+";\n                wC += "+u+") {\n              float dyC = float(dyCCorner + wC) / "+s+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Sa=function(e,t,n,r,a,i){this.outputShape=[],this.variableNames=["x","mean","variance"],Ro(e,t),Ro(e,n);var s="0.0";null!=r&&(Ro(e,r),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var o="1.0";null!=a&&(Ro(e,a),this.variableNames.push("scale"),o="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+s+";\n        float scale = "+o+";\n        float inv = scale * inversesqrt(variance + float("+i+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "},Aa=function(e,t,n,r,a,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Ro(e,t),Ro(e,n);var s="vec4(0.0)";null!=r&&(Ro(e,r),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var o="vec4(1.0)";null!=a&&(Ro(e,a),this.variableNames.push("scale"),o="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        vec4 offset = "+s+";\n        vec4 scale = "+o+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+i+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "},Da="return areal * breal - aimag * bimag;",Ta="return areal * bimag + aimag * breal;",Na=function(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Ro(t,n),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+e+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "},Fa="return a + b;",_a="return a - b;",Oa="return a * b;",Ma="return (a < 0.) ? b * a : a;",Ba=function(e,t,n){this.variableNames=["A","B"],this.outputShape=Ro(t,n),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+e+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "},Pa="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",La=function(e,t,n,r){void 0===r&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Ro(t,n);var a=this.outputShape.length,i="";if(r)if(0===a||1===k(this.outputShape))i="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(i="\n          "+wa(a)+" coords = getOutputCoords();\n        ",1===a)i+="\n            result.y = (coords + 1) >= "+this.outputShape[0]+" ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ";else{var s=sa("coords",a);i+="\n            bool nextRowOutOfBounds =\n              ("+s[a-2]+" + 1) >= "+this.outputShape[a-2]+";\n            bool nextColOutOfBounds =\n              ("+s[a-1]+" + 1) >= "+this.outputShape[a-1]+";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        "+e+"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        "+i+"\n\n        setOutput(result);\n      }\n    "},Wa=function(){function e(e){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(r,a){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(a,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(a,"maxVal")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}},e}(),Ua=function(){function e(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(r,a){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(a,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(a,"maxVal")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}},e}(),Va=function(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "},za=function(e){this.outputShape=[],this.outputShape=Sn(e,1),this.variableNames=e.map((function(e,t){return"T"+t}));var t=new Array(e.length-1);t[0]=e[0][1];for(var n=1;n<t.length;n++)t[n]=t[n-1]+e[n][1];var r=["if (yC < "+t[0]+") setOutput(getT0(yR, yC));"];for(n=1;n<t.length;n++){var a=t[n-1];r.push("else if (yC < "+t[n]+") setOutput(getT"+n+"(yR, yC-"+a+"));")}var i=t.length,s=t[t.length-1];r.push("else setOutput(getT"+i+"(yR, yC-"+s+"));"),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        "+r.join("\n        ")+"\n      }\n    "},Ga=function(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Sn(e,t);var n=this.outputShape,r=n.length,a=wa(r),i=sa("coords",r),s=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((function(e,t){return"T"+t}));var o=new Array(e.length-1);o[0]=e[0][t];for(var l=1;l<o.length;l++)o[l]=o[l-1]+e[l][t];var u=s[t],c=s.slice(-2),h=s.join(),d="if ("+u+" < "+o[0]+") {\n        return getChannel(\n            getT0("+h+"), vec2("+c.join()+"));\n        }";for(l=1;l<o.length;l++){var p=o[l-1];d+="\n        if ("+u+" < "+o[l]+"  && "+u+" >= "+o[l-1]+") {\n          return getChannel(\n            getT"+l+"("+Ha(s,u,p)+"),\n            vec2("+Ha(c,u,p)+"));\n        }"}var f=o.length,m=o[o.length-1];d+="\n        return getChannel(\n          getT"+f+"("+Ha(s,u,m)+"),\n          vec2("+Ha(c,u,m)+"));",this.userCode="\n      float getValue("+s.map((function(e){return"int "+e}))+") {\n        "+d+"\n      }\n\n      void main() {\n        "+a+" coords = getOutputCoords();\n        vec4 result = vec4(getValue("+i+"), 0., 0., 0.);\n\n        "+i[r-1]+" = "+i[r-1]+" + 1;\n        if ("+i[r-1]+" < "+n[r-1]+") {\n          result.g = getValue("+i+");\n        }\n\n        "+i[r-2]+" = "+i[r-2]+" + 1;\n        if ("+i[r-2]+" < "+n[r-2]+") {\n          result.a = getValue("+i+");\n        }\n\n        "+i[r-1]+" = "+i[r-1]+" - 1;\n        if ("+i[r-2]+" < "+n[r-2]+" &&\n            "+i[r-1]+" < "+n[r-1]+") {\n          result.b = getValue("+i+");\n        }\n        setOutput(result);\n      }\n    "};function Ha(e,t,n){var r=e.indexOf(t);return e.map((function(e,t){return t===r?e+" - "+n:e})).join()}var qa=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,a=e.padInfo.left,i="channelsLast"===e.dataFormat;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n            int xR = wR + yR * "+t+" - "+r+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+a+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              if ("+i+") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Ka=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,i="channelsLast"===e.dataFormat,s=t-1-e.padInfo.top,o=n-1-e.padInfo.left,l=i?1:2,u=i?2:3,c=i?3:1;this.userCode="\n      const ivec2 pads = ivec2("+s+", "+o+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords["+c+"];\n\n        ivec2 dyCorner = ivec2(coords["+l+"], coords["+u+"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+a+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+e.outChannels+"; d2++) {\n\n              if ("+i+") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},ja=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,a=e.padInfo.front,i=e.padInfo.top,s=e.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yF = 0; yF < "+e.outDepth+"; yF++) {\n            int xF = wF + yF * "+t+" - "+a+";\n\n            if (xF < 0 || xF >= "+e.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n              int xR = wR + yR * "+n+" - "+i+";\n\n              if (xR < 0 || xR >= "+e.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n                int xC = wC + yC * "+r+" - "+s+";\n\n                if (xC < 0 || xC >= "+e.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Xa=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,a=e.strideDepth,i=e.strideHeight,s=e.strideWidth,o=t-1-e.padInfo.front,l=n-1-e.padInfo.top,u=r-1-e.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3("+o+", "+l+", "+u+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+t+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+a+".0;\n\n          if (dyF < 0.0 || dyF >= "+e.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+t+" - 1 - wF;\n\n          for (int wR = 0; wR < "+n+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+i+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+n+" - 1 - wR;\n\n            for (int wC = 0; wC < "+r+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+s+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+r+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+e.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Ya=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,a=e.padInfo.left,i=e.outChannels/e.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+i+" + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n            int xR = wR + yR * "+t+" - "+r+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+a+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},$a=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,i=t-1-e.padInfo.top,s=n-1-e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+i+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+a+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+o+"; dm++) {\n              int d2 = d1 * "+o+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Qa=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var a=e.padInfo.top,i=e.padInfo.left,s=e.strideHeight,o=e.strideWidth,l=e.dilationHeight,u=e.dilationWidth,c=e.filterHeight,h=e.filterWidth,d=4*Math.floor(e.inChannels/4),p=e.inChannels%4,f="channelsLast"===e.dataFormat,m=f?1:2,g=f?2:3,y=f?3:1,v="",b="";n&&(v=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"\n          float activation(float x) {\n            "+n+"\n          }\n        ",b="result = activation(result);");var x=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+v+"\n\n      const ivec2 strides = ivec2("+s+", "+o+");\n      const ivec2 pads = ivec2("+a+", "+i+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords["+y+"];\n\n        ivec2 xRCCorner =\n            ivec2(coords["+m+"], coords["+g+"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+c+"; wR++) {\n          int xR = xRCorner + wR * "+l+";\n\n          if (xR < 0 || xR >= "+e.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+h+"; wC++) {\n            int xC = xCCorner + wC * "+u+";\n\n            if (xC < 0 || xC >= "+e.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+d+"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if ("+f+") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if ("+(1===p)+") {\n\n              if ("+f+") {\n                dotProd +=\n                    getX(batch, xR, xC, "+d+") *\n                    getW(wR, wC, "+d+", d2);\n              } else {\n                dotProd +=\n                    getX(batch, "+d+", xR, xC) *\n                    getW(wR, wC, "+d+", d2);\n              }\n\n            } else if ("+(2===p)+") {\n              vec2 wValues = vec2(\n                getW(wR, wC, "+d+", d2),\n                getW(wR, wC, "+d+" + 1, d2)\n              );\n\n              if ("+f+") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, "+d+"),\n                  getX(batch, xR, xC, "+d+" + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, "+d+", xR, xC),\n                  getX(batch, "+d+" + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if ("+(3===p)+") {\n              vec3 wValues = vec3(\n                getW(wR, wC, "+d+", d2),\n                getW(wR, wC, "+d+" + 1, d2),\n                getW(wR, wC, "+d+" + 2, d2)\n              );\n\n              if ("+f+") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, "+d+"),\n                  getX(batch, xR, xC, "+d+" + 1),\n                  getX(batch, xR, xC, "+d+" + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, "+d+", xR, xC),\n                  getX(batch, "+d+" + 1, xR, xC),\n                  getX(batch, "+d+" + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        "+x+"\n        "+b+"\n        setOutput(result);\n      }\n    "},Ja=function(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.padInfo.front,n=e.padInfo.top,r=e.padInfo.left,a=e.strideDepth,i=e.strideHeight,s=e.strideWidth,o=e.dilationDepth,l=e.dilationHeight,u=e.dilationWidth,c=e.filterDepth,h=e.filterHeight,d=e.filterWidth,p=4*Math.floor(e.inChannels/4),f=e.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+a+", "+i+", "+s+");\n      const ivec3 pads = ivec3("+t+", "+n+", "+r+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+c+"; wF++) {\n          int xF = xFCorner + wF * "+o+";\n\n          if (xF < 0 || xF >= "+e.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+h+"; wR++) {\n            int xR = xRCorner + wR * "+l+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+d+"; wC++) {\n              int xC = xCCorner + wC * "+u+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+p+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(1===f)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+p+") *\n                  getW(wF, wR, wC, "+p+", d2);\n              } else if ("+(2===f)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+p+"),\n                  getX(batch, xF, xR, xC, "+p+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+p+", d2),\n                  getW(wF, wR, wC, "+p+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(3===f)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+p+"),\n                  getX(batch, xF, xR, xC, "+p+" + 1),\n                  getX(batch, xF, xR, xC, "+p+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+p+", d2),\n                  getW(wF, wR, wC, "+p+" + 1, d2),\n                  getW(wF, wR, wC, "+p+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Za=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var a=e.inHeight,i=e.inWidth,s=e.padInfo.top,o=e.padInfo.left,l=e.strideHeight,u=e.strideWidth,c=e.dilationHeight,h=e.dilationWidth,d=e.filterHeight,p=e.filterWidth,f=e.outChannels/e.inChannels,m="",g="";n&&(m=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"\n          float activation(float x) {\n            "+n+"\n          }\n        ",g="result = activation(result);");var y=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+m+"\n\n      const ivec2 strides = ivec2("+l+", "+u+");\n      const ivec2 pads = ivec2("+s+", "+o+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+f+";\n        int q = d2 - d1 * "+f+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+d+"; wR++) {\n          int xR = xRCorner + wR * "+c+";\n\n          if (xR < 0 || xR >= "+a+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+p+"; wC++) {\n            int xC = xCCorner + wC * "+h+";\n\n            if (xC < 0 || xC >= "+i+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        "+y+"\n        "+g+"\n        setOutput(result);\n      }\n    "},ti=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.outShape;for(var a=e.inHeight,i=e.inWidth,s=e.padInfo.top,o=e.padInfo.left,l=e.strideHeight,u=e.strideWidth,c=e.dilationHeight,h=e.dilationWidth,d=e.filterHeight,p=e.filterWidth,f=p,m="int xR; int xC; int xCOffset;",g=0;g<d;g++)for(var y=0;y<p;y++)m+="\n          vec4 xTexelR"+g+"C"+2*y+" = vec4(0.);\n          vec4 wR"+g+"C"+y+" = vec4(0.);\n          vec4 xR"+g+"C"+y+" = vec4(0.);";for(g=0;g<d;g++)for(var v=0;v<f;v++){if(m+="\n          xR = xRCorner + "+g*c+";\n          xC = xCCorner + "+(y=2*v)*h+";\n        ",1===u){if(y<p&&(m+=o%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < "+a+" && xCOffset >= 0 && xCOffset < "+i+") {\n                  xTexelR"+g+"C"+y+" = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+i+") {\n                    xTexelR"+g+"C"+y+".zw = vec2(0.);\n                  }\n                } else {\n                  xTexelR"+g+"C"+y+" = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < "+a+" && xCOffset >= 0 && xCOffset < "+i+") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+i+") {\n                    previous.zw = vec2(0.);\n                  }\n\n                  xR"+g+"C"+y+" = vec4(previous.zw, xTexelR"+g+"C"+y+".xy);\n                } else {\n                  xR"+g+"C"+y+" = vec4(0, 0, xTexelR"+g+"C"+y+".xy);\n                }\n              ":"\n                if(xR >= 0 && xR < "+a+" && xC >= 0 && xC < "+i+") {\n                  xTexelR"+g+"C"+y+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+g+"C"+y+" = vec4(0.);\n                }\n\n                xR"+g+"C"+y+" = xTexelR"+g+"C"+y+";\n              ",y+1<p)){var x=o%2==0?b(h):h;h%2==0&&o%2==1||h%2!=0&&o%2!=1?(m+="\n                  xCOffset = xC + "+o%2+" + "+x+";\n\n                  if(xR >= 0 && xR < "+a+" &&\n                    xCOffset >= 0 && xCOffset < "+i+") {\n                    xTexelR"+g+"C"+(y+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n                ",h>1&&(m+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < "+a+" &&\n                      xCOffset >= 0 && xCOffset < "+i+") {\n                      xTexelR"+g+"C"+y+" = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR"+g+"C"+y+" = vec4(0.);\n                    }\n                  "),m+="\n                  xR"+g+"C"+(y+1)+" = vec4(\n                    xTexelR"+g+"C"+y+".zw, xTexelR"+g+"C"+(y+2)+".xy);\n                "):m+="\n                  xCOffset = xC + "+x+";\n\n                  if(xR >= 0 && xR < "+a+" &&\n                    xCOffset >= 0 && xCOffset < "+i+") {\n                    xTexelR"+g+"C"+(y+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR"+g+"C"+(y+1)+" = xTexelR"+g+"C"+(y+2)+";\n                "}}else y<p&&(m+="\n              if(xR >= 0 && xR < "+a+") {\n            ",o%2==1?(m+="\n                xCOffset = xC + 1 - "+u+";\n                if(xCOffset >= 0 && xCOffset < "+i+") {\n                  xTexelR"+g+"C"+y+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+g+"C"+y+" = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < "+i+") {\n                  xTexelR"+g+"C"+(y+2)+" = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR"+g+"C"+(y+2)+" = vec4(0.);\n                }\n\n                xR"+g+"C"+y+" = vec4(\n                  xTexelR"+g+"C"+y+".zw, xTexelR"+g+"C"+(y+2)+".zw);\n              ",y+1<p&&(m+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + "+u+";\n                  if(xCOffset >= 0 && xCOffset < "+i+") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR"+g+"C"+(y+1)+" = vec4(xTexelR"+g+"C"+(y+2)+".xy, final.xy);\n                ")):(m+="\n                if(xC >= 0 && xC < "+i+") {\n                  xTexelR"+g+"C"+y+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+g+"C"+y+" = vec4(0.);\n                }\n\n                xCOffset = xC + "+u+";\n                if(xCOffset >= 0 && xCOffset < "+i+") {\n                  xTexelR"+g+"C"+(y+2)+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+g+"C"+(y+2)+" = vec4(0.);\n                }\n\n                xR"+g+"C"+y+" = vec4(\n                  xTexelR"+g+"C"+y+".xy, xTexelR"+g+"C"+(y+2)+".xy);\n              ",y+1<p&&(m+="\n                  xR"+g+"C"+(y+1)+" = vec4(\n                    xTexelR"+g+"C"+y+".zw, xTexelR"+g+"C"+(y+2)+".zw);\n                ")),m+="}");y<p&&(m+="\n            vec4 wTexelR"+g+"C"+y+" = getW("+g+", "+y+", d1, q);\n            wR"+g+"C"+y+" = vec4(wTexelR"+g+"C"+y+".xz, wTexelR"+g+"C"+y+".xz);\n          ",y+1<p&&(m+="\n              vec4 wTexelR"+g+"C"+(y+1)+" = getW("+g+", "+(y+1)+", d1, q);\n              wR"+g+"C"+(y+1)+" =\n                vec4(wTexelR"+g+"C"+(y+1)+".xz, wTexelR"+g+"C"+(y+1)+".xz);"))}for(g=0;g<d;g++)for(y=0;y<p;y++)m+="dotProd += xR"+g+"C"+y+" * wR"+g+"C"+y+";";var T="",_="";n&&(T=r?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"vec4 activation(vec4 x) {\n          "+n+"\n        }",_="result = activation(result);");var w=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+T+"\n\n      const ivec2 strides = ivec2("+l+", "+u+");\n      const ivec2 pads = ivec2("+s+", "+o+");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        "+m+"\n\n        vec4 result = dotProd;\n        "+w+"\n        "+_+"\n        setOutput(result);\n      }\n    "},ei=function(e,t,n,r,a){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var i=e[0],s=e[1],o=e[2],l=e[3],u=t[0],c=n[0],h=n[1];this.outputShape=[u,c,h,l];var d="bilinear"===r?1:0,p=[s-1+".0",o-1+".0"],f=p[0],m=p[1],g=c>1?[""+(s-1)/(c-1),"(y2-y1) * height_ratio","y1*"+f+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+f],y=g[0],v=g[1],b=g[2],x=h>1?[""+(o-1)/(h-1),"(x2-x1) * width_ratio","x1*"+m+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+m],T=x[0],_=x[1],w=x[2];this.userCode="\n      const float height_ratio = float("+y+");\n      const float width_ratio = float("+T+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+i+") {\n          return;\n        }\n\n        float height_scale = "+v+";\n        float width_scale = "+_+";\n\n        float in_y = "+b+";\n        if( in_y < 0.0 || in_y > "+f+" ) {\n          setOutput(float("+a+"));\n          return;\n        }\n        float in_x = "+w+";\n        if( in_x < 0.0 || in_x > "+m+" ) {\n          setOutput(float("+a+"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if("+d+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    "},ni=function(e,t,n){this.variableNames=["x"],this.outputShape=e;var r=e.length,a=e[e.length-1],i=n?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(n?"return "+a+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+wa(r)+" coords = getOutputCoords();\n        int end = "+ri(r,"coords")+";\n        float val = 0.0;\n        for (int i = "+a+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+i+" end) {\n            continue;\n          }\n          if (idx == end && "+t+") {\n            continue;\n          }\n          "+ri(r,"coords")+" = idx;\n          val += getX("+function(e,t){if(1===e)return""+t;if(2===e)return t+".x, "+t+".y";if(3===e)return t+".x, "+t+".y, "+t+".z";if(4===e)return t+".x, "+t+".y, "+t+".z, "+t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}(r,"coords")+");\n        }\n        setOutput(val);\n      }\n    "};function ri(e,t){if(1===e)return""+t;if(2===e)return t+".y";if(3===e)return t+".z";if(4===e)return t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}var oi=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Vt.DENSE;var t=Yt(e),n=ua();this.outputShape=e,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+ca(["r","c","d"],e)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+t[0]+", "+t[1]+"));\n        int index = 4 * (resTexRC.x * "+t[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        "+n.output+" = result;\n      }\n    "},ai=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Vt.DENSE;var t=Yt(e),n=ua();this.outputShape=e,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+ca(["r","c","d"],e)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+t[0]+", "+t[1]+"));\n        int index = 4 * (resTexRC.x * "+t[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        "+n.output+" = result;\n      }\n    "},ii=function(){function e(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+t+";\n      int offset_h = imod(h, "+t+");\n      int in_w = w / "+t+";\n      int offset_w = imod(w, "+t+");\n      int offset_d = (offset_h * "+t+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return e.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},e.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},e.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},e.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},e.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},e}(),si=function(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "},ui=function(e){this.variableNames=["A"],this.outTexUsage=zt.DOWNLOAD;var t=ua();this.outputShape=e,this.userCode="\n      "+ha+"\n\n      void main() {\n        float x = getAAtOutCoords();\n        "+t.output+" = encode_float(x);\n      }\n    "},ci=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=zt.DOWNLOAD;var t=ua();this.outputShape=e,this.userCode="\n      "+ha+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        "+t.output+" = encode_float(x);\n      }\n    "},li=function(e,t,n){void 0===n&&(n=!1),this.variableNames=["A"];var r=ua(),a=t[0],i=t[1];this.outputShape=e;var s="result";n&&(s="floor(result * 255. + 0.5)"),this.userCode="\n      "+la(e)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n        \n        int r = flatIndex / "+i+";\n        int c = imod(flatIndex, "+i+");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2("+i+".0, "+a+".0);\n        vec4 values = "+r.texture2D+"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        "+r.output+" = vec4("+s+", 0., 0., 0.);\n      }\n    "},hi=function(e,t,n){void 0===n&&(n=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=ua(),a=t[0],i=t[1];this.outputShape=e;var s="",o="result";n&&(o="floor(result * 255. + 0.5)");for(var l=0;l<=1;l++)for(var u=0;u<=1;u++){var c=2*l+u;s+="\n          localCoords = coords;\n          if(localCoords[2] + "+u+" < "+e[2]+") {\n            localCoords[2] += "+u+";\n            if(localCoords[1] + "+l+" < "+e[1]+") {\n              localCoords[1] += "+l+";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / "+i+";\n              c = imod(flatIndex, "+i+");\n              uv = (vec2(c, r) + halfCR) / vec2("+i+".0, "+a+".0);\n              values = "+r.texture2D+"(A, uv);\n\n              if(offset == 0) {\n                result["+c+"] = values[0];\n              } else if(offset == 1) {\n                result["+c+"] = values[1];\n              } else if(offset == 2) {\n                result["+c+"] = values[2];\n              } else {\n                result["+c+"] = values[3];\n              }\n            }\n          }\n        "}this.userCode="\n      "+la(e)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        "+s+"\n\n        "+r.output+" = "+o+";\n      }\n    "},fi="return real * expR - imag * expI;",di="return real * expI + imag * expR;",pi=function(e,t,n){this.variableNames=["real","imag"];var r=t[1];this.outputShape=t;var a=n?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,i=n?r+".0":"1.0";this.userCode="\n      const float exponentMultiplier = "+a+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+e+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+r+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+r+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+i+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "},vi=function(){function e(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,r){null==t.valueLoc&&(t.valueLoc=n.getUniformLocationNoThrow(r,"value")),n.gl.uniform1f(t.valueLoc,e)}},e}(),mi=function(e,t,n){this.variableNames=["A","indices"];var r=e.slice();r[n]=t,this.outputShape=r,this.rank=r.length;var a=wa(this.rank),i=function(e,t){var n=e.length;if(n>4)throw Error("Gather for rank "+n+" is not yet supported");if(1===n)return"int(getIndices(resRC))";for(var r=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],i=0;i<e.length;i++)i===t?a.push("int(getIndices("+r[i]+"))"):a.push(""+r[i]);return a.join()}(e,n);this.userCode="\n      void main() {\n        "+a+" resRC = getOutputCoords();\n        setOutput(getA("+i+"));\n      }\n    "},gi=function(e,t,n){this.sliceDim=e,this.strides=t,this.variableNames=["x","indices"],this.outputShape=n;var r=wa(t.length),a=wa(n.length),i=this.sliceDim>1?"strides[j]":"strides";this.userCode="\n        "+r+" strides = "+r+"("+this.strides+");\n         void main() {\n          "+a+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+i+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "};function yi(e,t){var n=ua();return oe(e,t,n.version+"\n    precision highp float;\n    "+n.attribute+" vec3 clipSpacePos;\n    "+n.attribute+" vec2 uv;\n    "+n.varyingVs+" vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function xi(e,t){return fe(e,t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function bi(e,t){return de(e,t,new Uint16Array([0,1,2,2,1,3]))}function wi(e,t,n,r,a,i,s){ve(n,r);var o=pe(e,t),l=e.TEXTURE_2D;return Jt(e,t,(function(){return e.bindTexture(l,o)})),Jt(e,t,(function(){return e.texParameteri(l,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)})),Jt(e,t,(function(){return e.texParameteri(l,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)})),Jt(e,t,(function(){return e.texParameteri(l,e.TEXTURE_MIN_FILTER,e.NEAREST)})),Jt(e,t,(function(){return e.texParameteri(l,e.TEXTURE_MAG_FILTER,e.NEAREST)})),Jt(e,t,(function(){return e.texImage2D(l,0,a,n,r,0,i,s,null)})),Jt(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,null)})),o}function Ci(e,t,n,r,a){var i=Xt(n,r);return wi(e,t,i[0],i[1],a.internalFormatFloat,a.textureFormatFloat,e.FLOAT)}function Ei(e,t,n,r,a){var i=Xt(n,r);return wi(e,t,i[0],i[1],a.internalFormatHalfFloat,a.textureFormatFloat,a.textureTypeHalfFloat)}function Ri(e,t,n,r,a){var i=Xt(n,r);return wi(e,t,i[0],i[1],e.RGBA,e.RGBA,e.UNSIGNED_BYTE)}function Ii(e,t,n,r,a){var i=$t(n,r);return wi(e,t,i[0],i[1],a.internalFormatPackedFloat,e.RGBA,e.FLOAT)}function ki(e,t,n,r,a){var i=$t(n,r);return wi(e,t,i[0],i[1],a.internalFormatPackedHalfFloat,e.RGBA,a.textureTypeHalfFloat)}function Si(e,t,n,r){return Jt(e,t,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),ge(e,t,n,"clipSpacePos",r,3,20,0)&&ge(e,t,n,"uv",r,2,20,12)}function Ai(e,t,n,r,a,i,s){var o,l,u;Jt(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,n)})),i instanceof Uint8Array?(o=new Uint8Array(r*a*4),l=e.UNSIGNED_BYTE,u=e.RGBA):(o=new Float32Array(r*a*4),l=e.FLOAT,u=s.internalFormatPackedFloat),o.set(i),Jt(e,t,(function(){return e.texImage2D(e.TEXTURE_2D,0,u,r,a,0,e.RGBA,l,o)})),Jt(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}function Di(e,t,n,r){Jt(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,n)})),r.data instanceof Uint8Array?Jt(e,t,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r.width,r.height,0,e.RGBA,e.UNSIGNED_BYTE,r.data)})):Jt(e,t,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r)})),Jt(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}function Ti(e,t,n,r,a){var i=e.createBuffer();Jt(e,t,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,i)}));var s=16*n*r;return Jt(e,t,(function(){return e.bufferData(e.PIXEL_PACK_BUFFER,s,e.STREAM_READ)})),Jt(e,t,(function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,0)})),Jt(e,t,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)})),i}function Ni(e,t,n){var r=e,a=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,a),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),a}function Fi(e,t,n,r,a){var i=Xt(n,r),s=i[0],o=i[1],l=new Uint8Array(n*r*4);return Jt(e,t,(function(){return e.readPixels(0,0,s,o,a.downloadTextureFormat,e.UNSIGNED_BYTE,l)})),new Float32Array(l.buffer)}function _i(e,t,n,r,a,i,s,o){var l,u=e,c=new Float32Array((l=$t(i,s))[0]*l[1]*4);return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}function Oi(e,t,n,r){var a=new Float32Array(n*r*4);return Jt(e,t,(function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,a)})),a}var Bi=function(){function e(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=i().getNumber("WEBGL_VERSION");null!=e?(this.gl=e,Kt(t,e)):this.gl=jt(t);var n="WEBGL_color_buffer_float";if(1===i().getNumber("WEBGL_VERSION")){if(this.textureFloatExtension=re(this.gl,this.debug,"OES_texture_float"),Pe(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=re(this.gl,this.debug,"OES_texture_half_float");else if(i().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),Pe(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=re(this.gl,this.debug,"EXT_color_buffer_half_float");else if(i().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",Pe(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!Pe(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=xi(this.gl,this.debug),this.indexBuffer=bi(this.gl,this.debug),this.framebuffer=me(this.gl,this.debug),this.textureConfig=Qt(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(e.prototype,"debug",{get:function(){return i().getBool("DEBUG")},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){var e=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;Jt(t,this.debug,(function(){return t.finish()})),Jt(t,this.debug,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)})),Jt(t,this.debug,(function(){return t.deleteFramebuffer(e.framebuffer)})),Jt(t,this.debug,(function(){return t.bindBuffer(t.ARRAY_BUFFER,null)})),Jt(t,this.debug,(function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)})),Jt(t,this.debug,(function(){return t.deleteBuffer(e.indexBuffer)})),this.disposed=!0}},e.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),Ci(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),Ei(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),Ri(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),Di(this.gl,this.debug,e,t)},e.prototype.uploadDenseMatrixToTexture=function(e,t,n,r){this.throwIfDisposed(),Ai(this.gl,this.debug,e,t,n,r,this.textureConfig)},e.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),ki(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),Ii(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(Ee(this.gl,this.debug,this.framebuffer),this.outputTexture=null),Jt(this.gl,this.debug,(function(){return t.gl.deleteTexture(e)}))},e.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return Fi(r.gl,r.debug,t,n,r.textureConfig)}))},e.prototype.downloadPackedMatrixFromBuffer=function(e,t,n,r,a,i){return _i(this.gl,e,0,0,0,a,i,this.textureConfig)},e.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return Ni(this.gl,e,t)},e.prototype.createBufferFromTexture=function(e,t,n){this.bindTextureToFrameBuffer(e);var r=Ti(this.gl,this.debug,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r},e.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},e.prototype.createFence=function(e){var t,n,r=this;if(i().getBool("WEBGL_FENCE_API_ENABLED")){var a=e,s=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var e=a.clientWaitSync(s,0,0);return e===a.ALREADY_SIGNALED||e===a.CONDITION_SATISFIED},t=s}else i().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(t,i().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}},e.prototype.downloadMatrixFromPackedTexture=function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return Oi(r.gl,r.debug,t,n)}))},e.prototype.createProgram=function(e){this.throwIfDisposed();var t=this.gl,n=ae(t,this.debug,e),r=yi(t,this.debug),a=ce(t,this.debug);return Jt(t,this.debug,(function(){return t.attachShader(a,r)})),Jt(t,this.debug,(function(){return t.attachShader(a,n)})),le(t,this.debug,a),this.debug&&he(t,this.debug,a),this.vertexAttrsAreBound||(this.setProgram(a),this.vertexAttrsAreBound=Si(t,this.debug,this.program,this.vertexBuffer)),a},e.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&Jt(this.gl,this.debug,(function(){return t.gl.deleteProgram(e)}))},e.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&he(this.gl,this.debug,this.program),Jt(this.gl,this.debug,(function(){return t.gl.useProgram(e)}))},e.prototype.getUniformLocation=function(e,t,n){return void 0===n&&(n=!0),this.throwIfDisposed(),n?xe(this.gl,this.debug,e,t):be(this.gl,e,t)},e.prototype.getAttributeLocation=function(e,t){var n=this;return this.throwIfDisposed(),Jt(this.gl,this.debug,(function(){return n.gl.getAttribLocation(e,t)}))},e.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},e.prototype.setInputMatrixTexture=function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),we(this.gl,this.debug,this.program,e,t,n)},e.prototype.setOutputMatrixTexture=function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)},e.prototype.setOutputPackedMatrixTexture=function(e,t,n){this.throwIfDisposed();var r=$t(t,n),a=r[0],i=r[1];this.setOutputMatrixTextureDriver(e,a,i)},e.prototype.setOutputMatrixWriteRegion=function(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)},e.prototype.setOutputPackedMatrixWriteRegion=function(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},e.prototype.debugValidate=function(){null!=this.program&&he(this.gl,this.debug,this.program),Re(this.gl)},e.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),Jt(e,this.debug,(function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}))},e.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),Jt(this.gl,this.debug,(function(){return e.gl.finish()}))},e.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=re(this.gl,this.debug,2===i().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},e.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},e.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},e.prototype.beginQuery=function(){if(2===i().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),a=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,a),a},e.prototype.endQuery=function(){if(2!==i().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}},e.prototype.waitForQueryAndGetTime=function(e){return n(this,void 0,void 0,(function(){var t=this;return r(this,(function(n){switch(n.label){case 0:return[4,F((function(){return t.disposed||t.isQueryAvailable(e,i().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}))];case 1:return n.sent(),[2,this.getQueryTime(e,i().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}}))}))},e.prototype.getQueryTime=function(e,t){if(0===t)return null;if(2===t){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6},e.prototype.isQueryAvailable=function(e,t){if(0===t)return!0;if(2===t){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),a=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),a&&!this.disjoint}return a=(r=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,r.QUERY_RESULT_AVAILABLE_EXT),null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),a&&!this.disjoint},e.prototype.pollFence=function(e){var t=this;return new Promise((function(n){t.addItemToPoll((function(){return e.isFencePassed()}),(function(){return n()}))}))},e.prototype.pollItems=function(){for(var e=function(e){for(var t=0;t<e.length&&e[t]();++t);return t-1}(this.itemsToPoll.map((function(e){return e.isDoneFn}))),t=0;t<=e;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},e.prototype.addItemToPoll=function(e,t){var n=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||F((function(){return n.pollItems(),0===n.itemsToPoll.length}))},e.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),Ce(this.gl,this.debug,e,this.framebuffer),this.debug&&Re(this.gl)},e.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(Ce(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&Re(this.gl)):Ee(this.gl,this.debug,this.framebuffer)},e.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n},e.prototype.setOutputMatrixTextureDriver=function(e,t,n){this.throwIfDisposed();var r=this.gl;Ce(r,this.debug,e,this.framebuffer),this.debug&&Re(r),this.outputTexture=e,Jt(r,this.debug,(function(){return r.viewport(0,0,t,n)})),Jt(r,this.debug,(function(){return r.scissor(0,0,t,n)}))},e.prototype.setOutputMatrixWriteRegionDriver=function(e,t,n,r){var a=this;this.throwIfDisposed(),Jt(this.gl,this.debug,(function(){return a.gl.scissor(e,t,n,r)}))},e.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},e.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},e}();function Pi(e,t){if(e.length!==t.length)throw Error("Binary was compiled with "+e.length+" inputs, but was executed with "+t.length+" inputs");e.forEach((function(e,n){var r=e.logicalShape,a=t[n],i=a.shape;if(!S(r,i))throw Error("Binary was compiled with different shapes than the current args. Shapes "+r+" and "+i+" must match");if(!e.isUniform||!a.isUniform){var s=e.texShape,o=a.isUniform?null:a.texData.texShape;if(!S(s,o))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+s+" and "+o+" must match")}}))}var Li=function(e,t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var r=n.filterWidth,a=n.inChannels,i=n.strideWidth,s=n.strideHeight,o=n.padInfo,l=n.outWidth,u=n.dilationWidth,c=n.dilationHeight,h=n.dataFormat,d=o.left,p=o.top,f=a*r,m=ua(),g="channelsLast"===h,y=g?0:1,v=g?1:2,b="",x=0;x<=1;x++)for(var T=0;T<=1;T++)b+="\n          blockIndex = rc.y + "+T+";\n          pos = rc.x + "+x+";\n\n          if(blockIndex < "+e[1]+" && pos < "+e[0]+") {\n            offsetY = int(blockIndex / ("+l+")) * "+s+" - "+p+";\n            d0 = offsetY + "+c+" * (pos / "+f+");\n\n            if(d0 < "+t[y]+" && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), "+l+".) * "+i+". - "+d+".);\n              d1 = offsetX + "+u+" * (int(mod(float(pos), "+f+".) / "+a+".));\n\n              if(d1 < "+t[v]+" && d1 >= 0) {\n\n                ch = int(mod(float(pos), "+a+".));\n\n                if ("+g+") {\n                  innerDims = vec2(d1, ch);\n                  result["+(2*x+T)+"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result["+(2*x+T)+"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ";this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        "+b+"\n\n        "+m.output+" = result;\n      }\n    "},Wi=function(e,t,n,r,a){this.variableNames=["x"],this.outputShape=[];var i,s=t,o=e[3]-1;this.outputShape=e;var l="float("+n+") + float("+r+") * sum";i=.5===a?"inversesqrt("+l+")":1===a?"1.0/("+l+")":"exp(log("+l+") * float(-"+a+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+s+"; j <= "+s+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+o+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+i+";\n        setOutput(val);\n      }\n    "},Ui=function(e,t,n,r,a){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=r,this.beta=a,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+t+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+t+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+r+") * norm + float("+n+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+r+")\n                * float("+a+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+a+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "},Vi=function(e,t,n,r,a){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var i,s=t,o=e[3]-1;this.outputShape=e;var l="float("+n+") + float("+r+") * sum";i=.5===a?"inversesqrt("+l+")":1===a?"1.0/("+l+")":"exp(log("+l+") * float(-"+a+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < "+this.outputShape[3]+";\n        bool hasNextRow = c < "+this.outputShape[2]+";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - "+s+";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - "+s+"; j <= "+s+"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2("+o+"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * "+i+";\n        setOutput(result);\n      }\n    "},zi=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideHeight,n=e.strideWidth,r=e.dilationHeight,a=e.effectiveFilterHeight,i=e.effectiveFilterWidth,s=a-1-e.padInfo.top,o=i-1-e.padInfo.left,l=a*i-1;this.userCode="\n      const ivec2 pads = ivec2("+s+", "+o+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+a+";\n          wR += "+r+") {\n          float dyR = float(dyRCorner + wR) / "+t+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+i+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+n+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+l+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+i+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Gi=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,a=e.dilationDepth,i=e.dilationHeight,s=e.dilationWidth,o=e.effectiveFilterDepth,l=e.effectiveFilterHeight,u=e.effectiveFilterWidth,c=o-1-e.padInfo.front,h=l-1-e.padInfo.top,d=u-1-e.padInfo.left,p=o*l*u-1;this.userCode="\n      const ivec3 pads = ivec3("+c+", "+h+", "+d+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+o+";\n           wD += "+a+") {\n          float dyD = float(dyDCorner + wD) / "+t+".0;\n\n          if (dyD < 0.0 || dyD >= "+e.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+l+";\n              wR += "+i+") {\n            float dyR = float(dyRCorner + wR) / "+n+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+u+";\n                wC += "+s+") {\n              float dyC = float(dyCCorner + wC) / "+r+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = "+p+" -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * "+l+" * "+u+" +\n                  wR * "+u+" + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Hi=function(e,t,n,r,a,i,s){void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===a&&(a=!1),void 0===i&&(i=null),void 0===s&&(s=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;var o=n?e[1]:e[2],l=Math.ceil(o/2),u=n?"i * 2, rc.y":"rc.y, i * 2",c=r?"rc.z, i * 2":"i * 2, rc.z",h=n?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],d=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],p="",f="";i&&(p=s?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+i+"\n        }":"vec4 activation(vec4 x) {\n          "+i+"\n        }",f="result = activation(result);");var m=a?"result += getBiasAtOutCoords();":"";a&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+p+"\n\n      const float sharedDimension = "+l+".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+l+"; i++) {\n          vec4 a = getMatrixA(rc.x, "+u+");\n          vec4 b = getMatrixB(rc.x, "+c+");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += ("+h[0]+" * "+d[0]+");\n          result += ("+h[1]+" * "+d[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        "+m+"\n\n        "+f+"\n\n        setOutput(result);\n      }\n    "},qi=function(){function e(e,t,n){this.variableNames=["probs"],this.outputShape=[e,n],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(t-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(t-1)+"));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,r){null==t.seedLoc&&(t.seedLoc=n.getUniformLocation(r,"seed")),n.gl.uniform1f(t.seedLoc,e)}},e}(),Ki=function(e,t,n,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+r+"), float("+n+"),\n                      float(index == coords.y)));\n      }\n    "},ji=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e;var t,n,r,a,i=e.length;if(0===i)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var s=sa("rc",i),o=wa(i),l=function(e,t,n){if(1===e)return"rc > "+t[0];for(var r="",a=e-2;a<e;a++)r+=n[a]+" >= "+t[a],a<e-1&&(r+="||");return r}(i,e,s),u=function(e,t,n,r){if(1===e)return"";var a=r.slice(-2);return"\n    int r = "+a[0]+";\n    int c = "+a[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+t+";\n    bool rEdge = rp1 >= "+n+";\n  "}(i,e[e.length-1],e[e.length-2],s),c=(n=s,r=(t=e).length,a=function(e,t){for(var n=[],r=0;r<=1;r++)for(var a=0;a<=1;a++){for(var i=(0===r?"r":"rp1")+", "+(0===a?"c":"cp1"),s=2;s<e;s++)i=t[t.length-1-s]+","+i;n.push(i)}return n}(r,n),1===r?"getA(rc),\n            rc + 1 >= "+t[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+a[0]+"),\n          cEdge ? 0. : getA("+a[1]+"),\n          rEdge ? 0. : getA("+a[2]+"),\n          rEdge || cEdge ? 0. : getA("+a[3]+")");this.userCode="\n        void main() {\n          "+o+" rc = getOutputCoords();\n\n          if("+l+") {\n            setOutput(vec4(0));\n          } else {\n            "+u+"\n\n            setOutput(vec4("+c+"));\n          }\n        }\n      "}},Xi=function(e,t,n){this.variableNames=["x"],this.outputShape=t.map((function(t,n){return t[0]+e[n]+t[1]}));var r=e.length,a=wa(r),i=t.map((function(e){return e[0]})).join(","),s=t.map((function(t,n){return t[0]+e[n]})).join(","),o=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      "+a+" start = "+a+"("+i+");\n      "+a+" end = "+a+"("+s+");\n\n      void main() {\n        "+a+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+n+"));\n        } else {\n          "+a+" coords = outC - start;\n          setOutput(getX("+o+"));\n        }\n      }\n    ":"\n        int start = "+i+";\n        int end = "+s+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+n+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "},Yi=function(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((function(t,n){return t[0]+e[n]+t[1]}));for(var r=e.length,a=wa(r),i=t.map((function(e){return e[0]})).join(","),s=t.map((function(t,n){return t[0]+e[n]})).join(","),o=sa("rc",r),l=sa("source",r),u=o[r-1]+" < "+this.outputShape[r-1],c=1===r?"source":"vec2("+l.slice(-2).join()+")",h=[a+" rc = outputLoc;",o[r-1]+" += 1;\n       if("+u+") {\n      ",1===r?"":"}\n       rc = outputLoc;\n       "+o[r-2]+" += 1;\n       if("+o[r-2]+" < "+this.outputShape[r-2]+") {",1===r?"":"  "+o[r-1]+" += 1;\n         if("+u+") {"],d=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",p="",f=0,m=1===r?2:4;f<m;f++)p+="\n        "+h[f]+"\n        if ("+d+") {\n          result["+f+"] = float("+n+");\n        } else {\n          "+a+" source = rc - start;\n          result["+f+"] = getChannel(getX("+l.join()+"), "+c+");\n        }\n      ";p+=1===r?"} ":"}}",this.userCode="\n      const "+a+" start = "+a+"("+i+");\n      const "+a+" end = "+a+"("+s+");\n\n      void main() {\n        "+a+" outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        "+p+"\n        setOutput(result);\n      }\n    "},$i=function(e,t,n){if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");var r=e.filterWidth,a=e.strideHeight,i=e.strideWidth,s=e.dilationHeight,o=e.dilationWidth,l=e.effectiveFilterHeight,u=e.effectiveFilterWidth,c=e.padInfo.top,h=e.padInfo.left;this.outputShape=e.outShape;var d="avg"===t,p="0.0";if(d||(p="-1.0 / 1e-20"),n)this.userCode="\n        const ivec2 strides = ivec2("+a+", "+i+");\n        const ivec2 pads = ivec2("+c+", "+h+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+l+";\n              wR += "+s+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+u+";\n                wC += "+o+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+u+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var f=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(f="avgValue / count");var m=4*Math.floor(r/4),g=r%4,y="\n      if ("+d+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+a+", "+i+");\n      const ivec2 pads = ivec2("+c+", "+h+");\n      const float initializationValue = "+p+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+e.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+p+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+l+";\n            wR += "+s+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+e.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+m+"; wC += 4) {\n            int xC = xCCorner + wC * "+o+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+o+", d),\n              getValue(batch, xR, xC + 2 * "+o+", d),\n              getValue(batch, xR, xC + 3 * "+o+", d)\n            );\n\n            "+y+"\n          }\n\n          int xC = xCCorner + "+m+";\n          if ("+(1===g)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+y+"\n          } else if ("+(2===g)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+o+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+y+"\n          } else if ("+(3===g)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+o+", d),\n              getValue(batch, xR, xC + 2 * "+o+", d),\n              initializationValue\n            );\n\n            "+y+"\n          }\n        }\n        setOutput("+f+");\n      }\n    "}},Qi=function(e,t,n){if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");var r=e.filterWidth,a=e.strideDepth,i=e.strideHeight,s=e.strideWidth,o=e.dilationDepth,l=e.dilationHeight,u=e.dilationWidth,c=e.effectiveFilterDepth,h=e.effectiveFilterHeight,d=e.effectiveFilterWidth,p=e.padInfo.front,f=e.padInfo.top,m=e.padInfo.left;this.outputShape=e.outShape;var g="avg"===t,y="0.0";if(g||(y="-1.0 / 1e-20"),n)this.userCode="\n        const ivec3 strides =\n            ivec3("+a+", "+i+", "+s+");\n        const ivec3 pads = ivec3("+p+", "+f+", "+m+");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < "+c+";\n              wD += "+o+") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= "+e.inDepth+") {\n              continue;\n            }\n\n            for (int wR = 0; wR < "+h+";\n                wR += "+l+") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= "+e.inHeight+") {\n                continue;\n              }\n\n              for (int wC = 0; wC < "+d+";\n                  wC += "+u+") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= "+e.inWidth+") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value >= currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition =\n                      wD * "+h+" * "+d+" +\n                      wR * "+d+" + wC;;\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var v=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(v="avgValue / count");var b=4*Math.floor(r/4),x=r%4,T="\n      if ("+g+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec3 strides =\n        ivec3("+a+", "+i+", "+s+");\n      const ivec3 pads = ivec3("+p+", "+f+", "+m+");\n      const float initializationValue = "+y+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= "+e.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+y+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < "+c+";\n            wD += "+o+") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= "+e.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+h+";\n            wR += "+l+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+b+"; wC += 4) {\n              int xC = xCCorner + wC * "+u+";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+u+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+u+", ch),\n                getValue(batch, xD, xR, xC + 3 * "+u+", ch)\n              );\n\n              "+T+"\n            }\n\n            int xC = xCCorner + "+b+";\n            if ("+(1===x)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              "+T+"\n            } else if ("+(2===x)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+u+", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              "+T+"\n            } else if ("+(3===x)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+u+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+u+", ch),\n                initializationValue\n              );\n\n              "+T+"\n            }\n          }\n          setOutput("+v+");\n        }\n      }\n    "}},Ji=function(e,t){this.variableNames=["x"];var n=e.windowSize,r=e.batchSize,a=e.inSize,i=Math.ceil(a/n);this.outputShape=[r,i];var s="0.0",o="";"prod"===t?s="1.0":"min"===t?(s="1.0 / 1e-20",o="min"):"max"===t&&(s="-1.0 / 1e-20",o="max");var l=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===t?l="sumValue":"prod"===t?l="prodValue":"all"===t?l="allValue":"any"===t&&(l="anyValue");var u=4*Math.floor(n/4),c=n%4,h="\n      if ("+("sum"===t)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===t)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+o+"(values, minMaxValue);\n      }\n    ",d="vec4";"all"===t?(s="1.0",h="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",d="bvec4"):"any"===t&&(s="0.0",h="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",d="bvec4");var p="";a%n>0&&(p="\n        if (inIdx < 0 || inIdx >= "+a+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+s+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+p+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+n+";\n\n        vec4 minMaxValue = vec4("+s+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+u+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+h+"\n        }\n\n        int inIdx = inOffset + "+u+";\n        if ("+(1===c)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+h+"\n        } else if ("+(2===c)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+h+"\n        } else if ("+(3===c)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+h+"\n        }\n        setOutput("+l+");\n      }\n    "},Zi=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var n="",r=0;r<4;r++){var a="thisRC = rc;";r%2==1&&(a+="thisRC.z += 1;"),r>1&&(a+="thisRC.y += 1;"),n+="\n        "+a+"\n        "+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+r+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(r>0?"}":"")+"\n      "}this.userCode="\n      \n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+ca(["r","c","d"],t)+"\n      return ivec3(r, c, d);\n    }\n  \n      "+la(e)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+e[1]+";\n        int cols = "+e[2]+";\n\n        "+n+"\n\n        setOutput(result);\n      }\n    "},ts=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,a=r[1],i=r[2],s=e.shape,o=s[1],l=s[2],u=[n&&o>1?a-1:a,n&&l>1?i-1:i],c=[n&&o>1?o-1:o,n&&l>1?l-1:l],h=u[0]/c[0],d=u[1]/c[1],p=1/h,f=1/d,m=2*Math.ceil(p)+2,g=2*Math.ceil(f)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+h+");\n        const float widthScale = float("+d+");\n\n        const float invHeightScale = float("+p+");\n        const float invWidthScale = float("+f+");\n\n        const int winHeight = int("+m+");\n        const int winWidth = int("+g+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+o+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+l+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(a-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(i-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},es=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var a=e[0],i=e[1],s=e[2],o=e[3];this.outputShape=[a,t,n,o];var l=[r&&t>1?i-1:i,r&&n>1?s-1:s],u=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+l[0]/u[0]+",\n          "+l[1]/u[1]+");\n      const vec2 inputShapeRC = vec2("+i+".0, "+s+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "},ns=function(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var a=e[0],i=e[1],s=e[2],o=e[3];this.outputShape=[a,t,n,o];var l=[r&&t>1?i-1:i,r&&n>1?s-1:s],u=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          "+l[0]/u[0]+",\n          "+l[1]/u[1]+",\n          "+l[1]/u[1]+");\n      const vec3 inputShapeRC = vec3("+i+".0, "+s+".0,\n                                     "+s+".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < "+(o-1)+";\n        bool hasNextRow = coords.z < "+(n-1)+";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    "},rs=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,a=r[1],i=r[2],s=e.shape,o=s[1],l=s[2],u=[n&&o>1?a-1:a,n&&l>1?i-1:i],c=[n&&o>1?o-1:o,n&&l>1?l-1:l],h=u[0]/c[0],d=u[1]/c[1],p=1/h,f=1/d,m=2*Math.ceil(p)+2,g=2*Math.ceil(f)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+h+");\n        const float widthScale = float("+d+");\n\n        const float invHeightScale = float("+p+");\n        const float invWidthScale = float("+f+");\n\n        const int winHeight = int("+m+");\n        const int winWidth = int("+g+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+o+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+l+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+u[0]+") *\n                (float(dyR) / float("+c[0]+"));\n\n            float sourceFracCol =\n                float("+u[1]+") *\n                  (float(dyC) / float("+c[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+a+") - 1),\n                "+n+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+i+") - 1),\n                "+n+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},os=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var a=e[0],i=e[1],s=e[2],o=e[3];this.outputShape=[a,t,n,o];var l=[r&&t>1?i-1:i,r&&n>1?s-1:s],u=[r&&t>1?t-1:t,r&&n>1?n-1:n],c=r?"0.5":"0.0";this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+l[0]/u[0]+",\n          "+l[1]/u[1]+");\n      const vec2 inputShapeRC = vec2("+i+".0, "+s+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+c+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "},as=function(e,t){this.variableNames=["x"];var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");if(this.outputShape=e,1!==n){var r=e.map((function(n,r){return a=r,-1!==t.indexOf(a)&&1!==e[a]?e[a]+" - coords["+a+"] - 1":"coords["+a+"]";var a})).join(","),a=wa(n);this.userCode="\n      void main() {\n        "+a+" coords = getOutputCoords();\n        setOutput(getX("+r+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+e[0]+" - coord - 1));\n        }\n      "},is=function(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");this.outputShape=e;var r=sa("rc",n),a=r[n-1]+" + 1 < "+this.outputShape[n-1],i=r[n-2]+" + 1 < "+this.outputShape[n-2],s=wa(n);function o(n){var r=e.map((function(r,a){return i=a,s=n,-1!==t.indexOf(i)&&1!==e[i]?e[i]+" - "+s[i]+" - 1":""+s[i];var i,s}));return"getChannel(getX("+r.join(",")+"), vec2("+r.slice(-2).join(",")+"))"}this.userCode=1===n?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX("+e[0]+" - rc - 1),\n            "+e[0]+" - rc - 1);\n          if("+a+"){\n              result.g = getChannel(getX("+e[0]+" - (rc  + 1) - 1),\n                "+e[0]+" - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      ":"\n        void main() {\n          "+s+" rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = "+(o(r.slice())+";\n          if(")+a+"){\n            result.g = "+function(e){return e[n-1]="("+e[n-1]+" + 1)",o(e)}(r.slice())+";\n          }\n          if("+i+") {\n            result.b = "+function(e){return e[n-2]="("+e[n-2]+" + 1)",o(e)}(r.slice())+";\n            if("+a+") {\n              result.a = "+function(e){return e[n-1]="("+e[n-1]+" + 1)",e[n-2]="("+e[n-2]+" + 1)",o(e)}(r.slice())+";\n            }\n          }\n          setOutput(result);\n        }\n    "},ss=function(e,t,n,r,a,i,s){this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;var o=wa(a.length),l=wa(i.length),u="";1===n?u="i":2===n&&(u="i, j");var c="getIndices("+u+")",h="";1===r?h="i":2===r&&(h="i, coords[1]");var d="getUpdates("+h+")",p=t>1?"strides[j]":"strides";this.userCode="\n        "+o+" strides = "+o+"("+a+");\n\n        void main() {\n          "+l+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+e+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+t+"; j++) {\n              int index = round("+c+");\n              flattenedIndex += index * "+p+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += "+d+";\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "},us=function(e,t){this.variableNames=["x","segmentIds"];var n=e.windowSize,r=e.batchSize,a=e.inSize,i=e.numSegments,s=i*Math.ceil(a/n);this.outputShape=[r,s];var o=4*Math.floor(n/4),l=n%4,u="\n        sumValue += dot(values, segFilter);\n    ",c="";a%n>0&&(c="\n        if (inIdx < 0 || inIdx >= "+a+") {\n          return initializationValue;\n        }\n      ");var h="";a%n>0&&(h="\n        if (inIdx < 0 || inIdx >= "+a+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+c+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+h+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+i+")) * float("+n+"));\n        int currentSeg = int(mod(float(outIdx), float("+i+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+o+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+u+"\n        }\n\n        int inIdx = inOffset + "+o+";\n        if ("+(1===l)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+u+"\n        } else if ("+(2===l)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+u+"\n        } else if ("+(3===l)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+u+"\n        }\n        setOutput(sumValue);\n      }\n    "},cs=function(e,t,n){var r,a;if(this.variableNames=["c","a","b"],this.outputShape=t,n>4)throw Error("Where for rank "+n+" is not yet supported");if(1===n)a="resRC",r="resRC";else{for(var i=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],o=[],l=0;l<t.length;l++)o.push(""+i[l]),l<e&&s.push(""+i[l]);r=s.join(),a=o.join()}var u=wa(n);this.userCode="\n      void main() {\n        "+u+" resRC = getOutputCoords();\n        float cVal = getC("+r+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+a+"));\n        } else {\n          setOutput(getB("+a+"));\n        }\n      }\n    "},ls=function(){function e(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t,n=wa(this.rank),r="uniform int start["+this.rank+"];",a=function(e){if(1===e)return"sourceLoc";if(e<=6)return hs.slice(0,e).map((function(e){return"sourceLoc."+e})).join(",");throw Error("Slicing for rank "+e+" is not yet supported")}(this.rank);t="\n        "+n+" sourceLoc;\n        "+n+" coords = getOutputCoords();\n        "+e.map((function(e,t){return"sourceLoc."+hs[t]+" = start["+t+"] + coords."+hs[t]+";"})).join("\n")+"\n      ",this.userCode="\n      "+r+"\n      void main() {\n        "+t+"\n        setOutput(getSource("+a+"));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}},e}(),hs=["x","y","z","w","u","v"],fs=function(){function e(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length;var t=wa(this.rank),n=sa("coords",this.rank),r=sa("sourceLoc",this.rank),a=1===this.rank?"sourceLoc":"vec2("+r.slice(-2).join()+")",i="getChannel(getSource("+r.join()+"), "+a+")",s="\n      result.x = "+i+";\n      if (++"+n[this.rank-1]+" < "+e[this.rank-1]+") {\n        ++"+r[this.rank-1]+";\n        result.y = "+i+";\n        --"+r[this.rank-1]+";\n      }\n    ",o=1===this.rank?"":"\n      --"+n[this.rank-1]+";\n      if (++"+n[this.rank-2]+" < "+e[this.rank-2]+") {\n        ++"+r[this.rank-2]+";\n        result.z = "+i+";\n        if (++"+n[this.rank-1]+" < "+e[this.rank-1]+") {\n          ++"+r[this.rank-1]+";\n          result.w = "+i+";\n        }\n      }\n    ",l=this.rank<=4?"sourceLoc = coords +\n            "+t+"("+e.map((function(e,t){return"start["+t+"]"})).join()+");":e.map((function(e,t){return r[t]+" = "+n[t]+" + start["+t+"];"})).join("\n");this.userCode="\n      uniform int start["+this.rank+"];\n      void main() {\n        "+t+" coords = getOutputCoords();\n        "+t+" sourceLoc;\n        "+l+"\n        vec4 result = vec4(0.);\n        "+s+"\n        "+o+"\n        setOutput(result);\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}},e}(),ds=function(e,t,n){this.variableNames=["x"],this.outputShape=n;var r=n.length,a=wa(n.length),i=wa(n.length),s="";if(1===r)s="coords * strides + begin";else{var o=0;s=n.map((function(e,t){return o++,1===n.length?"coords * strides["+t+"] + begin["+t+"]":"coords["+(o-1)+"] * strides["+t+"] + begin["+t+"]"})).join(",")}this.userCode="\n      "+a+" begin = "+a+"("+e+");\n      "+a+" strides = "+a+"("+t+");\n\n      void main() {\n        "+i+" coords = getOutputCoords();\n        setOutput(getX("+s+"));\n      }\n    "},ps=function(){function e(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return e.prototype.acquireTexture=function(e,t,n){var r,a=vs(t,n),i=ms(e,a,n);if(i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]),this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var s=this.freeTextures[i].shift();return this.usedTextures[i].push(s),s}return this.numUsedTextures++,this.log(),a===Gt.PACKED_2X2_FLOAT32?r=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):a===Gt.PACKED_2X2_FLOAT16?r=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):a===Gt.UNPACKED_FLOAT32?r=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):a===Gt.UNPACKED_FLOAT16?r=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):a===Gt.PACKED_4X1_UNSIGNED_BYTE&&(r=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[i].push(r),r},e.prototype.releaseTexture=function(e,t,n,r){if(null!=this.freeTextures){var a=ms(t,vs(n,r),r);a in this.freeTextures||(this.freeTextures[a]=[]),this.freeTextures[a].push(e),this.numFreeTextures++,this.numUsedTextures--;var i=this.usedTextures[a],s=i.indexOf(e);if(s<0)throw new Error("Cannot release a texture that was never provided by this texture manager");i.splice(s,1),this.log()}},e.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")")}},e.prototype.getNumUsedTextures=function(){return this.numUsedTextures},e.prototype.getNumFreeTextures=function(){return this.numFreeTextures},e.prototype.dispose=function(){var e=this;if(null!=this.freeTextures){for(var t in this.freeTextures)this.freeTextures[t].forEach((function(t){e.gpgpu.deleteMatrixTexture(t)}));for(var t in this.usedTextures)this.usedTextures[t].forEach((function(t){e.gpgpu.deleteMatrixTexture(t)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},e}();function vs(e,t){if(e===zt.UPLOAD)return Gt.PACKED_2X2_FLOAT32;if(e===zt.RENDER||null==e)return n=t,i().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?Gt.PACKED_2X2_FLOAT32:Gt.UNPACKED_FLOAT32:n?Gt.PACKED_2X2_FLOAT16:Gt.UNPACKED_FLOAT16;var n;if(e===zt.DOWNLOAD||e===zt.PIXELS)return Gt.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+e)}function ms(e,t,n){return e[0]+"_"+e[1]+"_"+t+"_"+n}var gs=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[r]*t[r];this.outputShape=n,this.rank=n.length;var a=wa(this.rank),i=function(e){var t=e.length;if(t>5)throw Error("Tile for rank "+t+" is not yet supported");if(1===t)return"imod(resRC, "+e[0]+")";for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],a=0;a<e.length;a++)r.push("imod("+n[a]+", "+e[a]+")");return r.join()}(e);this.userCode="\n      void main() {\n        "+a+" resRC = getOutputCoords();\n        setOutput(getA("+i+"));\n      }\n    "},ys=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];this.outputShape=n,this.rank=n.length;var a=wa(this.rank),i=function(e){var t=e.length;if(t>6)throw Error("Transpose for rank "+t+" is not yet supported");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t),a=0;a<e.length;a++)r[e[a]]=n[a];return r.join()}(t);this.userCode="\n    void main() {\n      "+a+" resRC = getOutputCoords();\n      setOutput(getA("+i+"));\n    }\n    "},xs=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var a=wa(this.rank),i=ia("rc",this.rank),s=new Array(this.rank);for(r=0;r<t.length;r++)s[t[r]]=i[r];var o="vec2("+s.slice(-2).join()+")",l="++"+i[this.rank-1]+" < "+n[this.rank-1],u="getChannel(getA("+s.join()+"), "+o+")";this.userCode="\n    void main() {\n      "+a+" rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = "+u+";\n      if("+l+") {\n        result[1] = "+u+";\n      }\n      --"+i[this.rank-1]+";\n      if(++"+i[this.rank-2]+" < "+n[this.rank-2]+") {\n        result[2] = "+u+";\n        if("+l+") {\n          result[3] = "+u+";\n        }\n      }\n      setOutput(result);\n    }\n    "},bs=1.7580993408473768,ws=1.0507009873554805,Cs=function(e,t){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      float unaryOperation(float x) {\n        "+t+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},Es="if (isnan(x)) return x;",Rs="return x;",Is="return abs(x);",ks=Es+"\n  return (x < 0.0) ? 0.0 : x;\n",Ss=Es+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",As="return (x >= 0.0) ? x : (exp(x) - 1.0);",Ds="\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = "+bs+";\n  float scale = "+ws+";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n",Ts="return -x;",Ns="return ceil(x);",Fs="return floor(x);",_s="return exp(x);",Os="return exp(x) - 1.0;",Ms=Es+"\n  return sin(x);\n",Bs=Es+"\n  return cos(x);\n",Ps=Es+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n",Ls=Es+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n",Ws=Es+"\n  return atan(x);\n",Us=Es+"return log(x + sqrt(x * x + 1.0));",Vs=Es+"\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));",zs=Es+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;",Gs="return x;",Hs="return x;",qs="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",Ks="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",js="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",Xs=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        "+t+"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},Ys=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e;var t=e.length,n=sa("rc",t),r=wa(t),a=function(e,t){if(1===e)return"rc";for(var n="",r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(t,n),i=n.slice(-2),s=t<=1?"rc":"vec2("+i.join(",")+")";this.userCode="\n      void main() {\n        "+r+" rc = getOutputCoords();\n        vec4 packedInput = getA("+a+");\n\n        setOutput(getChannel(packedInput, "+s+"));\n      }\n    "},$s={};function Qs(e,t){if(void 0===t&&(t=!1),"linear"===e)return t?Hs:Rs;if("relu"===e)return t?qs:ks;if("elu"===e)return t?js:As;if("relu6"===e)return t?Ks:Ss;if("prelu"===e)return t?Pa:Ma;throw new Error("Activation "+e+" has not been implemented for the WebGL backend.")}var Js=600,Zs=function(t){function a(e){var n,r=t.call(this)||this;if(r.pendingRead=new WeakMap,r.pendingDisposal=new WeakSet,r.dataRefCount=new WeakMap,r.numBytesInGPU=0,r.uploadWaitMs=0,r.downloadWaitMs=0,r.warnedAboutMemory=!1,r.pendingDeletes=0,r.disposed=!1,!i().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==e){var a=jt(i().getNumber("WEBGL_VERSION"));r.binaryCache=((n=i().getNumber("WEBGL_VERSION"))in $s||($s[n]={}),$s[n]),r.gpgpu=new Bi(a),r.canvas=a.canvas,r.gpgpuCreatedLocally=!0}else r.gpgpu=e,r.binaryCache={},r.gpgpuCreatedLocally=!1,r.canvas=e.gl.canvas;return r.textureManager=new ps(r.gpgpu),r.numMBBeforeWarning=null==i().global.screen?1024:i().global.screen.height*i().global.screen.width*window.devicePixelRatio*Js/1024/1024,r.texData=new xo(r,Lt),r}return e(a,t),a.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},a.prototype.write=function(e,t,n){if(i().getBool("DEBUG")&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var r={};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:zt.UPLOAD}),r},a.prototype.move=function(e,t,n,r){if(i().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:zt.UPLOAD})},a.prototype.readSync=function(e){var t=this.texData.get(e),n=t.values,r=t.dtype,a=t.complexTensors,i=t.slice,s=t.shape,o=t.isPacked;if(null!=i){var l;l=o?new Xs(s,Gs):new Cs(s,Gs);var u=this.runWebGLProgram(l,[{dataId:e,shape:s,dtype:r}],r),c=this.readSync(u.dataId);return this.disposeData(u.dataId),c}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;var h,d,p=null!=this.activeTimers;return p&&(h=et()),d="complex64"===r?Vo(a.real.dataSync(),a.imag.dataSync()):this.getValuesFromTexture(e),p&&(this.downloadWaitMs+=et()-h),this.convertAndCacheOnCPU(e,d)},a.prototype.read=function(e){return n(this,void 0,void 0,(function(){var t,n,a,s,o,l,u,c,h,d,p,f,m,g,y,v,b,x,T,_,w,S;return r(this,(function(r){switch(r.label){case 0:if(this.pendingRead.has(e))return t=this.pendingRead.get(e),[2,new Promise((function(e){return t.push(e)}))];if(n=this.texData.get(e),a=n.values,s=n.shape,o=n.slice,l=n.dtype,u=n.complexTensors,c=n.isPacked,null!=o)return void 0,h=c?new Xs(s,Gs):new Cs(s,Gs),d=this.runWebGLProgram(h,[{dataId:e,shape:s,dtype:l}],l),p=this.read(d.dataId),this.disposeData(d.dataId),[2,p];if(null!=a)return[2,this.convertAndCacheOnCPU(e)];if(!i().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===i().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return f=null,"complex64"!==l&&i().get("WEBGL_BUFFER_SUPPORTED")&&(m=this.decode(e),g=this.texData.get(m.dataId),f=(S=this.gpgpu).createBufferFromTexture.apply(S,[g.texture].concat(Yt(s)))),this.pendingRead.set(e,[]),"complex64"===l?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:r.sent(),r.label=2;case 2:return"complex64"!==l?[3,4]:[4,Promise.all([u.real.data(),u.imag.data()])];case 3:return v=r.sent(),b=v[0],x=v[1],y=Vo(b,x),[3,5];case 4:null==f?y=this.getValuesFromTexture(e):(T=k(s),y=this.gpgpu.downloadFloat32MatrixFromBuffer(f,T)),r.label=5;case 5:return null!=m&&this.disposeData(m.dataId),_=this.convertAndCacheOnCPU(e,y),w=this.pendingRead.get(e),this.pendingRead.delete(e),w.forEach((function(e){return e(_)})),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e),this.pendingDeletes--),[2,_]}}))}))},a.prototype.checkNumericalProblems=function(e){if(null!=e)for(var t=0;t<e.length;t++){var n=e[t];if(!ee(n)){if(i().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value "+n+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'");throw Error("The value "+n+" cannot be represented on this device.")}}},a.prototype.getValuesFromTexture=function(e){var t,n=this.texData.get(e),r=n.shape,a=n.dtype,s=n.isPacked,o=k(r);if(i().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var l=this.decode(e),u=this.texData.get(l.dataId),c=(t=this.gpgpu).downloadMatrixFromPackedTexture.apply(t,[u.texture].concat(Yt(r))).subarray(0,o);return this.disposeData(l.dataId),c}var h=i().getBool("WEBGL_PACK")&&!0===s,d=h?Te(r):r,p=h?new ci(d):new ui(d),f=this.runWebGLProgram(p,[{shape:d,dtype:a,dataId:e}],"float32"),m=this.texData.get(f.dataId),g=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(m.texture,m.texShape[0],m.texShape[1]).subarray(0,o);return this.disposeData(f.dataId),g},a.prototype.time=function(e){return n(this,void 0,void 0,(function(){var t,n,a,s,o,l,u;return r(this,(function(r){switch(r.label){case 0:return t=this.activeTimers,n=[],a=!1,null==this.programTimersStack?(this.programTimersStack=n,a=!0):this.activeTimers.push(n),this.activeTimers=n,e(),s=I(this.activeTimers.map((function(e){return e.query}))).filter((function(e){return null!=e})),o=I(this.activeTimers.map((function(e){return e.name}))).filter((function(e){return null!=e})),this.activeTimers=t,a&&(this.programTimersStack=null),l={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},i().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(s)]:[3,2];case 1:return u=r.sent(),l.kernelMs=w(u),l.getExtraProfileInfo=function(){return u.map((function(e,t){return{name:o[t],ms:e}})).map((function(e){return e.name+": "+e.ms})).join(", ")},[3,3];case 2:l.kernelMs={error:"WebGL query timers are not supported in this environment."},r.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,l]}}))}))},a.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},a.prototype.startTimer=function(){return i().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:et(),endMs:null}},a.prototype.endTimer=function(e){return i().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=et(),e)},a.prototype.getQueryTime=function(e){return n(this,void 0,void 0,(function(){var t;return r(this,(function(n){return i().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(e)]:[2,(t=e).endMs-t.startMs]}))}))},a.prototype.disposeData=function(e){if(!this.pendingDisposal.has(e)){if(this.pendingRead.has(e))return this.pendingDisposal.add(e),void this.pendingDeletes++;if(this.texData.has(e)){this.releaseGPUData(e);var t=this.texData.get(e).complexTensors;null!=t&&(t.real.dispose(),t.imag.dispose()),this.texData.delete(e)}}},a.prototype.releaseGPUData=function(e){var t=this.texData.get(e),n=t.texture,r=t.dtype,a=t.texShape,i=t.usage,s=t.isPacked,o=t.slice,l=o&&o.origDataId||e,u=this.dataRefCount.get(l);u>1?this.dataRefCount.set(l,u-1):(this.dataRefCount.delete(l),null!=n&&(this.numBytesInGPU-=this.computeBytes(a,r),this.textureManager.releaseTexture(n,a,i,s)));var c=this.texData.get(e);c.texture=null,c.texShape=null,c.isPacked=!1,c.slice=null},a.prototype.getTexture=function(e){return this.uploadToGPU(e),this.texData.get(e).texture},a.prototype.getDataInfo=function(e){return this.texData.get(e)},a.prototype.getCPUBackend=function(){return i().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=Lt.findBackend("cpu")),this.cpuBackend):null},a.prototype.shouldExecuteOnCPU=function(e,t){var n=this;return void 0===t&&(t=128),null!=this.getCPUBackend()&&e.every((function(e){return null==n.texData.get(e.dataId).texture&&e.size<t}))},a.prototype.getGPGPUContext=function(){return this.gpgpu},a.prototype.complex=function(e,t){var n=this.makeOutput(e.shape,"complex64");return this.texData.get(n.dataId).complexTensors={real:Lt.keep(e.clone()),imag:Lt.keep(t.clone())},n},a.prototype.real=function(e){return this.texData.get(e.dataId).complexTensors.real.clone()},a.prototype.imag=function(e){return this.texData.get(e.dataId).complexTensors.imag.clone()},a.prototype.slice=function(e,t,n){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.slice(e,t,n);if(0===k(n))return Fn$1([],n,e.dtype);var r=this.texData.get(e.dataId).isPacked,a=io$1(e.shape,t,n);if(r||!a){var s=i().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new fs(n):new ls(n),o=s.getCustomSetupFunc(t);return this.compileAndRun(s,[e],null,o)}return this.uploadToGPU(e.dataId),this.shallowSlice(e,t,n)},a.prototype.shallowSlice=function(e,t,n){var r=this.texData.get(e.dataId),a=this.makeOutput(n,e.dtype),i=this.texData.get(a.dataId);Object.assign(i,r),i.shape=n,i.dtype=e.dtype;var s=so(t,e.strides);r.slice&&(s+=r.slice.flatOffset),i.slice={flatOffset:s,origDataId:r.slice&&r.slice.origDataId||e.dataId};var o=this.dataRefCount.get(i.slice.origDataId)||1;return this.dataRefCount.set(i.slice.origDataId,o+1),a},a.prototype.stridedSlice=function(e,t,n,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.stridedSlice(e,t,n,r);var a=ro(t,n,r);if(a.some((function(e){return 0===e})))return Fn$1([],a);var i=new ds(t,r,a);return this.compileAndRun(i,[e])},a.prototype.reverse=function(e,t){var n=i().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new is(e.shape,t):new as(e.shape,t);return this.compileAndRun(n,[e])},a.prototype.concat=function(e,t){if("complex64"===e[0].dtype){var n=e.map((function(e){return Tn(e)})),r=e.map((function(e){return Nn(e)}));return Dn(this.concat(n,t),this.concat(r,t))}if(this.shouldExecuteOnCPU(e))return this.cpuBackend.concat(e,t);if(1===e.length)return e[0];if(e.length>i().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var a=Math.floor(e.length/2),s=this.concat(e.slice(0,a),t),o=this.concat(e.slice(a),t);return this.concat([s,o],t)}if(i().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].rank>1){var l=new Ga(e.map((function(e){return e.shape})),t);return this.compileAndRun(l,e)}var u=Sn(e.map((function(e){return e.shape})),t),c=e.map((function(e){return e.as2D(-1,k(e.shape.slice(t)))})),h=new za(c.map((function(e){return e.shape})));return this.compileAndRun(h,c).reshape(u)},a.prototype.neg=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.neg(e);if(i().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Ts,e.dtype);var t=new Cs(e.shape,Ts);return this.compileAndRun(t,[e])},a.prototype.batchMatMul=function(e,t,n,r){var a=n?e.shape[2]:e.shape[1],i=r?t.shape[1]:t.shape[2],s=n?e.shape[1]:e.shape[2],o=e.shape[0];if((1===a||1===i)&&s>1e3){n&&(e=e.transpose([0,2,1])),r&&(t=t.transpose([0,2,1]));var l=1===i?e:e.as3D(o,s,1),u=1===i?2:1,c=1===i?t.as3D(o,1,s):t;return this.multiply(l,c).sum(u,!0)}var h=Dt(e.dtype,t.dtype),d=new Hi(e.shape,[o,a,i],n,r);return this.compileAndRun(d,[e,t],h)},a.prototype.fusedBatchMatMul=function(e){var t=e.a,n=e.b,r=e.transposeA,a=e.transposeB,i=e.bias,s=e.activation,o=e.preluActivationWeights,l=r?t.shape[2]:t.shape[1],u=a?n.shape[1]:n.shape[2],c=t.shape[0],h=Dt(t.dtype,n.dtype),d=null!=i,p=null!=o,f=s?Qs(s,!0):null,m=new Hi(t.shape,[c,l,u],r,a,d,f,p),g=[t,n];return i&&g.push(i),o&&g.push(o),this.compileAndRun(m,g,h)},a.prototype.multiply=function(e,t){if("complex64"===e.dtype){var n=this.texData.get(e.dataId),r=this.texData.get(t.dataId),a=new Na(Da,e.shape,t.shape),s=new Na(Ta,e.shape,t.shape),o=[this.makeComplexComponentTensorInfo(e,n.complexTensors.real),this.makeComplexComponentTensorInfo(e,n.complexTensors.imag),this.makeComplexComponentTensorInfo(t,r.complexTensors.real),this.makeComplexComponentTensorInfo(t,r.complexTensors.imag)],l=this.compileAndRun(a,o),u=this.compileAndRun(s,o),c=this.complex(l,u);return l.dispose(),u.dispose(),c}if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.multiply(e,t);if(i().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,Oa,e.dtype);var h=new Ba(Oa,e.shape,t.shape);return this.compileAndRun(h,[e,t],e.dtype)},a.prototype.batchNormalization=function(e,t,n,r,a,s){var o=[e,t,n],l=null;null!=s&&(l=s.shape,o.push(s));var u=null;if(null!=a&&(u=a.shape,o.push(a)),i().getBool("WEBGL_PACK_NORMALIZATION")){var c=new Aa(e.shape,t.shape,n.shape,l,u,r);return this.compileAndRun(c,o)}var h=new Sa(e.shape,t.shape,n.shape,l,u,r);return this.compileAndRun(h,o)},a.prototype.localResponseNormalization4D=function(e,t,n,r,a){var s=i().getBool("WEBGL_PACK_NORMALIZATION")?new Vi(e.shape,t,n,r,a):new Wi(e.shape,t,n,r,a);return this.compileAndRun(s,[e])},a.prototype.LRNGrad=function(e,t,n,r,a,i,s){var o=new Ui(t.shape,r,a,i,s);return this.compileAndRun(o,[t,n,e])},a.prototype.tile=function(e,t){if("string"===e.dtype){var n=this.readSync(e.dataId).map((function(e){return ot(e)}));return ta(dr(e.shape,e.dtype,n),t)}var r=new gs(e.shape,t);return this.compileAndRun(r,[e])},a.prototype.pad=function(e,t,n){var r=i().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Yi(e.shape,t,n):new Xi(e.shape,t,n);return this.compileAndRun(r,[e])},a.prototype.transpose=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.transpose(e,t);var n=i().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new xs(e.shape,t):new ys(e.shape,t);return this.compileAndRun(n,[e])},a.prototype.gather=function(e,t,n){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.gather(e,t,n);var r=new mi(e.shape,t.size,n);return this.compileAndRun(r,[e,t])},a.prototype.batchToSpaceND=function(e,t,n){C(e.rank<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"}));var r=t.reduce((function(e,t){return e*t})),a=zr(e.shape,t,r),i=Gr(a.length,t.length),s=Hr(e.shape,t,r),o=qr$1(n,t.length),l=Kr(s,n,t.length);return e.reshape(a).transpose(i).reshape(s).slice(o,l)},a.prototype.spaceToBatchND=function(e,t,n){C(e.rank<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"}));var r=t.reduce((function(e,t){return e*t})),a=[[0,0]];a.push.apply(a,n);for(var i=1+t.length;i<e.shape.length;++i)a.push([0,0]);var s=e.pad(a),o=zr(s.shape,t,r,!1),l=Gr(o.length,t.length,!1),u=Hr(s.shape,t,r,!1);return s.reshape(o).transpose(l).reshape(u)},a.prototype.reduce=function(e,t,n){var r=e.shape[0],a=e.shape[1],i=$r(a),s=new Ji({windowSize:i,inSize:a,batchSize:r},t),o=this.compileAndRun(s,[e],n);return 1===o.shape[1]?o:this.reduce(o,t,n)},a.prototype.argReduce=function(e,t,n){void 0===n&&(n=null);var r=e.shape[0],a=e.shape[1];null!=n&&(r=n.shape[0],a=n.shape[1]);var i=$r(a),s=new aa({windowSize:i,inSize:a,batchSize:r},t,null==n),o=[e];null!=n&&o.push(n);var l=this.compileAndRun(s,o,"int32");return 1===l.shape[1]?l:this.argReduce(e,t,l)},a.prototype.argReducePacked=function(e,t,n){void 0===n&&(n=null);var r=null!=n?n.shape:e.shape,a=$r(r[r.length-1]),i=new Ra(r,a,t,null==n),s=null==n?[e]:[e,n],o=this.compileAndRun(i,s,"int32");return o.rank===e.rank?this.argReducePacked(e,t,o):o},a.prototype.sum=function(e,t){Cn("sum",t,e.rank);var n=bn(e.shape,t),r=n[0],a=k(n[1]),i=e.as2D(-1,a),s=Tt(e.dtype);return this.reduce(i,"sum",s).reshape(r)},a.prototype.prod=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.prod(e,t);var n=bn(e.shape,t),r=n[0],a=k(n[1]),i=e.as2D(-1,a),s=Tt(e.dtype);return this.reduce(i,"prod",s).reshape(r)},a.prototype.unsortedSegmentSum=function(e,t,n){var r=0,a=En([r],e.rank),i=e;null!=a&&(i=e.transpose(a),r=In(1,e.rank)[0]);var s=function(e,t,n){for(var r=[],a=e.length,i=0;i<a;i++)i!==t?r.push(e[i]):r.push(n);return r}(i.shape,r,n),o=k([i.shape[r]]),l=i.as2D(-1,o),u=Tt(e.dtype),c=this.segOpCompute(l,"unsortedSegmentSum",t,u,n).reshape(s);return null!=a&&(c=c.transpose(Rn(a))),c},a.prototype.segOpCompute=function(e,t,n,r,a){var i=e.shape[0],s=e.shape[1],o=function(e,t){var n,r=!1;for(e<=Yr?(n=e,r=!0):n=Y(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=Y(e,n+1);return n}(s,a),l=new us({windowSize:o,inSize:s,batchSize:i,numSegments:a}),u=this.compileAndRun(l,[e,n],r);return u.shape[1]===a?u:(n=Kn(0,a).tile([s/o]),this.segOpCompute(u,t,n,r,a))},a.prototype.argMinMaxReduce=function(e,t,n){var r=[t];if(Cn("arg"+n.charAt(0).toUpperCase()+n.slice(1),r,e.rank),!i().getBool("WEBGL_PACK_REDUCE")||e.rank<=2){var a=bn(e.shape,r),s=a[0],o=k(a[1]),l=e.as2D(-1,o);return this.argReduce(l,n).reshape(s)}return this.argReducePacked(e,n)},a.prototype.argMin=function(e,t){return this.argMinMaxReduce(e,t,"min")},a.prototype.argMax=function(e,t){return this.argMinMaxReduce(e,t,"max")},a.prototype.cumsum=function(e,t,n,r){if(t!==e.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(e.rank-1)+" but got axis="+t);var a=new ni(e.shape,n,r);return this.compileAndRun(a,[e])},a.prototype.equal=function(e,t){if(i().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(equal(a, b));\n","bool");var n=new Ba("return float(a == b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},a.prototype.notEqual=function(e,t){if(i().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(notEqual(a, b));\n","bool");var n=new Ba("return float(a != b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},a.prototype.less=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.less(e,t);if(i().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThan(a, b));\n","bool");var n=new Ba("return float(a < b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},a.prototype.lessEqual=function(e,t){if(i().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThanEqual(a, b));\n","bool");var n=new Ba("return float(a <= b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},a.prototype.greater=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.greater(e,t);if(i().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThan(a, b));\n","bool");var n=new Ba("return float(a > b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},a.prototype.greaterEqual=function(e,t){if(i().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var n=new Ba("return float(a >= b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},a.prototype.logicalNot=function(e){var t=new Cs(e.shape,"return float(!(x >= 1.0));");return this.compileAndRun(t,[e])},a.prototype.logicalAnd=function(e,t){if(i().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var n=new Ba("return float(a >= 1.0 && b >= 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},a.prototype.logicalOr=function(e,t){if(i().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var n=new Ba("return float(a >= 1.0 || b >= 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},a.prototype.select=function(e,t,n){var r=new cs(e.rank,t.shape,t.rank);return this.compileAndRun(r,[e,t,n],Dt(t.dtype,n.dtype))},a.prototype.where=function(e){dn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return na(e.shape,t)},a.prototype.topk=function(e,t,n){return ea(e.dataSync(),e.shape,e.dtype,t)},a.prototype.min=function(e,t){Cn("min",t,e.rank);var n=bn(e.shape,t),r=n[0],a=k(n[1]),i=e.as2D(-1,a);return this.reduce(i,"min",i.dtype).reshape(r)},a.prototype.minimum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.minimum(e,t);var n=i().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new La("\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new Ba("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},a.prototype.mod=function(e,t){var n=i().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new La("\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new Ba("if (b == 0.0) return NAN;\n  return mod(a, b);",e.shape,t.shape);return this.compileAndRun(n,[e,t])},a.prototype.max=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.max(e,t);Cn("max",t,e.rank);var n=bn(e.shape,t),r=n[0],a=k(n[1]),i=e.as2D(-1,a);return this.reduce(i,"max",i.dtype).reshape(r)},a.prototype.maximum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.maximum(e,t);var n=i().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new La("\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new Ba("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},a.prototype.all=function(e,t){Cn("all",t,e.rank);var n=bn(e.shape,t),r=n[0],a=k(n[1]),i=e.as2D(-1,a);return this.reduce(i,"all",i.dtype).reshape(r)},a.prototype.any=function(e,t){Cn("any",t,e.rank);var n=bn(e.shape,t),r=n[0],a=k(n[1]),i=e.as2D(-1,a);return this.reduce(i,"any",i.dtype).reshape(r)},a.prototype.realDivide=function(e,t){if(i().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n","float32",!0);var n=new Ba("\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",e.shape,t.shape);return this.compileAndRun(n,[e,t],"float32")},a.prototype.floorDiv=function(e,t){if(i().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n","int32");var n=new Ba("\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",e.shape,t.shape);return this.compileAndRun(n,[e,t],"int32")},a.prototype.add=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,Fa);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.add(e,t);var n=Dt(e.dtype,t.dtype);if(i().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,Fa,n);var r=new Ba(Fa,e.shape,t.shape);return this.compileAndRun(r,[e,t],n)},a.prototype.packedUnaryOp=function(e,t,n){var r=new Xs(e.shape,t);return this.compileAndRun(r,[e],n)},a.prototype.packedBinaryOp=function(e,t,n,r,a){void 0===a&&(a=!1);var i=new La(n,e.shape,t.shape,a);return this.compileAndRun(i,[e,t],r)},a.prototype.complexSeparableBinaryOp=function(e,t,n){var r=this,a=this.texData.get(e.dataId),i=this.texData.get(t.dataId),s=[[a.complexTensors.real,i.complexTensors.real],[a.complexTensors.imag,i.complexTensors.imag]].map((function(a){var i=a[0],s=a[1],o=r.makeComplexComponentTensorInfo(e,i),l=r.makeComplexComponentTensorInfo(t,s),u=new Ba(n,e.shape,t.shape);return r.compileAndRun(u,[o,l],Dt(i.dtype,s.dtype))})),o=s[0],l=s[1],u=this.complex(o,l);return o.dispose(),l.dispose(),u},a.prototype.makeComplexComponentTensorInfo=function(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}},a.prototype.addN=function(e){if(1===e.length)return e[0];if(e.length>i().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var t=Math.floor(e.length/2),n=this.addN(e.slice(0,t)),r=this.addN(e.slice(t));return this.addN([n,r])}var a=e.map((function(e){return e.dtype})).reduce((function(e,t){return Dt(e,t)})),s=e.map((function(e){return e.shape})),o=i().getBool("WEBGL_PACK")?new oa(e[0].shape,s):new ra(e[0].shape,s);return this.compileAndRun(o,e,a)},a.prototype.subtract=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,_a);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.subtract(e,t);var n=Dt(e.dtype,t.dtype);if(i().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,_a,e.dtype);var r=new Ba(_a,e.shape,t.shape);return this.compileAndRun(r,[e,t],n)},a.prototype.pow=function(e,t){var n=i().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new La("\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new Ba("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nif (b == 0.0) {\n  return 1.0;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",e.shape,t.shape),r=Dt(e.dtype,t.dtype);return this.compileAndRun(n,[e,t],r)},a.prototype.ceil=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.ceil(e);if(i().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Ns,e.dtype);var t=new Cs(e.shape,Ns);return this.compileAndRun(t,[e])},a.prototype.floor=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.floor(e);if(i().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Fs,e.dtype);var t=new Cs(e.shape,Fs);return this.compileAndRun(t,[e])},a.prototype.sign=function(e){var t=new Cs(e.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(t,[e])},a.prototype.isNaN=function(e){var t=new Cs(e.shape,"return float(isnan(x));");return this.compileAndRun(t,[e],"bool")},a.prototype.isInf=function(e){var t=new Cs(e.shape,"return float(isinf(x));");return this.compileAndRun(t,[e],"bool")},a.prototype.isFinite=function(e){var t=new Cs(e.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(t,[e],"bool")},a.prototype.round=function(e){var t=new Cs(e.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(t,[e])},a.prototype.exp=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.exp(e);if(i().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,_s,e.dtype);var t=new Cs(e.shape,_s);return this.compileAndRun(t,[e])},a.prototype.expm1=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.expm1(e);if(i().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Os,e.dtype);var t=new Cs(e.shape,Os);return this.compileAndRun(t,[e])},a.prototype.softmax=function(e,t){var n=O([t],e.shape),r=this.max(e,n),a=wn(r.shape,n),i=this.subtract(e,r.reshape(a)),s=this.exp(i),o=this.sum(s,n).reshape(a);return this.realDivide(s,o)},a.prototype.log=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.log(e);if(i().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",e.dtype);var t=new Cs(e.shape,"if (x < 0.0) return NAN;\n  return log(x);");return this.compileAndRun(t,[e])},a.prototype.log1p=function(e){var t=new Cs(e.shape,"return log(1.0 + x);");return this.compileAndRun(t,[e])},a.prototype.sqrt=function(e){var t=new Cs(e.shape,"return sqrt(x);");return this.compileAndRun(t,[e])},a.prototype.rsqrt=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.rsqrt(e);var t=new Cs(e.shape,"return inversesqrt(x);");return this.compileAndRun(t,[e])},a.prototype.reciprocal=function(e){var t=new Cs(e.shape,"return 1.0 / x;");return this.compileAndRun(t,[e])},a.prototype.relu=function(e){var t;return t=i().getBool("WEBGL_PACK")?new Xs(e.shape,qs):new Cs(e.shape,ks),this.compileAndRun(t,[e])},a.prototype.relu6=function(e){var t;return t=i().getBool("WEBGL_PACK")?new Xs(e.shape,Ks):new Cs(e.shape,Ss),this.compileAndRun(t,[e])},a.prototype.prelu=function(e,t){var n=i().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new La(Pa,e.shape,t.shape):new Ba(Ma,e.shape,t.shape);return this.compileAndRun(n,[e,t])},a.prototype.elu=function(e){if(i().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,js,e.dtype);var t=new Cs(e.shape,As);return this.compileAndRun(t,[e])},a.prototype.eluDer=function(e,t){var n=i().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new La("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",e.shape,t.shape):new Ba("return (b >= 1.0) ? a : a * (b + 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t])},a.prototype.selu=function(e){var t=new Cs(e.shape,Ds);return this.compileAndRun(t,[e])},a.prototype.int=function(e){var t=new Cs(e.shape,"return float(int(x));");return this.compileAndRun(t,[e],"int32")},a.prototype.clip=function(e,t,n){var r,a=(r=i().getBool("WEBGL_PACK_CLIP")?new Ua(e.shape):new Wa(e.shape)).getCustomSetupFunc(t,n);return this.compileAndRun(r,[e],null,a)},a.prototype.abs=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.abs(e);if(i().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Is,e.dtype);var t=new Cs(e.shape,Is);return this.compileAndRun(t,[e])},a.prototype.complexAbs=function(e){var t=this.texData.get(e.dataId),n=new Va(e.shape),r=[this.makeComplexComponentTensorInfo(e,t.complexTensors.real),this.makeComplexComponentTensorInfo(e,t.complexTensors.imag)];return this.compileAndRun(n,r)},a.prototype.sigmoid=function(e){var t=new Cs(e.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(t,[e])},a.prototype.softplus=function(e){var t=new Cs(e.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(t,[e])},a.prototype.sin=function(e){var t=new Cs(e.shape,Ms);return this.compileAndRun(t,[e])},a.prototype.cos=function(e){var t=new Cs(e.shape,Bs);return this.compileAndRun(t,[e])},a.prototype.tan=function(e){var t=new Cs(e.shape,"return tan(x);");return this.compileAndRun(t,[e])},a.prototype.asin=function(e){var t=new Cs(e.shape,Ps);return this.compileAndRun(t,[e])},a.prototype.acos=function(e){var t=new Cs(e.shape,Ls);return this.compileAndRun(t,[e])},a.prototype.atan=function(e){var t=new Cs(e.shape,Ws);return this.compileAndRun(t,[e])},a.prototype.atan2=function(e,t){var n=i().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new La("\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new Ba("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},a.prototype.sinh=function(e){var t=new Cs(e.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])},a.prototype.cosh=function(e){var t=new Cs(e.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])},a.prototype.tanh=function(e){var t=new Cs(e.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(t,[e])},a.prototype.asinh=function(e){var t=new Cs(e.shape,Us);return this.compileAndRun(t,[e])},a.prototype.acosh=function(e){var t=new Cs(e.shape,Vs);return this.compileAndRun(t,[e])},a.prototype.atanh=function(e){var t=new Cs(e.shape,zs);return this.compileAndRun(t,[e])},a.prototype.erf=function(e){var t=new Cs(e.shape,'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n');return this.compileAndRun(t,[e])},a.prototype.step=function(e,t){var n,r=new Cs(e.shape,(void 0===(n=t)&&(n=0),Es+"\n    return x > 0.0 ? 1.0 : float("+n+");\n  "));return this.compileAndRun(r,[e])},a.prototype.conv2dByMatMul=function(e,t,n,r,a,s){var o=e.shape,l=this.texData.get(e.dataId),u=n.inChannels,c=o[0]*o[1]*o[2],h=n.outChannels,d="channelsLast"===n.dataFormat,p=(1===c||1===h)&&u>1e3,f=o[2]%2!=0&&!!l.isPacked;if(p||!i().getBool("WEBGL_LAZILY_UNPACK")||!i().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!f){var m=d?o[0]*o[1]*o[2]:o[0]*o[2]*o[3],g=this.reshape(e,[1,m,n.inChannels]),y=this.reshape(t,[1,n.inChannels,n.outChannels]);return this.reshape(this.fusedBatchMatMul({a:g,b:y,transposeA:!1,transposeB:!1,bias:r,activation:a,preluActivationWeights:s}),n.outShape)}var v=d?o[0]*o[1]*(o[2]+1):o[0]*o[2]*(o[3]+1),b={dataId:e.dataId,shape:[1,v,n.inChannels],dtype:e.dtype},x=l.shape;l.shape=l.shape.slice(),l.shape[l.shape.length-2]++,C(_e(l.shape,b.shape),(function(){return"packed reshape "+l.shape+" to "+b.shape+" isn't free"}));var T=this.reshape(t,[1,n.inChannels,n.outChannels]),_=this.fusedBatchMatMul({a:b,b:T,transposeA:!1,transposeB:!1,bias:r,activation:a,preluActivationWeights:s}),w=this.texData.get(_.dataId);return C(w.isPacked,(function(){return"batchMatMul result is expected to be packed"})),l.shape=x,w.shape=n.outShape,Lt.makeTensorFromDataId(_.dataId,n.outShape,_.dtype)},a.prototype.conv2dWithIm2Row=function(e,t,n,r,a,i){var s=n.filterWidth,o=n.filterHeight,l=n.inChannels,u=n.outWidth,c=n.outHeight,h="channelsLast"===n.dataFormat,d=s*o*l,p=c*u,f=[d,p],m=e.squeeze([0]),g=t.reshape([1,d,-1]),y=new Li(f,m.shape,n),v=this.compileAndRun(y,[m]).reshape([1,f[0],f[1]]),b=null!=r,x=null!=i,T=a?Qs(a,!0):null,_=new Hi(v.shape,[1,p,n.outChannels],!0,!1,b,T,x),w=[v,g];r&&w.push(r),x&&w.push(i);var S=this.compileAndRun(_,w);return h?S.reshape([1,c,u,n.outChannels]):S.reshape([1,n.outChannels,c,u])},a.prototype.fusedConv2d=function(e){var t=e.input,n=e.filter,r=e.convInfo,a=e.bias,s=e.activation,o=e.preluActivationWeights;if(1===r.filterHeight&&1===r.filterWidth&&1===r.dilationHeight&&1===r.dilationWidth&&1===r.strideHeight&&1===r.strideWidth&&("SAME"===r.padInfo.type||"VALID"===r.padInfo.type))return this.conv2dByMatMul(t,n,r,a,s,o);if(i().getBool("WEBGL_CONV_IM2COL")&&1===t.shape[0])return this.conv2dWithIm2Row(t,n,r,a,s,o);var l=null!=a,u=null!=o,c=s?Qs(s,!1):null,h=new Qa(r,l,c,u),d=[t,n];return a&&d.push(a),o&&d.push(o),this.compileAndRun(h,d)},a.prototype.conv2d=function(e,t,n){if(1===n.filterHeight&&1===n.filterWidth&&1===n.dilationHeight&&1===n.dilationWidth&&1===n.strideHeight&&1===n.strideWidth&&("SAME"===n.padInfo.type||"VALID"===n.padInfo.type))return this.conv2dByMatMul(e,t,n);if(i().getBool("WEBGL_CONV_IM2COL")&&1===e.shape[0])return this.conv2dWithIm2Row(e,t,n);var r=new Qa(n);return this.compileAndRun(r,[e,t])},a.prototype.conv2dDerInput=function(e,t,n){var r=new Ka(n);return this.compileAndRun(r,[e,t])},a.prototype.conv2dDerFilter=function(e,t,n){var r=new qa(n);return this.compileAndRun(r,[e,t])},a.prototype.fusedDepthwiseConv2D=function(e){var t,n=e.input,r=e.filter,a=e.convInfo,s=e.bias,o=e.activation,l=e.preluActivationWeights,u=i().getBool("WEBGL_PACK_DEPTHWISECONV")&&a.strideWidth<=2&&a.outChannels/a.inChannels==1,c=o?Qs(o,u):null,h=[n,r],d=null!=s,p=null!=l;return d&&h.push(s),p&&h.push(l),u?(t=new ti(a,d,c,p),this.compileAndRun(t,h)):(t=new Za(a,d,c,p),this.compileAndRun(t,h))},a.prototype.depthwiseConv2D=function(e,t,n){var r;return i().getBool("WEBGL_PACK_DEPTHWISECONV")&&n.strideWidth<=2&&n.outChannels/n.inChannels==1?(r=new ti(n),this.compileAndRun(r,[e,t])):(r=new Za(n),this.compileAndRun(r,[e,t]))},a.prototype.depthwiseConv2DDerInput=function(e,t,n){var r=new $a(n);return this.compileAndRun(r,[e,t])},a.prototype.depthwiseConv2DDerFilter=function(e,t,n){var r=new Ya(n);return this.compileAndRun(r,[e,t])},a.prototype.conv3d=function(e,t,n){var r=new Ja(n);return this.compileAndRun(r,[e,t])},a.prototype.conv3dDerInput=function(e,t,n){var r=new Xa(n);return this.compileAndRun(r,[e,t])},a.prototype.conv3dDerFilter=function(e,t,n){var r=new ja(n);return this.compileAndRun(r,[e,t])},a.prototype.maxPool=function(e,t){var n=new $i(t,"max",!1);return this.compileAndRun(n,[e])},a.prototype.avgPool=function(e,t){var n=new $i(t,"avg",!1);return this.compileAndRun(n,[e],"float32")},a.prototype.maxPoolBackprop=function(e,t,n,r){var a=new $i(r,"max",!0),i=this.compileAndRun(a,[t]),s=new zi(r),o=this.compileAndRun(s,[e,i],t.dtype);return i.dispose(),o},a.prototype.avgPoolBackprop=function(e,t,n){var r=new Ia(n);return this.compileAndRun(r,[e],t.dtype)},a.prototype.cast=function(e,t){return Po(e,t,this)},a.prototype.unstack=function(e,t){for(var n=e.shape[t],r=new Array(e.rank-1),a=0,i=0;i<e.rank;i++)i!==t&&(r[a++]=e.shape[i]);var s=new Array(e.rank).fill(0),o=e.shape.slice();o[t]=1;var l=new Array(n);for(i=0;i<l.length;i++)s[t]=i,l[i]=this.slice(e,s,o).reshape(r);return l},a.prototype.avgPool3d=function(e,t){var n=new Qi(t,"avg",!1);return this.compileAndRun(n,[e],"float32")},a.prototype.avgPool3dBackprop=function(e,t,n){var r=new ka(n);return this.compileAndRun(r,[e],t.dtype)},a.prototype.maxPool3d=function(e,t){var n=new Qi(t,"max",!1);return this.compileAndRun(n,[e],"float32")},a.prototype.maxPool3dBackprop=function(e,t,n,r){var a=new Qi(r,"max",!0),i=this.compileAndRun(a,[t]),s=new Gi(r),o=this.compileAndRun(s,[e,i],t.dtype);return i.dispose(),o},a.prototype.reshape=function(e,t){var n=this.texData.get(e.dataId);if(n.isPacked&&!_e(e.shape,t)&&(null===n.texture||!_e(n.shape,t))){var r=this.packedReshape(e,t);return Lt.makeTensorFromDataId(r.dataId,r.shape,r.dtype)}return Lo(e,t)},a.prototype.resizeBilinear=function(e,t,n,r){var a=i().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new ns(e.shape,t,n,r):new es(e.shape,t,n,r);return this.compileAndRun(a,[e],"float32")},a.prototype.resizeBilinearBackprop=function(e,t,n){var r=new ts(e,t,n);return this.compileAndRun(r,[e])},a.prototype.resizeNearestNeighbor=function(e,t,n,r){var a=new os(e.shape,t,n,r);return this.compileAndRun(a,[e])},a.prototype.resizeNearestNeighborBackprop=function(e,t,n){var r=new rs(e,t,n);return this.compileAndRun(r,[e])},a.prototype.multinomial=function(e,t,n,r){var a=t?e:go(e),i=a.shape[0],s=a.shape[1],o=new qi(i,s,n),l=o.getCustomSetupFunc(r);return this.compileAndRun(o,[a],"int32",l)},a.prototype.oneHot=function(e,t,n,r){var a=new Ki(e.size,t,n,r);return this.compileAndRun(a,[e])},a.prototype.diag=function(e){var t=new si(e.size);return this.compileAndRun(t,[e])},a.prototype.nonMaxSuppression=function(e,t,n,r,a){return dn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),jo(e.dataSync(),t.dataSync(),n,r,a)},a.prototype.cropAndResize=function(e,t,n,r,a,i){var s=new ei(e.shape,t.shape,r,a,i);return this.compileAndRun(s,[e,t,n],"float32")},a.prototype.depthToSpace=function(e,t,n){C(t>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+t}));var r=e.shape[0],a="NHWC"===n?e.shape[1]:e.shape[2],i="NHWC"===n?e.shape[2]:e.shape[3],s="NHWC"===n?e.shape[3]:e.shape[1],o=a*t,l=i*t,u=s/(t*t),c=new ii("NHWC"===n?[r,o,l,u]:[r,u,o,l],t,n);return this.compileAndRun(c,[e])},a.prototype.split=function(e,t,n){return Zo(e,t,n)},a.prototype.scatterND=function(e,t,n){var r=Zr(0,e,n),a=r.sliceRank,i=r.numUpdates,s=r.sliceSize,o=r.strides,l=r.outputSize,u=[l/s,s],c=e.reshape([i,a]),h=t.reshape([i,s]);if(0===l)return Lo(Fn$1([]),n);var d=On(0),p=new ss(i,a,c.rank,h.rank,o,u);return this.compileAndRun(p,[h,c,d]).reshape(n)},a.prototype.sparseToDense=function(e,t,n,r){var a=Zr(0,e,n),i=a.sliceRank,s=a.numUpdates,o=a.strides,l=a.outputSize,u=new ss(s,i,e.rank,t.rank,o,[l,1]);return this.compileAndRun(u,[t,e,r]).reshape(n)},a.prototype.fft=function(e){return this.fftImpl(e,!1)},a.prototype.ifft=function(e){return this.fftImpl(e,!0)},a.prototype.fftImpl=function(e,t){var n=this.texData.get(e.dataId),r=new pi(fi,e.shape,t),a=new pi(di,e.shape,t),i=[this.makeComplexComponentTensorInfo(e,n.complexTensors.real),this.makeComplexComponentTensorInfo(e,n.complexTensors.imag)],s=this.compileAndRun(r,i),o=this.compileAndRun(a,i),l=this.complex(s,o).as2D(e.shape[0],e.shape[1]);return s.dispose(),o.dispose(),l},a.prototype.gatherND=function(e,t){var n=t.shape,r=n[n.length-1],a=jr(e,t),i=a[0],s=a[1],o=a[2],l=a[3],u=t.reshape([s,r]),c=e.reshape([e.size/o,o]),h=new gi(r,l,[s,o]);return this.compileAndRun(h,[c,u]).reshape(i)},a.prototype.fill=function(e,t,n){if("string"===(n=n||j(t))){var r=P(n,k(e));return r.fill(t),Lt.makeTensor(r,e,n,this)}var a=new vi(e,t),i=a.getCustomSetupFunc(t);return this.compileAndRun(a,[],n,i)},a.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(e.shape,1,e.dtype)},a.prototype.zerosLike=function(e){return this.fill(e.shape,"string"===e.dtype?"":0,e.dtype)},a.prototype.linspace=function(e,t,n){return Wo(e,t,n)},a.prototype.makeTensorInfo=function(e,t){var n=this.write(null,e,t);return this.texData.get(n).usage=null,{dataId:n,shape:e,dtype:t}},a.prototype.makeOutput=function(e,t){var n=this.makeTensorInfo(e,t).dataId;return Lt.makeTensorFromDataId(n,e,t,this)},a.prototype.unpackTensor=function(e){var t=new Ys(e.shape);return this.runWebGLProgram(t,[e],e.dtype)},a.prototype.packTensor=function(e){var t=new ji(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)},a.prototype.packedReshape=function(e,t){var n=[Ae(e.shape)].concat(De(e.shape)),r={dtype:e.dtype,shape:n,dataId:e.dataId},a=[Ae(t)].concat(De(t)),i=new Zi(a,n),s=this.runWebGLProgram(i,[r],e.dtype,null,!0);return{dataId:s.dataId,shape:t,dtype:s.dtype}},a.prototype.decode=function(e){var t,n=this.texData.get(e),r=n.isPacked,a=n.shape,i=n.dtype,s=Te(a);return t=r?new ai(s):new oi(s),{dtype:i,shape:a,dataId:this.runWebGLProgram(t,[{shape:s,dtype:i,dataId:e}],i,null,!0).dataId}},a.prototype.runWebGLProgram=function(e,t,n,r,a){var s=this;void 0===a&&(a=!1);var o=this.makeTensorInfo(e.outputShape,n),l=this.texData.get(o.dataId);if(e.packedOutput&&(l.isPacked=!0),e.outPackingScheme===Vt.DENSE){var u=Yt(e.outputShape);l.texShape=u.map((function(e){return 2*e}))}if(null!=e.outTexUsage&&(l.usage=e.outTexUsage),0===k(o.shape))return l.values=B(o.dtype,0),o;var c=[],h=t.map((function(t){if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=s.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&k(t.shape)<=i().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}else if(!!n.isPacked!=!!e.packedInputs)t=n.isPacked?s.unpackTensor(t):s.packTensor(t),c.push(t),n=s.texData.get(t.dataId);else if(n.isPacked&&!_e(n.shape,t.shape)){var r=t,a=t.shape;t.shape=n.shape,t=s.packedReshape(t,a),c.push(t),n=s.texData.get(t.dataId),r.shape=a}return s.uploadToGPU(t.dataId),{shape:t.shape,texData:n,isUniform:!1}}));this.uploadToGPU(o.dataId);var d,p={shape:o.shape,texData:l,isUniform:!1},f=function(e,t,n){var r="";t.concat(n).forEach((function(e){var t=null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0,n=e.isUniform?"uniform":e.texData.texShape;r+=e.shape+"_"+n+"_"+t}));var a=e.userCode;return e.constructor.name+"_"+r+"_"+a}(e,h,p),m=this.getAndSaveBinary(f,(function(){return function(e,t,n,r){var a=t.userCode,s=n.map((function(e,n){var r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}})),o=s.map((function(e){return e.shapeInfo})),l={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},u=fa(s,l,a,t.packedInputs),c=e.createProgram(u),h=null,d=e.getUniformLocation(c,"NAN",!1);1===i().getNumber("WEBGL_VERSION")&&(h=e.getUniformLocation(c,"INFINITY",!1));for(var p={},f=0;f<t.variableNames.length;f++){var m=t.variableNames[f];p[m]=e.getUniformLocation(c,m,!1),p["offset"+m]=e.getUniformLocation(c,"offset"+m,!1)}return{program:t,source:u,webGLProgram:c,uniformLocations:p,inShapeInfos:o,outShapeInfo:l,infLoc:h,nanLoc:d}}(s.gpgpu,e,h,p)})),g=null!=this.activeTimers;if(g&&(d=this.startTimer()),function(e,t,n,r,a){Pi(t.inShapeInfos,n),Pi([t.outShapeInfo],[r]);var s=r.texData.texture,o=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(s,o[0],o[1]):e.setOutputMatrixTexture(s,o[0],o[1]),e.setProgram(t.webGLProgram),1===i().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN),n.forEach((function(n,r){var a=t.program.variableNames[r],i=t.uniformLocations[a],s=t.uniformLocations["offset"+a];if(null!=i)if(n.isUniform)if(k(n.shape)<2)e.gl.uniform1f(i,n.uniformValues[0]);else{var o=n.uniformValues;o instanceof Float32Array||(o=new Float32Array(o)),e.gl.uniform1fv(i,o)}else null!=n.texData.slice&&null!=s&&e.gl.uniform1i(s,n.texData.slice.flatOffset),e.setInputMatrixTexture(n.texData.texture,i,r)})),null!=a&&a(e,t.webGLProgram),e.executeProgram()}(this.gpgpu,m,h,p,r),c.forEach((function(e){return s.disposeData(e.dataId)})),g&&(d=this.endTimer(d),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(d)})),!i().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&!1===a){var y=this.unpackTensor(o);return this.disposeData(o.dataId),y}return o},a.prototype.compileAndRun=function(e,t,n,r,a){void 0===a&&(a=!1),n=n||t[0].dtype;var i=this.runWebGLProgram(e,t,n,r,a);return Lt.makeTensorFromDataId(i.dataId,i.shape,i.dtype)},a.prototype.getAndSaveBinary=function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]},a.prototype.getTextureManager=function(){return this.textureManager},a.prototype.dispose=function(){var e=this;this.disposed||(i().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach((function(t){e.gpgpu.deleteProgram(e.binaryCache[t].webGLProgram),delete e.binaryCache[t]})),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},a.prototype.floatPrecision=function(){var e=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=Ze((function(){if(!i().get("WEBGL_RENDER_FLOAT32_ENABLED")){var t=i().getBool("DEBUG");i().set("DEBUG",!1);var n=e.abs(On(1e-8)).dataSync()[0];if(i().set("DEBUG",t),n>0)return 32}return 16}))),this.floatPrecisionValue},a.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},a.prototype.uploadToGPU=function(e){var t,n=this.texData.get(e),r=n.shape,a=n.dtype,i=n.values,s=n.texture,o=n.usage,l=n.isPacked;if(null==s){var u,c=null!=this.activeTimers;c&&(u=et());var h=n.texShape;if(null==h&&(h=Ne(r,l),n.texShape=h),null!=i){var d=Te(r),p=void 0,f=h[1],m=h[0],g=i instanceof Uint8Array;l?(f=(t=$t(h[0],h[1]))[0],m=t[1],p=new hi(d,[m,f],g)):p=new li(d,[m,f],g);var y=this.makeTensorInfo([m,f],a);this.texData.get(y.dataId).usage=g?zt.PIXELS:zt.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(y.dataId),f,m,i);var v=this.runWebGLProgram(p,[y],a,null,!0),b=this.texData.get(v.dataId);n.texture=b.texture,n.texShape=b.texShape,n.isPacked=b.isPacked,n.usage=b.usage,this.disposeData(y.dataId),this.texData.delete(v.dataId),n.values=null,c&&(this.uploadWaitMs+=et()-u)}else{var x=this.acquireTexture(h,o,a,l);n.texture=x}}},a.prototype.convertAndCacheOnCPU=function(e,t){var n=this.texData.get(e),r=n.dtype;return this.releaseGPUData(e),null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){for(var n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length),r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}throw new Error("Unknown dtype "+t)}(t,r)),n.values},a.prototype.acquireTexture=function(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+a+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(e,t,r)},a.prototype.computeBytes=function(e,t){return e[0]*e[1]*z(t)},a}(bo);Wt()&&Lt.registerBackend("webgl",(function(){return new Zs}),2);var tu=An({square_:function(e){var t=mn(e,"x","square"),n=[t];return Lt.runKernelFunc((function(e,n){return n([t]),e.square(t)}),{x:t},null,"Square",{},n,[])}}),eu="SquaredDifference",nu=An({squaredDifference_:function(e,t){var n,r=mn(e,"a","squaredDifference"),a=mn(t,"b","squaredDifference");n=Nt(r,a),r=n[0],a=n[1],Ro(r.shape,a.shape);var i={a:r,b:a},s=[r,a];return Lt.runKernelFunc((function(e,t){var n=e.squaredDifference(r,a);return t([r,a]),n}),i,(function(e,t){var n=t[0],r=t[1],a=On(2);return{a:function(){return e.mul(n.sub(r).mul(a))},b:function(){return e.mul(r.sub(n).mul(a))}}}),eu,{},s,[])}}),ru=An({abs_:function(e){var t=mn(e,"x","abs");return"complex64"===t.dtype?Lt.runKernelFunc((function(e){return e.complexAbs(t)}),{$x:t}):Lt.runKernelFunc((function(e,n){var r=e.abs(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.mul(n.toFloat().step(-1))}}}),"Abs")}}),ou=An({acos_:function(e){var t=mn(e,"x","acos");return Lt.runKernelFunc((function(e,n){var r=e.acos(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(On(1).sub(n.toFloat().square()).sqrt()).neg()}}}))}}),au=An({acosh_:function(e){var t=mn(e,"x","acosh");return Lt.runKernelFunc((function(e,n){var r=e.acosh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(n.toFloat().square().sub(1).sqrt())}}}))}}),iu=An({asin_:function(e){var t=mn(e,"x","asin");return Lt.runKernelFunc((function(e,n){var r=e.asin(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(On(1).sub(n.toFloat().square()).sqrt())}}}))}}),su=An({asinh_:function(e){var t=mn(e,"x","asinh");return Lt.runKernelFunc((function(e,n){var r=e.asinh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(On(1).add(n.toFloat().square()).sqrt())}}}))}}),uu=An({atan_:function(e){var t=mn(e,"x","atan");return Lt.runKernelFunc((function(e,n){var r=e.atan(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat().square().add(1))}}}))}}),cu=An({atanh_:function(e){var t=mn(e,"x","atanh");return Lt.runKernelFunc((function(e,n){var r=e.atanh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(On(1).sub(n.toFloat().square()))}}}))}}),lu=An({ceil_:function(e){var t=mn(e,"x","ceil");return Lt.runKernelFunc((function(e){return e.ceil(t)}),{$x:t},(function(e){return{$x:function(){return Xn(e)}}}))}}),hu=An({clipByValue_:function(e,t,n){var r=mn(e,"x","clipByValue");C(t<=n,(function(){return"Error in clip: min ("+t+") must be less than or equal to max ("+n+")."}));var a=[r],i={min:t,max:n};return Lt.runKernelFunc((function(e,a){var i=e.clip(r,t,n);return a([r]),i}),{x:r},(function(e,r){var a=r[0];return{x:function(){return e.where(a.greaterEqual(t).logicalAnd(a.lessEqual(n)),Xn(e))}}}),"ClipByValue",i,a)}}),fu=An({cos_:function(e){var t=mn(e,"x","cos"),n=[t];return Lt.runKernelFunc((function(e,n){var r=e.cos(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return n.toFloat().sin().neg().mul(e)}}}),"Cos",{},n)}}),du=An({cosh_:function(e){var t=mn(e,"x","cosh");return Lt.runKernelFunc((function(e,n){var r=e.cosh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return n.toFloat().sinh().mulStrict(e)}}}))}}),pu=An({erf_:function(e){var t=mn(e,"x","erf");return C("int32"===t.dtype||"float32"===t.dtype,(function(){return"Input dtype must be `int32` or `float32`."})),"int32"===t.dtype&&(t=t.toFloat()),Lt.runKernelFunc((function(e,n){var r=e.erf(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}}))}}),vu=An({exp_:function(e){var t=mn(e,"x","exp");return Lt.runKernelFunc((function(e,n){var r=e.exp(t);return n([r]),r}),{x:t},(function(e,t){return{x:function(){return e.mulStrict(t[0])}}}),"Exp",{},[],[!0])}}),mu=An({expm1_:function(e){var t=mn(e,"x","expm1");return Lt.runKernelFunc((function(e,n){var r=e.expm1(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.exp())}}}))}}),gu=An({floor_:function(e){var t=mn(e,"x","floor");return Lt.runKernelFunc((function(e){return e.floor(t)}),{$x:t},(function(e){return{$x:function(){return Xn(e)}}}))}}),yu=An({log_:function(e){var t=mn(e,"x","log"),n=[t];return Lt.runKernelFunc((function(e,n){var r=e.log(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.div(n.toFloat())}}}),"Log",{},n)}}),xu=An({log1p_:function(e){var t=mn(e,"x","log1p");return Lt.runKernelFunc((function(e,n){var r=e.log1p(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.add(1))}}}))}}),bu=An({logSigmoid_:function(e){var t=mn(e,"x","logSigmoid");return Lt.runKernelFunc((function(e,n){var r=e.softplus(t.neg()).neg();return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.neg().sigmoid())}}}))}}),wu=An({neg_:function(e){var t=mn(e,"x","neg"),n=[t];return Lt.runKernelFunc((function(e){return e.neg(t)}),{x:t},(function(e){return{x:function(){return e.neg()}}}),"Neg",{},n)}}),Cu=An({reciprocal_:function(e){var t=mn(e,"x","reciprocal");return Lt.runKernelFunc((function(e,n){var r=e.reciprocal(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.square().neg())}}}))}}),Eu=An({round_:function(e){var t=mn(e,"x","round");return Lt.runKernelFunc((function(e){return e.round(t)}),{$x:t},(function(e){return{$x:function(){return Xn(e)}}}))}}),Ru=An({rsqrt_:function(e){var t=mn(e,"x","rsqrt"),n=[t];return Lt.runKernelFunc((function(e,n){var r=e.rsqrt(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.div(n.pow(1.5).mul(2)).neg()}}}),"Rsqrt",{},n)}}),Iu=An({sigmoid_:function(e){var t=mn(e,"x","sigmoid");return Lt.runKernelFunc((function(e,n){var r=e.sigmoid(t);return n([r]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.mul(n.mul(On(1).sub(n)))}}}),"Sigmoid")}}),ku=An({sign_:function(e){var t=mn(e,"x","sign");return Lt.runKernelFunc((function(e){return e.sign(t)}),{$x:t},(function(e){return{$x:function(){return Xn(e)}}}))}}),Su=An({isNaN_:function(e){var t=mn(e,"x","isNaN");return Lt.runKernelFunc((function(e){return e.isNaN(t)}),{$x:t},(function(e){return{$x:function(){return Xn(e)}}}))}}),Au=An({isInf_:function(e){var t=mn(e,"x","isInf");return Lt.runKernelFunc((function(e){return e.isInf(t)}),{$x:t},(function(e){return{$x:function(){return Xn(e)}}}))}}),Du=An({isFinite_:function(e){var t=mn(e,"x","isFinite");return Lt.runKernelFunc((function(e){return e.isFinite(t)}),{$x:t},(function(e){return{$x:function(){return Xn(e)}}}))}}),Tu=An({sin_:function(e){var t=mn(e,"x","sin"),n=[t];return Lt.runKernelFunc((function(e,n){var r=e.sin(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return n.toFloat().cos().mul(e)}}}),"Sin",{},n)}}),Nu=An({sinh_:function(e){var t=mn(e,"x","sinh");return Lt.runKernelFunc((function(e,n){var r=e.sinh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return n.toFloat().cosh().mulStrict(e)}}}))}}),Fu=An({softplus_:function(e){var t=mn(e,"x","softplus");return Lt.runKernelFunc((function(e,n){var r=e.softplus(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.sigmoid())}}}))}}),_u=An({sqrt_:function(e){var t=mn(e,"x","sqrt");return Lt.runKernelFunc((function(e,n){var r=e.sqrt(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat().sqrt().mul(2))}}}))}}),Ou=An({step_:function(e,t){void 0===t&&(t=0);var n=mn(e,"x","step");return Lt.runKernelFunc((function(e){return e.step(n,t)}),{$x:n},(function(e){return{$x:function(){return Xn(e)}}}))}}),Mu=An({tan_:function(e){var t=mn(e,"x","tan");return Lt.runKernelFunc((function(e,n){var r=e.tan(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.cos().square())}}}))}}),Bu=An({tanh_:function(e){var t=mn(e,"x","tanh");return Lt.runKernelFunc((function(e,n){var r=e.tanh(t);return n([r]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return On(1).sub(n.square()).mulStrict(e)}}}),"Tanh",{},null,[!0])}});function Pu(e,t,n,r,a,i){var s,o,l=mn(e,"x","batchNorm"),u=mn(t,"mean","batchNorm"),c=mn(n,"variance","batchNorm");return null!=a&&(s=mn(a,"scale","batchNorm")),null!=r&&(o=mn(r,"offset","batchNorm")),C(2===l.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+l.rank+"."})),C(2===u.rank||1===u.rank,(function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+u.rank+"."})),C(2===c.rank||1===c.rank,(function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+c.rank+"."})),null!=s&&C(2===s.rank||1===s.rank,(function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+s.rank+"."})),null!=o&&C(2===o.rank||1===o.rank,(function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+o.rank+"."})),Uu(l,u,c,o,s,i)}function Lu(e,t,n,r,a,i){var s,o,l=mn(e,"x","batchNorm"),u=mn(t,"mean","batchNorm"),c=mn(n,"variance","batchNorm");return null!=a&&(s=mn(a,"scale","batchNorm")),null!=r&&(o=mn(r,"offset","batchNorm")),C(3===l.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+l.rank+"."})),C(3===u.rank||1===u.rank,(function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+u.rank+"."})),C(3===c.rank||1===c.rank,(function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+c.rank+"."})),null!=s&&C(3===s.rank||1===s.rank,(function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+s.rank+"."})),null!=o&&C(3===o.rank||1===o.rank,(function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+o.rank+"."})),Uu(l,u,c,o,s,i)}function Wu(e,t,n,r,a,i){var s,o,l=mn(e,"x","batchNorm"),u=mn(t,"mean","batchNorm"),c=mn(n,"variance","batchNorm");return null!=a&&(s=mn(a,"scale","batchNorm")),null!=r&&(o=mn(r,"offset","batchNorm")),C(4===l.rank,(function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+l.rank+"."})),C(4===u.rank||1===u.rank,(function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+u.rank+"."})),C(4===c.rank||1===c.rank,(function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+c.rank+"."})),null!=s&&C(4===s.rank||1===s.rank,(function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+s.rank+"."})),null!=o&&C(4===o.rank||1===o.rank,(function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+o.rank+"."})),Uu(l,u,c,o,s,i)}function Uu(e,t,n,r,a,i){null==i&&(i=.001);var s,o,l,u=mn(e,"x","batchNorm"),c=mn(t,"mean","batchNorm"),h=mn(n,"variance","batchNorm");null!=a&&(s=mn(a,"scale","batchNorm")),null!=r&&(o=mn(r,"offset","batchNorm")),C(c.rank===h.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),C(null==o||c.rank===o.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),C(null==s||c.rank===s.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."})),l=0===u.rank||1===u.rank?u.as4D(1,1,1,u.size):2===u.rank?u.as4D(1,1,u.shape[0],u.shape[1]):3===u.rank?u.as4D(1,u.shape[0],u.shape[1],u.shape[2]):u;var d=[u,c,h,s];return Lt.runKernelFunc((function(e,t){var n=e.batchNormalization(l,Vu(c),Vu(h),i,Vu(s),Vu(o));return t([u,c,h,s]),n}),{x:u,mean:c,variance:h,scale:s,offset:o},(function(e,t){var n=t,r=n[0],a=n[1],s=n[2],o=n[3],u=null==o?On(1):o,c=Eo(a.shape,l.shape),h=[];if(1===a.rank){for(var d=0;d<l.shape.length-1;++d)h.push(l.shape[d]);h.push(1)}var p=r.sub(a),f=e.mul(u),m=Ru(s.add(On(i))),g=m.mul(m).mul(m).mul(On(-.5));return{x:function(){return 1===a.rank?e.mul(Lr(m.as4D(1,1,1,a.shape[0]),h)).mul(u).reshape(r.shape):e.mul(m).mul(u).reshape(r.shape)},mean:function(){var e=m.mul(On(-1)).mul(f);return 1===a.rank&&(e=e.sum(c)),e.reshape(a.shape)},variance:function(){var e=g.mul(p).mul(f);return 1===a.rank&&(e=e.sum(c)),e.reshape(a.shape)},scale:function(){var t=p.mul(m),n=e.mul(t);return 1===a.rank&&(n=n.sum(c)),n.reshape(a.shape)},offset:function(){var t=e;return 1===a.rank&&(t=t.sum(c)),t.reshape(a.shape)}}}),"BatchNormalization",{varianceEpsilon:i},d).reshape(u.shape)}function Vu(e){return null==e?null:0===e.rank?e.as1D():1===e.rank?e:2===e.rank?e.as4D(1,1,e.shape[0],e.shape[1]):3===e.rank?e.as4D(1,e.shape[0],e.shape[1],e.shape[2]):e}function zu(){Xe("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var Gu=An({batchNormalization2d_:function(e,t,n,r,a,i){return void 0===r&&(r=.001),zu(),Pu(e,t,n,i,a,r)}}),Hu=An({batchNormalization3d_:function(e,t,n,r,a,i){return void 0===r&&(r=.001),zu(),Lu(e,t,n,i,a,r)}}),qu=An({batchNormalization4d_:function(e,t,n,r,a,i){return void 0===r&&(r=.001),zu(),Wu(e,t,n,i,a,r)}}),Ku=An({batchNormalization_:function(e,t,n,r,a,i){return void 0===r&&(r=.001),zu(),Uu(e,t,n,i,a,r)}}),ju=An({batchNorm_:Uu}),Xu=An({batchNorm2d_:Pu}),Yu=An({batchNorm3d_:Lu}),$u=An({batchNorm4d_:Wu}),Qu=An({logicalAnd_:function(e,t){var n=mn(e,"a","logicalAnd","bool"),r=mn(t,"b","logicalAnd","bool");return Ro(n.shape,r.shape),Lt.runKernelFunc((function(e){return e.logicalAnd(n,r)}),{a:n,b:r},null,"LogicalAnd")}}),Ju=An({logicalNot_:function(e){var t=mn(e,"x","logicalNot","bool");return Lt.runKernelFunc((function(e){return e.logicalNot(t)}),{$x:t})}}),Zu=An({logicalOr_:function(e,t){var n=mn(e,"a","logicalOr","bool"),r=mn(t,"b","logicalOr","bool");return Ro(n.shape,r.shape),Lt.runKernelFunc((function(e){return e.logicalOr(n,r)}),{$a:n,$b:r})}}),tc=An({logicalXor_:function(e,t){var n=mn(e,"a","logicalXor","bool"),r=mn(t,"b","logicalXor","bool");return Ro(n.shape,r.shape),Zu(e,t).logicalAnd(Qu(e,t).logicalNot())}}),ec=An({where_:function(e,t,n){var r=mn(t,"a","where"),a=mn(n,"b","where"),i=mn(e,"condition","where","bool");return E(r.shape,a.shape,"Error in where: "),1===i.rank?C(i.shape[0]===r.shape[0],(function(){return"The first dimension of `a` must match the size of `condition`."})):E(i.shape,a.shape,"Error in where: "),Lt.runKernelFunc((function(e,t){var n=e.select(i,r,a);return t([i]),n}),{$condition:i,$a:r,$b:a},(function(e,t){var n=t[0];return{$condition:function(){return Xn(n).toFloat()},$a:function(){return e.mul(n.cast(e.dtype))},$b:function(){return e.mul(n.logicalNot().cast(e.dtype))}}}))}}),nc=function(e){return n(this,void 0,void 0,(function(){var t,n,a;return r(this,(function(r){switch(r.label){case 0:return[4,(t=mn(e,"condition","whereAsync","bool")).data()];case 1:return n=r.sent(),a=na(t.shape,n),e!==t&&t.dispose(),[2,a]}}))}))},rc=An({add_:function(e,t){var n,r=mn(e,"a","add"),a=mn(t,"b","add");n=Nt(r,a),r=n[0],a=n[1];var i=Ro(r.shape,a.shape);return Lt.runKernelFunc((function(e){return e.add(r,a)}),{a:r,b:a},(function(e){return{a:function(){var t=e,n=Eo(r.shape,i);return n.length>0&&(t=t.sum(n)),t.reshape(r.shape)},b:function(){var t=e,n=Eo(a.shape,i);return n.length>0&&(t=t.sum(n)),t.reshape(a.shape)}}}),"Add")}}),oc=An({addN_:function(e){C(Array.isArray(e),(function(){return"The argument passed to tf.addN() must be a list of tensors"})),C(e.length>=1,(function(){return"Must pass at least one tensor to tf.addN(), but got "+e.length}));var t=e.map((function(e,t){return mn(e,"tensors"+t,"addN")})),n=t[0];t.forEach((function(e){if(e.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),t.forEach((function(e){if(!S(e.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));var r=t;return Lt.runKernelFunc((function(e){return e.addN(t)}),r,(function(e){var n={};return t.forEach((function(t,r){n[r]=function(){return e.clone()}})),n}),"AddN")}}),ac=An({addStrict_:function(e,t){var n=mn(e,"a","addStrict"),r=mn(t,"b","addStrict");return E(n.shape,r.shape,"Error in addStrict: "),n.add(r)}}),ic=An({atan2_:function(e,t){var n,r=mn(e,"a","atan2"),a=mn(t,"b","atan2");n=Nt(r,a),r=n[0],a=n[1];var i=Ro(r.shape,a.shape);return Lt.runKernelFunc((function(e,t){var n=e.atan2(r,a);return t([r,a]),n}),{$a:r,$b:a},(function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=rc(n.square(),r.square()),a=e.mul(r.div(t)),s=Eo(n.shape,i);return s.length>0&&(a=a.sum(s)),a.reshape(n.shape)},$b:function(){var t=rc(n.square(),r.square()),a=wu(e.mul(n.div(t))),s=Eo(r.shape,i);return s.length>0&&(a=a.sum(s)),a.reshape(r.shape)}}}))}}),sc=An({div_:function(e,t){var n,r=mn(e,"a","div"),a=mn(t,"b","div");if(n=Nt(r,a),r=n[0],a=n[1],"int32"===r.dtype&&"int32"===a.dtype)return lc(r,a);var i=Ro(r.shape,a.shape);return Lt.runKernelFunc((function(e,t){var n=e.realDivide(r,a);return t([r,a]),n}),{a:r,b:a},(function(e,t){var n=t[0],r=t[1];return{a:function(){var t=e.div(r.toFloat()),a=Eo(n.shape,i);return a.length>0?t.sum(a).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),a=Eo(r.shape,i);a.length>0&&(t=t.sum(a).reshape(r.shape));var s=r.square();return t.div(s.toFloat()).neg()}}}),"Div")}}),uc=An({divNoNan_:function(e,t){var n,r=mn(e,"a","div"),a=mn(t,"b","div");r=(n=Nt(r,a))[0],a=n[1];var i=sc(r,a),s=Xn(i),o=a.equal(s);return ec(o,s,i)}}),cc=An({divStrict_:function(e,t){var n=mn(e,"a","div"),r=mn(t,"b","div");return E(n.shape,r.shape,"Error in divideStrict: "),n.div(r)}}),lc=An({floorDiv_:function(e,t){var n,r=mn(e,"a","floorDiv"),a=mn(t,"b","floorDiv");n=Nt(r,a),r=n[0],a=n[1];var i=Ro(r.shape,a.shape);return Lt.runKernelFunc((function(e,t){var n=e.floorDiv(r,a);return t([r,a]),n}),{a:r,b:a},(function(e,t){var n=t[0],r=t[1];return{a:function(){var t=e.div(r.toFloat()),a=Eo(n.shape,i);return a.length>0?t.sum(a).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),a=Eo(r.shape,i);a.length>0&&(t=t.sum(a).reshape(r.shape));var s=r.square();return t.div(s.toFloat()).neg()}}}),"FloorDiv")}}),hc=An({maximum_:function(e,t){var n,r=mn(e,"a","maximum"),a=mn(t,"b","maximum");return n=Nt(r,a),r=n[0],a=n[1],"bool"===r.dtype&&(r=r.toInt(),a=a.toInt()),Ro(r.shape,a.shape),Lt.runKernelFunc((function(e,t){var n=e.maximum(r,a);return t([r,a]),n}),{a:r,b:a},(function(e,t){var n=t[0],r=t[1];return{a:function(){return e.mul(n.greaterEqual(r).toFloat())},b:function(){return e.mul(n.less(r).toFloat())}}}),"Maximum")}}),fc=An({maximumStrict_:function(e,t){var n=mn(e,"a","maximumStrict"),r=mn(t,"b","maximumStrict");return E(n.shape,r.shape,"Error in maximumStrict: "),n.maximum(r)}}),dc=An({minimum_:function(e,t){var n,r=mn(e,"a","minimum"),a=mn(t,"b","minimum");return n=Nt(r,a),r=n[0],a=n[1],"bool"===r.dtype&&(r=r.toInt(),a=a.toInt()),Ro(r.shape,a.shape),Lt.runKernelFunc((function(e,t){var n=e.minimum(r,a);return t([r,a]),n}),{a:r,b:a},(function(e,t){var n=t[0],r=t[1];return{a:function(){return e.mul(n.lessEqual(r).toFloat())},b:function(){return e.mul(n.greater(r).toFloat())}}}),"Minimum")}}),pc=An({minimumStrict_:function(e,t){var n=mn(e,"a","minimumStrict"),r=mn(t,"b","minimumStrict");return E(n.shape,r.shape,"Error in minimumStrict: "),n.minimum(r)}}),vc=An({mod_:function(e,t){var n,r=mn(e,"a","mod"),a=mn(t,"b","mod");n=Nt(r,a),r=n[0],a=n[1];var i=Ro(r.shape,a.shape);return Lt.runKernelFunc((function(e,t){var n=e.mod(r,a);return t([r,a]),n}),{$a:r,$b:a},(function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=Eo(n.shape,i);return t.length>0?e.sum(t).reshape(n.shape):e},$b:function(){var t=e.mul(n.div(r).floor().neg()),a=Eo(r.shape,i);return a.length>0?t.sum(a).reshape(r.shape):t}}}))}}),mc=An({modStrict_:function(e,t){var n=mn(e,"a","modStrict"),r=mn(t,"b","modStrict");return E(n.shape,r.shape,"Error in modStrict: "),n.mod(r)}}),gc=An({mul_:function(e,t){var n,r=mn(e,"a","mul"),a=mn(t,"b","mul");n=Nt(r,a),r=n[0],a=n[1];var i=Ro(r.shape,a.shape);return Lt.runKernelFunc((function(e,t){var n=e.multiply(r,a);return t([r,a]),n}),{a:r,b:a},(function(e,t){var n=t[0],r=t[1];return{a:function(){var t=e.mul(r.toFloat()),a=Eo(n.shape,i);return a.length>0?t.sum(a).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),a=Eo(r.shape,i);return a.length>0?t.sum(a).reshape(r.shape):t}}}),"Mul")}}),yc=An({mulStrict_:function(e,t){var n=mn(e,"a","mul"),r=mn(t,"b","mul");return E(n.shape,r.shape,"Error in multiplyStrict: "),n.mul(r)}}),xc=An({pow_:function(e,t){var n,r=mn(e,"base","pow"),a=mn(t,"exp","pow");n=Nt(r,a),r=n[0],a=n[1];var i=Ro(r.shape,a.shape),s=[r,a];return Lt.runKernelFunc((function(e,t){var n=e.pow(r,a);return t([r,a,n]),n}),{a:r,b:a},(function(e,t){var n=t[0],r=t[1],a=t[2];return{a:function(){var t=r.toFloat(),a=e.mul(t.mul(n.pow(t.sub(On(1))))),s=Eo(n.shape,i);return s.length>0&&(a=a.sum(s)),a.reshape(n.shape)},b:function(){var t=n.greater(0),s=n.log().where(t,Xn(n)),o=e.mul(a.mul(s)),l=Eo(r.shape,i);return l.length>0&&(o=o.sum(l)),o.reshape(r.shape)}}}),"Pow",{},s,[!0])}}),bc=An({powStrict_:function(e,t){return E(e.shape,t.shape,"Error in powStrict: "),e.pow(t)}}),wc=An({squaredDifferenceStrict_:function(e,t){var n=mn(e,"a","squaredDifferenceStrict"),r=mn(t,"b","squaredDifferenceStrict");return E(n.shape,r.shape,"Error in squaredDifferenceStrict: "),n.squaredDifference(r)}}),Cc=An({sub_:function(e,t){var n,r=mn(e,"a","sub"),a=mn(t,"b","sub");n=Nt(r,a),r=n[0],a=n[1];var i=Ro(r.shape,a.shape);return Lt.runKernelFunc((function(e){return e.subtract(r,a)}),{a:r,b:a},(function(e){return{a:function(){var t=e,n=Eo(r.shape,i);return n.length>0&&(t=t.sum(n)),t.reshape(r.shape)},b:function(){var t=e,n=Eo(a.shape,i);return n.length>0&&(t=t.sum(n)),t.neg().reshape(a.shape)}}}),"Sub")}}),Ec=An({subStrict_:function(e,t){var n=mn(e,"a","subStrict"),r=mn(t,"b","subStrict");return E(n.shape,r.shape,"Error in subStrict: "),n.sub(r)}}),Rc=An({equal_:function(e,t){var n,r=mn(e,"a","equal"),a=mn(t,"b","equal");return n=Nt(r,a),r=n[0],a=n[1],Ro(r.shape,a.shape),Lt.runKernelFunc((function(e){return e.equal(r,a)}),{$a:r,$b:a})}}),Ic=An({equalStrict_:function(e,t){var n=mn(e,"a","equalStrict"),r=mn(t,"b","equalStrict");return E(n.shape,r.shape,"Error in equalStrict: "),n.equal(r)}}),kc=An({greater_:function(e,t){var n,r=mn(e,"a","greater"),a=mn(t,"b","greater");return n=Nt(r,a),r=n[0],a=n[1],Ro(r.shape,a.shape),Lt.runKernelFunc((function(e){return e.greater(r,a)}),{a:r,b:a},null,"Greater")}}),Sc=An({greaterEqual_:function(e,t){var n,r=mn(e,"a","greaterEqual"),a=mn(t,"b","greaterEqual");return n=Nt(r,a),r=n[0],a=n[1],Ro(r.shape,a.shape),Lt.runKernelFunc((function(e,t){var n=e.greaterEqual(r,a);return t([r,a]),n}),{a:r,b:a},(function(e,t){var n=t[0],r=t[1];return{a:function(){return Xn(n)},b:function(){return Xn(r)}}}),"GreaterEqual")}}),Ac=An({greaterEqualStrict_:function(e,t){var n=mn(e,"a","greaterEqualStrict"),r=mn(t,"b","greaterEqualStrict");return E(n.shape,r.shape,"Error in greaterEqualStrict: "),n.greaterEqual(r)}}),Dc=An({greaterStrict_:function(e,t){var n=mn(e,"a","greaterStrict"),r=mn(t,"b","greaterStrict");return E(n.shape,r.shape,"Error in greaterStrict: "),n.greater(r)}}),Tc=An({less_:function(e,t){var n,r=mn(e,"a","less"),a=mn(t,"b","less");return n=Nt(r,a),r=n[0],a=n[1],Ro(r.shape,a.shape),Lt.runKernelFunc((function(e){return e.less(r,a)}),{a:r,b:a},null,"Less")}}),Nc=An({lessEqual_:function(e,t){var n,r=mn(e,"a","lessEqual"),a=mn(t,"b","lessEqual");return n=Nt(r,a),r=n[0],a=n[1],Ro(r.shape,a.shape),Lt.runKernelFunc((function(e,t){var n=e.lessEqual(r,a);return t([r,a]),n}),{a:r,b:a},null,"LessEqual")}}),Fc=An({lessEqualStrict_:function(e,t){var n=mn(e,"a","lessEqualStrict"),r=mn(t,"b","lessEqualStrict");return E(n.shape,r.shape,"Error in lessEqualStrict: "),n.lessEqual(r)}}),_c=An({lessStrict_:function(e,t){var n=mn(e,"a","lessStrict"),r=mn(t,"b","lessStrict");return E(n.shape,r.shape,"Error in lessStrict: "),n.less(r)}}),Oc=An({notEqual_:function(e,t){var n,r=mn(e,"a","notEqual"),a=mn(t,"b","notEqual");return n=Nt(r,a),r=n[0],a=n[1],Ro(r.shape,a.shape),Lt.runKernelFunc((function(e){return e.notEqual(r,a)}),{a:r,b:a},null,"NotEqual")}}),Mc=An({notEqualStrict_:function(e,t){var n=mn(e,"a","notEqualStrict"),r=mn(t,"b","notEqualStrict");return E(n.shape,r.shape,"Error in notEqualStrict: "),n.notEqual(r)}});function Bc(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function Pc(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var Lc=An({gather_:function(e,t,n){void 0===n&&(n=0);var r=mn(e,"x","gather"),a=mn(t,"indices","gather","int32");n=O(n,r.shape)[0];var i=function(e,t,n){for(var r=e.shape[n],a=[],i=1,s=1,o=0;o<n;o++)a.push(e.shape[o]),i*=e.shape[o];for(o=0;o<t.rank;o++)a.push(t.shape[o]);for(o=n+1;o<e.rank;o++)a.push(e.shape[o]),s*=e.shape[o];return{batchSize:i,sliceSize:s,dimSize:r,outputShape:a}}(r,a,n);return Lt.runKernelFunc((function(e,t){var i=e.gather(r,a.flatten(),n);return t([a]),i}),{x:r,indices:a},(function(e,t){var a=t[0];return{x:function(){var t=r.shape,i=a.size,s=t.slice(0,n),o=s.length,l=t.slice(n,t.length).slice(1),u=l.length,c=Bc(0,o),h=Bc(o+1,o+1+u),d=Pc([s,[i],l]),p=e.reshape(d),f=a.reshape([i]),m=Pc([[o],c,h]),g=p.transpose(m),y=Wc(g,f,r.shape[n]),v=Rn(m);return y.transpose(v)},indices:function(){return a}}}),"Gather",{axis:n}).reshape(i.outputShape)}}),Wc=An({unsortedSegmentSum_:function(e,t,n){var r=mn(e,"x","unsortedSegmentSum"),a=mn(t,"segmentIds","unsortedSegmentSum","int32");return C(A(n),(function(){return"numSegments must be of dtype int"})),Lt.runKernelFunc((function(e,t){var i=e.unsortedSegmentSum(r,a,n);return t([a]),i}),{$x:r},(function(e,t){var n=t[0];return{$x:function(){return function(e,t){for(var n=hc(t,Xn(t)),r=Lc(e,n),a=Sc(t,On(0,"int32")),i=r.rank-a.rank,s=0;s<i;++s)a=wr(a,s+1);a=Qu(a,zn(r.shape,"bool"));var o=Xn(r);return ec(a,r,o)}(e,n)}}}))}}),Uc=function(e,t,a){return n(this,void 0,void 0,(function(){var n,i,s,o,l,u,c,h,d,p,f,m,g;return r(this,(function(r){switch(r.label){case 0:for(n=mn(e,"tensor","boolMask"),i=mn(t,"mask","boolMask","bool"),s=null==a?0:a,o=i.rank,l=n.shape,C(o>0,(function(){return"mask cannot be scalar"})),E(l.slice(s,s+o),i.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,c=s;c<s+o;c++)u*=l[c];return h=l.slice(0,s).concat([u],l.slice(s+o)),d=n.reshape(h),p=i.reshape([-1]),[4,nc(p)];case 1:return f=r.sent(),m=f.squeeze([1]),g=Lc(d,m,s),e!==n&&n.dispose(),t!==i&&i.dispose(),m.dispose(),d.dispose(),p.dispose(),f.dispose(),[2,g]}}))}))};function Vc(e,t,n,r,a,i,s){void 0===i&&(i="NHWC"),C(e.length===t.rank,(function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"}));var o=e,l=t,u=!1;3===t.rank&&(u=!0,l=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]),o=[1,e[0],e[1],e[2]]),C(4===o.length,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+o.length+"."})),C(4===l.rank,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+l.rank})),C(4===n.rank,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank}));var c="NHWC"===i?o[3]:o[1],h="NHWC"===i?l.shape[3]:l.shape[1];C(c===n.shape[2],(function(){return"Error in conv2dDerInput: depth of input ("+c+") must match input depth for filter "+n.shape[2]+"."})),C(h===n.shape[3],(function(){return"Error in conv2dDerInput: depth of output ("+h+") must match output depth for filter "+n.shape[3]+"."})),null!=s&&C(A(a),(function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+a+"."}));var d=Bo(i),p=So(o,n.shape,r,1,a,s,!1,d),f=Lt.runKernelFunc((function(e,t){var r=e.conv2dDerInput(l,n,p);return t([n,l]),r}),{dy4D:l,filter:n},(function(e,t){var n=t[0],o=t[1];return{dy4D:function(){return qc(e,n,r,a,i,1,s)},filter:function(){return jc(e,o,n.shape,r,a,i,s)}}}));return u?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}function zc(e){var t,n="number"==typeof(t=e)?[t,t,t]:2===t.length?[t[0],t[1],1]:t,r=n[0],a=n[1],i=n[2];return 1===r&&1===a&&1===i}function Gc(e,t,n,r,a){C(e.length===t.rank,(function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"}));var i=e,s=t,o=!1;4===t.rank&&(o=!0,s=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]),i=[1,e[0],e[1],e[2],e[3]]);var l=i[4],u=s.shape[4];C(5===i.length,(function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+i.length+"."})),C(5===s.rank,(function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+s.rank})),C(5===n.rank,(function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank})),C(l===n.shape[3],(function(){return"Error in conv3dDerInput: depth of input ("+l+") must match input depth for filter "+n.shape[3]+"."})),C(u===n.shape[4],(function(){return"Error in conv3dDerInput: depth of output ("+u+") must match output depth for filter "+n.shape[4]+"."}));var c=Ao(i,n.shape,r,1,a),h=Lt.runKernelFunc((function(e){return e.conv3dDerInput(s,n,c)}),{dy5D:s});return o?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}var Hc=An({conv1d_:function(e,t,n,r,a,i,s){void 0===a&&(a="NWC"),void 0===i&&(i=1);var o=mn(e,"x","conv1d"),l=mn(t,"filter","conv1d"),u=o,c=!1;2===o.rank&&(c=!0,u=o.as3D(1,o.shape[0],o.shape[1])),C(3===u.rank,(function(){return"Error in conv1d: input must be rank 3, but got rank "+u.rank+"."})),C(3===l.rank,(function(){return"Error in conv1d: filter must be rank 3, but got rank "+l.rank+"."})),null!=s&&C(A(r),(function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+r+"."})),C(u.shape[2]===l.shape[1],(function(){return"Error in conv1d: depth of input ("+u.shape[2]+") must match input depth for filter "+l.shape[1]+"."})),C(Mo(n,i),(function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+n+" and dilation '"+i+"'"})),C("NWC"===a,(function(){return"Error in conv1d: got dataFormat of "+a+" but only NWC is currently supported."}));var h=l.as4D(1,l.shape[0],l.shape[1],l.shape[2]),d=u.as4D(u.shape[0],1,u.shape[1],u.shape[2]),p=qc(d,h,[1,n],r,"NHWC",[1,i],s);return c?p.as2D(p.shape[2],p.shape[3]):p.as3D(p.shape[0],p.shape[2],p.shape[3])}}),qc=An({conv2d_:function(e,t,n,r,a,i,s){void 0===a&&(a="NHWC"),void 0===i&&(i=[1,1]);var o=mn(e,"x","conv2d"),l=mn(t,"filter","conv2d"),u=o,c=!1;3===o.rank&&(c=!0,u=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),C(4===u.rank,(function(){return"Error in conv2d: input must be rank 4, but got rank "+u.rank+"."})),C(4===l.rank,(function(){return"Error in conv2d: filter must be rank 4, but got rank "+l.rank+"."})),null!=s&&C(A(r),(function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+r+"."}));var h="NHWC"===a?u.shape[3]:u.shape[1];C(h===l.shape[2],(function(){return"Error in conv2d: depth of input ("+h+") must match input depth for filter "+l.shape[2]+"."})),C(Mo(n,i),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"}));var d=Bo(a),p=So(u.shape,l.shape,n,i,r,s,!1,d),f=[l,u],m=Lt.runKernelFunc((function(e,t){var n=e.conv2d(u,l,p);return t([l,u]),n}),{x:u,filter:l},(function(e,t){var s=t,o=s[0],l=s[1];return C(Oo(i),(function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"})),{x:function(){return Xc(l.shape,e,o,n,r,a)},filter:function(){return jc(l,e,o.shape,n,r,a)}}}),"Conv2D",p,f);return c?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),Kc=An({conv3d_:function(e,t,n,r,a,i){void 0===a&&(a="NDHWC"),void 0===i&&(i=[1,1,1]);var s,o=mn(e,"x","conv3d"),l=mn(t,"filter","conv3d"),u=o,c=!1;4===o.rank&&(c=!0,u=o.as5D(1,o.shape[0],o.shape[1],o.shape[2],o.shape[3])),C(5===u.rank,(function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."})),C(5===l.rank,(function(){return"Error in conv3d: filter must be rank 5, but got rank "+l.rank+"."})),C(u.shape[4]===l.shape[3],(function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+l.shape[3]+"."})),C((s=i,zc(n)||zc(s)),(function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"})),C("NDHWC"===a,(function(){return"Error in conv3d: got dataFormat of "+a+" but only NDHWC is currently supported."}));var h=Ao(u.shape,l.shape,n,i,r),d=Lt.runKernelFunc((function(e,t){var n=e.conv3d(u,l,h);return t([u,l]),n}),{x:u,$filter:l},(function(e,t){C(zc(i),(function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"}));var a=t[0],s=t[1];return{x:function(){return Gc(a.shape,e,s,n,r)},$filter:function(){return function(e,t,n,r,a){var i=e;4===e.rank&&(i=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]));var s=t;4===s.rank&&(s=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3])),C(5===i.rank,(function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+i.shape+"."})),C(5===s.rank,(function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+s.shape+"."})),C(5===n.length,(function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+n+"."})),C(i.shape[4]===n[3],(function(){return"Error in conv3dDerFilter: depth of input "+i.shape[4]+") must match input depth in filter ("+n[3]+"."})),C(s.shape[4]===n[4],(function(){return"Error in conv3dDerFilter: depth of dy ("+s.shape[4]+") must match output depth for filter ("+n[4]+")."}));var o=Ao(i.shape,n,r,1,a);return Lt.runKernelFunc((function(e){return e.conv3dDerFilter(i,s,o)}),{x5D:i,dy5D:s})}(a,e,s.shape,n,r)}}}));return c?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),jc=An({conv2dDerFilter_:function(e,t,n,r,a,i,s){void 0===i&&(i="NHWC");var o=e;3===e.rank&&(o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var l=t;3===l.rank&&(l=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),C(4===o.rank,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+o.shape+"."})),C(4===l.rank,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+l.shape+"."})),C(4===n.length,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."}));var u="NHWC"===i?o.shape[3]:o.shape[1],c="NHWC"===i?l.shape[3]:l.shape[1];C(u===n[2],(function(){return"Error in conv2dDerFilter: depth of input "+u+") must match input depth in filter ("+n[2]+"."})),C(c===n[3],(function(){return"Error in conv2dDerFilter: depth of dy ("+c+") must match output depth for filter ("+n[3]+")."})),null!=s&&C(A(a),(function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+a+"."}));var h=Bo(i),d=So(o.shape,n,r,1,a,s,!1,h);return Lt.runKernelFunc((function(e){return e.conv2dDerFilter(o,l,d)}),{x4D:o,dy4D:l})}}),Xc=An({conv2dDerInput_:Vc}),Yc=An({depthwiseConv2d_:function(e,t,n,r,a,i,s){void 0===i&&(i=[1,1]);var o=mn(e,"x","depthwiseConv2d"),l=mn(t,"filter","depthwiseConv2d"),u=o,c=!1;3===o.rank&&(c=!0,u=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),C(4===u.rank,(function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+u.rank+"."})),C(4===l.rank,(function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+l.rank+"."})),C(u.shape[3]===l.shape[2],(function(){return"Error in depthwiseConv2d: number of input channels ("+u.shape[3]+") must match the inChannels dimension in filter "+l.shape[2]+"."})),null==i&&(i=[1,1]),C(Mo(n,i),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"})),null!=s&&C(A(r),(function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+r+"."}));var h=So(u.shape,l.shape,n,i,r,s,!0),d=[u,l],p=Lt.runKernelFunc((function(e,t){var n=e.depthwiseConv2D(u,l,h);return t([u,l]),n}),{x:u,filter:l},(function(e,t){C(Oo(i),(function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+i+"'"}));var n=t[0],r=t[1];return{x:function(){return $c(n.shape,e,r,h)},filter:function(){return Qc(n,e,r.shape,h)}}}),"DepthwiseConv2dNative",h,d);return c?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}}),$c=An({depthwiseConv2dDerInput_:function(e,t,n,r){var a=t,i=!1;3===t.rank&&(i=!0,a=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var s=Lt.runKernelFunc((function(e){return e.depthwiseConv2DDerInput(a,n,r)}),{dy4D:a});return i?s.as3D(s.shape[1],s.shape[2],s.shape[3]):s}}),Qc=An({depthwiseConv2dDerFilter_:function(e,t,n,r){var a=e;3===e.rank&&(a=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var i=t;return 3===i.rank&&(i=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),Lt.runKernelFunc((function(e){return e.depthwiseConv2DDerFilter(a,i,r)}),{x4D:a,dy4D:i})}}),Jc=An({separableConv2d_:function(e,t,n,r,a,i,s){void 0===i&&(i=[1,1]),void 0===s&&(s="NHWC");var o=mn(e,"x","separableConv2d"),l=mn(t,"depthwiseFilter","separableConv2d"),u=mn(n,"pointwiseFilter","separableConv2d"),c=o,h=!1;if(3===o.rank&&(h=!0,c=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),"NCHW"===s)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");C(4===c.rank,(function(){return"Error in separableConv2d: input must be rank 4, but got rank "+c.rank+"."})),C(4===l.rank,(function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+l.rank+"."})),C(4===u.rank,(function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+l.rank+"."})),C(1===u.shape[0],(function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+u.shape[0]+"."})),C(1===u.shape[1],(function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+u.shape[1]+"."}));var d=l.shape[2],p=l.shape[3];C(u.shape[2]===d*p,(function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+d*p+", but got "+u.shape[2]+"."}));var f=Yc(c,l,r,a,s,i),m=qc(f,u,1,"valid",s);return h?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),Zc=An({conv2dTranspose_:function(e,t,n,r,a,i){return Vc(n,mn(e,"x","conv2dTranspose"),mn(t,"filter","conv2dTranspose"),r,a,"NHWC",i)}}),tl=An({conv3dTranspose_:function(e,t,n,r,a){return Gc(n,mn(e,"x","conv3dTranspose"),mn(t,"filter","conv3dTranspose"),r,a)}}),el=An({matMul_:function(e,t,n,r){var a;void 0===n&&(n=!1),void 0===r&&(r=!1);var i=mn(e,"a","matMul"),s=mn(t,"b","matMul");a=Nt(i,s),i=a[0],s=a[1];var o=n?i.shape[i.rank-2]:i.shape[i.rank-1],l=r?s.shape[s.rank-1]:s.shape[s.rank-2],u=n?i.shape[i.rank-1]:i.shape[i.rank-2],c=r?s.shape[s.rank-2]:s.shape[s.rank-1],h=i.shape.slice(0,-2),d=s.shape.slice(0,-2),p=k(h),f=k(d);C(i.rank>=2&&s.rank>=2&&i.rank===s.rank,(function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+i.rank+" and "+s.rank+"."})),C(S(h,d),(function(){return"Error in matMul: outer dimensions ("+h+") and ("+d+") of Tensors with shapes "+i.shape+" and "+s.shape+" must match."})),C(o===l,(function(){return"Error in matMul: inner shapes ("+o+") and ("+l+") of Tensors with shapes "+i.shape+" and "+s.shape+" and transposeA="+n+" and transposeB="+r+" must match."}));var m=i.shape.slice(0,-2).concat([u,c]),g=n?i.as3D(p,o,u):i.as3D(p,u,o),y=r?s.as3D(f,c,l):s.as3D(f,l,c),v={transposeA:n,transposeB:r};return Lt.runKernelFunc((function(e,t){var a=e.batchMatMul(g,y,n,r);return t([g,y]),a}),{a:g,b:y},(function(e,t){var a=t,i=a[0],s=a[1];return n||r?!n&&r?{a:function(){return e.matMul(s,!1,!1)},b:function(){return e.matMul(i,!0,!1)}}:n&&!r?{a:function(){return s.matMul(e,!1,!0)},b:function(){return i.matMul(e,!1,!1)}}:{a:function(){return s.matMul(e,!0,!0)},b:function(){return e.matMul(i,!0,!0)}}:{a:function(){return e.matMul(s,!1,!0)},b:function(){return i.matMul(e,!0,!1)}}}),"BatchMatMul",v).reshape(m)}}),nl=An({dot_:function(e,t){var n=mn(e,"t1","dot"),r=mn(t,"t2","dot");C(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),(function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+n.rank+" and "+r.rank+"."}));var a=1===n.rank?n.size:n.shape[1],i=1===r.rank?r.size:r.shape[0];return C(a===i,(function(){return"Error in dot: inner dimensions of inputs must match, but got "+a+" and "+i+"."})),1===n.rank&&1===r.rank?n.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():1===n.rank&&2===r.rank?n.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():2===n.rank&&1===r.rank?n.matMul(r.as2D(-1,1)).as1D():n.matMul(r.as2D(r.shape[0],r.shape[1]))}}),rl=An({outerProduct_:function(e,t){var n=mn(e,"v1","outerProduct"),r=mn(t,"v2","outerProduct");return C(1===n.rank&&1===r.rank,(function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+n.rank+" and "+r.rank+"."})),n.as2D(-1,1).matMul(r.as2D(1,-1))}}),ol=An({reverse_:function(e,t){var n=mn(e,"x","reverse");if(0===n.rank)return n.clone();var r=O(t,n.shape);return Lt.runKernelFunc((function(e){return e.reverse(n,r)}),{$x:n},(function(e){return{$x:function(){return e.reverse(r)}}})).reshapeAs(n)}}),al=An({reverse1d_:function(e){var t=mn(e,"x","reverse");return C(1===t.rank,(function(){return"Error in reverse1D: x must be rank 1 but got rank "+t.rank+"."})),ol(t,0)}}),il=An({reverse2d_:function(e,t){var n=mn(e,"x","reverse");return C(2===n.rank,(function(){return"Error in reverse2D: x must be rank 2 but got rank "+n.rank+"."})),ol(n,t)}}),sl=An({reverse3d_:function(e,t){var n=mn(e,"x","reverse");return C(3===n.rank,(function(){return"Error in reverse3D: x must be rank 3 but got rank "+n.rank+"."})),ol(n,t)}}),ul=An({reverse4d_:function(e,t){var n=mn(e,"x","reverse");return C(4===n.rank,(function(){return"Error in reverse4D: x must be rank 4 but got rank "+n.rank+"."})),ol(n,t)}});function cl(e,t,n,r,a,i){var s=mn(e,"x","maxPool"),o=s,l=!1;3===s.rank&&(l=!0,o=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),null==r&&(r=[1,1]),C(4===o.rank,(function(){return"Error in maxPool: input must be rank 4 but got rank "+o.rank+"."})),C(Mo(n,r),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"})),null!=i&&C(A(a),(function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+a+"."}));var u=Io(o.shape,t,n,r,a,i);if(1===u.filterWidth&&1===u.filterHeight&&S(u.inShape,u.outShape))return s.clone();var c=[o],h=Lt.runKernelFunc((function(e,t){var n=e.maxPool(o,u);return t([o,n]),n}),{x:o},(function(e,i){var s=i[0],o=i[1];return{x:function(){return function(e,t,n,r,a,i,s,o){var l=mn(e,"dy","maxPoolBackprop"),u=mn(t,"input","maxPoolBackprop"),c=mn(n,"output","maxPoolBackprop");C(u.rank===l.rank,(function(){return"Rank of input ("+u.rank+") does not match rank of dy ("+l.rank+")"})),null==i&&(i=[1,1]),C(Mo(a,i),(function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+i+"'"})),C(4===l.rank,(function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+l.rank+"."})),C(4===u.rank,(function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+u.rank+"."}));var h=Io(u.shape,r,a,i,s,o);return Lt.runKernelFunc((function(e){return e.maxPoolBackprop(l,u,c,h)}),{$dy:l,$input:u})}(e,s,o,t,n,r,a)}}}),"MaxPool",u,c);return l?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}function ll(e,t,n,r,a,i){var s=mn(e,"x","avgPool","float32");null==r&&(r=[1,1]),C(Mo(n,r),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"}));var o=s,l=!1;3===s.rank&&(l=!0,o=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),C(4===o.rank,(function(){return"Error in avgPool: x must be rank 4 but got rank "+o.rank+"."})),null!=i&&C(A(a),(function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+a+"."}));var u=Io(o.shape,t,n,r,a,i);if(1===u.filterWidth&&1===u.filterHeight&&S(u.inShape,u.outShape))return s.clone();var c=Lt.runKernelFunc((function(e){return e.avgPool(o,u)}),{x:o},(function(e){return{x:function(){return function(e,t,n,r,a,i){var s=mn(e,"dy","avgPoolBackprop"),o=mn(t,"input","avgPoolBackprop");C(o.rank===s.rank,(function(){return"Rank of input ("+o.rank+") does not match rank of dy ("+s.rank+")"})),null==a&&(a=[1,1]),C(Mo(r,a),(function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+a+"'"}));var l=o,u=s,c=!1;3===o.rank&&(c=!0,l=o.as4D(1,o.shape[0],o.shape[1],o.shape[2]),u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),C(4===u.rank,(function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+u.rank+"."})),C(4===l.rank,(function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+l.rank+"."}));var h=Io(l.shape,n,r,a,i),d=Lt.runKernelFunc((function(e){return e.avgPoolBackprop(u,l,h)}),{dy4D:u,input4D:l});return c?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}(e,o,t,n,r,a)}}}),"AvgPool",u);return c=c.cast(s.dtype),l?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}var hl=An({maxPool_:function(e,t,n,r,a){return cl(e,t,n,1,r,a)}}),fl=An({avgPool_:function(e,t,n,r,a){return ll(e,t,n,1,r,a)}}),dl=An({pool_:function(e,t,n,r,a,i){null==a&&(a=[1,1]),null==i&&(i=1),0===r&&(r="valid");var s=mn(e,"x","maxPool"),o=s,l=!1;3===s.rank&&(l=!0,o=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),C(Mo(i,a),(function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+a+"'"}));var u,c,h,d,p,f,m=Io(o.shape,t,i,a,r),g=[m.dilationHeight,m.dilationWidth];u="same"===r?(c=[m.filterHeight,m.filterWidth],h=g,d=c.map((function(e,t){return e+(e-1)*(h[t]-1)})).map((function(e){return e-1})),p=d.map((function(e){return Math.floor(e/2)})),f=d.map((function(e,t){return e-p[t]})),d.map((function(e,t){return[p[t],f[t]]}))):[[0,0],[0,0]];var y=1===g[0]&&1===g[1],v=function(e,t,n){var r=n.map((function(e){return e[0]})),a=n.map((function(e){return e[1]})),i=e.concat(r,a),s=t.map((function(e,t){return(e-i[t]%e)%e})),o=a.map((function(e,t){return e+s[t]}));return[t.map((function(e,t){return[r[t],o[t]]})),t.map((function(e,t){return[0,s[t]]}))]}([m.inHeight,m.inWidth],g,u),b=v[0],x=v[1],T=y?r:"valid",_=y?o:Mr(o,g,b),w=("avg"===n?function(){return ll(_,t,i,1,T)}:function(){return cl(_,t,i,1,T)})(),S=y?w:vr(w,g,x);return l?S.as3D(S.shape[1],S.shape[2],S.shape[3]):S}}),pl=An({maxPool3d_:function(e,t,n,r,a,i,s){void 0===i&&(i="NDHWC");var o=mn(e,"x","maxPool3d"),l=o,u=!1;4===o.rank&&(u=!0,l=o.as5D(1,o.shape[0],o.shape[1],o.shape[2],o.shape[3])),null==s&&(s=[1,1,1]),C(5===l.rank,(function(){return"Error in maxPool3d: x must be rank 5 but got rank "+l.rank+"."})),C("NDHWC"===i,(function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+i})),C(Mo(n,s),(function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+s+"'"})),null!=a&&C(A(r),(function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."}));var c=ko(l.shape,t,n,s,r,a,i),h=Lt.runKernelFunc((function(e,t){var n=e.maxPool3d(l,c);return t([l,n]),n}),{x:l},(function(e,i){var o=i[0],l=i[1];return{x:function(){return function(e,t,n,r,a,i,s,o){var l=mn(e,"dy","maxPool3dBackprop"),u=mn(t,"input","maxPool3dBackprop"),c=mn(n,"output","maxPool3dBackprop"),h=l,d=u,p=c,f=!1;4===u.rank&&(f=!0,h=l.as5D(1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]),d=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]),p=c.as5D(1,c.shape[0],c.shape[1],c.shape[2],c.shape[3])),C(5===h.rank,(function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+h.rank+"."})),C(5===d.rank,(function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+d.rank+"."})),C(5===p.rank,(function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+p.rank+"."})),null==i&&(i=[1,1,1]),C(Mo(a,i),(function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+i+"'"})),null!=o&&C(A(s),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+s+"."}));var m=ko(d.shape,r,a,i,s,o),g=Lt.runKernelFunc((function(e){return e.maxPool3dBackprop(h,d,p,m)}),{dy5D:h,input5D:d});return f?g.as4D(g.shape[1],g.shape[2],g.shape[3],g.shape[4]):g}(e,o,l,t,n,s,r,a)}}}));return u?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),vl=An({avgPool3d_:function(e,t,n,r,a,i,s){void 0===i&&(i="NDHWC");var o=mn(e,"x","avgPool3d","float32"),l=o,u=!1;4===o.rank&&(u=!0,l=o.as5D(1,o.shape[0],o.shape[1],o.shape[2],o.shape[3])),null==s&&(s=[1,1,1]),C(5===l.rank,(function(){return"Error in avgPool3d: x must be rank 5 but got rank "+l.rank+"."})),C("NDHWC"===i,(function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+i})),C(Mo(n,s),(function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+s+"'"})),null!=a&&C(A(r),(function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."}));var c=ko(l.shape,t,n,s,r,a,i),h=Lt.runKernelFunc((function(e){return e.avgPool3d(l,c)}),{x:l},(function(e){return{x:function(){return function(e,t,n,r,a,i,s){var o=mn(e,"dy","avgPool3dBackprop"),l=mn(t,"input","avgPool3dBackprop"),u=o,c=l,h=!1;4===l.rank&&(h=!0,u=o.as5D(1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]),c=l.as5D(1,l.shape[0],l.shape[1],l.shape[2],l.shape[3])),C(5===u.rank,(function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+u.rank+"."})),C(5===c.rank,(function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+c.rank+"."})),null==a&&(a=[1,1,1]),C(Mo(r,a),(function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+a+"'"})),null!=s&&C(A(i),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+i+"."}));var d=ko(c.shape,n,r,a,i,s),p=Lt.runKernelFunc((function(e){return e.avgPool3dBackprop(u,c,d)}),{dy5D:u,input5D:c});return h?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}(e,l,t,n,s,r,a)}}}));return h=h.cast(l.dtype),u?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),ml=An({slice_:function(e,t,n){var r,a,i=mn(e,"x","slice");if(0===i.rank)throw new Error("Slicing scalar is not possible");(r="number"==typeof t?[t].concat(new Array(i.rank-1).fill(0)):t.length<i.rank?t.concat(new Array(i.rank-t.length).fill(0)):t.slice()).forEach((function(e){C(-1!==e,(function(){return"slice() does not support negative begin indexing."}))})),a=(a=null==n?new Array(i.rank).fill(-1):"number"==typeof n?[n].concat(new Array(i.rank-1).fill(-1)):n.length<i.rank?n.concat(new Array(i.rank-n.length).fill(-1)):n).map((function(e,t){return e>=0?e:(C(-1===e,(function(){return"Negative size values should be exactly -1 but got "+e+" for the slice() size at index "+t+"."})),i.shape[t]-r[t])})),eo(i,r,a);var s=i.shape,o={begin:r,size:a};return Lt.runKernelFunc((function(e){return e.slice(i,r,a)}),{x:i},(function(e){for(var t=[],n=0;n<e.rank;n++)t.push([r[n],s[n]-r[n]-a[n]]);return{x:function(){return e.pad(t)}}}),"Slice",o)}}),gl=An({slice1d_:function(e,t,n){var r=mn(e,"x","slice1d");return C(1===r.rank,(function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"})),ml(r,[t],[n])}}),yl=An({slice2d_:function(e,t,n){var r=mn(e,"x","slice2d");return C(2===r.rank,(function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"})),ml(r,t,n)}}),xl=An({slice3d_:function(e,t,n){var r=mn(e,"x","slice3d");return C(3===r.rank,(function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"})),ml(r,t,n)}}),bl=An({slice4d_:function(e,t,n){var r=mn(e,"x","slice4d");return C(4===r.rank,(function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"})),ml(r,t,n)}});function wl(e,t,n,r,a){return t.rank<n.rank&&(t=t.reshape(wn(t.shape,r))),e.rank<n.rank&&(e=e.reshape(wn(e.shape,r))),{x:function(){var r=e.mul(n.equal(t).cast(e.dtype));return null==a?r:r.transpose(a)}}}var Cl=An({all_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=mn(e,"x","all","bool"),a=O(t,r.shape),i=a,s=En(i,r.rank);null!=s&&(r=r.transpose(s),i=In(i.length,r.rank));var o=Lt.runKernelFunc((function(e){return e.all(r,i)}),{$x:r});if(n){var l=wn(o.shape,a);return o.reshape(l)}return o}}),El=An({any_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=mn(e,"x","any","bool"),a=O(t,r.shape),i=a,s=En(i,r.rank);null!=s&&(r=r.transpose(s),i=In(i.length,r.rank));var o=Lt.runKernelFunc((function(e){return e.any(r,i)}),{$x:r});if(n){var l=wn(o.shape,a);return o.reshape(l)}return o}}),Rl=An({argMax_:function(e,t){void 0===t&&(t=0);var n=mn(e,"x","argMax");null==t&&(t=0);var r=O(t,n.shape),a=En(r,n.rank);null!=a&&(n=n.transpose(a),r=In(r.length,n.rank));var i={axis:r[0]},s=[n];return Lt.runKernelFunc((function(e,t){var a=e.argMax(n,r[0]);return t([n]),a}),{x:n},(function(e,t){var n=t[0];return{x:function(){return Xn(n)}}}),"ArgMax",i,s)}}),Il=An({argMin_:function(e,t){void 0===t&&(t=0);var n=mn(e,"x","argMin");null==t&&(t=0);var r=O(t,n.shape),a=En(r,n.rank);return null!=a&&(n=n.transpose(a),r=In(r.length,n.rank)),Lt.runKernelFunc((function(e,t){var a=e.argMin(n,r[0]);return t([n]),a}),{$x:n},(function(e,t){var n=t[0];return{$x:function(){return Xn(n)}}}))}}),kl=An({logSumExp_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=mn(e,"x","logSumExp"),a=O(t,r.shape),i=r.max(a,!0),s=r.sub(i).exp().sum(a).log(),o=i.reshape(s.shape).add(s);if(n){var l=wn(o.shape,a);return o.reshape(l)}return o}}),Sl=An({max_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=mn(e,"x","max"),a=r,i=O(t,r.shape),s=i,o=En(s,r.rank);null!=o&&(r=r.transpose(o),s=In(s.length,r.rank));var l=[r],u=Lt.runKernelFunc((function(e,t){var n=e.max(r,s);return t([a,n]),n}),{x:r},(function(e,t){return wl(e,t[1],t[0],i,o)}),"Max",{axes:s},l,[!0]);if(n){var c=wn(u.shape,i);u=u.reshape(c)}return u}}),Al=An({mean_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=mn(e,"x","mean"),a=O(t,r.shape),i=k(bn(r.shape,a)[1]);return vo((function(e){var r=On(i);return{value:(r.dtype===e.dtype?e:e.cast(r.dtype)).div(r).sum(t,n),gradFunc:function(t){var n=e.shape.slice();return a.forEach((function(e){n[e]=1})),t.reshape(n).mul(zn(e.shape,"float32")).div(i)}}}))(r)}}),Dl=An({min_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=mn(e,"x","min"),a=r,i=O(t,r.shape),s=i,o=En(s,r.rank);null!=o&&(r=r.transpose(o),s=In(s.length,r.rank));var l=[r],u=Lt.runKernelFunc((function(e,t){var n=e.min(r,s);return t([a,n]),n}),{x:r},(function(e,t){return wl(e,t[1],t[0],i,o)}),"Min",{axes:s},l,[!0]);if(n){var c=wn(u.shape,i);u=u.reshape(c)}return u}}),Tl=An({moments_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=O(t,(e=mn(e,"x","moments")).shape),a=e.mean(r,n),i=a.shape;n||(i=wn(a.shape,r));var s=e.toFloat().sub(a.reshape(i)).square();return{mean:a,variance:s.mean(r,n)}}}),Nl=An({sum_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=mn(e,"x","sum");"bool"===r.dtype&&(r=r.toInt());var a=O(t,r.shape);return vo((function(e){var t=En(a,e.rank),r=a,i=e;null!=t&&(i=e.transpose(t),r=In(r.length,e.rank));var s=function(t){var n=e.shape.slice();return a.forEach((function(e){n[e]=1})),t.reshape(n).mul(zn(e.shape,"float32"))},o={axes:r},l=Lt.runKernelFunc((function(e){return e.sum(i,r)}),{x:i},(function(e){return{x:function(){return s(e)}}}),"Sum",o);if(n){var u=wn(l.shape,a);l=l.reshape(u)}return{value:l,gradFunc:s}}))(r)}}),Fl=An({prod_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=mn(e,"x","prod");"bool"===r.dtype&&(r=r.toInt());var a=O(t,r.shape),i=En(a,r.rank),s=a,o=r;null!=i&&(o=r.transpose(i),s=In(s.length,r.rank));var l=Lt.runKernelFunc((function(e){return e.prod(o,s)}),{permutedX:o});if(n){var u=wn(l.shape,a);l=l.reshape(u)}return l}}),_l=An({elu_:function(e){var t=mn(e,"x","elu");return Lt.runKernelFunc((function(e,n){var r=e.elu(t);return n([r]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return Lt.runKernelFunc((function(t){return t.eluDer(e,n)}),{dy:e,y:n})}}}))}}),Ol=An({leakyRelu_:function(e,t){void 0===t&&(t=.2);var n=mn(e,"x","leakyRelu");return hc(On(t).mul(n),n)}}),Ml=An({prelu_:function(e,t){var n=mn(e,"x","prelu"),r=mn(t,"alpha","prelu");return Lt.runKernelFunc((function(e,t){var a=e.prelu(n,r);return t([n,r]),a}),{x:n,alpha:r},(function(e,t){var n=t[0],r=t[1],a=n.greater(0);return{x:function(){return ec(a,e,e.mul(r))},alpha:function(){var t=ec(a,Xn(e),e.mul(n)),i=Eo(r.shape,e.shape);return i.length>0&&(t=t.sum(i)),t.reshape(r.shape)}}}),"Prelu")}}),Bl=An({relu_:function(e){var t=mn(e,"x","relu");return"bool"===t.dtype?t.toInt():Lt.runKernelFunc((function(e,n){var r=e.relu(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.mulStrict(n.step().toFloat())}}}),"Relu")}}),Pl=An({relu6_:function(e){var t=mn(e,"x","relu6");return"bool"===t.dtype?t.toInt():Lt.runKernelFunc((function(e,n){var r=e.relu6(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0],r=n.lessEqual(6).mul(n.step());return{x:function(){return e.mulStrict(r.toFloat())}}}),"Relu6")}}),Ll=An({selu_:function(e){var t=mn(e,"x","selu");return Lt.runKernelFunc((function(e,n){var r=e.selu(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){var t=n.greater(On(0)),r=On(bs),a=On(ws),i=e.mul(a),s=e.mul(r).mul(n.toFloat().exp());return ec(t,i,s)}}}))}}),Wl=An({transpose_:function(e,t){var n=mn(e,"x","transpose");if(null==t&&(t=n.shape.map((function(e,t){return t})).reverse()),C(n.rank===t.length,(function(){return"Error in transpose: rank of input "+n.rank+" must match length of perm "+t+"."})),t.forEach((function(e){C(e>=0&&e<n.rank,(function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+t}))})),n.rank<=1)return n.clone();var r={perm:t};return Lt.runKernelFunc((function(e){return e.transpose(n,t)}),{x:n},(function(e){var n=Rn(t);return{x:function(){return e.transpose(n)}}}),"Transpose",r)}}),Ul=An({localResponseNormalization_:function(e,t,n,r,a){void 0===t&&(t=5),void 0===n&&(n=1),void 0===r&&(r=1),void 0===a&&(a=.5);var i=mn(e,"x","localResponseNormalization");C(4===i.rank||3===i.rank,(function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+i.rank+"."})),C(A(t),(function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+t+"."}));var s=i,o=!1;3===i.rank&&(o=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2]));var l=Lt.runKernelFunc((function(e,i){var o=e.localResponseNormalization4D(s,t,n,r,a);return i([s,o]),o}),{x4D:s},(function(e,i){var s=i[0],o=i[1];return{x4D:function(){return Lt.runKernelFunc((function(i){return i.LRNGrad(e,s,o,t,n,r,a)}),{})}}}));return o?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}}),Vl=An({norm_:function(e,t,n,r){void 0===t&&(t="euclidean"),void 0===n&&(n=null),void 0===r&&(r=!1);var a=function e(t,n,r){if(void 0===r&&(r=null),0===t.rank)return t.abs();if(1!==t.rank&&null===r)return e(t.reshape([-1]),n,r);if(1===t.rank||"number"==typeof r||Array.isArray(r)&&1===r.length){if(1===n)return t.abs().sum(r);if(n===1/0)return t.abs().max(r);if(n===-1/0)return t.abs().min(r);if("euclidean"===n||2===n)return t.abs().pow(On(2,"int32")).sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}if(Array.isArray(r)&&2===r.length){if(1===n)return t.abs().sum(r[0]).max(r[1]-1);if(n===1/0)return t.abs().sum(r[1]).max(r[0]);if(n===-1/0)return t.abs().sum(r[1]).min(r[0]);if("fro"===n||"euclidean"===n)return t.square().sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}throw new Error("Error in norm: invalid axis: "+r)}(e=mn(e,"x","norm"),t,n),i=a.shape;if(r){var s=O(n,e.shape);i=wn(a.shape,s)}return a.reshape(i)}}),zl=An({basicLSTMCell_:function(e,t,n,r,a,i){var s=mn(e,"forgetBias","basicLSTMCell"),o=mn(t,"lstmKernel","basicLSTMCell"),l=mn(n,"lstmBias","basicLSTMCell"),u=mn(r,"data","basicLSTMCell"),c=mn(a,"c","basicLSTMCell"),h=mn(i,"h","basicLSTMCell"),d=u.concat(h,1).matMul(o).add(l),p=d.shape[0],f=d.shape[1]/4,m=[p,f],g=d.slice([0,0],m),y=d.slice([0,f],m),v=d.slice([0,2*f],m),b=d.slice([0,3*f],m),x=g.sigmoid().mulStrict(y.tanh()).addStrict(c.mulStrict(s.add(v).sigmoid())),T=x.tanh().mulStrict(b.sigmoid());return[x,T]}}),Gl=An({multiRNNCell_:function(e,t,n,r){for(var a=mn(t,"data","multiRNNCell"),i=gn(n,"c","multiRNNCell"),s=gn(r,"h","multiRNNCell"),o=a,l=[],u=0;u<e.length;u++){var c=e[u](o,i[u],s[u]);l.push(c[0]),l.push(c[1]),o=c[1]}var h=[],d=[];for(u=0;u<l.length;u+=2)h.push(l[u]),d.push(l[u+1]);return[h,d]}}),Hl=An({movingAverage_:function(e,t,n,r,a){void 0===a&&(a=!0);var i=mn(e,"v","movingAverage"),s=mn(t,"x","movingAverage"),o=mn(n,"decay","movingAverage");Ft(i,s),C(S(i.shape,s.shape),(function(){return"Shape mismatch in v and x"}));var l=On(1),u=l.sub(o),c=s.sub(i).mul(u);if(a){C(null!=r,(function(){return"When using zeroDebias: true, step is required."}));var h=mn(r,"step","movingAverage");c=c.div(l.sub(xc(o,h)))}return i.add(c)}}),ql=An({stridedSlice_:function(e,t,n,r,a,i,s,o,l){if(void 0===a&&(a=0),void 0===i&&(i=0),void 0===s&&(s=0),void 0===o&&(o=0),void 0===l&&(l=0),null==r&&(r=new Array(t.length)),0!==s)throw new Error("ellipsis mask is not yet supported");var u=mn(e,"x","stridedSlice"),c=no(o),h=u.shape.slice();c.forEach((function(e){t[e]=0,n[e]=1,h.splice(e,0,1)})),u=u.reshape(h);for(var d=0;d<u.rank;d++)t[d]=oo(a,t,r,u.shape,d),n[d]=ao(i,n,r,u.shape,d),r[d]=r[d]||1;var p=no(l);p.forEach((function(e){n[e]=t[e]+1,r[e]=1}));var f=ro(t,n,r),m=f.filter((function(e,t){return-1===p.indexOf(t)}));return r.every((function(e){return 1===e}))?ml(u,t,f).reshape(m):Lt.runKernelFunc((function(e){return e.stridedSlice(u,t,n,r)}),{$x:u}).reshape(m)}}),Kl=An({topk_:function(e,t,n){void 0===t&&(t=1),void 0===n&&(n=!0);var r=mn(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var a=r.shape[r.shape.length-1];if(t>a)throw new Error("'k' passed to topk() must be <= the last dimension ("+a+") but got "+t);var i=Lt.runKernelFunc((function(e){return e.topk(r,t,n)}),{$x:r});return{values:i[0],indices:i[1]}}}),jl=An({scatterND_:function(e,t,n){var r=mn(e,"indices","scatterND","int32"),a=mn(t,"updates","scatterND");return Jr(a,r,n),Lt.runKernelFunc((function(e){return e.scatterND(r,a,n)}),{indices:r,updates:a},null,"ScatterNd",{shape:n})}}),Xl=An({fft_:function(e){C("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+e.dtype+"."}));var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return Lt.runKernelFunc((function(e){return e.fft(r)}),{input:e}).reshape(e.shape)}}),Yl=An({ifft_:function(e){C("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+e.dtype+"."}));var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return Lt.runKernelFunc((function(e){return e.ifft(r)}),{input:e}).reshape(e.shape)}}),$l=An({rfft_:function(e,t){C("float32"===e.dtype,(function(){return"The dtype for rfft() must be real value but got "+e.dtype}));var n,r=e.shape[e.shape.length-1],a=e.size/r;if(null!=t&&t<r){var i=e.shape.map((function(e){return 0})),s=e.shape.map((function(e){return e}));s[e.shape.length-1]=t,n=e.slice(i,s),r=t}else if(null!=t&&t>r){var o=e.shape.map((function(e){return e}));o[e.shape.length-1]=t-r,n=e.concat(Gn(o),e.shape.length-1),r=t}else n=e;var l=n.zerosLike(),u=Dn(n,l).as2D(a,r),c=Xl(u),h=Math.floor(r/2)+1,d=Tn(c),p=Nn(c),f=d.split([h,r-h],d.shape.length-1),m=p.split([h,r-h],p.shape.length-1),g=n.shape.slice();return g[n.shape.length-1]=h,Dn(f[0],m[0]).reshape(g)}}),Ql=An({irfft_:function(e){var t=e.shape[e.shape.length-1],n=e.size/t;if(t<=2){var r=e.as2D(n,t),a=Yl(r);return Tn(a)}var i=[n,2*(t-1)],s=Tn(e).as2D(n,t),o=Nn(e).as2D(n,t),l=s.slice([0,1],[n,t-2]).reverse(1),u=o.slice([0,1],[n,t-2]).reverse(1).mul(On(-1)),c=s.concat(l,1),h=o.concat(u,1);return r=Dn(c,h).as2D(i[0],i[1]),a=Yl(r),Tn(a)}}),Jl=Object.freeze({fft:Xl,ifft:Yl,rfft:$l,irfft:Ql}),Zl=An({sparseToDense_:function(e,t,n,r){void 0===r&&(r=0);var a=mn(e,"sparseIndices","sparseToDense","int32"),i=mn(t,"sparseValues","sparseToDense"),s=mn(r,"defaultValue","sparseToDense",i.dtype);return function(e,t,n,r){if("int32"!==e.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+e.shape+".");var a=e.rank>0?e.shape[0]:1,i=e.rank>1?e.shape[1]:1;if(n.length!==i)throw new Error("outputShape has incorrect number of elements:, "+n.length+", should be: "+i+".");var s=t.size;if(0!==t.rank&&(1!==t.rank||s!==a))throw new Error("sparseValues has incorrect shape "+t.shape+", should be [] or ["+a+"]");if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(a,i,n,s),Lt.runKernelFunc((function(e){return e.sparseToDense(a,i,n,s)}),{$sparseIndices:a,$sparseValues:i,$defaultValue:s})}}),th=An({gatherND_:function(e,t){var n=mn(t,"indices","gatherND","int32"),r=mn(e,"x","gatherND");return Lt.runKernelFunc((function(e){return e.gatherND(r,n)}),{x:r,indices:n},null,"GatherNd")}}),eh=An({diag_:function(e){var t=mn(e,"x","diag").flatten(),n=e.shape.concat(e.shape);return Lt.runKernelFunc((function(e){return e.diag(t)}),{$x:t}).reshape(n)}}),nh=An({dropout_:function(e,t,n,r){var a=mn(e,"x","dropout");if(C("float32"===a.dtype,(function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+a.dtype+" tensor instead."})),C(t>=0&&t<1,(function(){return"rate must be a float in the range [0, 1), but got "+t+"."})),0===t)return e instanceof wt?a.clone():a;var i=function(e,t){if(null==t)return e.shape.slice();if(S(e.shape,t))return t;if(e.shape.length===t.length){for(var n=[],r=0;r<e.shape.length;r++)null==t[r]&&null!=e.shape[r]?n.push(e.shape[r]):n.push(t[r]);return n}return t}(a,n),s=1-t,o=_r(i,0,1,"float32",r).add(s).floor().div(s);return a.mul(o)}});function rh(e,t,n){for(var r=1-e%2,a=new Float32Array(e),i=0;i<e;++i){var s=2*Math.PI*i/(e+r-1);a[i]=t-n*Math.cos(s)}return Mn(a,"float32")}var oh=An({hannWindow_:function(e){return rh(e,.5,.5)}}),ah=An({hammingWindow_:function(e){return rh(e,.54,.46)}}),ih=An({frame_:function(e,t,n,r,a){void 0===r&&(r=!1),void 0===a&&(a=0);for(var i=0,s=[];i+t<=e.size;)s.push(ml(e,i,t)),i+=n;if(r)for(;i<e.size;){var o=i+t-e.size,l=Yn([ml(e,i,t-o),Hn([o],a)]);s.push(l),i+=n}return 0===s.length?Bn([],[0,t]):Yn(s).as2D(s.length,t)}}),sh=An({stft_:function(e,t,n,r,a){var i;void 0===a&&(a=oh),null==r&&(i=t,r=Math.floor(Math.pow(2,Math.ceil(Math.log(i)/Math.log(2)))));for(var s=ih(e,t,n),o=gc(s,a(t)),l=[],u=0;u<s.shape[0];u++)l.push($l(o.slice([u,0],[1,t]),r));return Yn(l)}}),uh=Object.freeze({hannWindow:oh,hammingWindow:ah,frame:ih,stft:sh}),ch,lh=function(e,t,a){return void 0===a&&(a=1),n(this,void 0,void 0,(function(){var n,i,s,o,l,u,c,h,d,p,f,m,g,y;return r(this,(function(r){switch(r.label){case 0:return n=mn(e,"predictions","inTopK"),i=mn(t,"targets","inTopK"),C(n.rank>1,(function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+n.rank})),C(n.rank-1===i.rank,(function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+n.rank+" and targets rank "+i.rank})),E(n.shape.slice(0,n.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),s=n.shape[n.shape.length-1],C(a>0&&a<=s,(function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+s+"), but got "+a})),[4,n.data()];case 1:return o=r.sent(),[4,i.data()];case 2:for(l=r.sent(),u=[o.length/s,s],h=u[1],d=B("bool",c=u[0]),p=0;p<c;p++){for(f=p*h,m=o.subarray(f,f+h),g=[],y=0;y<m.length;y++)g.push({value:m[y],index:y});for(g.sort((function(e,t){return t.value-e.value})),d[p]=0,y=0;y<a;y++)if(g[y].index===l[p]){d[p]=1;break}}return e!==n&&n.dispose(),t!==i&&i.dispose(),[2,Fn$1(d,i.shape,"bool")]}}))}))};!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(ch||(ch={}));var hh=An({absoluteDifference_:function(e,t,n,r){void 0===r&&(r=ch.SUM_BY_NONZERO_WEIGHTS);var a=mn(e,"labels","absoluteDifference"),i=mn(t,"predictions","absoluteDifference"),s=null;null!=n&&(s=mn(n,"weights","absoluteDifference")),E(a.shape,i.shape,"Error in absoluteDifference: ");var o=a.sub(i).abs();return fh(o,s,r)}}),fh=An({computeWeightedLoss_:function(e,t,n){void 0===n&&(n=ch.SUM_BY_NONZERO_WEIGHTS);var r=mn(e,"losses","computeWeightedLoss"),a=null;null!=t&&(a=mn(t,"weights","computeWeightedLoss"));var i=null==a?r:r.mul(a);if(n===ch.NONE)return i;if(n===ch.SUM)return i.sum();if(n===ch.MEAN){if(null==a)return i.mean();var s=r.size/a.size,o=i.sum().div(a.sum());return s>1?o.div(On(s)):o}if(n===ch.SUM_BY_NONZERO_WEIGHTS){if(null==a)return i.sum().div(On(r.size));var l=a.mul(zn(r.shape)).notEqual(On(0)).sum().toFloat();return i.sum().div(l)}throw Error("Unknown reduction: "+n)}}),dh=An({cosineDistance_:function(e,t,n,r,a){void 0===a&&(a=ch.SUM_BY_NONZERO_WEIGHTS);var i=mn(e,"labels","cosineDistance"),s=mn(t,"predictions","cosineDistance"),o=null;null!=r&&(o=mn(r,"weights","cosineDistance")),E(i.shape,s.shape,"Error in cosineDistance: ");var l=On(1).sub(i.mul(s).sum(n,!0));return fh(l,o,a)}}),ph=An({hingeLoss_:function(e,t,n,r){void 0===r&&(r=ch.SUM_BY_NONZERO_WEIGHTS);var a=mn(e,"labels","hingeLoss"),i=mn(t,"predictions","hingeLoss"),s=null;null!=n&&(s=mn(n,"weights","hingeLoss")),E(a.shape,i.shape,"Error in hingeLoss: ");var o=On(1);a=On(2).mul(a).sub(o);var l=o.sub(a.mul(i)).relu();return fh(l,s,r)}}),vh=An({huberLoss_:function(e,t,n,r,a){void 0===r&&(r=1),void 0===a&&(a=ch.SUM_BY_NONZERO_WEIGHTS);var i=mn(e,"labels","huberLoss"),s=mn(t,"predictions","huberLoss"),o=null;null!=n&&(o=mn(n,"weights","huberLoss")),E(i.shape,s.shape,"Error in huberLoss: ");var l=On(r),u=s.sub(i).abs(),c=dc(u,l),h=u.sub(c),d=On(.5).mul(c.square()).add(l.mul(h));return fh(d,o,a)}}),mh=An({logLoss_:function(e,t,n,r,a){void 0===r&&(r=1e-7),void 0===a&&(a=ch.SUM_BY_NONZERO_WEIGHTS);var i=mn(e,"labels","logLoss"),s=mn(t,"predictions","logLoss"),o=null;null!=n&&(o=mn(n,"weights","logLoss")),E(i.shape,s.shape,"Error in logLoss: ");var l=On(1),u=On(r),c=i.mul(s.add(u).log()).neg().sub(l.sub(i).mul(l.sub(s).add(u).log()));return fh(c,o,a)}}),gh=An({meanSquaredError_:function(e,t,n,r){void 0===r&&(r=ch.SUM_BY_NONZERO_WEIGHTS);var a=mn(e,"labels","meanSquaredError"),i=mn(t,"predictions","meanSquaredError"),s=null;null!=n&&(s=mn(n,"weights","meanSquaredError")),E(a.shape,i.shape,"Error in meanSquaredError: ");var o=a.squaredDifference(i);return fh(o,s,r)}}),yh=An({sigmoidCrossEntropy_:function(e,t,n,r,a){void 0===r&&(r=0),void 0===a&&(a=ch.SUM_BY_NONZERO_WEIGHTS);var i=mn(e,"multiClassLabels","sigmoidCrossEntropy"),s=mn(t,"logits","sigmoidCrossEntropy"),o=null;if(null!=n&&(o=mn(n,"weights","sigmoidCrossEntropy")),E(i.shape,s.shape,"Error in sigmoidCrossEntropy: "),r>0){var l=On(r),u=On(1),c=On(.5);i=i.mul(u.sub(l)).add(c.mul(l))}var h=function(e,t){var n=mn(e,"labels","sigmoidCrossEntropyWithLogits"),r=mn(t,"logits","sigmoidCrossEntropyWithLogits");E(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var a=r.relu(),i=r.mul(n),s=r.abs().neg().exp().log1p();return a.sub(i).add(s)}(i,s);return fh(h,o,a)}}),xh=An({softmaxCrossEntropy_:function(e,t,n,r,a){void 0===r&&(r=0),void 0===a&&(a=ch.SUM_BY_NONZERO_WEIGHTS);var i=mn(e,"onehotLabels","softmaxCrossEntropy"),s=mn(t,"logits","softmaxCrossEntropy"),o=null;if(null!=n&&(o=mn(n,"weights","softmaxCrossEntropy")),E(i.shape,s.shape,"Error in softmaxCrossEntropy: "),r>0){var l=On(r),u=On(1),c=On(i.shape[1]);i=i.mul(u.sub(l)).add(l.div(c))}var h=function(e,t,n){if(void 0===n&&(n=-1),-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+t.rank+" and dim was "+n);return vo((function(e,t,r){var a=t.logSumExp([n],!0),i=t.toFloat().sub(a);return r([e,i]),{value:i.mul(e).neg().sum([n]),gradFunc:function(e,t){var r=t[0],a=t[1],i=wn(e.shape,[n]);return[e.reshape(i).mul(r.toFloat().sub(a.exp())),e.reshape(i).mul(a.exp().sub(r.toFloat()))]}}}))(e,t)}(i,s);return fh(h,o,a)}}),bh=Object.freeze({get Reduction(){return ch},absoluteDifference:hh,computeWeightedLoss:fh,cosineDistance:dh,hingeLoss:ph,huberLoss:vh,logLoss:mh,meanSquaredError:gh,sigmoidCrossEntropy:yh,softmaxCrossEntropy:xh});function wh(e,t){return void 0===t&&(t=!1),Lt.tidy((function(){if(2!==e.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+e.shape.length+"D Tensor.");for(var n=e.shape[0],r=e.shape[1],a=Cr(n),i=e.clone(),s=Bn([[1]],[1,1]),o=s.clone(),l=n>=r?r:n,u=function(e){var t,l=i,u=o,c=a;t=Lt.tidy((function(){var t=i.slice([e,e],[n-e,1]),l=t.norm(),u=i.slice([e,e],[1,1]),c=Bn([[-1]]).where(u.greater(0),Bn([[1]])),h=u.sub(c.mul(l)),d=t.div(h);o=1===d.shape[0]?s.clone():s.concat(d.slice([1,0],[d.shape[0]-1,d.shape[1]]),0);var p=c.matMul(h).div(l).neg(),f=i.slice([e,0],[n-e,r]),m=p.mul(o);if(0===e)i=f.sub(m.matMul(o.transpose().matMul(f)));else{var g=f.sub(m.matMul(o.transpose().matMul(f)));i=i.slice([0,0],[e,r]).concat(g,0)}var y=a.slice([0,e],[n,a.shape[1]-e]);if(0===e)a=y.sub(y.matMul(o).matMul(m.transpose()));else{var v=y.sub(y.matMul(o).matMul(m.transpose()));a=a.slice([0,0],[n,e]).concat(v,1)}return[o,i,a]})),o=t[0],i=t[1],a=t[2],tn([l,u,c])},c=0;c<l;++c)u(c);return!t&&n>r&&(a=a.slice([0,0],[n,r]),i=i.slice([0,0],[r,r])),[a,i]}))}var Ch=An({bandPart_:function(e,t,n){if(t%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+t+".");if(n%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+n+".");var r=mn(e,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var a=r.shape,i=r.shape.slice(-2),s=i[0],o=i[1];if(!(t<=s))throw new Error("bandPart(): numLower ("+t+") must not be greater than the number of rows ("+s+").");if(!(n<=o))throw new Error("bandPart(): numUpper ("+n+") must not be greater than the number of columns ("+o+").");t<0&&(t=s),n<0&&(n=o);var l=Kn(0,s,1,"int32").reshape([-1,1]),u=Kn(0,o,1,"int32"),c=Cc(l,u),h=Qu(c.lessEqual(On(+t,"int32")),c.greaterEqual(On(-n,"int32"))),d=Gn([s,o],r.dtype);return Pr(Ur(r.reshape([-1,s,o])).map((function(e){return ec(h,e,d)}))).reshape(a)}}),Eh=An({gramSchmidt_:function(e){var t;if(Array.isArray(e)){t=!1,C(null!=e&&e.length>0,(function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"}));for(var n=e[0].shape[0],r=function(t){C(e[t].shape[0]===n,(function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+e[t].shape[0]+" vs. "+n+")"}))},a=1;a<e.length;++a)r(a)}else t=!0,e=tr(e,e.shape[0],0).map((function(e){return Br(e,[0])}));C(e.length<=e[0].shape[0],(function(){return"Gram-Schmidt: Number of vectors ("+e.length+") exceeds number of dimensions ("+e[0].shape[0]+")."}));var i=[],s=e,o=function(e){i.push(Lt.tidy((function(){var t=s[e];if(e>0)for(var n=0;n<e;++n){var r=Nl(i[n].mulStrict(t)).mul(i[n]);t=t.sub(r)}return t.div(Vl(t,"euclidean"))})))};for(a=0;a<e.length;++a)o(a);return t?Pr(i,0):i}}),Rh=An({qr_:function(e,t){if(void 0===t&&(t=!1),e.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+e.rank);if(2===e.rank)return wh(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce((function(e,t){return e*t})),r=Ur(e.reshape([n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),a=[],i=[];return r.forEach((function(e){var n=wh(e,t),r=n[0],s=n[1];a.push(r),i.push(s)})),[Pr(a,0).reshape(e.shape),Pr(i,0).reshape(e.shape)]}}),Ih=Object.freeze({bandPart:Ch,gramSchmidt:Eh,qr:Rh});function kh(e,t,n,r,a,i){null==r&&(r=.5),null==a&&(a=Number.NEGATIVE_INFINITY),null==i&&(i=0);var s=e.shape[0];return n=Math.min(n,s),C(0<=r&&r<=1,(function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"})),C(2===e.rank,(function(){return"boxes must be a 2D tensor, but was of rank '"+e.rank+"'"})),C(4===e.shape[1],(function(){return"boxes must have 4 columns, but 2nd dimension was "+e.shape[1]})),C(1===t.rank,(function(){return"scores must be a 1D tensor"})),C(t.shape[0]===s,(function(){return"scores has incompatible shape with boxes. Expected "+s+", but was "+t.shape[0]})),C(0<=i&&i<=1,(function(){return"softNmsSigma must be in [0, 1], but was '"+i+"'"})),{maxOutputSize:n,iouThreshold:r,scoreThreshold:a,softNmsSigma:i}}var Sh=An({resizeBilinear_:function(e,t,n){void 0===n&&(n=!1);var r=mn(e,"images","resizeBilinear");C(3===r.rank||4===r.rank,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."})),C(2===t.length,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+t+"."}));var a=r,i=!1;3===r.rank&&(i=!0,a=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var s=t[0],o=t[1],l=Lt.runKernelFunc((function(e,t){return t([a]),e.resizeBilinear(a,s,o,n)}),{x:a},(function(e,t){return{x:function(){return Lt.runKernelFunc((function(r){return r.resizeBilinearBackprop(e,t[0],n)}),{})}}}),"ResizeBilinear",{alignCorners:n,newHeight:s,newWidth:o});return i?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}}),Ah=An({resizeNearestNeighbor_:function(e,t,n){void 0===n&&(n=!1);var r=mn(e,"images","resizeNearestNeighbor");C(3===r.rank||4===r.rank,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."})),C(2===t.length,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+t+"."})),C("float32"===r.dtype||"int32"===r.dtype,(function(){return"`images` must have `int32` or `float32` as dtype"}));var a=r,i=!1;3===r.rank&&(i=!0,a=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var s=t[0],o=t[1],l=Lt.runKernelFunc((function(e,t){return t([a]),e.resizeNearestNeighbor(a,s,o,n)}),{batchImages:a},(function(e,t){return{batchImages:function(){return Lt.runKernelFunc((function(r){return r.resizeNearestNeighborBackprop(e,t[0],n)}),{})}}}));return i?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}}),Dh=An({nonMaxSuppression_:function(e,t,n,r,a){void 0===r&&(r=.5),void 0===a&&(a=Number.NEGATIVE_INFINITY);var i=mn(e,"boxes","nonMaxSuppression"),s=mn(t,"scores","nonMaxSuppression"),o=kh(i,s,n,r,a);n=o.maxOutputSize,r=o.iouThreshold,a=o.scoreThreshold;var l={maxOutputSize:n,iouThreshold:r,scoreThreshold:a};return Lt.runKernelFunc((function(e){return e.nonMaxSuppression(i,s,n,r,a)}),{boxes:i,scores:s},null,"NonMaxSuppressionV3",l)}}),Th=function(e,t,a,i,s){return void 0===i&&(i=.5),void 0===s&&(s=Number.NEGATIVE_INFINITY),n(this,void 0,void 0,(function(){var n,o,l,u,c,h,d;return r(this,(function(r){switch(r.label){case 0:return n=mn(e,"boxes","nonMaxSuppressionAsync"),o=mn(t,"scores","nonMaxSuppressionAsync"),l=kh(n,o,a,i,s),a=l.maxOutputSize,i=l.iouThreshold,s=l.scoreThreshold,[4,Promise.all([n.data(),o.data()])];case 1:return u=r.sent(),c=u[0],h=u[1],d=jo(c,h,a,i,s),n!==e&&n.dispose(),o!==t&&o.dispose(),[2,d]}}))}))},Nh=An({nonMaxSuppressionWithScore_:function(e,t,n,r,a,i){void 0===r&&(r=.5),void 0===a&&(a=Number.NEGATIVE_INFINITY),void 0===i&&(i=0);var s=mn(e,"boxes","nonMaxSuppression"),o=mn(t,"scores","nonMaxSuppression"),l=kh(s,o,n,r,a,i),u={maxOutputSize:n=l.maxOutputSize,iouThreshold:r=l.iouThreshold,scoreThreshold:a=l.scoreThreshold,softNmsSigma:i=l.softNmsSigma},c=Lt.runKernel("NonMaxSuppressionV5",{boxes:s,scores:o},u);return{selectedIndices:c[0],selectedScores:c[1]}}}),Fh=function(e,t,a,i,s,o){return void 0===i&&(i=.5),void 0===s&&(s=Number.NEGATIVE_INFINITY),void 0===o&&(o=0),n(this,void 0,void 0,(function(){var n,l,u,c,h,d,p;return r(this,(function(r){switch(r.label){case 0:return n=mn(e,"boxes","nonMaxSuppressionAsync"),l=mn(t,"scores","nonMaxSuppressionAsync"),u=kh(n,l,a,i,s,o),a=u.maxOutputSize,i=u.iouThreshold,s=u.scoreThreshold,o=u.softNmsSigma,[4,Promise.all([n.data(),l.data()])];case 1:return c=r.sent(),h=c[0],d=c[1],p=Xo(h,d,a,i,s,o),n!==e&&n.dispose(),l!==t&&l.dispose(),[2,p]}}))}))},_h=An({cropAndResize_:function(e,t,n,r,a,i){var s=mn(e,"image","cropAndResize"),o=mn(t,"boxes","cropAndResize","float32"),l=mn(n,"boxInd","cropAndResize","int32");a=a||"bilinear",i=i||0;var u=o.shape[0];return C(4===s.rank,(function(){return"Error in cropAndResize: image must be rank 4,but got rank "+s.rank+"."})),C(2===o.rank&&4===o.shape[1],(function(){return"Error in cropAndResize: boxes must be have size ["+u+",4] but had shape "+o.shape+"."})),C(1===l.rank&&l.shape[0]===u,(function(){return"Error in cropAndResize: boxInd must be have size ["+u+"] but had shape "+o.shape+"."})),C(2===r.length,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."})),C(r[0]>=1&&r[1]>=1,(function(){return"cropSize must be atleast [1,1], but was "+r})),C("bilinear"===a||"nearest"===a,(function(){return"method must be bilinear or nearest, but was "+a})),Lt.runKernelFunc((function(e,t){return e.cropAndResize(s,o,l,r,a,i)}),{images:s,boxes:o,boxInd:l},null,"CropAndResize",{method:a,extrapolationValue:i,cropSize:r})}}),Oh=Object.freeze({resizeBilinear:Sh,resizeNearestNeighbor:Ah,nonMaxSuppression:Dh,nonMaxSuppressionAsync:Th,nonMaxSuppressionWithScore:Nh,nonMaxSuppressionWithScoreAsync:Fh,cropAndResize:_h}),Mh=function(e,t){return!(e>0)||"linear"===t},Bh=function(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return e.mul(t.step());throw new Error("Gradient for activation "+n+" has not been implemented yet.")},Ph=function(e,t){var n=t,r=Eo(e.shape,t.shape);return r.length>0&&(n=n.sum(r)),n.reshape(e.shape)},Lh=function(e,t,n){if("linear"===t)return e;if("relu"===t)return Bl(e);if("elu"===t)return _l(e);if("relu6"===t)return Pl(e);if("prelu"===t)return Ml(e,n);throw new Error("Unknown fused activation "+t+".")},Wh=An({fusedMatMul_:function(e){var t,n=e.a,r=e.b,a=e.transposeA,i=void 0!==a&&a,s=e.transposeB,o=void 0!==s&&s,l=e.bias,u=e.activation,c=void 0===u?"linear":u,h=e.preluActivationWeights;if(!1===Mh(Lt.state.gradientDepth,c)){var d=el(n,r,i,o);return null!=l&&(d=rc(d,l)),Lh(d,c,h)}var p=mn(n,"a","fused matMul"),f=mn(r,"b","fused matMul");t=Nt(p,f),p=t[0],f=t[1];var m=i?p.shape[p.rank-2]:p.shape[p.rank-1],g=o?f.shape[f.rank-1]:f.shape[f.rank-2],y=i?p.shape[p.rank-1]:p.shape[p.rank-2],v=o?f.shape[f.rank-2]:f.shape[f.rank-1],b=p.shape.slice(0,-2),x=f.shape.slice(0,-2),T=k(b),_=k(x);C(p.rank>=2&&f.rank>=2&&p.rank===f.rank,(function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+p.rank+" and "+f.rank+"."})),C(S(b,x),(function(){return"Error in fused matMul: outer dimensions ("+b+") and ("+x+") of Tensors with shapes "+p.shape+" and "+f.shape+" must match."})),C(m===g,(function(){return"Error in fused matMul: inner shapes ("+m+") and ("+g+") of Tensors with shapes "+p.shape+" and "+f.shape+" and transposeA="+i+" and transposeB="+o+" must match."}));var w,E,I=p.shape.slice(0,-2).concat([y,v]),A=i?p.as3D(T,m,y):p.as3D(T,y,m),N=o?f.as3D(_,v,g):f.as3D(_,g,v);null!=l&&Ro(I,(w=Nt(w=mn(l,"bias","fused matMul"),p)[0]).shape),null!=h&&(E=mn(h,"prelu weights","fused matMul"));var $={a:A,b:N};null!=l&&($.bias=w),null!=h&&($.preluActivationWeights=E);var D=[A,N];return Lt.runKernelFunc((function(e,t){var n=e.fusedBatchMatMul({a:A,b:N,transposeA:i,transposeB:o,bias:w,activation:c,preluActivationWeights:E});return t([A,N,n]),n}),$,(function(e,t){var n=t[0],r=t[1],a=t[2],s=Bh(e,a,c),u={};return null!=l&&(u={bias:function(){return Ph(w,s)}}),i||o?!i&&o?Object.assign({a:function(){return s.matMul(r,!1,!1)},b:function(){return s.matMul(n,!0,!1)}},u):i&&!o?Object.assign({a:function(){return r.matMul(s,!1,!0)},b:function(){return n.matMul(s,!1,!1)}},u):Object.assign({a:function(){return r.matMul(s,!0,!0)},b:function(){return s.matMul(n,!0,!0)}},u):Object.assign({a:function(){return s.matMul(r,!1,!0)},b:function(){return n.matMul(s,!0,!1)}},u)}),"_FusedMatMul",{transposeA:i,transposeB:o,activation:c},D,[!0]).reshape(I)}}),Uh=An({fusedConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,a=e.pad,i=e.dataFormat,s=void 0===i?"NHWC":i,o=e.dilations,l=void 0===o?[1,1]:o,u=e.dimRoundingMode,c=e.bias,h=e.activation,d=void 0===h?"linear":h,p=e.preluActivationWeights;if(d=d||"linear",!1===Mh(Lt.state.gradientDepth,d)){var f=qc(t,n,r,a,s,l,u);return null!=c&&(f=rc(f,c)),Lh(f,d,p)}var m=mn(t,"x","conv2d"),g=mn(n,"filter","conv2d"),y=m,v=!1;3===m.rank&&(v=!0,y=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),C(4===y.rank,(function(){return"Error in fused conv2d: input must be rank 4, but got rank "+y.rank+"."})),C(4===g.rank,(function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+g.rank+"."})),null!=u&&C(A(a),(function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+u+" but got pad "+a+"."})),C(y.shape[3]===g.shape[2],(function(){return"Error in conv2d: depth of input ("+y.shape[3]+") must match input depth for filter "+g.shape[2]+"."})),C(Mo(r,l),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+l+"'"})),C("NHWC"===s,(function(){return"Error in conv2d: got dataFormat of "+s+" but only NHWC is currently supported."}));var b,x,T=So(y.shape,g.shape,r,l,a,u);null!=c&&(b=Nt(b=mn(c,"bias","fused conv2d"),m)[0],Ro(T.outShape,b.shape)),null!=p&&(x=mn(p,"prelu weights","fused conv2d"));var _={x:y,filter:g};null!=c&&(_.bias=b),null!=p&&(_.preluActivationWeights=x);var w=[g,y],S=Lt.runKernelFunc((function(e,t){var n=e.fusedConv2d({input:y,filter:g,convInfo:T,bias:b,activation:d,preluActivationWeights:x});return t([g,y,n]),n}),_,(function(e,t){var n=t,i=n[0],s=n[1],o=n[2],u=Bh(e,o,d);C(Oo(l),(function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+l+"'"}));var h={};return null!=c&&(h={bias:function(){return Ph(b,u)}}),Object.assign({x:function(){return Xc(s.shape,u,i,r,a)},filter:function(){return jc(s,u,i.shape,r,a)}},h)}),"FusedConv2D",{convInfo:T,activation:d},w,[!0]);return v?S.as3D(S.shape[1],S.shape[2],S.shape[3]):S}}),Vh=An({fusedDepthwiseConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,a=e.pad,i=e.dataFormat,s=void 0===i?"NHWC":i,o=e.dilations,l=void 0===o?[1,1]:o,u=e.dimRoundingMode,c=e.bias,h=e.activation,d=void 0===h?"linear":h,p=e.preluActivationWeights;if(!1===Mh(Lt.state.gradientDepth,d)){var f=Yc(t,n,r,a,s,l,u);return null!=c&&(f=rc(f,c)),Lh(f,d,p)}var m=mn(t,"x","depthwiseConv2d"),g=mn(n,"filter","depthwiseConv2d"),y=m,v=!1;3===m.rank&&(v=!0,y=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),C(4===y.rank,(function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+y.rank+"."})),C(4===g.rank,(function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+g.rank+"."})),C(y.shape[3]===g.shape[2],(function(){return"Error in fused depthwiseConv2d: number of input channels ("+y.shape[3]+") must match the inChannels dimension in filter "+g.shape[2]+"."})),null==l&&(l=[1,1]),C(Mo(r,l),(function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+l+"'"})),null!=u&&C(A(a),(function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+u+" but got pad "+a+"."}));var b,x,T=So(y.shape,g.shape,r,l,a,u,!0);null!=c&&(b=Nt(b=mn(c,"bias","fused conv2d"),m)[0],Ro(T.outShape,b.shape)),null!=p&&(x=mn(p,"prelu weights","fused depthwiseConv2d"));var _={x:y,filter:g};null!=c&&(_.bias=b),null!=p&&(_.preluActivationWeights=x);var w=[g,y],S=Lt.runKernelFunc((function(e,t){var n=e.fusedDepthwiseConv2D({input:y,filter:g,convInfo:T,bias:b,activation:d,preluActivationWeights:x});return t([g,y,n]),n}),_,(function(e,t){C(Oo(l),(function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+l+"'"}));var n=t[0],r=t[1],a=t[2],i=Bh(e,a,d),s={};return null!=c&&(s={bias:function(){return Ph(b,i)}}),Object.assign({x:function(){return $c(r.shape,i,n,T)},filter:function(){return Qc(r,i,n.shape,T)}},s)}),"FusedDepthwiseConv2D",{convInfo:T,activation:d},w,[!0]);return v?S.as3D(S.shape[1],S.shape[2],S.shape[3]):S}}),zh=Object.freeze({matMul:Wh,conv2d:Uh,depthwiseConv2d:Vh}),Gh=Object.freeze({image:Oh,linalg:Ih,losses:bh,spectral:Jl,fused:zh,signal:uh,square:tu,squaredDifference:nu,conv1d:Hc,conv2d:qc,conv3d:Kc,depthwiseConv2d:Yc,separableConv2d:Jc,conv2dTranspose:Zc,conv3dTranspose:tl,op:An,batchNormalization2d:Gu,batchNormalization3d:Hu,batchNormalization4d:qu,batchNormalization:Ku,batchNorm:ju,batchNorm2d:Xu,batchNorm3d:Yu,batchNorm4d:$u,booleanMaskAsync:Uc,complex:Dn,real:Tn,imag:Nn,concat:Yn,concat1d:$n,concat2d:Qn,concat3d:Jn,concat4d:Zn,split:tr,matMul:el,dot:nl,outerProduct:rl,reverse:ol,reverse1d:al,reverse2d:il,reverse3d:sl,reverse4d:ul,maxPool:hl,avgPool:fl,pool:dl,maxPool3d:pl,avgPool3d:vl,slice:ml,slice1d:gl,slice2d:yl,slice3d:xl,slice4d:bl,abs:ru,acos:ou,acosh:au,asin:iu,asinh:su,atan:uu,atanh:cu,ceil:lu,clipByValue:hu,cos:fu,cosh:du,erf:pu,exp:vu,expm1:mu,floor:gu,log:yu,log1p:xu,logSigmoid:bu,neg:wu,reciprocal:Cu,round:Eu,rsqrt:Ru,sigmoid:Iu,sign:ku,isNaN:Su,isInf:Au,isFinite:Du,sin:Tu,sinh:Nu,softplus:Fu,sqrt:_u,step:Ou,tan:Mu,tanh:Bu,all:Cl,any:El,argMax:Rl,argMin:Il,logSumExp:kl,max:Sl,mean:Al,min:Dl,moments:Tl,sum:Nl,prod:Fl,equal:Rc,equalStrict:Ic,greater:kc,greaterEqual:Sc,greaterEqualStrict:Ac,greaterStrict:Dc,less:Tc,lessEqual:Nc,lessEqualStrict:Fc,lessStrict:_c,notEqual:Oc,notEqualStrict:Mc,add:rc,addN:oc,addStrict:ac,atan2:ic,div:sc,divNoNan:uc,divStrict:cc,floorDiv:lc,maximum:hc,maximumStrict:fc,minimum:dc,minimumStrict:pc,mod:vc,modStrict:mc,mul:gc,mulStrict:yc,pow:xc,powStrict:bc,squaredDifferenceStrict:wc,sub:Cc,subStrict:Ec,elu:_l,leakyRelu:Ol,prelu:Ml,relu:Bl,relu6:Pl,selu:Ll,logicalAnd:Qu,logicalNot:Ju,logicalOr:Zu,logicalXor:tc,where:ec,whereAsync:nc,buffer:dr,print:pr,batchToSpaceND:vr,broadcastTo:mr,cast:gr,clone:yr,cumsum:xr,depthToSpace:br,expandDims:wr,eye:Cr,multinomial:Er,oneHot:Rr,pad:Ir,pad1d:kr,pad2d:Sr,pad3d:Ar,pad4d:Dr,rand:Tr,randomNormal:Nr,randomGamma:Fr,randomUniform:_r,reshape:Or,spaceToBatchND:Mr,squeeze:Br,stack:Pr,tile:Lr,truncatedNormal:Wr,unstack:Ur,setdiff1dAsync:Vr,fill:Hn,linspace:qn,ones:zn,range:Kn,scalar:On,tensor:Fn$1,tensor1d:Mn,tensor2d:Bn,tensor3d:Pn,tensor4d:Ln,tensor5d:Wn,tensor6d:Un,variable:Vn,zeros:Gn,onesLike:jn,zerosLike:Xn,transpose:Wl,softmax:go,logSoftmax:yo,localResponseNormalization:Ul,norm:Vl,gather:Lc,unsortedSegmentSum:Wc,basicLSTMCell:zl,multiRNNCell:Gl,movingAverage:Hl,stridedSlice:ql,topk:Kl,scatterND:jl,fft:Xl,ifft:Yl,rfft:$l,irfft:Ql,sparseToDense:Zl,gatherND:th,diag:eh,dropout:nh,hannWindow:oh,hammingWindow:ah,frame:ih,stft:sh,inTopKAsync:lh});function Hh(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&C("complex64"!==e.dtype,(function(){return t+" does not support complex64 tensors."}))}))}function qh(e,t,n,r){if("linear"===n)return e.linear(t);if("relu"===n)return e.relu(t);if("elu"===n)return e.elu(t);if("relu6"===n)return e.relu6(t);if("prelu"===n)return e.prelu(t,r);throw new Error("Activation "+n+" has not been implemented for the CPU backend.")}var Kh=function(t){function a(){var e=t.call(this)||this;return e.blockSize=48,e.firstUse=!0,e.data=new xo(e,Lt),e}return e(a,t),a.prototype.write=function(e,t,n){this.firstUse&&(this.firstUse=!1,i().get("IS_NODE")&&dn("\n============================\nHi there 👋. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));var r={};return this.data.set(r,{values:e,dtype:n}),r},a.prototype.move=function(e,t,n,r){this.data.set(e,{values:t,dtype:r})},a.prototype.numDataIds=function(){return this.data.numDataIds()},a.prototype.read=function(e){return n(this,void 0,void 0,(function(){return r(this,(function(t){return[2,this.readSync(e)]}))}))},a.prototype.readSync=function(e){var t=this.data.get(e),n=t.dtype,r=t.complexTensors;return"complex64"===n?Vo(this.readSync(r.real.dataId),this.readSync(r.imag.dataId)):this.data.get(e).values},a.prototype.bufferSync=function(e){var t=this.readSync(e.dataId),n=t;if("string"===e.dtype)try{n=t.map((function(e){return ot(e)}))}catch(r){throw new Error("Failed to decode encoded string bytes into utf-8")}return dr(e.shape,e.dtype,n)},a.prototype.makeOutput=function(e,t,n){var r=this.write(e,t,n);return Lt.makeTensorFromDataId(r,t,n,this)},a.prototype.disposeData=function(e){if(this.data.has(e)){var t=this.data.get(e).complexTensors;null!=t&&(t.real.dispose(),t.imag.dispose()),this.data.delete(e)}},a.prototype.time=function(e){return n(this,void 0,void 0,(function(){var t;return r(this,(function(n){return t=et(),e(),[2,{kernelMs:et()-t}]}))}))},a.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},a.prototype.complex=function(e,t){var n=this.makeOutput(null,e.shape,"complex64");return this.data.get(n.dataId).complexTensors={real:Lt.keep(e.clone()),imag:Lt.keep(t.clone())},n},a.prototype.real=function(e){return this.data.get(e.dataId).complexTensors.real.clone()},a.prototype.imag=function(e){return this.data.get(e.dataId).complexTensors.imag.clone()},a.prototype.slice=function(e,t,n){if(Hh(e,"slice"),io$1(e.shape,t,n)){var r=so(t,e.strides),a=k(n);return Fn$1(this.readSync(e.dataId).subarray(r,r+a),n,e.dtype)}for(var i=dr(n,e.dtype),s=this.bufferSync(e),o=0;o<i.size;++o){var l=i.indexToLoc(o).map((function(e,n){return e+t[n]}));i.values[o]=s.get.apply(s,l)}return i.toTensor()},a.prototype.stridedSlice=function(e,t,n,r){Hh(e,"stridedSlice");var a=ro(t,n,r);if(a.some((function(e){return 0===e})))return Fn$1([],a);for(var i=dr(a,e.dtype),s=this.bufferSync(e),o=0;o<i.size;o++){for(var l=i.indexToLoc(o),u=new Array(l.length),c=0;c<u.length;c++)u[c]=l[c]*r[c]+t[c];i.set.apply(i,[s.get.apply(s,u)].concat(l))}return i.toTensor()},a.prototype.diag=function(e){for(var t=this.readSync(e.dataId),n=dr([e.size,e.size],e.dtype),r=n.values,a=0;a<t.length;a++)r[a*e.size+a]=t[a];return n.toTensor()},a.prototype.unstack=function(e,t){for(var n=e.shape[t],r=new Array(e.rank-1),a=0,i=0;i<e.rank;i++)i!==t&&(r[a++]=e.shape[i]);var s=new Array(e.rank).fill(0),o=e.shape.slice();o[t]=1;var l=new Array(n);for(i=0;i<l.length;i++)s[t]=i,l[i]=this.slice(e,s,o).reshape(r);return l},a.prototype.reverse=function(e,t){Hh(e,"reverse");for(var n=dr(e.shape,e.dtype),r=this.bufferSync(e),a=function(a){var i=n.indexToLoc(a),s=i.slice();t.forEach((function(t){return s[t]=e.shape[t]-1-s[t]})),n.set.apply(n,[r.get.apply(r,s)].concat(i))},i=0;i<n.size;i++)a(i);return n.toTensor()},a.prototype.concat=function(e,t){var n=this;if("complex64"===e[0].dtype){var r=e.map((function(e){return Tn(e)})),a=e.map((function(e){return Nn(e)}));return Dn(this.concat(r,t),this.concat(a,t))}var i=e.map((function(e){var n=k(e.shape.slice(t));return e.as2D(-1,n)})),s=Sn(i.map((function(e){return e.shape})),1),o=dr(s,e[0].dtype).values;if(1===i[0].shape[0]){var l=0;i.forEach((function(e){o.set(n.readSync(e.dataId),l),l+=e.size}))}else{var u=0;i.forEach((function(e){for(var t=n.readSync(e.dataId),r=0,a=0;a<e.shape[0];++a)for(var i=a*s[1]+u,l=0;l<e.shape[1];++l)o[i+l]=t[r++];u+=e.shape[1]}))}var c=Sn(e.map((function(e){return e.shape})),t);return Fn$1(o,c,e[0].dtype)},a.prototype.neg=function(e){return Hh(e,"neg"),this.multiply(On(-1),e)},a.prototype.add=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),(function(e,t,n,r){return{real:e+n,imag:t+r}})):this.broadcastedBinaryOp(e,t,Dt(e.dtype,t.dtype),(function(e,t){return e+t}))},a.prototype.addN=function(e){var t=this;Hh(e,"addN");for(var n=e.map((function(e){return t.readSync(e.dataId)})),r=dr(e[0].shape,e[0].dtype),a=r.values,i=0;i<e.length;i++)for(var s=n[i],o=0;o<a.length;o++)a[o]+=s[o];return r.toTensor()},a.prototype.softmax=function(e,t){var n=O([t],e.shape),r=this.max(e,n),a=wn(r.shape,n),i=this.subtract(e,r.reshape(a)),s=this.exp(i),o=this.sum(s,n).reshape(a);return this.realDivide(s,o)},a.prototype.subtract=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),(function(e,t,n,r){return{real:e-n,imag:t-r}})):this.broadcastedBinaryOp(e,t,Dt(e.dtype,t.dtype),(function(e,t){return e-t}))},a.prototype.pow=function(e,t){return Hh([e,t],"pow"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.pow(e,t)}))},a.prototype.batchMatMul=function(e,t,n,r){Hh([e,t],"matMul");for(var a=n?e.shape[1]:e.shape[2],i=n?e.shape[2]:e.shape[1],s=r?t.shape[1]:t.shape[2],o=e.shape[0],l=this.readSync(e.dataId),u=this.readSync(t.dataId),c=n?[e.strides[0],1,e.strides[1]]:[e.strides[0],e.strides[1],1],h=c[0],d=c[1],p=c[2],f=r?[1,t.strides[1],t.strides[0]]:[t.strides[1],1,t.strides[0]],m=f[0],g=f[1],y=f[2],v=i*s,b=dr([o,i,s],e.dtype),x=b.values,T=this.blockSize,_=0;_<o;_++)for(var w=0;w<i;w+=T)for(var S=0;S<s;S+=T)for(var C=0;C<a;C+=T)for(var E=Math.min(w+T,i),k=Math.min(S+T,s),I=Math.min(C+T,a),A=w;A<E;A++)for(var N=S;N<k;N++){for(var $=0,D=C;D<I;D++)$+=l[_*h+A*d+D*p]*u[D*m+N*g+_*y];x[_*v+(A*s+N)]+=$}return b.toTensor()},a.prototype.fusedBatchMatMul=function(e){var t=e.a,n=e.b,r=e.transposeA,a=e.transposeB,i=e.bias,s=e.activation,o=e.preluActivationWeights,l=this.batchMatMul(t,n,r,a);return i&&(l=this.add(l,i)),s&&(l=qh(this,l,s,o)),l},a.prototype.multiply=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),(function(e,t,n,r){return{real:e*n-t*r,imag:e*r+t*n}})):this.broadcastedBinaryOp(e,t,Dt(e.dtype,t.dtype),(function(e,t){return e*t}))},a.prototype.realDivide=function(e,t){return Hh([e,t],"realDivide"),this.broadcastedBinaryOp(e,t,"float32",(function(e,t){return e/t}))},a.prototype.floorDiv=function(e,t){return Hh([e,t],"floorDiv"),this.broadcastedBinaryOp(e,t,"int32",(function(e,t){return Math.floor(e/t)}))},a.prototype.sum=function(e,t){Hh(e,"sum"),Cn("sum",t,e.rank);for(var n=bn(e.shape,t),r=n[0],a=n[1],i=Gn(r,Dt(e.dtype,"int32")),s=k(a),o=this.readSync(i.dataId),l=this.readSync(e.dataId),u=0;u<o.length;++u){for(var c=u*s,h=0,d=0;d<s;++d)h+=l[c+d];o[u]=h}return i},a.prototype.prod=function(e,t){Hh(e,"sum");for(var n=bn(e.shape,t),r=n[0],a=n[1],i=Gn(r,Dt(e.dtype,"int32")),s=k(a),o=this.readSync(i.dataId),l=this.readSync(e.dataId),u=0;u<o.length;++u){for(var c=u*s,h=1,d=0;d<s;++d)h*=l[c+d];o[u]=h}return i},a.prototype.unsortedSegmentSum=function(e,t,n){Hh(e,"unsortedSegmentSum");for(var r=[],a=e.rank-t.rank,i=0;i<a;++i)t=t.expandDims(i+1);for(i=0;i<n;++i){var s=On(i,"int32"),o=Rc(s,t).asType("float32").mul(e).sum(0);r.push(o)}return Pr(r)},a.prototype.argMin=function(e,t){Hh(e,"argMin");var n=[t];Cn("argMin",n,e.rank);for(var r=bn(e.shape,n),a=r[0],i=r[1],s=Gn(a,"int32"),o=k(i),l=this.readSync(s.dataId),u=this.readSync(e.dataId),c=0;c<l.length;++c){for(var h=c*o,d=u[h],p=0,f=0;f<o;++f){var m=u[h+f];m<d&&(d=m,p=f)}l[c]=p}return s},a.prototype.argMax=function(e,t){Hh(e,"argMax");var n=[t];Cn("argMax",n,e.rank);for(var r=bn(e.shape,n),a=r[0],i=r[1],s=Gn(a,"int32"),o=k(i),l=this.readSync(s.dataId),u=this.readSync(e.dataId),c=0;c<l.length;++c){for(var h=c*o,d=u[h],p=0,f=0;f<o;++f){var m=u[h+f];m>d&&(d=m,p=f)}l[c]=p}return s},a.prototype.cumsum=function(e,t,n,r){if(Hh(e,"cumsum"),t!==e.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(e.rank-1)+" but got axis="+t);for(var a=Dt(e.dtype,"int32"),i=Gn(e.shape,a),s=this.readSync(i.dataId),o=this.readSync(e.dataId),l=e.shape[e.rank-1],u=r?function(e,t){return e+l-t-1}:function(e,t){return e+t},c=0;c<o.length;c+=l)for(var h=0;h<l;h++){var d=u(c,h);if(0===h)s[d]=n?0:o[d];else{var p=u(c,h-1);s[d]=n?o[p]+s[p]:o[d]+s[p]}}return i},a.prototype.equal=function(e,t){return Hh([e,t],"equal"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e===t?1:0}))},a.prototype.notEqual=function(e,t){return Hh([e,t],"notEqual"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e!==t?1:0}))},a.prototype.less=function(e,t){return Hh([e,t],"less"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e<t?1:0}))},a.prototype.lessEqual=function(e,t){return Hh([e,t],"lessEqual"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e<=t?1:0}))},a.prototype.greater=function(e,t){return Hh([e,t],"greater"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e>t?1:0}))},a.prototype.greaterEqual=function(e,t){return Hh([e,t],"greaterEqual"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e>=t?1:0}))},a.prototype.logicalNot=function(e){Hh(e,"logicalNot");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)n[r]=t[r]?0:1;return this.makeOutput(n,e.shape,"bool")},a.prototype.logicalAnd=function(e,t){return Hh([e,t],"logicalAnd"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e&&t}))},a.prototype.logicalOr=function(e,t){return Hh([e,t],"logicalOr"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e||t}))},a.prototype.select=function(e,t,n){Hh([e,t,n],"select");for(var r=this.readSync(e.dataId),a=this.readSync(t.dataId),i=this.readSync(n.dataId),s=Gn(t.shape,Dt(t.dtype,n.dtype)),o=this.readSync(s.dataId),l=0,u=0===e.rank||e.rank>1||1===t.rank?1:k(t.shape.slice(1)),c=0;c<r.length;c++)for(var h=0;h<u;h++)1===r[c]?o[l++]=a[c]:o[l++]=i[c];return s},a.prototype.where=function(e){Hh([e],"where");var t=this.readSync(e.dataId);return na(e.shape,t)},a.prototype.topk=function(e,t,n){return Hh(e,"topk"),ea(this.readSync(e.dataId),e.shape,e.dtype,t)},a.prototype.min=function(e,t){Hh(e,"min"),Cn("min",t,e.rank);for(var n=bn(e.shape,t),r=n[0],a=n[1],i=Gn(r,e.dtype),s=k(a),o=this.readSync(i.dataId),l=this.readSync(e.dataId),u=0;u<o.length;++u){for(var c=u*s,h=l[c],d=0;d<s;++d){var p=l[c+d];p<h&&(h=p)}o[u]=h}return i},a.prototype.minimum=function(e,t){return Hh([e,t],"minimum"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.min(e,t)}))},a.prototype.mod=function(e,t){return Hh([e,t],"mod"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){var n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t}))},a.prototype.max=function(e,t){Hh(e,"max"),Cn("max",t,e.rank);for(var n=bn(e.shape,t),r=n[0],a=n[1],i=Gn(r,e.dtype),s=k(a),o=this.readSync(i.dataId),l=this.readSync(e.dataId),u=0;u<o.length;++u){for(var c=u*s,h=l[c],d=0;d<s;++d){var p=l[c+d];p>h&&(h=p)}o[u]=h}return i},a.prototype.maximum=function(e,t){return Hh([e,t],"maximum"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.max(e,t)}))},a.prototype.all=function(e,t){Hh(e,"all"),Cn("all",t,e.rank);for(var n=bn(e.shape,t),r=n[0],a=n[1],i=Gn(r,e.dtype),s=k(a),o=this.readSync(i.dataId),l=this.readSync(e.dataId),u=0;u<o.length;++u){for(var c=u*s,h=l[c],d=0;d<s;++d){var p=l[c+d];h=h&&p}o[u]=h}return i},a.prototype.any=function(e,t){Hh(e,"any"),Cn("any",t,e.rank);for(var n=bn(e.shape,t),r=n[0],a=n[1],i=Gn(r,e.dtype),s=k(a),o=this.readSync(i.dataId),l=this.readSync(e.dataId),u=0;u<o.length;++u){for(var c=u*s,h=l[c],d=0;d<s;++d){var p=l[c+d];h=h||p}o[u]=h}return i},a.prototype.squaredDifference=function(e,t){return Hh([e,t],"squaredDifference"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){var n=e-t;return n*n}))},a.prototype.ceil=function(e){Hh(e,"ceil");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.ceil(t[r]);return this.makeOutput(n,e.shape,"float32")},a.prototype.floor=function(e){Hh(e,"floor");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.floor(t[r]);return this.makeOutput(n,e.shape,"float32")},a.prototype.sign=function(e){Hh(e,"x");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)t[r]<0?n[r]=-1:t[r]>0?n[r]=1:n[r]=0;return this.makeOutput(n,e.shape,"float32")},a.prototype.isNaN=function(e){Hh(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Number.isNaN(t[r])&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},a.prototype.isInf=function(e){Hh(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Math.abs(t[r])===1/0&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},a.prototype.isFinite=function(e){Hh(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Number.isFinite(t[r])&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},a.prototype.round=function(e){Hh(e,"round");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var a=Math.floor(t[r]);t[r]-a<.5?n[r]=Math.floor(t[r]):t[r]-a>.5?n[r]=Math.ceil(t[r]):n[r]=a%2==0?a:a+1}return this.makeOutput(n,e.shape,"float32")},a.prototype.exp=function(e){Hh(e,"exp");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.exp(t[r]);return this.makeOutput(n,e.shape,"float32")},a.prototype.expm1=function(e){Hh(e,"expm1");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.expm1(t[r]);return this.makeOutput(n,e.shape,"float32")},a.prototype.log=function(e){Hh(e,"log");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var a=t[r];n[r]=Math.log(a)}return this.makeOutput(n,e.shape,"float32")},a.prototype.log1p=function(e){Hh(e,"log1p");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var a=t[r];n[r]=Math.log1p(a)}return this.makeOutput(n,e.shape,"float32")},a.prototype.sqrt=function(e){Hh(e,"sqrt");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var a=t[r];n[r]=Math.sqrt(a)}return this.makeOutput(n,e.shape,"float32")},a.prototype.rsqrt=function(e){Hh(e,"rsqrt");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var a=t[r];n[r]=1/Math.sqrt(a)}return this.makeOutput(n,e.shape,"float32")},a.prototype.reciprocal=function(e){Hh(e,"reciprocal");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=1/t[r];return this.makeOutput(n,e.shape,"float32")},a.prototype.linear=function(e){return e},a.prototype.relu=function(e){Hh(e,"relu");for(var t=Gn(e.shape,e.dtype),n=this.readSync(t.dataId),r=this.readSync(e.dataId),a=0;a<r.length;++a)n[a]=Math.max(0,r[a]);return t},a.prototype.relu6=function(e){Hh(e,"relu");for(var t=Gn(e.shape,e.dtype),n=this.readSync(t.dataId),r=this.readSync(e.dataId),a=0;a<r.length;++a)n[a]=Math.min(Math.max(0,r[a]),6);return t},a.prototype.prelu=function(e,t){return Hh([e,t],"prelu"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return e<0?t*e:e}))},a.prototype.elu=function(e){Hh(e,"elu");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r){var a=n[r];t[r]=a>=0?a:Math.exp(a)-1}return this.makeOutput(t,e.shape,"float32")},a.prototype.eluDer=function(e,t){Hh([e,t],"eluDer");for(var n=new Float32Array(t.size),r=this.readSync(t.dataId),a=this.readSync(e.dataId),i=0;i<r.length;++i){var s=r[i];n[i]=s>=1?a[i]:a[i]*(s+1)}return this.makeOutput(n,t.shape,"float32")},a.prototype.selu=function(e){Hh(e,"selu");for(var t=bs,n=ws,r=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i){var s=a[i];r[i]=s>=0?n*s:t*(Math.exp(s)-1)}return this.makeOutput(r,e.shape,"float32")},a.prototype.clip=function(e,t,n){Hh(e,"clip");for(var r=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i){var s=a[i];r[i]=s>n?n:s<t?t:s}return this.makeOutput(r,e.shape,"float32")},a.prototype.abs=function(e){for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.abs(n[r]);return this.makeOutput(t,e.shape,"float32")},a.prototype.complexAbs=function(e){for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<e.size;++r){var a=n[2*r],i=n[2*r+1];t[r]=Math.hypot(a,i)}return this.makeOutput(t,e.shape,"float32")},a.prototype.int=function(e){Hh(e,"int");for(var t=new Int32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=n[r];return this.makeOutput(t,e.shape,"int32")},a.prototype.sigmoid=function(e){Hh(e,"sigmoid");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=1/(1+Math.exp(-n[r]));return this.makeOutput(t,e.shape,"float32")},a.prototype.softplus=function(e){Hh(e,"softplus");for(var t=Math.log(1.1920928955078125e-7)+2,n=new Float32Array(e.size),r=this.readSync(e.dataId),a=0;a<r.length;++a){var i,s=r[a]>-t,o=r[a]<t,l=Math.exp(r[a]);i=o?l:s?r[a]:Math.log(1+l),n[a]=i}return this.makeOutput(n,e.shape,"float32")},a.prototype.sin=function(e){Hh(e,"sin");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.sin(n[r]);return this.makeOutput(t,e.shape,"float32")},a.prototype.cos=function(e){Hh(e,"cos");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.cos(n[r]);return this.makeOutput(t,e.shape,"float32")},a.prototype.tan=function(e){Hh(e,"tan");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.tan(n[r]);return this.makeOutput(t,e.shape,"float32")},a.prototype.asin=function(e){Hh(e,"asin");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.asin(n[r]);return this.makeOutput(t,e.shape,"float32")},a.prototype.acos=function(e){Hh(e,"acos");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.acos(n[r]);return this.makeOutput(t,e.shape,"float32")},a.prototype.atan=function(e){Hh(e,"atan");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.atan(n[r]);return this.makeOutput(t,e.shape,"float32")},a.prototype.atan2=function(e,t){return Hh([e,t],"atan2"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.atan2(e,t)}))},a.prototype.sinh=function(e){Hh(e,"sinh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.sinh(n[r]);return this.makeOutput(t,e.shape,"float32")},a.prototype.cosh=function(e){Hh(e,"cosh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.cosh(n[r]);return this.makeOutput(t,e.shape,"float32")},a.prototype.tanh=function(e){Hh(e,"tanh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=D(n[r]);return this.makeOutput(t,e.shape,"float32")},a.prototype.asinh=function(e){Hh(e,"asinh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.asinh(n[r]);return this.makeOutput(t,e.shape,"float32")},a.prototype.acosh=function(e){Hh(e,"acosh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.acosh(n[r]);return this.makeOutput(t,e.shape,"float32")},a.prototype.atanh=function(e){Hh(e,"atanh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.atanh(n[r]);return this.makeOutput(t,e.shape,"float32")},a.prototype.erf=function(e){Hh(e,"erf");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r){var a=Math.sign(n[r]),i=Math.abs(n[r]),s=1/(1+.3275911*i);t[r]=a*(1-((((1.061405429*s-1.453152027)*s+1.421413741)*s-.284496736)*s+.254829592)*s*Math.exp(-i*i))}return this.makeOutput(t,e.shape,"float32")},a.prototype.step=function(e,t){void 0===t&&(t=0),Hh(e,"step");for(var n=new Float32Array(e.size),r=this.readSync(e.dataId),a=0;a<r.length;++a){var i=r[a];isNaN(i)?n[a]=NaN:n[a]=i>0?1:t}return this.makeOutput(n,e.shape,"float32")},a.prototype.fusedConv2d=function(e){var t=e.input,n=e.filter,r=e.convInfo,a=e.bias,i=e.activation,s=e.preluActivationWeights,o=this.conv2d(t,n,r);return a&&(o=this.add(o,a)),i&&(o=qh(this,o,i,s)),o},a.prototype.conv2d=function(e,t,n){Hh([e,t],"conv2d");for(var r=n.filterHeight,a=n.filterWidth,i=n.dilationHeight,s=n.dilationWidth,o=n.padInfo.left,l=n.padInfo.top,u="channelsLast"===n.dataFormat,c=dr(n.outShape,e.dtype),h=e.strides[0],d=u?e.strides[1]:e.strides[2],p=u?e.strides[2]:1,f=u?1:e.strides[1],m=c.strides[0],g=u?c.strides[1]:c.strides[2],y=u?c.strides[2]:1,v=u?1:c.strides[1],b=this.readSync(e.dataId),x=this.readSync(t.dataId),T=c.values,_=0;_<n.batchSize;++_)for(var w=_*h,S=_*m,C=0;C<n.outHeight;++C)for(var E=S+C*g,k=C*n.strideHeight-l,I=0;I<r;I++){var A=k+I*i;if(!(A<0||A>=n.inHeight))for(var N=I*t.strides[0],$=w+A*d,D=0;D<n.outWidth;++D)for(var P=E+D*y,R=D*n.strideWidth-o,M=0;M<a;M++){var O=R+M*s;if(!(O<0||O>=n.inWidth))for(var F=$+O*p,L=N+M*t.strides[1],B=0;B<n.inChannels;++B){for(var V=b[F+B*f],U=0;U<n.outChannels;++U)T[P+U*v]+=V*x[L+U];L+=n.outChannels}}}return c.toTensor()},a.prototype.conv3d=function(e,t,n){for(var r=n.filterDepth,a=n.filterHeight,i=n.filterWidth,s=n.dilationDepth,o=n.dilationHeight,l=n.dilationWidth,u=n.padInfo.front,c=n.padInfo.left,h=n.padInfo.top,d=dr(n.outShape,e.dtype),p=this.readSync(e.dataId),f=this.readSync(t.dataId),m=d.values,g=0;g<n.batchSize;++g)for(var y=g*e.strides[0],v=g*d.strides[0],b=0;b<n.outDepth;++b)for(var x=v+b*d.strides[1],T=b*n.strideDepth-u,_=0;_<r;_++){var w=T+_*s;if(!(w<0||w>=n.inDepth))for(var S=_*t.strides[0],C=y+w*e.strides[1],E=0;E<n.outHeight;++E)for(var k=x+E*d.strides[2],I=E*n.strideHeight-h,A=0;A<a;A++){var N=I+A*o;if(!(N<0||N>=n.inHeight))for(var $=S+A*t.strides[1],D=C+N*e.strides[2],P=0;P<n.outWidth;++P)for(var R=k+P*n.outChannels,M=P*n.strideWidth-c,O=0;O<i;O++){var F=M+O*l;if(!(F<0||F>=n.inWidth))for(var L=$+O*t.strides[2],B=D+F*n.inChannels,V=L,U=0;U<n.inChannels;++U){for(var z=p[B+U],G=0;G<n.outChannels;++G)m[R+G]+=z*f[V+G];V+=n.outChannels}}}}return d.toTensor()},a.prototype.conv2dDerInput=function(e,t,n){Hh([e,t],"conv2dDerInput");for(var r=dr(n.inShape,"float32"),a=r.values,i=this.readSync(e.dataId),s=this.readSync(t.dataId),o=t.strides,l=o[0],u=o[1],c=o[2],h=n.batchSize,d=n.filterHeight,p=n.filterWidth,f=n.inChannels,m=n.inHeight,g=n.inWidth,y=n.outChannels,v=n.outHeight,b=n.outWidth,x=n.strideHeight,T=n.strideWidth,_=n.dataFormat,w=d-1-n.padInfo.top,S=p-1-n.padInfo.left,C="channelsLast"===_,E=r.strides[0],k=C?r.strides[1]:r.strides[2],I=C?r.strides[2]:1,A=C?1:r.strides[1],N=e.strides[0],$=C?e.strides[1]:e.strides[2],D=C?e.strides[2]:1,P=C?1:e.strides[1],R=0;R<h;++R)for(var M=0;M<f;++M)for(var O=0;O<m;++O)for(var F=O-w,L=Math.max(0,Math.ceil(F/x)),B=Math.min(v,(d+F)/x),V=0;V<g;++V){for(var U=V-S,z=Math.max(0,Math.ceil(U/T)),G=Math.min(b,(p+U)/T),W=0,H=L;H<B;++H)for(var j=H*x-F,q=z;q<G;++q)for(var K=N*R+$*H+D*q,X=l*(d-1-j)+u*(p-1-(q*T-U))+c*M,Y=0;Y<y;++Y)W+=i[K+P*Y]*s[X+Y];a[E*R+k*O+I*V+A*M]=W}return r.toTensor()},a.prototype.conv3dDerInput=function(e,t,n){for(var r=dr(n.inShape,"float32"),a=r.values,i=r.strides,s=i[0],o=i[1],l=i[2],u=i[3],c=this.readSync(e.dataId),h=e.strides,d=h[0],p=h[1],f=h[2],m=h[3],g=this.readSync(t.dataId),y=t.strides,v=y[0],b=y[1],x=y[2],T=y[3],_=n.batchSize,w=n.filterDepth,S=n.filterHeight,C=n.filterWidth,E=n.inChannels,k=n.inDepth,I=n.inHeight,A=n.inWidth,N=n.outChannels,$=n.outDepth,D=n.outHeight,P=n.outWidth,R=n.strideDepth,M=n.strideHeight,O=n.strideWidth,F=w-1-n.padInfo.front,L=S-1-n.padInfo.top,B=C-1-n.padInfo.left,V=0;V<_;++V)for(var U=0;U<E;++U)for(var z=0;z<k;++z)for(var G=z-F,W=Math.max(0,Math.ceil(G/R)),H=Math.min($,(w+G)/R),j=0;j<I;++j)for(var q=j-L,K=Math.max(0,Math.ceil(q/M)),X=Math.min(D,(S+q)/M),Y=0;Y<A;++Y){for(var Z=Y-B,J=Math.max(0,Math.ceil(Z/O)),Q=Math.min(P,(C+Z)/O),ee=0,te=W;te<H;++te)for(var ne=te*R-G,re=K;re<X;++re)for(var ae=re*M-q,ie=J;ie<Q;++ie)for(var se=d*V+p*te+f*re+m*ie,oe=v*(w-1-ne)+b*(S-1-ae)+x*(C-1-(ie*O-Z))+T*U,le=0;le<N;++le)ee+=c[se+le]*g[oe+le];a[s*V+o*z+l*j+u*Y+U]=ee}return r.toTensor()},a.prototype.conv2dDerFilter=function(e,t,n){Hh([e,t],"conv2dDerFilter");for(var r=n.strideHeight,a=n.strideWidth,i=n.filterHeight,s=n.filterWidth,o="channelsLast"===n.dataFormat,l=dr(n.filterShape,"float32"),u=n.padInfo.left,c=n.padInfo.top,h=this.bufferSync(e),d=this.bufferSync(t),p=0;p<i;++p)for(var f=Math.max(0,Math.ceil((c-p)/r)),m=Math.min(n.outHeight,(n.inHeight+c-p)/r),g=0;g<s;++g)for(var y=Math.max(0,Math.ceil((u-g)/a)),v=Math.min(n.outWidth,(n.inWidth+u-g)/a),b=0;b<n.inChannels;++b)for(var x=0;x<n.outChannels;++x){for(var T=0,_=0;_<n.batchSize;++_)for(var w=f;w<m;++w)for(var S=p+w*r-c,C=y;C<v;++C){var E=g+C*a-u;T+=o?h.get(_,S,E,b)*d.get(_,w,C,x):h.get(_,b,S,E)*d.get(_,x,w,C)}l.set(T,p,g,b,x)}return l.toTensor()},a.prototype.conv3dDerFilter=function(e,t,n){for(var r=n.strideDepth,a=n.strideHeight,i=n.strideWidth,s=n.filterDepth,o=n.filterHeight,l=n.filterWidth,u=dr(n.filterShape,"float32"),c=u.values,h=u.strides,d=h[0],p=h[1],f=h[2],m=h[3],g=this.readSync(t.dataId),y=t.strides,v=y[0],b=y[1],x=y[2],T=y[3],_=this.readSync(e.dataId),w=e.strides,S=w[0],C=w[1],E=w[2],k=w[3],I=n.padInfo.front,A=n.padInfo.left,N=n.padInfo.top,$=0;$<s;++$)for(var D=Math.max(0,Math.ceil((I-$)/r)),P=Math.min(n.outDepth,(n.inDepth+I-$)/r),R=$*d,M=0;M<o;++M)for(var O=Math.max(0,Math.ceil((N-M)/a)),F=Math.min(n.outHeight,(n.inHeight+N-M)/a),L=M*p+R,B=0;B<l;++B)for(var V=Math.max(0,Math.ceil((A-B)/i)),U=Math.min(n.outWidth,(n.inWidth+A-B)/i),z=B*f+L,G=0;G<n.inChannels;++G)for(var W=G*m+z,H=0;H<n.outChannels;++H){for(var j=0,q=0;q<n.batchSize;++q)for(var K=q*S,X=q*v,Y=D;Y<P;++Y)for(var Z=($+Y*r-I)*C+K,J=Y*b+X,Q=O;Q<F;++Q)for(var ee=(M+Q*a-N)*E+Z,te=Q*x+J,ne=V;ne<U;++ne){var re=ne*T+te;j+=_[(B+ne*i-A)*k+ee+G]*g[re+H]}c[W+H]=j}return u.toTensor()},a.prototype.fusedDepthwiseConv2D=function(e){var t=e.input,n=e.filter,r=e.convInfo,a=e.bias,i=e.activation,s=e.preluActivationWeights,o=this.depthwiseConv2D(t,n,r);return a&&(o=this.add(o,a)),i&&(o=qh(this,o,i,s)),o},a.prototype.depthwiseConv2D=function(e,t,n){Hh([e,t],"depthwiseConv2D");for(var r=n.filterHeight,a=n.filterWidth,i=n.dilationHeight,s=n.dilationWidth,o=n.padInfo.left,l=n.padInfo.top,u=n.outChannels/n.inChannels,c=dr(n.outShape,e.dtype),h=this.readSync(e.dataId),d=this.readSync(t.dataId),p=c.values,f=0;f<n.batchSize;++f)for(var m=f*e.strides[0],g=f*c.strides[0],y=0;y<n.outHeight;++y)for(var v=g+y*c.strides[1],b=y*n.strideHeight-o,x=0;x<r;++x){var T=b+x*i;if(!(T<0||T>=n.inHeight))for(var _=x*t.strides[0],w=m+T*e.strides[1],S=0;S<n.outWidth;++S)for(var C=v+S*c.strides[2],E=S*n.strideWidth-l,k=0;k<a;++k){var I=E+k*s;if(!(I<0||I>=n.inWidth))for(var A=_+k*t.strides[1],N=w+I*n.inChannels,$=C,D=A,P=0;P<n.inChannels;++P){for(var R=h[N+P],M=0;M<u;++M)p[$+M]+=R*d[D+M];$+=u,D+=u}}}return c.toTensor()},a.prototype.depthwiseConv2DDerInput=function(e,t,n){Hh([e,t],"depthwiseConv2DDerInput");for(var r=dr(n.inShape,"float32"),a=r.values,i=r.strides,s=i[0],o=i[1],l=i[2],u=this.readSync(e.dataId),c=e.strides,h=c[0],d=c[1],p=c[2],f=this.readSync(t.dataId),m=t.strides,g=m[0],y=m[1],v=m[2],b=n.batchSize,x=n.filterHeight,T=n.filterWidth,_=n.inChannels,w=n.inHeight,S=n.inWidth,C=n.outChannels,E=n.outHeight,k=n.outWidth,I=n.strideHeight,A=n.strideWidth,N=x-1-n.padInfo.top,$=T-1-n.padInfo.left,D=C/_,P=0;P<b;++P)for(var R=0;R<_;++R)for(var M=0;M<w;++M)for(var O=M-N,F=Math.max(0,Math.ceil(O/I)),L=Math.min(E,(x+O)/I),B=0;B<S;++B){for(var V=B-$,U=Math.max(0,Math.ceil(V/A)),z=Math.min(k,(T+V)/A),G=0,W=F;W<L;++W)for(var H=W*I-O,j=U;j<z;++j)for(var q=h*P+d*W+p*j,K=g*(x-1-H)+y*(T-1-(j*A-V))+v*R,X=0;X<D;++X)G+=u[q+(R*D+X)]*f[K+X];a[s*P+o*M+l*B+R]=G}return r.toTensor()},a.prototype.depthwiseConv2DDerFilter=function(e,t,n){Hh([e,t],"depthwiseConv2DDerFilter");for(var r=n.strideHeight,a=n.strideWidth,i=n.filterHeight,s=n.filterWidth,o=dr(n.filterShape,"float32"),l=n.padInfo.left,u=n.padInfo.top,c=n.outChannels/n.inChannels,h=this.bufferSync(e),d=this.bufferSync(t),p=0;p<i;++p)for(var f=Math.max(0,Math.ceil((u-p)/r)),m=Math.min(n.outHeight,(n.inHeight+u-p)/r),g=0;g<s;++g)for(var y=Math.max(0,Math.ceil((l-g)/a)),v=Math.min(n.outWidth,(n.inWidth+l-g)/a),b=0;b<n.outChannels;++b){for(var x=Math.trunc(b/c),T=b%c,_=0,w=0;w<n.batchSize;++w)for(var S=f;S<m;++S)for(var C=p+S*r-u,E=y;E<v;++E){var k=g+E*a-l;_+=h.get(w,C,k,x)*d.get(w,S,E,b)}o.set(_,p,g,x,T)}return o.toTensor()},a.prototype.tile=function(e,t){return Hh(e,"tile"),ta(this.bufferSync(e),t)},a.prototype.pad=function(e,t,n){Hh(e,"pad");var r=t.map((function(t,n){return t[0]+e.shape[n]+t[1]})),a=t.map((function(e){return e[0]})),i=this.bufferSync(e),s=dr(r,e.dtype);0!==n&&s.values.fill(n);for(var o=0;o<e.size;o++){var l=i.indexToLoc(o),u=l.map((function(e,t){return e+a[t]}));s.set.apply(s,[i.get.apply(i,l)].concat(u))}return s.toTensor()},a.prototype.transpose=function(e,t){Hh(e,"transpose");for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[t[r]];var a=this.readSync(e.dataId),i=dr(n,e.dtype),s=this.bufferSync(e);for(r=0;r<e.size;++r){for(var o=s.indexToLoc(r),l=new Array(o.length),u=0;u<l.length;u++)l[u]=o[t[u]];var c=i.locToIndex(l);i.values[c]=a[r]}return i.toTensor()},a.prototype.gather=function(e,t,n){Hh([e,t],"gather");var r=e.shape.slice(),a=this.readSync(t.dataId);r[n]=a.length;for(var i=dr(r,e.dtype),s=this.bufferSync(e),o=0;o<i.size;++o){var l=i.indexToLoc(o),u=l.slice();u[n]=a[l[n]];var c=s.locToIndex(u);i.values[o]=s.values[c]}return i.toTensor()},a.prototype.batchToSpaceND=function(e,t,n){Hh([e],"batchToSpaceND");var r=t.reduce((function(e,t){return e*t})),a=zr(e.shape,t,r),i=Gr(a.length,t.length),s=Hr(e.shape,t,r),o=qr$1(n,t.length),l=Kr(s,n,t.length);return e.reshape(a).transpose(i).reshape(s).slice(o,l)},a.prototype.spaceToBatchND=function(e,t,n){Hh([e],"spaceToBatchND");var r=t.reduce((function(e,t){return e*t})),a=[[0,0]];a.push.apply(a,n);for(var i=1+t.length;i<e.shape.length;++i)a.push([0,0]);var s=e.pad(a),o=zr(s.shape,t,r,!1),l=Gr(o.length,t.length,!1),u=Hr(s.shape,t,r,!1);return s.reshape(o).transpose(l).reshape(u)},a.prototype.pool=function(e,t,n){Hh(e,"pool");for(var r=t.strideHeight,a=t.strideWidth,i=t.dilationHeight,s=t.dilationWidth,o=t.effectiveFilterHeight,l=t.effectiveFilterWidth,u=t.padInfo.top,c=t.padInfo.left,h="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,d=this.readSync(e.dataId),p=dr(t.outShape,e.dtype),f=p.values,m=t.outShape[1]*t.outShape[2]*t.outShape[3],g=t.outShape[2]*t.outShape[3],y=t.outShape[3],v=0;v<t.batchSize;++v)for(var b=v*m,x=v*e.strides[0],T=0;T<t.inChannels;++T)for(var _=0;_<t.outHeight;++_)for(var w=_*r-u,S=Math.max(0,w),C=Math.min(t.inHeight,o+w),E=b+_*g,k=0;k<t.outWidth;++k){for(var I=k*a-c,A=Math.max(0,I),N=Math.min(t.inWidth,l+I),$=h,D=0,P=0,R=S;R<C;R+=i){for(var M=x+R*e.strides[1],O=A;O<N;O+=s){var F=d[M+O*e.strides[2]+T];"max"===n&&F>$?$=F:"avg"===n&&(D+=F,P++)}if(isNaN($))break}f[E+k*y+T]="avg"===n?D/P:$}return p.toTensor()},a.prototype.maxPool=function(e,t){return this.pool(e,t,"max")},a.prototype.maxPoolPositions=function(e,t){for(var n=dr(t.outShape,"int32"),r=t.strideHeight,a=t.strideWidth,i=t.dilationHeight,s=t.dilationWidth,o=t.effectiveFilterHeight,l=t.effectiveFilterWidth,u=t.padInfo.top,c=t.padInfo.left,h=this.bufferSync(e),d=0;d<t.batchSize;++d)for(var p=0;p<t.inChannels;++p)for(var f=0;f<t.outHeight;++f){for(var m=f*r-u,g=m;g<0;)g+=i;for(var y=Math.min(t.inHeight,o+m),v=0;v<t.outWidth;++v){for(var b=v*a-c,x=b;x<0;)x+=s;for(var T=Math.min(t.inWidth,l+b),_=Number.NEGATIVE_INFINITY,w=-1,S=g;S<y;S+=i)for(var C=S-m,E=x;E<T;E+=s){var k=E-b,I=h.get(d,S,E,p);I>_&&(_=I,w=C*l+k)}n.set(w,d,f,v,p)}}return n.toTensor()},a.prototype.maxPoolBackprop=function(e,t,n,r){Hh([t,n],"maxPoolBackprop");for(var a=this.maxPoolPositions(t,r),i=r.strideHeight,s=r.strideWidth,o=r.dilationHeight,l=r.dilationWidth,u=r.effectiveFilterHeight,c=r.effectiveFilterWidth,h=c-1-r.padInfo.left,d=u-1-r.padInfo.top,p=dr(t.shape,"float32"),f=this.bufferSync(a),m=this.bufferSync(e),g=0;g<r.batchSize;++g)for(var y=0;y<r.inChannels;++y)for(var v=0;v<r.inHeight;++v)for(var b=0;b<r.inWidth;++b){for(var x=v-d,T=b-h,_=0,w=0;w<u;w+=o){var S=(x+w)/i;if(!(S<0||S>=r.outHeight||Math.floor(S)!==S))for(var C=0;C<c;C+=l){var E=(T+C)/s;if(!(E<0||E>=r.outWidth||Math.floor(E)!==E)){var k=u*c-1-f.get(g,S,E,y)===w*c+C?1:0;0!==k&&(_+=m.get(g,S,E,y)*k)}}}p.set(_,g,v,b,y)}return p.toTensor()},a.prototype.avgPoolBackprop=function(e,t,n){Hh([e,t],"avgPoolBackprop");for(var r=n.strideHeight,a=n.strideWidth,i=n.filterHeight,s=n.filterWidth,o=n.dilationHeight,l=n.dilationWidth,u=n.effectiveFilterHeight,c=n.effectiveFilterWidth,h=c-1-n.padInfo.left,d=u-1-n.padInfo.top,p=dr(t.shape,"float32"),f=1/(i*s),m=this.bufferSync(e),g=0;g<n.batchSize;++g)for(var y=0;y<n.inChannels;++y)for(var v=0;v<n.inHeight;++v)for(var b=0;b<n.inWidth;++b){for(var x=v-d,T=b-h,_=0,w=0;w<u;w+=o){var S=(x+w)/r;if(!(S<0||S>=n.outHeight||Math.floor(S)!==S))for(var C=0;C<c;C+=l){var E=(T+C)/a;E<0||E>=n.outWidth||Math.floor(E)!==E||(_+=m.get(g,S,E,y))}}p.set(_*f,g,v,b,y)}return p.toTensor()},a.prototype.pool3d=function(e,t,n){Hh(e,"pool3d");for(var r=t.strideDepth,a=t.strideHeight,i=t.strideWidth,s=t.dilationDepth,o=t.dilationHeight,l=t.dilationWidth,u=t.effectiveFilterDepth,c=t.effectiveFilterHeight,h=t.effectiveFilterWidth,d=t.padInfo.front,p=t.padInfo.top,f=t.padInfo.left,m="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,g=this.readSync(e.dataId),y=dr(t.outShape,e.dtype),v=y.values,b=t.outShape[1]*t.outShape[2]*t.outShape[3]*t.outShape[4],x=t.outShape[2]*t.outShape[3]*t.outShape[4],T=t.outShape[3]*t.outShape[4],_=t.outShape[4],w=0;w<t.batchSize;++w)for(var S=w*b,C=w*e.strides[0],E=0;E<t.inChannels;++E)for(var k=0;k<t.outDepth;++k){for(var I=k*r-d,A=I;A<0;)A+=s;for(var N=Math.min(t.inDepth,u+I),$=S+k*x,D=0;D<t.outHeight;++D){for(var P=D*a-p,R=P;R<0;)R+=o;for(var M=Math.min(t.inHeight,c+P),O=$+D*T,F=0;F<t.outWidth;++F){for(var L=F*i-f,B=L;B<0;)B+=l;for(var V=Math.min(t.inWidth,h+L),U=O+F*_,z=m,G=0,W=0,H=A;H<N;H+=s){for(var j=C+H*e.strides[1],q=R;q<M;q+=o){for(var K=j+q*e.strides[2],X=B;X<V;X+=l){var Y=g[K+X*e.strides[3]+E];if("max"===n&&Y>z?z=Y:"avg"===n&&(G+=Y,W++),isNaN(z))break}if(isNaN(z))break}if(isNaN(z))break}v[U+E]="avg"===n?G/W:z}}}return y.toTensor()},a.prototype.avgPool3d=function(e,t){return Hh(e,"avgPool3d"),this.pool3d(e,t,"avg").toFloat()},a.prototype.avgPool3dBackprop=function(e,t,n){Hh([e,t],"avgPool3dBackprop");for(var r=n.strideDepth,a=n.strideHeight,i=n.strideWidth,s=n.filterDepth,o=n.filterHeight,l=n.filterWidth,u=n.dilationDepth,c=n.dilationHeight,h=n.dilationWidth,d=n.effectiveFilterDepth,p=n.effectiveFilterHeight,f=n.effectiveFilterWidth,m=d-1-n.padInfo.front,g=f-1-n.padInfo.left,y=p-1-n.padInfo.top,v=dr(t.shape,"float32"),b=1/(s*o*l),x=this.bufferSync(e),T=0;T<n.batchSize;++T)for(var _=0;_<n.inChannels;++_)for(var w=0;w<n.inDepth;++w)for(var S=0;S<n.inHeight;++S)for(var C=0;C<n.inWidth;++C){for(var E=w-m,k=S-y,I=C-g,A=0,N=0;N<d;N+=u){var $=(E+N)/r;if(!($<0||$>=n.outDepth||Math.floor($)!==$))for(var D=0;D<p;D+=c){var P=(k+D)/a;if(!(P<0||P>=n.outHeight||Math.floor(P)!==P))for(var R=0;R<f;R+=h){var M=(I+R)/i;M<0||M>=n.outWidth||Math.floor(M)!==M||(A+=x.get(T,$,P,M,_))}}}v.set(A*b,T,w,S,C,_)}return v.toTensor()},a.prototype.maxPool3d=function(e,t){return Hh(e,"maxPool3d"),this.pool3d(e,t,"max").toFloat()},a.prototype.maxPool3dPositions=function(e,t){for(var n=dr(t.outShape,"int32"),r=t.strideDepth,a=t.strideHeight,i=t.strideWidth,s=t.dilationDepth,o=t.dilationHeight,l=t.dilationWidth,u=t.effectiveFilterDepth,c=t.effectiveFilterHeight,h=t.effectiveFilterWidth,d=t.padInfo.front,p=t.padInfo.top,f=t.padInfo.left,m=this.bufferSync(e),g=0;g<t.batchSize;++g)for(var y=0;y<t.inChannels;++y)for(var v=0;v<t.outDepth;++v){for(var b=v*r-d,x=b;x<0;)x+=s;for(var T=Math.min(t.inDepth,u+b),_=0;_<t.outHeight;++_){for(var w=_*a-p,S=w;S<0;)S+=o;for(var C=Math.min(t.inHeight,c+w),E=0;E<t.outWidth;++E){for(var k=E*i-f,I=k;I<0;)I+=l;for(var A=Math.min(t.inWidth,h+k),N=Number.NEGATIVE_INFINITY,$=-1,D=x;D<T;D+=s)for(var P=D-b,R=S;R<C;R+=o)for(var M=R-w,O=I;O<A;O+=l){var F=O-k,L=m.get(g,D,R,O,y);L>=N&&(N=L,$=P*c*h+M*c+F)}n.set($,g,v,_,E,y)}}}return n.toTensor()},a.prototype.maxPool3dBackprop=function(e,t,n,r){Hh([t,n],"maxPool3dBackprop");for(var a=this.maxPool3dPositions(t,r),i=r.strideDepth,s=r.strideHeight,o=r.strideWidth,l=r.dilationDepth,u=r.dilationHeight,c=r.dilationWidth,h=r.effectiveFilterDepth,d=r.effectiveFilterHeight,p=r.effectiveFilterWidth,f=h-1-r.padInfo.front,m=p-1-r.padInfo.left,g=d-1-r.padInfo.top,y=dr(t.shape,"float32"),v=this.bufferSync(a),b=this.bufferSync(e),x=0;x<r.batchSize;++x)for(var T=0;T<r.inChannels;++T)for(var _=0;_<r.inDepth;++_)for(var w=0;w<r.inHeight;++w)for(var S=0;S<r.inWidth;++S){for(var C=_-f,E=w-g,k=S-m,I=0,A=0;A<h;A+=l){var N=(C+A)/i;if(!(N<0||N>=r.outDepth||Math.floor(N)!==N))for(var $=0;$<d;$+=u){var D=(E+$)/s;if(!(D<0||D>=r.outHeight||Math.floor(D)!==D))for(var P=0;P<p;P+=c){var R=(k+P)/o;if(!(R<0||R>=r.outWidth||Math.floor(R)!==R)){var M=h*d*p-1-v.get(x,N,D,R,T)===A*d*p+$*p+P?1:0;0!==M&&(I+=b.get(x,N,D,R,T)*M)}}}}y.set(I,x,_,w,S,T)}return y.toTensor()},a.prototype.cast=function(e,t){return Po(e,t,this)},a.prototype.reshape=function(e,t){return Lo(e,t)},a.prototype.avgPool=function(e,t){return Hh(e,"avgPool"),this.pool(e,t,"avg").toFloat()},a.prototype.resizeBilinear=function(e,t,n,r){Hh(e,"resizeBilinear");for(var a=e.shape,i=a[0],s=a[1],o=a[2],l=a[3],u=this.readSync(e.dataId),c=new Float32Array(k([i,t,n,l])),h=[r&&t>1?s-1:s,r&&n>1?o-1:o],d=[r&&t>1?t-1:t,r&&n>1?n-1:n],p=0,f=h[0]/d[0],m=h[1]/d[1],g=0;g<i;g++)for(var y=0;y<t;y++)for(var v=f*y,b=Math.floor(v),x=v-b,T=Math.min(s-1,Math.ceil(v)),_=g*e.strides[0]+b*e.strides[1],w=g*e.strides[0]+T*e.strides[1],S=0;S<n;S++)for(var C=m*S,E=Math.floor(C),I=C-E,A=Math.min(o-1,Math.ceil(C)),N=_+E*e.strides[2],$=w+E*e.strides[2],D=_+A*e.strides[2],P=w+A*e.strides[2],R=0;R<l;R++){var M=u[N+R],O=u[$+R],F=M+(u[D+R]-M)*I,L=F+(O+(u[P+R]-O)*I-F)*x;c[p++]=L}return Fn$1(c,[i,t,n,l])},a.prototype.resizeBilinearBackprop=function(e,t,n){Hh([e,t],"resizeBilinearBackprop");for(var r=t.shape,a=r[0],i=r[1],s=r[2],o=r[3],l=e.shape,u=l[1],c=l[2],h=new Float32Array(a*i*s*o),d=[n&&u>1?i-1:i,n&&c>1?s-1:s],p=[n&&u>1?u-1:u,n&&c>1?c-1:c],f=d[0]/p[0],m=d[1]/p[1],g=this.readSync(e.dataId),y=0,v=0;v<a;v++)for(var b=v*t.strides[0],x=0;x<u;x++)for(var T=x*f,_=Math.floor(T),w=Math.min(Math.ceil(T),i-1),S=b+_*t.strides[1],C=b+w*t.strides[1],E=T-_,k=1-E,I=0;I<c;I++)for(var A=I*m,N=Math.floor(A),$=Math.min(Math.ceil(A),s-1),D=A-N,P=1-D,R=S+N*t.strides[2],M=S+$*t.strides[2],O=C+N*t.strides[2],F=C+$*t.strides[2],L=k*P,B=k*D,V=E*P,U=E*D,z=0;z<o;z++){var G=g[y++];h[R+z]+=G*L,h[M+z]+=G*B,h[O+z]+=G*V,h[F+z]+=G*U}return Ln(h,[a,s,i,o],t.dtype)},a.prototype.resizeNearestNeighbor=function(e,t,n,r){Hh(e,"resizeNearestNeighbor");for(var a=e.shape,i=a[0],s=a[1],o=a[2],l=a[3],u=this.readSync(e.dataId),c=new Float32Array(i*t*n*l),h=[r&&t>1?s-1:s,r&&n>1?o-1:o],d=[r&&t>1?t-1:t,r&&n>1?n-1:n],p=h[0]/d[0],f=h[1]/d[1],m=0,g=0;g<i;g++)for(var y=g*e.strides[0],v=0;v<t;v++)for(var b=p*v,x=y+Math.min(s-1,r?Math.round(b):Math.floor(b))*e.strides[1],T=0;T<n;T++)for(var _=f*T,w=x+Math.min(o-1,r?Math.round(_):Math.floor(_))*e.strides[2],S=0;S<l;S++){var C=u[w+S];c[m++]=C}return Fn$1(c,[i,t,n,l],e.dtype)},a.prototype.resizeNearestNeighborBackprop=function(e,t,n){Hh([e,t],"resizeNearestNeighborBackprop");for(var r=t.shape,a=r[0],i=r[1],s=r[2],o=r[3],l=e.shape,u=l[1],c=l[2],h=new Float32Array(a*i*s*o),d=this.readSync(e.dataId),p=[n&&u>1?i-1:i,n&&c>1?s-1:s],f=[n&&u>1?u-1:u,n&&c>1?c-1:c],m=p[0]/f[0],g=p[1]/f[1],y=1/m,v=1/g,b=2*Math.ceil(y)+2,x=2*Math.ceil(v)+2,T=0;T<a;T++)for(var _=T*t.strides[0],w=0;w<i;w++)for(var S=_+w*t.strides[1],C=Math.floor(w*y),E=Math.floor(C-b/2),k=0;k<s;k++)for(var I=S+k*t.strides[2],A=Math.floor(k*v),N=Math.floor(A-x/2),$=0;$<o;$++){for(var D=0,P=0;P<b;P++){var R=P+E;if(!(R<0||R>=u)){var M=_+R*e.strides[1],O=R*m;if(w===Math.min(i-1,n?Math.round(O):Math.floor(O)))for(var F=0;F<x;F++){var L=F+N;if(!(L<0||L>=c)){var B=M+L*e.strides[2],V=L*g;k===Math.min(s-1,n?Math.round(V):Math.floor(V))&&(D+=d[B+$])}}}}h[I+$]=D}return Ln(h,t.shape,t.dtype)},a.prototype.batchNormalization=function(e,t,n,r,a,i){Hh([e,t,n,a,i],"batchNorm");for(var s=this.readSync(e.dataId),o=this.readSync(t.dataId),l=this.readSync(n.dataId),u=a?this.readSync(a.dataId):new Float32Array([1]),c=i?this.readSync(i.dataId):new Float32Array([0]),h=new Float32Array(s.length),d=c.length,p=u.length,f=l.length,m=o.length,g=0,y=0,v=0,b=0,x=0;x<s.length;++x)h[x]=c[g++]+(s[x]-o[y++])*u[v++]/Math.sqrt(l[b++]+r),g>=d&&(g=0),y>=m&&(y=0),v>=p&&(v=0),b>=f&&(b=0);return Ln(h,e.shape)},a.prototype.localResponseNormalization4D=function(e,t,n,r,a){Hh(e,"localResponseNormalization4D");var i=e.shape[3],s=i-1,o=this.readSync(e.dataId),l=e.size,u=new Float32Array(l);function c(e){for(var n=e%i,r=e-n+Math.max(0,n-t),a=e-n+Math.min(n+t,s),l=0;r<=a;r++){var u=o[r];l+=u*u}return l}for(var h=0;h<l;h++){var d=c(h),p=o[h]*Math.pow(n+r*d,-a);u[h]=p}return Ln(u,e.shape)},a.prototype.LRNGrad=function(e,t,n,r,a,i,s){Hh(e,"LRNGrad");for(var o=e.shape[3],l=this.readSync(e.dataId),u=this.readSync(t.dataId),c=this.readSync(n.dataId),h=new Float32Array(e.size),d=e.size,p=0;p<d;p++){for(var f=p%o,m=p-f+Math.max(0,f-r),g=p-f+Math.min(o,f+r+1),y=0,v=m;v<g;v++)y+=Math.pow(u[v],2);for(y=i*y+a,v=m;v<g;v++){var b=-2*i*s*u[v]*c[p]/y;p===v&&(b+=Math.pow(y,-s)),b*=l[p],h[v]+=b}}return Ln(h,e.shape)},a.prototype.multinomial=function(e,t,n,r){Hh(e,"multinomial");for(var a=t?e:go(e),i=a.shape[0],s=a.shape[1],o=Gn([i,n],"int32"),l=this.readSync(o.dataId),u=this.readSync(a.dataId),c=0;c<i;++c){var h=c*s,d=new Float32Array(s-1);d[0]=u[h];for(var p=1;p<d.length;++p)d[p]=d[p-1]+u[h+p];for(var f=cr(r.toString()),m=c*n,g=0;g<n;++g){var y=f();l[m+g]=d.length;for(var v=0;v<d.length;v++)if(y<d[v]){l[m+g]=v;break}}}return o},a.prototype.oneHot=function(e,t,n,r){Hh(e,"oneHot");var a=new Float32Array(e.size*t);a.fill(r);for(var i=this.readSync(e.dataId),s=0;s<e.size;++s)i[s]>=0&&i[s]<t&&(a[s*t+i[s]]=n);return Bn(a,[e.size,t],"int32")},a.prototype.nonMaxSuppression=function(e,t,n,r,a){return Hh(e,"nonMaxSuppression"),jo(this.readSync(e.dataId),this.readSync(t.dataId),n,r,a)},a.prototype.fft=function(e){return this.fftBatch(e,!1)},a.prototype.ifft=function(e){return this.fftBatch(e,!0)},a.prototype.fftBatch=function(e,t){for(var n=e.shape[0],r=e.shape[1],a=dr(e.shape,"float32"),i=dr(e.shape,"float32"),s=Tn(e).as2D(n,r),o=Nn(e).as2D(n,r),l=0;l<n;l++)for(var u=s.slice([l,0],[1,r]),c=o.slice([l,0],[1,r]),h=Dn(u,c),d=this.readSync(this.fftImpl(h,t).dataId),p=0;p<r;p++){var f=zo(d,p);a.values[l*r+p]=f.real,i.values[l*r+p]=f.imag}return Dn(a.toTensor(),i.toTensor()).as2D(n,r)},a.prototype.fftImpl=function(e,t){var n=e.as1D(),r=n.size;if(this.isExponentOf2(r)){var a=this.fftRadix2(n,r,t).as2D(e.shape[0],e.shape[1]);return t&&(a=Dn(Tn(a).div(On(r)),Nn(a).div(On(r)))),a}var i=this.readSync(e.dataId),s=function(e){for(var t=new Float32Array(e.length/2),n=new Float32Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}(this.fourierTransformByMatmul(i,r,t));return Dn(s.real,s.imag).as2D(e.shape[0],e.shape[1])},a.prototype.isExponentOf2=function(e){return 0==(e&e-1)},a.prototype.fftRadix2=function(e,t,n){if(1===t)return e;var r=this.readSync(e.dataId),a=t/2,i=function(e){for(var t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t),a=0;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}(r),s=Dn(i.real,i.imag).as1D(),o=function(e){for(var t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t),a=2;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}(r),l=Dn(o.real,o.imag).as1D();s=this.fftRadix2(s,a,n),l=this.fftRadix2(l,a,n);var u=function(e,t){for(var n=new Float32Array(e/2),r=new Float32Array(e/2),a=0;a<Math.ceil(e/2);a++){var i=(t?2:-2)*Math.PI*(a/e);n[a]=Math.cos(i),r[a]=Math.sin(i)}return{real:n,imag:r}}(t,n),c=Dn(u.real,u.imag).mul(l),h=s.add(c),d=s.sub(c),p=Tn(h).concat(Tn(d)),f=Nn(h).concat(Nn(d));return Dn(p,f).as1D()},a.prototype.fourierTransformByMatmul=function(e,t,n){for(var r=new Float32Array(2*t),a=0;a<t;a++){for(var i=0,s=0,o=0;o<t;o++){var l=Ho(a*o,t,n),u=zo(e,o);i+=u.real*l.real-u.imag*l.imag,s+=u.real*l.imag+u.imag*l.real}n&&(i/=t,s/=t),Go(r,i,s,a)}return r},a.prototype.depthToSpace=function(e,t,n){C("NHWC"===n,(function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+n})),C(t>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+t}));for(var r=e.shape[0],a=e.shape[1],i=e.shape[2],s=e.shape[3],o=a*t,l=i*t,u=s/(t*t),c=this.readSync(e.dataId),h=new Float32Array(r*o*l*u),d=0,p=0;p<r;++p)for(var f=0;f<o;++f)for(var m=Math.floor(f/t),g=f%t,y=0;y<l;++y)for(var v=Math.floor(y/t),b=(g*t+y%t)*u,x=0;x<u;++x){var T=x+b+s*(v+i*(m+a*p));h[d++]=c[T]}return Ln(h,[r,o,l,u])},a.prototype.broadcastedBinaryOp=function(e,t,n,r){var a=Ro(e.shape,t.shape),i=dr(a,n),s=this.readSync(e.dataId),o=this.readSync(t.dataId),l=Co(e.shape,a),u=Co(t.shape,a),c=i.values;if(l.length+u.length===0)for(var h=0;h<c.length;++h)c[h]=r(s[h%s.length],o[h%o.length]);else{var d=this.bufferSync(e),p=this.bufferSync(t),f=function(n){var a=i.indexToLoc(n),h=a.slice(-e.rank);l.forEach((function(e){return h[e]=0}));var f=d.locToIndex(h),m=a.slice(-t.rank);u.forEach((function(e){return m[e]=0}));var g=p.locToIndex(m);c[n]=r(s[f],o[g])};for(h=0;h<c.length;++h)f(h)}return i.toTensor()},a.prototype.broadcastedBinaryComplexOp=function(e,t,n){var r=Ro(e.shape,t.shape),a=dr(r,"float32"),i=dr(r,"float32"),s=this.readSync(e.dataId),o=this.readSync(t.dataId),l=Co(e.shape,r),u=Co(t.shape,r),c=a.values,h=i.values;if(l.length+u.length===0)for(var d=0;d<c.length;d++){var p=d%s.length,f=d%o.length,m=n(s[2*p],s[2*p+1],o[2*f],o[2*f+1]);c[d]=m.real,h[d]=m.imag}else{var g=this.bufferSync(this.data.get(e.dataId).complexTensors.real),y=this.bufferSync(this.data.get(t.dataId).complexTensors.real),v=function(r){var i=a.indexToLoc(r),d=i.slice(-e.rank);l.forEach((function(e){return d[e]=0}));var p=g.locToIndex(d),f=i.slice(-t.rank);u.forEach((function(e){return f[e]=0}));var m=y.locToIndex(f),v=n(s[2*p],s[2*p+1],o[2*m],o[2*m+1]);c[r]=v.real,h[r]=v.imag};for(d=0;d<c.length;d++)v(d)}return this.complex(a.toTensor(),i.toTensor())},a.prototype.split=function(e,t,n){return Zo(e,t,n)},a.prototype.dispose=function(){},a.prototype.floatPrecision=function(){return 32},a.prototype.epsilon=function(){return 1e-7},a.prototype.cropAndResize=function(e,t,n,r,a,i){for(var s=e.shape,o=s[0],l=s[1],u=s[2],c=s[3],h=t.shape[0],d=r[0],p=r[1],f=dr([h,d,p,c],"float32"),m=this.readSync(t.dataId),g=this.readSync(n.dataId),y=this.readSync(e.dataId),v=e.strides,b=f.strides,x=0;x<h;x++){var T=4*x,_=m[T],w=m[T+1],S=m[T+2],C=m[T+3],E=g[x];if(!(E>=o))for(var k=d>1?(S-_)*(l-1)/(d-1):0,I=p>1?(C-w)*(u-1)/(p-1):0,A=0;A<d;A++){var N=d>1?_*(l-1)+A*k:.5*(_+S)*(l-1);if(N<0||N>l-1)for(var $=0;$<p;$++)for(var D=0;D<c;D++){var P=D+$*b[2]+A*b[1]+x*b[0];f.values[P]=i}else if("bilinear"===a){var R=Math.floor(N),M=Math.ceil(N),O=N-R;for($=0;$<p;$++)if((H=p>1?w*(u-1)+$*I:.5*(w+C)*(u-1))<0||H>u-1)for(D=0;D<c;D++)P=D+$*b[2]+A*b[1]+x*b[0],f.values[P]=i;else{var F=Math.floor(H),L=Math.ceil(H),B=H-F;for(D=0;D<c;D++){var V=y[P=D+F*v[2]+R*v[1]+E*v[0]],U=y[P=D+L*v[2]+R*v[1]+E*v[0]],z=y[P=D+F*v[2]+M*v[1]+E*v[0]],G=V+(U-V)*B,W=z+(y[P=D+L*v[2]+M*v[1]+E*v[0]]-z)*B;P=D+$*b[2]+A*b[1]+x*b[0],f.values[P]=G+(W-G)*O}}}else for($=0;$<p;++$){var H;if((H=p>1?w*(u-1)+$*I:.5*(w+C)*(u-1))<0||H>u-1)for(D=0;D<c;D++)P=D+$*b[2]+A*b[1]+x*b[0],f.values[P]=i;else{var j=Math.round(H),q=Math.round(N);for(D=0;D<c;D++){var K=D+j*v[2]+q*v[1]+E*v[0],X=D+$*b[2]+A*b[1]+x*b[0];f.values[X]=y[K]}}}}}return f.toTensor()},a.prototype.sparseToDense=function(e,t,n,r){var a=Zr(0,e,n),i=a.sliceRank,s=a.numUpdates,o=a.sliceSize,l=a.strides,u=a.outputSize;return this.scatter(e,t,n,u,o,s,i,l,r,!1)},a.prototype.gatherND=function(e,t){var n=t.shape,r=n[n.length-1],a=jr(e,t),i=a[0],s=a[1],o=a[2],l=a[3];if(0===s)return Fn$1([],i,e.dtype);for(var u=new gt([s,o],e.dtype),c=this.readSync(t.dataId),h=this.readSync(e.dataId),d=0;d<s;d++){for(var p=[],f=0,m=0;m<r;m++){var g=c[d*r+m];f+=g*l[m],p.push(g)}if(f<0||f>=e.size/o)throw new Error("Invalid indices: "+p+" does not index into "+e.shape);for(var y=0;y<o;y++)u.values[d*o+y]=h[f*o+y]}return u.toTensor().reshape(i)},a.prototype.scatterND=function(e,t,n){var r=Zr(0,e,n),a=r.sliceRank,i=r.numUpdates,s=r.sliceSize,o=r.strides,l=r.outputSize,u=On(0);return this.scatter(e,t,n,l,s,i,a,o,u,!0)},a.prototype.fill=function(e,t,n){var r=P(n=n||j(t),k(e));return r.fill(t),Lt.makeTensor(r,e,n,this)},a.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(e.shape,1,e.dtype)},a.prototype.zerosLike=function(e){var t=P(e.dtype,k(e.shape));return this.makeOutput(t,e.shape,e.dtype)},a.prototype.linspace=function(e,t,n){return Wo(e,t,n)},a.prototype.scatter=function(e,t,n,r,a,i,s,o,l,u){var c=[r/a,a],h=this.readSync(e.dataId),d=this.readSync(t.dataId);if(0===r)return Fn$1([],n,t.dtype);var p=new gt(c,t.dtype);p.values.fill(this.readSync(l.dataId)[0]);for(var f=0;f<i;f++){for(var m=[],g=0,y=0;y<s;y++){var v=h[f*s+y];m.push(v),g+=v*o[y]}if(g<0||g>=r/a)throw new Error("Invalid indices: "+m+" does not index into "+n);for(var b=0;b<a;b++)u?p.values[g*a+b]+=d[f*a+b]:p.values[g*a+b]=0===t.rank?d[0]:d[f*a+b]}return p.toTensor().reshape(n)},a}(bo);Lt.registerBackend("cpu",(function(){return new Kh}),1);for(var jh=0,Xh=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t,i=a.boxes,s=a.scores,o=r,l=o.maxOutputSize,u=o.iouThreshold,c=o.scoreThreshold,h=o.softNmsSigma,d=n;Hh(i,"NonMaxSuppressionWithScore");var p=Xo(d.data.get(i.dataId).values,d.data.get(s.dataId).values,l,u,c,h);return[p.selectedIndices,p.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n;Hh(r,"square");for(var i=a.data.get(r.dataId).values,s=new Float32Array(i.length),o=0;o<i.length;++o){var l=i[o];s[o]=l*l}return{dataId:a.write(s,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},{kernelName:eu,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,a=r.a,i=r.b,s=n;Hh([a,i],eu);var o=s.data.get(a.dataId).values,l=s.data.get(i.dataId).values,u=function(e,t,n,r,a,i){var s=Ro(e,t),o=s.length,l=$$1(s),u=B(a,k(s)),c=e.length,h=t.length,d=$$1(e),p=$$1(t),f=Co(e,s),m=Co(t,s);if(f.length+m.length===0)for(var g=0;g<u.length;++g)u[g]=i(n[g%n.length],r[g%r.length]);else{var y=function(e){var t=it(e,o,l),a=t.slice(-c);f.forEach((function(e){return a[e]=0}));var s=at(a,c,d),g=t.slice(-h);m.forEach((function(e){return g[e]=0}));var y=at(g,h,p);u[e]=i(n[s],r[y])};for(g=0;g<u.length;++g)y(g)}return[u,s]}(a.shape,i.shape,o,l,a.dtype,(function(e,t){var n=e-t;return n*n})),c=u[0],h=u[1];return{dataId:s.write(c,h,a.dtype),shape:h,dtype:a.dtype}}}];jh<Xh.length;jh++)d(Xh[jh]);for(var Yh,$h=function(e){this.variableNames=["A"];var t=ua(),n=e[0],r=e[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+r+".0, "+n+".0);\n\n        vec4 values = "+t.texture2D+"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "},Qh=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var t=ua(),n=e[0],r=e[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2("+r+".0, "+n+".0);\n            vec4 values = "+t.texture2D+"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        "+t.output+" = result;\n      }\n    "},Jh=0,Zh=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.pixels,s=r.numChannels,o="undefined"!=typeof HTMLVideoElement&&a instanceof HTMLVideoElement,l="undefined"!=typeof HTMLImageElement&&a instanceof HTMLImageElement,u=o?[a.videoWidth,a.videoHeight]:[a.width,a.height],c=u[0],h=u[1],d=[h,c],p=[h,c,s];(l||o)&&(null==Yh&&(Yh=document.createElement("canvas").getContext("2d")),Yh.canvas.width=c,Yh.canvas.height=h,Yh.drawImage(a,0,0,c,h),a=Yh.canvas);var f=n.makeTensorInfo(d,"int32");n.texData.get(f.dataId).usage=zt.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(f.dataId),a);var m=i().getBool("WEBGL_PACK")?new Qh(p):new $h(p),g=n.runWebGLProgram(m,[f],"int32");return n.disposeData(f.dataId),g}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;dn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var a=t,i=a.boxes,s=a.scores,o=r,l=o.maxOutputSize,u=o.iouThreshold,c=o.scoreThreshold,h=o.softNmsSigma,d=n,p=Xo(d.readSync(i.dataId),d.readSync(s.dataId),l,u,c,h);return[p.selectedIndices,p.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n,i=new Cs(r.shape,"return x * x;");return a.runWebGLProgram(i,[r],r.dtype)}},{kernelName:eu,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,a=r.a,s=r.b,o=n,l=i().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new La("return (a - b) * (a - b);",a.shape,s.shape):new Ba("return (a - b) * (a - b);",a.shape,s.shape);return o.compileAndRun(l,[a,s])}}];Jh<Zh.length;Jh++)d(Zh[Jh]);for(var tf=0,ef=[{kernelName:"Square",gradFunc:function(e,t){var n=t[0];return{x:function(){return e.mul(n.toFloat().mul(2))}}}},{kernelName:eu,gradFunc:function(e,t){var n=t[0],r=t[1],a=On(2);return{a:function(){return gc(e,gc(a,Cc(n,r)))},b:function(){return gc(e,gc(a,Cc(r,n)))}}}}];tf<ef.length;tf++)p$1(ef[tf]);var nf=function(){function e(){}return e.prototype.fetch=function(e,t){return fetch(e,t)},e.prototype.now=function(){return performance.now()},e.prototype.encode=function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got "+t);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},e.prototype.decode=function(e,t){return new TextDecoder(t).decode(e)},e}();i().get("IS_BROWSER")&&i().setPlatform("browser",new nf);var rf,of=function(){return require("node-fetch")},af=function(){function e(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}return e.prototype.fetch=function(e,t){return null!=i().global.fetch?i().global.fetch(e,t):(null==rf&&(rf=of()),rf(e,t))},e.prototype.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6},e.prototype.encode=function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(e)},e.prototype.decode=function(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)},e}();i().get("IS_NODE")&&i().setPlatform("node",new af);var sf={float32:4,int32:4,uint16:2,uint8:1,bool:1},uf=4;function cf(e,t){for(var n={},r=0,a=function(t){var a=t.name,i=t.dtype,s=t.shape,o=k(s),l=void 0;if("quantization"in t){var u=t.quantization;if("uint8"!==u.dtype&&"uint16"!==u.dtype)throw new Error("Weight "+t.name+" has unknown quantization dtype "+u.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var c=sf[u.dtype],h=e.slice(r,r+o*c),d="uint8"===u.dtype?new Uint8Array(h):new Uint16Array(h);if("float32"===i)l=Float32Array.from(d,(function(e){return e*u.scale+u.min}));else{if("int32"!==i)throw new Error("Unsupported dtype in weight '"+a+"': "+i);l=Int32Array.from(d,(function(e){return Math.round(e*u.scale+u.min)}))}r+=o*c}else if("string"===i){var p=k(t.shape);l=[];for(var f=0;f<p;f++){var m=new Uint32Array(e.slice(r,r+uf))[0];r+=uf;var g=new Uint8Array(e.slice(r,r+m));l.push(g),r+=m}}else{var y=sf[i];if(h=e.slice(r,r+o*y),"float32"===i)l=new Float32Array(h);else if("int32"===i)l=new Int32Array(h);else{if("bool"!==i)throw new Error("Unsupported dtype in weight '"+a+"': "+i);l=new Uint8Array(h)}r+=o*y}n[a]=Fn$1(l,s,i)},i=0,s=t;i<s.length;i++)a(s[i]);return n}function lf(e){if(null===e)throw new Error("Invalid input value: "+JSON.stringify(e));var t=0,n=[];e.forEach((function(e){if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+e.constructor.name)}));var r=new Uint8Array(t),a=0;return n.forEach((function(e){r.set(new Uint8Array(e.buffer),a),a+=e.byteLength})),r.buffer}var hf="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function ff(e){return hf?Buffer.byteLength(e):new Blob([e]).size}function df(e){var t=0;e.forEach((function(e){t+=e.byteLength}));var n=new Uint8Array(t),r=0;return e.forEach((function(e){n.set(new Uint8Array(e),r),r+=e.byteLength})),n.buffer}function pf(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]}function vf(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:ff(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:ff(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}var mf=function(){function e(){this.saveRouters=[],this.loadRouters=[]}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.registerSaveRouter=function(t){e.getInstance().saveRouters.push(t)},e.registerLoadRouter=function(t){e.getInstance().loadRouters.push(t)},e.getSaveHandlers=function(t){return e.getHandlers(t,"save")},e.getLoadHandlers=function(t,n){return e.getHandlers(t,"load",n)},e.getHandlers=function(t,n,r){var a=[];return("load"===n?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach((function(e){var n=e(t,r);null!==n&&a.push(n)})),a},e}(),gf="://",yf=function(){function e(){this.managers={}}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.registerManager=function(t,n){C(null!=t,(function(){return"scheme must not be undefined or null."})),t.endsWith(gf)&&(t=t.slice(0,t.indexOf(gf))),C(t.length>0,(function(){return"scheme must not be an empty string."}));var r=e.getInstance();C(null==r.managers[t],(function(){return"A model store manager is already registered for scheme '"+t+"'."})),r.managers[t]=n},e.getManager=function(e){var t=this.getInstance().managers[e];if(null==t)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},e.getSchemes=function(){return Object.keys(this.getInstance().managers)},e}();function xf(e){if(-1===e.indexOf(gf))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+yf.getSchemes().join(","));return{scheme:e.split(gf)[0],path:e.split(gf)[1]}}function bf(e,t,a){return void 0===a&&(a=!1),n(this,void 0,void 0,(function(){var n,i,s,o,l,u,c,h,d;return r(this,(function(r){switch(r.label){case 0:return C(e!==t,(function(){return"Old path and new path are the same: '"+e+"'"})),C((n=mf.getLoadHandlers(e)).length>0,(function(){return"Copying failed because no load handler is found for source URL "+e+"."})),C(n.length<2,(function(){return"Copying failed because more than one ("+n.length+") load handlers for source URL "+e+"."})),i=n[0],C((s=mf.getSaveHandlers(t)).length>0,(function(){return"Copying failed because no save handler is found for destination URL "+t+"."})),C(s.length<2,(function(){return"Copying failed because more than one ("+n.length+") save handlers for destination URL "+t+"."})),o=s[0],l=xf(e).scheme,u=xf(e).path,c=l===xf(e).scheme,[4,i.load()];case 1:return h=r.sent(),a&&c?[4,yf.getManager(l).removeModel(u)]:[3,3];case 2:r.sent(),r.label=3;case 3:return[4,o.save(h)];case 4:return d=r.sent(),!a||c?[3,6]:[4,yf.getManager(l).removeModel(u)];case 5:r.sent(),r.label=6;case 6:return[2,d.modelArtifactsInfo]}}))}))}var wf="models_store",Cf="model_info_store";function Ef(){if(!i().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e=window||self,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function Rf(e){var t=e.result;t.createObjectStore(wf,{keyPath:"modelPath"}),t.createObjectStore(Cf,{keyPath:"modelPath"})}var If=function(){function e(e){if(this.indexedDB=Ef(),null==e||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return e.prototype.save=function(e){return n(this,void 0,void 0,(function(){return r(this,(function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]}))}))},e.prototype.load=function(){return n(this,void 0,void 0,(function(){return r(this,(function(e){return[2,this.databaseAction(this.modelPath)]}))}))},e.prototype.databaseAction=function(e,t){var n=this;return new Promise((function(e,r){var a=n.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return Rf(a)},a.onsuccess=function(){var i=a.result;if(null==t){var s=i.transaction(wf,"readonly"),o=s.objectStore(wf).get(n.modelPath);o.onsuccess=function(){if(null==o.result)return i.close(),r(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."));e(o.result.modelArtifacts)},o.onerror=function(e){return i.close(),r(o.error)},s.oncomplete=function(){return i.close()}}else{var l,u=vf(t),c=i.transaction(Cf,"readwrite"),h=c.objectStore(Cf),d=h.put({modelPath:n.modelPath,modelArtifactsInfo:u});d.onsuccess=function(){var a=(l=i.transaction(wf,"readwrite")).objectStore(wf).put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:u});a.onsuccess=function(){return e({modelArtifactsInfo:u})},a.onerror=function(e){var t=(h=c.objectStore(Cf)).delete(n.modelPath);t.onsuccess=function(){return i.close(),r(a.error)},t.onerror=function(e){return i.close(),r(a.error)}}},d.onerror=function(e){return i.close(),r(d.error)},c.oncomplete=function(){null==l?i.close():l.oncomplete=function(){return i.close()}}}},a.onerror=function(e){return r(a.error)}}))},e.URL_SCHEME="indexeddb://",e}(),kf=function(e){return i().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(If.URL_SCHEME)?(t=e.slice(If.URL_SCHEME.length),new If(t)):null;var t};mf.registerSaveRouter(kf),mf.registerLoadRouter(kf);var Sf=function(){function e(){this.indexedDB=Ef()}return e.prototype.listModels=function(){return n(this,void 0,void 0,(function(){var e=this;return r(this,(function(t){return[2,new Promise((function(t,n){var r=e.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=function(){return Rf(r)},r.onsuccess=function(){var e=r.result,a=e.transaction(Cf,"readonly"),i=a.objectStore(Cf).getAll();i.onsuccess=function(){for(var e={},n=0,r=i.result;n<r.length;n++){var a=r[n];e[a.modelPath]=a.modelArtifactsInfo}t(e)},i.onerror=function(t){return e.close(),n(i.error)},a.oncomplete=function(){return e.close()}},r.onerror=function(e){return n(r.error)}}))]}))}))},e.prototype.removeModel=function(e){return n(this,void 0,void 0,(function(){var t=this;return r(this,(function(n){var r;return e=(r=e).startsWith(If.URL_SCHEME)?r.slice(If.URL_SCHEME.length):r,[2,new Promise((function(n,r){var a=t.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return Rf(a)},a.onsuccess=function(){var t,i=a.result,s=i.transaction(Cf,"readwrite"),o=s.objectStore(Cf),l=o.get(e);l.onsuccess=function(){if(null==l.result)return i.close(),r(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var a=o.delete(e),s=function(){var a=(t=i.transaction(wf,"readwrite")).objectStore(wf).delete(e);a.onsuccess=function(){return n(l.result.modelArtifactsInfo)},a.onerror=function(e){return r(l.error)}};a.onsuccess=s,a.onerror=function(e){return s(),i.close(),r(l.error)}},l.onerror=function(e){return i.close(),r(l.error)},s.oncomplete=function(){null==t?i.close():t.oncomplete=function(){return i.close()}}},a.onerror=function(e){return r(a.error)}}))]}))}))},e}();if(i().getBool("IS_BROWSER"))try{yf.registerManager(If.URL_SCHEME,new Sf)}catch(t2){}var Af="/",Df="tensorflowjs_models",Tf="info",Nf="model_topology",Ff="weight_specs",_f="weight_data",Of="model_metadata";function Mf(e){return{info:[Df,e,Tf].join(Af),topology:[Df,e,Nf].join(Af),weightSpecs:[Df,e,Ff].join(Af),weightData:[Df,e,_f].join(Af),modelMetadata:[Df,e,Of].join(Af)}}function Bf(e){var t=e.split(Af);if(t.length<3)throw new Error("Invalid key format: "+e);return t.slice(1,t.length-1).join(Af)}var Pf=function(){function e(e){if(!i().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==e||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=Mf(this.modelPath)}return e.prototype.save=function(e){return n(this,void 0,void 0,(function(){var t,n,a;return r(this,(function(r){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),a=vf(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(e){if(hf)return Buffer.from(e).toString("base64");for(var t=new Uint8Array(e),n="",r=0,a=t.length;r<a;r++)n+=String.fromCharCode(t[r]);return btoa(n)}(e.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata})),[2,{modelArtifactsInfo:a}]}catch(i){throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+a.modelTopologyBytes+", weightSpecsBytes="+a.weightSpecsBytes+", weightDataBytes="+a.weightDataBytes+".")}return[2]}))}))},e.prototype.load=function(){return n(this,void 0,void 0,(function(){var e,t,n,a,i,s,o;return r(this,(function(r){if(null==(e=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==e.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},null==(n=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=n,null==(a=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=a,null!=(i=this.LS.getItem(this.keys.modelMetadata))&&(s=JSON.parse(i),t.format=s.format,t.generatedBy=s.generatedBy,t.convertedBy=s.convertedBy,t.userDefinedMetadata=s.userDefinedMetadata),null==(o=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=function(e){if(hf){var t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var n=atob(e),r=new Uint8Array(n.length),a=0;a<n.length;++a)r.set([n.charCodeAt(a)],a);return r.buffer}(o),[2,t]}))}))},e.URL_SCHEME="localstorage://",e}(),Lf=function(e){return i().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Pf.URL_SCHEME)?(t=e.slice(Pf.URL_SCHEME.length),new Pf(t)):null;var t};mf.registerSaveRouter(Lf),mf.registerLoadRouter(Lf);var Wf=function(){function e(){C(i().getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),C("undefined"==typeof window||void 0!==window.localStorage,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}return e.prototype.listModels=function(){return n(this,void 0,void 0,(function(){var e,t,n,a,i,s;return r(this,(function(r){for(e={},t=Df+Af,n=Af+Tf,a=0;a<this.LS.length;++a)(i=this.LS.key(a)).startsWith(t)&&i.endsWith(n)&&(s=Bf(i),e[s]=JSON.parse(this.LS.getItem(i)));return[2,e]}))}))},e.prototype.removeModel=function(e){return n(this,void 0,void 0,(function(){var t,n;return r(this,(function(r){var a;if(e=(a=e).startsWith(Pf.URL_SCHEME)?a.slice(Pf.URL_SCHEME.length):a,t=Mf(e),null==this.LS.getItem(t.info))throw new Error("Cannot find model at path '"+e+"'");return n=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,n]}))}))},e}();if(i().getBool("IS_BROWSER"))try{yf.registerManager(Pf.URL_SCHEME,new Wf)}catch(t2){}var Uf="model",Vf=".json",zf=".weights.bin";function Gf(e){return new Promise((function(e){return setTimeout(e)})).then(e)}var Hf=function(){function e(t){if(!i().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),null!=t&&0!==t.length||(t=Uf),this.modelTopologyFileName=t+Vf,this.weightDataFileName=t+zf}return e.prototype.save=function(e){return n(this,void 0,void 0,(function(){var t,n,a,i,s,o;return r(this,(function(r){switch(r.label){case 0:if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return n=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],a={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:n},i=window.URL.createObjectURL(new Blob([JSON.stringify(a)],{type:"application/json"})),(s=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,s.href=i,[4,Gf((function(){return s.dispatchEvent(new MouseEvent("click"))}))];case 2:return r.sent(),null==e.weightData?[3,4]:((o=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,o.href=t,[4,Gf((function(){return o.dispatchEvent(new MouseEvent("click"))}))]);case 3:r.sent(),r.label=4;case 4:return[2,{modelArtifactsInfo:vf(e)}]}}))}))},e.URL_SCHEME="downloads://",e}(),qf=function(){function e(e){if(null==e||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return e.prototype.load=function(){return n(this,void 0,void 0,(function(){var e,t,n=this;return r(this,(function(r){return e=this.files[0],t=this.files.slice(1),[2,new Promise((function(r,a){var i=new FileReader;i.onload=function(i){var s=JSON.parse(i.target.result),o=s.modelTopology;if(null!=o){0===t.length&&r({modelTopology:o});var l=s.weightsManifest;if(null!=l){var u;try{u=n.checkManifestAndWeightFiles(l,t)}catch(p){return void a(p)}var c=[],h=[],d=[];l.forEach((function(e){e.paths.forEach((function(e){h.push(e),d.push(null)})),c.push.apply(c,e.weights)})),l.forEach((function(e){e.paths.forEach((function(e){var t=new FileReader;t.onload=function(t){var n=t.target.result,a=h.indexOf(e);d[a]=n,-1===d.indexOf(null)&&r({modelTopology:o,weightSpecs:c,weightData:df(d),format:s.format,generatedBy:s.generatedBy,convertedBy:s.convertedBy,userDefinedMetadata:s.userDefinedMetadata})},t.onerror=function(t){return a("Failed to weights data from file of path '"+e+"'.")},t.readAsArrayBuffer(u[e])}))}))}else a(new Error("weightManifest field is missing from file "+e.name))}else a(new Error("modelTopology field is missing from file "+e.name))},i.onerror=function(t){return a("Failed to read model topology and weights manifest JSON from file '"+e.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},i.readAsText(e)}))]}))}))},e.prototype.checkManifestAndWeightFiles=function(e,t){for(var n=[],r=t.map((function(e){return pf(e.name)})),a={},i=0,s=e;i<s.length;i++)s[i].paths.forEach((function(e){var i=pf(e);if(-1!==n.indexOf(i))throw new Error("Duplicate file basename found in weights manifest: '"+i+"'");if(n.push(i),-1===r.indexOf(i))throw new Error("Weight file with basename '"+i+"' is not provided.");a[e]=t[r.indexOf(i)]}));if(n.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+n.length+") and the number of weight files provided ("+t.length+").");return a},e}();function Kf(e,t,n,r){var a;C(null!=(a=e)&&Array.isArray(a)&&a.length>0,(function(){return"promises must be a none empty array"})),function(e,t){C(e>=0&&e<=1,(function(){return"Progress fraction must be in range [0, 1], but got startFraction "+e})),C(t>=0&&t<=1,(function(){return"Progress fraction must be in range [0, 1], but got endFraction "+t})),C(t>=e,(function(){return"startFraction must be no more than endFraction, but got startFraction "+e+" and endFraction "+t}))}(n=null==n?0:n,r=null==r?1:r);var i=0;return Promise.all(e.map((function(a){return a.then((function(a){var s=n+ ++i/e.length*(r-n);return t(s),a})),a})))}function jf(e,t){return n(this,void 0,void 0,(function(){var n,a,s,o,l,u,c,h,d;return r(this,(function(r){switch(r.label){case 0:return null==t&&(t={}),n=null==t.fetchFunc?i().platform.fetch:t.fetchFunc,a=e.map((function(e){return n(e,t.requestInit,{isBinary:!0})})),s=0,o=.5,null!=t.onProgress?[3,2]:[4,Promise.all(a)];case 1:return l=r.sent(),[3,4];case 2:return[4,Kf(a,t.onProgress,s,o)];case 3:l=r.sent(),r.label=4;case 4:return u=l.map((function(e){return e.arrayBuffer()})),c=.5,h=1,null!=t.onProgress?[3,6]:[4,Promise.all(u)];case 5:return d=r.sent(),[3,8];case 6:return[4,Kf(u,t.onProgress,c,h)];case 7:d=r.sent(),r.label=8;case 8:return[2,d]}}))}))}function Xf(e){var t=this;return function(a,i,s){return void 0===i&&(i=""),n(t,void 0,void 0,(function(){var t,n,o,l,u,c,h,d,p,f;return r(this,(function(r){switch(r.label){case 0:if(t=a.map((function(){return!1})),n={},o=null!=s?s.map((function(){return!1})):[],l=[],a.forEach((function(e,r){var a=0;e.weights.forEach((function(e){var i="quantization"in e?e.quantization.dtype:e.dtype,u=sf[i]*k(e.shape),c=function(){t[r]=!0,null==n[r]&&(n[r]=[]),n[r].push({manifestEntry:e,groupOffset:a,sizeBytes:u})};null!=s?s.forEach((function(t,n){t===e.name&&(c(),o[n]=!0)})):c(),l.push(e.name),a+=u}))})),!o.every((function(e){return e})))throw u=s.filter((function(e,t){return!o[t]})),new Error("Could not find weights in manifest with names: "+u.join(", ")+". \nManifest JSON has weights with names: "+l.join(", ")+".");return c=t.reduce((function(e,t,n){return t&&e.push(n),e}),[]),h=[],c.forEach((function(e){a[e].paths.forEach((function(e){var t=i+(i.endsWith("/")?"":"/")+e;h.push(t)}))})),[4,e(h)];case 1:return d=r.sent(),p={},f=0,c.forEach((function(e){for(var t=a[e].paths.length,r=0,i=0;i<t;i++)r+=d[f+i].byteLength;for(var s=new ArrayBuffer(r),o=new Uint8Array(s),l=0,u=0;u<t;u++){var c=new Uint8Array(d[f+u]);o.set(c,l),l+=c.byteLength}n[e].forEach((function(e){var t=cf(s.slice(e.groupOffset,e.groupOffset+e.sizeBytes),[e.manifestEntry]);for(var n in t)p[n]=t[n]})),f+=t})),[2,p]}}))}))}}mf.registerSaveRouter((function(e){return i().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Hf.URL_SCHEME)?(void 0===(t=e.slice(Hf.URL_SCHEME.length))&&(t="model"),new Hf(t)):null;var t}));var Yf=function(){function e(e,t){if(this.DEFAULT_METHOD="POST",null==t&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,null!=t.fetchFunc?(C("function"==typeof t.fetchFunc,(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=t.fetchFunc):this.fetch=i().platform.fetch,C(null!=e&&e.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(e)&&C(2===e.length,(function(){return"URL paths for http must have a length of 2, (actual length is "+e.length+")."})),this.path=e,null!=t.requestInit&&null!=t.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return e.prototype.save=function(e){return n(this,void 0,void 0,(function(){var t,n,a,i;return r(this,(function(r){switch(r.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],a={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata,weightsManifest:n},t.body.append("model.json",new Blob([JSON.stringify(a)],{type:"application/json"}),"model.json"),null!=e.weightData&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((i=r.sent()).ok)return[2,{modelArtifactsInfo:vf(e),responses:[i]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+i.status+".")}}))}))},e.prototype.load=function(){return n(this,void 0,void 0,(function(){var e,t,n,a,i,s,o,l,u,c,h,d;return r(this,(function(r){switch(r.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(e=r.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");r.label=2;case 2:return r.trys.push([2,4,,5]),[4,e.json()];case 3:return t=r.sent(),[3,5];case 4:throw r.sent(),n="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(a=t.modelTopology,i=t.weightsManifest,s=t.generatedBy,o=t.convertedBy,l=t.format,u=t.userDefinedMetadata,null==a&&null==i)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==i?[3,7]:[4,this.loadWeights(i)];case 6:d=r.sent(),c=d[0],h=d[1],r.label=7;case 7:return[2,{modelTopology:a,weightSpecs:c,weightData:h,userDefinedMetadata:u,generatedBy:s,convertedBy:o,format:l}]}}))}))},e.prototype.loadWeights=function(e){return n(this,void 0,void 0,(function(){var t,n,a,i,s,o,l,u,c,h,d;return r(this,(function(r){switch(r.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,f=void 0,m=void 0,f=(p=t).lastIndexOf("/"),m=p.lastIndexOf("?"),n=[p.substring(0,f)+"/",m>f?p.substring(m):""],a=n[0],i=n[1],s=this.weightPathPrefix||a,o=[],l=0,u=e;l<u.length;l++)c=u[l],o.push.apply(o,c.weights);return h=[],e.forEach((function(e){e.paths.forEach((function(e){h.push(s+e+i)}))})),[4,jf(h,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return d=r.sent(),[2,[o,df(d)]]}var p,f,m}))}))},e.URL_SCHEME_REGEX=/^https?:\/\//,e}();function $f(e){return null!=e.match(Yf.URL_SCHEME_REGEX)}var Qf=function(e,t){return"undefined"==typeof fetch?null:(Array.isArray(e)?e.every((function(e){return $f(e)})):$f(e))?Jf(e,{onProgress:t}):null};function Jf(e,t){return new Yf(e,t)}mf.registerSaveRouter(Qf),mf.registerLoadRouter(Qf);var Zf=function(){function e(e){this.modelArtifacts=e}return e.prototype.load=function(){return n(this,void 0,void 0,(function(){return r(this,(function(e){return[2,this.modelArtifacts]}))}))},e}(),td=function(){function e(e){this.saveHandler=e}return e.prototype.save=function(e){return n(this,void 0,void 0,(function(){return r(this,(function(t){return[2,this.saveHandler(e)]}))}))},e}(),ed=Object.freeze({browserFiles:function(e){return new qf(e)},browserHTTPRequest:function(e,t){return Jf(e,t)},concatenateArrayBuffers:df,decodeWeights:cf,encodeWeights:function(e,t){return n(this,void 0,void 0,(function(){var a,i,s,o,l,u=this;return r(this,(function(c){switch(c.label){case 0:for(a=[],i=[],s=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e),o=function(o){var l=s[o],c=Array.isArray(e)?e[o].tensor:e[l];if("float32"!==c.dtype&&"int32"!==c.dtype&&"bool"!==c.dtype&&"string"!==c.dtype)throw new Error("Unsupported dtype in weight '"+l+"': "+c.dtype);var h={name:l,shape:c.shape,dtype:c.dtype};if("string"===c.dtype){var d=new Promise((function(e){return n(u,void 0,void 0,(function(){var t,n,a,i,s,o,l;return r(this,(function(r){switch(r.label){case 0:return[4,c.bytes()];case 1:for(t=r.sent(),n=t.reduce((function(e,t){return e+t.length}),0)+uf*t.length,a=new Uint8Array(n),i=0,s=0;s<t.length;s++)o=t[s],l=new Uint8Array(new Uint32Array([o.length]).buffer),a.set(l,i),i+=uf,a.set(o,i),i+=o.length;return e(a),[2]}}))}))}));i.push(d)}else i.push(c.data());null!=t&&(h.group=t),a.push(h)},l=0;l<s.length;++l)o(l);return[4,Promise.all(i)];case 1:return[2,{data:lf(c.sent()),specs:a}]}}))}))},fromMemory:function(e,t,n,r){return 1===arguments.length?null!=e.modelTopology||null!=e.weightSpecs?new Zf(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Zf({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Zf({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r}))},getLoadHandlers:function(e,t){return mf.getLoadHandlers(e,t)},getModelArtifactsInfoForJSON:vf,getSaveHandlers:function(e){return mf.getSaveHandlers(e)},http:Jf,isHTTPScheme:$f,loadWeights:function(e,t,a,i){return void 0===t&&(t=""),n(this,void 0,void 0,(function(){return r(this,(function(n){return[2,Xf((function(e){return jf(e,{requestInit:i})}))(e,t,a)]}))}))},registerLoadRouter:function(e){return mf.registerLoadRouter(e)},registerSaveRouter:function(e){return mf.registerSaveRouter(e)},weightsLoaderFactory:Xf,withSaveHandler:function(e){return new td(e)},copyModel:function(e,t){return n(this,void 0,void 0,(function(){return r(this,(function(n){return[2,bf(e,t,!1)]}))}))},listModels:function(){return n(this,void 0,void 0,(function(){var e,t,n,a,i,s,o;return r(this,(function(r){switch(r.label){case 0:e=yf.getSchemes(),t={},n=0,a=e,r.label=1;case 1:return n<a.length?(i=a[n],[4,yf.getManager(i).listModels()]):[3,4];case 2:for(o in s=r.sent())t[i+gf+o]=s[o];r.label=3;case 3:return n++,[3,1];case 4:return[2,t]}}))}))},moveModel:function(e,t){return n(this,void 0,void 0,(function(){return r(this,(function(n){return[2,bf(e,t,!0)]}))}))},removeModel:function(e){return n(this,void 0,void 0,(function(){var t;return r(this,(function(n){return t=xf(e),[2,yf.getManager(t.scheme).removeModel(t.path)]}))}))}}),nd;An({confusionMatrix_:function(e,t,n){var r=mn(e,"labels","confusionMatrix"),a=mn(t,"predictions","confusionMatrix");C(null==n||n>0&&Number.isInteger(n),(function(){return"If provided, numClasses must be a positive integer, but got "+n})),C(1===r.rank,(function(){return"Expected the rank of labels to be 1, but got "+r.rank})),C(1===a.rank,(function(){return"Expected the rank of predictions to be 1, but got "+a.rank})),C(r.shape[0]===a.shape[0],(function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+a.shape[0]+". Labels and predictions should have the same number of elements."})),C(n>0&&Number.isInteger(n),(function(){return"numClasses is required to be a positive integer, but got "+n}));var i=Rr(r.asType("int32"),n),s=Rr(a.asType("int32"),n);return i.transpose().matMul(s).asType("int32")}});var ad=An({fromPixels_:function(e,t){if(void 0===t&&(t=3),t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,a=!1,i=!1,s=!1;if(e.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&e instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement)a=!0;else if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement)i=!0;else{if(null==e.getContext)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+e.constructor.name);s=!0}if(a&&a&&e.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(null!=l("FromPixels",Lt.backendName))return Lt.runKernel("FromPixels",{pixels:e},{numChannels:t});var o,u,c=a?[e.videoWidth,e.videoHeight]:[e.width,e.height],h=c[0],d=c[1];if(s?o=e.getContext("2d").getImageData(0,0,h,d).data:r||n?o=e.data:(i||a)&&(null==nd&&(nd=document.createElement("canvas").getContext("2d")),nd.canvas.width=h,nd.canvas.height=d,nd.drawImage(e,0,0,h,d),o=nd.getImageData(0,0,h,d).data),4===t)u=new Int32Array(o);else{var p=h*d;u=new Int32Array(p*t);for(var f=0;f<p;f++)for(var m=0;m<t;++m)u[f*t+m]=o[4*f+m]}return Pn(u,[d,h,t],"int32")}}),id=Object.freeze({toPixels:function(e,t){return n(this,void 0,void 0,(function(){var n,a,i,s,o,l,u,c,h,d,p,f,m,g,y,v,b,x,T,_,w,S,C;return r(this,(function(r){switch(r.label){case 0:if(n=mn(e,"img","toPixels"),e instanceof wt||(n=n.toInt()),2!==n.rank&&3!==n.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+n.rank+".");if(a=n.shape.slice(0,2),i=a[0],s=a[1],(o=2===n.rank?1:n.shape[2])>4||2===o)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+o);return[4,n.data()];case 1:return l=r.sent(),u=n.min(),c=n.max(),[4,Promise.all([u.data(),c.data()])];case 2:if(h=r.sent(),d=h[0],p=h[1],f=d[0],m=p[0],u.dispose(),c.dispose(),"float32"===n.dtype){if(f<0||m>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+f+" - "+m+"].")}else{if("int32"!==n.dtype)throw new Error("Unsupported type for toPixels: "+n.dtype+". Please use float32 or int32 tensors.");if(f<0||m>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+f+" - "+m+"].")}for(g="float32"===n.dtype?255:1,y=new Uint8ClampedArray(s*i*4),v=0;v<i*s;++v)b=void 0,x=void 0,T=void 0,_=void 0,1===o?(b=l[v]*g,x=l[v]*g,T=l[v]*g,_=255):3===o?(b=l[3*v]*g,x=l[3*v+1]*g,T=l[3*v+2]*g,_=255):4===o&&(b=l[4*v]*g,x=l[4*v+1]*g,T=l[4*v+2]*g,_=l[4*v+3]*g),y[0+(w=4*v)]=Math.round(b),y[w+1]=Math.round(x),y[w+2]=Math.round(T),y[w+3]=Math.round(_);return null!=t&&(t.width=s,t.height=i,S=t.getContext("2d"),C=new ImageData(y,s,i),S.putImageData(C,0,0)),n!==e&&n.dispose(),[2,y]}}))}))},fromPixels:ad}),sd=function(){function e(){}return e.prototype.getClassName=function(){return this.constructor.className},e.fromConfig=function(e,t){return new e(t)},e}(),ud=function(){function e(){this.classNameMap={}}return e.getMap=function(){return null==e.instance&&(e.instance=new e),e.instance},e.register=function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]},e}();function cd(e){C(null!=e.className,(function(){return"Class being registered does not have the static className property defined."})),C("string"==typeof e.className,(function(){return"className is required to be a string, but got type "+typeof e.className})),C(e.className.length>0,(function(){return"Class being registered has an empty-string as its className, which is disallowed."})),ud.register(e)}var xd=function(t){function a(){return null!==t&&t.apply(this,arguments)||this}return e(a,t),a.prototype.minimize=function(e,t,n){void 0===t&&(t=!1);var r=this.computeGradients(e,n),a=r.value,i=r.grads;if(null!=n){var s=n.map((function(e){return{name:e.name,tensor:i[e.name]}}));this.applyGradients(s)}else this.applyGradients(i);return tn(i),t?a:(a.dispose(),null)},Object.defineProperty(a.prototype,"iterations",{get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),a.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},a.prototype.computeGradients=function(e,t){return po(e,t)},a.prototype.dispose=function(){null!=this.iterations_&&tn(this.iterations_)},a.prototype.saveIterations=function(){return n(this,void 0,void 0,(function(){return r(this,(function(e){return null==this.iterations_&&(this.iterations_=0),[2,{name:"iter",tensor:On(this.iterations_,"int32")}]}))}))},a.prototype.getWeights=function(){return n(this,void 0,void 0,(function(){return r(this,(function(e){throw new Error("getWeights() is not implemented for this optimizer yet.")}))}))},a.prototype.setWeights=function(e){return n(this,void 0,void 0,(function(){return r(this,(function(e){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())}))}))},a.prototype.extractIterations=function(e){return n(this,void 0,void 0,(function(){var t;return r(this,(function(n){switch(n.label){case 0:return t=this,[4,e[0].tensor.data()];case 1:return t.iterations_=n.sent()[0],[2,e.slice(1)]}}))}))},a}(sd);Object.defineProperty(xd,Symbol.hasInstance,{value:function(e){return null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients}});var bd=function(t){function a(e,n,r){void 0===r&&(r=null);var a=t.call(this)||this;return a.learningRate=e,a.rho=n,a.epsilon=r,a.accumulatedGrads=[],a.accumulatedUpdates=[],null==r&&(a.epsilon=Lt.backend.epsilon()),a}return e(a,t),a.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Lt.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:n+"/accum_grad",variable:Ze((function(){return Xn(a).variable(!1)}))}),null==t.accumulatedUpdates[r]&&(t.accumulatedUpdates[r]={originalName:n+"/accum_var",variable:Ze((function(){return Xn(a).variable(!1)}))});var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var s=t.accumulatedGrads[r].variable,o=t.accumulatedUpdates[r].variable;Ze((function(){var e=s.mul(t.rho).add(i.square().mul(1-t.rho)),n=o.add(t.epsilon).sqrt().div(s.add(t.epsilon).sqrt()).mul(i),r=o.mul(t.rho).add(n.square().mul(1-t.rho));s.assign(e),o.assign(r);var l=n.mul(-t.learningRate).add(a);a.assign(l)}))}})),this.incrementIterations()},a.prototype.dispose=function(){null!=this.accumulatedUpdates&&(tn(this.accumulatedGrads.map((function(e){return e.variable}))),tn(this.accumulatedUpdates.map((function(e){return e.variable}))))},a.prototype.getWeights=function(){return n(this,void 0,void 0,(function(){var e;return r(this,(function(t){switch(t.label){case 0:return e=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},a.prototype.setWeights=function(e){return n(this,void 0,void 0,(function(){var t;return r(this,(function(n){switch(n.label){case 0:return[4,this.extractIterations(e)];case 1:return e=n.sent(),t=e.length/2,this.accumulatedGrads=e.slice(0,t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.accumulatedUpdates=e.slice(t,2*t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}}))}))},a.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},a.fromConfig=function(e,t){return new e(t.learningRate,t.rho,t.epsilon)},a.className="Adadelta",a}(xd);cd(bd);var wd=function(t){function a(e,n){void 0===n&&(n=.1);var r=t.call(this)||this;return r.learningRate=e,r.initialAccumulatorValue=n,r.accumulatedGrads=[],r}return e(a,t),a.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Lt.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:n+"/accumulator",variable:Ze((function(){return Hn(a.shape,t.initialAccumulatorValue).variable(!1)}))});var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var s=t.accumulatedGrads[r].variable;Ze((function(){var e=s.add(i.square());s.assign(e);var n=i.div(e.add(Lt.backend.epsilon()).sqrt()).mul(-t.learningRate).add(a);a.assign(n)}))}})),this.incrementIterations()},a.prototype.dispose=function(){null!=this.accumulatedGrads&&tn(this.accumulatedGrads.map((function(e){return e.variable})))},a.prototype.getWeights=function(){return n(this,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulatedGrads.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},a.prototype.setWeights=function(e){return n(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:return e=t.sent(),this.accumulatedGrads=e.map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}}))}))},a.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},a.fromConfig=function(e,t){return new e(t.learningRate,t.initialAccumulatorValue)},a.className="Adagrad",a}(xd);cd(wd);var Cd=function(t){function a(e,n,r,a){void 0===a&&(a=null);var i=t.call(this)||this;return i.learningRate=e,i.beta1=n,i.beta2=r,i.epsilon=a,i.accumulatedFirstMoment=[],i.accumulatedSecondMoment=[],Ze((function(){i.accBeta1=On(n).variable(),i.accBeta2=On(r).variable()})),null==a&&(i.epsilon=Lt.backend.epsilon()),i}return e(a,t),a.prototype.applyGradients=function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);Ze((function(){var r=Cc(1,t.accBeta1),a=Cc(1,t.accBeta2);n.forEach((function(n,i){var s=Lt.registeredVariables[n];null==t.accumulatedFirstMoment[i]&&(t.accumulatedFirstMoment[i]={originalName:n+"/m",variable:Ze((function(){return Xn(s).variable(!1)}))}),null==t.accumulatedSecondMoment[i]&&(t.accumulatedSecondMoment[i]={originalName:n+"/v",variable:Ze((function(){return Xn(s).variable(!1)}))});var o=Array.isArray(e)?e[i].tensor:e[n];if(null!=o){var l=t.accumulatedFirstMoment[i].variable,u=t.accumulatedSecondMoment[i].variable,c=l.mul(t.beta1).add(o.mul(1-t.beta1)),h=u.mul(t.beta2).add(o.square().mul(1-t.beta2)),d=c.div(r),p=h.div(a);l.assign(c),u.assign(h);var f=d.div(p.sqrt().add(t.epsilon)).mul(-t.learningRate).add(s);s.assign(f)}})),t.accBeta1.assign(t.accBeta1.mul(t.beta1)),t.accBeta2.assign(t.accBeta2.mul(t.beta2))})),this.incrementIterations()},a.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&tn(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedSecondMoment&&tn(this.accumulatedSecondMoment.map((function(e){return e.variable})))},a.prototype.getWeights=function(){return n(this,void 0,void 0,(function(){var e;return r(this,(function(t){switch(t.label){case 0:return e=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},a.prototype.setWeights=function(e){return n(this,void 0,void 0,(function(){var t,n=this;return r(this,(function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:return e=r.sent(),Ze((function(){n.accBeta1.assign(xc(n.beta1,n.iterations_+1)),n.accBeta2.assign(xc(n.beta2,n.iterations_+1))})),t=e.length/2,this.accumulatedFirstMoment=e.slice(0,t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.accumulatedSecondMoment=e.slice(t,2*t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}}))}))},a.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},a.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)},a.className="Adam",a}(xd);cd(Cd);var Ed=function(t){function a(e,n,r,a,i){void 0===a&&(a=null),void 0===i&&(i=0);var s=t.call(this)||this;return s.learningRate=e,s.beta1=n,s.beta2=r,s.epsilon=a,s.decay=i,s.accumulatedFirstMoment=[],s.accumulatedWeightedInfNorm=[],Ze((function(){s.iteration=On(0).variable(),s.accBeta1=On(n).variable()})),null==a&&(s.epsilon=Lt.backend.epsilon()),s}return e(a,t),a.prototype.applyGradients=function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);Ze((function(){var r=Cc(1,t.accBeta1),a=sc(-t.learningRate,t.iteration.mul(t.decay).add(1));n.forEach((function(n,i){var s=Lt.registeredVariables[n];null==t.accumulatedFirstMoment[i]&&(t.accumulatedFirstMoment[i]={originalName:n+"/m",variable:Xn(s).variable(!1)}),null==t.accumulatedWeightedInfNorm[i]&&(t.accumulatedWeightedInfNorm[i]={originalName:n+"/v",variable:Xn(s).variable(!1)});var o=Array.isArray(e)?e[i].tensor:e[n];if(null!=o){var l=t.accumulatedFirstMoment[i].variable,u=t.accumulatedWeightedInfNorm[i].variable,c=l.mul(t.beta1).add(o.mul(1-t.beta1)),h=u.mul(t.beta2),d=o.abs(),p=h.maximum(d);l.assign(c),u.assign(p);var f=a.div(r).mul(c.div(p.add(t.epsilon))).add(s);s.assign(f)}})),t.iteration.assign(t.iteration.add(1)),t.accBeta1.assign(t.accBeta1.mul(t.beta1))})),this.incrementIterations()},a.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&tn(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedWeightedInfNorm&&tn(this.accumulatedWeightedInfNorm.map((function(e){return e.variable})))},a.prototype.getWeights=function(){return n(this,void 0,void 0,(function(){return r(this,(function(e){throw new Error("getWeights() is not implemented for Adamax yet.")}))}))},a.prototype.setWeights=function(e){return n(this,void 0,void 0,(function(){return r(this,(function(e){throw new Error("setWeights() is not implemented for Adamax yet.")}))}))},a.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},a.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)},a.className="Adamax",a}(xd);cd(Ed);var Rd=function(t){function a(e){var n=t.call(this)||this;return n.learningRate=e,n.setLearningRate(e),n}return e(a,t),a.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var i=Lt.registeredVariables[n];Ze((function(){var e=t.c.mul(a).add(i);i.assign(e)}))}})),this.incrementIterations()},a.prototype.setLearningRate=function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=en(On(-e))},a.prototype.dispose=function(){this.c.dispose()},a.prototype.getWeights=function(){return n(this,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()]]}}))}))},a.prototype.setWeights=function(e){return n(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:if(0!==(e=t.sent()).length)throw new Error("SGD optimizer does not have settable weights.");return[2]}}))}))},a.prototype.getConfig=function(){return{learningRate:this.learningRate}},a.fromConfig=function(e,t){return new e(t.learningRate)},a.className="SGD",a}(xd);cd(Rd);var Id=function(t){function a(e,n,r){void 0===r&&(r=!1);var a=t.call(this,e)||this;return a.learningRate=e,a.momentum=n,a.useNesterov=r,a.accumulations=[],a.m=On(a.momentum),a}return e(a,t),a.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Lt.registeredVariables[n];null==t.accumulations[r]&&(t.accumulations[r]={originalName:n+"/momentum",variable:Ze((function(){return Xn(a).variable(!1)}))});var i=t.accumulations[r].variable,s=Array.isArray(e)?e[r].tensor:e[n];null!=s&&Ze((function(){var e,n=t.m.mul(i).add(s);e=t.useNesterov?t.c.mul(s.add(n.mul(t.m))).add(a):t.c.mul(n).add(a),i.assign(n),a.assign(e)}))})),this.incrementIterations()},a.prototype.dispose=function(){this.m.dispose(),null!=this.accumulations&&tn(this.accumulations.map((function(e){return e.variable})))},a.prototype.setMomentum=function(e){this.momentum=e},a.prototype.getWeights=function(){return n(this,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulations.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},a.prototype.setWeights=function(e){return n(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:return e=t.sent(),this.accumulations=e.map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}}))}))},a.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},a.fromConfig=function(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)},a.className="Momentum",a}(Rd);cd(Id);var kd=function(t){function a(e,n,r,a,i){void 0===n&&(n=.9),void 0===r&&(r=0),void 0===a&&(a=null),void 0===i&&(i=!1);var s=t.call(this)||this;if(s.learningRate=e,s.decay=n,s.momentum=r,s.epsilon=a,s.accumulatedMeanSquares=[],s.accumulatedMoments=[],s.accumulatedMeanGrads=[],s.centered=i,null==a&&(s.epsilon=Lt.backend.epsilon()),null==e)throw new Error("learningRate for RMSPropOptimizer must be defined.");return s}return e(a,t),a.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Lt.registeredVariables[n];null==t.accumulatedMeanSquares[r]&&(t.accumulatedMeanSquares[r]={originalName:n+"/rms",variable:Ze((function(){return Xn(a).variable(!1)}))}),null==t.accumulatedMoments[r]&&(t.accumulatedMoments[r]={originalName:n+"/momentum",variable:Ze((function(){return Xn(a).variable(!1)}))}),null==t.accumulatedMeanGrads[r]&&t.centered&&(t.accumulatedMeanGrads[r]={originalName:n+"/mg",variable:Ze((function(){return Xn(a).variable(!1)}))});var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var s=t.accumulatedMeanSquares[r].variable,o=t.accumulatedMoments[r].variable;Ze((function(){var e=s.mul(t.decay).add(i.square().mul(1-t.decay));if(t.centered){var n=t.accumulatedMeanGrads[r].variable,l=n.mul(t.decay).add(i.mul(1-t.decay)),u=o.mul(t.momentum).add(i.mul(t.learningRate).div(e.sub(l.square().add(t.epsilon)).sqrt()));s.assign(e),n.assign(l),o.assign(u);var c=a.sub(u);a.assign(c)}else{var h=s.mul(t.decay).add(i.square().mul(1-t.decay));u=o.mul(t.momentum).add(i.mul(t.learningRate).div(h.add(t.epsilon).sqrt())),s.assign(h),o.assign(u),c=a.sub(u),a.assign(c)}}))}})),this.incrementIterations()},a.prototype.dispose=function(){null!=this.accumulatedMeanSquares&&tn(this.accumulatedMeanSquares.map((function(e){return e.variable}))),null!=this.accumulatedMeanGrads&&this.centered&&tn(this.accumulatedMeanGrads.map((function(e){return e.variable}))),null!=this.accumulatedMoments&&tn(this.accumulatedMoments.map((function(e){return e.variable})))},a.prototype.getWeights=function(){return n(this,void 0,void 0,(function(){var e;return r(this,(function(t){switch(t.label){case 0:return e=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&e.push.apply(e,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},a.prototype.setWeights=function(e){return n(this,void 0,void 0,(function(){var t;return r(this,(function(n){switch(n.label){case 0:return[4,this.extractIterations(e)];case 1:return e=n.sent(),t=this.centered?e.length/3:e.length/2,this.accumulatedMeanSquares=e.slice(0,t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.accumulatedMoments=e.slice(t,2*t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.centered&&(this.accumulatedMeanGrads=e.slice(2*t,3*t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}))),[2]}}))}))},a.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},a.fromConfig=function(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)},a.className="RMSProp",a}(xd);cd(kd),"undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate&&setImmediate,wt.prototype.squaredDifference=function(e){return nu(this,e)},xt=Gh;
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.
    
    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.
    
    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
var extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function __extends(e,t){function n(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var __assign=function(){return __assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},__assign.apply(this,arguments)};function __awaiter(e,t,n,r){return new(n||(n=Promise))((function(a,i){function s(e){try{l(r.next(e))}catch(t){i(t)}}function o(e){try{l(r.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}l((r=r.apply(e,t||[])).next())}))}function __generator(e,t){var n,r,a,i,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(i){return function(o){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(a=s.trys,(a=a.length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){s.label=i[1];break}if(6===i[0]&&s.label<a[1]){s.label=a[1],a=i;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(i);break}a[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(o){i=[6,o],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,o])}}}function __spreadArrays(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),a=0;for(t=0;t<n;t++)for(var i=arguments[t],s=0,o=i.length;s<o;s++,a++)r[a]=i[s];return r}var Dimensions=function(){function e(e,t){if(!isValidNumber(e)||!isValidNumber(t))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:e,height:t}));this._width=e,this._height=t}return Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),e.prototype.reverse=function(){return new e(1/this.width,1/this.height)},e}();function isTensor(e,t){return e instanceof wt&&e.shape.length===t}function isTensor2D(e){return isTensor(e,2)}function isTensor3D(e){return isTensor(e,3)}function isTensor4D(e){return isTensor(e,4)}function isFloat(e){return e%1!=0}function isEven$1(e){return e%2==0}function round$4(e,t){void 0===t&&(t=2);var n=Math.pow(10,t);return Math.floor(e*n)/n}function isDimensions(e){return e&&e.width&&e.height}function computeReshapedDimensions(e,t){var n=e.width,r=e.height,a=t/Math.max(r,n);return new Dimensions(Math.round(n*a),Math.round(r*a))}function getCenterPoint(e){return e.reduce((function(e,t){return e.add(t)}),new Point(0,0)).div(new Point(e.length,e.length))}function range$5(e,t,n){return Array(e).fill(0).map((function(e,r){return t+r*n}))}function isValidNumber(e){return!!e&&e!==1/0&&e!==-1/0&&!isNaN(e)||0===e}function isValidProbablitiy(e){return isValidNumber(e)&&0<=e&&e<=1}var Point=function(){function e(e,t){this._x=e,this._y=t}return Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.sub=function(t){return new e(this.x-t.x,this.y-t.y)},e.prototype.mul=function(t){return new e(this.x*t.x,this.y*t.y)},e.prototype.div=function(t){return new e(this.x/t.x,this.y/t.y)},e.prototype.abs=function(){return new e(Math.abs(this.x),Math.abs(this.y))},e.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},e.prototype.floor=function(){return new e(Math.floor(this.x),Math.floor(this.y))},e}(),Box=function(){function e(t,n){void 0===n&&(n=!0);var r=t||{},a=[r.left,r.top,r.right,r.bottom].every(isValidNumber),i=[r.x,r.y,r.width,r.height].every(isValidNumber);if(!i&&!a)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var s=i?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],o=s[0],l=s[1],u=s[2],c=s[3];e.assertIsValidBox({x:o,y:l,width:u,height:c},"Box.constructor",n),this._x=o,this._y=l,this._width=u,this._height=c}return e.isRect=function(e){return!!e&&[e.x,e.y,e.width,e.height].every(isValidNumber)},e.assertIsValidBox=function(t,n,r){if(void 0===r&&(r=!1),!e.isRect(t))throw new Error(n+" - invalid box: "+JSON.stringify(t)+", expected object with properties x, y, width, height");if(!r&&(t.width<0||t.height<0))throw new Error(n+" - width ("+t.width+") and height ("+t.height+") must be positive numbers")},Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topLeft",{get:function(){return new Point(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topRight",{get:function(){return new Point(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomLeft",{get:function(){return new Point(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomRight",{get:function(){return new Point(this.right,this.bottom)},enumerable:!0,configurable:!0}),e.prototype.round=function(){var t=[this.x,this.y,this.width,this.height].map((function(e){return Math.round(e)}));return new e({x:t[0],y:t[1],width:t[2],height:t[3]})},e.prototype.floor=function(){var t=[this.x,this.y,this.width,this.height].map((function(e){return Math.floor(e)}));return new e({x:t[0],y:t[1],width:t[2],height:t[3]})},e.prototype.toSquare=function(){var t=this,n=t.x,r=t.y,a=t.width,i=t.height,s=Math.abs(a-i);return a<i&&(n-=s/2,a+=s),i<a&&(r-=s/2,i+=s),new e({x:n,y:r,width:a,height:i})},e.prototype.rescale=function(t){var n=isDimensions(t)?t.width:t,r=isDimensions(t)?t.height:t;return new e({x:this.x*n,y:this.y*r,width:this.width*n,height:this.height*r})},e.prototype.pad=function(t,n){var r=[this.x-t/2,this.y-n/2,this.width+t,this.height+n];return new e({x:r[0],y:r[1],width:r[2],height:r[3]})},e.prototype.clipAtImageBorders=function(t,n){var r=this,a=r.x,i=r.y,s=r.right,o=r.bottom,l=Math.max(a,0),u=Math.max(i,0),c=s-l,h=o-u;return new e({x:l,y:u,width:Math.min(c,t-l),height:Math.min(h,n-u)}).floor()},e.prototype.shift=function(t,n){var r=this.width,a=this.height;return new e({x:this.x+t,y:this.y+n,width:r,height:a})},e.prototype.padAtBorders=function(e,t){var n=this.width+1,r=this.height+1,a=n,i=r,s=this.left,o=this.top,l=this.right,u=this.bottom;return l>t&&(a=-l+t+n,l=t),u>e&&(i=-u+e+r,u=e),s<1&&(i=2-s,s=1),o<1&&(i=2-o,o=1),{dy:1,edy:i,dx:1,edx:a,y:o,ey:u,x:s,ex:l,w:n,h:r}},e.prototype.calibrate=function(t){return new e({left:this.left+t.left*this.width,top:this.top+t.top*this.height,right:this.right+t.right*this.width,bottom:this.bottom+t.bottom*this.height}).toSquare().round()},e}(),BoundingBox=function(e){function t(t,n,r,a,i){return void 0===i&&(i=!1),e.call(this,{left:t,top:n,right:r,bottom:a},i)||this}return __extends(t,e),t}(Box),ObjectDetection=function(){function e(e,t,n,r,a){this._imageDims=new Dimensions(a.width,a.height),this._score=e,this._classScore=t,this._className=n,this._box=new Box(r).rescale(this._imageDims)}return Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativeBox",{get:function(){return new Box(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),e.prototype.forSize=function(t,n){return new e(this.score,this.classScore,this.className,this.relativeBox,{width:t,height:n})},e}(),FaceDetection=function(e){function t(t,n,r){return e.call(this,t,t,"",n,r)||this}return __extends(t,e),t.prototype.forSize=function(n,r){var a=e.prototype.forSize.call(this,n,r);return new t(a.score,a.relativeBox,a.imageDims)},t}(ObjectDetection);function iou(e,t,n){void 0===n&&(n=!0);var r=Math.max(0,Math.min(e.right,t.right)-Math.max(e.left,t.left))*Math.max(0,Math.min(e.bottom,t.bottom)-Math.max(e.top,t.top));return n?r/(e.area+t.area-r):r/Math.min(e.area,t.area)}function minBbox(e){var t=e.map((function(e){return e.x})),n=e.map((function(e){return e.y})),r=t.reduce((function(e,t){return t<e?t:e}),1/0),a=n.reduce((function(e,t){return t<e?t:e}),1/0),i=t.reduce((function(e,t){return e<t?t:e}),0),s=n.reduce((function(e,t){return e<t?t:e}),0);return new BoundingBox(r,a,i,s)}function nonMaxSuppression$2(e,t,n,r){void 0===r&&(r=!0);for(var a=t.map((function(e,t){return{score:e,boxIndex:t}})).sort((function(e,t){return e.score-t.score})).map((function(e){return e.boxIndex})),i=[],s=function(){var t=a.pop();i.push(t);for(var s=a,o=[],l=0;l<s.length;l++){var u=s[l],c=e[t],h=e[u];o.push(iou(c,h,r))}a=a.filter((function(e,t){return o[t]<=n}))};a.length>0;)s();return i}function normalize$1(e,t){return Ze((function(){var n=t[0],r=t[1],a=t[2],i=Hn(__spreadArrays(e.shape.slice(0,3),[1]),n),s=Hn(__spreadArrays(e.shape.slice(0,3),[1]),r),o=Hn(__spreadArrays(e.shape.slice(0,3),[1]),a),l=Yn([i,s,o],3);return Cc(e,l)}))}function padToSquare(e,t){return void 0===t&&(t=!1),Ze((function(){var n=e.shape.slice(1),r=n[0],a=n[1];if(r===a)return e;var i=Math.abs(r-a),s=Math.round(i*(t?.5:1)),o=r>a?2:1,l=function(t){var n=e.shape.slice();return n[o]=t,Hn(n,0)},u=l(s),c=i-u.shape[o],h=[t&&c?l(c):null,e,u].filter((function(e){return!!e})).map((function(e){return e.toFloat()}));return Yn(h,o)}))}function sigmoid$3(e){return 1/(1+Math.exp(-e))}var Rect=function(e){function t(t,n,r,a,i){return void 0===i&&(i=!1),e.call(this,{x:t,y:n,width:r,height:a},i)||this}return __extends(t,e),t}(Box),relX=.5,relY=.43,relScale=.45,FaceLandmarks=function(){function e(e,t,n){void 0===n&&(n=new Point(0,0));var r=t.width,a=t.height;this._imgDims=new Dimensions(r,a),this._shift=n,this._positions=e.map((function(e){return e.mul(new Point(r,a)).add(n)}))}return Object.defineProperty(e.prototype,"shift",{get:function(){return new Point(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativePositions",{get:function(){var e=this;return this._positions.map((function(t){return t.sub(e._shift).div(new Point(e.imageWidth,e.imageHeight))}))},enumerable:!0,configurable:!0}),e.prototype.forSize=function(e,t){return new this.constructor(this.relativePositions,{width:e,height:t})},e.prototype.shiftBy=function(e,t){return new this.constructor(this.relativePositions,this._imgDims,new Point(e,t))},e.prototype.shiftByPoint=function(e){return this.shiftBy(e.x,e.y)},e.prototype.align=function(e,t){if(void 0===t&&(t={}),e){var n=e instanceof FaceDetection?e.box.floor():new Box(e);return this.shiftBy(n.x,n.y).align(null,t)}var r=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},t),a=r.useDlibAlignment,i=r.minBoxPadding;return a?this.alignDlib():this.alignMinBbox(i)},e.prototype.alignDlib=function(){var e=this.getRefPointsForAlignment(),t=e[0],n=e[1],r=e[2],a=function(e){return r.sub(e).magnitude()},i=(a(t)+a(n))/2,s=Math.floor(i/relScale),o=getCenterPoint(e),l=Math.floor(Math.max(0,o.x-relX*s)),u=Math.floor(Math.max(0,o.y-relY*s));return new Rect(l,u,Math.min(s,this.imageWidth+l),Math.min(s,this.imageHeight+u))},e.prototype.alignMinBbox=function(e){var t=minBbox(this.positions);return t.pad(t.width*e,t.height*e)},e.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},e}(),FaceLandmarks5=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getRefPointsForAlignment=function(){var e=this.positions;return[e[0],e[1],getCenterPoint([e[3],e[4]])]},t}(FaceLandmarks),FaceLandmarks68=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getJawOutline=function(){return this.positions.slice(0,17)},t.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},t.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},t.prototype.getNose=function(){return this.positions.slice(27,36)},t.prototype.getLeftEye=function(){return this.positions.slice(36,42)},t.prototype.getRightEye=function(){return this.positions.slice(42,48)},t.prototype.getMouth=function(){return this.positions.slice(48,68)},t.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(getCenterPoint)},t}(FaceLandmarks),FaceMatch=function(){function e(e,t){this._label=e,this._distance=t}return Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),e.prototype.toString=function(e){return void 0===e&&(e=!0),this.label+(e?" ("+round$4(this.distance)+")":"")},e}(),LabeledBox=function(e){function t(t,n){var r=e.call(this,t)||this;return r._label=n,r}return __extends(t,e),t.assertIsValidLabeledBox=function(e,t){if(Box.assertIsValidBox(e,t),!isValidNumber(e.label))throw new Error(t+" - expected property label ("+e.label+") to be a number")},Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),t}(Box),LabeledFaceDescriptors=function(){function e(e,t){if("string"!=typeof e)throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(t)||t.some((function(e){return!(e instanceof Float32Array)})))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=e,this._descriptors=t}return Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),e.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map((function(e){return Array.from(e)}))}},e.fromJSON=function(t){var n=t.descriptors.map((function(e){return new Float32Array(e)}));return new e(t.label,n)},e}(),environment;function isWithFaceDetection(e){return e.detection instanceof FaceDetection}function extendWithFaceDetection(e,t){var n={detection:t};return Object.assign({},e,n)}function createBrowserEnv(){var e=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D:CanvasRenderingContext2D,Image:HTMLImageElement,ImageData:ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:e,readFile:function(){throw new Error("readFile - filesystem not available for browser environment")}}}function createFileSystem(e){var t="";if(!e)try{e=require("fs")}catch(n){t=n.toString()}return{readFile:e?function(t){return new Promise((function(n,r){e.readFile(t,(function(e,t){return e?r(e):n(t)}))}))}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+t)}}}function createNodejsEnv(){var e=global.Canvas||global.HTMLCanvasElement,t=global.Image||global.HTMLImageElement,n=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},r=createFileSystem();return __assign({Canvas:e||function(){},CanvasRenderingContext2D:global.CanvasRenderingContext2D||function(){},Image:t||function(){},ImageData:global.ImageData||function(){},Video:global.HTMLVideoElement||function(){},createCanvasElement:function(){if(e)return new e;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},createImageElement:function(){if(t)return new t;throw new Error("createImageElement - missing Image implementation for nodejs environment")},fetch:n},r)}function isBrowser$1(){return"object"==typeof window&&"undefined"!=typeof document&&"undefined"!=typeof HTMLImageElement&&"undefined"!=typeof HTMLCanvasElement&&"undefined"!=typeof HTMLVideoElement&&"undefined"!=typeof ImageData&&"undefined"!=typeof CanvasRenderingContext2D}function isNodejs(){return"object"==typeof global&&"function"==typeof require&&void 0!==module&&"undefined"!=typeof process&&!!process.version}function getEnv(){if(!environment)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return environment}function setEnv(e){environment=e}function initialize$1(){isBrowser$1()&&setEnv(createBrowserEnv()),isNodejs()&&setEnv(createNodejsEnv())}function monkeyPatch(e){if(environment||initialize$1(),!environment)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var t=e.Canvas,n=void 0===t?environment.Canvas:t,r=e.Image,a=void 0===r?environment.Image:r;environment.Canvas=n,environment.Image=a,environment.createCanvasElement=e.createCanvasElement||function(){return new n},environment.createImageElement=e.createImageElement||function(){return new a},environment.ImageData=e.ImageData||environment.ImageData,environment.Video=e.Video||environment.Video,environment.fetch=e.fetch||environment.fetch,environment.readFile=e.readFile||environment.readFile}!function(e){function t(t,n,r,a){var i=e.call(this,t,n)||this;return i._score=r,i._classScore=a,i}__extends(t,e),t.assertIsValidPredictedBox=function(e,t){if(LabeledBox.assertIsValidLabeledBox(e,t),!isValidProbablitiy(e.score)||!isValidProbablitiy(e.classScore))throw new Error(t+" - expected properties score ("+e.score+") and ("+e.classScore+") to be a number between [0, 1]")},Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0})}(LabeledBox);var env$1={getEnv:getEnv,setEnv:setEnv,initialize:initialize$1,createBrowserEnv:createBrowserEnv,createFileSystem:createFileSystem,createNodejsEnv:createNodejsEnv,monkeyPatch:monkeyPatch,isBrowser:isBrowser$1,isNodejs:isNodejs},AnchorPosition,AnchorPosition2;function resolveInput(e){return env$1.isNodejs()||"string"!=typeof e?e:document.getElementById(e)}function getContext2dOrThrow(e){var t=env$1.getEnv(),n=t.Canvas;if(e instanceof t.CanvasRenderingContext2D)return e;var r=resolveInput(e);if(!(r instanceof n))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var a=r.getContext("2d");if(!a)throw new Error("resolveContext2d - canvas 2d context is null");return a}function isMediaLoaded(e){var t=env$1.getEnv(),n=t.Image,r=t.Video;return e instanceof n&&e.complete||e instanceof r&&e.readyState>=3}function awaitMediaLoaded(e){return new Promise((function(t,n){if(e instanceof env$1.getEnv().Canvas||isMediaLoaded(e))return t();function r(e){e.currentTarget&&(e.currentTarget.removeEventListener("load",r),e.currentTarget.removeEventListener("error",a),t(e))}function a(e){e.currentTarget&&(e.currentTarget.removeEventListener("load",r),e.currentTarget.removeEventListener("error",a),n(e))}e.addEventListener("load",r),e.addEventListener("error",a)}))}function getMediaDimensions(e){var t=env$1.getEnv(),n=t.Image,r=t.Video;return e instanceof n?new Dimensions(e.naturalWidth,e.naturalHeight):e instanceof r?new Dimensions(e.videoWidth,e.videoHeight):new Dimensions(e.width,e.height)}function createCanvas$1(e){var t=e.width,n=e.height,r=(0,env$1.getEnv().createCanvasElement)();return r.width=t,r.height=n,r}function createCanvasFromMedia(e,t){var n=env$1.getEnv().ImageData;if(!(e instanceof n||isMediaLoaded(e)))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=t||getMediaDimensions(e),a=r.width,i=r.height,s=createCanvas$1({width:a,height:i});return e instanceof n?getContext2dOrThrow(s).putImageData(e,0,0):getContext2dOrThrow(s).drawImage(e,0,0,a,i),s}function imageTensorToCanvas(e,t){return __awaiter(this,void 0,void 0,(function(){var n,r,a,i,s,o;return __generator(this,(function(l){switch(l.label){case 0:return n=t||env$1.getEnv().createCanvasElement(),r=e.shape.slice(isTensor4D(e)?1:0),a=r[0],i=r[1],s=r[2],o=Ze((function(){return e.as3D(a,i,s).toInt()})),[4,id.toPixels(o,n)];case 1:return l.sent(),o.dispose(),[2,n]}}))}))}function isMediaElement(e){var t=env$1.getEnv(),n=t.Image,r=t.Canvas,a=t.Video;return e instanceof n||e instanceof r||e instanceof a}function imageToSquare(e,t,n){void 0===n&&(n=!1);var r=env$1.getEnv(),a=r.Image,i=r.Canvas;if(!(e instanceof a||e instanceof i))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var s=getMediaDimensions(e),o=t/Math.max(s.height,s.width),l=o*s.width,u=o*s.height,c=createCanvas$1({width:t,height:t}),h=e instanceof i?e:createCanvasFromMedia(e),d=Math.abs(l-u)/2,p=n&&l<u?d:0,f=n&&u<l?d:0;return getContext2dOrThrow(c).drawImage(h,p,f,l,u),c}initialize$1(),AnchorPosition2=AnchorPosition||(AnchorPosition={}),AnchorPosition2.TOP_LEFT="TOP_LEFT",AnchorPosition2.TOP_RIGHT="TOP_RIGHT",AnchorPosition2.BOTTOM_LEFT="BOTTOM_LEFT",AnchorPosition2.BOTTOM_RIGHT="BOTTOM_RIGHT";var NetInput=function(){function e(e,t){var n=this;if(void 0===t&&(t=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(e))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+e);this._treatAsBatchInput=t,this._batchSize=e.length,e.forEach((function(e,t){if(isTensor3D(e))return n._imageTensors[t]=e,void(n._inputDimensions[t]=e.shape);if(isTensor4D(e)){var r=e.shape[0];if(1!==r)throw new Error("NetInput - tf.Tensor4D with batchSize "+r+" passed, but not supported in input array");return n._imageTensors[t]=e,void(n._inputDimensions[t]=e.shape.slice(1))}var a=e instanceof env$1.getEnv().Canvas?e:createCanvasFromMedia(e);n._canvases[t]=a,n._inputDimensions[t]=[a.height,a.width,3]}))}return Object.defineProperty(e.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reshapedInputDimensions",{get:function(){var e=this;return range$5(this.batchSize,0,1).map((function(t,n){return e.getReshapedInputDimensions(n)}))},enumerable:!0,configurable:!0}),e.prototype.getInput=function(e){return this.canvases[e]||this.imageTensors[e]},e.prototype.getInputDimensions=function(e){return this._inputDimensions[e]},e.prototype.getInputHeight=function(e){return this._inputDimensions[e][0]},e.prototype.getInputWidth=function(e){return this._inputDimensions[e][1]},e.prototype.getReshapedInputDimensions=function(e){if("number"!=typeof this.inputSize)throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");return computeReshapedDimensions({width:this.getInputWidth(e),height:this.getInputHeight(e)},this.inputSize)},e.prototype.toBatchTensor=function(e,t){var n=this;return void 0===t&&(t=!0),this._inputSize=e,Ze((function(){var r=range$5(n.batchSize,0,1).map((function(r){var a=n.getInput(r);if(a instanceof wt){var i=isTensor4D(a)?a:a.expandDims();return(i=padToSquare(i,t)).shape[1]===e&&i.shape[2]===e||(i=Oh.resizeBilinear(i,[e,e])),i.as3D(e,e,3)}if(a instanceof env$1.getEnv().Canvas)return id.fromPixels(imageToSquare(a,e,t));throw new Error("toBatchTensor - at batchIdx "+r+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+a)})),a=Pr(r.map((function(e){return e.toFloat()}))).as4D(n.batchSize,e,e,3);return a}))},e}();function toNetInput(e){return __awaiter(this,void 0,void 0,(function(){var t,n,r;return __generator(this,(function(a){switch(a.label){case 0:if(e instanceof NetInput)return[2,e];if(!(t=Array.isArray(e)?e:[e]).length)throw new Error("toNetInput - empty array passed as input");return n=function(t){return Array.isArray(e)?" at input index "+t+":":""},(r=t.map(resolveInput)).forEach((function(e,r){if(!isMediaElement(e)&&!isTensor3D(e)&&!isTensor4D(e)){if("string"==typeof t[r])throw new Error("toNetInput -"+n(r)+" string passed, but could not resolve HTMLElement for element id "+t[r]);throw new Error("toNetInput -"+n(r)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id")}if(isTensor4D(e)){var a=e.shape[0];if(1!==a)throw new Error("toNetInput -"+n(r)+" tf.Tensor4D with batchSize "+a+" passed, but not supported in input array")}})),[4,Promise.all(r.map((function(e){return isMediaElement(e)&&awaitMediaLoaded(e)})))];case 1:return a.sent(),[2,new NetInput(r,Array.isArray(e))]}}))}))}function extractFaces(e,t){return __awaiter(this,void 0,void 0,(function(){var n,r,a,i,s,o;return __generator(this,(function(l){switch(l.label){case 0:return n=env$1.getEnv().Canvas,r=e,e instanceof n?[3,5]:[4,toNetInput(e)];case 1:if((a=l.sent()).batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return(i=a.getInput(0))instanceof n?(s=i,[3,4]):[3,2];case 2:return[4,imageTensorToCanvas(i)];case 3:s=l.sent(),l.label=4;case 4:r=s,l.label=5;case 5:return o=getContext2dOrThrow(r),[2,t.map((function(e){return e instanceof FaceDetection?e.forSize(r.width,r.height).box.floor():e})).map((function(e){return e.clipAtImageBorders(r.width,r.height)})).map((function(e){var t=e.x,n=e.y,r=e.width,a=e.height,i=createCanvas$1({width:r,height:a});return getContext2dOrThrow(i).putImageData(o.getImageData(t,n,r,a),0,0),i}))]}}))}))}function extractFaceTensors(e,t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){if(!isTensor3D(e)&&!isTensor4D(e))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(isTensor4D(e)&&e.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,Ze((function(){var n=e.shape.slice(isTensor4D(e)?1:0),r=n[0],a=n[1],i=n[2];return t.map((function(e){return e instanceof FaceDetection?e.forSize(a,r).box:e})).map((function(e){return e.clipAtImageBorders(a,r)})).map((function(t){var n=t.x,s=t.y,o=t.width,l=t.height;return xl(e.as3D(r,a,i),[s,n,0],[l,o,i])}))}))]}))}))}function fetchOrThrow(e,t){return __awaiter(this,void 0,void 0,(function(){var n;return __generator(this,(function(r){switch(r.label){case 0:return[4,(0,env$1.getEnv().fetch)(e,t)];case 1:if(!((n=r.sent()).status<400))throw new Error("failed to fetch: ("+n.status+") "+n.statusText+", from url: "+n.url);return[2,n]}}))}))}function fetchJson(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,fetchOrThrow(e)];case 1:return[2,t.sent().json()]}}))}))}function getModelUris(e,t){var n=t+"-weights_manifest.json";if(!e)return{modelBaseUri:"",manifestUri:n};if("/"===e)return{modelBaseUri:"/",manifestUri:"/"+n};var r=e.startsWith("http://")?"http://":e.startsWith("https://")?"https://":"",a=(e=e.replace(r,"")).split("/").filter((function(e){return e})),i=e.endsWith(".json")?a[a.length-1]:n,s=r+(e.endsWith(".json")?a.slice(0,a.length-1):a).join("/");return{modelBaseUri:s=e.startsWith("/")?"/"+s:s,manifestUri:"/"===s?"/"+i:s+"/"+i}}function loadWeightMap(e,t){return __awaiter(this,void 0,void 0,(function(){var n,r,a,i;return __generator(this,(function(s){switch(s.label){case 0:return n=getModelUris(e,t),r=n.manifestUri,a=n.modelBaseUri,[4,fetchJson(r)];case 1:return i=s.sent(),[2,ed.loadWeights(i,a)]}}))}))}var NeuralNetwork=function(){function e(e){this._name=e,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(e.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),e.prototype.getParamFromPath=function(e){var t=this.traversePropertyPath(e);return t.obj[t.objProp]},e.prototype.reassignParamFromPath=function(e,t){var n=this.traversePropertyPath(e),r=n.obj,a=n.objProp;r[a].dispose(),r[a]=t},e.prototype.getParamList=function(){var e=this;return this._paramMappings.map((function(t){var n=t.paramPath;return{path:n,tensor:e.getParamFromPath(n)}}))},e.prototype.getTrainableParams=function(){return this.getParamList().filter((function(e){return e.tensor instanceof St}))},e.prototype.getFrozenParams=function(){return this.getParamList().filter((function(e){return!(e.tensor instanceof St)}))},e.prototype.variable=function(){var e=this;this.getFrozenParams().forEach((function(t){var n=t.path,r=t.tensor;e.reassignParamFromPath(n,r.variable())}))},e.prototype.freeze=function(){var e=this;this.getTrainableParams().forEach((function(t){var n=t.path,r=t.tensor,a=Fn$1(r.dataSync());r.dispose(),e.reassignParamFromPath(n,a)}))},e.prototype.dispose=function(e){void 0===e&&(e=!0),this.getParamList().forEach((function(t){if(e&&t.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+t.path);t.tensor.dispose()})),this._params=void 0},e.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map((function(e){var t=e.tensor;return Array.from(t.dataSync())})).reduce((function(e,t){return e.concat(t)})))},e.prototype.load=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return e instanceof Float32Array?(this.extractWeights(e),[2]):[4,this.loadFromUri(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.loadFromUri=function(e){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(n){switch(n.label){case 0:if(e&&"string"!=typeof e)throw new Error(this._name+".loadFromUri - expected model uri");return[4,loadWeightMap(e,this.getDefaultModelName())];case 1:return t=n.sent(),this.loadFromWeightMap(t),[2]}}))}))},e.prototype.loadFromDisk=function(e){return __awaiter(this,void 0,void 0,(function(){var t,n,r,a,i,s,o,l,u,c;return __generator(this,(function(h){switch(h.label){case 0:if(e&&"string"!=typeof e)throw new Error(this._name+".loadFromDisk - expected model file path");return t=env$1.getEnv().readFile,n=getModelUris(e,this.getDefaultModelName()),r=n.manifestUri,a=n.modelBaseUri,i=function(e){return Promise.all(e.map((function(e){return t(e).then((function(e){return e.buffer}))})))},s=ed.weightsLoaderFactory(i),u=(l=JSON).parse,[4,t(r)];case 1:return o=u.apply(l,[h.sent().toString()]),[4,s(o,a)];case 2:return c=h.sent(),this.loadFromWeightMap(c),[2]}}))}))},e.prototype.loadFromWeightMap=function(e){var t=this.extractParamsFromWeigthMap(e),n=t.paramMappings,r=t.params;this._paramMappings=n,this._params=r},e.prototype.extractWeights=function(e){var t=this.extractParams(e),n=t.paramMappings,r=t.params;this._paramMappings=n,this._params=r},e.prototype.traversePropertyPath=function(e){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var t=e.split("/").reduce((function(t,n){if(!t.nextObj.hasOwnProperty(n))throw new Error("traversePropertyPath - object does not have property "+n+", for path "+e);return{obj:t.nextObj,objProp:n,nextObj:t.nextObj[n]}}),{nextObj:this.params}),n=t.obj,r=t.objProp;if(!(n&&r&&n[r]instanceof wt))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+e);return{obj:n,objProp:r}},e}();function depthwiseSeparableConv$1(e,t,n){return Ze((function(){var r=Jc(e,t.depthwise_filter,t.pointwise_filter,n,"same");return r=rc(r,t.bias)}))}function denseBlock3(e,t,n){return void 0===n&&(n=!1),Ze((function(){var r=Bl(n?rc(qc(e,t.conv0.filters,[2,2],"same"),t.conv0.bias):depthwiseSeparableConv$1(e,t.conv0,[2,2])),a=depthwiseSeparableConv$1(r,t.conv1,[1,1]),i=depthwiseSeparableConv$1(Bl(rc(r,a)),t.conv2,[1,1]);return Bl(rc(r,rc(a,i)))}))}function denseBlock4(e,t,n,r){return void 0===n&&(n=!1),void 0===r&&(r=!0),Ze((function(){var a=Bl(n?rc(qc(e,t.conv0.filters,r?[2,2]:[1,1],"same"),t.conv0.bias):depthwiseSeparableConv$1(e,t.conv0,r?[2,2]:[1,1])),i=depthwiseSeparableConv$1(a,t.conv1,[1,1]),s=depthwiseSeparableConv$1(Bl(rc(a,i)),t.conv2,[1,1]),o=depthwiseSeparableConv$1(Bl(rc(a,rc(i,s))),t.conv3,[1,1]);return Bl(rc(a,rc(i,rc(s,o))))}))}function convLayer$1(e,t,n,r){return void 0===n&&(n="same"),void 0===r&&(r=!1),Ze((function(){var a=rc(qc(e,t.filters,[1,1],n),t.bias);return r?Bl(a):a}))}function disposeUnusedWeightTensors(e,t){Object.keys(e).forEach((function(n){t.some((function(e){return e.originalPath===n}))||e[n].dispose()}))}function extractConvParamsFactory(e,t){return function(n,r,a,i){var s=Ln(e(n*r*a*a),[a,a,n,r]),o=Mn(e(r));return t.push({paramPath:i+"/filters"},{paramPath:i+"/bias"}),{filters:s,bias:o}}}function extractFCParamsFactory(e,t){return function(n,r,a){var i=Bn(e(n*r),[n,r]),s=Mn(e(r));return t.push({paramPath:a+"/weights"},{paramPath:a+"/bias"}),{weights:i,bias:s}}}var SeparableConvParams=function(e,t,n){this.depthwise_filter=e,this.pointwise_filter=t,this.bias=n};function extractSeparableConvParamsFactory(e,t){return function(n,r,a){var i=Ln(e(9*n),[3,3,n,1]),s=Ln(e(n*r),[1,1,n,r]),o=Mn(e(r));return t.push({paramPath:a+"/depthwise_filter"},{paramPath:a+"/pointwise_filter"},{paramPath:a+"/bias"}),new SeparableConvParams(i,s,o)}}function loadSeparableConvParamsFactory(e){return function(t){var n=e(t+"/depthwise_filter",4),r=e(t+"/pointwise_filter",4),a=e(t+"/bias",1);return new SeparableConvParams(n,r,a)}}function extractWeightEntryFactory(e,t){return function(n,r,a){var i=e[n];if(!isTensor(i,r))throw new Error("expected weightMap["+n+"] to be a Tensor"+r+"D, instead have "+i);return t.push({originalPath:n,paramPath:a||n}),i}}function extractWeightsFactory(e){var t=e;return{extractWeights:function(e){var n=t.slice(0,e);return t=t.slice(e),n},getRemainingWeights:function(){return t}}}function extractorsFactory$9(e,t){var n=extractConvParamsFactory(e,t),r=extractSeparableConvParamsFactory(e,t);function a(e,t,a,i){return void 0===i&&(i=!1),{conv0:i?n(e,t,3,a+"/conv0"):r(e,t,a+"/conv0"),conv1:r(t,t,a+"/conv1"),conv2:r(t,t,a+"/conv2")}}return{extractDenseBlock3Params:a,extractDenseBlock4Params:function(e,t,n,i){void 0===i&&(i=!1);var s=a(e,t,n,i);return{conv0:s.conv0,conv1:s.conv1,conv2:s.conv2,conv3:r(t,t,n+"/conv3")}}}}function extractParams$7(e){var t=[],n=extractWeightsFactory(e),r=n.extractWeights,a=n.getRemainingWeights,i=extractorsFactory$9(r,t).extractDenseBlock4Params,s=i(3,32,"dense0",!0),o=i(32,64,"dense1"),l=i(64,128,"dense2"),u=i(128,256,"dense3");if(0!==a().length)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:t,params:{dense0:s,dense1:o,dense2:l,dense3:u}}}function loadConvParamsFactory(e){return function(t){return{filters:e(t+"/filters",4),bias:e(t+"/bias",1)}}}function loadParamsFactory$1(e,t){var n=extractWeightEntryFactory(e,t),r=loadConvParamsFactory(n),a=loadSeparableConvParamsFactory(n);return{extractDenseBlock3Params:function(e,t){return void 0===t&&(t=!1),{conv0:t?r(e+"/conv0"):a(e+"/conv0"),conv1:a(e+"/conv1"),conv2:a(e+"/conv2")}},extractDenseBlock4Params:function(e,t){return void 0===t&&(t=!1),{conv0:t?r(e+"/conv0"):a(e+"/conv0"),conv1:a(e+"/conv1"),conv2:a(e+"/conv2"),conv3:a(e+"/conv3")}}}}function extractParamsFromWeigthMap$7(e){var t=[],n=loadParamsFactory$1(e,t).extractDenseBlock4Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2"),dense3:n("dense3")};return disposeUnusedWeightTensors(e,t),{params:r,paramMappings:t}}var FaceFeatureExtractor=function(e){function t(){return e.call(this,"FaceFeatureExtractor")||this}return __extends(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("FaceFeatureExtractor - load model before inference");return Ze((function(){var n=denseBlock4(normalize$1(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(On(255)),t.dense0,!0);return n=denseBlock4(n,t.dense1),n=denseBlock4(n,t.dense2),n=denseBlock4(n,t.dense3),n=fl(n,[7,7],[2,2],"valid")}))},t.prototype.forward=function(e){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,toNetInput(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},t.prototype.extractParamsFromWeigthMap=function(e){return extractParamsFromWeigthMap$7(e)},t.prototype.extractParams=function(e){return extractParams$7(e)},t}(NeuralNetwork);function fullyConnectedLayer(e,t){return Ze((function(){return rc(el(e,t.weights),t.bias)}))}function extractParams$6(e,t,n){var r=[],a=extractWeightsFactory(e),i=a.extractWeights,s=a.getRemainingWeights,o=extractFCParamsFactory(i,r)(t,n,"fc");if(0!==s().length)throw new Error("weights remaing after extract: "+s().length);return{paramMappings:r,params:{fc:o}}}function extractParamsFromWeigthMap$6(e){var t=[],n=extractWeightEntryFactory(e,t);var r,a={fc:(r="fc",{weights:n(r+"/weights",2),bias:n(r+"/bias",1)})};return disposeUnusedWeightTensors(e,t),{params:a,paramMappings:t}}function seperateWeightMaps(e){var t={},n={};return Object.keys(e).forEach((function(r){(r.startsWith("fc")?n:t)[r]=e[r]})),{featureExtractorMap:t,classifierMap:n}}var FaceProcessor=function(e){function t(t,n){var r=e.call(this,t)||this;return r._faceFeatureExtractor=n,r}return __extends(t,e),Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(e){var t=this,n=this.params;if(!n)throw new Error(this._name+" - load model before inference");return Ze((function(){var r=e instanceof NetInput?t.faceFeatureExtractor.forwardInput(e):e;return fullyConnectedLayer(r.as2D(r.shape[0],-1),n.fc)}))},t.prototype.dispose=function(t){void 0===t&&(t=!0),this.faceFeatureExtractor.dispose(t),e.prototype.dispose.call(this,t)},t.prototype.loadClassifierParams=function(e){var t=this.extractClassifierParams(e),n=t.params,r=t.paramMappings;this._params=n,this._paramMappings=r},t.prototype.extractClassifierParams=function(e){return extractParams$6(e,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},t.prototype.extractParamsFromWeigthMap=function(e){var t=seperateWeightMaps(e),n=t.featureExtractorMap,r=t.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(n),extractParamsFromWeigthMap$6(r)},t.prototype.extractParams=function(e){var t=this.getClassifierChannelsIn(),n=this.getClassifierChannelsOut(),r=n*t+n,a=e.slice(0,e.length-r),i=e.slice(e.length-r);return this.faceFeatureExtractor.extractWeights(a),this.extractClassifierParams(i)},t}(NeuralNetwork),FACE_EXPRESSION_LABELS=["neutral","happy","sad","angry","fearful","disgusted","surprised"],FaceExpressions=function(){function e(e){var t=this;if(7!==e.length)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+e.length);FACE_EXPRESSION_LABELS.forEach((function(n,r){t[n]=e[r]}))}return e.prototype.asSortedArray=function(){var e=this;return FACE_EXPRESSION_LABELS.map((function(t){return{expression:t,probability:e[t]}})).sort((function(e,t){return t.probability-e.probability}))},e}(),FaceExpressionNet=function(e){function t(t){return void 0===t&&(t=new FaceFeatureExtractor),e.call(this,"FaceExpressionNet",t)||this}return __extends(t,e),t.prototype.forwardInput=function(e){var t=this;return Ze((function(){return go(t.runNet(e))}))},t.prototype.forward=function(e){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,toNetInput(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.predictExpressions=function(e){return __awaiter(this,void 0,void 0,(function(){var t,n,r,a,i=this;return __generator(this,(function(s){switch(s.label){case 0:return[4,toNetInput(e)];case 1:return t=s.sent(),[4,this.forwardInput(t)];case 2:return n=s.sent(),[4,Promise.all(Ur(n).map((function(e){return __awaiter(i,void 0,void 0,(function(){var t;return __generator(this,(function(n){switch(n.label){case 0:return[4,e.data()];case 1:return t=n.sent(),e.dispose(),[2,t]}}))}))})))];case 3:return r=s.sent(),n.dispose(),a=r.map((function(e){return new FaceExpressions(e)})),[2,t.isBatchInput?a:a[0]]}}))}))},t.prototype.getDefaultModelName=function(){return"face_expression_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t.prototype.getClassifierChannelsOut=function(){return 7},t}(FaceProcessor);function extendWithFaceExpressions(e,t){var n={expressions:t};return Object.assign({},e,n)}function isWithFaceLandmarks(e){return isWithFaceDetection(e)&&e.landmarks instanceof FaceLandmarks&&e.unshiftedLandmarks instanceof FaceLandmarks&&e.alignedRect instanceof FaceDetection}function extendWithFaceLandmarks(e,t){var n=e.detection.box,r=t.shiftBy(n.x,n.y),a=r.align(),i=e.detection.imageDims,s={landmarks:r,unshiftedLandmarks:t,alignedRect:new FaceDetection(e.detection.score,a.rescale(i.reverse()),i)};return Object.assign({},e,s)}function extractorsFactory$8(e,t){var n=extractConvParamsFactory(e,t),r=extractSeparableConvParamsFactory(e,t);return{extractConvParams:n,extractSeparableConvParams:r,extractReductionBlockParams:function(e,t,a){return{separable_conv0:r(e,t,a+"/separable_conv0"),separable_conv1:r(t,t,a+"/separable_conv1"),expansion_conv:n(e,t,1,a+"/expansion_conv")}},extractMainBlockParams:function(e,t){return{separable_conv0:r(e,e,t+"/separable_conv0"),separable_conv1:r(e,e,t+"/separable_conv1"),separable_conv2:r(e,e,t+"/separable_conv2")}}}}function extractParams$5(e,t){var n=[],r=extractWeightsFactory(e),a=r.extractWeights,i=r.getRemainingWeights,s=extractorsFactory$8(a,n),o=s.extractConvParams,l=s.extractSeparableConvParams,u=s.extractReductionBlockParams,c=s.extractMainBlockParams,h={conv_in:o(3,32,3,"entry_flow/conv_in"),reduction_block_0:u(32,64,"entry_flow/reduction_block_0"),reduction_block_1:u(64,128,"entry_flow/reduction_block_1")},d={};range$5(t,0,1).forEach((function(e){d["main_block_"+e]=c(128,"middle_flow/main_block_"+e)}));var p={reduction_block:u(128,256,"exit_flow/reduction_block"),separable_conv:l(256,512,"exit_flow/separable_conv")};if(0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:n,params:{entry_flow:h,middle_flow:d,exit_flow:p}}}function loadParamsFactory(e,t){var n=extractWeightEntryFactory(e,t),r=loadConvParamsFactory(n),a=loadSeparableConvParamsFactory(n);return{extractConvParams:r,extractSeparableConvParams:a,extractReductionBlockParams:function(e){return{separable_conv0:a(e+"/separable_conv0"),separable_conv1:a(e+"/separable_conv1"),expansion_conv:r(e+"/expansion_conv")}},extractMainBlockParams:function(e){return{separable_conv0:a(e+"/separable_conv0"),separable_conv1:a(e+"/separable_conv1"),separable_conv2:a(e+"/separable_conv2")}}}}function extractParamsFromWeigthMap$5(e,t){var n=[],r=loadParamsFactory(e,n),a=r.extractConvParams,i=r.extractSeparableConvParams,s=r.extractReductionBlockParams,o=r.extractMainBlockParams,l={conv_in:a("entry_flow/conv_in"),reduction_block_0:s("entry_flow/reduction_block_0"),reduction_block_1:s("entry_flow/reduction_block_1")},u={};range$5(t,0,1).forEach((function(e){u["main_block_"+e]=o("middle_flow/main_block_"+e)}));var c={reduction_block:s("exit_flow/reduction_block"),separable_conv:i("exit_flow/separable_conv")};return disposeUnusedWeightTensors(e,n),{params:{entry_flow:l,middle_flow:u,exit_flow:c},paramMappings:n}}function conv$1(e,t,n){return rc(qc(e,t.filters,n,"same"),t.bias)}function reductionBlock(e,t,n){void 0===n&&(n=!0);var r=n?Bl(e):e;return r=depthwiseSeparableConv$1(r,t.separable_conv0,[1,1]),r=depthwiseSeparableConv$1(Bl(r),t.separable_conv1,[1,1]),r=hl(r,[3,3],[2,2],"same"),r=rc(r,conv$1(e,t.expansion_conv,[2,2]))}function mainBlock(e,t){var n=depthwiseSeparableConv$1(Bl(e),t.separable_conv0,[1,1]);return n=depthwiseSeparableConv$1(Bl(n),t.separable_conv1,[1,1]),n=depthwiseSeparableConv$1(Bl(n),t.separable_conv2,[1,1]),n=rc(n,e)}var TinyXception=function(e){function t(t){var n=e.call(this,"TinyXception")||this;return n._numMainBlocks=t,n}return __extends(t,e),t.prototype.forwardInput=function(e){var t=this,n=this.params;if(!n)throw new Error("TinyXception - load model before inference");return Ze((function(){var r=normalize$1(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(On(256)),a=Bl(conv$1(r,n.entry_flow.conv_in,[2,2]));return a=reductionBlock(a,n.entry_flow.reduction_block_0,!1),a=reductionBlock(a,n.entry_flow.reduction_block_1),range$5(t._numMainBlocks,0,1).forEach((function(e){a=mainBlock(a,n.middle_flow["main_block_"+e])})),a=reductionBlock(a,n.exit_flow.reduction_block),a=Bl(depthwiseSeparableConv$1(a,n.exit_flow.separable_conv,[1,1]))}))},t.prototype.forward=function(e){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,toNetInput(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.getDefaultModelName=function(){return"tiny_xception_model"},t.prototype.extractParamsFromWeigthMap=function(e){return extractParamsFromWeigthMap$5(e,this._numMainBlocks)},t.prototype.extractParams=function(e){return extractParams$5(e,this._numMainBlocks)},t}(NeuralNetwork),Gender,Gender2;function extractParams$4(e){var t=[],n=extractWeightsFactory(e),r=n.extractWeights,a=n.getRemainingWeights,i=extractFCParamsFactory(r,t),s=i(512,1,"fc/age"),o=i(512,2,"fc/gender");if(0!==a().length)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:t,params:{fc:{age:s,gender:o}}}}function extractParamsFromWeigthMap$4(e){var t=[],n=extractWeightEntryFactory(e,t);function r(e){return{weights:n(e+"/weights",2),bias:n(e+"/bias",1)}}var a={fc:{age:r("fc/age"),gender:r("fc/gender")}};return disposeUnusedWeightTensors(e,t),{params:a,paramMappings:t}}Gender2=Gender||(Gender={}),Gender2.FEMALE="female",Gender2.MALE="male";var AgeGenderNet=function(e){function t(t){void 0===t&&(t=new TinyXception(2));var n=e.call(this,"AgeGenderNet")||this;return n._faceFeatureExtractor=t,n}return __extends(t,e),Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(e){var t=this,n=this.params;if(!n)throw new Error(this._name+" - load model before inference");return Ze((function(){var r=e instanceof NetInput?t.faceFeatureExtractor.forwardInput(e):e,a=fl(r,[7,7],[2,2],"valid").as2D(r.shape[0],-1);return{age:fullyConnectedLayer(a,n.fc.age).as1D(),gender:fullyConnectedLayer(a,n.fc.gender)}}))},t.prototype.forwardInput=function(e){var t=this;return Ze((function(){var n=t.runNet(e),r=n.age,a=n.gender;return{age:r,gender:go(a)}}))},t.prototype.forward=function(e){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,toNetInput(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.predictAgeAndGender=function(e){return __awaiter(this,void 0,void 0,(function(){var t,n,r,a,i,s,o=this;return __generator(this,(function(l){switch(l.label){case 0:return[4,toNetInput(e)];case 1:return t=l.sent(),[4,this.forwardInput(t)];case 2:return n=l.sent(),r=Ur(n.age),a=Ur(n.gender),i=r.map((function(e,t){return{ageTensor:e,genderTensor:a[t]}})),[4,Promise.all(i.map((function(e){var t=e.ageTensor,n=e.genderTensor;return __awaiter(o,void 0,void 0,(function(){var e,r,a,i,s;return __generator(this,(function(o){switch(o.label){case 0:return[4,t.data()];case 1:return e=o.sent()[0],[4,n.data()];case 2:return r=o.sent()[0],i=(a=r>.5)?Gender.MALE:Gender.FEMALE,s=a?r:1-r,t.dispose(),n.dispose(),[2,{age:e,gender:i,genderProbability:s}]}}))}))})))];case 3:return s=l.sent(),n.age.dispose(),n.gender.dispose(),[2,t.isBatchInput?s:s[0]]}}))}))},t.prototype.getDefaultModelName=function(){return"age_gender_model"},t.prototype.dispose=function(t){void 0===t&&(t=!0),this.faceFeatureExtractor.dispose(t),e.prototype.dispose.call(this,t)},t.prototype.loadClassifierParams=function(e){var t=this.extractClassifierParams(e),n=t.params,r=t.paramMappings;this._params=n,this._paramMappings=r},t.prototype.extractClassifierParams=function(e){return extractParams$4(e)},t.prototype.extractParamsFromWeigthMap=function(e){var t=seperateWeightMaps(e),n=t.featureExtractorMap,r=t.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(n),extractParamsFromWeigthMap$4(r)},t.prototype.extractParams=function(e){var t=e.slice(0,e.length-1539),n=e.slice(e.length-1539);return this.faceFeatureExtractor.extractWeights(t),this.extractClassifierParams(n)},t}(NeuralNetwork),FaceLandmark68NetBase=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.postProcess=function(e,t,n){var r=n.map((function(e){var n=e.width,r=e.height,a=t/Math.max(r,n);return{width:n*a,height:r*a}})),a=r.length;return Ze((function(){var n=function(e,t){return Pr([Hn([68],e),Hn([68],t)],1).as2D(1,136).as1D()},i=function(e,t){var n=r[e],a=n.width,i=n.height;return t(a,i)?Math.abs(a-i)/2:0};return e.mul(Hn([a,136],t)).sub(Pr(Array.from(Array(a),(function(e,t){return n(function(e){return i(e,(function(e,t){return e<t}))}(t),function(e){return i(e,(function(e,t){return t<e}))}(t))})))).div(Pr(Array.from(Array(a),(function(e,t){return n(r[t].width,r[t].height)}))))}))},t.prototype.forwardInput=function(e){var t=this;return Ze((function(){var n=t.runNet(e);return t.postProcess(n,e.inputSize,e.inputDimensions.map((function(e){return{height:e[0],width:e[1]}})))}))},t.prototype.forward=function(e){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,toNetInput(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.detectLandmarks=function(e){return __awaiter(this,void 0,void 0,(function(){var t,n,r,a=this;return __generator(this,(function(i){switch(i.label){case 0:return[4,toNetInput(e)];case 1:return t=i.sent(),n=Ze((function(){return Ur(a.forwardInput(t))})),[4,Promise.all(n.map((function(e,n){return __awaiter(a,void 0,void 0,(function(){var r,a,i,s,o;return __generator(this,(function(l){switch(l.label){case 0:return i=(a=Array).from,[4,e.data()];case 1:return r=i.apply(a,[l.sent()]),s=r.filter((function(e,t){return isEven$1(t)})),o=r.filter((function(e,t){return!isEven$1(t)})),[2,new FaceLandmarks68(Array(68).fill(0).map((function(e,t){return new Point(s[t],o[t])})),{height:t.getInputHeight(n),width:t.getInputWidth(n)})]}}))}))})))];case 2:return r=i.sent(),n.forEach((function(e){return e.dispose()})),[2,t.isBatchInput?r:r[0]]}}))}))},t.prototype.getClassifierChannelsOut=function(){return 136},t}(FaceProcessor),FaceLandmark68Net=function(e){function t(t){return void 0===t&&(t=new FaceFeatureExtractor),e.call(this,"FaceLandmark68Net",t)||this}return __extends(t,e),t.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t}(FaceLandmark68NetBase);function extractParamsFromWeigthMapTiny(e){var t=[],n=loadParamsFactory$1(e,t).extractDenseBlock3Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2")};return disposeUnusedWeightTensors(e,t),{params:r,paramMappings:t}}function extractParamsTiny(e){var t=[],n=extractWeightsFactory(e),r=n.extractWeights,a=n.getRemainingWeights,i=extractorsFactory$9(r,t).extractDenseBlock3Params,s=i(3,32,"dense0",!0),o=i(32,64,"dense1"),l=i(64,128,"dense2");if(0!==a().length)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:t,params:{dense0:s,dense1:o,dense2:l}}}var TinyFaceFeatureExtractor=function(e){function t(){return e.call(this,"TinyFaceFeatureExtractor")||this}return __extends(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("TinyFaceFeatureExtractor - load model before inference");return Ze((function(){var n=denseBlock3(normalize$1(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(On(255)),t.dense0,!0);return n=denseBlock3(n,t.dense1),n=denseBlock3(n,t.dense2),n=fl(n,[14,14],[2,2],"valid")}))},t.prototype.forward=function(e){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,toNetInput(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},t.prototype.extractParamsFromWeigthMap=function(e){return extractParamsFromWeigthMapTiny(e)},t.prototype.extractParams=function(e){return extractParamsTiny(e)},t}(NeuralNetwork),FaceLandmark68TinyNet=function(e){function t(t){return void 0===t&&(t=new TinyFaceFeatureExtractor),e.call(this,"FaceLandmark68TinyNet",t)||this}return __extends(t,e),t.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},t.prototype.getClassifierChannelsIn=function(){return 128},t}(FaceLandmark68NetBase);function scale$1(e,t){return rc(gc(e,t.weights),t.biases)}function convLayer(e,t,n,r,a){void 0===a&&(a="same");var i=t.conv,s=i.filters,o=i.bias,l=qc(e,s,n,a);return l=scale$1(l=rc(l,o),t.scale),r?Bl(l):l}function conv(e,t){return convLayer(e,t,[1,1],!0)}function convNoRelu(e,t){return convLayer(e,t,[1,1],!1)}function convDown(e,t){return convLayer(e,t,[2,2],!0,"valid")}function extractorsFactory$7(e,t){function n(n,r,a,i){var s=function(t,n,r){var a=e(t),i=a.length/(n*r*r);if(isFloat(i))throw new Error("depth has to be an integer: "+i+", weights.length: "+a.length+", numFilters: "+n+", filterSize: "+r);return Ze((function(){return Wl(Ln(a,[n,i,r,r]),[2,3,1,0])}))}(n,r,a),o=Mn(e(r));return t.push({paramPath:i+"/filters"},{paramPath:i+"/bias"}),{filters:s,bias:o}}function r(r,a,i,s){var o=n(r,a,i,s+"/conv"),l=function(n,r){var a=Mn(e(n)),i=Mn(e(n));return t.push({paramPath:r+"/weights"},{paramPath:r+"/biases"}),{weights:a,biases:i}}(a,s+"/scale");return{conv:o,scale:l}}return{extractConvLayerParams:r,extractResidualLayerParams:function(e,t,n,a,i){return void 0===i&&(i=!1),{conv1:r((i?.5:1)*e,t,n,a+"/conv1"),conv2:r(e,t,n,a+"/conv2")}}}}function extractParams$3(e){var t=extractWeightsFactory(e),n=t.extractWeights,r=t.getRemainingWeights,a=[],i=extractorsFactory$7(n,a),s=i.extractConvLayerParams,o=i.extractResidualLayerParams,l=s(4704,32,7,"conv32_down"),u=o(9216,32,3,"conv32_1"),c=o(9216,32,3,"conv32_2"),h=o(9216,32,3,"conv32_3"),d=o(36864,64,3,"conv64_down",!0),p=o(36864,64,3,"conv64_1"),f=o(36864,64,3,"conv64_2"),m=o(36864,64,3,"conv64_3"),g=o(147456,128,3,"conv128_down",!0),y=o(147456,128,3,"conv128_1"),v=o(147456,128,3,"conv128_2"),b=o(589824,256,3,"conv256_down",!0),x=o(589824,256,3,"conv256_1"),T=o(589824,256,3,"conv256_2"),_=o(589824,256,3,"conv256_down_out"),w=Ze((function(){return Wl(Bn(n(32768),[128,256]),[1,0])}));if(a.push({paramPath:"fc"}),0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{conv32_down:l,conv32_1:u,conv32_2:c,conv32_3:h,conv64_down:d,conv64_1:p,conv64_2:f,conv64_3:m,conv128_down:g,conv128_1:y,conv128_2:v,conv256_down:b,conv256_1:x,conv256_2:T,conv256_down_out:_,fc:w},paramMappings:a}}function extractorsFactory$6(e,t){var n=extractWeightEntryFactory(e,t);function r(e){var t=n(e+"/conv/filters",4),r=n(e+"/conv/bias",1),a=function(e){return{weights:n(e+"/scale/weights",1),biases:n(e+"/scale/biases",1)}}(e);return{conv:{filters:t,bias:r},scale:a}}return{extractConvLayerParams:r,extractResidualLayerParams:function(e){return{conv1:r(e+"/conv1"),conv2:r(e+"/conv2")}}}}function extractParamsFromWeigthMap$3(e){var t=[],n=extractorsFactory$6(e,t),r=n.extractConvLayerParams,a=n.extractResidualLayerParams,i=r("conv32_down"),s=a("conv32_1"),o=a("conv32_2"),l=a("conv32_3"),u=a("conv64_down"),c=a("conv64_1"),h=a("conv64_2"),d=a("conv64_3"),p=a("conv128_down"),f=a("conv128_1"),m=a("conv128_2"),g=a("conv256_down"),y=a("conv256_1"),v=a("conv256_2"),b=a("conv256_down_out"),x=e.fc;if(t.push({originalPath:"fc",paramPath:"fc"}),!isTensor2D(x))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+x);var T={conv32_down:i,conv32_1:s,conv32_2:o,conv32_3:l,conv64_down:u,conv64_1:c,conv64_2:h,conv64_3:d,conv128_down:p,conv128_1:f,conv128_2:m,conv256_down:g,conv256_1:y,conv256_2:v,conv256_down_out:b,fc:x};return disposeUnusedWeightTensors(e,t),{params:T,paramMappings:t}}function residual(e,t){var n=conv(e,t.conv1);return n=convNoRelu(n,t.conv2),n=rc(n,e),n=Bl(n)}function residualDown(e,t){var n=convDown(e,t.conv1);n=convNoRelu(n,t.conv2);var r=fl(e,2,2,"valid"),a=Gn(r.shape),i=r.shape[3]!==n.shape[3];if(r.shape[1]!==n.shape[1]||r.shape[2]!==n.shape[2]){var s=__spreadArrays(n.shape);s[1]=1;var o=Gn(s),l=__spreadArrays((n=Yn([n,o],1)).shape);l[2]=1;var u=Gn(l);n=Yn([n,u],2)}return r=i?Yn([r,a],3):r,n=rc(r,n),n=Bl(n)}!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}__extends(t,e)}(FaceLandmark68Net);var FaceRecognitionNet=function(e){function t(){return e.call(this,"FaceRecognitionNet")||this}return __extends(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("FaceRecognitionNet - load model before inference");return Ze((function(){var n=convDown(normalize$1(e.toBatchTensor(150,!0).toFloat(),[122.782,117.001,104.298]).div(On(256)),t.conv32_down);n=residual(n=hl(n,3,2,"valid"),t.conv32_1),n=residual(n,t.conv32_2),n=residual(n,t.conv32_3),n=residual(n=residualDown(n,t.conv64_down),t.conv64_1),n=residual(n,t.conv64_2),n=residual(n,t.conv64_3),n=residual(n=residualDown(n,t.conv128_down),t.conv128_1),n=residual(n,t.conv128_2),n=residual(n=residualDown(n,t.conv256_down),t.conv256_1);var r=(n=residualDown(n=residual(n,t.conv256_2),t.conv256_down_out)).mean([1,2]);return el(r,t.fc)}))},t.prototype.forward=function(e){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,toNetInput(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.computeFaceDescriptor=function(e){return __awaiter(this,void 0,void 0,(function(){var t,n,r,a=this;return __generator(this,(function(i){switch(i.label){case 0:return[4,toNetInput(e)];case 1:return t=i.sent(),n=Ze((function(){return Ur(a.forwardInput(t))})),[4,Promise.all(n.map((function(e){return e.data()})))];case 2:return r=i.sent(),n.forEach((function(e){return e.dispose()})),[2,t.isBatchInput?r:r[0]]}}))}))},t.prototype.getDefaultModelName=function(){return"face_recognition_model"},t.prototype.extractParamsFromWeigthMap=function(e){return extractParamsFromWeigthMap$3(e)},t.prototype.extractParams=function(e){return extractParams$3(e)},t}(NeuralNetwork);function extendWithFaceDescriptor(e,t){var n={descriptor:t};return Object.assign({},e,n)}function extendWithAge(e,t){var n={age:t};return Object.assign({},e,n)}function extendWithGender(e,t,n){var r={gender:t,genderProbability:n};return Object.assign({},e,r)}var MtcnnOptions=function(){function e(e){var t=void 0===e?{}:e,n=t.minFaceSize,r=t.scaleFactor,a=t.maxNumScales,i=t.scoreThresholds,s=t.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=n||20,this._scaleFactor=r||.709,this._maxNumScales=a||10,this._scoreThresholds=i||[.6,.7,.7],this._scaleSteps=s,"number"!=typeof this._minFaceSize||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if("number"!=typeof this._scaleFactor||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if("number"!=typeof this._maxNumScales||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||3!==this._scoreThresholds.length||this._scoreThresholds.some((function(e){return"number"!=typeof e})))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some((function(e){return"number"!=typeof e}))))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(e.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),e}();function extractorsFactory$5(e,t){function n(n,r,a,i,s){var o=Ln(e(n*r*a*a),[a,a,n,r]),l=Mn(e(r));return t.push({paramPath:i+"/filters"},{paramPath:i+"/"+(s?"batch_norm_offset":"bias")}),{filters:o,bias:l}}function r(e,t,r,a){var i=n(e,t,r,a,!0);return{filters:i.filters,batch_norm_offset:i.bias}}function a(n,a,i){var s=function(n,r){var a=Ln(e(9*n),[3,3,n,1]),i=Mn(e(n)),s=Mn(e(n)),o=Mn(e(n)),l=Mn(e(n));return t.push({paramPath:r+"/filters"},{paramPath:r+"/batch_norm_scale"},{paramPath:r+"/batch_norm_offset"},{paramPath:r+"/batch_norm_mean"},{paramPath:r+"/batch_norm_variance"}),{filters:a,batch_norm_scale:i,batch_norm_offset:s,batch_norm_mean:o,batch_norm_variance:l}}(n,i+"/depthwise_conv");return{depthwise_conv:s,pointwise_conv:r(n,a,1,i+"/pointwise_conv")}}return{extractMobilenetV1Params:function(){return{conv_0:r(3,32,3,"mobilenetv1/conv_0"),conv_1:a(32,64,"mobilenetv1/conv_1"),conv_2:a(64,128,"mobilenetv1/conv_2"),conv_3:a(128,128,"mobilenetv1/conv_3"),conv_4:a(128,256,"mobilenetv1/conv_4"),conv_5:a(256,256,"mobilenetv1/conv_5"),conv_6:a(256,512,"mobilenetv1/conv_6"),conv_7:a(512,512,"mobilenetv1/conv_7"),conv_8:a(512,512,"mobilenetv1/conv_8"),conv_9:a(512,512,"mobilenetv1/conv_9"),conv_10:a(512,512,"mobilenetv1/conv_10"),conv_11:a(512,512,"mobilenetv1/conv_11"),conv_12:a(512,1024,"mobilenetv1/conv_12"),conv_13:a(1024,1024,"mobilenetv1/conv_13")}},extractPredictionLayerParams:function(){return{conv_0:r(1024,256,1,"prediction_layer/conv_0"),conv_1:r(256,512,3,"prediction_layer/conv_1"),conv_2:r(512,128,1,"prediction_layer/conv_2"),conv_3:r(128,256,3,"prediction_layer/conv_3"),conv_4:r(256,128,1,"prediction_layer/conv_4"),conv_5:r(128,256,3,"prediction_layer/conv_5"),conv_6:r(256,64,1,"prediction_layer/conv_6"),conv_7:r(64,128,3,"prediction_layer/conv_7"),box_predictor_0:{box_encoding_predictor:n(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),class_predictor:n(512,9,1,"prediction_layer/box_predictor_0/class_predictor")},box_predictor_1:{box_encoding_predictor:n(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),class_predictor:n(1024,18,1,"prediction_layer/box_predictor_1/class_predictor")},box_predictor_2:{box_encoding_predictor:n(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),class_predictor:n(512,18,1,"prediction_layer/box_predictor_2/class_predictor")},box_predictor_3:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_3/class_predictor")},box_predictor_4:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_4/class_predictor")},box_predictor_5:{box_encoding_predictor:n(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),class_predictor:n(128,18,1,"prediction_layer/box_predictor_5/class_predictor")}}}}}function extractParams$2(e){var t=[],n=extractWeightsFactory(e),r=n.extractWeights,a=n.getRemainingWeights,i=extractorsFactory$5(r,t),s=i.extractMobilenetV1Params,o=i.extractPredictionLayerParams,l=s(),u=o(),c={extra_dim:Pn(r(20472),[1,5118,4])};if(t.push({paramPath:"output_layer/extra_dim"}),0!==a().length)throw new Error("weights remaing after extract: "+a().length);return{params:{mobilenetv1:l,prediction_layer:u,output_layer:c},paramMappings:t}}function extractorsFactory$4(e,t){var n=extractWeightEntryFactory(e,t);function r(e,t,r){return{filters:n(e+"/Conv2d_"+t+"_pointwise/weights",4,r+"/filters"),batch_norm_offset:n(e+"/Conv2d_"+t+"_pointwise/convolution_bn_offset",1,r+"/batch_norm_offset")}}function a(e){var t="mobilenetv1/conv_"+e,a="MobilenetV1/Conv2d_"+e+"_depthwise",i=t+"/depthwise_conv",s=t+"/pointwise_conv";return{depthwise_conv:{filters:n(a+"/depthwise_weights",4,i+"/filters"),batch_norm_scale:n(a+"/BatchNorm/gamma",1,i+"/batch_norm_scale"),batch_norm_offset:n(a+"/BatchNorm/beta",1,i+"/batch_norm_offset"),batch_norm_mean:n(a+"/BatchNorm/moving_mean",1,i+"/batch_norm_mean"),batch_norm_variance:n(a+"/BatchNorm/moving_variance",1,i+"/batch_norm_variance")},pointwise_conv:r("MobilenetV1",e,s)}}function i(e,t){return{filters:n(e+"/weights",4,t+"/filters"),bias:n(e+"/biases",1,t+"/bias")}}function s(e){return{box_encoding_predictor:i("Prediction/BoxPredictor_"+e+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+e+"/box_encoding_predictor"),class_predictor:i("Prediction/BoxPredictor_"+e+"/ClassPredictor","prediction_layer/box_predictor_"+e+"/class_predictor")}}return{extractMobilenetV1Params:function(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:a(1),conv_2:a(2),conv_3:a(3),conv_4:a(4),conv_5:a(5),conv_6:a(6),conv_7:a(7),conv_8:a(8),conv_9:a(9),conv_10:a(10),conv_11:a(11),conv_12:a(12),conv_13:a(13)}},extractPredictionLayerParams:function(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:s(0),box_predictor_1:s(1),box_predictor_2:s(2),box_predictor_3:s(3),box_predictor_4:s(4),box_predictor_5:s(5)}}}}function extractParamsFromWeigthMap$2(e){var t=[],n=extractorsFactory$4(e,t),r=n.extractMobilenetV1Params,a=n.extractPredictionLayerParams,i=e["Output/extra_dim"];if(t.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!isTensor3D(i))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+i);var s={mobilenetv1:r(),prediction_layer:a(),output_layer:{extra_dim:i}};return disposeUnusedWeightTensors(e,t),{params:s,paramMappings:t}}function pointwiseConvLayer(e,t,n){return Ze((function(){var r=qc(e,t.filters,n,"same");return r=rc(r,t.batch_norm_offset),hu(r,0,6)}))}var epsilon$2=.0010000000474974513;function depthwiseConvLayer(e,t,n){return Ze((function(){var r=Yc(e,t.filters,n,"same");return r=ju(r,t.batch_norm_mean,t.batch_norm_variance,t.batch_norm_offset,t.batch_norm_scale,epsilon$2),hu(r,0,6)}))}function getStridesForLayerIdx(e){return[2,4,6,12].some((function(t){return t===e}))?[2,2]:[1,1]}function mobileNetV1(e,t){return Ze((function(){var n=null,r=pointwiseConvLayer(e,t.conv_0,[2,2]);if([t.conv_1,t.conv_2,t.conv_3,t.conv_4,t.conv_5,t.conv_6,t.conv_7,t.conv_8,t.conv_9,t.conv_10,t.conv_11,t.conv_12,t.conv_13].forEach((function(e,t){var a=t+1,i=getStridesForLayerIdx(a);r=pointwiseConvLayer(r=depthwiseConvLayer(r,e.depthwise_conv,i),e.pointwise_conv,[1,1]),11===a&&(n=r)})),null===n)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:n}}))}function nonMaxSuppression$1(e,t,n,r,a){var i=e.shape[0],s=Math.min(n,i),o=t.map((function(e,t){return{score:e,boxIndex:t}})).filter((function(e){return e.score>a})).sort((function(e,t){return t.score-e.score})),l=[];return o.forEach((function(t){if(!(l.length>=s)){for(var n=t.score,i=l.length-1;i>=0;--i){var o=IOU(e,t.boxIndex,l[i]);if(0!==o&&(t.score*=o<=r?1:0,t.score<=a))break}n===t.score&&l.push(t.boxIndex)}})),l}function IOU(e,t,n){var r=e.arraySync(),a=Math.min(r[t][0],r[t][2]),i=Math.min(r[t][1],r[t][3]),s=Math.max(r[t][0],r[t][2]),o=Math.max(r[t][1],r[t][3]),l=Math.min(r[n][0],r[n][2]),u=Math.min(r[n][1],r[n][3]),c=Math.max(r[n][0],r[n][2]),h=Math.max(r[n][1],r[n][3]),d=(s-a)*(o-i),p=(c-l)*(h-u);if(d<=0||p<=0)return 0;var f=Math.max(a,l),m=Math.max(i,u),g=Math.min(s,c),y=Math.min(o,h),v=Math.max(g-f,0)*Math.max(y-m,0);return v/(d+p-v)}function getCenterCoordinatesAndSizesLayer(e){var t=Ur(Wl(e,[1,0])),n=[Cc(t[2],t[0]),Cc(t[3],t[1])];return{sizes:n,centers:[rc(t[0],sc(n[0],On(2))),rc(t[1],sc(n[1],On(2)))]}}function decodeBoxesLayer(e,t){var n=getCenterCoordinatesAndSizesLayer(e),r=n.sizes,a=n.centers,i=Ur(Wl(t,[1,0])),s=sc(gc(vu(sc(i[2],On(5))),r[0]),On(2)),o=rc(gc(sc(i[0],On(10)),r[0]),a[0]),l=sc(gc(vu(sc(i[3],On(5))),r[1]),On(2)),u=rc(gc(sc(i[1],On(10)),r[1]),a[1]);return Wl(Pr([Cc(o,s),Cc(u,l),rc(o,s),rc(u,l)]),[1,0])}function outputLayer(e,t,n){return Ze((function(){var r=e.shape[0],a=decodeBoxesLayer(Or(Lr(n.extra_dim,[r,1,1]),[-1,4]),Or(e,[-1,4]));a=Or(a,[r,a.shape[0]/r,4]);var i=Iu(ml(t,[0,0,1],[-1,-1,-1])),s=ml(i,[0,0,0],[-1,-1,1]);return s=Or(s,[r,s.shape[1]]),{boxes:Ur(a),scores:Ur(s)}}))}function boxPredictionLayer(e,t){return Ze((function(){var n=e.shape[0];return{boxPredictionEncoding:Or(convLayer$1(e,t.box_encoding_predictor),[n,-1,1,4]),classPrediction:Or(convLayer$1(e,t.class_predictor),[n,-1,3])}}))}function predictionLayer(e,t,n){return Ze((function(){var r=pointwiseConvLayer(e,n.conv_0,[1,1]),a=pointwiseConvLayer(r,n.conv_1,[2,2]),i=pointwiseConvLayer(a,n.conv_2,[1,1]),s=pointwiseConvLayer(i,n.conv_3,[2,2]),o=pointwiseConvLayer(s,n.conv_4,[1,1]),l=pointwiseConvLayer(o,n.conv_5,[2,2]),u=pointwiseConvLayer(l,n.conv_6,[1,1]),c=pointwiseConvLayer(u,n.conv_7,[2,2]),h=boxPredictionLayer(t,n.box_predictor_0),d=boxPredictionLayer(e,n.box_predictor_1),p=boxPredictionLayer(a,n.box_predictor_2),f=boxPredictionLayer(s,n.box_predictor_3),m=boxPredictionLayer(l,n.box_predictor_4),g=boxPredictionLayer(c,n.box_predictor_5);return{boxPredictions:Yn([h.boxPredictionEncoding,d.boxPredictionEncoding,p.boxPredictionEncoding,f.boxPredictionEncoding,m.boxPredictionEncoding,g.boxPredictionEncoding],1),classPredictions:Yn([h.classPrediction,d.classPrediction,p.classPrediction,f.classPrediction,m.classPrediction,g.classPrediction],1)}}))}var SsdMobilenetv1Options=function(){function e(e){var t=void 0===e?{}:e,n=t.minConfidence,r=t.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=n||.5,this._maxResults=r||100,"number"!=typeof this._minConfidence||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if("number"!=typeof this._maxResults)throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(e.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),e}(),SsdMobilenetv1=function(e){function t(){return e.call(this,"SsdMobilenetv1")||this}return __extends(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("SsdMobilenetv1 - load model before inference");return Ze((function(){var n=e.toBatchTensor(512,!1).toFloat(),r=mobileNetV1(Cc(gc(n,On(.007843137718737125)),On(1)),t.mobilenetv1),a=predictionLayer(r.out,r.conv11,t.prediction_layer);return outputLayer(a.boxPredictions,a.classPredictions,t.output_layer)}))},t.prototype.forward=function(e){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,toNetInput(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.locateFaces=function(e,t){return void 0===t&&(t={}),__awaiter(this,void 0,void 0,(function(){var n,r,a,i,s,o,l,u,c,h,d,p,f,m,g,y,v,b,x,T;return __generator(this,(function(_){switch(_.label){case 0:return n=new SsdMobilenetv1Options(t),r=n.maxResults,a=n.minConfidence,[4,toNetInput(e)];case 1:for(i=_.sent(),s=this.forwardInput(i),o=s.boxes,l=s.scores,u=o[0],c=l[0],h=1;h<o.length;h++)o[h].dispose(),l[h].dispose();return f=(p=Array).from,[4,c.data()];case 2:return d=f.apply(p,[_.sent()]),.5,m=nonMaxSuppression$1(u,d,r,.5,a),g=i.getReshapedInputDimensions(0),y=i.inputSize,v=y/g.width,b=y/g.height,x=u.arraySync(),T=m.map((function(e){var t=[Math.max(0,x[e][0]),Math.min(1,x[e][2])].map((function(e){return e*b})),n=t[0],r=t[1],a=[Math.max(0,x[e][1]),Math.min(1,x[e][3])].map((function(e){return e*v})),s=a[0],o=a[1];return new FaceDetection(d[e],new Rect(s,n,o-s,r-n),{height:i.getInputHeight(0),width:i.getInputWidth(0)})})),u.dispose(),c.dispose(),[2,T]}}))}))},t.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},t.prototype.extractParamsFromWeigthMap=function(e){return extractParamsFromWeigthMap$2(e)},t.prototype.extractParams=function(e){return extractParams$2(e)},t}(NeuralNetwork);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}__extends(t,e)}(SsdMobilenetv1);var IOU_THRESHOLD$1=.4,BOX_ANCHORS$1=[new Point(.738768,.874946),new Point(2.42204,2.65704),new Point(4.30971,7.04493),new Point(10.246,4.59428),new Point(12.6868,11.8741)],BOX_ANCHORS_SEPARABLE=[new Point(1.603231,2.094468),new Point(6.041143,7.080126),new Point(2.882459,3.518061),new Point(4.266906,5.178857),new Point(9.041765,10.66308)],MEAN_RGB_SEPARABLE=[117.001,114.697,97.404],DEFAULT_MODEL_NAME$1="tiny_yolov2_model",DEFAULT_MODEL_NAME_SEPARABLE_CONV="tiny_yolov2_separable_conv_model",isNumber$1=function(e){return"number"==typeof e},TinyYolov2SizeType,TinyYolov2SizeType2;function validateConfig(e){if(!e)throw new Error("invalid config: "+e);if("boolean"!=typeof e.withSeparableConvs)throw new Error("config.withSeparableConvs has to be a boolean, have: "+e.withSeparableConvs);if(!isNumber$1(e.iouThreshold)||e.iouThreshold<0||e.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+e.iouThreshold);if(!Array.isArray(e.classes)||!e.classes.length||!e.classes.every((function(e){return"string"==typeof e})))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(e.classes));if(!Array.isArray(e.anchors)||!e.anchors.length||!e.anchors.map((function(e){return e||{}})).every((function(e){return isNumber$1(e.x)&&isNumber$1(e.y)})))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(e.anchors));if(e.meanRgb&&(!Array.isArray(e.meanRgb)||3!==e.meanRgb.length||!e.meanRgb.every(isNumber$1)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(e.meanRgb))}function leaky(e){return Ze((function(){var t=gc(e,On(.10000000149011612));return rc(Bl(Cc(e,t)),t)}))}function convWithBatchNorm(e,t){return Ze((function(){var n=Ir(e,[[0,0],[1,1],[1,1],[0,0]]);return n=qc(n,t.conv.filters,[1,1],"valid"),n=Cc(n,t.bn.sub),n=gc(n,t.bn.truediv),leaky(n=rc(n,t.conv.bias))}))}function depthwiseSeparableConv(e,t){return Ze((function(){var n=Ir(e,[[0,0],[1,1],[1,1],[0,0]]);return n=Jc(n,t.depthwise_filter,t.pointwise_filter,[1,1],"valid"),leaky(n=rc(n,t.bias))}))}function extractorsFactory$3(e,t){var n=extractConvParamsFactory(e,t);var r=extractSeparableConvParamsFactory(e,t);return{extractConvParams:n,extractConvWithBatchNormParams:function(r,a,i){var s=n(r,a,3,i+"/conv"),o=function(n,r){var a=Mn(e(n)),i=Mn(e(n));return t.push({paramPath:r+"/sub"},{paramPath:r+"/truediv"}),{sub:a,truediv:i}}(a,i+"/bn");return{conv:s,bn:o}},extractSeparableConvParams:r}}function extractParams$1(e,t,n,r){var a,i=extractWeightsFactory(e),s=i.extractWeights,o=i.getRemainingWeights,l=[],u=extractorsFactory$3(s,l),c=u.extractConvParams,h=u.extractConvWithBatchNormParams,d=u.extractSeparableConvParams;if(t.withSeparableConvs){var p=r[0],f=r[1],m=r[2],g=r[3],y=r[4],v=r[5],b=r[6],x=r[7],T=r[8];a={conv0:t.isFirstLayerConv2d?c(p,f,3,"conv0"):d(p,f,"conv0"),conv1:d(f,m,"conv1"),conv2:d(m,g,"conv2"),conv3:d(g,y,"conv3"),conv4:d(y,v,"conv4"),conv5:d(v,b,"conv5"),conv6:x?d(b,x,"conv6"):void 0,conv7:T?d(x,T,"conv7"):void 0,conv8:c(T||x||b,5*n,1,"conv8")}}else{p=r[0],f=r[1],m=r[2],g=r[3],y=r[4],v=r[5],b=r[6],x=r[7],T=r[8];a={conv0:h(p,f,"conv0"),conv1:h(f,m,"conv1"),conv2:h(m,g,"conv2"),conv3:h(g,y,"conv3"),conv4:h(y,v,"conv4"),conv5:h(v,b,"conv5"),conv6:h(b,x,"conv6"),conv7:h(x,T,"conv7"),conv8:c(T,5*n,1,"conv8")}}if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{params:a,paramMappings:l}}function extractorsFactory$2(e,t){var n=extractWeightEntryFactory(e,t);function r(e){return{filters:n(e+"/filters",4),bias:n(e+"/bias",1)}}return{extractConvParams:r,extractConvWithBatchNormParams:function(e){var t=r(e+"/conv"),a=function(e){return{sub:n(e+"/sub",1),truediv:n(e+"/truediv",1)}}(e+"/bn");return{conv:t,bn:a}},extractSeparableConvParams:loadSeparableConvParamsFactory(n)}}function extractParamsFromWeigthMap$1(e,t){var n,r=[],a=extractorsFactory$2(e,r),i=a.extractConvParams,s=a.extractConvWithBatchNormParams,o=a.extractSeparableConvParams;if(t.withSeparableConvs){var l=t.filterSizes&&t.filterSizes.length||9;n={conv0:t.isFirstLayerConv2d?i("conv0"):o("conv0"),conv1:o("conv1"),conv2:o("conv2"),conv3:o("conv3"),conv4:o("conv4"),conv5:o("conv5"),conv6:l>7?o("conv6"):void 0,conv7:l>8?o("conv7"):void 0,conv8:i("conv8")}}else n={conv0:s("conv0"),conv1:s("conv1"),conv2:s("conv2"),conv3:s("conv3"),conv4:s("conv4"),conv5:s("conv5"),conv6:s("conv6"),conv7:s("conv7"),conv8:i("conv8")};return disposeUnusedWeightTensors(e,r),{params:n,paramMappings:r}}TinyYolov2SizeType2=TinyYolov2SizeType||(TinyYolov2SizeType={}),TinyYolov2SizeType2[TinyYolov2SizeType2.XS=224]="XS",TinyYolov2SizeType2[TinyYolov2SizeType2.SM=320]="SM",TinyYolov2SizeType2[TinyYolov2SizeType2.MD=416]="MD",TinyYolov2SizeType2[TinyYolov2SizeType2.LG=608]="LG";var TinyYolov2Options=function(){function e(e){var t=void 0===e?{}:e,n=t.inputSize,r=t.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=n||416,this._scoreThreshold=r||.5,"number"!=typeof this._inputSize||this._inputSize%32!=0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if("number"!=typeof this._scoreThreshold||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),e}(),TinyYolov2Base=function(e){function t(t){var n=e.call(this,"TinyYolov2")||this;return validateConfig(t),n._config=t,n}return __extends(t,e),Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),t.prototype.runTinyYolov2=function(e,t){var n=convWithBatchNorm(e,t.conv0);return n=convWithBatchNorm(n=hl(n,[2,2],[2,2],"same"),t.conv1),n=convWithBatchNorm(n=hl(n,[2,2],[2,2],"same"),t.conv2),n=convWithBatchNorm(n=hl(n,[2,2],[2,2],"same"),t.conv3),n=convWithBatchNorm(n=hl(n,[2,2],[2,2],"same"),t.conv4),n=convWithBatchNorm(n=hl(n,[2,2],[2,2],"same"),t.conv5),n=convWithBatchNorm(n=hl(n,[2,2],[1,1],"same"),t.conv6),convLayer$1(n=convWithBatchNorm(n,t.conv7),t.conv8,"valid",!1)},t.prototype.runMobilenet=function(e,t){var n=this.config.isFirstLayerConv2d?leaky(convLayer$1(e,t.conv0,"valid",!1)):depthwiseSeparableConv(e,t.conv0);return n=depthwiseSeparableConv(n=hl(n,[2,2],[2,2],"same"),t.conv1),n=depthwiseSeparableConv(n=hl(n,[2,2],[2,2],"same"),t.conv2),n=depthwiseSeparableConv(n=hl(n,[2,2],[2,2],"same"),t.conv3),n=depthwiseSeparableConv(n=hl(n,[2,2],[2,2],"same"),t.conv4),n=depthwiseSeparableConv(n=hl(n,[2,2],[2,2],"same"),t.conv5),n=hl(n,[2,2],[1,1],"same"),n=t.conv6?depthwiseSeparableConv(n,t.conv6):n,convLayer$1(n=t.conv7?depthwiseSeparableConv(n,t.conv7):n,t.conv8,"valid",!1)},t.prototype.forwardInput=function(e,t){var n=this,r=this.params;if(!r)throw new Error("TinyYolov2 - load model before inference");return Ze((function(){var a=e.toBatchTensor(t,!1).toFloat();return a=(a=n.config.meanRgb?normalize$1(a,n.config.meanRgb):a).div(On(256)),n.config.withSeparableConvs?n.runMobilenet(a,r):n.runTinyYolov2(a,r)}))},t.prototype.forward=function(e,t){return __awaiter(this,void 0,void 0,(function(){var n;return __generator(this,(function(r){switch(r.label){case 0:return n=this.forwardInput,[4,toNetInput(e)];case 1:return[4,n.apply(this,[r.sent(),t])];case 2:return[2,r.sent()]}}))}))},t.prototype.detect=function(e,t){return void 0===t&&(t={}),__awaiter(this,void 0,void 0,(function(){var n,r,a,i,s,o,l,u,c,h,d,p,f,m=this;return __generator(this,(function(g){switch(g.label){case 0:return n=new TinyYolov2Options(t),r=n.inputSize,a=n.scoreThreshold,[4,toNetInput(e)];case 1:return i=g.sent(),[4,this.forwardInput(i,r)];case 2:return s=g.sent(),o=Ze((function(){return Ur(s)[0].expandDims()})),l={width:i.getInputWidth(0),height:i.getInputHeight(0)},[4,this.extractBoxes(o,i.getReshapedInputDimensions(0),a)];case 3:return u=g.sent(),s.dispose(),o.dispose(),c=u.map((function(e){return e.box})),h=u.map((function(e){return e.score})),d=u.map((function(e){return e.classScore})),p=u.map((function(e){return m.config.classes[e.label]})),f=nonMaxSuppression$2(c.map((function(e){return e.rescale(r)})),h,this.config.iouThreshold,!0),[2,f.map((function(e){return new ObjectDetection(h[e],d[e],p[e],c[e],l)}))]}}))}))},t.prototype.getDefaultModelName=function(){return""},t.prototype.extractParamsFromWeigthMap=function(e){return extractParamsFromWeigthMap$1(e,this.config)},t.prototype.extractParams=function(e){var n=this.config.filterSizes||t.DEFAULT_FILTER_SIZES,r=n?n.length:void 0;if(7!==r&&8!==r&&9!==r)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+r+" filterSizes in config");return extractParams$1(e,this.config,this.boxEncodingSize,n)},t.prototype.extractBoxes=function(e,t,n){return __awaiter(this,void 0,void 0,(function(){var r,a,i,s,o,l,u,c,h,d,p,f,m,g,y,v,b,x,T,_,w,S,C,E,k,I,A,N,$,D=this;return __generator(this,(function(P){switch(P.label){case 0:return r=t.width,a=t.height,i=Math.max(r,a),s=i/r,o=i/a,l=e.shape[1],u=this.config.anchors.length,c=Ze((function(){var t=e.reshape([l,l,u,D.boxEncodingSize]);return[t.slice([0,0,0,0],[l,l,u,4]),t.slice([0,0,0,4],[l,l,u,1]),D.withClassScores?go(t.slice([0,0,0,5],[l,l,u,D.config.classes.length]),3):On(0)]})),h=c[0],d=c[1],p=c[2],f=[],[4,d.array()];case 1:return m=P.sent(),[4,h.array()];case 2:g=P.sent(),y=0,P.label=3;case 3:if(!(y<l))return[3,12];v=0,P.label=4;case 4:if(!(v<l))return[3,11];b=0,P.label=5;case 5:return b<u?(x=sigmoid$3(m[y][v][b][0]),!n||x>n?(T=(v+sigmoid$3(g[y][v][b][0]))/l*s,_=(y+sigmoid$3(g[y][v][b][1]))/l*o,w=Math.exp(g[y][v][b][2])*this.config.anchors[b].x/l*s,S=Math.exp(g[y][v][b][3])*this.config.anchors[b].y/l*o,C=T-w/2,E=_-S/2,k={row:y,col:v,anchor:b},this.withClassScores?[4,this.extractPredictedClass(p,k)]:[3,7]):[3,9]):[3,10];case 6:return $=P.sent(),[3,8];case 7:$={classScore:1,label:0},P.label=8;case 8:A=(I=$).classScore,N=I.label,f.push(__assign({box:new BoundingBox(C,E,C+w,E+S),score:x,classScore:x*A,label:N},k)),P.label=9;case 9:return b++,[3,5];case 10:return v++,[3,4];case 11:return y++,[3,3];case 12:return h.dispose(),d.dispose(),p.dispose(),[2,f]}}))}))},t.prototype.extractPredictedClass=function(e,t){return __awaiter(this,void 0,void 0,(function(){var n,r,a,i;return __generator(this,(function(s){switch(s.label){case 0:return n=t.row,r=t.col,a=t.anchor,[4,e.array()];case 1:return i=s.sent(),[2,Array(this.config.classes.length).fill(0).map((function(e,t){return i[n][r][a][t]})).map((function(e,t){return{classScore:e,label:t}})).reduce((function(e,t){return e.classScore>t.classScore?e:t}))]}}))}))},t.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],t}(NeuralNetwork),TinyYolov2=function(e){function t(t){void 0===t&&(t=!0);var n=Object.assign({},{withSeparableConvs:t,iouThreshold:IOU_THRESHOLD$1,classes:["face"]},t?{anchors:BOX_ANCHORS_SEPARABLE,meanRgb:MEAN_RGB_SEPARABLE}:{anchors:BOX_ANCHORS$1,withClassScores:!0});return e.call(this,n)||this}return __extends(t,e),Object.defineProperty(t.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(e,t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){switch(n.label){case 0:return[4,this.detect(e,t)];case 1:return[2,n.sent().map((function(e){return new FaceDetection(e.score,e.relativeBox,{width:e.imageWidth,height:e.imageHeight})}))]}}))}))},t.prototype.getDefaultModelName=function(){return this.withSeparableConvs?DEFAULT_MODEL_NAME_SEPARABLE_CONV:DEFAULT_MODEL_NAME$1},t.prototype.extractParamsFromWeigthMap=function(t){return e.prototype.extractParamsFromWeigthMap.call(this,t)},t}(TinyYolov2Base),TinyFaceDetectorOptions=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._name="TinyFaceDetectorOptions",t}return __extends(t,e),t}(TinyYolov2Options),ComposableTask=function(){function e(){}return e.prototype.then=function(e){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(n){switch(n.label){case 0:return t=e,[4,this.run()];case 1:return[2,t.apply(void 0,[n.sent()])]}}))}))},e.prototype.run=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){throw new Error("ComposableTask - run is not implemented")}))}))},e}();function extractAllFacesAndComputeResults(e,t,n,r,a){return void 0===a&&(a=function(e){return e.alignedRect}),__awaiter(this,void 0,void 0,(function(){var i,s,o,l,u;return __generator(this,(function(c){switch(c.label){case 0:return i=e.map((function(e){return isWithFaceLandmarks(e)?a(e):e.detection})),(o=r)?[3,5]:t instanceof wt?[4,extractFaceTensors(t,i)]:[3,2];case 1:return l=c.sent(),[3,4];case 2:return[4,extractFaces(t,i)];case 3:l=c.sent(),c.label=4;case 4:o=l,c.label=5;case 5:return[4,n(s=o)];case 6:return u=c.sent(),s.forEach((function(e){return e instanceof wt&&e.dispose()})),[2,u]}}))}))}function extractSingleFaceAndComputeResult(e,t,n,r,a){return __awaiter(this,void 0,void 0,(function(){var i=this;return __generator(this,(function(s){return[2,extractAllFacesAndComputeResults([e],t,(function(e){return __awaiter(i,void 0,void 0,(function(){return __generator(this,(function(t){return[2,n(e[0])]}))}))}),r,a)]}))}))}function bgrToRgbTensor(e){return Ze((function(){return Pr(Ur(e,3).reverse(),3)}))}var CELL_STRIDE=2,CELL_SIZE=12;function extractorsFactory$1(e,t){var n=extractConvParamsFactory(e,t),r=extractFCParamsFactory(e,t);function a(n,r){var a=Mn(e(n));return t.push({paramPath:r}),a}function i(e,t,r){return void 0===r&&(r=!1),{conv1:n(e[0],e[1],3,t+"/conv1"),prelu1_alpha:a(e[1],t+"/prelu1_alpha"),conv2:n(e[1],e[2],3,t+"/conv2"),prelu2_alpha:a(e[2],t+"/prelu2_alpha"),conv3:n(e[2],e[3],r?2:3,t+"/conv3"),prelu3_alpha:a(e[3],t+"/prelu3_alpha")}}return{extractPNetParams:function(){var e=i([3,10,16,32],"pnet"),t=n(32,2,1,"pnet/conv4_1"),r=n(32,4,1,"pnet/conv4_2");return __assign(__assign({},e),{conv4_1:t,conv4_2:r})},extractRNetParams:function(){var e=i([3,28,48,64],"rnet",!0),t=r(576,128,"rnet/fc1"),n=a(128,"rnet/prelu4_alpha"),s=r(128,2,"rnet/fc2_1"),o=r(128,4,"rnet/fc2_2");return __assign(__assign({},e),{fc1:t,prelu4_alpha:n,fc2_1:s,fc2_2:o})},extractONetParams:function(){var e=i([3,32,64,64],"onet"),t=n(64,128,2,"onet/conv4"),s=a(128,"onet/prelu4_alpha"),o=r(1152,256,"onet/fc1"),l=a(256,"onet/prelu5_alpha"),u=r(256,2,"onet/fc2_1"),c=r(256,4,"onet/fc2_2"),h=r(256,10,"onet/fc2_3");return __assign(__assign({},e),{conv4:t,prelu4_alpha:s,fc1:o,prelu5_alpha:l,fc2_1:u,fc2_2:c,fc2_3:h})}}}function extractParams(e){var t=extractWeightsFactory(e),n=t.extractWeights,r=t.getRemainingWeights,a=[],i=extractorsFactory$1(n,a),s=i.extractPNetParams,o=i.extractRNetParams,l=i.extractONetParams,u=s(),c=o(),h=l();if(0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:u,rnet:c,onet:h},paramMappings:a}}function extractorsFactory(e,t){var n=extractWeightEntryFactory(e,t);function r(e){return{filters:n(e+"/weights",4,e+"/filters"),bias:n(e+"/bias",1)}}function a(e){return{weights:n(e+"/weights",2),bias:n(e+"/bias",1)}}function i(e){return n(e,1)}function s(e){return{conv1:r(e+"/conv1"),prelu1_alpha:i(e+"/prelu1_alpha"),conv2:r(e+"/conv2"),prelu2_alpha:i(e+"/prelu2_alpha"),conv3:r(e+"/conv3"),prelu3_alpha:i(e+"/prelu3_alpha")}}return{extractPNetParams:function(){var e=s("pnet"),t=r("pnet/conv4_1"),n=r("pnet/conv4_2");return __assign(__assign({},e),{conv4_1:t,conv4_2:n})},extractRNetParams:function(){var e=s("rnet"),t=a("rnet/fc1"),n=i("rnet/prelu4_alpha"),r=a("rnet/fc2_1"),o=a("rnet/fc2_2");return __assign(__assign({},e),{fc1:t,prelu4_alpha:n,fc2_1:r,fc2_2:o})},extractONetParams:function(){var e=s("onet"),t=r("onet/conv4"),n=i("onet/prelu4_alpha"),o=a("onet/fc1"),l=i("onet/prelu5_alpha"),u=a("onet/fc2_1"),c=a("onet/fc2_2"),h=a("onet/fc2_3");return __assign(__assign({},e),{conv4:t,prelu4_alpha:n,fc1:o,prelu5_alpha:l,fc2_1:u,fc2_2:c,fc2_3:h})}}}function extractParamsFromWeigthMap(e){var t=[],n=extractorsFactory(e,t),r=n.extractPNetParams,a=n.extractRNetParams,i=n.extractONetParams,s=r(),o=a(),l=i();return disposeUnusedWeightTensors(e,t),{params:{pnet:s,rnet:o,onet:l},paramMappings:t}}function getSizesForScale(e,t){var n=t[0],r=t[1];return{height:Math.floor(n*e),width:Math.floor(r*e)}}function pyramidDown(e,t,n){for(var r=n[0],a=n[1],i=CELL_SIZE/e,s=[],o=Math.min(r,a)*i,l=0;o>=12;)s.push(i*Math.pow(t,l)),o*=t,l+=1;return s}var MtcnnBox=function(e){function t(t,n,r,a){return e.call(this,{left:t,top:n,right:r,bottom:a},!0)||this}return __extends(t,e),t}(Box);function normalize(e){return Ze((function(){return gc(Cc(e,On(127.5)),On(.0078125))}))}function prelu$3(e,t){return Ze((function(){return rc(Bl(e),gc(t,wu(Bl(wu(e)))))}))}function sharedLayer(e,t,n){return void 0===n&&(n=!1),Ze((function(){var r=convLayer$1(e,t.conv1,"valid");return r=prelu$3(r,t.prelu1_alpha),r=prelu$3(r=convLayer$1(r=hl(r,n?[2,2]:[3,3],[2,2],"same"),t.conv2,"valid"),t.prelu2_alpha),r=prelu$3(r=convLayer$1(r=n?r:hl(r,[3,3],[2,2],"valid"),t.conv3,"valid"),t.prelu3_alpha)}))}function PNet(e,t){return Ze((function(){var n=sharedLayer(e,t,!0),r=convLayer$1(n,t.conv4_1,"valid"),a=wr(Sl(r,3),3);return{prob:go(Cc(r,a),3),regions:convLayer$1(n,t.conv4_2,"valid")}}))}function rescaleAndNormalize(e,t){return Ze((function(){var n=getSizesForScale(t,e.shape.slice(1)),r=n.height,a=n.width,i=normalize(Oh.resizeBilinear(e,[r,a]));return Wl(i,[0,2,1,3])}))}function extractBoundingBoxes(e,t,n,r){for(var a=[],i=e.arraySync(),s=0;s<e.shape[0];s++)for(var o=0;o<e.shape[1];o++)i[s][o]>=r&&a.push(new Point(o,s));return a.map((function(e){var r=new BoundingBox(Math.round((e.y*CELL_STRIDE+1)/n),Math.round((e.x*CELL_STRIDE+1)/n),Math.round((e.y*CELL_STRIDE+CELL_SIZE)/n),Math.round((e.x*CELL_STRIDE+CELL_SIZE)/n)),a=i[e.y][e.x],s=t.arraySync();return{cell:r,score:a,region:new MtcnnBox(s[e.y][e.x][0],s[e.y][e.x][1],s[e.y][e.x][2],s[e.y][e.x][3])}}))}function stage1(e,t,n,r,a){a.stage1=[];var i=t.map((function(t){return Ze((function(){var n={scale:t},a=rescaleAndNormalize(e,t),i=Date.now(),s=PNet(a,r),o=s.prob,l=s.regions;return n.pnet=Date.now()-i,{scoresTensor:Ur(Ur(o,3)[1])[0],regionsTensor:Ur(l)[0],scale:t,statsForScale:n}}))})).map((function(e){var t=e.scoresTensor,r=e.regionsTensor,i=e.scale,s=e.statsForScale,o=extractBoundingBoxes(t,r,i,n);if(t.dispose(),r.dispose(),!o.length)return a.stage1.push(s),[];var l=Date.now(),u=nonMaxSuppression$2(o.map((function(e){return e.cell})),o.map((function(e){return e.score})),.5);return s.nms=Date.now()-l,s.numBoxes=u.length,a.stage1.push(s),u.map((function(e){return o[e]}))})).reduce((function(e,t){return e.concat(t)}),[]),s=[],o=[];if(i.length>0){var l=Date.now(),u=nonMaxSuppression$2(i.map((function(e){return e.cell})),i.map((function(e){return e.score})),.7);a.stage1_nms=Date.now()-l,o=u.map((function(e){return i[e].score})),s=u.map((function(e){return i[e]})).map((function(e){var t=e.cell,n=e.region;return new BoundingBox(t.left+n.left*t.width,t.top+n.top*t.height,t.right+n.right*t.width,t.bottom+n.bottom*t.height).toSquare().round()}))}return{boxes:s,scores:o}}function extractImagePatches(e,t,n){var r=n.width,a=n.height;return __awaiter(this,void 0,void 0,(function(){var n,i,s,o=this;return __generator(this,(function(l){switch(l.label){case 0:return n=getContext2dOrThrow(e),[4,Promise.all(t.map((function(t){return __awaiter(o,void 0,void 0,(function(){var r,a,i,s,o,l,u,c;return __generator(this,(function(h){return r=t.padAtBorders(e.height,e.width),a=r.y,i=r.ey,s=r.x,o=r.ex,l=s-1,u=a-1,c=n.getImageData(l,u,o-l,i-u),[2,env$1.isNodejs()?createCanvasFromMedia(c):createImageBitmap(c)]}))}))})))];case 1:return i=l.sent(),s=[],i.forEach((function(e){var t=getContext2dOrThrow(createCanvas$1({width:r,height:a}));t.drawImage(e,0,0,r,a);for(var n=t.getImageData(0,0,r,a).data,i=[],o=0;o<n.length;o+=4)i.push(n[o+2]),i.push(n[o+1]),i.push(n[o]);s.push(i)})),[2,s.map((function(e){return Ze((function(){return normalize(Wl(Ln(e,[1,r,a,3]),[0,2,1,3]).toFloat())}))}))]}}))}))}function RNet(e,t){return Ze((function(){var n=sharedLayer(e,t),r=prelu$3(fullyConnectedLayer(Or(n,[n.shape[0],t.fc1.weights.shape[0]]),t.fc1),t.prelu4_alpha),a=fullyConnectedLayer(r,t.fc2_1),i=wr(Sl(a,1),1),s=go(Cc(a,i),1),o=fullyConnectedLayer(r,t.fc2_2);return{scores:Ur(s,1)[1],regions:o}}))}function stage2(e,t,n,r,a){return __awaiter(this,void 0,void 0,(function(){var i,s,o,l,u,c,h,d,p,f,m,g,y,v;return __generator(this,(function(b){switch(b.label){case 0:return i=Date.now(),[4,extractImagePatches(e,t,{width:24,height:24})];case 1:return s=b.sent(),a.stage2_extractImagePatches=Date.now()-i,i=Date.now(),o=s.map((function(e){var t=RNet(e,r);return e.dispose(),t})),a.stage2_rnet=Date.now()-i,l=o.length>1?Yn(o.map((function(e){return e.scores}))):o[0].scores,h=(c=Array).from,[4,l.data()];case 2:return u=h.apply(c,[b.sent()]),l.dispose(),d=u.map((function(e,t){return{score:e,idx:t}})).filter((function(e){return e.score>n})).map((function(e){return e.idx})),p=d.map((function(e){return t[e]})),f=d.map((function(e){return u[e]})),m=[],g=[],p.length>0&&(i=Date.now(),y=nonMaxSuppression$2(p,f,.7),a.stage2_nms=Date.now()-i,v=y.map((function(e){var t=o[d[e]].regions.arraySync();return new MtcnnBox(t[0][0],t[0][1],t[0][2],t[0][3])})),g=y.map((function(e){return f[e]})),m=y.map((function(e,t){return p[e].calibrate(v[t])}))),o.forEach((function(e){e.regions.dispose(),e.scores.dispose()})),[2,{boxes:m,scores:g}]}}))}))}function ONet(e,t){return Ze((function(){var n=sharedLayer(e,t);n=prelu$3(n=convLayer$1(n=hl(n,[2,2],[2,2],"same"),t.conv4,"valid"),t.prelu4_alpha);var r=prelu$3(fullyConnectedLayer(Or(n,[n.shape[0],t.fc1.weights.shape[0]]),t.fc1),t.prelu5_alpha),a=fullyConnectedLayer(r,t.fc2_1),i=wr(Sl(a,1),1),s=go(Cc(a,i),1),o=fullyConnectedLayer(r,t.fc2_2),l=fullyConnectedLayer(r,t.fc2_3);return{scores:Ur(s,1)[1],regions:o,points:l}}))}function stage3(e,t,n,r,a){return __awaiter(this,void 0,void 0,(function(){var i,s,o,l,u,c,h,d,p,f,m,g,y,v,b;return __generator(this,(function(x){switch(x.label){case 0:return i=Date.now(),[4,extractImagePatches(e,t,{width:48,height:48})];case 1:return s=x.sent(),a.stage3_extractImagePatches=Date.now()-i,i=Date.now(),o=s.map((function(e){var t=ONet(e,r);return e.dispose(),t})),a.stage3_onet=Date.now()-i,l=o.length>1?Yn(o.map((function(e){return e.scores}))):o[0].scores,h=(c=Array).from,[4,l.data()];case 2:return u=h.apply(c,[x.sent()]),l.dispose(),d=u.map((function(e,t){return{score:e,idx:t}})).filter((function(e){return e.score>n})).map((function(e){return e.idx})),p=d.map((function(e){var t=o[e].regions.arraySync();return new MtcnnBox(t[0][0],t[0][1],t[0][2],t[0][3])})),f=d.map((function(e,n){return t[e].calibrate(p[n])})),m=d.map((function(e){return u[e]})),g=[],y=[],v=[],f.length>0&&(i=Date.now(),b=nonMaxSuppression$2(f,m,.7,!1),a.stage3_nms=Date.now()-i,g=b.map((function(e){return f[e]})),y=b.map((function(e){return m[e]})),v=b.map((function(e,t){return Array(5).fill(0).map((function(n,r){var a=o[e].points.arraySync();return new Point(a[0][r]*(g[t].width+1)+g[t].left,a[0][r+5]*(g[t].height+1)+g[t].top)}))}))),o.forEach((function(e){e.regions.dispose(),e.scores.dispose(),e.points.dispose()})),[2,{boxes:g,scores:y,points:v}]}}))}))}var Mtcnn=function(e){function t(){return e.call(this,"Mtcnn")||this}return __extends(t,e),t.prototype.load=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){return console.warn("mtcnn is deprecated and will be removed soon"),[2,e.prototype.load.call(this,t)]}))}))},t.prototype.loadFromDisk=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){return console.warn("mtcnn is deprecated and will be removed soon"),[2,e.prototype.loadFromDisk.call(this,t)]}))}))},t.prototype.forwardInput=function(e,t){return void 0===t&&(t={}),__awaiter(this,void 0,void 0,(function(){var n,r,a,i,s,o,l,u,c,h,d,p,f,m,g,y,v,b,x,T,_;return __generator(this,(function(w){switch(w.label){case 0:if(!(n=this.params))throw new Error("Mtcnn - load model before inference");if(!(r=e.canvases[0]))throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return a={},i=Date.now(),s=Ze((function(){return bgrToRgbTensor(wr(id.fromPixels(r)).toFloat())})),o=function(e){return s.dispose(),a.total=Date.now()-i,e},l=s.shape.slice(1),u=l[0],c=l[1],h=new MtcnnOptions(t),d=h.minFaceSize,p=h.scaleFactor,f=h.maxNumScales,m=h.scoreThresholds,g=h.scaleSteps,y=(g||pyramidDown(d,p,[u,c])).filter((function(e){var t=getSizesForScale(e,[u,c]);return Math.min(t.width,t.height)>CELL_SIZE})).slice(0,f),a.scales=y,a.pyramid=y.map((function(e){return getSizesForScale(e,[u,c])})),v=Date.now(),[4,stage1(s,y,m[0],n.pnet,a)];case 1:return b=w.sent(),a.total_stage1=Date.now()-v,b.boxes.length?(a.stage2_numInputBoxes=b.boxes.length,v=Date.now(),[4,stage2(r,b.boxes,m[1],n.rnet,a)]):[2,o({results:[],stats:a})];case 2:return x=w.sent(),a.total_stage2=Date.now()-v,x.boxes.length?(a.stage3_numInputBoxes=x.boxes.length,v=Date.now(),[4,stage3(r,x.boxes,m[2],n.onet,a)]):[2,o({results:[],stats:a})];case 3:return T=w.sent(),a.total_stage3=Date.now()-v,_=T.boxes.map((function(e,t){return extendWithFaceLandmarks(extendWithFaceDetection({},new FaceDetection(T.scores[t],new Rect(e.left/c,e.top/u,e.width/c,e.height/u),{height:u,width:c})),new FaceLandmarks5(T.points[t].map((function(t){return t.sub(new Point(e.left,e.top)).div(new Point(e.width,e.height))})),{width:e.width,height:e.height}))})),[2,o({results:_,stats:a})]}}))}))},t.prototype.forward=function(e,t){return void 0===t&&(t={}),__awaiter(this,void 0,void 0,(function(){var n;return __generator(this,(function(r){switch(r.label){case 0:return n=this.forwardInput,[4,toNetInput(e)];case 1:return[4,n.apply(this,[r.sent(),t])];case 2:return[2,r.sent().results]}}))}))},t.prototype.forwardWithStats=function(e,t){return void 0===t&&(t={}),__awaiter(this,void 0,void 0,(function(){var n;return __generator(this,(function(r){switch(r.label){case 0:return n=this.forwardInput,[4,toNetInput(e)];case 1:return[2,n.apply(this,[r.sent(),t])]}}))}))},t.prototype.getDefaultModelName=function(){return"mtcnn_model"},t.prototype.extractParamsFromWeigthMap=function(e){return extractParamsFromWeigthMap(e)},t.prototype.extractParams=function(e){return extractParams(e)},t}(NeuralNetwork),IOU_THRESHOLD=.4,BOX_ANCHORS=[new Point(1.603231,2.094468),new Point(6.041143,7.080126),new Point(2.882459,3.518061),new Point(4.266906,5.178857),new Point(9.041765,10.66308)],MEAN_RGB=[117.001,114.697,97.404],TinyFaceDetector=function(e){function t(){var t={withSeparableConvs:!0,iouThreshold:IOU_THRESHOLD,classes:["face"],anchors:BOX_ANCHORS,meanRgb:MEAN_RGB,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return e.call(this,t)||this}return __extends(t,e),Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(e,t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){switch(n.label){case 0:return[4,this.detect(e,t)];case 1:return[2,n.sent().map((function(e){return new FaceDetection(e.score,e.relativeBox,{width:e.imageWidth,height:e.imageHeight})}))]}}))}))},t.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},t.prototype.extractParamsFromWeigthMap=function(t){return e.prototype.extractParamsFromWeigthMap.call(this,t)},t}(TinyYolov2Base),nets={ssdMobilenetv1:new SsdMobilenetv1,tinyFaceDetector:new TinyFaceDetector,tinyYolov2:new TinyYolov2,mtcnn:new Mtcnn,faceLandmark68Net:new FaceLandmark68Net,faceLandmark68TinyNet:new FaceLandmark68TinyNet,faceRecognitionNet:new FaceRecognitionNet,faceExpressionNet:new FaceExpressionNet,ageGenderNet:new AgeGenderNet},loadFaceLandmarkTinyModel=function(e){return nets.faceLandmark68TinyNet.load(e)},PredictFaceExpressionsTaskBase=function(e){function t(t,n,r){var a=e.call(this)||this;return a.parentTask=t,a.input=n,a.extractedFaces=r,a}return __extends(t,e),t}(ComposableTask),PredictAllFaceExpressionsTask=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.run=function(){return __awaiter(this,void 0,void 0,(function(){var e,t,n=this;return __generator(this,(function(r){switch(r.label){case 0:return[4,this.parentTask];case 1:return[4,extractAllFacesAndComputeResults(e=r.sent(),this.input,(function(e){return __awaiter(n,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,Promise.all(e.map((function(e){return nets.faceExpressionNet.predictExpressions(e)})))];case 1:return[2,t.sent()]}}))}))}),this.extractedFaces)];case 2:return t=r.sent(),[2,e.map((function(e,n){return extendWithFaceExpressions(e,t[n])}))]}}))}))},t.prototype.withAgeAndGender=function(){return new PredictAllAgeAndGenderTask(this,this.input)},t}(PredictFaceExpressionsTaskBase),PredictSingleFaceExpressionsTask=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.run=function(){return __awaiter(this,void 0,void 0,(function(){var e,t;return __generator(this,(function(n){switch(n.label){case 0:return[4,this.parentTask];case 1:return(e=n.sent())?[4,extractSingleFaceAndComputeResult(e,this.input,(function(e){return nets.faceExpressionNet.predictExpressions(e)}),this.extractedFaces)]:[2];case 2:return t=n.sent(),[2,extendWithFaceExpressions(e,t)]}}))}))},t.prototype.withAgeAndGender=function(){return new PredictSingleAgeAndGenderTask(this,this.input)},t}(PredictFaceExpressionsTaskBase),PredictAllFaceExpressionsWithFaceAlignmentTask=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.withAgeAndGender=function(){return new PredictAllAgeAndGenderWithFaceAlignmentTask(this,this.input)},t.prototype.withFaceDescriptors=function(){return new ComputeAllFaceDescriptorsTask(this,this.input)},t}(PredictAllFaceExpressionsTask),PredictSingleFaceExpressionsWithFaceAlignmentTask=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.withAgeAndGender=function(){return new PredictSingleAgeAndGenderWithFaceAlignmentTask(this,this.input)},t.prototype.withFaceDescriptor=function(){return new ComputeSingleFaceDescriptorTask(this,this.input)},t}(PredictSingleFaceExpressionsTask),PredictAgeAndGenderTaskBase=function(e){function t(t,n,r){var a=e.call(this)||this;return a.parentTask=t,a.input=n,a.extractedFaces=r,a}return __extends(t,e),t}(ComposableTask),PredictAllAgeAndGenderTask=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.run=function(){return __awaiter(this,void 0,void 0,(function(){var e,t,n=this;return __generator(this,(function(r){switch(r.label){case 0:return[4,this.parentTask];case 1:return[4,extractAllFacesAndComputeResults(e=r.sent(),this.input,(function(e){return __awaiter(n,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,Promise.all(e.map((function(e){return nets.ageGenderNet.predictAgeAndGender(e)})))];case 1:return[2,t.sent()]}}))}))}),this.extractedFaces)];case 2:return t=r.sent(),[2,e.map((function(e,n){var r=t[n],a=r.age;return extendWithAge(extendWithGender(e,r.gender,r.genderProbability),a)}))]}}))}))},t.prototype.withFaceExpressions=function(){return new PredictAllFaceExpressionsTask(this,this.input)},t}(PredictAgeAndGenderTaskBase),PredictSingleAgeAndGenderTask=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.run=function(){return __awaiter(this,void 0,void 0,(function(){var e,t,n,r,a;return __generator(this,(function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return(e=i.sent())?[4,extractSingleFaceAndComputeResult(e,this.input,(function(e){return nets.ageGenderNet.predictAgeAndGender(e)}),this.extractedFaces)]:[2];case 2:return t=i.sent(),n=t.age,r=t.gender,a=t.genderProbability,[2,extendWithAge(extendWithGender(e,r,a),n)]}}))}))},t.prototype.withFaceExpressions=function(){return new PredictSingleFaceExpressionsTask(this,this.input)},t}(PredictAgeAndGenderTaskBase),PredictAllAgeAndGenderWithFaceAlignmentTask=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.withFaceExpressions=function(){return new PredictAllFaceExpressionsWithFaceAlignmentTask(this,this.input)},t.prototype.withFaceDescriptors=function(){return new ComputeAllFaceDescriptorsTask(this,this.input)},t}(PredictAllAgeAndGenderTask),PredictSingleAgeAndGenderWithFaceAlignmentTask=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.withFaceExpressions=function(){return new PredictSingleFaceExpressionsWithFaceAlignmentTask(this,this.input)},t.prototype.withFaceDescriptor=function(){return new ComputeSingleFaceDescriptorTask(this,this.input)},t}(PredictSingleAgeAndGenderTask),ComputeFaceDescriptorsTaskBase=function(e){function t(t,n){var r=e.call(this)||this;return r.parentTask=t,r.input=n,r}return __extends(t,e),t}(ComposableTask),ComputeAllFaceDescriptorsTask=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.run=function(){return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return[4,this.parentTask];case 1:return[4,extractAllFacesAndComputeResults(e=t.sent(),this.input,(function(e){return Promise.all(e.map((function(e){return nets.faceRecognitionNet.computeFaceDescriptor(e)})))}),null,(function(e){return e.landmarks.align(null,{useDlibAlignment:!0})}))];case 2:return[2,t.sent().map((function(t,n){return extendWithFaceDescriptor(e[n],t)}))]}}))}))},t.prototype.withFaceExpressions=function(){return new PredictAllFaceExpressionsWithFaceAlignmentTask(this,this.input)},t.prototype.withAgeAndGender=function(){return new PredictAllAgeAndGenderWithFaceAlignmentTask(this,this.input)},t}(ComputeFaceDescriptorsTaskBase),ComputeSingleFaceDescriptorTask=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.run=function(){return __awaiter(this,void 0,void 0,(function(){var e,t;return __generator(this,(function(n){switch(n.label){case 0:return[4,this.parentTask];case 1:return(e=n.sent())?[4,extractSingleFaceAndComputeResult(e,this.input,(function(e){return nets.faceRecognitionNet.computeFaceDescriptor(e)}),null,(function(e){return e.landmarks.align(null,{useDlibAlignment:!0})}))]:[2];case 2:return t=n.sent(),[2,extendWithFaceDescriptor(e,t)]}}))}))},t.prototype.withFaceExpressions=function(){return new PredictSingleFaceExpressionsWithFaceAlignmentTask(this,this.input)},t.prototype.withAgeAndGender=function(){return new PredictSingleAgeAndGenderWithFaceAlignmentTask(this,this.input)},t}(ComputeFaceDescriptorsTaskBase),DetectFaceLandmarksTaskBase=function(e){function t(t,n,r){var a=e.call(this)||this;return a.parentTask=t,a.input=n,a.useTinyLandmarkNet=r,a}return __extends(t,e),Object.defineProperty(t.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?nets.faceLandmark68TinyNet:nets.faceLandmark68Net},enumerable:!0,configurable:!0}),t}(ComposableTask),DetectAllFaceLandmarksTask=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.run=function(){return __awaiter(this,void 0,void 0,(function(){var e,t,n,r,a,i=this;return __generator(this,(function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return e=s.sent(),t=e.map((function(e){return e.detection})),this.input instanceof wt?[4,extractFaceTensors(this.input,t)]:[3,3];case 2:return r=s.sent(),[3,5];case 3:return[4,extractFaces(this.input,t)];case 4:r=s.sent(),s.label=5;case 5:return n=r,[4,Promise.all(n.map((function(e){return i.landmarkNet.detectLandmarks(e)})))];case 6:return a=s.sent(),n.forEach((function(e){return e instanceof wt&&e.dispose()})),[2,e.map((function(e,t){return extendWithFaceLandmarks(e,a[t])}))]}}))}))},t.prototype.withFaceExpressions=function(){return new PredictAllFaceExpressionsWithFaceAlignmentTask(this,this.input)},t.prototype.withAgeAndGender=function(){return new PredictAllAgeAndGenderWithFaceAlignmentTask(this,this.input)},t.prototype.withFaceDescriptors=function(){return new ComputeAllFaceDescriptorsTask(this,this.input)},t}(DetectFaceLandmarksTaskBase),DetectSingleFaceLandmarksTask=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.run=function(){return __awaiter(this,void 0,void 0,(function(){var e,t,n,r,a;return __generator(this,(function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return(e=i.sent())?(t=e.detection,this.input instanceof wt?[4,extractFaceTensors(this.input,[t])]:[3,3]):[2];case 2:return r=i.sent(),[3,5];case 3:return[4,extractFaces(this.input,[t])];case 4:r=i.sent(),i.label=5;case 5:return n=r,[4,this.landmarkNet.detectLandmarks(n[0])];case 6:return a=i.sent(),n.forEach((function(e){return e instanceof wt&&e.dispose()})),[2,extendWithFaceLandmarks(e,a)]}}))}))},t.prototype.withFaceExpressions=function(){return new PredictSingleFaceExpressionsWithFaceAlignmentTask(this,this.input)},t.prototype.withAgeAndGender=function(){return new PredictSingleAgeAndGenderWithFaceAlignmentTask(this,this.input)},t.prototype.withFaceDescriptor=function(){return new ComputeSingleFaceDescriptorTask(this,this.input)},t}(DetectFaceLandmarksTaskBase),DetectFacesTaskBase=function(e){function t(t,n){void 0===n&&(n=new SsdMobilenetv1Options);var r=e.call(this)||this;return r.input=t,r.options=n,r}return __extends(t,e),t}(ComposableTask),DetectAllFacesTask=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.run=function(){return __awaiter(this,void 0,void 0,(function(){var e,t,n,r;return __generator(this,(function(a){switch(a.label){case 0:return t=(e=this).input,(n=e.options)instanceof MtcnnOptions?[4,nets.mtcnn.forward(t,n)]:[3,2];case 1:return[2,a.sent().map((function(e){return e.detection}))];case 2:if(!(r=n instanceof TinyFaceDetectorOptions?function(e){return nets.tinyFaceDetector.locateFaces(e,n)}:n instanceof SsdMobilenetv1Options?function(e){return nets.ssdMobilenetv1.locateFaces(e,n)}:n instanceof TinyYolov2Options?function(e){return nets.tinyYolov2.locateFaces(e,n)}:null))throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,r(t)]}}))}))},t.prototype.runAndExtendWithFaceDetections=function(){var e=this;return new Promise((function(t){return __awaiter(e,void 0,void 0,(function(){var e;return __generator(this,(function(n){switch(n.label){case 0:return[4,this.run()];case 1:return e=n.sent(),[2,t(e.map((function(e){return extendWithFaceDetection({},e)})))]}}))}))}))},t.prototype.withFaceLandmarks=function(e){return void 0===e&&(e=!1),new DetectAllFaceLandmarksTask(this.runAndExtendWithFaceDetections(),this.input,e)},t.prototype.withFaceExpressions=function(){return new PredictAllFaceExpressionsTask(this.runAndExtendWithFaceDetections(),this.input)},t.prototype.withAgeAndGender=function(){return new PredictAllAgeAndGenderTask(this.runAndExtendWithFaceDetections(),this.input)},t}(DetectFacesTaskBase),DetectSingleFaceTask=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.run=function(){return __awaiter(this,void 0,void 0,(function(){var e,t;return __generator(this,(function(n){switch(n.label){case 0:return[4,new DetectAllFacesTask(this.input,this.options)];case 1:return e=n.sent(),t=e[0],e.forEach((function(e){e.score>t.score&&(t=e)})),[2,t]}}))}))},t.prototype.runAndExtendWithFaceDetection=function(){var e=this;return new Promise((function(t){return __awaiter(e,void 0,void 0,(function(){var e;return __generator(this,(function(n){switch(n.label){case 0:return[4,this.run()];case 1:return e=n.sent(),[2,t(e?extendWithFaceDetection({},e):void 0)]}}))}))}))},t.prototype.withFaceLandmarks=function(e){return void 0===e&&(e=!1),new DetectSingleFaceLandmarksTask(this.runAndExtendWithFaceDetection(),this.input,e)},t.prototype.withFaceExpressions=function(){return new PredictSingleFaceExpressionsTask(this.runAndExtendWithFaceDetection(),this.input)},t.prototype.withAgeAndGender=function(){return new PredictSingleAgeAndGenderTask(this.runAndExtendWithFaceDetection(),this.input)},t}(DetectFacesTaskBase);function detectSingleFace(e,t){return void 0===t&&(t=new SsdMobilenetv1Options),new DetectSingleFaceTask(e,t)}function euclideanDistance(e,t){if(e.length!==t.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var n=Array.from(e),r=Array.from(t);return Math.sqrt(n.map((function(e,t){return e-r[t]})).reduce((function(e,t){return e+Math.pow(t,2)}),0))}!function(){function e(e,t){void 0===t&&(t=.6),this._distanceThreshold=t;var n=Array.isArray(e)?e:[e];if(!n.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var r=1,a=function(){return"person "+r++};this._labeledDescriptors=n.map((function(e){if(e instanceof LabeledFaceDescriptors)return e;if(e instanceof Float32Array)return new LabeledFaceDescriptors(a(),[e]);if(e.descriptor&&e.descriptor instanceof Float32Array)return new LabeledFaceDescriptors(a(),[e.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")}))}Object.defineProperty(e.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),e.prototype.computeMeanDistance=function(e,t){return t.map((function(t){return euclideanDistance(t,e)})).reduce((function(e,t){return e+t}),0)/(t.length||1)},e.prototype.matchDescriptor=function(e){var t=this;return this.labeledDescriptors.map((function(n){var r=n.descriptors,a=n.label;return new FaceMatch(a,t.computeMeanDistance(e,r))})).reduce((function(e,t){return e.distance<t.distance?e:t}))},e.prototype.findBestMatch=function(e){var t=this.matchDescriptor(e);return t.distance<this.distanceThreshold?t:new FaceMatch("unknown",t.distance)},e.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map((function(e){return e.toJSON()}))}},e.fromJSON=function(t){return new e(t.labeledDescriptors.map((function(e){return LabeledFaceDescriptors.fromJSON(e)})),t.distanceThreshold)}}();var RecordRTC$1={exports:{}};!function(e){
/**
       * {@link https://github.com/muaz-khan/RecordRTC|RecordRTC} is a WebRTC JavaScript library for audio/video as well as screen activity recording. It supports Chrome, Firefox, Opera, Android, and Microsoft Edge. Platforms: Linux, Mac and Windows. 
       * @summary Record audio, video or screen inside the browser.
       * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
       * @author {@link https://MuazKhan.com|Muaz Khan}
       * @typedef RecordRTC
       * @class
       * @example
       * var recorder = RecordRTC(mediaStream or [arrayOfMediaStream], {
       *     type: 'video', // audio or video or gif or canvas
       *     recorderType: MediaStreamRecorder || CanvasRecorder || StereoAudioRecorder || Etc
       * });
       * recorder.startRecording();
       * @see For further information:
       * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
       * @param {MediaStream} mediaStream - Single media-stream object, array of media-streams, html-canvas-element, etc.
       * @param {object} config - {type:"video", recorderType: MediaStreamRecorder, disableLogs: true, numberOfAudioChannels: 1, bufferSize: 0, sampleRate: 0, desiredSampRate: 16000, video: HTMLVideoElement, etc.}
       */
function t(e,a){if(!e)throw"First parameter is required.";a=new n(e,a=a||{type:"video"});var i=this;function s(t){t&&(a.initCallback=function(){t(),t=a.initCallback=null});var n=new r(e,a);(p=new n(e,a)).record(),d("recording"),a.disableLogs||console.log("Initialized recorderType:",p.constructor.name,"for output-type:",a.type)}function o(e){if(e=e||function(){},p){if("paused"===i.state)return i.resumeRecording(),void setTimeout((function(){o(e)}),1);"recording"===i.state||a.disableLogs||console.warn('Recording state should be: "recording", however current state is: ',i.state),a.disableLogs||console.log("Stopped recording "+a.type+" stream."),"gif"!==a.type?p.stop(t):(p.stop(),t()),d("stopped")}else m();function t(t){if(p){Object.keys(p).forEach((function(e){"function"!=typeof p[e]&&(i[e]=p[e])}));var n=p.blob;if(!n){if(!t)throw"Recording failed.";p.blob=n=t}if(n&&!a.disableLogs&&console.log(n.type,"->",y(n.size)),e){var r;try{r=c.createObjectURL(n)}catch(s){}"function"==typeof e.call?e.call(i,r):e(r)}a.autoWriteToDisk&&u((function(e){var t={};t[a.type+"Blob"]=e,A.Store(t)}))}else"function"==typeof e.call?e.call(i,""):e("")}}function l(e){postMessage((new FileReaderSync).readAsDataURL(e))}function u(e,t){if(!e)throw"Pass a callback function over getDataURL.";var n=t?t.blob:(p||{}).blob;if(!n)return a.disableLogs||console.warn("Blob encoder did not finish its job yet."),void setTimeout((function(){u(e,t)}),1e3);if("undefined"==typeof Worker||navigator.mozGetUserMedia){var r=new FileReader;r.readAsDataURL(n),r.onload=function(t){e(t.target.result)}}else{var i=function(e){try{var t=c.createObjectURL(new Blob([e.toString(),"this.onmessage =  function (eee) {"+e.name+"(eee.data);}"],{type:"application/javascript"})),n=new Worker(t);return c.revokeObjectURL(t),n}catch(r){}}(l);i.onmessage=function(t){e(t.data)},i.postMessage(n)}}function h(e){e=e||0,"paused"!==i.state?"stopped"!==i.state&&(e>=i.recordingDuration?o(i.onRecordingStopped):(e+=1e3,setTimeout((function(){h(e)}),1e3))):setTimeout((function(){h(e)}),1e3)}function d(e){i&&(i.state=e,"function"==typeof i.onStateChanged.call?i.onStateChanged.call(i,e):i.onStateChanged(e))}var p,f='It seems that recorder is destroyed or "startRecording" is not invoked for '+a.type+" recorder.";function m(){!0!==a.disableLogs&&console.warn(f)}var g={startRecording:function(t){return a.disableLogs||console.log("RecordRTC version: ",i.version),t&&(a=new n(e,t)),a.disableLogs||console.log("started recording "+a.type+" stream."),p?(p.clearRecordedData(),p.record(),d("recording"),i.recordingDuration&&h(),i):(s((function(){i.recordingDuration&&h()})),i)},stopRecording:o,pauseRecording:function(){p?"recording"===i.state?(d("paused"),p.pause(),a.disableLogs||console.log("Paused recording.")):a.disableLogs||console.warn("Unable to pause the recording. Recording state: ",i.state):m()},resumeRecording:function(){p?"paused"===i.state?(d("recording"),p.resume(),a.disableLogs||console.log("Resumed recording.")):a.disableLogs||console.warn("Unable to resume the recording. Recording state: ",i.state):m()},initRecorder:s,setRecordingDuration:function(e,t){if(void 0===e)throw"recordingDuration is required.";if("number"!=typeof e)throw"recordingDuration must be a number.";return i.recordingDuration=e,i.onRecordingStopped=t||function(){},{onRecordingStopped:function(e){i.onRecordingStopped=e}}},clearRecordedData:function(){p?(p.clearRecordedData(),a.disableLogs||console.log("Cleared old recorded data.")):m()},getBlob:function(){if(p)return p.blob;m()},getDataURL:u,toURL:function(){if(p)return c.createObjectURL(p.blob);m()},getInternalRecorder:function(){return p},save:function(e){p?v(p.blob,e):m()},getFromDisk:function(e){p?t.getFromDisk(a.type,e):m()},setAdvertisementArray:function(e){a.advertisement=[];for(var t=e.length,n=0;n<t;n++)a.advertisement.push({duration:n,image:e[n]})},blob:null,bufferSize:0,sampleRate:0,buffer:null,reset:function(){"recording"!==i.state||a.disableLogs||console.warn("Stop an active recorder."),p&&"function"==typeof p.clearRecordedData&&p.clearRecordedData(),p=null,d("inactive"),i.blob=null},onStateChanged:function(e){a.disableLogs||console.log("Recorder state changed:",e)},state:"inactive",getState:function(){return i.state},destroy:function(){var e=a.disableLogs;a={disableLogs:!0},i.reset(),d("destroyed"),g=i=null,_.AudioContextConstructor&&(_.AudioContextConstructor.close(),_.AudioContextConstructor=null),a.disableLogs=e,a.disableLogs||console.log("RecordRTC is destroyed.")},version:"5.6.2"};if(!this)return i=g,g;for(var b in g)this[b]=g[b];return i=this,g}
/**
       * {@link RecordRTCConfiguration} is an inner/private helper for {@link RecordRTC}.
       * @summary It configures the 2nd parameter passed over {@link RecordRTC} and returns a valid "config" object.
       * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
       * @author {@link https://MuazKhan.com|Muaz Khan}
       * @typedef RecordRTCConfiguration
       * @class
       * @example
       * var options = RecordRTCConfiguration(mediaStream, options);
       * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
       * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
       * @param {object} config - {type:"video", disableLogs: true, numberOfAudioChannels: 1, bufferSize: 0, sampleRate: 0, video: HTMLVideoElement, getNativeBlob:true, etc.}
       */
function n(e,t){return t.recorderType||t.type||(t.audio&&t.video?t.type="video":t.audio&&!t.video&&(t.type="audio")),t.recorderType&&!t.type&&(t.recorderType===k||t.recorderType===E||void 0!==P&&t.recorderType===P?t.type="video":t.recorderType===N?t.type="gif":t.recorderType===C?t.type="audio":t.recorderType===S&&(x(e,"audio").length&&x(e,"video").length||!x(e,"audio").length&&x(e,"video").length?t.type="video":x(e,"audio").length&&!x(e,"video").length&&(t.type="audio"))),void 0!==S&&"undefined"!=typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&(t.mimeType||(t.mimeType="video/webm"),t.type||(t.type=t.mimeType.split("/")[0]),t.bitsPerSecond),t.type||(t.mimeType&&(t.type=t.mimeType.split("/")[0]),t.type||(t.type="audio")),t}
/**
       * {@link GetRecorderType} is an inner/private helper for {@link RecordRTC}.
       * @summary It returns best recorder-type available for your browser.
       * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
       * @author {@link https://MuazKhan.com|Muaz Khan}
       * @typedef GetRecorderType
       * @class
       * @example
       * var RecorderType = GetRecorderType(options);
       * var recorder = new RecorderType(options);
       * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
       * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
       * @param {object} config - {type:"video", disableLogs: true, numberOfAudioChannels: 1, bufferSize: 0, sampleRate: 0, video: HTMLVideoElement, etc.}
       */function r(e,t){var n;return(f||h||d)&&(n=C),"undefined"!=typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&!f&&(n=S),"video"===t.type&&(f||d)&&(n=k,void 0!==P&&"undefined"!=typeof ReadableStream&&(n=P)),"gif"===t.type&&(n=N),"canvas"===t.type&&(n=E),w()&&n!==E&&n!==N&&"undefined"!=typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&(x(e,"video").length||x(e,"audio").length)&&("audio"===t.type?"function"==typeof MediaRecorder.isTypeSupported&&MediaRecorder.isTypeSupported("audio/webm")&&(n=S):"function"==typeof MediaRecorder.isTypeSupported&&MediaRecorder.isTypeSupported("video/webm")&&(n=S)),e instanceof Array&&e.length&&(n=D),t.recorderType&&(n=t.recorderType),!t.disableLogs&&n&&n.name&&console.log("Using recorderType:",n.name||n.constructor.name),!n&&m&&(n=S),n}
/**
       * MRecordRTC runs on top of {@link RecordRTC} to bring multiple recordings in a single place, by providing simple API.
       * @summary MRecordRTC stands for "Multiple-RecordRTC".
       * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
       * @author {@link https://MuazKhan.com|Muaz Khan}
       * @typedef MRecordRTC
       * @class
       * @example
       * var recorder = new MRecordRTC();
       * recorder.addStream(MediaStream);
       * recorder.mediaType = {
       *     audio: true, // or StereoAudioRecorder or MediaStreamRecorder
       *     video: true, // or WhammyRecorder or MediaStreamRecorder or WebAssemblyRecorder or CanvasRecorder
       *     gif: true    // or GifRecorder
       * };
       * // mimeType is optional and should be set only in advance cases.
       * recorder.mimeType = {
       *     audio: 'audio/wav',
       *     video: 'video/webm',
       *     gif:   'image/gif'
       * };
       * recorder.startRecording();
       * @see For further information:
       * @see {@link https://github.com/muaz-khan/RecordRTC/tree/master/MRecordRTC|MRecordRTC Source Code}
       * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
       * @requires {@link RecordRTC}
       */function a(e){this.addStream=function(t){t&&(e=t)},this.mediaType={audio:!0,video:!0},this.startRecording=function(){var n,r=this.mediaType,a=this.mimeType||{audio:null,video:null,gif:null};if("function"!=typeof r.audio&&w()&&!x(e,"audio").length&&(r.audio=!1),"function"!=typeof r.video&&w()&&!x(e,"video").length&&(r.video=!1),"function"!=typeof r.gif&&w()&&!x(e,"video").length&&(r.gif=!1),!r.audio&&!r.video&&!r.gif)throw"MediaStream must have either audio or video tracks.";if(r.audio&&(n=null,"function"==typeof r.audio&&(n=r.audio),this.audioRecorder=new t(e,{type:"audio",bufferSize:this.bufferSize,sampleRate:this.sampleRate,numberOfAudioChannels:this.numberOfAudioChannels||2,disableLogs:this.disableLogs,recorderType:n,mimeType:a.audio,timeSlice:this.timeSlice,onTimeStamp:this.onTimeStamp}),r.video||this.audioRecorder.startRecording()),r.video){n=null,"function"==typeof r.video&&(n=r.video);var i=e;if(w()&&r.audio&&"function"==typeof r.audio){var s=x(e,"video")[0];p?((i=new g).addTrack(s),n&&n===k&&(n=S)):(i=new g).addTrack(s)}this.videoRecorder=new t(i,{type:"video",video:this.video,canvas:this.canvas,frameInterval:this.frameInterval||10,disableLogs:this.disableLogs,recorderType:n,mimeType:a.video,timeSlice:this.timeSlice,onTimeStamp:this.onTimeStamp,workerPath:this.workerPath,webAssemblyPath:this.webAssemblyPath,frameRate:this.frameRate,bitrate:this.bitrate}),r.audio||this.videoRecorder.startRecording()}if(r.audio&&r.video){var o=this,l=!0===w();(r.audio instanceof C&&r.video||!0!==r.audio&&!0!==r.video&&r.audio!==r.video)&&(l=!1),!0===l?(o.audioRecorder=null,o.videoRecorder.startRecording()):o.videoRecorder.initRecorder((function(){o.audioRecorder.initRecorder((function(){o.videoRecorder.startRecording(),o.audioRecorder.startRecording()}))}))}r.gif&&(n=null,"function"==typeof r.gif&&(n=r.gif),this.gifRecorder=new t(e,{type:"gif",frameRate:this.frameRate||200,quality:this.quality||10,disableLogs:this.disableLogs,recorderType:n,mimeType:a.gif}),this.gifRecorder.startRecording())},this.stopRecording=function(e){e=e||function(){},this.audioRecorder&&this.audioRecorder.stopRecording((function(t){e(t,"audio")})),this.videoRecorder&&this.videoRecorder.stopRecording((function(t){e(t,"video")})),this.gifRecorder&&this.gifRecorder.stopRecording((function(t){e(t,"gif")}))},this.pauseRecording=function(){this.audioRecorder&&this.audioRecorder.pauseRecording(),this.videoRecorder&&this.videoRecorder.pauseRecording(),this.gifRecorder&&this.gifRecorder.pauseRecording()},this.resumeRecording=function(){this.audioRecorder&&this.audioRecorder.resumeRecording(),this.videoRecorder&&this.videoRecorder.resumeRecording(),this.gifRecorder&&this.gifRecorder.resumeRecording()},this.getBlob=function(e){var t={};return this.audioRecorder&&(t.audio=this.audioRecorder.getBlob()),this.videoRecorder&&(t.video=this.videoRecorder.getBlob()),this.gifRecorder&&(t.gif=this.gifRecorder.getBlob()),e&&e(t),t},this.destroy=function(){this.audioRecorder&&(this.audioRecorder.destroy(),this.audioRecorder=null),this.videoRecorder&&(this.videoRecorder.destroy(),this.videoRecorder=null),this.gifRecorder&&(this.gifRecorder.destroy(),this.gifRecorder=null)},this.getDataURL=function(e){function t(e,t){if("undefined"!=typeof Worker){var n=function(e){var t,n=c.createObjectURL(new Blob([e.toString(),"this.onmessage =  function (eee) {"+e.name+"(eee.data);}"],{type:"application/javascript"})),r=new Worker(n);if(void 0!==c)t=c;else{if("undefined"==typeof webkitURL)throw"Neither URL nor webkitURL detected.";t=webkitURL}return t.revokeObjectURL(n),r}((function(e){postMessage((new FileReaderSync).readAsDataURL(e))}));n.onmessage=function(e){t(e.data)},n.postMessage(e)}else{var r=new FileReader;r.readAsDataURL(e),r.onload=function(e){t(e.target.result)}}}this.getBlob((function(n){n.audio&&n.video?t(n.audio,(function(r){t(n.video,(function(t){e({audio:r,video:t})}))})):n.audio?t(n.audio,(function(t){e({audio:t})})):n.video&&t(n.video,(function(t){e({video:t})}))}))},this.writeToDisk=function(){t.writeToDisk({audio:this.audioRecorder,video:this.videoRecorder,gif:this.gifRecorder})},this.save=function(e){(e=e||{audio:!0,video:!0,gif:!0}).audio&&this.audioRecorder&&this.audioRecorder.save("string"==typeof e.audio?e.audio:""),e.video&&this.videoRecorder&&this.videoRecorder.save("string"==typeof e.video?e.video:""),e.gif&&this.gifRecorder&&this.gifRecorder.save("string"==typeof e.gif?e.gif:"")}}t.version="5.6.2",e.exports=t,t.getFromDisk=function(e,t){if(!t)throw"callback is mandatory.";console.log("Getting recorded "+("all"===e?"blobs":e+" blob ")+" from disk!"),A.Fetch((function(n,r){"all"!==e&&r===e+"Blob"&&t&&t(n),"all"===e&&t&&t(n,r.replace("Blob",""))}))},t.writeToDisk=function(e){console.log("Writing recorded blob(s) to disk!"),(e=e||{}).audio&&e.video&&e.gif?e.audio.getDataURL((function(t){e.video.getDataURL((function(n){e.gif.getDataURL((function(e){A.Store({audioBlob:t,videoBlob:n,gifBlob:e})}))}))})):e.audio&&e.video?e.audio.getDataURL((function(t){e.video.getDataURL((function(e){A.Store({audioBlob:t,videoBlob:e})}))})):e.audio&&e.gif?e.audio.getDataURL((function(t){e.gif.getDataURL((function(e){A.Store({audioBlob:t,gifBlob:e})}))})):e.video&&e.gif?e.video.getDataURL((function(t){e.gif.getDataURL((function(e){A.Store({videoBlob:t,gifBlob:e})}))})):e.audio?e.audio.getDataURL((function(e){A.Store({audioBlob:e})})):e.video?e.video.getDataURL((function(e){A.Store({videoBlob:e})})):e.gif&&e.gif.getDataURL((function(e){A.Store({gifBlob:e})}))},a.getFromDisk=t.getFromDisk,a.writeToDisk=t.writeToDisk,void 0!==t&&(t.MRecordRTC=a);var i;(i=void 0!==commonjsGlobal?commonjsGlobal:null)&&"undefined"==typeof window&&void 0!==commonjsGlobal&&(commonjsGlobal.navigator={userAgent:"Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45",getUserMedia:function(){}},commonjsGlobal.console||(commonjsGlobal.console={}),void 0!==commonjsGlobal.console.log&&void 0!==commonjsGlobal.console.error||(commonjsGlobal.console.error=commonjsGlobal.console.log=commonjsGlobal.console.log||function(){console.log(arguments)}),"undefined"==typeof document&&(i.document={documentElement:{appendChild:function(){return""}}},document.createElement=document.captureStream=document.mozCaptureStream=function(){var e={getContext:function(){return e},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""},style:{}};return e},i.HTMLVideoElement=function(){}),"undefined"==typeof location&&(i.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(i.screen={width:0,height:0}),void 0===c&&(i.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),i.window=commonjsGlobal);var s=window.requestAnimationFrame;if(void 0===s)if("undefined"!=typeof webkitRequestAnimationFrame)s=webkitRequestAnimationFrame;else if("undefined"!=typeof mozRequestAnimationFrame)s=mozRequestAnimationFrame;else if("undefined"!=typeof msRequestAnimationFrame)s=msRequestAnimationFrame;else if(void 0===s){var o=0;s=function(e,t){var n=(new Date).getTime(),r=Math.max(0,16-(n-o)),a=setTimeout((function(){e(n+r)}),r);return o=n+r,a}}var l=window.cancelAnimationFrame;void 0===l&&("undefined"!=typeof webkitCancelAnimationFrame?l=webkitCancelAnimationFrame:"undefined"!=typeof mozCancelAnimationFrame?l=mozCancelAnimationFrame:"undefined"!=typeof msCancelAnimationFrame?l=msCancelAnimationFrame:void 0===l&&(l=function(e){clearTimeout(e)}));var u=window.AudioContext;void 0===u&&("undefined"!=typeof webkitAudioContext&&(u=webkitAudioContext),"undefined"!=typeof mozAudioContext&&(u=mozAudioContext));var c=window.URL;void 0===c&&"undefined"!=typeof webkitURL&&(c=webkitURL),"undefined"!=typeof navigator&&void 0===navigator.getUserMedia&&(void 0!==navigator.webkitGetUserMedia&&(navigator.getUserMedia=navigator.webkitGetUserMedia),void 0!==navigator.mozGetUserMedia&&(navigator.getUserMedia=navigator.mozGetUserMedia));var h=!(-1===navigator.userAgent.indexOf("Edge")||!navigator.msSaveBlob&&!navigator.msSaveOrOpenBlob),d=!!window.opera||-1!==navigator.userAgent.indexOf("OPR/"),p=navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&"netscape"in window&&/ rv:/.test(navigator.userAgent),f=!d&&!h&&!!navigator.webkitGetUserMedia||b()||-1!==navigator.userAgent.toLowerCase().indexOf("chrome/"),m=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);m&&!f&&-1!==navigator.userAgent.indexOf("CriOS")&&(m=!1,f=!0);var g=window.MediaStream;function y(e){if(0===e)return"0 Bytes";var t=parseInt(Math.floor(Math.log(e)/Math.log(1e3)),10);return(e/Math.pow(1e3,t)).toPrecision(3)+" "+["Bytes","KB","MB","GB","TB"][t]}function v(e,t){if(!e)throw"Blob object is required.";if(!e.type)try{e.type="video/webm"}catch(s){}var n=(e.type||"video/webm").split("/")[1];if(-1!==n.indexOf(";")&&(n=n.split(";")[0]),t&&-1!==t.indexOf(".")){var r=t.split(".");t=r[0],n=r[1]}var a=(t||Math.round(9999999999*Math.random())+888888888)+"."+n;if(void 0!==navigator.msSaveOrOpenBlob)return navigator.msSaveOrOpenBlob(e,a);if(void 0!==navigator.msSaveBlob)return navigator.msSaveBlob(e,a);var i=document.createElement("a");i.href=c.createObjectURL(e),i.download=a,i.style="display:none;opacity:0;color:transparent;",(document.body||document.documentElement).appendChild(i),"function"==typeof i.click?i.click():(i.target="_blank",i.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0}))),c.revokeObjectURL(i.href)}function b(){return"undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type||(!("undefined"==typeof process||"object"!=typeof process.versions||!process.versions.electron)||"object"==typeof navigator&&"string"==typeof navigator.userAgent&&navigator.userAgent.indexOf("Electron")>=0)}function x(e,t){return e&&e.getTracks?e.getTracks().filter((function(e){return e.kind===(t||"audio")})):[]}function T(e,t){"srcObject"in t?t.srcObject=e:"mozSrcObject"in t?t.mozSrcObject=e:t.srcObject=e}void 0===g&&"undefined"!=typeof webkitMediaStream&&(g=webkitMediaStream),void 0!==g&&void 0===g.prototype.stop&&(g.prototype.stop=function(){this.getTracks().forEach((function(e){e.stop()}))}),void 0!==t&&(t.invokeSaveAsDialog=v,t.getTracks=x,t.getSeekableBlob=function(e,t){if("undefined"==typeof EBML)throw new Error("Please link: https://www.webrtc-experiment.com/EBML.js");var n=new EBML.Reader,r=new EBML.Decoder,a=EBML.tools,i=new FileReader;i.onload=function(e){r.decode(this.result).forEach((function(e){n.read(e)})),n.stop();var i=a.makeMetadataSeekable(n.metadatas,n.duration,n.cues),s=this.result.slice(n.metadataSize),o=new Blob([i,s],{type:"video/webm"});t(o)},i.readAsArrayBuffer(e)},t.bytesToSize=y,t.isElectron=b)
/**
       * Storage is a standalone object used by {@link RecordRTC} to store reusable objects e.g. "new AudioContext".
       * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
       * @author {@link https://MuazKhan.com|Muaz Khan}
       * @example
       * Storage.AudioContext === webkitAudioContext
       * @property {webkitAudioContext} AudioContext - Keeps a reference to AudioContext object.
       * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
       */;var _={};function w(){if(p||m||h)return!0;var e,t,n=navigator.userAgent,r=""+parseFloat(navigator.appVersion),a=parseInt(navigator.appVersion,10);return(f||d)&&(e=n.indexOf("Chrome"),r=n.substring(e+7)),-1!==(t=r.indexOf(";"))&&(r=r.substring(0,t)),-1!==(t=r.indexOf(" "))&&(r=r.substring(0,t)),a=parseInt(""+r,10),isNaN(a)&&(r=""+parseFloat(navigator.appVersion),a=parseInt(navigator.appVersion,10)),a>=49}
/**
       * MediaStreamRecorder is an abstraction layer for {@link https://w3c.github.io/mediacapture-record/MediaRecorder.html|MediaRecorder API}. It is used by {@link RecordRTC} to record MediaStream(s) in both Chrome and Firefox.
       * @summary Runs top over {@link https://w3c.github.io/mediacapture-record/MediaRecorder.html|MediaRecorder API}.
       * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
       * @author {@link https://github.com/muaz-khan|Muaz Khan}
       * @typedef MediaStreamRecorder
       * @class
       * @example
       * var config = {
       *     mimeType: 'video/webm', // vp8, vp9, h264, mkv, opus/vorbis
       *     audioBitsPerSecond : 256 * 8 * 1024,
       *     videoBitsPerSecond : 256 * 8 * 1024,
       *     bitsPerSecond: 256 * 8 * 1024,  // if this is provided, skip above two
       *     checkForInactiveTracks: true,
       *     timeSlice: 1000, // concatenate intervals based blobs
       *     ondataavailable: function() {} // get intervals based blobs
       * }
       * var recorder = new MediaStreamRecorder(mediaStream, config);
       * recorder.record();
       * recorder.stop(function(blob) {
       *     video.src = URL.createObjectURL(blob);
       *
       *     // or
       *     var blob = recorder.blob;
       * });
       * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
       * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
       * @param {object} config - {disableLogs:true, initCallback: function, mimeType: "video/webm", timeSlice: 1000}
       * @throws Will throw an error if first argument "MediaStream" is missing. Also throws error if "MediaRecorder API" are not supported by the browser.
       */function S(e,t){var n=this;if(void 0===e)throw'First argument "MediaStream" is required.';if("undefined"==typeof MediaRecorder)throw"Your browser does not support the Media Recorder API. Please try other modules e.g. WhammyRecorder or StereoAudioRecorder.";if("audio"===(t=t||{mimeType:"video/webm"}).type){var r;if(x(e,"video").length&&x(e,"audio").length)navigator.mozGetUserMedia?(r=new g).addTrack(x(e,"audio")[0]):r=new g(x(e,"audio")),e=r;t.mimeType&&-1!==t.mimeType.toString().toLowerCase().indexOf("audio")||(t.mimeType=f?"audio/webm":"audio/ogg"),t.mimeType&&"audio/ogg"!==t.mimeType.toString().toLowerCase()&&navigator.mozGetUserMedia&&(t.mimeType="audio/ogg")}var a,i=[];function s(){n.timestamps.push((new Date).getTime()),"function"==typeof t.onTimeStamp&&t.onTimeStamp(n.timestamps[n.timestamps.length-1],n.timestamps)}function o(e){return a&&a.mimeType?a.mimeType:e.mimeType||"video/webm"}function l(){i=[],a=null,n.timestamps=[]}this.getArrayOfBlobs=function(){return i},this.record=function(){n.blob=null,n.clearRecordedData(),n.timestamps=[],u=[],i=[];var r=t;t.disableLogs||console.log("Passing following config over MediaRecorder API.",r),a&&(a=null),f&&!w()&&(r="video/vp8"),"function"==typeof MediaRecorder.isTypeSupported&&r.mimeType&&(MediaRecorder.isTypeSupported(r.mimeType)||(t.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",r.mimeType),r.mimeType="audio"===t.type?"audio/webm":"video/webm"));try{a=new MediaRecorder(e,r),t.mimeType=r.mimeType}catch(l){a=new MediaRecorder(e)}r.mimeType&&!MediaRecorder.isTypeSupported&&"canRecordMimeType"in a&&!1===a.canRecordMimeType(r.mimeType)&&(t.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",r.mimeType)),a.ondataavailable=function(e){if(e.data&&u.push("ondataavailable: "+y(e.data.size)),"number"!=typeof t.timeSlice)!e.data||!e.data.size||e.data.size<100||n.blob?n.recordingCallback&&(n.recordingCallback(new Blob([],{type:o(r)})),n.recordingCallback=null):(n.blob=t.getNativeBlob?e.data:new Blob([e.data],{type:o(r)}),n.recordingCallback&&(n.recordingCallback(n.blob),n.recordingCallback=null));else if(e.data&&e.data.size&&(i.push(e.data),s(),"function"==typeof t.ondataavailable)){var a=t.getNativeBlob?e.data:new Blob([e.data],{type:o(r)});t.ondataavailable(a)}},a.onstart=function(){u.push("started")},a.onpause=function(){u.push("paused")},a.onresume=function(){u.push("resumed")},a.onstop=function(){u.push("stopped")},a.onerror=function(e){e&&(e.name||(e.name="UnknownError"),u.push("error: "+e),t.disableLogs||(-1!==e.name.toString().toLowerCase().indexOf("invalidstate")?console.error("The MediaRecorder is not in a state in which the proposed operation is allowed to be executed.",e):-1!==e.name.toString().toLowerCase().indexOf("notsupported")?console.error("MIME type (",r.mimeType,") is not supported.",e):-1!==e.name.toString().toLowerCase().indexOf("security")?console.error("MediaRecorder security error",e):"OutOfMemory"===e.name?console.error("The UA has exhaused the available memory. User agents SHOULD provide as much additional information as possible in the message attribute.",e):"IllegalStreamModification"===e.name?console.error("A modification to the stream has occurred that makes it impossible to continue recording. An example would be the addition of a Track while recording is occurring. User agents SHOULD provide as much additional information as possible in the message attribute.",e):"OtherRecordingError"===e.name?console.error("Used for an fatal error other than those listed above. User agents SHOULD provide as much additional information as possible in the message attribute.",e):"GenericError"===e.name?console.error("The UA cannot provide the codec or recording option that has been requested.",e):console.error("MediaRecorder Error",e)),function(e){if(!n.manuallyStopped&&a&&"inactive"===a.state)return delete t.timeslice,void a.start(6e5);setTimeout(void 0,1e3)}(),"inactive"!==a.state&&"stopped"!==a.state&&a.stop())},"number"==typeof t.timeSlice?(s(),a.start(t.timeSlice)):a.start(36e5),t.initCallback&&t.initCallback()},this.timestamps=[],this.stop=function(e){e=e||function(){},n.manuallyStopped=!0,a&&(this.recordingCallback=e,"recording"===a.state&&a.stop(),"number"==typeof t.timeSlice&&setTimeout((function(){n.blob=new Blob(i,{type:o(t)}),n.recordingCallback(n.blob)}),100))},this.pause=function(){a&&"recording"===a.state&&a.pause()},this.resume=function(){a&&"paused"===a.state&&a.resume()},this.clearRecordedData=function(){a&&"recording"===a.state&&n.stop(l),l()},this.getInternalRecorder=function(){return a},this.blob=null,this.getState=function(){return a&&a.state||"inactive"};var u=[];this.getAllStates=function(){return u},void 0===t.checkForInactiveTracks&&(t.checkForInactiveTracks=!1);n=this;!function r(){if(a&&!1!==t.checkForInactiveTracks)return!1===function(){if("active"in e){if(!e.active)return!1}else if("ended"in e&&e.ended)return!1;return!0}()?(t.disableLogs||console.log("MediaStream seems stopped."),void n.stop()):void setTimeout(r,1e3)}(),this.name="MediaStreamRecorder",this.toString=function(){return this.name}}
/**
       * StereoAudioRecorder is a standalone class used by {@link RecordRTC} to bring "stereo" audio-recording in chrome.
       * @summary JavaScript standalone object for stereo audio recording.
       * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
       * @author {@link https://MuazKhan.com|Muaz Khan}
       * @typedef StereoAudioRecorder
       * @class
       * @example
       * var recorder = new StereoAudioRecorder(MediaStream, {
       *     sampleRate: 44100,
       *     bufferSize: 4096
       * });
       * recorder.record();
       * recorder.stop(function(blob) {
       *     video.src = URL.createObjectURL(blob);
       * });
       * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
       * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
       * @param {object} config - {sampleRate: 44100, bufferSize: 4096, numberOfAudioChannels: 1, etc.}
       */
function C(e,n){if(!x(e,"audio").length)throw"Your stream has no audio tracks.";var r,a=this,i=[],s=[],o=!1,l=0,u=2,h=(n=n||{}).desiredSampRate;function d(){if(!1===n.checkForInactiveTracks)return!0;if("active"in e){if(!e.active)return!1}else if("ended"in e&&e.ended)return!1;return!0}function p(e,t){function n(e,t){var n,r=e.numberOfAudioChannels,a=e.leftBuffers.slice(0),i=e.rightBuffers.slice(0),s=e.sampleRate,o=e.internalInterleavedLength,l=e.desiredSampRate;function u(e,t,n){var r=Math.round(e.length*(t/n)),a=[],i=Number((e.length-1)/(r-1));a[0]=e[0];for(var s=1;s<r-1;s++){var o=s*i,l=Number(Math.floor(o)).toFixed(),u=Number(Math.ceil(o)).toFixed(),h=o-l;a[s]=c(e[l],e[u],h)}return a[r-1]=e[e.length-1],a}function c(e,t,n){return e+(t-e)*n}function h(e,t){for(var n=new Float64Array(t),r=0,a=e.length,i=0;i<a;i++){var s=e[i];n.set(s,r),r+=s.length}return n}function d(e,t,n){for(var r=n.length,a=0;a<r;a++)e.setUint8(t+a,n.charCodeAt(a))}2===r&&(a=h(a,o),i=h(i,o),l&&(a=u(a,l,s),i=u(i,l,s))),1===r&&(a=h(a,o),l&&(a=u(a,l,s))),l&&(s=l),2===r&&(n=function(e,t){for(var n=e.length+t.length,r=new Float64Array(n),a=0,i=0;i<n;)r[i++]=e[a],r[i++]=t[a],a++;return r}(a,i)),1===r&&(n=a);var p=n.length,f=new ArrayBuffer(44+2*p),m=new DataView(f);d(m,0,"RIFF"),m.setUint32(4,36+2*p,!0),d(m,8,"WAVE"),d(m,12,"fmt "),m.setUint32(16,16,!0),m.setUint16(20,1,!0),m.setUint16(22,r,!0),m.setUint32(24,s,!0),m.setUint32(28,s*r*2,!0),m.setUint16(32,2*r,!0),m.setUint16(34,16,!0),d(m,36,"data"),m.setUint32(40,2*p,!0);for(var g=p,y=44,v=0;v<g;v++)m.setInt16(y,32767*n[v],!0),y+=2;if(t)return t({buffer:f,view:m});postMessage({buffer:f,view:m})}if(e.noWorker)n(e,(function(e){t(e.buffer,e.view)}));else{var r,a,i,s=(r=n,a=c.createObjectURL(new Blob([r.toString(),";this.onmessage =  function (eee) {"+r.name+"(eee.data);}"],{type:"application/javascript"})),(i=new Worker(a)).workerURL=a,i);s.onmessage=function(e){t(e.data.buffer,e.data.view),c.revokeObjectURL(s.workerURL),s.terminate()},s.postMessage(e)}}!0===n.leftChannel&&(u=1),1===n.numberOfAudioChannels&&(u=1),(!u||u<1)&&(u=2),n.disableLogs||console.log("StereoAudioRecorder is set to record number of channels: "+u),void 0===n.checkForInactiveTracks&&(n.checkForInactiveTracks=!0),this.record=function(){if(!1===d())throw"Please make sure MediaStream is active.";T(),w=b=!1,o=!0,void 0!==n.timeSlice&&C()},this.stop=function(e){e=e||function(){},o=!1,p({desiredSampRate:h,sampleRate:v,numberOfAudioChannels:u,internalInterleavedLength:l,leftBuffers:i,rightBuffers:1===u?[]:s,noWorker:n.noWorker},(function(t,n){a.blob=new Blob([n],{type:"audio/wav"}),a.buffer=new ArrayBuffer(n.buffer.byteLength),a.view=n,a.sampleRate=h||v,a.bufferSize=y,a.length=l,w=!1,e&&e(a.blob)}))},void 0===t.Storage&&(t.Storage={AudioContextConstructor:null,AudioContext:window.AudioContext||window.webkitAudioContext}),t.Storage.AudioContextConstructor&&"closed"!==t.Storage.AudioContextConstructor.state||(t.Storage.AudioContextConstructor=new t.Storage.AudioContext);var f=t.Storage.AudioContextConstructor,m=f.createMediaStreamSource(e),g=[0,256,512,1024,2048,4096,8192,16384],y=void 0===n.bufferSize?4096:n.bufferSize;if(-1===g.indexOf(y)&&(n.disableLogs||console.log("Legal values for buffer-size are "+JSON.stringify(g,null,"\t"))),f.createJavaScriptNode)r=f.createJavaScriptNode(y,u,u);else{if(!f.createScriptProcessor)throw"WebAudio API has no support on this browser.";r=f.createScriptProcessor(y,u,u)}m.connect(r),n.bufferSize||(y=r.bufferSize);var v=void 0!==n.sampleRate?n.sampleRate:f.sampleRate||44100;(v<22050||v>96e3)&&(n.disableLogs||console.log("sample-rate must be under range 22050 and 96000.")),n.disableLogs||n.desiredSampRate&&console.log("Desired sample-rate: "+n.desiredSampRate);var b=!1;function T(){i=[],s=[],l=0,w=!1,o=!1,b=!1,f=null,a.leftchannel=i,a.rightchannel=s,a.numberOfAudioChannels=u,a.desiredSampRate=h,a.sampleRate=v,a.recordingLength=l,S={left:[],right:[],recordingLength:0}}function _(){r&&(r.onaudioprocess=null,r.disconnect(),r=null),m&&(m.disconnect(),m=null),T()}this.pause=function(){b=!0},this.resume=function(){if(!1===d())throw"Please make sure MediaStream is active.";if(!o)return n.disableLogs||console.log("Seems recording has been restarted."),void this.record();b=!1},this.clearRecordedData=function(){n.checkForInactiveTracks=!1,o&&this.stop(_),_()},this.name="StereoAudioRecorder",this.toString=function(){return this.name};var w=!1;r.onaudioprocess=function(e){if(!b)if(!1===d()&&(n.disableLogs||console.log("MediaStream seems stopped."),r.disconnect(),o=!1),o){w||(w=!0,n.onAudioProcessStarted&&n.onAudioProcessStarted(),n.initCallback&&n.initCallback());var t=e.inputBuffer.getChannelData(0),c=new Float32Array(t);if(i.push(c),2===u){var h=e.inputBuffer.getChannelData(1),p=new Float32Array(h);s.push(p)}l+=y,a.recordingLength=l,void 0!==n.timeSlice&&(S.recordingLength+=y,S.left.push(c),2===u&&S.right.push(p))}else m&&(m.disconnect(),m=null)},f.createMediaStreamDestination?r.connect(f.createMediaStreamDestination()):r.connect(f.destination),this.leftchannel=i,this.rightchannel=s,this.numberOfAudioChannels=u,this.desiredSampRate=h,this.sampleRate=v,a.recordingLength=l;var S={left:[],right:[],recordingLength:0};function C(){o&&"function"==typeof n.ondataavailable&&void 0!==n.timeSlice&&(S.left.length?(p({desiredSampRate:h,sampleRate:v,numberOfAudioChannels:u,internalInterleavedLength:S.recordingLength,leftBuffers:S.left,rightBuffers:1===u?[]:S.right},(function(e,t){var r=new Blob([t],{type:"audio/wav"});n.ondataavailable(r),setTimeout(C,n.timeSlice)})),S={left:[],right:[],recordingLength:0}):setTimeout(C,n.timeSlice))}}
/**
       * CanvasRecorder is a standalone class used by {@link RecordRTC} to bring HTML5-Canvas recording into video WebM. It uses HTML2Canvas library and runs top over {@link Whammy}.
       * @summary HTML2Canvas recording into video WebM.
       * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
       * @author {@link https://MuazKhan.com|Muaz Khan}
       * @typedef CanvasRecorder
       * @class
       * @example
       * var recorder = new CanvasRecorder(htmlElement, { disableLogs: true, useWhammyRecorder: true });
       * recorder.record();
       * recorder.stop(function(blob) {
       *     video.src = URL.createObjectURL(blob);
       * });
       * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
       * @param {HTMLElement} htmlElement - querySelector/getElementById/getElementsByTagName[0]/etc.
       * @param {object} config - {disableLogs:true, initCallback: function}
       */
function E(e,t){if("undefined"==typeof html2canvas)throw"Please link: https://www.webrtc-experiment.com/screenshot.js";(t=t||{}).frameInterval||(t.frameInterval=10);var n=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach((function(e){e in document.createElement("canvas")&&(n=!0)}));var r,a,i,s=!(!window.webkitRTCPeerConnection&&!window.webkitGetUserMedia||!window.chrome),o=50,l=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);if(s&&l&&l[2]&&(o=parseInt(l[2],10)),s&&o<52&&(n=!1),t.useWhammyRecorder&&(n=!1),n)if(t.disableLogs||console.log("Your browser supports both MediRecorder API and canvas.captureStream!"),e instanceof HTMLCanvasElement)r=e;else{if(!(e instanceof CanvasRenderingContext2D))throw"Please pass either HTMLCanvasElement or CanvasRenderingContext2D.";r=e.canvas}else navigator.mozGetUserMedia&&(t.disableLogs||console.error("Canvas recording is NOT supported in Firefox."));this.record=function(){if(i=!0,n&&!t.useWhammyRecorder){var e;"captureStream"in r?e=r.captureStream(25):"mozCaptureStream"in r?e=r.mozCaptureStream(25):"webkitCaptureStream"in r&&(e=r.webkitCaptureStream(25));try{var s=new g;s.addTrack(x(e,"video")[0]),e=s}catch(o){}if(!e)throw"captureStream API are NOT available.";(a=new S(e,{mimeType:t.mimeType||"video/webm"})).record()}else p.frames=[],d=(new Date).getTime(),h();t.initCallback&&t.initCallback()},this.getWebPImages=function(n){if("canvas"===e.nodeName.toLowerCase()){var r=p.frames.length;p.frames.forEach((function(e,n){var a=r-n;t.disableLogs||console.log(a+"/"+r+" frames remaining"),t.onEncodingCallback&&t.onEncodingCallback(a,r);var i=e.image.toDataURL("image/webp",1);p.frames[n].image=i})),t.disableLogs||console.log("Generating WebM"),n()}else n()},this.stop=function(e){i=!1;var r=this;n&&a?a.stop(e):this.getWebPImages((function(){p.compile((function(n){t.disableLogs||console.log("Recording finished!"),r.blob=n,r.blob.forEach&&(r.blob=new Blob([],{type:"video/webm"})),e&&e(r.blob),p.frames=[]}))}))};var u=!1;function c(){p.frames=[],i=!1,u=!1}function h(){if(u)return d=(new Date).getTime(),setTimeout(h,500);if("canvas"===e.nodeName.toLowerCase()){var n=(new Date).getTime()-d;return d=(new Date).getTime(),p.frames.push({image:(r=document.createElement("canvas"),a=r.getContext("2d"),r.width=e.width,r.height=e.height,a.drawImage(e,0,0),r),duration:n}),void(i&&setTimeout(h,t.frameInterval))}var r,a;html2canvas(e,{grabMouse:void 0===t.showMousePointer||t.showMousePointer,onrendered:function(e){var n=(new Date).getTime()-d;if(!n)return setTimeout(h,t.frameInterval);d=(new Date).getTime(),p.frames.push({image:e.toDataURL("image/webp",1),duration:n}),i&&setTimeout(h,t.frameInterval)}})}this.pause=function(){u=!0,a instanceof S&&a.pause()},this.resume=function(){u=!1,a instanceof S?a.resume():i||this.record()},this.clearRecordedData=function(){i&&this.stop(c),c()},this.name="CanvasRecorder",this.toString=function(){return this.name};var d=(new Date).getTime(),p=new I.Video(100)}
/**
       * WhammyRecorder is a standalone class used by {@link RecordRTC} to bring video recording in Chrome. It runs top over {@link Whammy}.
       * @summary Video recording feature in Chrome.
       * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
       * @author {@link https://MuazKhan.com|Muaz Khan}
       * @typedef WhammyRecorder
       * @class
       * @example
       * var recorder = new WhammyRecorder(mediaStream);
       * recorder.record();
       * recorder.stop(function(blob) {
       *     video.src = URL.createObjectURL(blob);
       * });
       * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
       * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
       * @param {object} config - {disableLogs: true, initCallback: function, video: HTMLVideoElement, etc.}
       */
function k(e,t){function n(e){e=void 0!==e?e:10;var t=(new Date).getTime()-l;return t?i?(l=(new Date).getTime(),setTimeout(n,100)):(l=(new Date).getTime(),o.paused&&o.play(),h.drawImage(o,0,0,c.width,c.height),u.frames.push({duration:t,image:c.toDataURL("image/webp")}),void(a||setTimeout(n,e,e))):setTimeout(n,e,e)}function r(e,t,n,r,a){var i=document.createElement("canvas");i.width=c.width,i.height=c.height;var s,o,l,u=i.getContext("2d"),h=[],d=-1===t,p=t&&t>0&&t<=e.length?t:e.length,f=0,m=0,g=0,y=Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2)),v=n&&n>=0&&n<=1?n:0,b=r&&r>=0&&r<=1?r:0,x=!1;o=-1,l=(s={length:p,functionToLoop:function(t,n){var r,a,i,s=function(){!x&&i-r<=i*b||(d&&(x=!0),h.push(e[n])),t()};if(x)s();else{var o=new Image;o.onload=function(){u.drawImage(o,0,0,c.width,c.height);var e=u.getImageData(0,0,c.width,c.height);r=0,a=e.data.length,i=e.data.length/4;for(var t=0;t<a;t+=4){var n={r:e.data[t],g:e.data[t+1],b:e.data[t+2]};Math.sqrt(Math.pow(n.r-f,2)+Math.pow(n.g-m,2)+Math.pow(n.b-g,2))<=y*v&&r++}s()},o.src=e[n].image}},callback:function(){(h=h.concat(e.slice(p))).length<=0&&h.push(e[e.length-1]),a(h)}}).length,function e(){++o!==l?setTimeout((function(){s.functionToLoop(e,o)}),1):s.callback()}()}(t=t||{}).frameInterval||(t.frameInterval=10),t.disableLogs||console.log("Using frames-interval:",t.frameInterval),this.record=function(){t.width||(t.width=320),t.height||(t.height=240),t.video||(t.video={width:t.width,height:t.height}),t.canvas||(t.canvas={width:t.width,height:t.height}),c.width=t.canvas.width||320,c.height=t.canvas.height||240,h=c.getContext("2d"),t.video&&t.video instanceof HTMLVideoElement?(o=t.video.cloneNode(),t.initCallback&&t.initCallback()):(o=document.createElement("video"),T(e,o),o.onloadedmetadata=function(){t.initCallback&&t.initCallback()},o.width=t.video.width,o.height=t.video.height),o.muted=!0,o.play(),l=(new Date).getTime(),u=new I.Video,t.disableLogs||(console.log("canvas resolutions",c.width,"*",c.height),console.log("video width/height",o.width||c.width,"*",o.height||c.height)),n(t.frameInterval)};var a=!1;this.stop=function(e){e=e||function(){},a=!0;var n=this;setTimeout((function(){r(u.frames,-1,null,null,(function(r){u.frames=r,t.advertisement&&t.advertisement.length&&(u.frames=t.advertisement.concat(u.frames)),u.compile((function(t){n.blob=t,n.blob.forEach&&(n.blob=new Blob([],{type:"video/webm"})),e&&e(n.blob)}))}))}),10)};var i=!1;function s(){u.frames=[],a=!0,i=!1}this.pause=function(){i=!0},this.resume=function(){i=!1,a&&this.record()},this.clearRecordedData=function(){a||this.stop(s),s()},this.name="WhammyRecorder",this.toString=function(){return this.name};var o,l,u,c=document.createElement("canvas"),h=c.getContext("2d")}void 0!==u?_.AudioContext=u:"undefined"!=typeof webkitAudioContext&&(_.AudioContext=webkitAudioContext),void 0!==t&&(t.Storage=_),void 0!==t&&(t.MediaStreamRecorder=S),void 0!==t&&(t.StereoAudioRecorder=C),void 0!==t&&(t.CanvasRecorder=E),void 0!==t&&(t.WhammyRecorder=k)
/**
       * Whammy is a standalone class used by {@link RecordRTC} to bring video recording in Chrome. It is written by {@link https://github.com/antimatter15|antimatter15}
       * @summary A real time javascript webm encoder based on a canvas hack.
       * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
       * @author {@link https://MuazKhan.com|Muaz Khan}
       * @typedef Whammy
       * @class
       * @example
       * var recorder = new Whammy().Video(15);
       * recorder.add(context || canvas || dataURL);
       * var output = recorder.compile();
       * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
       */;var I=function(){function e(e){this.frames=[],this.duration=e||1,this.quality=.8}function t(e){function t(e,t,n){return[{data:e,id:231}].concat(n.map((function(e){var n=function(e){var t=0;e.keyframe&&(t|=128);e.invisible&&(t|=8);e.lacing&&(t|=e.lacing<<1);e.discardable&&(t|=1);if(e.trackNum>127)throw"TrackNumber > 127 not supported";return[128|e.trackNum,e.timecode>>8,255&e.timecode,t].map((function(e){return String.fromCharCode(e)})).join("")+e.frame}({discardable:0,frame:e.data.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(t)});return t+=e.duration,{data:n,id:163}})))}function n(e){for(var t=[];e>0;)t.push(255&e),e>>=8;return new Uint8Array(t.reverse())}function r(e){var t=[];e=(e.length%8?new Array(9-e.length%8).join("0"):"")+e;for(var n=0;n<e.length;n+=8)t.push(parseInt(e.substr(n,8),2));return new Uint8Array(t)}function a(e){for(var t=[],i=0;i<e.length;i++){var s=e[i].data;"object"==typeof s&&(s=a(s)),"number"==typeof s&&(s=r(s.toString(2))),"string"==typeof s&&(s=new Uint8Array(s.split("").map((function(e){return e.charCodeAt(0)}))));var o=s.size||s.byteLength||s.length,l=Math.ceil(Math.ceil(Math.log(o)/Math.log(2))/8),u=o.toString(2),c=new Array(7*l+7+1-u.length).join("0")+u,h=new Array(l).join("0")+"1"+c;t.push(n(e[i].id)),t.push(r(h)),t.push(s)}return new Blob(t,{type:"video/webm"})}function i(e,t){return parseInt(e.substr(t+4,4).split("").map((function(e){var t=e.charCodeAt(0).toString(2);return new Array(8-t.length+1).join("0")+t})).join(""),2)}function s(e){for(var t=0,n={};t<e.length;){var r=e.substr(t,4),a=i(e,t),o=e.substr(t+4+4,a);t+=8+a,n[r]=n[r]||[],"RIFF"===r||"LIST"===r?n[r].push(s(o)):n[r].push(o)}return n}var o=new function(e){var n=function(e){if(!e[0])return void postMessage({error:"Something went wrong. Maybe WebP format is not supported in the current browser."});for(var t=e[0].width,n=e[0].height,r=e[0].duration,a=1;a<e.length;a++)r+=e[a].duration;return{duration:r,width:t,height:n}}(e);if(!n)return[];for(var r,i=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:(r=n.duration,[].slice.call(new Uint8Array(new Float64Array([r]).buffer),0).map((function(e){return String.fromCharCode(e)})).reverse().join("")),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:29637},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:n.width,id:176},{data:n.height,id:186}]}]}]}]}],s=0,o=0;s<e.length;){var l=[],u=0;do{l.push(e[s]),u+=e[s].duration,s++}while(s<e.length&&u<3e4);var c={id:524531317,data:t(o,0,l)};i[1].data.push(c),o+=u}return a(i)}(e.map((function(e){var t=function(e){for(var t=e.RIFF[0].WEBP[0],n=t.indexOf("*"),r=0,a=[];r<4;r++)a[r]=t.charCodeAt(n+3+r);return{width:16383&(a[1]<<8|a[0]),height:16383&(a[3]<<8|a[2]),data:t,riff:e}}(s(atob(e.image.slice(23))));return t.duration=e.duration,t})));postMessage(o)}return e.prototype.add=function(e,t){if("canvas"in e&&(e=e.canvas),"toDataURL"in e&&(e=e.toDataURL("image/webp",this.quality)),!/^data:image\/webp;base64,/gi.test(e))throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp";this.frames.push({image:e,duration:t||this.duration})},e.prototype.compile=function(e){var n,r,a,i=(n=t,r=c.createObjectURL(new Blob([n.toString(),"this.onmessage =  function (eee) {"+n.name+"(eee.data);}"],{type:"application/javascript"})),a=new Worker(r),c.revokeObjectURL(r),a);i.onmessage=function(t){t.data.error?console.error(t.data.error):e(t.data)},i.postMessage(this.frames)},{Video:e}}();void 0!==t&&(t.Whammy=I)
/**
       * DiskStorage is a standalone object used by {@link RecordRTC} to store recorded blobs in IndexedDB storage.
       * @summary Writing blobs into IndexedDB.
       * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
       * @author {@link https://MuazKhan.com|Muaz Khan}
       * @example
       * DiskStorage.Store({
       *     audioBlob: yourAudioBlob,
       *     videoBlob: yourVideoBlob,
       *     gifBlob  : yourGifBlob
       * });
       * DiskStorage.Fetch(function(dataURL, type) {
       *     if(type === 'audioBlob') { }
       *     if(type === 'videoBlob') { }
       *     if(type === 'gifBlob')   { }
       * });
       * // DiskStorage.dataStoreName = 'recordRTC';
       * // DiskStorage.onError = function(error) { };
       * @property {function} init - This method must be called once to initialize IndexedDB ObjectStore. Though, it is auto-used internally.
       * @property {function} Fetch - This method fetches stored blobs from IndexedDB.
       * @property {function} Store - This method stores blobs in IndexedDB.
       * @property {function} onError - This function is invoked for any known/unknown error.
       * @property {string} dataStoreName - Name of the ObjectStore created in IndexedDB storage.
       * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
       */;var A={init:function(){var e=this;if("undefined"!=typeof indexedDB&&void 0!==indexedDB.open){var t,n=this.dbName||location.href.replace(/\/|:|#|%|\.|\[|\]/g,""),r=indexedDB.open(n,1);r.onerror=e.onError,r.onsuccess=function(){((t=r.result).onerror=e.onError,t.setVersion)?1!==t.version?t.setVersion(1).onsuccess=function(){a(t),i()}:i():i()},r.onupgradeneeded=function(e){a(e.target.result)}}else console.error("IndexedDB API are not available in this browser.");function a(t){t.createObjectStore(e.dataStoreName)}function i(){var n=t.transaction([e.dataStoreName],"readwrite");function r(t){n.objectStore(e.dataStoreName).get(t).onsuccess=function(n){e.callback&&e.callback(n.target.result,t)}}e.videoBlob&&n.objectStore(e.dataStoreName).put(e.videoBlob,"videoBlob"),e.gifBlob&&n.objectStore(e.dataStoreName).put(e.gifBlob,"gifBlob"),e.audioBlob&&n.objectStore(e.dataStoreName).put(e.audioBlob,"audioBlob"),r("audioBlob"),r("videoBlob"),r("gifBlob")}},Fetch:function(e){return this.callback=e,this.init(),this},Store:function(e){return this.audioBlob=e.audioBlob,this.videoBlob=e.videoBlob,this.gifBlob=e.gifBlob,this.init(),this},onError:function(e){console.error(JSON.stringify(e,null,"\t"))},dataStoreName:"recordRTC",dbName:null};
/**
       * GifRecorder is standalone calss used by {@link RecordRTC} to record video or canvas into animated gif.
       * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
       * @author {@link https://MuazKhan.com|Muaz Khan}
       * @typedef GifRecorder
       * @class
       * @example
       * var recorder = new GifRecorder(mediaStream || canvas || context, { onGifPreview: function, onGifRecordingStarted: function, width: 1280, height: 720, frameRate: 200, quality: 10 });
       * recorder.record();
       * recorder.stop(function(blob) {
       *     img.src = URL.createObjectURL(blob);
       * });
       * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
       * @param {MediaStream} mediaStream - MediaStream object or HTMLCanvasElement or CanvasRenderingContext2D.
       * @param {object} config - {disableLogs:true, initCallback: function, width: 320, height: 240, frameRate: 200, quality: 10}
       */
function N(e,t){if("undefined"==typeof GIFEncoder){var n=document.createElement("script");n.src="https://www.webrtc-experiment.com/gif-recorder.js",(document.body||document.documentElement).appendChild(n)}t=t||{};var r=e instanceof CanvasRenderingContext2D||e instanceof HTMLCanvasElement;this.record=function(){"undefined"!=typeof GIFEncoder&&u?(r||(t.width||(t.width=c.offsetWidth||320),t.height||(t.height=c.offsetHeight||240),t.video||(t.video={width:t.width,height:t.height}),t.canvas||(t.canvas={width:t.width,height:t.height}),i.width=t.canvas.width||320,i.height=t.canvas.height||240,c.width=t.video.width||320,c.height=t.video.height||240),(d=new GIFEncoder).setRepeat(0),d.setDelay(t.frameRate||200),d.setQuality(t.quality||10),d.start(),"function"==typeof t.onGifRecordingStarted&&t.onGifRecordingStarted(),p=s((function e(n){if(!0!==f.clearedRecordedData){if(a)return setTimeout((function(){e(n)}),100);p=s(e),void 0===typeof h&&(h=n),n-h<90||(!r&&c.paused&&c.play(),r||o.drawImage(c,0,0,i.width,i.height),t.onGifPreview&&t.onGifPreview(i.toDataURL("image/png")),d.addFrame(o),h=n)}})),t.initCallback&&t.initCallback()):setTimeout(f.record,1e3)},this.stop=function(e){e=e||function(){},p&&l(p),this.blob=new Blob([new Uint8Array(d.stream().bin)],{type:"image/gif"}),e(this.blob),d.stream().bin=[]};var a=!1;this.pause=function(){a=!0},this.resume=function(){a=!1},this.clearRecordedData=function(){f.clearedRecordedData=!0,d&&(d.stream().bin=[])},this.name="GifRecorder",this.toString=function(){return this.name};var i=document.createElement("canvas"),o=i.getContext("2d");r&&(e instanceof CanvasRenderingContext2D?i=(o=e).canvas:e instanceof HTMLCanvasElement&&(o=e.getContext("2d"),i=e));var u=!0;if(!r){var c=document.createElement("video");c.muted=!0,c.autoplay=!0,c.playsInline=!0,u=!1,c.onloadedmetadata=function(){u=!0},T(e,c),c.play()}var h,d,p=null,f=this}function $(e,n){!function(e){void 0===t&&e&&"undefined"==typeof window&&void 0!==commonjsGlobal&&(commonjsGlobal.navigator={userAgent:"Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45",getUserMedia:function(){}},commonjsGlobal.console||(commonjsGlobal.console={}),void 0!==commonjsGlobal.console.log&&void 0!==commonjsGlobal.console.error||(commonjsGlobal.console.error=commonjsGlobal.console.log=commonjsGlobal.console.log||function(){console.log(arguments)}),"undefined"==typeof document&&(e.document={documentElement:{appendChild:function(){return""}}},document.createElement=document.captureStream=document.mozCaptureStream=function(){var e={getContext:function(){return e},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""},style:{}};return e},e.HTMLVideoElement=function(){}),"undefined"==typeof location&&(e.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(e.screen={width:0,height:0}),void 0===u&&(e.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),e.window=commonjsGlobal)}(void 0!==commonjsGlobal?commonjsGlobal:null),n=n||"multi-streams-mixer";var r=[],a=!1,i=document.createElement("canvas"),s=i.getContext("2d");i.style.opacity=0,i.style.position="absolute",i.style.zIndex=-1,i.style.top="-1000em",i.style.left="-1000em",i.className=n,(document.body||document.documentElement).appendChild(i),this.disableLogs=!1,this.frameInterval=10,this.width=360,this.height=240,this.useGainNode=!0;var o=this,l=window.AudioContext;void 0===l&&("undefined"!=typeof webkitAudioContext&&(l=webkitAudioContext),"undefined"!=typeof mozAudioContext&&(l=mozAudioContext));var u=window.URL;void 0===u&&"undefined"!=typeof webkitURL&&(u=webkitURL),"undefined"!=typeof navigator&&void 0===navigator.getUserMedia&&(void 0!==navigator.webkitGetUserMedia&&(navigator.getUserMedia=navigator.webkitGetUserMedia),void 0!==navigator.mozGetUserMedia&&(navigator.getUserMedia=navigator.mozGetUserMedia));var c=window.MediaStream;void 0===c&&"undefined"!=typeof webkitMediaStream&&(c=webkitMediaStream),void 0!==c&&void 0===c.prototype.stop&&(c.prototype.stop=function(){this.getTracks().forEach((function(e){e.stop()}))});var h={};function d(){if(!a){var e=r.length,t=!1,n=[];if(r.forEach((function(e){e.stream||(e.stream={}),e.stream.fullcanvas?t=e:n.push(e)})),t)i.width=t.stream.width,i.height=t.stream.height;else if(n.length){i.width=e>1?2*n[0].width:n[0].width;var s=1;3!==e&&4!==e||(s=2),5!==e&&6!==e||(s=3),7!==e&&8!==e||(s=4),9!==e&&10!==e||(s=5),i.height=n[0].height*s}else i.width=o.width||360,i.height=o.height||240;t&&t instanceof HTMLVideoElement&&p(t),n.forEach((function(e,t){p(e,t)})),setTimeout(d,o.frameInterval)}}function p(e,t){if(!a){var n=0,r=0,i=e.width,o=e.height;1===t&&(n=e.width),2===t&&(r=e.height),3===t&&(n=e.width,r=e.height),4===t&&(r=2*e.height),5===t&&(n=e.width,r=2*e.height),6===t&&(r=3*e.height),7===t&&(n=e.width,r=3*e.height),void 0!==e.stream.left&&(n=e.stream.left),void 0!==e.stream.top&&(r=e.stream.top),void 0!==e.stream.width&&(i=e.stream.width),void 0!==e.stream.height&&(o=e.stream.height),s.drawImage(e,n,r,i,o),"function"==typeof e.stream.onRender&&e.stream.onRender(s,n,r,i,o,t)}}function f(e){var t=document.createElement("video");return function(e,t){"srcObject"in t?t.srcObject=e:"mozSrcObject"in t?t.mozSrcObject=e:t.srcObject=e}(e,t),t.className=n,t.muted=!0,t.volume=0,t.width=e.width||o.width||360,t.height=e.height||o.height||240,t.play(),t}function m(t){r=[],(t=t||e).forEach((function(e){if(e.getTracks().filter((function(e){return"video"===e.kind})).length){var t=f(e);t.stream=e,r.push(t)}}))}void 0!==l?h.AudioContext=l:"undefined"!=typeof webkitAudioContext&&(h.AudioContext=webkitAudioContext),this.startDrawingFrames=function(){d()},this.appendStreams=function(t){if(!t)throw"First parameter is required.";t instanceof Array||(t=[t]),t.forEach((function(t){var n=new c;if(t.getTracks().filter((function(e){return"video"===e.kind})).length){var a=f(t);a.stream=t,r.push(a),n.addTrack(t.getTracks().filter((function(e){return"video"===e.kind}))[0])}if(t.getTracks().filter((function(e){return"audio"===e.kind})).length){var i=o.audioContext.createMediaStreamSource(t);o.audioDestination=o.audioContext.createMediaStreamDestination(),i.connect(o.audioDestination),n.addTrack(o.audioDestination.stream.getTracks().filter((function(e){return"audio"===e.kind}))[0])}e.push(n)}))},this.releaseStreams=function(){r=[],a=!0,o.gainNode&&(o.gainNode.disconnect(),o.gainNode=null),o.audioSources.length&&(o.audioSources.forEach((function(e){e.disconnect()})),o.audioSources=[]),o.audioDestination&&(o.audioDestination.disconnect(),o.audioDestination=null),o.audioContext&&o.audioContext.close(),o.audioContext=null,s.clearRect(0,0,i.width,i.height),i.stream&&(i.stream.stop(),i.stream=null)},this.resetVideoStreams=function(e){!e||e instanceof Array||(e=[e]),m(e)},this.name="MultiStreamsMixer",this.toString=function(){return this.name},this.getMixedStream=function(){a=!1;var t=function(){var e;m(),"captureStream"in i?e=i.captureStream():"mozCaptureStream"in i?e=i.mozCaptureStream():o.disableLogs||console.error("Upgrade to latest Chrome or otherwise enable this flag: chrome://flags/#enable-experimental-web-platform-features");var t=new c;return e.getTracks().filter((function(e){return"video"===e.kind})).forEach((function(e){t.addTrack(e)})),i.stream=t,t}(),n=function(){h.AudioContextConstructor||(h.AudioContextConstructor=new h.AudioContext);o.audioContext=h.AudioContextConstructor,o.audioSources=[],!0===o.useGainNode&&(o.gainNode=o.audioContext.createGain(),o.gainNode.connect(o.audioContext.destination),o.gainNode.gain.value=0);var t=0;if(e.forEach((function(e){if(e.getTracks().filter((function(e){return"audio"===e.kind})).length){t++;var n=o.audioContext.createMediaStreamSource(e);!0===o.useGainNode&&n.connect(o.gainNode),o.audioSources.push(n)}})),!t)return;return o.audioDestination=o.audioContext.createMediaStreamDestination(),o.audioSources.forEach((function(e){e.connect(o.audioDestination)})),o.audioDestination.stream}();return n&&n.getTracks().filter((function(e){return"audio"===e.kind})).forEach((function(e){t.addTrack(e)})),e.forEach((function(e){e.fullcanvas})),t}}
/**
       * MultiStreamRecorder can record multiple videos in single container.
       * @summary Multi-videos recorder.
       * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
       * @author {@link https://MuazKhan.com|Muaz Khan}
       * @typedef MultiStreamRecorder
       * @class
       * @example
       * var options = {
       *     mimeType: 'video/webm'
       * }
       * var recorder = new MultiStreamRecorder(ArrayOfMediaStreams, options);
       * recorder.record();
       * recorder.stop(function(blob) {
       *     video.src = URL.createObjectURL(blob);
       *
       *     // or
       *     var blob = recorder.blob;
       * });
       * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
       * @param {MediaStreams} mediaStreams - Array of MediaStreams.
       * @param {object} config - {disableLogs:true, frameInterval: 1, mimeType: "video/webm"}
       */
function D(e,t){e=e||[];var n,r,a=this;(t=t||{elementClass:"multi-streams-mixer",mimeType:"video/webm",video:{width:360,height:240}}).frameInterval||(t.frameInterval=10),t.video||(t.video={}),t.video.width||(t.video.width=360),t.video.height||(t.video.height=240),this.record=function(){var a;n=new $(e,t.elementClass||"multi-streams-mixer"),(a=[],e.forEach((function(e){x(e,"video").forEach((function(e){a.push(e)}))})),a).length&&(n.frameInterval=t.frameInterval||10,n.width=t.video.width||360,n.height=t.video.height||240,n.startDrawingFrames()),t.previewStream&&"function"==typeof t.previewStream&&t.previewStream(n.getMixedStream()),(r=new S(n.getMixedStream(),t)).record()},this.stop=function(e){r&&r.stop((function(t){a.blob=t,e(t),a.clearRecordedData()}))},this.pause=function(){r&&r.pause()},this.resume=function(){r&&r.resume()},this.clearRecordedData=function(){r&&(r.clearRecordedData(),r=null),n&&(n.releaseStreams(),n=null)},this.addStreams=function(a){if(!a)throw"First parameter is required.";a instanceof Array||(a=[a]),e.concat(a),r&&n&&(n.appendStreams(a),t.previewStream&&"function"==typeof t.previewStream&&t.previewStream(n.getMixedStream()))},this.resetVideoStreams=function(e){n&&(!e||e instanceof Array||(e=[e]),n.resetVideoStreams(e))},this.getMixer=function(){return n},this.name="MultiStreamRecorder",this.toString=function(){return this.name}}
/**
       * WebAssemblyRecorder lets you create webm videos in JavaScript via WebAssembly. The library consumes raw RGBA32 buffers (4 bytes per pixel) and turns them into a webm video with the given framerate and quality. This makes it compatible out-of-the-box with ImageData from a CANVAS. With realtime mode you can also use webm-wasm for streaming webm videos.
       * @summary Video recording feature in Chrome, Firefox and maybe Edge.
       * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
       * @author {@link https://MuazKhan.com|Muaz Khan}
       * @typedef WebAssemblyRecorder
       * @class
       * @example
       * var recorder = new WebAssemblyRecorder(mediaStream);
       * recorder.record();
       * recorder.stop(function(blob) {
       *     video.src = URL.createObjectURL(blob);
       * });
       * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
       * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
       * @param {object} config - {webAssemblyPath:'webm-wasm.wasm',workerPath: 'webm-worker.js', frameRate: 30, width: 1920, height: 1080, bitrate: 1024, realtime: true}
       */
function P(e,t){var n,r,a;function i(o,l){if(!t.workerPath&&!l)return n=!1,void fetch("https://unpkg.com/webm-wasm@latest/dist/webm-worker.js").then((function(e){e.arrayBuffer().then((function(e){i(o,e)}))}));if(!t.workerPath&&l instanceof ArrayBuffer){var u=new Blob([l],{type:"text/javascript"});t.workerPath=c.createObjectURL(u)}t.workerPath||console.error("workerPath parameter is missing."),(r=new Worker(t.workerPath)).postMessage(t.webAssemblyPath||"https://unpkg.com/webm-wasm@latest/dist/webm-wasm.wasm"),r.addEventListener("message",(function(i){"READY"===i.data?(r.postMessage({width:t.width,height:t.height,bitrate:t.bitrate||1200,timebaseDen:t.frameRate||30,realtime:t.realtime}),new ReadableStream({start:function(r){var a=document.createElement("canvas"),i=document.createElement("video"),s=!0;i.srcObject=e,i.muted=!0,i.height=t.height,i.width=t.width,i.volume=0,i.onplaying=function(){a.width=t.width,a.height=t.height;var e=a.getContext("2d"),o=1e3/t.frameRate,l=setInterval((function(){if(n&&(clearInterval(l),r.close()),s&&(s=!1,t.onVideoProcessStarted&&t.onVideoProcessStarted()),e.drawImage(i,0,0),"closed"!==r._controlledReadableStream.state)try{r.enqueue(e.getImageData(0,0,t.width,t.height))}catch(a){}}),o)},i.play()}}).pipeTo(new WritableStream({write:function(e){n?console.error("Got image, but recorder is finished!"):r.postMessage(e.data.buffer,[e.data.buffer])}}))):i.data&&(a||s.push(i.data))}))}"undefined"!=typeof ReadableStream&&"undefined"!=typeof WritableStream||console.error("Following polyfill is strongly recommended: https://unpkg.com/@mattiasbuelens/web-streams-polyfill/dist/polyfill.min.js"),(t=t||{}).width=t.width||640,t.height=t.height||480,t.frameRate=t.frameRate||30,t.bitrate=t.bitrate||1200,t.realtime=t.realtime||!0,this.record=function(){s=[],a=!1,this.blob=null,i(e),"function"==typeof t.initCallback&&t.initCallback()},this.pause=function(){a=!0},this.resume=function(){a=!1};var s=[];this.stop=function(e){n=!0;var t=this;!function(e){r?(r.addEventListener("message",(function(t){null===t.data&&(r.terminate(),r=null,e&&e())})),r.postMessage(null)):e&&e()}((function(){t.blob=new Blob(s,{type:"video/webm"}),e(t.blob)}))},this.name="WebAssemblyRecorder",this.toString=function(){return this.name},this.clearRecordedData=function(){s=[],a=!1,this.blob=null},this.blob=null}void 0!==t&&(t.DiskStorage=A),void 0!==t&&(t.GifRecorder=N),void 0===t&&(e.exports=$),void 0!==t&&(t.MultiStreamRecorder=D)
/**
       * RecordRTCPromisesHandler adds promises support in {@link RecordRTC}. Try a {@link https://github.com/muaz-khan/RecordRTC/blob/master/simple-demos/RecordRTCPromisesHandler.html|demo here}
       * @summary Promises for {@link RecordRTC}
       * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
       * @author {@link https://MuazKhan.com|Muaz Khan}
       * @typedef RecordRTCPromisesHandler
       * @class
       * @example
       * var recorder = new RecordRTCPromisesHandler(mediaStream, options);
       * recorder.startRecording()
       *         .then(successCB)
       *         .catch(errorCB);
       * // Note: You can access all RecordRTC API using "recorder.recordRTC" e.g. 
       * recorder.recordRTC.onStateChanged = function(state) {};
       * recorder.recordRTC.setRecordingDuration(5000);
       * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
       * @param {MediaStream} mediaStream - Single media-stream object, array of media-streams, html-canvas-element, etc.
       * @param {object} config - {type:"video", recorderType: MediaStreamRecorder, disableLogs: true, numberOfAudioChannels: 1, bufferSize: 0, sampleRate: 0, video: HTMLVideoElement, etc.}
       * @throws Will throw an error if "new" keyword is not used to initiate "RecordRTCPromisesHandler". Also throws error if first argument "MediaStream" is missing.
       * @requires {@link RecordRTC}
       */,void 0!==t&&(t.RecordRTCPromisesHandler=function(e,n){if(!this)throw'Use "new RecordRTCPromisesHandler()"';if(void 0===e)throw'First argument "MediaStream" is required.';var r=this;r.recordRTC=new t(e,n),this.startRecording=function(){return new Promise((function(e,t){try{r.recordRTC.startRecording(),e()}catch(n){t(n)}}))},this.stopRecording=function(){return new Promise((function(e,t){try{r.recordRTC.stopRecording((function(n){r.blob=r.recordRTC.getBlob(),r.blob&&r.blob.size?e(n):t("Empty blob.",r.blob)}))}catch(n){t(n)}}))},this.pauseRecording=function(){return new Promise((function(e,t){try{r.recordRTC.pauseRecording(),e()}catch(n){t(n)}}))},this.resumeRecording=function(){return new Promise((function(e,t){try{r.recordRTC.resumeRecording(),e()}catch(n){t(n)}}))},this.getDataURL=function(e){return new Promise((function(e,t){try{r.recordRTC.getDataURL((function(t){e(t)}))}catch(n){t(n)}}))},this.getBlob=function(){return new Promise((function(e,t){try{e(r.recordRTC.getBlob())}catch(n){t(n)}}))},this.getInternalRecorder=function(){return new Promise((function(e,t){try{e(r.recordRTC.getInternalRecorder())}catch(n){t(n)}}))},this.reset=function(){return new Promise((function(e,t){try{e(r.recordRTC.reset())}catch(n){t(n)}}))},this.destroy=function(){return new Promise((function(e,t){try{e(r.recordRTC.destroy())}catch(n){t(n)}}))},this.getState=function(){return new Promise((function(e,t){try{e(r.recordRTC.getState())}catch(n){t(n)}}))},this.blob=null,this.version="5.6.2"}),void 0!==t&&(t.WebAssemblyRecorder=P)}(RecordRTC$1);var RecordRTCExports=RecordRTC$1.exports;const RecordRTC=getDefaultExportFromCjs(RecordRTCExports);class FaceHelper{static calculateYawPitchRoll(e){const t=e.map((e=>[e.x,e.y,e.z])),n=this.averageLandmarks(Array.from(new Set(this.FACEMESH_LEFT_EYE.flat())).map((e=>t[e]))),r=this.averageLandmarks(Array.from(new Set(this.FACEMESH_RIGHT_EYE.flat())).map((e=>t[e]))),a=t[30],i=this.averageLandmarks(Array.from(new Set(this.FACEMESH_LIPS.flat())).map((e=>t[e]))),s=this.subtractVectors(r,n),o=this.subtractVectors(i,a),l=this.crossProduct(s,o);return[Math.atan2(l[0],l[2]),Math.atan2(l[1],l[2]),Math.atan2(s[1],s[0])].map((e=>Math.abs(180-Math.abs(180*e/Math.PI))))}static averageLandmarks(e){const t=e.reduce(((e,t)=>this.addVectors(e,t)));return this.divideVectorByScalar(t,e.length)}static subtractVectors(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]}static addVectors(e,t){return[e[0]+t[0],e[1]+t[1],e[2]+t[2]]}static divideVectorByScalar(e,t){return[e[0]/t,e[1]/t,e[2]/t]}static crossProduct(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}static calculateYawPitchRoll2(e){const t=this.averagePosition(e.getLeftEye()),n=this.averagePosition(e.getRightEye()),r=this.averagePosition(e.getNose()),a=[n[0]-t[0],n[1]-t[1]],i=[r[0]-(t[0]+n[0])/2,r[1]-(t[1]+n[1])/2],s=Math.atan2(a[1],a[0])-Math.atan2(i[1],i[0]),o=Math.atan2(i[0],i[1]),l=Math.atan2(a[1],a[0]);return{yaw:this.toDegrees(s)+90,pitch:this.toDegrees(o),roll:this.toDegrees(l)}}static averagePosition(e){const t=e.reduce(((e,t)=>[e[0]+t.x,e[1]+t.y]),[0,0]);return[t[0]/e.length,t[1]/e.length]}static toDegrees(e){return e*(180/Math.PI)}static handleValidateFaceOval(e,t){const{width:n,height:r}=t,a=e.map((e=>e.x)),i=e.map((e=>e.y)),s=Math.min(...a),o=Math.max(...a),l=Math.min(...i),u=Math.max(...i),c=.7*n,h=c/(2/3);return s>=(n-c)/2&&o<=n-(n-c)/2&&l>=(r-h)/2&&u<=r-(r-h)/2}}__publicField(FaceHelper,"FACE_CONSTRAIN",{yaw:15,pitch:15,roll:15}),__publicField(FaceHelper,"FACEMESH_FACE_OVAL",[[10,338],[338,297],[297,332],[332,284],[284,251],[251,389],[389,356],[356,454],[454,323],[323,361],[361,288],[288,397],[397,365],[365,379],[379,378],[378,400],[400,377],[377,152],[152,148],[148,176],[176,149],[149,150],[150,136],[136,172],[172,58],[58,132],[132,93],[93,234],[234,127],[127,162],[162,21],[21,54],[54,103],[103,67],[67,109],[109,10]]),__publicField(FaceHelper,"FACEMESH_LIPS",[[61,146],[146,91],[91,181],[181,84],[84,17],[17,314],[314,405],[405,321],[321,375],[375,291],[61,185],[185,40],[40,39],[39,37],[37,0],[0,267],[267,269],[269,270],[270,409],[409,291],[78,95],[95,88],[88,178],[178,87],[87,14],[14,317],[317,402],[402,318],[318,324],[324,308],[78,191],[191,80],[80,81],[81,82],[82,13],[13,312],[312,311],[311,310],[310,415],[415,308]]),__publicField(FaceHelper,"FACEMESH_LEFT_EYE",[[263,249],[249,390],[390,373],[373,374],[374,380],[380,381],[381,382],[382,362],[263,466],[466,388],[388,387],[387,386],[386,385],[385,384],[384,398],[398,362]]),__publicField(FaceHelper,"FACEMESH_RIGHT_EYE",[[33,7],[7,163],[163,144],[144,145],[145,153],[153,154],[154,155],[155,133],[33,246],[246,161],[161,160],[160,159],[159,158],[158,157],[157,173],[173,133]]);const{yaw:cYaw,pitch:cPitch,roll:cRoll}=FaceHelper.FACE_CONSTRAIN,RECORD_DURATION=3e3;let mediaRecorder=null,recordTimeout=null,messageInterval=null,isRecording=!1,canRecord=!1;function initLivenessAnimation(){const e=document.getElementById("fci-liveness-ani-container");e&&(e.classList.remove("fci-liveness-ani-container-hidden"),loadAnimationLiveness(e))}async function initWebcam$1(){var e;const t=document.getElementById("fci-liveness-webcam");if(!t)return;if((await navigator.mediaDevices.enumerateDevices()).filter((e=>"videoinput"===e.kind&&!e.label.toLowerCase().includes("virtual"))).length<1)return alert("No camera detected"),void window.ekyc.dispose();navigator.mediaDevices&&(null==(e=navigator.mediaDevices)?void 0:e.getUserMedia)&&(setLayoutLoading(!0),navigator.mediaDevices.getUserMedia({video:{width:{ideal:720},height:{ideal:1280},aspectRatio:{exact:3/4,ideal:3/4},facingMode:{ideal:"user"},frameRate:{ideal:30}},audio:!1}).then((async e=>{t.srcObject=e,setMessage("headStraight"),Utils.onDisconnectDom(document.getElementById("fci-liveness-container"),(()=>{t.srcObject=null,Utils.handleStopStream(e),handleStopRecording(),isRecording=!1,canRecord=!1})),t.play(),t.addEventListener("loadedmetadata",(async()=>{handleCanvasSize$1(t);const e=`${window.ekyc._assets_config.faceapi_base_url}`;await nets.tinyFaceDetector.loadFromUri(e),await loadFaceLandmarkTinyModel(e),setLayoutLoading(!1);const n=new TinyFaceDetectorOptions({inputSize:128,scoreThreshold:.4});loopDrawFaceLandmark(t,n),canRecord=!0})),new ResizeObserver((()=>handleCanvasSize$1(t))).observe(t)})))}async function loopDrawFaceLandmark(e,t){const n=await detectSingleFace(e,t).withFaceLandmarks(!0);requestAnimationFrame((()=>{loopDrawFaceLandmark(e,t)}));const r=document.getElementById("fci-liveness-canvas");if(!r)return;const a=r.getContext("2d");if(!a)return;if(a.clearRect(0,0,a.canvas.width,a.canvas.height),!n)return setMessage("noFaceDetected");const{yaw:i,pitch:s,roll:o}=FaceHelper.calculateYawPitchRoll2(n.landmarks),l=i<=cYaw&&s<=cPitch&&o<=cRoll&&FaceHelper.handleValidateFaceOval(n.landmarks.positions,r);handleDisplayMessage(l,i,s,o);const u=document.getElementById("fci-liveness-oval");u&&(u.style.borderColor=l?"var(--fci-capture-box-valid-color)":"var(--fci-capture-box-invalid-color)")}function handleCanvasSize$1(e){const t=document.getElementById("fci-liveness-canvas");if(!t)return;t.width=e.videoWidth,t.height=e.videoHeight;const{width:n,height:r}=e.getBoundingClientRect();t.style.setProperty("width",`${n}px`),t.style.setProperty("height",`${r}px`);const a=document.getElementById("fci-liveness-oval-wrapper");a&&(a.style.setProperty("width",`${n}px`),a.style.setProperty("height",`${r}px`))}function setMessage(e){const t=document.getElementById("fci-liveness-message");t&&(t.innerText=i18n(e))}function handleDisplayMessage(e,t,n,r){if(!e)return handleStopRecording(),setMessage(t>cYaw||n>cPitch?"headStraight":"faceStraight");handleRecordVideo()}function handleRecordVideo(){if(isRecording||!canRecord)return;const e=document.getElementById("fci-liveness-webcam");if(!(null==e?void 0:e.srcObject))return;null!==recordTimeout&&window.clearTimeout(recordTimeout);try{mediaRecorder=new RecordRTC(e.srcObject,{mimeType:"video/webm;codecs=vp8",videoBitsPerSecond:15e6,disableLogs:!0})}catch(n){mediaRecorder=new RecordRTC(e.srcObject,{mimeType:"video/mp4",videoBitsPerSecond:15e6,disableLogs:!0})}mediaRecorder.startRecording(),isRecording=!0;let t=RECORD_DURATION;setMessage(`${i18n("recording")} ${Math.floor(RECORD_DURATION/1e3)} ${i18n("seconds")}`),messageInterval=window.setInterval((()=>{t=Math.max(t-1e3,0),setMessage(`${i18n("recording")} ${Math.floor(t/1e3)} ${i18n("seconds")}`)}),1e3),recordTimeout=window.setTimeout((()=>{mediaRecorder&&mediaRecorder.stopRecording((()=>{canRecord=!1;const e=mediaRecorder.getBlob();e&&onFinishRecording(e),mediaRecorder=null,null!==recordTimeout&&window.clearTimeout(recordTimeout),null!==messageInterval&&window.clearInterval(messageInterval),isRecording=!1,setMessage("")}))}),RECORD_DURATION+500)}function handleStopRecording(){mediaRecorder&&(mediaRecorder.stopRecording(),mediaRecorder=null),null!==recordTimeout&&window.clearTimeout(recordTimeout),null!==messageInterval&&window.clearInterval(messageInterval),isRecording=!1}function onFinishRecording(e){const t=new File([e],"video.mp4",{type:"video/mp4"});window.ekyc.resultStore.livenessFiles=[t],handleLiveness()}function handleLiveness(){setLayoutLoading(!0),window.ekyc.liveness().then((e=>{setLayoutLoading(!1),window.ekyc.resultStore.livenessResult=e,window.ekyc.handleCallback(),"200"!==e.code?(window.ekyc.moveToStep(6),handleChangeLayout()):window.ekyc.config_setting.is_show_ekyc_result?(window.ekyc.moveToStep(7),handleChangeLayout()):(window.ekyc.moveToStep(0),handleChangeLayout())})).catch((e=>{setLayoutLoading(!1),console.warn(e),window.ekyc.moveToStep(0),handleChangeLayout()}))}function initBottomTitle(){const e=document.getElementById("fci-liveness-bottom-title");e&&(e.innerText=window.ekyc.getText("kyc_video_title")??i18n("recordVideoOfFace"))}function initBottomDetails(){const e=document.getElementById("fci-liveness-bottom-details");e&&(e.innerText=window.ekyc.getText("kyc_video_suggestion1")??i18n("pleaseKeepYourFaceInTheRecordingArea"))}function initLiveness(){initLivenessAnimation(),initWebcam$1(),initBottomTitle(),initBottomDetails()}function livenessHtml(){return'\n        <div id="fci-liveness-container"\n            class="fci-liveness-container">\n            <video id="fci-liveness-webcam"\n                class="fci-liveness-webcam"\n                muted\n                playsinline\n                controlsList="nodownload noplaybackrate"\n                disablePictureInPicture\n                autoplay></video>\n            <canvas id="fci-liveness-canvas"></canvas>\n            <div id="fci-liveness-oval-wrapper">\n                <div id="fci-liveness-oval"></div>\n            </div>\n            <div class="fci-liveness-message-container">\n                <div id="fci-liveness-message"></div>\n            </div>\n            <div class="fci-liveness-bottom">\n                <span id="fci-liveness-bottom-title"></span>\n                <span id="fci-liveness-bottom-details"></span>\n            </div>\n        </div>\n        '}function loadLiveness(e){Utils.load(e,livenessHtml(),initLiveness)}function initTitle(){const e=document.getElementById("fci-liveness-error-title");e&&(e.innerText=window.ekyc.getText("let_s_try_again"))}function initDetail(){const e=document.getElementById("fci-liveness-error-detail");e&&(e.innerText=window.ekyc.getText("kyc_no_success"))}function initImages$1(){var e,t,n,r;const a=document.getElementById("fci-liveness-error-image-container");if(!a)return;const i=[null==(t=null==(e=window.ekyc.resultStore)?void 0:e.livenessResult)?void 0:t.video_face_url,null==(r=null==(n=window.ekyc.resultStore)?void 0:n.livenessResult)?void 0:r.compared_face_url];a.innerHTML="";const s=["yourSelfie","idealPose"];i.forEach(((e,t)=>{const n=document.createElement("div");n.classList.add("fci-liveness-error-image-wrapper");const r=document.createElement("img");r.src=e,r.alt=i18n(s[t]),r.classList.add("fci-liveness-error-image");const i=document.createElement("span");i.innerText=i18n(s[t]),i.classList.add("fci-liveness-error-image-label"),n.appendChild(r),n.appendChild(i),a.appendChild(n)}))}function initMessage(){var e,t;const n=document.getElementById("fci-liveness-error-message");n&&(n.innerText=null==(t=null==(e=window.ekyc.resultStore)?void 0:e.livenessResult)?void 0:t.message)}function initActionBtn(){var e;const t=document.getElementById("fci-liveness-error-action-btn");t&&(t.innerText=(null==(e=window.ekyc.resultStore)?void 0:e.livenessResult.is_complete_session)?i18n("cancel"):window.ekyc.getText("kyc_try_again"),t.onclick=async()=>{var e;(null==(e=window.ekyc.resultStore)?void 0:e.livenessResult.is_complete_session)?(await window.ekyc.dispose(),window.ekyc.moveToStep(0),handleChangeLayout()):(window.ekyc.moveToStep(5),handleChangeLayout())})}function initLivenessError(){initTitle(),initDetail(),initImages$1(),initMessage(),initActionBtn()}function livenessErrorHtml(){return'\n        <div id="fci-liveness-error-container">\n            <div id="fci-liveness-error-wrapper">\n                <div id="fci-liveness-error-title-container">\n                    <span id="fci-liveness-error-title"></span>\n                    <span id="fci-liveness-error-detail"></span>\n                </div>\n                <div id="fci-liveness-error-image-container">\n                </div>\n\n                <div id="fci-liveness-error-message"></div>\n            </div>\n\n            <div id="fci-liveness-error-action">\n                <button class="fci-btn fci-btn-lg fci-btn-primary" id="fci-liveness-error-action-btn"></button>\n            </div>\n        </div>\n        '}function loadLivenessError(e){Utils.load(e,livenessErrorHtml(),initLivenessError)}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const EPSILON_FLOAT32$1=1e-7,EPSILON_FLOAT16$1=1e-4;class DataStorage{constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class KernelBackend{refCount(e){return notYetImplemented("refCount")}incRef(e){return notYetImplemented("incRef")}timerAvailable(){return!0}time(e){return notYetImplemented("time")}read(e){return notYetImplemented("read")}readSync(e){return notYetImplemented("readSync")}readToGPU(e,t){return notYetImplemented("readToGPU")}numDataIds(){return notYetImplemented("numDataIds")}disposeData(e,t){return notYetImplemented("disposeData")}write(e,t,n){return notYetImplemented("write")}move(e,t,n,r,a){return notYetImplemented("move")}createTensorFromGPUData(e,t,n){return notYetImplemented("createTensorFromGPUData")}memory(){return notYetImplemented("memory")}floatPrecision(){return notYetImplemented("floatPrecision")}epsilon(){return 32===this.floatPrecision()?EPSILON_FLOAT32$1:EPSILON_FLOAT16$1}dispose(){return notYetImplemented("dispose")}}function notYetImplemented(e){throw new Error(`'${e}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function shuffle(e){let t=e.length,n=0;for(;t>0;)n=Math.random()*t|0,t--,swap(e,t,n)}function clamp$1(e,t,n){return Math.max(e,Math.min(t,n))}function nearestLargerEven(e){return e%2==0?e:e+1}function swap(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function sum$3(e){let t=0;for(let n=0;n<e.length;n++)t+=e[n];return t}function assert$1(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function assertShapesMatch(e,t,n=""){assert$1(arraysEqual(e,t),(()=>n+` Shapes ${e} and ${t} must match`))}function assertNonNull(e){assert$1(null!=e,(()=>"The input to the tensor constructor must be a non-null value."))}function sizeFromShape(e){if(0===e.length)return 1;let t=e[0];for(let n=1;n<e.length;n++)t*=e[n];return t}function arraysEqualWithNull(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(null!==e[n]&&null!==t[n]&&e[n]!==t[n])return!1;return!0}function arraysEqual(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function isInt(e){return e%1==0}function sizeToSquarishShape(e){const t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function rightPad(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function repeatedTry(e,t=(e=>0),n,r){return new Promise(((a,i)=>{let s=0;const o=()=>{if(e())return void a();s++;const l=t(s);null!=n&&s>=n?i():null!=r?r(o,l):setTimeout(o,l)};o()}))}function inferFromImplicitShape(e,t){let n=1,r=-1;for(let i=0;i<e.length;++i)if(e[i]>=0)n*=e[i];else if(-1===e[i]){if(-1!==r)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${r} and dim ${i}`);r=i}else if(e[i]<0)throw Error(`Shapes can not be < 0. Found ${e[i]} at dim ${i}`);if(-1===r){if(t>0&&t!==n)throw Error(`Size(${t}) must match the product of shape ${e}`);return e}if(0===n)throw Error(`Cannot infer the missing size in [${e}] when there are 0 elements`);if(t%n!=0)throw Error(`The implicit shape can't be a fractional number. Got ${t} / ${n}`);const a=e.slice();return a[r]=t/n,a}function parseAxisParam(e,t){const n=t.length;return assert$1((e=null==e?t.map(((e,t)=>t)):[].concat(e)).every((e=>e>=-n&&e<n)),(()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${e}`)),assert$1(e.every((e=>isInt(e))),(()=>`All values in axis param must be integers but got axis ${e}`)),e.map((e=>e<0?n+e:e))}function squeezeShape(e,t){const n=[],r=[],a=null!=t&&Array.isArray(t)&&0===t.length,i=null==t||a?null:parseAxisParam(t,e).sort();let s=0;for(let o=0;o<e.length;++o){if(null!=i){if(i[s]===o&&1!==e[o])throw new Error(`Can't squeeze axis ${o} since its dim '${e[o]}' is not 1`);(null==i[s]||i[s]>o)&&1===e[o]&&(n.push(e[o]),r.push(o)),i[s]<=o&&s++}1!==e[o]&&(n.push(e[o]),r.push(o))}return{newShape:n,keptDims:r}}function getTypedArrayFromDType(e,t){return getArrayFromDType(e,t)}function getArrayFromDType(e,t){let n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error(`Unknown data type ${e}`);n=new Array(t)}return n}function checkConversionForErrors(e,t){for(let n=0;n<e.length;n++){const r=e[n];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${t} being uploaded contains ${r}.`)}}function isValidDtype(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}function hasEncodingLoss(e,t){return"complex64"!==t&&(("float32"!==t||"complex64"===e)&&(("int32"!==t||"float32"===e||"complex64"===e)&&("bool"!==t||"bool"!==e)))}function bytesPerElement(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error(`Unknown dtype ${e}`)}function bytesFromStringArray(e){if(null==e)return 0;let t=0;return e.forEach((e=>t+=e.length)),t}function isString(e){return"string"==typeof e||e instanceof String}function isBoolean(e){return"boolean"==typeof e}function isNumber(e){return"number"==typeof e}function inferDtype(e){return Array.isArray(e)?inferDtype(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray?"int32":isNumber(e)?"float32":isString(e)?"string":isBoolean(e)?"bool":"float32"}function isFunction$2(e){return!!(e&&e.constructor&&e.call&&e.apply)}function nearestDivisor(e,t){for(let n=t;n<e;++n)if(e%n==0)return n;return e}function computeStrides(e){const t=e.length;if(t<2)return[];const n=new Array(t-1);n[t-2]=e[t-1];for(let r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function createNestedArray(e,t,n,r=!1){const a=new Array;if(1===t.length){const i=t[0]*(r?2:1);for(let t=0;t<i;t++)a[t]=n[e+t]}else{const i=t[0],s=t.slice(1),o=s.reduce(((e,t)=>e*t))*(r?2:1);for(let t=0;t<i;t++)a[t]=createNestedArray(e+t*o,s,n,r)}return a}function toNestedArray(e,t,n=!1){if(0===e.length)return t[0];const r=e.reduce(((e,t)=>e*t))*(n?2:1);if(0===r)return[];if(r!==t.length)throw new Error(`[${e}] does not match the input size ${t.length}${n?" for a complex tensor":""}.`);return createNestedArray(0,e,t,n)}function convertBackendValuesAndArrayBuffer(e,t){if(Array.isArray(e))return e;if("float32"===t)return e instanceof Float32Array?e:new Float32Array(e);if("int32"===t)return e instanceof Int32Array?e:new Int32Array(e);if("bool"===t||"string"===t)return Uint8Array.from(new Int32Array(e));throw new Error(`Unknown dtype ${t}`)}function makeOnesTypedArray(e,t){const n=makeZerosTypedArray(e,t);for(let r=0;r<n.length;r++)n[r]=1;return n}function makeZerosTypedArray(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error(`Unknown data type ${t}`)}function makeZerosNestedTypedArray(e,t){const n=e.reduce(((e,t)=>e*t),1);if(null==t||"float32"===t)return toNestedArray(e,new Float32Array(n));if("int32"===t)return toNestedArray(e,new Int32Array(n));if("bool"===t)return toNestedArray(e,new Uint8Array(n));throw new Error(`Unknown data type ${t}`)}function assertNonNegativeIntegerDimensions(e){e.forEach((t=>{assert$1(Number.isInteger(t)&&t>=0,(()=>`Tensor must have a shape comprised of positive integers but got shape [${e}].`))}))}function locToIndex(e,t,n){if(0===t)return 0;if(1===t)return e[0];let r=e[e.length-1];for(let a=0;a<e.length-1;++a)r+=n[a]*e[a];return r}function indexToLoc(e,t,n){if(0===t)return[];if(1===t)return[e];const r=new Array(t);for(let a=0;a<r.length-1;++a)r[a]=Math.floor(e/n[a]),e-=r[a]*n[a];return r[r.length-1]=e,r}function isPromise$1(e){return e&&e.then&&"function"==typeof e.then}
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const TENSORFLOWJS_FLAGS_PREFIX="tfjsflags";class Environment{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=getQueryParams,this.populateURLFlags()}setPlatform(e,t){null!=this.platform&&(env().getBool("IS_TEST")||env().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=t}registerFlag(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){const t=this.urlFlags[e];env().getBool("IS_TEST")||env().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${t}.`),this.set(e,t)}}async getAsync(e){return e in this.flags||(this.flags[e]=await this.evaluateFlag(e)),this.flags[e]}get(e){if(e in this.flags)return this.flags[e];const t=this.evaluateFlag(e);if(isPromise$1(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(null==this.flagRegistry[e])throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(null==this.flagRegistry[e])throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(void 0===this.global||void 0===this.global.location||void 0===this.global.location.search)return;const e=this.getQueryParams(this.global.location.search);if(TENSORFLOWJS_FLAGS_PREFIX in e){e[TENSORFLOWJS_FLAGS_PREFIX].split(",").forEach((e=>{const[t,n]=e.split(":");this.urlFlags[t]=parseValue(t,n)}))}}}function getQueryParams(e){const t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,((e,...n)=>(decodeParam(t,n[0],n[1]),n.join("=")))),t}function decodeParam(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}function parseValue(e,t){const n=t.toLowerCase();return"true"===n||"false"===n?"true"===n:""+ +n===n?+n:t}function env(){return ENV$4}let ENV$4=null,globalNameSpace;function setEnvironmentGlobal(e){ENV$4=e}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function getGlobalNamespace(){if(null==globalNameSpace){let e;if("undefined"!=typeof window)e=window;else if("undefined"!=typeof global)e=global;else if("undefined"!=typeof process)e=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");e=self}globalNameSpace=e}return globalNameSpace}function getGlobalMap(){const e=getGlobalNamespace();return null==e._tfGlobals&&(e._tfGlobals=new Map),e._tfGlobals}function getGlobal(e,t){const n=getGlobalMap();if(n.has(e))return n.get(e);{const r=t();return n.set(e,r),n.get(e)}}const Abs="Abs",Acos="Acos",Acosh="Acosh",Add$1="Add",AddN="AddN",All="All",Any="Any",ArgMax="ArgMax",ArgMin="ArgMin",Asin="Asin",Asinh="Asinh",Atan="Atan",Atanh="Atanh",Atan2="Atan2",AvgPool="AvgPool",AvgPoolGrad="AvgPoolGrad",AvgPool3D="AvgPool3D",AvgPool3DGrad="AvgPool3DGrad",BatchMatMul="BatchMatMul",BatchToSpaceND="BatchToSpaceND",Bincount="Bincount",BitwiseAnd="BitwiseAnd",BroadcastTo="BroadcastTo",BroadcastArgs="BroadcastArgs",Cast="Cast",Ceil="Ceil",ClipByValue="ClipByValue",Complex="Complex",ComplexAbs="ComplexAbs",Concat="Concat",Conv2D$1="Conv2D",Conv2DBackpropFilter="Conv2DBackpropFilter",Conv2DBackpropInput="Conv2DBackpropInput",Conv3D$1="Conv3D",Conv3DBackpropFilterV2="Conv3DBackpropFilterV2",Conv3DBackpropInputV2="Conv3DBackpropInputV2",Cos="Cos",Cosh="Cosh",Cumprod="Cumprod",Cumsum="Cumsum",CropAndResize="CropAndResize",DenseBincount="DenseBincount",DepthToSpace="DepthToSpace",DepthwiseConv2dNative="DepthwiseConv2dNative",DepthwiseConv2dNativeBackpropFilter="DepthwiseConv2dNativeBackpropFilter",DepthwiseConv2dNativeBackpropInput="DepthwiseConv2dNativeBackpropInput",Diag="Diag",Dilation2D="Dilation2D",Dilation2DBackpropInput="Dilation2DBackpropInput",Dilation2DBackpropFilter="Dilation2DBackpropFilter",Draw="Draw",RealDiv="RealDiv",Einsum="Einsum",Elu$1="Elu",EluGrad="EluGrad",Erf="Erf",Equal="Equal",Exp="Exp",ExpandDims="ExpandDims",Expm1="Expm1",FFT="FFT",Fill="Fill",FlipLeftRight="FlipLeftRight",Floor="Floor",FloorDiv="FloorDiv",FusedBatchNorm="FusedBatchNorm",GatherV2="GatherV2",GatherNd="GatherNd",Greater="Greater",GreaterEqual="GreaterEqual",Identity$1="Identity",IFFT="IFFT",Imag="Imag",IsFinite="IsFinite",IsInf="IsInf",IsNan="IsNan",LeakyRelu="LeakyRelu",Less="Less",LessEqual="LessEqual",LinSpace="LinSpace",Log="Log",Log1p="Log1p",LogicalAnd="LogicalAnd",LogicalNot="LogicalNot",LogicalOr="LogicalOr",LogSoftmax$1="LogSoftmax",LRN="LRN",LRNGrad="LRNGrad",Max="Max",Maximum$1="Maximum",MaxPool="MaxPool",MaxPoolGrad="MaxPoolGrad",MaxPool3D="MaxPool3D",MaxPool3DGrad="MaxPool3DGrad",MaxPoolWithArgmax="MaxPoolWithArgmax",Mean="Mean",Min="Min",Minimum$1="Minimum",MirrorPad="MirrorPad",Mod="Mod",Multinomial="Multinomial",Multiply$1="Multiply",Neg="Neg",NotEqual="NotEqual",NonMaxSuppressionV3="NonMaxSuppressionV3",NonMaxSuppressionV4="NonMaxSuppressionV4",NonMaxSuppressionV5="NonMaxSuppressionV5",OnesLike="OnesLike",OneHot="OneHot",Pack="Pack",PadV2="PadV2",Pow="Pow",Prelu="Prelu",Prod="Prod",RaggedGather="RaggedGather",RaggedRange="RaggedRange",RaggedTensorToTensor="RaggedTensorToTensor",Range="Range",Real="Real",Reciprocal="Reciprocal",Relu$1="Relu",Reshape$1="Reshape",ResizeNearestNeighbor="ResizeNearestNeighbor",ResizeNearestNeighborGrad="ResizeNearestNeighborGrad",ResizeBilinear="ResizeBilinear",ResizeBilinearGrad="ResizeBilinearGrad",Relu6$1="Relu6",Reverse="Reverse",Round="Round",Rsqrt="Rsqrt",ScatterNd="ScatterNd",TensorScatterUpdate="TensorScatterUpdate",SearchSorted="SearchSorted",Select="Select",Selu$1="Selu",Slice="Slice",Sin="Sin",Sinh="Sinh",Sign="Sign",Sigmoid$1="Sigmoid",Softplus$1="Softplus",Sqrt="Sqrt",Sum="Sum",SpaceToBatchND="SpaceToBatchND",SplitV="SplitV",Softmax$2="Softmax",SparseFillEmptyRows="SparseFillEmptyRows",SparseReshape="SparseReshape",SparseSegmentMean="SparseSegmentMean",SparseSegmentSum="SparseSegmentSum",SparseToDense="SparseToDense",SquaredDifference="SquaredDifference",Square="Square",StaticRegexReplace="StaticRegexReplace",StridedSlice="StridedSlice",StringNGrams="StringNGrams",StringSplit="StringSplit",StringToHashBucketFast="StringToHashBucketFast",Sub="Sub",Tan="Tan",Tanh$1="Tanh",Tile="Tile",TopK="TopK",Transform="Transform",Transpose="Transpose",Unique="Unique",Unpack="Unpack",UnsortedSegmentSum="UnsortedSegmentSum",ZerosLike="ZerosLike",Step="Step",FromPixels="FromPixels",RotateWithOffset="RotateWithOffset",_FusedMatMul="_FusedMatMul",FusedConv2D="FusedConv2D",FusedDepthwiseConv2D="FusedDepthwiseConv2D";
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function warn(...e){env().getBool("IS_TEST")||env().getBool("PROD")||console.warn(...e)}function log$5(...e){env().getBool("IS_TEST")||env().getBool("PROD")||console.log(...e)}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const kernelRegistry=getGlobal("kernelRegistry",(()=>new Map)),gradRegistry=getGlobal("gradRegistry",(()=>new Map));function getKernel(e,t){const n=makeKey(e,t);return kernelRegistry.get(n)}function getGradient(e){return gradRegistry.get(e)}function getKernelsForBackend(e){const t=kernelRegistry.entries(),n=[];for(;;){const{done:r,value:a}=t.next();if(r)break;const[i,s]=a,[o]=i.split("_");o===e&&n.push(s)}return n}function registerKernel(e){const{kernelName:t,backendName:n}=e,r=makeKey(t,n);kernelRegistry.has(r)&&warn(`The kernel '${t}' for backend '${n}' is already registered`),kernelRegistry.set(r,e)}function registerGradient(e){const{kernelName:t}=e;gradRegistry.has(t)&&env().getBool("DEBUG")&&warn(`Overriding the gradient for '${t}'`),gradRegistry.set(t,e)}function makeKey(e,t){return`${t}_${e}`}
/**
     * @license
     * Copyright 2023 Google LLC.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function isTypedArrayBrowser(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray}var long=Long$1,wasm=null;try{wasm=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e2){}function Long$1(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function isLong(e){return!0===(e&&e.__isLong__)}Long$1.prototype.__isLong__,Object.defineProperty(Long$1.prototype,"__isLong__",{value:!0}),Long$1.isLong=isLong;var INT_CACHE={},UINT_CACHE={};function fromInt(e,t){var n,r,a;return t?(a=0<=(e>>>=0)&&e<256)&&(r=UINT_CACHE[e])?r:(n=fromBits(e,(0|e)<0?-1:0,!0),a&&(UINT_CACHE[e]=n),n):(a=-128<=(e|=0)&&e<128)&&(r=INT_CACHE[e])?r:(n=fromBits(e,e<0?-1:0,!1),a&&(INT_CACHE[e]=n),n)}function fromNumber(e,t){if(isNaN(e))return t?UZERO:ZERO;if(t){if(e<0)return UZERO;if(e>=TWO_PWR_64_DBL)return MAX_UNSIGNED_VALUE}else{if(e<=-TWO_PWR_63_DBL)return MIN_VALUE;if(e+1>=TWO_PWR_63_DBL)return MAX_VALUE}return e<0?fromNumber(-e,t).neg():fromBits(e%TWO_PWR_32_DBL|0,e/TWO_PWR_32_DBL|0,t)}function fromBits(e,t,n){return new Long$1(e,t,n)}Long$1.fromInt=fromInt,Long$1.fromNumber=fromNumber,Long$1.fromBits=fromBits;var pow_dbl=Math.pow;function fromString(e,t,n){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return ZERO;if("number"==typeof t?(n=t,t=!1):t=!!t,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return fromString(e.substring(1),t,n).neg();for(var a=fromNumber(pow_dbl(n,8)),i=ZERO,s=0;s<e.length;s+=8){var o=Math.min(8,e.length-s),l=parseInt(e.substring(s,s+o),n);if(o<8){var u=fromNumber(pow_dbl(n,o));i=i.mul(u).add(fromNumber(l))}else i=(i=i.mul(a)).add(fromNumber(l))}return i.unsigned=t,i}function fromValue(e,t){return"number"==typeof e?fromNumber(e,t):"string"==typeof e?fromString(e,t):fromBits(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}Long$1.fromString=fromString,Long$1.fromValue=fromValue;var TWO_PWR_16_DBL=65536,TWO_PWR_24_DBL=1<<24,TWO_PWR_32_DBL=TWO_PWR_16_DBL*TWO_PWR_16_DBL,TWO_PWR_64_DBL=TWO_PWR_32_DBL*TWO_PWR_32_DBL,TWO_PWR_63_DBL=TWO_PWR_64_DBL/2,TWO_PWR_24=fromInt(TWO_PWR_24_DBL),ZERO=fromInt(0);Long$1.ZERO=ZERO;var UZERO=fromInt(0,!0);Long$1.UZERO=UZERO;var ONE=fromInt(1);Long$1.ONE=ONE;var UONE=fromInt(1,!0);Long$1.UONE=UONE;var NEG_ONE=fromInt(-1);Long$1.NEG_ONE=NEG_ONE;var MAX_VALUE=fromBits(-1,2147483647,!1);Long$1.MAX_VALUE=MAX_VALUE;var MAX_UNSIGNED_VALUE=fromBits(-1,-1,!0);Long$1.MAX_UNSIGNED_VALUE=MAX_UNSIGNED_VALUE;var MIN_VALUE=fromBits(0,-2147483648,!1);Long$1.MIN_VALUE=MIN_VALUE;var LongPrototype=Long$1.prototype;LongPrototype.toInt=function(){return this.unsigned?this.low>>>0:this.low},LongPrototype.toNumber=function(){return this.unsigned?(this.high>>>0)*TWO_PWR_32_DBL+(this.low>>>0):this.high*TWO_PWR_32_DBL+(this.low>>>0)},LongPrototype.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(MIN_VALUE)){var t=fromNumber(e),n=this.div(t),r=n.mul(t).sub(this);return n.toString(e)+r.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var a=fromNumber(pow_dbl(e,6),this.unsigned),i=this,s="";;){var o=i.div(a),l=(i.sub(o.mul(a)).toInt()>>>0).toString(e);if((i=o).isZero())return l+s;for(;l.length<6;)l="0"+l;s=""+l+s}},LongPrototype.getHighBits=function(){return this.high},LongPrototype.getHighBitsUnsigned=function(){return this.high>>>0},LongPrototype.getLowBits=function(){return this.low},LongPrototype.getLowBitsUnsigned=function(){return this.low>>>0},LongPrototype.getNumBitsAbs=function(){if(this.isNegative())return this.eq(MIN_VALUE)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},LongPrototype.isZero=function(){return 0===this.high&&0===this.low},LongPrototype.eqz=LongPrototype.isZero,LongPrototype.isNegative=function(){return!this.unsigned&&this.high<0},LongPrototype.isPositive=function(){return this.unsigned||this.high>=0},LongPrototype.isOdd=function(){return 1==(1&this.low)},LongPrototype.isEven=function(){return 0==(1&this.low)},LongPrototype.equals=function(e){return isLong(e)||(e=fromValue(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&(this.high===e.high&&this.low===e.low)},LongPrototype.eq=LongPrototype.equals,LongPrototype.notEquals=function(e){return!this.eq(e)},LongPrototype.neq=LongPrototype.notEquals,LongPrototype.ne=LongPrototype.notEquals,LongPrototype.lessThan=function(e){return this.comp(e)<0},LongPrototype.lt=LongPrototype.lessThan,LongPrototype.lessThanOrEqual=function(e){return this.comp(e)<=0},LongPrototype.lte=LongPrototype.lessThanOrEqual,LongPrototype.le=LongPrototype.lessThanOrEqual,LongPrototype.greaterThan=function(e){return this.comp(e)>0},LongPrototype.gt=LongPrototype.greaterThan,LongPrototype.greaterThanOrEqual=function(e){return this.comp(e)>=0},LongPrototype.gte=LongPrototype.greaterThanOrEqual,LongPrototype.ge=LongPrototype.greaterThanOrEqual,LongPrototype.compare=function(e){if(isLong(e)||(e=fromValue(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},LongPrototype.comp=LongPrototype.compare,LongPrototype.negate=function(){return!this.unsigned&&this.eq(MIN_VALUE)?MIN_VALUE:this.not().add(ONE)},LongPrototype.neg=LongPrototype.negate,LongPrototype.add=function(e){isLong(e)||(e=fromValue(e));var t=this.high>>>16,n=65535&this.high,r=this.low>>>16,a=65535&this.low,i=e.high>>>16,s=65535&e.high,o=e.low>>>16,l=0,u=0,c=0,h=0;return c+=(h+=a+(65535&e.low))>>>16,u+=(c+=r+o)>>>16,l+=(u+=n+s)>>>16,l+=t+i,fromBits((c&=65535)<<16|(h&=65535),(l&=65535)<<16|(u&=65535),this.unsigned)},LongPrototype.subtract=function(e){return isLong(e)||(e=fromValue(e)),this.add(e.neg())},LongPrototype.sub=LongPrototype.subtract,LongPrototype.multiply=function(e){if(this.isZero())return ZERO;if(isLong(e)||(e=fromValue(e)),wasm)return fromBits(wasm.mul(this.low,this.high,e.low,e.high),wasm.get_high(),this.unsigned);if(e.isZero())return ZERO;if(this.eq(MIN_VALUE))return e.isOdd()?MIN_VALUE:ZERO;if(e.eq(MIN_VALUE))return this.isOdd()?MIN_VALUE:ZERO;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(TWO_PWR_24)&&e.lt(TWO_PWR_24))return fromNumber(this.toNumber()*e.toNumber(),this.unsigned);var t=this.high>>>16,n=65535&this.high,r=this.low>>>16,a=65535&this.low,i=e.high>>>16,s=65535&e.high,o=e.low>>>16,l=65535&e.low,u=0,c=0,h=0,d=0;return h+=(d+=a*l)>>>16,c+=(h+=r*l)>>>16,h&=65535,c+=(h+=a*o)>>>16,u+=(c+=n*l)>>>16,c&=65535,u+=(c+=r*o)>>>16,c&=65535,u+=(c+=a*s)>>>16,u+=t*l+n*o+r*s+a*i,fromBits((h&=65535)<<16|(d&=65535),(u&=65535)<<16|(c&=65535),this.unsigned)},LongPrototype.mul=LongPrototype.multiply,LongPrototype.divide=function(e){if(isLong(e)||(e=fromValue(e)),e.isZero())throw Error("division by zero");var t,n,r;if(wasm)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?fromBits((this.unsigned?wasm.div_u:wasm.div_s)(this.low,this.high,e.low,e.high),wasm.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?UZERO:ZERO;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return UZERO;if(e.gt(this.shru(1)))return UONE;r=UZERO}else{if(this.eq(MIN_VALUE))return e.eq(ONE)||e.eq(NEG_ONE)?MIN_VALUE:e.eq(MIN_VALUE)?ONE:(t=this.shr(1).div(e).shl(1)).eq(ZERO)?e.isNegative()?ONE:NEG_ONE:(n=this.sub(e.mul(t)),r=t.add(n.div(e)));if(e.eq(MIN_VALUE))return this.unsigned?UZERO:ZERO;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();r=ZERO}for(n=this;n.gte(e);){t=Math.max(1,Math.floor(n.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(t)/Math.LN2),i=a<=48?1:pow_dbl(2,a-48),s=fromNumber(t),o=s.mul(e);o.isNegative()||o.gt(n);)o=(s=fromNumber(t-=i,this.unsigned)).mul(e);s.isZero()&&(s=ONE),r=r.add(s),n=n.sub(o)}return r},LongPrototype.div=LongPrototype.divide,LongPrototype.modulo=function(e){return isLong(e)||(e=fromValue(e)),wasm?fromBits((this.unsigned?wasm.rem_u:wasm.rem_s)(this.low,this.high,e.low,e.high),wasm.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},LongPrototype.mod=LongPrototype.modulo,LongPrototype.rem=LongPrototype.modulo,LongPrototype.not=function(){return fromBits(~this.low,~this.high,this.unsigned)},LongPrototype.and=function(e){return isLong(e)||(e=fromValue(e)),fromBits(this.low&e.low,this.high&e.high,this.unsigned)},LongPrototype.or=function(e){return isLong(e)||(e=fromValue(e)),fromBits(this.low|e.low,this.high|e.high,this.unsigned)},LongPrototype.xor=function(e){return isLong(e)||(e=fromValue(e)),fromBits(this.low^e.low,this.high^e.high,this.unsigned)},LongPrototype.shiftLeft=function(e){return isLong(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?fromBits(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):fromBits(0,this.low<<e-32,this.unsigned)},LongPrototype.shl=LongPrototype.shiftLeft,LongPrototype.shiftRight=function(e){return isLong(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?fromBits(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):fromBits(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},LongPrototype.shr=LongPrototype.shiftRight,LongPrototype.shiftRightUnsigned=function(e){if(isLong(e)&&(e=e.toInt()),0===(e&=63))return this;var t=this.high;return e<32?fromBits(this.low>>>e|t<<32-e,t>>>e,this.unsigned):fromBits(32===e?t:t>>>e-32,0,this.unsigned)},LongPrototype.shru=LongPrototype.shiftRightUnsigned,LongPrototype.shr_u=LongPrototype.shiftRightUnsigned,LongPrototype.toSigned=function(){return this.unsigned?fromBits(this.low,this.high,!1):this},LongPrototype.toUnsigned=function(){return this.unsigned?this:fromBits(this.low,this.high,!0)},LongPrototype.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},LongPrototype.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},LongPrototype.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},Long$1.fromBytes=function(e,t,n){return n?Long$1.fromBytesLE(e,t):Long$1.fromBytesBE(e,t)},Long$1.fromBytesLE=function(e,t){return new Long$1(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},Long$1.fromBytesBE=function(e,t){return new Long$1(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};const long$1=getDefaultExportFromCjs(long),LongExports=_mergeNamespaces({__proto__:null,default:long$1},[long]),Long=long$1||LongExports;function hexToLong(e){return Long.fromString(e,!0,16)}const k0=hexToLong("c3a5c85c97cb3127"),k1=hexToLong("b492b66fbe98f273"),k2=hexToLong("9ae16a3b2f90404f");function shiftMix(e){return e.xor(e.shru(47))}function fetch$1(e,t,n){const r=e.slice(t,t+n);return Long.fromBytes(Array.from(r),!0,!0)}function fetch64(e,t){return fetch$1(e,t,8)}function fetch32(e,t){return fetch$1(e,t,4)}function rotate64(e,t){return 0===t?e:e.shru(t).or(e.shl(64-t))}function hashLen16(e,t,n=hexToLong("9ddfea08eb382d69")){let r=e.xor(t).mul(n);r=r.xor(r.shru(47));let a=t.xor(r).mul(n);return a=a.xor(a.shru(47)),a=a.mul(n),a}function weakHashLen32WithSeeds(e,t,n,r,a,i){a=a.add(e),i=rotate64(i.add(a).add(r),21);const s=a;return a=(a=a.add(t)).add(n),i=i.add(rotate64(a,44)),[a.add(r),i.add(s)]}function weakHashLen32WithSeedsStr(e,t,n,r){return weakHashLen32WithSeeds(fetch64(e,t),fetch64(e,t+8),fetch64(e,t+16),fetch64(e,t+24),n,r)}function hashLen0to16(e,t=e.length){if(t>=8){const n=k2.add(2*t),r=fetch64(e,0).add(k2),a=fetch64(e,t-8);return hashLen16(rotate64(a,37).mul(n).add(r),rotate64(r,25).add(a).mul(n),n)}if(t>=4){const n=k2.add(2*t);return hashLen16(fetch32(e,0).shl(3).add(t),fetch32(e,t-4),n)}if(t>0){const n=e[0]+(e[t>>1]<<8),r=t+(e[t-1]<<2);return shiftMix(k2.mul(n).xor(k0.mul(r))).mul(k2)}return k2}function hashLen17to32(e,t=e.length){const n=k2.add(2*t),r=fetch64(e,0).mul(k1),a=fetch64(e,8),i=fetch64(e,t-8).mul(n),s=fetch64(e,t-16).mul(k2);return hashLen16(rotate64(r.add(a),43).add(rotate64(i,30)).add(s),r.add(rotate64(a.add(k2),18)).add(i),n)}function hashLen33to64(e,t=e.length){const n=k2.add(2*t),r=fetch64(e,0).mul(k2),a=fetch64(e,8),i=fetch64(e,t-8).mul(n),s=fetch64(e,t-16).mul(k2),o=rotate64(r.add(a),43).add(rotate64(i,30)).add(s),l=hashLen16(o,r.add(rotate64(a.add(k2),18)).add(i),n),u=fetch64(e,16).mul(n),c=fetch64(e,24),h=o.add(fetch64(e,t-32)).mul(n),d=l.add(fetch64(e,t-24)).mul(n);return hashLen16(rotate64(u.add(c),43).add(rotate64(h,30)).add(d),u.add(rotate64(c.add(r),18)).add(h),n)}function fingerPrint64(e,t=e.length){const n=Long.fromNumber(81,!0);if(t<=32)return t<=16?hashLen0to16(e,t):hashLen17to32(e,t);if(t<=64)return hashLen33to64(e,t);let r=n,a=n.mul(k1).add(113),i=shiftMix(a.mul(k2).add(113)).mul(k2),s=[Long.UZERO,Long.UZERO],o=[Long.UZERO,Long.UZERO];r=r.mul(k2).add(fetch64(e,0));let l=0;const u=64*(t-1>>6),c=u+(t-1&63)-63;do{r=rotate64(r.add(a).add(s[0]).add(fetch64(e,l+8)),37).mul(k1),a=rotate64(a.add(s[1]).add(fetch64(e,l+48)),42).mul(k1),r=r.xor(o[1]),a=a.add(s[0]).add(fetch64(e,l+40)),i=rotate64(i.add(o[0]),33).mul(k1),s=weakHashLen32WithSeedsStr(e,l,s[1].mul(k1),r.add(o[0])),o=weakHashLen32WithSeedsStr(e,l+32,i.add(o[1]),a.add(fetch64(e,l+16))),[i,r]=[r,i],l+=64}while(l!==u);const h=k1.add(i.and(255).shl(1));return l=c,o[0]=o[0].add(t-1&63),s[0]=s[0].add(o[0]),o[0]=o[0].add(s[0]),r=rotate64(r.add(a).add(s[0]).add(fetch64(e,l+8)),37).mul(h),a=rotate64(a.add(s[1]).add(fetch64(e,l+48)),42).mul(h),r=r.xor(o[1].mul(9)),a=a.add(s[0].mul(9).add(fetch64(e,l+40))),i=rotate64(i.add(o[0]),33).mul(h),s=weakHashLen32WithSeedsStr(e,l,s[1].mul(h),r.add(o[0])),o=weakHashLen32WithSeedsStr(e,l+32,i.add(o[1]),a.add(fetch64(e,l+16))),[i,r]=[r,i],hashLen16(hashLen16(s[0],o[0],h).add(shiftMix(a).mul(k0)).add(i),hashLen16(s[1],o[1],h).add(r),h)}
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function createScalarValue(e,t){return"string"===t?encodeString(e):toTypedArray([e],t)}function noConversionNeeded(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}function toTypedArray(e,t){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=flatten$2(e)),env().getBool("DEBUG")&&checkConversionForErrors(e,t),noConversionNeeded(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){const t=new Uint8Array(e.length);for(let n=0;n<t.length;++n)0!==Math.round(e[n])&&(t[n]=1);return t}throw new Error(`Unknown data type ${t}`)}function now(){return env().platform.now()}function encodeString(e,t="utf-8"){return t=t||"utf-8",env().platform.encode(e,t)}function decodeString(e,t="utf-8"){return t=t||"utf-8",env().platform.decode(e,t)}function isTypedArray$1(e){return null!=env().platform.isTypedArray?env().platform.isTypedArray(e):isTypedArrayBrowser(e)}function flatten$2(e,t=[],n=!1){if(null==t&&(t=[]),"boolean"==typeof e||"number"==typeof e||"string"==typeof e||isPromise$1(e)||null==e||isTypedArray$1(e)&&n)t.push(e);else if(Array.isArray(e)||isTypedArray$1(e))for(let r=0;r<e.length;++r)flatten$2(e[r],t,n);else{let r=-1;for(const t of Object.keys(e))/^([1-9]+[0-9]*|0)$/.test(t)&&(r=Math.max(r,Number(t)));for(let a=0;a<=r;a++)flatten$2(e[a],t,n)}return t}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class Profiler{constructor(e,t){this.backendTimer=e,this.logger=t,null==t&&(this.logger=new Logger)}profileKernel(e,t,n){let r;const a=()=>{r=n()};let i;const s=now();if(this.backendTimer.timerAvailable())i=this.backendTimer.time(a);else{a();for(const e of r)e.dataSync();i=Promise.resolve({kernelMs:now()-s})}if(env().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let o=0;o<r.length;o++){const t=r[o];t.data().then((n=>{checkComputationForErrors(n,t.dtype,e)}))}return{kernelName:e,outputs:r,inputs:t,timeMs:i.then((e=>e.kernelMs)),extraInfo:i.then((e=>null!=e.getExtraProfileInfo?e.getExtraProfileInfo():""))}}logKernelProfile(e){const{kernelName:t,outputs:n,timeMs:r,inputs:a,extraInfo:i}=e;n.forEach((e=>{Promise.all([e.data(),r,i]).then((n=>{this.logger.logKernelProfile(t,e,n[0],n[1],a,n[2])}))}))}}function checkComputationForErrors(e,t,n){if("float32"!==t)return!1;for(let r=0;r<e.length;r++){const t=e[r];if(isNaN(t)||!isFinite(t))return console.warn(`Found ${t} in the result of '${n}'`),!0}return!1}class Logger{logKernelProfile(e,t,n,r,a,i){const s="number"==typeof r?rightPad(`${r}ms`,9):r.error,o=rightPad(e,25),l=t.rank,u=t.size,c=rightPad(t.shape.toString(),14);let h="";for(const d in a){const e=a[d];if(null!=e){const n=e.shape||t.shape,r=n.length;h+=`${d}: ${r}D ${r>0?n:""} `}}console.log(`%c${o}\t%c${s}\t%c${l}D ${c}\t%c${u}\t%c${h}\t%c${i}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function getFilteredNodesXToY(e,t,n){const r={},a={};for(let l=0;l<t.length;l++)r[t[l].id]=!0;for(let l=0;l<e.length;l++){const n=e[l],i=n.inputs;for(const e in i){const s=i[e];let o=!1;for(let e=0;e<t.length;e++)if(r[s.id]){n.outputs.forEach((e=>r[e.id]=!0)),o=!0,a[n.id]=!0;break}if(o)break}}const i={};i[n.id]=!0;const s={};for(let l=e.length-1;l>=0;l--){const t=e[l],n=t.inputs;for(let e=0;e<t.outputs.length;e++)if(i[t.outputs[e].id]){for(const e in n)i[n[e].id]=!0,s[t.id]=!0;break}}const o=[];for(let l=0;l<e.length;l++){const t=e[l];if(a[t.id]&&s[t.id]){const e={};for(const a in t.inputs){const n=t.inputs[a];r[n.id]&&(e[a]=n)}const n=Object.assign({},t);n.inputs=e,n.outputs=t.outputs,o.push(n)}}return o}function backpropagateGradients(e,t,n,r){for(let a=t.length-1;a>=0;a--){const i=t[a],s=[];if(i.outputs.forEach((t=>{const n=e[t.id];null!=n?s.push(n):s.push(null)})),null==i.gradient)throw new Error(`Cannot compute gradient: gradient function not found for ${i.kernelName}.`);const o=i.gradient(s);for(const t in i.inputs){if(!(t in o))throw new Error(`Cannot backprop through input ${t}. Available gradients found: ${Object.keys(o)}.`);const a=n((()=>o[t]()));if("float32"!==a.dtype)throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input ${t} must have 'float32' dtype, but has '${a.dtype}'`);const s=i.inputs[t];if(!arraysEqual(a.shape,s.shape))throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input '${t}' has shape '${a.shape}', which does not match the shape of the input '${s.shape}'`);if(null==e[s.id])e[s.id]=a;else{const t=e[s.id];e[s.id]=r(t,a),t.dispose()}}}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const FORMAT_LIMIT_NUM_VALS=20,FORMAT_NUM_FIRST_LAST_VALS=3,FORMAT_NUM_SIG_DIGITS=7;function tensorToString(e,t,n,r){const a=computeStrides(t),i=computeMaxSizePerColumn(e,t,n,a),s=t.length,o=subTensorToString(e,t,n,a,i),l=["Tensor"];return r&&(l.push(`  dtype: ${n}`),l.push(`  rank: ${s}`),l.push(`  shape: [${t}]`),l.push("  values:")),l.push(o.map((e=>"    "+e)).join("\n")),l.join("\n")}function computeMaxSizePerColumn(e,t,n,r){const a=sizeFromShape(t),i=r[r.length-1],s=new Array(i).fill(0),o=t.length,l="complex64"===n?createComplexTuples(e):e;if(o>1)for(let u=0;u<a/i;u++){const e=u*i;for(let t=0;t<i;t++)s[t]=Math.max(s[t],valToString(l[e+t],0,n).length)}return s}function valToString(e,t,n){let r;return r=Array.isArray(e)?`${parseFloat(e[0].toFixed(FORMAT_NUM_SIG_DIGITS))} + ${parseFloat(e[1].toFixed(FORMAT_NUM_SIG_DIGITS))}j`:isString(e)?`'${e}'`:"bool"===n?boolNumToString(e):parseFloat(e.toFixed(FORMAT_NUM_SIG_DIGITS)).toString(),rightPad(r,t)}function boolNumToString(e){return 0===e?"false":"true"}function subTensorToString(e,t,n,r,a,i=!0){const s="complex64"===n?2:1,o=t[0],l=t.length;if(0===l){if("complex64"===n){return[valToString(createComplexTuples(e)[0],0,n)]}return"bool"===n?[boolNumToString(e[0])]:[e[0].toString()]}if(1===l){if(o>FORMAT_LIMIT_NUM_VALS){const t=FORMAT_NUM_FIRST_LAST_VALS*s;let r=Array.from(e.slice(0,t)),i=Array.from(e.slice((o-FORMAT_NUM_FIRST_LAST_VALS)*s,o*s));return"complex64"===n&&(r=createComplexTuples(r),i=createComplexTuples(i)),["["+r.map(((e,t)=>valToString(e,a[t],n))).join(", ")+", ..., "+i.map(((e,t)=>valToString(e,a[o-FORMAT_NUM_FIRST_LAST_VALS+t],n))).join(", ")+"]"]}return["["+("complex64"===n?createComplexTuples(e):Array.from(e)).map(((e,t)=>valToString(e,a[t],n))).join(", ")+"]"]}const u=t.slice(1),c=r.slice(1),h=r[0]*s,d=[];if(o>FORMAT_LIMIT_NUM_VALS){for(let t=0;t<FORMAT_NUM_FIRST_LAST_VALS;t++){const r=t*h,i=r+h;d.push(...subTensorToString(e.slice(r,i),u,n,c,a,!1))}d.push("...");for(let t=o-FORMAT_NUM_FIRST_LAST_VALS;t<o;t++){const r=t*h,i=r+h;d.push(...subTensorToString(e.slice(r,i),u,n,c,a,t===o-1))}}else for(let m=0;m<o;m++){const t=m*h,r=t+h;d.push(...subTensorToString(e.slice(t,r),u,n,c,a,m===o-1))}const p=2===l?",":"";d[0]="["+(o>0?d[0]+p:"");for(let m=1;m<d.length-1;m++)d[m]=" "+d[m]+p;let f=",\n";for(let m=2;m<l;m++)f+="\n";return d[d.length-1]=" "+d[d.length-1]+"]"+(i?"":f),d}function createComplexTuples(e){const t=[];for(let n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class TensorBuffer{constructor(e,t,n){if(this.dtype=t,this.shape=e.slice(),this.size=sizeFromShape(e),null!=n){const e=n.length;assert$1(e===this.size,(()=>`Length of values '${e}' does not match the size inferred by the shape '${this.size}'.`))}if("complex64"===t)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||getArrayFromDType(t,this.size),this.strides=computeStrides(e)}set(e,...t){0===t.length&&(t=[0]),assert$1(t.length===this.rank,(()=>`The number of provided coordinates (${t.length}) must match the rank (${this.rank})`));const n=this.locToIndex(t);this.values[n]=e}get(...e){0===e.length&&(e=[0]);let t=0;for(const r of e){if(r<0||r>=this.shape[t]){const t=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(t)}t++}let n=e[e.length-1];for(let r=0;r<e.length-1;++r)n+=this.strides[r]*e[r];return this.values[n]}locToIndex(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];let t=e[e.length-1];for(let n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t}indexToLoc(e){if(0===this.rank)return[];if(1===this.rank)return[e];const t=new Array(this.shape.length);for(let n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return trackerFn().makeTensor(this.values,this.shape,this.dtype)}}let trackerFn=null,opHandler$1=null;function setTensorTracker(e){trackerFn=e}function setOpHandler(e){opHandler$1=e}class Tensor{constructor(e,t,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=sizeFromShape(e),this.strides=computeStrides(e),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return opHandler$1.buffer(this.shape,this.dtype,e)}bufferSync(){return opHandler$1.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return toNestedArray(this.shape,e,"complex64"===this.dtype)}arraySync(){return toNestedArray(this.shape,this.dataSync(),"complex64"===this.dtype)}async data(){this.throwIfDisposed();const e=trackerFn().read(this.dataId);if("string"===this.dtype){const n=await e;try{return n.map((e=>decodeString(e)))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),trackerFn().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=trackerFn().readSync(this.dataId);if("string"===this.dtype)try{return e.map((e=>decodeString(e)))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await trackerFn().read(this.dataId);return"string"===this.dtype?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),trackerFn().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return opHandler$1.print(this,e)}clone(){return this.throwIfDisposed(),opHandler$1.clone(this)}toString(e=!1){return tensorToString(this.dataSync(),this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),opHandler$1.cast(this,e)}variable(e=!0,t,n){return this.throwIfDisposed(),trackerFn().makeVariable(this,e,t,n)}}function getGlobalTensorClass(){return getGlobal("Tensor",(()=>Tensor))}Object.defineProperty(Tensor,Symbol.hasInstance,{value:e=>!!e&&null!=e.data&&null!=e.dataSync&&null!=e.throwIfDisposed}),getGlobalTensorClass();class Variable extends Tensor{constructor(e,t,n,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=t,this.name=n}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!arraysEqual(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);trackerFn().disposeTensor(this),this.dataId=e.dataId,trackerFn().incRef(this,null)}dispose(){trackerFn().disposeVariable(this),this.isDisposedInternal=!0}}
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
var Rank,Rank2,UpcastInt32AndMap,UpcastInt32AndMap2,UpcastBoolAndMap,UpcastBoolAndMap2,UpcastFloat32AndMap,UpcastFloat32AndMap2,UpcastComplex64AndMap,UpcastComplex64AndMap2;Object.defineProperty(Variable,Symbol.hasInstance,{value:e=>e instanceof Tensor&&null!=e.assign&&e.assign instanceof Function}),Rank2=Rank||(Rank={}),Rank2.R0="R0",Rank2.R1="R1",Rank2.R2="R2",Rank2.R3="R3",Rank2.R4="R4",Rank2.R5="R5",Rank2.R6="R6",UpcastInt32AndMap2=UpcastInt32AndMap||(UpcastInt32AndMap={}),UpcastInt32AndMap2.float32="float32",UpcastInt32AndMap2.int32="int32",UpcastInt32AndMap2.bool="int32",UpcastInt32AndMap2.complex64="complex64",UpcastBoolAndMap2=UpcastBoolAndMap||(UpcastBoolAndMap={}),UpcastBoolAndMap2.float32="float32",UpcastBoolAndMap2.int32="int32",UpcastBoolAndMap2.bool="bool",UpcastBoolAndMap2.complex64="complex64",UpcastFloat32AndMap2=UpcastFloat32AndMap||(UpcastFloat32AndMap={}),UpcastFloat32AndMap2.float32="float32",UpcastFloat32AndMap2.int32="float32",UpcastFloat32AndMap2.bool="float32",UpcastFloat32AndMap2.complex64="complex64",UpcastComplex64AndMap2=UpcastComplex64AndMap||(UpcastComplex64AndMap={}),UpcastComplex64AndMap2.float32="complex64",UpcastComplex64AndMap2.int32="complex64",UpcastComplex64AndMap2.bool="complex64",UpcastComplex64AndMap2.complex64="complex64";const upcastTypeMap={float32:UpcastFloat32AndMap,int32:UpcastInt32AndMap,bool:UpcastBoolAndMap,complex64:UpcastComplex64AndMap};function upcastType(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error(`Can not upcast ${e} with ${t}`)}return upcastTypeMap[e][t]}function sumOutType(e){return upcastType(e,"int32")}function isWebGLData(e){return null!=e&&"object"==typeof e&&"texture"in e&&e.texture instanceof WebGLTexture}function isWebGPUData(e){return"undefined"!=typeof GPUBuffer&&null!=e&&"object"==typeof e&&"buffer"in e&&e.buffer instanceof GPUBuffer}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function makeTypesMatch(e,t){if(e.dtype===t.dtype)return[e,t];const n=upcastType(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function assertTypesMatch(e,t){assert$1(e.dtype===t.dtype,(()=>`The dtypes of the first(${e.dtype}) and second(${t.dtype}) input must match`))}function getTensorsInContainer(e){const t=[];return walkTensorContainer(e,t,new Set),t}function walkTensorContainer(e,t,n){if(null==e)return;if(e instanceof Tensor)return void t.push(e);if(!isIterable(e))return;const r=e;for(const a in r){const e=r[a];n.has(e)||(n.add(e),walkTensorContainer(e,t,n))}}function isIterable(e){return Array.isArray(e)||"object"==typeof e}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function isRegisteredKernelInvocation(e){return null!=e.kernelName}class EngineState{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map((e=>e.name))))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class Engine{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new EngineState}async ready(){if(null!=this.pendingBackendInit)return this.pendingBackendInit.then((()=>{}));if(null!=this.backendInstance)return;const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const n=e[t];if(await this.initializeBackend(n).success)return void(await this.setBackend(n))}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(null!=this.pendingBackendInit)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(null==this.backendInstance){const{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;{const{asyncInit:t}=this.initializeBackend(e);if(t)return null}}return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t,n=1){return e in this.registryFactory?(warn(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:t,priority:n},!0)}async setBackend(e){if(null==this.registryFactory[e])throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,null==this.registry[e]){this.backendInstance=null;const{success:t,asyncInit:n}=this.initializeBackend(e);if(!(n?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new Profiler(this.backendInstance),!0}setupRegisteredKernels(){getKernelsForBackend(this.backendName).forEach((e=>{null!=e.setupFunc&&e.setupFunc(this.backendInstance)}))}disposeRegisteredKernels(e){getKernelsForBackend(e).forEach((t=>{null!=t.disposeFunc&&t.disposeFunc(this.registry[e])}))}initializeBackend(e){const t=this.registryFactory[e];if(null==t)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const n=t.factory();if(!n||n instanceof KernelBackend||"function"!=typeof n.then)return this.registry[e]=n,{success:!0,asyncInit:!1};{const t=++this.pendingBackendInitId,r=n.then((n=>!(t<this.pendingBackendInitId)&&(this.registry[e]=n,this.pendingBackendInit=null,!0))).catch((n=>(t<this.pendingBackendInitId||(this.pendingBackendInit=null,warn(`Initialization of backend ${e} failed`),warn(n.stack||n.message)),!1)));return this.pendingBackendInit=r,{success:r,asyncInit:!0}}}catch(n){return warn(`Initialization of backend ${e} failed`),warn(n.stack||n.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority))}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const n=e[t],{success:r,asyncInit:a}=this.initializeBackend(n);if(a||r)return{name:n,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){const n=this.state.tensorInfo.get(t),r=n.backend,a=this.readSync(t),i=r.refCount(t);r.disposeData(t,!0),n.backend=e,e.move(t,a,n.shape,n.dtype,i),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let n,r=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=e}return this.scopedRun((()=>this.startScope(r)),(()=>this.endScope(n)),(()=>(n=t(),n instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n)))}scopedRun(e,t,n){e();try{const e=n();return t(),e}catch(r){throw t(),r}}nextTensorId(){return Engine.nextTensorId++}nextVariableId(){return Engine.nextVariableId++}clone(e){const t=ENGINE.runKernel(Identity$1,{x:e}),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],(e=>({x:()=>{const t={x:e},n={dtype:"float32"};return ENGINE.runKernel(Cast,t,n)}})),[],{}),t}runKernel(e,t,n){null==this.backendName&&this.backend;if(!(null!=getKernel(e,this.backendName)))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,n){const r=this.backend.numDataIds();let a=0;n.forEach((e=>{a+="complex64"===e.dtype?3:1}));const i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=r-t-a-i;if(s>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${s} data ids) after running '${e}'`)}runKernelFunc(e){let t,n=[];const r=this.isTapeOn(),a=this.state.numBytes,i=this.state.numTensors;let s,o;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;const l=isRegisteredKernelInvocation(e)?e.kernelName:null!=this.state.activeScope?this.state.activeScope.name:"";if(isRegisteredKernelInvocation(e)){const{kernelName:t,inputs:a,attrs:i}=e;null==this.backendName&&this.backend;const l=getKernel(t,this.backendName);assert$1(null!=l,(()=>`Cannot find registered kernel '${t}' for backend '${this.backendName}'`)),s=()=>{const e=this.backend.numDataIds();o=l.kernelFunc({inputs:a,attrs:i,backend:this.backend});const s=Array.isArray(o)?o:[o];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(t,e,s);const u=s.map((e=>null!=e.rank?e:this.makeTensorFromTensorInfo(e)));if(r){const e=this.getTensorsForGradient(t,a,u);n=this.saveTensorsForBackwardMode(e)}return u}}else{const{forwardFunc:t}=e,a=e=>{r&&(n=e.map((e=>this.keep(this.clone(e)))))};s=()=>{const e=this.backend.numDataIds();o=this.tidy((()=>t(this.backend,a)));const n=Array.isArray(o)?o:[o];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(l,e,n),n}}const{inputs:u,attrs:c}=e,h=isRegisteredKernelInvocation(e)?null:e.backwardsFunc;let d;return this.scopedRun((()=>this.state.kernelDepth++),(()=>this.state.kernelDepth--),(()=>{this.ENV.getBool("DEBUG")||this.state.profiling?(d=this.profiler.profileKernel(l,u,(()=>s())),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(d),t=d.outputs):t=s()})),r&&this.addTapeNode(l,u,t,h,n,c),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-a,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-i,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(u).map((e=>null!=u[e]?u[e].shape:null)),outputShapes:t.map((e=>e.shape)),kernelTimeMs:d.timeMs,extraInfo:d.extraInfo}),Array.isArray(o)?t:t[0]}saveTensorsForBackwardMode(e){return e.map((e=>this.keep(this.clone(e))))}getTensorsForGradient(e,t,n){const r=getGradient(e);if(null!=r){const e=r.inputsToSave||[],a=r.outputsToSave||[];let i;r.saveAllInputs?(assert$1(Array.isArray(t),(()=>"saveAllInputs is true, expected inputs to be an array.")),i=Object.keys(t).map((e=>t[e]))):i=e.map((e=>t[e]));const s=n.filter(((e,t)=>a[t]));return i.concat(s)}return[]}makeTensor(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;let a=e;"string"===n&&isString(e[0])&&(a=e.map((e=>encodeString(e))));const i=r.write(a,t,n),s=new Tensor(t,n,i,this.nextTensorId());if(this.trackTensor(s,r),"string"===n){const e=this.state.tensorInfo.get(i),t=bytesFromStringArray(a);this.state.numBytes+=t-e.bytes,e.bytes=t}return s}makeTensorFromDataId(e,t,n,r){const a={dataId:e,shape:t,dtype:n=n||"float32"};return this.makeTensorFromTensorInfo(a,r)}makeTensorFromTensorInfo(e,t){const{dataId:n,shape:r,dtype:a}=e,i=new Tensor(r,a,n,this.nextTensorId());return this.trackTensor(i,t),i}makeVariable(e,t=!0,n,r){n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.cast(r));const a=new Variable(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[a.name])throw new Error(`Variable with name ${a.name} was already registered`);return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a}trackTensor(e,t){this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++;let n=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(n=e.size*bytesPerElement(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof Variable||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,"string"===e.dtype&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),"complex64"!==e.dtype&&"string"!==e.dtype){const t=e.size*bytesPerElement(e.dtype);this.state.numBytes-=t}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const t=this.state.numBytes,n=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map((e=>e.totalBytesSnapshot))),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n;for(const r of this.state.activeProfile.kernels)r.kernelTimeMs=await r.kernelTimeMs,r.extraInfo=await r.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}addTapeNode(e,t,n,r,a,i){const s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:a},o=getGradient(e);null!=o&&(r=o.gradFunc),null!=r&&(s.gradient=e=>(e=e.map(((e,t)=>{if(null==e){const e=n[t],r=makeZerosTypedArray(e.size,e.dtype);return this.makeTensor(r,e.shape,e.dtype)}return e})),r(e.length>1?e:e[0],a,i))),this.state.activeTape.push(s)}keep(e){return e.kept=!0,e}startTape(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){const t=getTensorsInContainer(e),n=new Set(t.map((e=>e.id)));for(let a=0;a<this.state.activeScope.track.length;a++){const e=this.state.activeScope.track[a];e.kept||n.has(e.id)||e.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach((e=>{e.kept||e.scopeId!==r.id||this.track(e)}))}gradients(e,t,n,r=!1){if(assert$1(t.length>0,(()=>"gradients() received an empty list of xs.")),null!=n&&"float32"!==n.dtype)throw new Error(`dy must have 'float32' dtype, but has '${n.dtype}'`);const a=this.scopedRun((()=>this.startTape()),(()=>this.endTape()),(()=>this.tidy("forward",e)));assert$1(a instanceof Tensor,(()=>"The result y returned by f() must be a tensor."));const i=getFilteredNodesXToY(this.state.activeTape,t,a);if(!r&&0===i.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(()=>{const e={};e[a.id]=null==n?ones$1(a.shape):n,backpropagateGradients(e,i,(e=>this.tidy(e)),add$2);const r=t.map((t=>e[t.id]));return 0===this.state.gradientDepth&&(this.state.activeTape.forEach((e=>{for(const t of e.saved)t.dispose()})),this.state.activeTape=null),{value:a,grads:r}}))}customGrad(e){return assert$1(isFunction$2(e),(()=>"The f passed in customGrad(f) must be a function.")),(...t)=>{let n;assert$1(t.every((e=>e instanceof Tensor)),(()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors"));const r={};t.forEach(((e,t)=>{r[t]=e}));return this.runKernelFunc({forwardFunc:(r,a)=>(n=e(...t,a),assert$1(n.value instanceof Tensor,(()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor")),assert$1(isFunction$2(n.gradFunc),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function.")),n.value),backwardsFunc:(e,r)=>{const a=n.gradFunc(e,r),i=Array.isArray(a)?a:[a];assert$1(i.length===t.length,(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...).")),assert$1(i.every((e=>e instanceof Tensor)),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."));const s={};return i.forEach(((e,t)=>{s[t]=()=>e})),s},inputs:r})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){const t=now(),n=await this.backend.time(e);return n.wallMs=now()-t,n}track(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new EngineState;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}function ones$1(e){const t=makeOnesTypedArray(sizeFromShape(e),"float32");return ENGINE.makeTensor(t,e,"float32")}function getOrMakeEngine(){const e=getGlobalNamespace();if(null==e._tfengine){const t=new Environment(e);e._tfengine=new Engine(t)}return setEnvironmentGlobal(e._tfengine.ENV),setTensorTracker((()=>e._tfengine)),e._tfengine}Engine.nextTensorId=0,Engine.nextVariableId=0;const ENGINE=getOrMakeEngine();function add$2(e,t){const n={a:e,b:t};return ENGINE.runKernel(Add$1,n)}
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function _isNavigatorDefined(){return"undefined"!=typeof navigator&&null!=navigator}function isMobile(e){if(e||_isNavigatorDefined()){if(e||(e=navigator),"ReactNative"===e.product)return!0;const t=e.userAgent||e.vendor||("undefined"!=typeof window?window.opera:"");if(!t){const t=e;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}return!1}function isBrowser(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const ENV$3=env();
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function inferShape(e,t){let n=e;if(isTypedArray$1(e))return"string"===t?[]:[e.length];if(isWebGLData(e)){const t=e.channels||"RGBA";return[e.height,e.width*t.length]}if(isWebGPUData(e))return[e.buffer.size/(null==t?4:bytesPerElement(t))];if(!Array.isArray(e))return[];const r=[];for(;Array.isArray(n)||isTypedArray$1(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&env().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&deepAssertShapeConsistency(e,r,[]),r}function deepAssertShapeConsistency(e,t,n){if(n=n||[],!Array.isArray(e)&&!isTypedArray$1(e))return void assert$1(0===t.length,(()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${t[0]} elements`));assert$1(t.length>0,(()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${e.length} elements`)),assert$1(e.length===t[0],(()=>`Element arr[${n.join("][")}] should have ${t[0]} elements, but has ${e.length} elements`));const r=t.slice(1);for(let a=0;a<e.length;++a)deepAssertShapeConsistency(e[a],r,n.concat(a))}function assertDtype(e,t,n,r){if("string_or_numeric"!==e){if(null==e)throw new Error("Expected dtype cannot be null.");if("numeric"!==e&&e!==t||"numeric"===e&&"string"===t)throw new Error(`Argument '${n}' passed to '${r}' must be ${e} tensor, but got ${t} tensor`)}}function convertToTensor(e,t,n,r="numeric"){if(e instanceof getGlobalTensorClass())return assertDtype(r,e.dtype,t,n),e;let a=inferDtype(e);if("string"!==a&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),assertDtype(r,a,t,n),null==e||!isTypedArray$1(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e){const r=null==e?"null":e.constructor.name;throw new Error(`Argument '${t}' passed to '${n}' must be a Tensor or TensorLike, but got '${r}'`)}const i=inferShape(e,a);isTypedArray$1(e)||Array.isArray(e)||(e=[e]);const s="string"!==a?toTypedArray(e,a):flatten$2(e,[],!0);return ENGINE.makeTensor(s,i,a)}function convertToTensorArray(e,t,n,r="numeric"){if(!Array.isArray(e))throw new Error(`Argument ${t} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return e.map(((e,a)=>convertToTensor(e,`${t}[${a}]`,n,r)))}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */ENV$3.registerFlag("DEBUG",(()=>!1),(e=>{e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),ENV$3.registerFlag("IS_BROWSER",(()=>isBrowser())),ENV$3.registerFlag("IS_NODE",(()=>"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node)),ENV$3.registerFlag("IS_CHROME",(()=>"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor))),ENV$3.registerFlag("IS_SAFARI",(()=>"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor))),ENV$3.registerFlag("PROD",(()=>!1)),ENV$3.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(()=>ENV$3.getBool("DEBUG"))),ENV$3.registerFlag("DEPRECATION_WARNINGS_ENABLED",(()=>!0)),ENV$3.registerFlag("IS_TEST",(()=>!1)),ENV$3.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",(()=>ENV$3.getBool("DEBUG"))),ENV$3.registerFlag("WRAP_TO_IMAGEBITMAP",(()=>!1)),ENV$3.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",(()=>!1)),ENV$3.registerFlag("USE_SETTIMEOUTCUSTOM",(()=>!1));const OP_SCOPE_SUFFIX="__op";function op(e){const t=Object.keys(e);if(1!==t.length)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${t.length} keys.`);let n=t[0];const r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+=OP_SCOPE_SUFFIX;const a=(...e)=>{ENGINE.startScope(n);try{const t=r(...e);return isPromise$1(t)&&console.error("Cannot return a Promise inside of tidy."),ENGINE.endScope(t),t}catch(t){throw ENGINE.endScope(null),t}};return Object.defineProperty(a,"name",{value:n,configurable:!0}),a}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function complex_(e,t){const n=convertToTensor(e,"real","complex"),r=convertToTensor(t,"imag","complex");assertShapesMatch(n.shape,r.shape,`real and imag shapes, ${n.shape} and ${r.shape}, must match in call to tf.complex().`);const a={real:n,imag:r};return ENGINE.runKernel(Complex,a)}const complex$2=op({complex_:complex_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function makeTensor(e,t,n,r){if(null==r)r=inferDtype(e);else if("complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(isWebGPUData(e)||isWebGLData(e)){if("float32"!==r&&"int32"!==r)throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${r}.`);return ENGINE.backend.createTensorFromGPUData(e,t||n,r)}if(!isTypedArray$1(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){assertNonNegativeIntegerDimensions(t);const e=sizeFromShape(t),r=sizeFromShape(n);assert$1(e===r,(()=>`Based on the provided shape, [${t}], the tensor should have ${e} values but has ${r}`));for(let a=0;a<n.length;++a){const e=n[a],r=a!==n.length-1||e!==sizeFromShape(t.slice(a));assert$1(n[a]===t[a]||!r,(()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${t}). `))}}return isTypedArray$1(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==r?toTypedArray(e,r):flatten$2(e,[],!0),ENGINE.makeTensor(e,t,r)}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function tensor(e,t,n){return makeTensor(e,t,inferShape(e,n),n)}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const DTYPE_VALUE_SIZE_MAP={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};class CompositeArrayBuffer{static join(e){return new CompositeArrayBuffer(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,null==e)return;if(e instanceof Array||(e=[e]),0===(e=e.map((e=>isTypedArray$1(e)?e.buffer:e))).length)return;this.bufferUniformSize=e[0].byteLength;let t=0;for(let n=0;n<e.length;n++){const r=e[n];n!==e.length-1&&r.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const a=t+r.byteLength;this.shards.push({buffer:r,start:t,end:a}),t=a}0===this.shards.length&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,t=this.byteLength){if(0===this.shards.length)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),(t=Math.min(this.byteLength,t))<=e)return new ArrayBuffer(0);const n=this.findShardForByte(e);if(-1===n)throw new Error(`Could not find start shard for byte ${e}`);const r=new ArrayBuffer(t-e),a=new Uint8Array(r);let i=0;for(let s=n;s<this.shards.length;s++){const n=this.shards[s],r=e+i-n.start,o=i,l=Math.min(t,n.end)-n.start,u=new Uint8Array(n.buffer,r,l-r);if(a.set(u,o),i+=u.length,t<n.end)break}return r}findShardForByte(e){if(0===this.shards.length||e<0||e>=this.byteLength)return-1;if(null!=this.bufferUniformSize)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(t){return e<t.start?-1:e>=t.end?1:0}if(0===t(this.shards[this.previousShardIndex]))return this.previousShardIndex;const n=search(this.shards,t);return-1===n?-1:(this.previousShardIndex=n,this.previousShardIndex)}}function search(e,t){let n=0,r=e.length;for(;n<=r;){const a=Math.floor((r-n)/2)+n,i=t(e[a]);if(0===i)return a;i<0?r=a:n=a+1}return-1}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const NUM_BYTES_STRING_LENGTH=4;async function encodeWeights(e,t){const n=[],r=[],a=Array.isArray(e)?e.map((e=>e.name)):Object.keys(e);for(let i=0;i<a.length;++i){const s=a[i],o=Array.isArray(e)?e[i].tensor:e[s];if("float32"!==o.dtype&&"int32"!==o.dtype&&"bool"!==o.dtype&&"string"!==o.dtype&&"complex64"!==o.dtype)throw new Error(`Unsupported dtype in weight '${s}': ${o.dtype}`);const l={name:s,shape:o.shape,dtype:o.dtype};if("string"===o.dtype){const e=new Promise((async e=>{const t=await o.bytes(),n=t.reduce(((e,t)=>e+t.length),0)+NUM_BYTES_STRING_LENGTH*t.length,r=new Uint8Array(n);let a=0;for(let i=0;i<t.length;i++){const e=t[i],n=new Uint8Array(new Uint32Array([e.length]).buffer);r.set(n,a),a+=NUM_BYTES_STRING_LENGTH,r.set(e,a),a+=e.length}e(r)}));r.push(e)}else r.push(o.data());null!=t&&(l.group=t),n.push(l)}return{data:concatenateTypedArrays(await Promise.all(r)),specs:n}}function decodeWeights(e,t){const n=new CompositeArrayBuffer(e),r={};let a,i=0;for(const s of t){const e=s.name,t=s.dtype,o=s.shape,l=sizeFromShape(o);let u;if("quantization"in s){const r=s.quantization;if("uint8"===r.dtype||"uint16"===r.dtype){if(!("min"in r)||!("scale"in r))throw new Error(`Weight ${s.name} with quantization ${r.dtype} doesn't have corresponding metadata min and scale.`)}else{if("float16"!==r.dtype)throw new Error(`Weight ${s.name} has unknown quantization dtype ${r.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);if("float32"!==t)throw new Error(`Weight ${s.name} is quantized with ${r.dtype} which only supports weights of type float32 not ${t}.`)}const o=DTYPE_VALUE_SIZE_MAP[r.dtype],c=n.slice(i,i+l*o),h="uint8"===r.dtype?new Uint8Array(c):new Uint16Array(c);if("float32"===t)if("uint8"===r.dtype||"uint16"===r.dtype){u=new Float32Array(h.length);for(let e=0;e<h.length;e++){const t=h[e];u[e]=t*r.scale+r.min}}else{if("float16"!==r.dtype)throw new Error(`Unsupported quantization type ${r.dtype} for weight type float32.`);void 0===a&&(a=getFloat16Decoder()),u=a(h)}else{if("int32"!==t)throw new Error(`Unsupported dtype in weight '${e}': ${t}`);if("uint8"!==r.dtype&&"uint16"!==r.dtype)throw new Error(`Unsupported quantization type ${r.dtype} for weight type int32.`);u=new Int32Array(h.length);for(let e=0;e<h.length;e++){const t=h[e];u[e]=Math.round(t*r.scale+r.min)}}i+=l*o}else if("string"===t){const e=sizeFromShape(s.shape);u=[];for(let t=0;t<e;t++){const e=new Uint32Array(n.slice(i,i+NUM_BYTES_STRING_LENGTH))[0];i+=NUM_BYTES_STRING_LENGTH;const t=new Uint8Array(n.slice(i,i+e));u.push(t),i+=e}}else{const a=DTYPE_VALUE_SIZE_MAP[t],s=n.slice(i,i+l*a);if("float32"===t)u=new Float32Array(s);else if("int32"===t)u=new Int32Array(s);else if("bool"===t)u=new Uint8Array(s);else{if("complex64"!==t)throw new Error(`Unsupported dtype in weight '${e}': ${t}`);{u=new Float32Array(s);const t=new Float32Array(u.length/2),n=new Float32Array(u.length/2);for(let e=0;e<t.length;e++)t[e]=u[2*e],n[e]=u[2*e+1];const a=tensor(t,o,"float32"),i=tensor(n,o,"float32");r[e]=complex$2(a,i),a.dispose(),i.dispose()}}i+=l*a}"complex64"!==t&&(r[e]=tensor(u,o,t))}return r}function concatenateTypedArrays(e){if(null===e)throw new Error(`Invalid input value: ${JSON.stringify(e)}`);let t=0;const n=[];e.forEach((e=>{if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${e.constructor.name}`)}));const r=new Uint8Array(t);let a=0;return n.forEach((e=>{r.set(new Uint8Array(e.buffer),a),a+=e.byteLength})),r.buffer}const useNodeBuffer="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function stringByteLength(e){return useNodeBuffer?Buffer.byteLength(e,"utf8"):new Blob([e]).size}function arrayBufferToBase64String(e){if(useNodeBuffer)return Buffer.from(e).toString("base64");const t=new Uint8Array(e);let n="";for(let r=0,a=t.length;r<a;r++)n+=String.fromCharCode(t[r]);return btoa(n)}function base64StringToArrayBuffer(e){if(useNodeBuffer){const t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}const t=atob(e),n=new Uint8Array(t.length);for(let r=0;r<t.length;++r)n.set([t.charCodeAt(r)],r);return n.buffer}function concatenateArrayBuffers(e){return CompositeArrayBuffer.join(e)}function basename(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);const t=e.split("/");return t[t.length-1]}function getModelJSONForModelArtifacts(e,t){const n={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:t};return null!=e.signature&&(n.signature=e.signature),null!=e.userDefinedMetadata&&(n.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(n.modelInitializer=e.modelInitializer),null!=e.initializerSignature&&(n.initializerSignature=e.initializerSignature),null!=e.trainingConfig&&(n.trainingConfig=e.trainingConfig),n}function getModelArtifactsForJSONSync(e,t,n){const r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy};if(null!=e.trainingConfig&&(r.trainingConfig=e.trainingConfig),null!=e.weightsManifest){if(!t)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw new Error("modelJSON has weightsManifest but weightData is null");r.weightSpecs=t,r.weightData=n}return null!=e.signature&&(r.signature=e.signature),null!=e.userDefinedMetadata&&(r.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(r.modelInitializer=e.modelInitializer),null!=e.initializerSignature&&(r.initializerSignature=e.initializerSignature),r}async function getModelArtifactsForJSON(e,t){let n,r;return null!=e.weightsManifest&&([n,r]=await t(e.weightsManifest)),getModelArtifactsForJSONSync(e,n,r)}function getModelArtifactsInfoForJSON(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:stringByteLength(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:stringByteLength(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:new CompositeArrayBuffer(e.weightData).byteLength}}function getWeightSpecs(e){const t=[];for(const n of e)t.push(...n.weights);return t}function computeFloat16MantisaTable(){const e=e=>{let t=e<<13,n=0;for(;0==(8388608&t);)n-=8388608,t<<=1;return t&=-8388609,n+=947912704,t|n},t=new Uint32Array(2048);t[0]=0;for(let n=1;n<1024;n++)t[n]=e(n);for(let n=1024;n<2048;n++)t[n]=939524096+(n-1024<<13);return t}function computeFloat16ExponentTable(){const e=new Uint32Array(64);e[0]=0,e[31]=1199570944,e[32]=2147483648,e[63]=3347054592;for(let t=1;t<31;t++)e[t]=t<<23;for(let t=33;t<63;t++)e[t]=2147483648+(t-32<<23);return e}function computeFloat16OffsetTable(){const e=new Uint32Array(64);for(let t=0;t<64;t++)e[t]=1024;return e[0]=e[32]=0,e}function getFloat16Decoder(){const e=computeFloat16MantisaTable(),t=computeFloat16ExponentTable(),n=computeFloat16OffsetTable();return r=>{const a=new ArrayBuffer(4*r.length),i=new Uint32Array(a);for(let s=0;s<r.length;s++){const a=r[s],o=e[n[a>>10]+(1023&a)]+t[a>>10];i[s]=o}return new Float32Array(a)}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class IORouterRegistry{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return null==IORouterRegistry.instance&&(IORouterRegistry.instance=new IORouterRegistry),IORouterRegistry.instance}static registerSaveRouter(e){IORouterRegistry.getInstance().saveRouters.push(e)}static registerLoadRouter(e){IORouterRegistry.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return IORouterRegistry.getHandlers(e,"save")}static getLoadHandlers(e,t){return IORouterRegistry.getHandlers(e,"load",t)}static getHandlers(e,t,n){const r=[];return("load"===t?IORouterRegistry.getInstance().loadRouters:IORouterRegistry.getInstance().saveRouters).forEach((t=>{const a=t(e,n);null!==a&&r.push(a)})),r}}const registerSaveRouter=e=>IORouterRegistry.registerSaveRouter(e),registerLoadRouter=e=>IORouterRegistry.registerLoadRouter(e),getSaveHandlers=e=>IORouterRegistry.getSaveHandlers(e),getLoadHandlers=(e,t)=>IORouterRegistry.getLoadHandlers(e,t)
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */,DATABASE_NAME="tensorflowjs",DATABASE_VERSION=1,MODEL_STORE_NAME="models_store",INFO_STORE_NAME="model_info_store";function getIndexedDBFactory(){if(!env().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const e="undefined"==typeof window?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function setUpDatabase(e){const t=e.result;t.createObjectStore(MODEL_STORE_NAME,{keyPath:"modelPath"}),t.createObjectStore(INFO_STORE_NAME,{keyPath:"modelPath"})}class BrowserIndexedDB{constructor(e){if(this.indexedDB=getIndexedDBFactory(),null==e||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise(((e,n)=>{const r=this.indexedDB.open(DATABASE_NAME,DATABASE_VERSION);r.onupgradeneeded=()=>setUpDatabase(r),r.onsuccess=()=>{const a=r.result;if(null==t){const t=a.transaction(MODEL_STORE_NAME,"readonly"),r=t.objectStore(MODEL_STORE_NAME).get(this.modelPath);r.onsuccess=()=>{if(null==r.result)return a.close(),n(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));e(r.result.modelArtifacts)},r.onerror=e=>(a.close(),n(r.error)),t.oncomplete=()=>a.close()}else{t.weightData=CompositeArrayBuffer.join(t.weightData);const r=getModelArtifactsInfoForJSON(t),s=a.transaction(INFO_STORE_NAME,"readwrite");let o,l,u=s.objectStore(INFO_STORE_NAME);try{o=u.put({modelPath:this.modelPath,modelArtifactsInfo:r})}catch(i){return n(i)}o.onsuccess=()=>{l=a.transaction(MODEL_STORE_NAME,"readwrite");const o=l.objectStore(MODEL_STORE_NAME);let c;try{c=o.put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:r})}catch(i){return n(i)}c.onsuccess=()=>e({modelArtifactsInfo:r}),c.onerror=e=>{u=s.objectStore(INFO_STORE_NAME);const t=u.delete(this.modelPath);t.onsuccess=()=>(a.close(),n(c.error)),t.onerror=e=>(a.close(),n(c.error))}},o.onerror=e=>(a.close(),n(o.error)),s.oncomplete=()=>{null==l?a.close():l.oncomplete=()=>a.close()}}},r.onerror=e=>n(r.error)}))}}BrowserIndexedDB.URL_SCHEME="indexeddb://";const indexedDBRouter=e=>env().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(BrowserIndexedDB.URL_SCHEME)?browserIndexedDB(e.slice(BrowserIndexedDB.URL_SCHEME.length)):null;function browserIndexedDB(e){return new BrowserIndexedDB(e)}function maybeStripScheme$1(e){return e.startsWith(BrowserIndexedDB.URL_SCHEME)?e.slice(BrowserIndexedDB.URL_SCHEME.length):e}IORouterRegistry.registerSaveRouter(indexedDBRouter),IORouterRegistry.registerLoadRouter(indexedDBRouter);class BrowserIndexedDBManager{constructor(){this.indexedDB=getIndexedDBFactory()}async listModels(){return new Promise(((e,t)=>{const n=this.indexedDB.open(DATABASE_NAME,DATABASE_VERSION);n.onupgradeneeded=()=>setUpDatabase(n),n.onsuccess=()=>{const r=n.result,a=r.transaction(INFO_STORE_NAME,"readonly"),i=a.objectStore(INFO_STORE_NAME).getAll();i.onsuccess=()=>{const t={};for(const e of i.result)t[e.modelPath]=e.modelArtifactsInfo;e(t)},i.onerror=e=>(r.close(),t(i.error)),a.oncomplete=()=>r.close()},n.onerror=e=>t(n.error)}))}async removeModel(e){return e=maybeStripScheme$1(e),new Promise(((t,n)=>{const r=this.indexedDB.open(DATABASE_NAME,DATABASE_VERSION);r.onupgradeneeded=()=>setUpDatabase(r),r.onsuccess=()=>{const a=r.result,i=a.transaction(INFO_STORE_NAME,"readwrite"),s=i.objectStore(INFO_STORE_NAME),o=s.get(e);let l;o.onsuccess=()=>{if(null==o.result)return a.close(),n(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const r=s.delete(e),i=()=>{l=a.transaction(MODEL_STORE_NAME,"readwrite");const r=l.objectStore(MODEL_STORE_NAME).delete(e);r.onsuccess=()=>t(o.result.modelArtifactsInfo),r.onerror=e=>n(o.error)};r.onsuccess=i,r.onerror=e=>(i(),a.close(),n(o.error))}},o.onerror=e=>(a.close(),n(o.error)),i.oncomplete=()=>{null==l?a.close():l.oncomplete=()=>a.close()}},r.onerror=e=>n(r.error)}))}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const PATH_SEPARATOR="/",PATH_PREFIX="tensorflowjs_models",INFO_SUFFIX="info",MODEL_TOPOLOGY_SUFFIX="model_topology",WEIGHT_SPECS_SUFFIX="weight_specs",WEIGHT_DATA_SUFFIX="weight_data",MODEL_METADATA_SUFFIX="model_metadata";function getModelKeys(e){return{info:[PATH_PREFIX,e,INFO_SUFFIX].join(PATH_SEPARATOR),topology:[PATH_PREFIX,e,MODEL_TOPOLOGY_SUFFIX].join(PATH_SEPARATOR),weightSpecs:[PATH_PREFIX,e,WEIGHT_SPECS_SUFFIX].join(PATH_SEPARATOR),weightData:[PATH_PREFIX,e,WEIGHT_DATA_SUFFIX].join(PATH_SEPARATOR),modelMetadata:[PATH_PREFIX,e,MODEL_METADATA_SUFFIX].join(PATH_SEPARATOR)}}function removeItems(e){for(const t of Object.values(e))window.localStorage.removeItem(t)}function getModelPathFromKey(e){const t=e.split(PATH_SEPARATOR);if(t.length<3)throw new Error(`Invalid key format: ${e}`);return t.slice(1,t.length-1).join(PATH_SEPARATOR)}function maybeStripScheme(e){return e.startsWith(BrowserLocalStorage.URL_SCHEME)?e.slice(BrowserLocalStorage.URL_SCHEME.length):e}class BrowserLocalStorage{constructor(e){if(!env().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==e||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=getModelKeys(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const n=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),a=getModelArtifactsInfoForJSON(e),i=CompositeArrayBuffer.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,arrayBufferToBase64String(i));const t={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:null!=e.signature?e.signature:void 0,userDefinedMetadata:null!=e.userDefinedMetadata?e.userDefinedMetadata:void 0,modelInitializer:null!=e.modelInitializer?e.modelInitializer:void 0,initializerSignature:null!=e.initializerSignature?e.initializerSignature:void 0,trainingConfig:null!=e.trainingConfig?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(t)),{modelArtifactsInfo:a}}catch(t){throw removeItems(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${a.modelTopologyBytes}, weightSpecsBytes=${a.weightSpecsBytes}, weightDataBytes=${a.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(null==e)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if("JSON"!==e.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const t={},n=JSON.parse(this.LS.getItem(this.keys.topology));if(null==n)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=n;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(null==r)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=r;const a=this.LS.getItem(this.keys.modelMetadata);if(null!=a){const e=JSON.parse(a);t.format=e.format,t.generatedBy=e.generatedBy,t.convertedBy=e.convertedBy,null!=e.signature&&(t.signature=e.signature),null!=e.userDefinedMetadata&&(t.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(t.modelInitializer=e.modelInitializer),null!=e.initializerSignature&&(t.initializerSignature=e.initializerSignature),null!=e.trainingConfig&&(t.trainingConfig=e.trainingConfig)}const i=this.LS.getItem(this.keys.weightData);if(null==i)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=base64StringToArrayBuffer(i),t}}BrowserLocalStorage.URL_SCHEME="localstorage://";const localStorageRouter=e=>env().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(BrowserLocalStorage.URL_SCHEME)?browserLocalStorage(e.slice(BrowserLocalStorage.URL_SCHEME.length)):null;function browserLocalStorage(e){return new BrowserLocalStorage(e)}IORouterRegistry.registerSaveRouter(localStorageRouter),IORouterRegistry.registerLoadRouter(localStorageRouter);class BrowserLocalStorageManager{constructor(){assert$1(env().getBool("IS_BROWSER"),(()=>"Current environment is not a web browser")),assert$1("undefined"==typeof window||void 0!==window.localStorage,(()=>"Current browser does not appear to support localStorage")),this.LS=window.localStorage}async listModels(){const e={},t=PATH_PREFIX+PATH_SEPARATOR,n=PATH_SEPARATOR+INFO_SUFFIX;for(let r=0;r<this.LS.length;++r){const a=this.LS.key(r);if(a.startsWith(t)&&a.endsWith(n)){e[getModelPathFromKey(a)]=JSON.parse(this.LS.getItem(a))}}return e}async removeModel(e){const t=getModelKeys(e=maybeStripScheme(e));if(null==this.LS.getItem(t.info))throw new Error(`Cannot find model at path '${e}'`);const n=JSON.parse(this.LS.getItem(t.info));return removeItems(t),n}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const URL_SCHEME_SUFFIX="://";class ModelStoreManagerRegistry{constructor(){this.managers={}}static getInstance(){return null==ModelStoreManagerRegistry.instance&&(ModelStoreManagerRegistry.instance=new ModelStoreManagerRegistry),ModelStoreManagerRegistry.instance}static registerManager(e,t){assert$1(null!=e,(()=>"scheme must not be undefined or null.")),e.endsWith(URL_SCHEME_SUFFIX)&&(e=e.slice(0,e.indexOf(URL_SCHEME_SUFFIX))),assert$1(e.length>0,(()=>"scheme must not be an empty string."));const n=ModelStoreManagerRegistry.getInstance();assert$1(null==n.managers[e],(()=>`A model store manager is already registered for scheme '${e}'.`)),n.managers[e]=t}static getManager(e){const t=ModelStoreManagerRegistry.getInstance().managers[e];if(null==t)throw new Error(`Cannot find model manager for scheme '${e}'`);return t}static getSchemes(){return Object.keys(ModelStoreManagerRegistry.getInstance().managers)}}function parseURL(e){if(-1===e.indexOf(URL_SCHEME_SUFFIX))throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${ModelStoreManagerRegistry.getSchemes().join(",")}`);return{scheme:e.split(URL_SCHEME_SUFFIX)[0],path:e.split(URL_SCHEME_SUFFIX)[1]}}async function cloneModelInternal(e,t,n=!1){assert$1(e!==t,(()=>`Old path and new path are the same: '${e}'`));const r=IORouterRegistry.getLoadHandlers(e);assert$1(r.length>0,(()=>`Copying failed because no load handler is found for source URL ${e}.`)),assert$1(r.length<2,(()=>`Copying failed because more than one (${r.length}) load handlers for source URL ${e}.`));const a=r[0],i=IORouterRegistry.getSaveHandlers(t);assert$1(i.length>0,(()=>`Copying failed because no save handler is found for destination URL ${t}.`)),assert$1(i.length<2,(()=>`Copying failed because more than one (${r.length}) save handlers for destination URL ${t}.`));const s=i[0],o=parseURL(e).scheme,l=parseURL(e).path,u=o===parseURL(e).scheme,c=await a.load();n&&u&&await ModelStoreManagerRegistry.getManager(o).removeModel(l);const h=await s.save(c);return n&&!u&&await ModelStoreManagerRegistry.getManager(o).removeModel(l),h.modelArtifactsInfo}async function listModels(){const e=ModelStoreManagerRegistry.getSchemes(),t={};for(const n of e){const e=await ModelStoreManagerRegistry.getManager(n).listModels();for(const r in e){t[n+URL_SCHEME_SUFFIX+r]=e[r]}}return t}async function removeModel(e){const t=parseURL(e);return ModelStoreManagerRegistry.getManager(t.scheme).removeModel(t.path)}async function copyModel(e,t){return cloneModelInternal(e,t,!1)}async function moveModel(e,t){return cloneModelInternal(e,t,!0)}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class PlatformBrowser{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error(`Browser's encoder only supports utf-8, but got ${t}`);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}setTimeoutCustom(e,t){"undefined"!=typeof window&&env().getBool("USE_SETTIMEOUTCUSTOM")?(this.functionRefs.push(e),setTimeout((()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")}),t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",(e=>{if(e.source===window&&e.data.name===this.messageName){e.stopPropagation();(0,this.functionRefs[e.data.index])(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}}),!0))):setTimeout(e,t)}isTypedArray(e){return isTypedArrayBrowser(e)}}if(env().get("IS_BROWSER")){env().setPlatform("browser",new PlatformBrowser);try{ModelStoreManagerRegistry.registerManager(BrowserLocalStorage.URL_SCHEME,new BrowserLocalStorageManager)}catch(err){}try{ModelStoreManagerRegistry.registerManager(BrowserIndexedDB.URL_SCHEME,new BrowserIndexedDBManager)}catch(err){}}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const getNodeFetch={importFetch:()=>require("node-fetch")};let systemFetch;class PlatformNode{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,t){return null!=env().global.fetch?env().global.fetch(e,t):(null==systemFetch&&(systemFetch=getNodeFetch.importFetch()),systemFetch(e,t))}now(){const e=process.hrtime();return 1e3*e[0]+e[1]/1e6}encode(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error(`Node built-in encoder only supports utf-8, but got ${t}`);return this.textEncoder.encode(e)}decode(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}
/**
     * @license
     * Copyright 2020 Google Inc. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function buffer(e,t="float32",n){return t=t||"float32",assertNonNegativeIntegerDimensions(e),new TensorBuffer(e,t,n)}
/**
     * @license
     * Copyright 2020 Google Inc. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function cast_(e,t){const n=convertToTensor(e,"x","cast");if(!isValidDtype(t))throw new Error(`Failed to cast to unknown dtype ${t}`);if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");const r={x:n},a={dtype:t};return ENGINE.runKernel(Cast,r,a)}env().get("IS_NODE")&&!env().get("IS_BROWSER")&&env().setPlatform("node",new PlatformNode);const cast$3=op({cast_:cast_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function clone_(e){const t={x:convertToTensor(e,"x","clone","string_or_numeric")};return ENGINE.runKernel(Identity$1,t)}const clone=op({clone_:clone_});
/**
     * @license
     * Copyright 2020 Google Inc. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function print(e,t=!1){console.log(e.toString(t))}
/**
     * @license
     * Copyright 2020 Google Inc. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */getOrMakeEngine();const opHandler={buffer:buffer,cast:cast$3,clone:clone,print:print};
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function engine(){return ENGINE}function memory(){return ENGINE.memory()}function tidy(e,t){return ENGINE.tidy(e,t)}function dispose(e){getTensorsInContainer(e).forEach((e=>e.dispose()))}function keep(e){return ENGINE.keep(e)}function setBackend(e){return ENGINE.setBackend(e)}function registerBackend(e,t,n=1){return ENGINE.registerBackend(e,t,n)}function backend(){return ENGINE.backend}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function add_(e,t){let n=convertToTensor(e,"a","add"),r=convertToTensor(t,"b","add");[n,r]=makeTypesMatch(n,r);const a={a:n,b:r};return ENGINE.runKernel(Add$1,a)}setOpHandler(opHandler);const add$1=op({add_:add_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function floorDiv_(e,t){let n=convertToTensor(e,"a","floorDiv"),r=convertToTensor(t,"b","floorDiv");[n,r]=makeTypesMatch(n,r);const a={a:n,b:r};return ENGINE.runKernel(FloorDiv,a)}const floorDiv$2=op({floorDiv_:floorDiv_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function div_(e,t){let n=convertToTensor(e,"a","div"),r=convertToTensor(t,"b","div");if([n,r]=makeTypesMatch(n,r),"int32"===n.dtype&&"int32"===r.dtype)return floorDiv$2(n,r);const a={a:n,b:r};return ENGINE.runKernel(RealDiv,a,{})}const div$1=op({div_:div_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function mul_(e,t){let n=convertToTensor(e,"a","mul"),r=convertToTensor(t,"b","mul");[n,r]=makeTypesMatch(n,r);const a={a:n,b:r};return ENGINE.runKernel(Multiply$1,a)}const mul=op({mul_:mul_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function abs_(e){const t=convertToTensor(e,"x","abs");if("complex64"===t.dtype){const e={x:t};return ENGINE.runKernel(ComplexAbs,e)}{const e={x:t};return ENGINE.runKernel(Abs,e)}}const abs$2=op({abs_:abs_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function acos_(e){const t={x:convertToTensor(e,"x","acos")};return ENGINE.runKernel(Acos,t)}const acos$2=op({acos_:acos_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function acosh_(e){const t={x:convertToTensor(e,"x","acosh")};return ENGINE.runKernel(Acosh,t)}const acosh$2=op({acosh_:acosh_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function addN_(e){assert$1(Array.isArray(e),(()=>"The argument passed to tf.addN() must be a list of tensors")),assert$1(e.length>=1,(()=>`Must pass at least one tensor to tf.addN(), but got ${e.length}`));const t=e.map(((e,t)=>convertToTensor(e,`tensors${t}`,"addN"))),n=t[0];t.forEach((e=>{if(e.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),t.forEach((e=>{if(!arraysEqual(e.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));const r=t;return ENGINE.runKernel(AddN,r)}const addN$2=op({addN_:addN_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function all_(e,t=null,n=!1){const r={x:convertToTensor(e,"x","all","bool")},a={axis:t,keepDims:n};return ENGINE.runKernel(All,r,a)}const all$2=op({all_:all_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function any_(e,t=null,n=!1){const r={x:convertToTensor(e,"x","any","bool")},a={axis:t,keepDims:n};return ENGINE.runKernel(Any,r,a)}const any$3=op({any_:any_});
/**
     * @license
     * Copyright 2020 Google Inc. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function argMax_(e,t=0){const n={x:convertToTensor(e,"x","argMax")},r={axis:t};return ENGINE.runKernel(ArgMax,n,r)}const argMax$2=op({argMax_:argMax_});
/**
     * @license
     * Copyright 2020 Google Inc. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function argMin_(e,t=0){const n={x:convertToTensor(e,"x","argMin")},r={axis:t};return ENGINE.runKernel(ArgMin,n,r)}const argMin$2=op({argMin_:argMin_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function asin_(e){const t={x:convertToTensor(e,"x","asin")};return ENGINE.runKernel(Asin,t)}const asin$2=op({asin_:asin_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function asinh_(e){const t={x:convertToTensor(e,"x","asinh")};return ENGINE.runKernel(Asinh,t)}const asinh$2=op({asinh_:asinh_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function atan_(e){const t={x:convertToTensor(e,"x","atan")};return ENGINE.runKernel(Atan,t)}const atan$2=op({atan_:atan_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function atan2_(e,t){let n=convertToTensor(e,"a","atan2"),r=convertToTensor(t,"b","atan2");[n,r]=makeTypesMatch(n,r);const a={a:n,b:r};return ENGINE.runKernel(Atan2,a)}const atan2$2=op({atan2_:atan2_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function atanh_(e){const t={x:convertToTensor(e,"x","atanh")};return ENGINE.runKernel(Atanh,t)}const atanh$2=op({atanh_:atanh_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function computeDilation2DInfo(e,t,n,r,a="NHWC",i){return computeConv2DInfo(e,[...t,e[3]],n,i,r,null,null,convertConv2DDataFormat(a))}function computePool2DInfo(e,t,n,r,a,i,s="channelsLast"){const[o,l]=parseTupleParam(t);let u;if("channelsLast"===s)u=[o,l,e[3],e[3]];else{if("channelsFirst"!==s)throw new Error(`Unknown dataFormat ${s}`);u=[o,l,e[1],e[1]]}return computeConv2DInfo(e,u,n,r,a,i,!1,s)}function computePool3DInfo(e,t,n,r,a,i,s="NDHWC"){const[o,l,u]=parse3TupleParam(t);let c,h;if("NDHWC"===s)h="channelsLast",c=[o,l,u,e[4],e[4]];else{if("NCDHW"!==s)throw new Error(`Unknown dataFormat ${s}`);h="channelsFirst",c=[o,l,u,e[1],e[1]]}return computeConv3DInfo(e,c,n,r,a,!1,h,i)}function computeConv2DInfo(e,t,n,r,a,i,s=!1,o="channelsLast"){let[l,u,c,h]=[-1,-1,-1,-1];if("channelsLast"===o)[l,u,c,h]=e;else{if("channelsFirst"!==o)throw new Error(`Unknown dataFormat ${o}`);[l,h,u,c]=e}const[d,p,,f]=t,[m,g]=parseTupleParam(n),[y,v]=parseTupleParam(r),b=getEffectiveFilterSize(d,y),x=getEffectiveFilterSize(p,v),{padInfo:T,outHeight:_,outWidth:w}=getPadAndOutInfo(a,u,c,m,g,b,x,i,o),S=s?f*h:f;let C;return"channelsFirst"===o?C=[l,S,_,w]:"channelsLast"===o&&(C=[l,_,w,S]),{batchSize:l,dataFormat:o,inHeight:u,inWidth:c,inChannels:h,outHeight:_,outWidth:w,outChannels:S,padInfo:T,strideHeight:m,strideWidth:g,filterHeight:d,filterWidth:p,effectiveFilterHeight:b,effectiveFilterWidth:x,dilationHeight:y,dilationWidth:v,inShape:e,outShape:C,filterShape:t}}function computeConv3DInfo(e,t,n,r,a,i=!1,s="channelsLast",o){let[l,u,c,h,d]=[-1,-1,-1,-1,-1];if("channelsLast"===s)[l,u,c,h,d]=e;else{if("channelsFirst"!==s)throw new Error(`Unknown dataFormat ${s}`);[l,d,u,c,h]=e}const[p,f,m,,g]=t,[y,v,b]=parse3TupleParam(n),[x,T,_]=parse3TupleParam(r),w=getEffectiveFilterSize(p,x),S=getEffectiveFilterSize(f,T),C=getEffectiveFilterSize(m,_),{padInfo:E,outDepth:k,outHeight:I,outWidth:A}=get3DPadAndOutInfo(a,u,c,h,y,v,b,w,S,C,o),N=i?g*d:g;let $;return"channelsFirst"===s?$=[l,N,k,I,A]:"channelsLast"===s&&($=[l,k,I,A,N]),{batchSize:l,dataFormat:s,inDepth:u,inHeight:c,inWidth:h,inChannels:d,outDepth:k,outHeight:I,outWidth:A,outChannels:N,padInfo:E,strideDepth:y,strideHeight:v,strideWidth:b,filterDepth:p,filterHeight:f,filterWidth:m,effectiveFilterDepth:w,effectiveFilterHeight:S,effectiveFilterWidth:C,dilationDepth:x,dilationHeight:T,dilationWidth:_,inShape:e,outShape:$,filterShape:t}}function computeOutputShape2D(e,t,n,r,a){null==r&&(r=computeDefaultPad(e,t,n));const i=e[0],s=e[1];return[round$3((i-t+2*r)/n+1,a),round$3((s-t+2*r)/n+1,a)]}function computeOutputShape4D(e,t,n,r,a,i){null==a&&(a=computeDefaultPad(e,t[0],r[0]));const s=[0,0,0,n];for(let o=0;o<3;o++)e[o]+2*a>=t[o]&&(s[o]=round$3((e[o]-t[o]+2*a)/r[o]+1,i));return s}function computeDefaultPad(e,t,n,r=1){const a=getEffectiveFilterSize(t,r);return Math.floor((e[0]*(n-1)-n+a)/2)}function parseTupleParam(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function parse3TupleParam(e){return"number"==typeof e?[e,e,e]:e}function getEffectiveFilterSize(e,t){return t<=1?e:e+(e-1)*(t-1)}function getPadAndOutInfo(e,t,n,r,a,i,s,o,l){let u,c,h;if("number"==typeof e){u={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};const a=computeOutputShape2D([t,n],i,r,e,o);c=a[0],h=a[1]}else if("same"===e){c=Math.ceil(t/r),h=Math.ceil(n/a);const e=Math.max(0,(c-1)*r+i-t),o=Math.max(0,(h-1)*a+s-n),l=Math.floor(e/2),d=e-l,p=Math.floor(o/2);u={top:l,bottom:d,left:p,right:o-p,type:"SAME"}}else if("valid"===e)u={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((t-i+1)/r),h=Math.ceil((n-s+1)/a);else{if("object"!=typeof e)throw Error(`Unknown padding parameter: ${e}`);{const d="channelsLast"===l?e[1][0]:e[2][0],p="channelsLast"===l?e[1][1]:e[2][1],f="channelsLast"===l?e[2][0]:e[3][0],m="channelsLast"===l?e[2][1]:e[3][1];u={top:d,bottom:p,left:f,right:m,type:0===d&&0===p&&0===f&&0===m?"VALID":"EXPLICIT"},c=round$3((t-i+d+p)/r+1,o),h=round$3((n-s+f+m)/a+1,o)}}return{padInfo:u,outHeight:c,outWidth:h}}function get3DPadAndOutInfo(e,t,n,r,a,i,s,o,l,u,c){let h,d,p,f;if("valid"===e&&(e=0),"number"==typeof e){h={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};const m=computeOutputShape4D([t,n,r,1],[o,l,u],1,[a,i,s],e,c);d=m[0],p=m[1],f=m[2]}else{if("same"!==e)throw Error(`Unknown padding parameter: ${e}`);{d=Math.ceil(t/a),p=Math.ceil(n/i),f=Math.ceil(r/s);const e=(d-1)*a+o-t,c=(p-1)*i+l-n,m=(f-1)*s+u-r,g=Math.floor(e/2),y=e-g,v=Math.floor(c/2),b=c-v,x=Math.floor(m/2);h={top:v,bottom:b,left:x,right:m-x,front:g,back:y,type:"SAME"}}}return{padInfo:h,outDepth:d,outHeight:p,outWidth:f}}function round$3(e,t){if(!t)return Math.trunc(e);switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error(`Unknown roundingMode ${t}`)}}function tupleValuesAreOne(e){const[t,n,r]=parseTupleParam(e);return 1===t&&1===n&&1===r}function eitherStridesOrDilationsAreOne(e,t){return tupleValuesAreOne(e)||tupleValuesAreOne(t)}function stridesOrDilationsArePositive(e){return parseTupleParam(e).every((e=>e>0))}function convertConv2DDataFormat(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error(`Unknown dataFormat ${e}`)}function checkPadOnDimRoundingMode(e,t,n){if(null!=n){if("string"==typeof t)throw Error(`Error in ${e}: pad must be an integer when using dimRoundingMode ${n} but got pad ${t}.`);if("number"==typeof t)assert$1(isInt(t),(()=>`Error in ${e}: pad must be an integer when using dimRoundingMode ${n} but got pad ${t}.`));else{if("object"!=typeof t)throw Error(`Error in ${e}: Unknown padding parameter: ${t}`);t.forEach((t=>{t.forEach((t=>{assert$1(isInt(t),(()=>`Error in ${e}: pad must be an integer when using dimRoundingMode ${n} but got pad ${t}.`))}))}))}}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function reshape_(e,t){const n={x:convertToTensor(e,"x","reshape","string_or_numeric")},r={shape:t};return ENGINE.runKernel(Reshape$1,n,r)}const reshape$2=op({reshape_:reshape_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function avgPool_(e,t,n,r,a){const i=convertToTensor(e,"x","avgPool","float32");assert$1(eitherStridesOrDilationsAreOne(n,1),(()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`));let s=i,o=!1;3===i.rank&&(o=!0,s=reshape$2(i,[1,i.shape[0],i.shape[1],i.shape[2]])),assert$1(4===s.rank,(()=>`Error in avgPool: x must be rank 4 but got rank ${s.rank}.`)),checkPadOnDimRoundingMode("avgPool",r,a);const l={x:s},u={filterSize:t,strides:n,pad:r,dimRoundingMode:a};let c=ENGINE.runKernel(AvgPool,l,u);return c=cast$3(c,i.dtype),o?reshape$2(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const avgPool$2=op({avgPool_:avgPool_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function avgPool3d_(e,t,n,r,a,i="NDHWC"){const s=convertToTensor(e,"x","avgPool3d","float32");let o=s,l=!1;4===s.rank&&(l=!0,o=reshape$2(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),assert$1(5===o.rank,(()=>`Error in avgPool3d: x must be rank 5 but got rank ${o.rank}.`)),assert$1("NDHWC"===i,(()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`)),assert$1("number"==typeof n&&n>0||Array.isArray(n)&&n[0]>0&&n[1]>0&&n[2]>0,(()=>`Error in avgPool3d: Stride must be > 0, but got '${n}'`)),checkPadOnDimRoundingMode("avgPool3d",r,a);const u={x:o},c={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:i};let h=ENGINE.runKernel(AvgPool3D,u,c);return h=cast$3(h,o.dtype),l?reshape$2(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const avgPool3d=op({avgPool3d_:avgPool3d_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function concat_(e,t=0){assert$1(e.length>=1,(()=>"Pass at least one tensor to concat"));const n=convertToTensorArray(e,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach((e=>{if("complex64"!==e.dtype)throw new Error(`Cannot concatenate complex64 tensors with a tensor\n          with dtype ${e.dtype}. `)})),1===n.length)return clone(n[0]);const r=n,a={axis:t};return ENGINE.runKernel(Concat,r,a)}const concat$2=op({concat_:concat_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function matMul_(e,t,n=!1,r=!1){let a=convertToTensor(e,"a","matMul"),i=convertToTensor(t,"b","matMul");[a,i]=makeTypesMatch(a,i);const s={a:a,b:i},o={transposeA:n,transposeB:r};return ENGINE.runKernel(BatchMatMul,s,o)}const matMul$1=op({matMul_:matMul_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function sigmoid_(e){const t={x:convertToTensor(e,"x","sigmoid","float32")};return ENGINE.runKernel(Sigmoid$1,t)}const sigmoid$2=op({sigmoid_:sigmoid_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function slice_(e,t,n){const r=convertToTensor(e,"x","slice","string_or_numeric");if(0===r.rank)throw new Error("Slicing scalar is not possible");const a={x:r},i={begin:t,size:n};return ENGINE.runKernel(Slice,a,i)}const slice$2=op({slice_:slice_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function tanh_(e){const t={x:convertToTensor(e,"x","tanh","float32")};return ENGINE.runKernel(Tanh$1,t)}const tanh$2=op({tanh_:tanh_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function basicLSTMCell_(e,t,n,r,a,i){const s=convertToTensor(e,"forgetBias","basicLSTMCell"),o=convertToTensor(t,"lstmKernel","basicLSTMCell"),l=convertToTensor(n,"lstmBias","basicLSTMCell"),u=convertToTensor(r,"data","basicLSTMCell"),c=convertToTensor(a,"c","basicLSTMCell"),h=convertToTensor(i,"h","basicLSTMCell"),d=concat$2([u,h],1),p=matMul$1(d,o),f=add$1(p,l),m=f.shape[0],g=f.shape[1]/4,y=[m,g],v=slice$2(f,[0,0],y),b=slice$2(f,[0,g],y),x=slice$2(f,[0,2*g],y),T=slice$2(f,[0,3*g],y),_=add$1(mul(sigmoid$2(v),tanh$2(b)),mul(c,sigmoid$2(add$1(s,x))));return[_,mul(tanh$2(_),sigmoid$2(T))]}const basicLSTMCell=op({basicLSTMCell_:basicLSTMCell_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function batchToSpaceND_(e,t,n){const r=convertToTensor(e,"x","batchToSpaceND"),a=t.reduce(((e,t)=>e*t));assert$1(r.rank>=1+t.length,(()=>`input rank is ${r.rank} but should be > than blockShape.length ${t.length}`)),assert$1(n.length===t.length,(()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${t.length}`)),assert$1(r.shape[0]%a==0,(()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${t.join(" * ")} === ${a}`));const i={x:r},s={blockShape:t,crops:n};return ENGINE.runKernel(BatchToSpaceND,i,s)}const batchToSpaceND$2=op({batchToSpaceND_:batchToSpaceND_});function xAs4D(e){let t;return t=0===e.rank||1===e.rank?reshape$2(e,[1,1,1,e.size]):2===e.rank?reshape$2(e,[1,1,e.shape[0],e.shape[1]]):3===e.rank?reshape$2(e,[1,e.shape[0],e.shape[1],e.shape[2]]):e,t}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function batchNorm_(e,t,n,r,a,i){null==i&&(i=.001);const s=convertToTensor(e,"x","batchNorm"),o=convertToTensor(t,"mean","batchNorm"),l=convertToTensor(n,"variance","batchNorm");let u,c;null!=a&&(u=convertToTensor(a,"scale","batchNorm")),null!=r&&(c=convertToTensor(r,"offset","batchNorm")),assert$1(o.rank===l.rank,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),assert$1(null==c||o.rank===c.rank,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),assert$1(null==u||o.rank===u.rank,(()=>"Batch normalization gradient requires mean and scale to have equal ranks."));const h={x:xAs4D(s),scale:u,offset:c,mean:o,variance:l},d={varianceEpsilon:i},p=ENGINE.runKernel(FusedBatchNorm,h,d);return reshape$2(p,s.shape)}const batchNorm$2=op({batchNorm_:batchNorm_});function batchNorm2d_(e,t,n,r,a,i){const s=convertToTensor(e,"x","batchNorm"),o=convertToTensor(t,"mean","batchNorm"),l=convertToTensor(n,"variance","batchNorm");let u,c;return null!=a&&(u=convertToTensor(a,"scale","batchNorm")),null!=r&&(c=convertToTensor(r,"offset","batchNorm")),assert$1(2===s.rank,(()=>`Error in batchNorm2D: x must be rank 2 but got rank ${s.rank}.`)),assert$1(2===o.rank||1===o.rank,(()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${o.rank}.`)),assert$1(2===l.rank||1===l.rank,(()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`)),null!=u&&assert$1(2===u.rank||1===u.rank,(()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${u.rank}.`)),null!=c&&assert$1(2===c.rank||1===c.rank,(()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${c.rank}.`)),batchNorm$2(s,o,l,c,u,i)}const batchNorm2d=op({batchNorm2d_:batchNorm2d_});function batchNorm3d_(e,t,n,r,a,i){const s=convertToTensor(e,"x","batchNorm"),o=convertToTensor(t,"mean","batchNorm"),l=convertToTensor(n,"variance","batchNorm");let u,c;return null!=a&&(u=convertToTensor(a,"scale","batchNorm")),null!=r&&(c=convertToTensor(r,"offset","batchNorm")),assert$1(3===s.rank,(()=>`Error in batchNorm3D: x must be rank 3 but got rank ${s.rank}.`)),assert$1(3===o.rank||1===o.rank,(()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${o.rank}.`)),assert$1(3===l.rank||1===l.rank,(()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`)),null!=u&&assert$1(3===u.rank||1===u.rank,(()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${u.rank}.`)),null!=c&&assert$1(3===c.rank||1===c.rank,(()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${c.rank}.`)),batchNorm$2(s,o,l,c,u,i)}const batchNorm3d=op({batchNorm3d_:batchNorm3d_});function batchNorm4d_(e,t,n,r,a,i){const s=convertToTensor(e,"x","batchNorm"),o=convertToTensor(t,"mean","batchNorm"),l=convertToTensor(n,"variance","batchNorm");let u,c;return null!=a&&(u=convertToTensor(a,"scale","batchNorm")),null!=r&&(c=convertToTensor(r,"offset","batchNorm")),assert$1(4===s.rank,(()=>`Error in batchNorm4D: x must be rank 4 but got rank ${s.rank}.`)),assert$1(4===o.rank||1===o.rank,(()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${o.rank}.`)),assert$1(4===l.rank||1===l.rank,(()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`)),null!=u&&assert$1(4===u.rank||1===u.rank,(()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${u.rank}.`)),null!=c&&assert$1(4===c.rank||1===c.rank,(()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${c.rank}.`)),batchNorm$2(s,o,l,c,u,i)}const batchNorm4d=op({batchNorm4d_:batchNorm4d_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function bincount_(e,t,n){const r=convertToTensor(e,"x","bincount"),a=convertToTensor(t,"weights","bincount");assert$1("int32"===r.dtype,(()=>`Error in bincount: input dtype must be int32, but got ${r.dtype}`)),assert$1(n>=0,(()=>`size must be non-negative, but got ${n}.`)),assert$1(a.size===r.size||0===a.size,(()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${r.shape}, weights shape: ${a.shape}.`));const i={x:r,weights:a},s={size:n};return ENGINE.runKernel(Bincount,i,s)}const bincount$2=op({bincount_:bincount_});
/**
     * @license
     * Copyright 2023 Google LLC.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function bitwiseAnd_(e,t){const n=convertToTensor(e,"x","bitwiseAnd"),r=convertToTensor(t,"y","bitwiseAnd");if(!arraysEqual(n.shape,r.shape))throw new Error(`BitwiseAnd: Tensors must have the same shape. x: ${n.shape}, y: ${r.shape}`);if("int32"!==n.dtype||"int32"!==r.dtype)throw new Error(`BitwiseAnd: Only supports 'int32' values in tensor, found type of x: ${n.dtype} and type of y: ${r.dtype}`);const a={a:n,b:r};return ENGINE.runKernel(BitwiseAnd,a)}const bitwiseAnd$2=op({bitwiseAnd_:bitwiseAnd_});
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function broadcastArgs_(e,t){const n=convertToTensor(e,"s0","broadcastArgs","int32"),r=convertToTensor(t,"s1","broadcastArgs","int32");if(1!==n.rank)throw new Error(`broadcastArgs(): first input must be a vector (rank=1). Has rank ${n.rank}`);if(1!==r.rank)throw new Error(`broadcastArgs(): second input must be a vector (rank=1). Has rank ${r.rank}`);const a={s0:n,s1:r};return ENGINE.runKernel(BroadcastArgs,a)}const broadcastArgs$2=op({broadcastArgs_:broadcastArgs_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function broadcastTo_(e,t){let n=convertToTensor(e,"broadcastTo","x");const r=n.shape;if(assertNonNegativeIntegerDimensions(t),t.length<n.rank)throw new Error(`broadcastTo(): shape.length=${t.length} < input.rank=${n.rank}.`);if(t.length>n.rank){const e=n.shape.slice();for(;e.length<t.length;)e.unshift(1);n=reshape$2(n,e)}const a=n.shape,i=Array.from(t);for(let l=t.length-1;l>=0;l--)if(a[l]===t[l])i[l]=1;else if(1!==n.shape[l])throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${t}].`);if(0===i.map(((e,t)=>e>1?t:-1)).filter((e=>e>=0)).length)return clone(n);const s={x:n},o={reps:i};return ENGINE.runKernel(Tile,s,o)}const broadcastTo=op({broadcastTo_:broadcastTo_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function ceil_(e){const t={x:convertToTensor(e,"x","ceil","float32")};return ENGINE.runKernel(Ceil,t)}const ceil$2=op({ceil_:ceil_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function fill$2(e,t,n){assertNonNegativeIntegerDimensions(e);const r={shape:e,value:t,dtype:n=n||inferDtype(t)};return ENGINE.runKernel(Fill,{},r)}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function clipByValue_(e,t,n){const r=convertToTensor(e,"x","clipByValue");if(assert$1(t<=n,(()=>`Error in clip: min (${t}) must be less than or equal to max (${n}).`)),t===n)return fill$2(r.shape,t,r.dtype);const a={x:r},i={clipValueMin:t,clipValueMax:n};return ENGINE.runKernel(ClipByValue,a,i)}const clipByValue$2=op({clipByValue_:clipByValue_});function concat1d_(e){return concat$2(e,0)}const concat1d=op({concat1d_:concat1d_});function concat2d_(e,t){return concat$2(e,t)}const concat2d=op({concat2d_:concat2d_});function concat3d_(e,t){return concat$2(e,t)}const concat3d=op({concat3d_:concat3d_});function concat4d_(e,t){return concat$2(e,t)}const concat4d=op({concat4d_:concat4d_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function conv2d_(e,t,n,r,a="NHWC",i=[1,1],s){const o=convertToTensor(e,"x","conv2d","float32"),l=convertToTensor(t,"filter","conv2d","float32");let u=o,c=!1;3===o.rank&&(c=!0,u=reshape$2(o,[1,o.shape[0],o.shape[1],o.shape[2]])),assert$1(4===u.rank,(()=>`Error in conv2d: input must be rank 4, but got rank ${u.rank}.`)),assert$1(4===l.rank,(()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`)),checkPadOnDimRoundingMode("conv2d",r,s);const h="NHWC"===a?u.shape[3]:u.shape[1];assert$1(h===l.shape[2],(()=>`Error in conv2d: depth of input (${h}) must match input depth for filter ${l.shape[2]}.`)),assert$1(eitherStridesOrDilationsAreOne(n,i),(()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${i}'`)),assert$1(stridesOrDilationsArePositive(i),(()=>"Error in conv2D: Dilated rates should be larger than 0.")),assert$1(stridesOrDilationsArePositive(n),(()=>"Error in conv2D: Strides should be larger than 0."));const d={x:u,filter:l},p={strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:s},f=ENGINE.runKernel(Conv2D$1,d,p);return c?reshape$2(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const conv2d$2=op({conv2d_:conv2d_});function conv1d_(e,t,n,r,a="NWC",i=1,s){const o=convertToTensor(e,"x","conv1d"),l=convertToTensor(t,"filter","conv1d");let u=o,c=!1;2===o.rank&&(c=!0,u=reshape$2(o,[1,o.shape[0],o.shape[1]])),assert$1(3===u.rank,(()=>`Error in conv1d: input must be rank 3, but got rank ${u.rank}.`)),assert$1(3===l.rank,(()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`)),checkPadOnDimRoundingMode("conv1d",r,s),assert$1(u.shape[2]===l.shape[1],(()=>`Error in conv1d: depth of input (${u.shape[2]}) must match input depth for filter ${l.shape[1]}.`)),assert$1(eitherStridesOrDilationsAreOne(n,i),(()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${i}'`)),assert$1(stridesOrDilationsArePositive(i),(()=>"Error in conv1D: Dilated rates should be larger than 0.")),assert$1(stridesOrDilationsArePositive(n),(()=>"Error in conv1D: Stride should be larger than 0.")),assert$1("NWC"===a,(()=>`Error in conv1d: got dataFormat of ${a} but only NWC is currently supported.`));const h=reshape$2(l,[1,l.shape[0],l.shape[1],l.shape[2]]),d=reshape$2(u,[u.shape[0],1,u.shape[1],u.shape[2]]),p=conv2d$2(d,h,[1,n],r,"NHWC",[1,i],s);return reshape$2(p,c?[p.shape[2],p.shape[3]]:[p.shape[0],p.shape[2],p.shape[3]])}const conv1d=op({conv1d_:conv1d_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function conv2DBackpropInput_(e,t,n,r,a,i="NHWC",s){assert$1(e.length===t.rank,(()=>`Length of inShape (${e.length}) and rank of dy (${t.rank}) must match`));let o=e,l=t,u=!1;3===t.rank&&(u=!0,l=reshape$2(t,[1,t.shape[0],t.shape[1],t.shape[2]]),o=[1,e[0],e[1],e[2]]),assert$1(4===o.length,(()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${o.length}.`)),assert$1(4===l.rank,(()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`)),assert$1(4===n.rank,(()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`));const c="NHWC"===i?o[3]:o[1],h="NHWC"===i?l.shape[3]:l.shape[1];assert$1(c===n.shape[2],(()=>`Error in conv2dDerInput: depth of input (${c}) must match input depth for filter ${n.shape[2]}.`)),assert$1(h===n.shape[3],(()=>`Error in conv2dDerInput: depth of output (${h}) must match output depth for filter ${n.shape[3]}.`)),checkPadOnDimRoundingMode("conv2dDerInput",a,s);const d={dy:l,filter:n},p={strides:r,pad:a,dataFormat:i,dimRoundingMode:s,inputShape:o},f=ENGINE.runKernel(Conv2DBackpropInput,d,p);return u?reshape$2(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const conv2DBackpropInput$2=op({conv2DBackpropInput_:conv2DBackpropInput_});function conv2dTranspose_(e,t,n,r,a,i){const s=convertToTensor(e,"x","conv2dTranspose"),o=convertToTensor(t,"filter","conv2dTranspose");return conv2DBackpropInput$2(n,s,o,r,a,"NHWC",i)}const conv2dTranspose=op({conv2dTranspose_:conv2dTranspose_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function conv3d_(e,t,n,r,a="NDHWC",i=[1,1,1]){const s=convertToTensor(e,"x","conv3d"),o=convertToTensor(t,"filter","conv3d");let l=s,u=!1;4===s.rank&&(u=!0,l=reshape$2(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),assert$1(5===l.rank,(()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`)),assert$1(5===o.rank,(()=>`Error in conv3d: filter must be rank 5, but got rank ${o.rank}.`)),assert$1(l.shape[4]===o.shape[3],(()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${o.shape[3]}.`)),assert$1(eitherStridesOrDilationsAreOne(n,i),(()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${i}'`)),assert$1("NDHWC"===a,(()=>`Error in conv3d: got dataFormat of ${a} but only NDHWC is currently supported.`)),assert$1(stridesOrDilationsArePositive(i),(()=>"Error in conv3D: Dilated rates should be larger than 0.")),assert$1(stridesOrDilationsArePositive(n),(()=>"Error in conv3D: Strides should be larger than 0."));const c={x:l,filter:o},h={strides:n,pad:r,dataFormat:a,dilations:i},d=ENGINE.runKernel(Conv3D$1,c,h);return u?reshape$2(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const conv3d=op({conv3d_:conv3d_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function conv3DBackpropInput_(e,t,n,r,a){assert$1(e.length===t.rank,(()=>`Length of inShape (${e.length}) and rank of dy (${t.rank}) must match`));let i=e,s=t,o=!1;4===t.rank&&(o=!0,s=reshape$2(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),i=[1,e[0],e[1],e[2],e[3]]);const l=i[4],u=s.shape[4];assert$1(5===i.length,(()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${i.length}.`)),assert$1(5===s.rank,(()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${s.rank}`)),assert$1(5===n.rank,(()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${n.rank}`)),assert$1(l===n.shape[3],(()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${n.shape[3]}.`)),assert$1(u===n.shape[4],(()=>`Error in conv3dDerInput: depth of output (${u}) must match output depth for filter ${n.shape[4]}.`));const c={dy:s,filter:n},h={pad:a,strides:r,inputShape:i},d=ENGINE.runKernel(Conv3DBackpropInputV2,c,h);return o?reshape$2(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const conv3DBackpropInput$1=op({conv3DBackpropInput_:conv3DBackpropInput_});function conv3dTranspose_(e,t,n,r,a){const i=convertToTensor(e,"x","conv3dTranspose"),s=convertToTensor(t,"filter","conv3dTranspose");return conv3DBackpropInput$1(n,i,s,r,a)}const conv3dTranspose=op({conv3dTranspose_:conv3dTranspose_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function cos_(e){const t={x:convertToTensor(e,"x","cos","float32")};return ENGINE.runKernel(Cos,t)}const cos$2=op({cos_:cos_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function cosh_(e){const t={x:convertToTensor(e,"x","cosh","float32")};return ENGINE.runKernel(Cosh,t)}const cosh$2=op({cosh_:cosh_});
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function cumprod_(e,t=0,n=!1,r=!1){const a={x:convertToTensor(e,"x","cumprod")},i={axis:t,exclusive:n,reverse:r};return ENGINE.runKernel(Cumprod,a,i)}const cumprod$2=op({cumprod_:cumprod_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function cumsum_(e,t=0,n=!1,r=!1){const a={x:convertToTensor(e,"x","cumsum")},i={axis:t,exclusive:n,reverse:r};return ENGINE.runKernel(Cumsum,a,i)}const cumsum$2=op({cumsum_:cumsum_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function denseBincount_(e,t,n,r=!1){const a=convertToTensor(e,"x","denseBincount"),i=convertToTensor(t,"weights","denseBincount");assert$1("int32"===a.dtype,(()=>`Error in denseBincount: input dtype must be int32, but got ${a.dtype}`)),assert$1(a.rank<=2,(()=>`Error in denseBincount: input must be at most rank 2, but got rank ${a.rank}.`)),assert$1(n>=0,(()=>`size must be non-negative, but got ${n}.`)),assert$1(i.size===a.size||0===i.size,(()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${a.shape}, weights shape: ${i.shape}.`));const s={x:a,weights:i},o={size:n,binaryOutput:r};return ENGINE.runKernel(DenseBincount,s,o)}const denseBincount$2=op({denseBincount_:denseBincount_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function depthToSpace_(e,t,n="NHWC"){const r=convertToTensor(e,"x","depthToSpace","float32"),a="NHWC"===n?r.shape[1]:r.shape[2],i="NHWC"===n?r.shape[2]:r.shape[3],s="NHWC"===n?r.shape[3]:r.shape[1];assert$1(t>1,(()=>`blockSize should be > 1 for depthToSpace, but was: ${t}`)),assert$1(a*t>=0,(()=>`Negative dimension size caused by overflow when multiplying\n    ${a} and ${t}  for depthToSpace with input shape\n    ${r.shape}`)),assert$1(i*t>=0,(()=>`Negative dimension size caused by overflow when multiplying\n    ${i} and ${t} for depthToSpace with input shape\n        ${r.shape}`)),assert$1(s%(t*t)==0,(()=>`Dimension size must be evenly divisible by ${t*t} but is ${s} for depthToSpace with input shape ${r.shape}`));const o={x:r},l={blockSize:t,dataFormat:n};return ENGINE.runKernel(DepthToSpace,o,l)}const depthToSpace$2=op({depthToSpace_:depthToSpace_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function depthwiseConv2d_(e,t,n,r,a="NHWC",i=[1,1],s){const o=convertToTensor(e,"x","depthwiseConv2d","float32"),l=convertToTensor(t,"filter","depthwiseConv2d","float32");let u=o,c=!1;3===o.rank&&(c=!0,u=reshape$2(o,[1,o.shape[0],o.shape[1],o.shape[2]])),assert$1(4===u.rank,(()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${u.rank}.`)),assert$1(4===l.rank,(()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`));const h="NHWC"===a?u.shape[3]:u.shape[1];assert$1(h===l.shape[2],(()=>`Error in depthwiseConv2d: number of input channels (${h}) must match the inChannels dimension in filter ${l.shape[2]}.`)),checkPadOnDimRoundingMode("depthwiseConv2d",r,s);const d={x:u,filter:l},p={strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:s},f=ENGINE.runKernel(DepthwiseConv2dNative,d,p);return c?reshape$2(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const depthwiseConv2d$2=op({depthwiseConv2d_:depthwiseConv2d_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function diag_(e){const t={x:convertToTensor(e,"x","diag")};return ENGINE.runKernel(Diag,t)}const diag$2=op({diag_:diag_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function dilation2d_(e,t,n,r,a=[1,1],i="NHWC"){const s=convertToTensor(e,"x","dilation2d"),o=convertToTensor(t,"filter","dilation2d");assert$1(3===s.rank||4===s.rank,(()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${s.rank}.`)),assert$1(3===o.rank,(()=>`Error in dilation2d: filter must be rank 3, but got rank ${o.rank}.`)),assert$1("NHWC"===i,(()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${i}`));let l=s,u=!1;3===s.rank&&(l=reshape$2(s,[1,s.shape[0],s.shape[1],s.shape[2]]),u=!0),assert$1(l.shape[3]===o.shape[2],(()=>`Error in dilation2d:  input and filter must have the same depth: ${l.shape[3]} vs ${o.shape[2]}`));const c={x:l,filter:o},h={strides:n,pad:r,dilations:a},d=ENGINE.runKernel(Dilation2D,c,h);return u?reshape$2(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const dilation2d=op({dilation2d_:dilation2d_});
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function getBroadcastDims$1(e,t){const n=e.length,r=[];for(let a=0;a<n;a++){const i=n-1-a,s=e[i]||1;(t[t.length-1-a]||1)>1&&1===s&&r.unshift(i)}return r}function getReductionAxes(e,t){const n=[];for(let r=0;r<t.length;r++){const a=e[e.length-r-1],i=t.length-r-1,s=t[i];(null==a||1===a&&s>1)&&n.unshift(i)}return n}function assertAndGetBroadcastShape(e,t){const n=Math.max(e.length,t.length),r=new Array(n);for(let a=0;a<n;a++){let i=e[e.length-a-1];null==i&&(i=1);let s=t[t.length-a-1];if(null==s&&(s=1),1===i)r[n-a-1]=s;else if(1===s)r[n-a-1]=i;else{if(i!==s){throw Error(`Operands could not be broadcast together with shapes ${e} and ${t}.`)}r[n-a-1]=i}}return r}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function equal_(e,t){let n=convertToTensor(e,"a","equal","string_or_numeric"),r=convertToTensor(t,"b","equal","string_or_numeric");[n,r]=makeTypesMatch(n,r),assertAndGetBroadcastShape(n.shape,r.shape);const a={a:n,b:r};return ENGINE.runKernel(Equal,a)}const equal$2=op({equal_:equal_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function where_(e,t,n){const r=convertToTensor(t,"a","where"),a=convertToTensor(n,"b","where"),i=convertToTensor(e,"condition","where","bool"),s=assertAndGetBroadcastShape(assertAndGetBroadcastShape(i.shape,r.shape),a.shape),o={condition:broadcastTo(i,s),t:broadcastTo(r,s),e:broadcastTo(a,s)};return ENGINE.runKernel(Select,o)}const where=op({where_:where_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function zerosLike_(e){const t={x:convertToTensor(e,"x","zerosLike")};return ENGINE.runKernel(ZerosLike,t)}const zerosLike$2=op({zerosLike_:zerosLike_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function divNoNan_(e,t){let n=convertToTensor(e,"a","div"),r=convertToTensor(t,"b","div");[n,r]=makeTypesMatch(n,r);const a=div$1(n,r),i=zerosLike$2(a),s=equal$2(r,i);return where(s,i,a)}const divNoNan=op({divNoNan_:divNoNan_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function dot_(e,t){const n=convertToTensor(e,"t1","dot"),r=convertToTensor(t,"t2","dot");assert$1(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),(()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${r.rank}.`));const a=1===n.rank?n.size:n.shape[1],i=1===r.rank?r.size:r.shape[0];if(assert$1(a===i,(()=>`Error in dot: inner dimensions of inputs must match, but got ${a} and ${i}.`)),1===n.rank&&1===r.rank){const e=reshape$2(n,[1,-1]),t=reshape$2(r,[-1,1]),a=matMul$1(e,t);return reshape$2(a,[])}if(1===n.rank&&2===r.rank){const e=reshape$2(n,[1,-1]),t=reshape$2(r,[r.shape[0],r.shape[1]]),a=matMul$1(e,t);return reshape$2(a,[a.size])}if(2===n.rank&&1===r.rank){const e=reshape$2(r,[-1,1]),t=matMul$1(n,e);return reshape$2(t,[t.size])}{const e=reshape$2(r,[r.shape[0],r.shape[1]]);return matMul$1(n,e)}}const dot$1=op({dot_:dot_});
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function einsum_(e,...t){const n=t.map(((e,t)=>convertToTensor(e,`tensors${t}`,"einsum"))),r={equation:e};return ENGINE.runKernel(Einsum,n,r)}const einsum$2=op({einsum_:einsum_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function elu_(e){const t={x:convertToTensor(e,"x","elu","float32")};return ENGINE.runKernel(Elu$1,t)}const elu$3=op({elu_:elu_});
/**
     * @license
     * Copyright 2023 Google LLC.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function ensureShape_(e,t){const n=convertToTensor(e,"x","ensureShape","string_or_numeric");if(!arraysEqualWithNull(n.shape,t))throw new Error(`EnsureShape: Shape of tensor ${n.shape} is not compatible with expected shape ${t}`);return e}const ensureShape=op({ensureShape_:ensureShape_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function erf_(e){let t=convertToTensor(e,"x","erf");assert$1("int32"===t.dtype||"float32"===t.dtype,(()=>"Input dtype must be `int32` or `float32`.")),"int32"===t.dtype&&(t=cast$3(t,"float32"));const n={x:t};return ENGINE.runKernel(Erf,n)}const erf$2=op({erf_:erf_});
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function axesAreInnerMostDims(e,t){for(let n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function combineLocations(e,t,n){const r=e.length+t.length,a=[];let i=0,s=0;for(let o=0;o<r;o++)-1===n.indexOf(o)?a.push(e[i++]):a.push(t[s++]);return a}function computeOutAndReduceShapes(e,t){const n=[],r=e.length;for(let a=0;a<r;a++)-1===t.indexOf(a)&&n.push(e[a]);return[n,t.map((t=>e[t]))]}function expandShapeToKeepDim(e,t){return combineLocations(e,t.map((e=>1)),t)}function assertAxesAreInnerMostDims(e,t,n){assert$1(axesAreInnerMostDims(t,n),(()=>`${e} supports only inner-most axes for now. Got axes ${t} and rank-${n} input.`))}function getAxesPermutation(e,t){if(axesAreInnerMostDims(e,t))return null;const n=[];for(let r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach((e=>n.push(e))),n}function getUndoAxesPermutation(e){return e.map(((e,t)=>[t,e])).sort(((e,t)=>e[1]-t[1])).map((e=>e[0]))}function getInnerMostAxes(e,t){const n=[];for(let r=t-e;r<t;++r)n.push(r);return n}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function max_(e,t=null,n=!1){const r={x:convertToTensor(e,"x","max")},a={reductionIndices:t,keepDims:n};return ENGINE.runKernel(Max,r,a)}const max$3=op({max_:max_});
/**
     * @license
     * Copyright 2020 Google Inc. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function min_(e,t=null,n=!1){const r={x:convertToTensor(e,"x","min")},a={axis:t,keepDims:n};return ENGINE.runKernel(Min,r,a)}const min$3=op({min_:min_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function pow_(e,t){let n=convertToTensor(e,"base","pow"),r=convertToTensor(t,"exp","pow");[n,r]=makeTypesMatch(n,r);const a={a:n,b:r};return ENGINE.runKernel(Pow,a)}const pow$2=op({pow_:pow_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function scalar(e,t){if((isTypedArray$1(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&isTypedArray$1(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return makeTensor(e,[],[],t)}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function sqrt_(e){const t={x:convertToTensor(e,"x","sqrt","float32")};return ENGINE.runKernel(Sqrt,t)}const sqrt$2=op({sqrt_:sqrt_});
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function square_(e){const t=convertToTensor(e,"x","square");return ENGINE.runKernel("Square",{x:t},{})}const square$2=op({square_:square_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function sum_(e,t=null,n=!1){let r=convertToTensor(e,"x","sum");"bool"===r.dtype&&(r=cast$3(r,"int32"));const a={x:r},i={axis:t,keepDims:n};return ENGINE.runKernel(Sum,a,i)}const sum$2=op({sum_:sum_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function norm_(e,t="euclidean",n=null,r=!1){const a=normImpl(e=convertToTensor(e,"x","norm"),t,n);let i=a.shape;if(r){const t=parseAxisParam(n,e.shape);i=expandShapeToKeepDim(a.shape,t)}return reshape$2(a,i)}function normImpl(e,t,n=null){if(0===e.rank)return abs$2(e);if(1!==e.rank&&null===n)return normImpl(reshape$2(e,[-1]),t,n);if(1===e.rank||"number"==typeof n||Array.isArray(n)&&1===n.length){if(1===t)return sum$2(abs$2(e),n);if(t===1/0)return max$3(abs$2(e),n);if(t===-1/0)return min$3(abs$2(e),n);if("euclidean"===t||2===t)return sqrt$2(sum$2(pow$2(abs$2(e),scalar(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${t}`)}if(Array.isArray(n)&&2===n.length){if(1===t)return max$3(sum$2(abs$2(e),n[0]),n[1]-1);if(t===1/0)return max$3(sum$2(abs$2(e),n[1]),n[0]);if(t===-1/0)return min$3(sum$2(abs$2(e),n[1]),n[0]);if("fro"===t||"euclidean"===t)return sqrt$2(sum$2(square$2(e),n));throw new Error(`Error in norm: invalid ord value: ${t}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}const norm=op({norm_:norm_});
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function euclideanNorm_(e,t=null,n=!1){return norm(e,"euclidean",t,n)}const euclideanNorm=op({euclideanNorm_:euclideanNorm_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function exp_(e){const t={x:convertToTensor(e,"x","exp")};return ENGINE.runKernel(Exp,t)}const exp$2=op({exp_:exp_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function expandDims_(e,t=0){const n=convertToTensor(e,"x","expandDims","string_or_numeric");assert$1(t<=n.rank,(()=>"Axis must be <= rank of the tensor"));const r={input:n},a={dim:t};return ENGINE.runKernel(ExpandDims,r,a)}const expandDims$3=op({expandDims_:expandDims_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function expm1_(e){const t={x:convertToTensor(e,"x","expm1")};return ENGINE.runKernel(Expm1,t)}const expm1$2=op({expm1_:expm1_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function tile_(e,t){const n=convertToTensor(e,"x","tile","string_or_numeric");assert$1(n.rank===t.length,(()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${t}.`));const r={x:n},a={reps:t};return ENGINE.runKernel(Tile,r,a)}const tile$3=op({tile_:tile_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function eye_(e,t,n,r="float32"){null==t&&(t=e);const a=buffer([e,t],r),i=e<=t?e:t;for(let o=0;o<i;++o)a.set(1,o,o);const s=reshape$2(a.toTensor(),[e,t]);if(null==n)return s;if(1===n.length)return tile$3(expandDims$3(s,0),[n[0],1,1]);if(2===n.length)return tile$3(expandDims$3(expandDims$3(s,0),0),[n[0],n[1],1,1]);if(3===n.length)return tile$3(expandDims$3(expandDims$3(expandDims$3(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}const eye=op({eye_:eye_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function floor_(e){const t={x:convertToTensor(e,"x","floor","float32")};return ENGINE.runKernel(Floor,t)}const floor$2=op({floor_:floor_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function gather_(e,t,n=0,r=0){const a={x:convertToTensor(e,"x","gather"),indices:convertToTensor(t,"indices","gather","int32")},i={axis:n,batchDims:r};return ENGINE.runKernel(GatherV2,a,i)}const gather$1=op({gather_:gather_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function greater_(e,t){let n=convertToTensor(e,"a","greater","string_or_numeric"),r=convertToTensor(t,"b","greater","string_or_numeric");[n,r]=makeTypesMatch(n,r),assertAndGetBroadcastShape(n.shape,r.shape);const a={a:n,b:r};return ENGINE.runKernel(Greater,a)}const greater$2=op({greater_:greater_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function greaterEqual_(e,t){let n=convertToTensor(e,"a","greaterEqual","string_or_numeric"),r=convertToTensor(t,"b","greaterEqual","string_or_numeric");[n,r]=makeTypesMatch(n,r),assertAndGetBroadcastShape(n.shape,r.shape);const a={a:n,b:r};return ENGINE.runKernel(GreaterEqual,a)}const greaterEqual$2=op({greaterEqual_:greaterEqual_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function imag_(e){const t={input:convertToTensor(e,"input","imag")};return ENGINE.runKernel(Imag,t)}const imag$2=op({imag_:imag_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function isFinite_(e){const t={x:convertToTensor(e,"x","isFinite")};return ENGINE.runKernel(IsFinite,t)}const isFinite$3=op({isFinite_:isFinite_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function isInf_(e){const t={x:convertToTensor(e,"x","isInf")};return ENGINE.runKernel(IsInf,t)}const isInf$2=op({isInf_:isInf_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function isNaN_(e){const t={x:convertToTensor(e,"x","isNaN")};return ENGINE.runKernel(IsNan,t)}const isNaN$3=op({isNaN_:isNaN_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function leakyRelu_(e,t=.2){const n={x:convertToTensor(e,"x","leakyRelu")},r={alpha:t};return ENGINE.runKernel(LeakyRelu,n,r)}const leakyRelu$2=op({leakyRelu_:leakyRelu_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function less_(e,t){let n=convertToTensor(e,"a","less","string_or_numeric"),r=convertToTensor(t,"b","less","string_or_numeric");[n,r]=makeTypesMatch(n,r),assertAndGetBroadcastShape(n.shape,r.shape);const a={a:n,b:r};return ENGINE.runKernel(Less,a)}const less$2=op({less_:less_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function lessEqual_(e,t){let n=convertToTensor(e,"a","lessEqual","string_or_numeric"),r=convertToTensor(t,"b","lessEqual","string_or_numeric");[n,r]=makeTypesMatch(n,r),assertAndGetBroadcastShape(n.shape,r.shape);const a={a:n,b:r};return ENGINE.runKernel(LessEqual,a)}const lessEqual$2=op({lessEqual_:lessEqual_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function linspace(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");const r={start:e,stop:t,num:n};return ENGINE.runKernel(LinSpace,{},r)}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function localResponseNormalization_(e,t=5,n=1,r=1,a=.5){const i=convertToTensor(e,"x","localResponseNormalization");assert$1(4===i.rank||3===i.rank,(()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ${i.rank}.`)),assert$1(isInt(t),(()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${t}.`));let s=i,o=!1;3===i.rank&&(o=!0,s=reshape$2(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const l={x:s},u={depthRadius:t,bias:n,alpha:r,beta:a},c=ENGINE.runKernel(LRN,l,u);return o?reshape$2(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const localResponseNormalization=op({localResponseNormalization_:localResponseNormalization_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function log_(e){const t={x:convertToTensor(e,"x","log","float32")};return ENGINE.runKernel(Log,t)}const log$4=op({log_:log_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function log1p_(e){const t={x:convertToTensor(e,"x","log1p")};return ENGINE.runKernel(Log1p,t)}const log1p$2=op({log1p_:log1p_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function variableGrads(e,t){assert$1(isFunction$2(e),(()=>"The f passed in variableGrads(f) must be a function")),assert$1(null==t||Array.isArray(t)&&t.every((e=>e instanceof Variable)),(()=>"The varList passed in variableGrads(f, varList) must be an array of variables"));const n=null!=t;if(!n){t=[];for(const e in ENGINE.registeredVariables)t.push(ENGINE.registeredVariables[e])}const r=n?t.filter((e=>!e.trainable)):null,a=t.length;assert$1((t=t.filter((e=>e.trainable))).length>0,(()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${a} variables is trainable.`));const{value:i,grads:s}=ENGINE.gradients(e,t,null,!0);assert$1(s.some((e=>null!=e)),(()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize().")),assert$1(0===i.rank,(()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${i.rank} tensor`));const o={};return t.forEach(((e,t)=>{null!=s[t]&&(o[e.name]=s[t])})),null!=r&&r.forEach((e=>o[e.name]=null)),{value:i,grads:o}}function customGrad(e){return ENGINE.customGrad(e)}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function neg_(e){const t={x:convertToTensor(e,"x","neg")};return ENGINE.runKernel(Neg,t)}const neg$2=op({neg_:neg_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function softplus_(e){const t={x:convertToTensor(e,"x","softplus")};return ENGINE.runKernel(Softplus$1,t)}const softplus$2=op({softplus_:softplus_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function logSigmoid_(e){const t=convertToTensor(e,"x","logSigmoid");return customGrad((e=>({value:neg$2(softplus$2(neg$2(e))),gradFunc:t=>mul(t,sigmoid$2(neg$2(e)))})))(t)}const logSigmoid=op({logSigmoid_:logSigmoid_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function sub_(e,t){let n=convertToTensor(e,"a","sub"),r=convertToTensor(t,"b","sub");[n,r]=makeTypesMatch(n,r);const a={a:n,b:r};return ENGINE.runKernel(Sub,a)}const sub$2=op({sub_:sub_});
/**
     * @license
     * Copyright 2020 Google Inc. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function logSoftmax_(e,t=-1){const n=convertToTensor(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${t}`);return customGrad(((e,n)=>{const r=max$3(e,t,!0),a=sub$2(e,r),i=sub$2(cast$3(a,"float32"),log$4(sum$2(exp$2(a),t,!0)));n([i]);return{value:i,gradFunc:(e,n)=>{const[r]=n,a=exp$2(r);return sub$2(e,mul(sum$2(e,t,!0),a))}}}))(n)}const logSoftmax=op({logSoftmax_:logSoftmax_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function logSumExp_(e,t=null,n=!1){const r=convertToTensor(e,"x","logSumExp"),a=parseAxisParam(t,r.shape),i=max$3(r,a,!0),s=sub$2(r,i),o=exp$2(s),l=sum$2(o,a),u=log$4(l),c=add$1(reshape$2(i,u.shape),u);if(n){const e=expandShapeToKeepDim(c.shape,a);return reshape$2(c,e)}return c}const logSumExp=op({logSumExp_:logSumExp_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function logicalAnd_(e,t){const n=convertToTensor(e,"a","logicalAnd","bool"),r=convertToTensor(t,"b","logicalAnd","bool");assertAndGetBroadcastShape(n.shape,r.shape);const a={a:n,b:r};return ENGINE.runKernel(LogicalAnd,a)}const logicalAnd$2=op({logicalAnd_:logicalAnd_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function logicalNot_(e){const t={x:convertToTensor(e,"x","logicalNot","bool")};return ENGINE.runKernel(LogicalNot,t)}const logicalNot$2=op({logicalNot_:logicalNot_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function logicalOr_(e,t){const n=convertToTensor(e,"a","logicalOr","bool"),r=convertToTensor(t,"b","logicalOr","bool");assertAndGetBroadcastShape(n.shape,r.shape);const a={a:n,b:r};return ENGINE.runKernel(LogicalOr,a)}const logicalOr$2=op({logicalOr_:logicalOr_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function logicalXor_(e,t){const n=convertToTensor(e,"a","logicalXor","bool"),r=convertToTensor(t,"b","logicalXor","bool");return assertAndGetBroadcastShape(n.shape,r.shape),logicalAnd$2(logicalOr$2(e,t),logicalNot$2(logicalAnd$2(e,t)))}const logicalXor=op({logicalXor_:logicalXor_}),INT32_MAX$1=2147483648;
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function searchSorted_(e,t,n="left"){const r=convertToTensor(e,"sortedSequence","searchSorted"),a=convertToTensor(t,"values","searchSorted"),i=r.shape[r.shape.length-1],s=a.shape[a.shape.length-1],o=reshape$2(r,[-1,i]),l=reshape$2(a,[-1,s]);if(o.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(o.shape[0]!==l.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(sizeFromShape(l.shape)>=INT32_MAX$1)throw new Error(`values tensor size must less than ${INT32_MAX$1}`);if(o.shape[1]>=INT32_MAX$1)throw new Error(`trailing dim_size must less than ${INT32_MAX$1} for int32 output type, was ${o.shape[1]}`);const u={sortedSequence:o,values:l},c={side:n};return ENGINE.runKernel(SearchSorted,u,c)}const searchSorted$2=op({searchSorted_:searchSorted_});
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function lowerBound$1(e,t){return searchSorted$2(e,t,"left")}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function maxPool_(e,t,n,r,a){const i=convertToTensor(e,"x","maxPool");let s=i,o=!1;3===i.rank&&(o=!0,s=reshape$2(i,[1,i.shape[0],i.shape[1],i.shape[2]])),assert$1(4===s.rank,(()=>`Error in maxPool: input must be rank 4 but got rank ${s.rank}.`)),assert$1(eitherStridesOrDilationsAreOne(n,1),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`)),checkPadOnDimRoundingMode("maxPool",r,a);const l={x:s},u={filterSize:t,strides:n,pad:r,dimRoundingMode:a},c=ENGINE.runKernel(MaxPool,l,u);return o?reshape$2(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const maxPool$2=op({maxPool_:maxPool_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function maxPool3d_(e,t=[1,1,1],n,r,a,i="NDHWC"){const s=convertToTensor(e,"x","maxPool3d");let o=s,l=!1;4===s.rank&&(l=!0,o=reshape$2(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),assert$1(5===o.rank,(()=>`Error in maxPool3d: x must be rank 5 but got rank ${o.rank}.`)),assert$1("NDHWC"===i,(()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`)),checkPadOnDimRoundingMode("maxPool3d",r,a);const u={x:o},c={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:i},h=ENGINE.runKernel(MaxPool3D,u,c);return l?reshape$2(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const maxPool3d$1=op({maxPool3d_:maxPool3d_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function maxPoolWithArgmax_(e,t,n,r,a=!1){const i={x:convertToTensor(e,"x","maxPoolWithArgmax")},s={filterSize:t,strides:n,pad:r,includeBatchInIndex:a},o=ENGINE.runKernel(MaxPoolWithArgmax,i,s);return{result:o[0],indexes:o[1]}}const maxPoolWithArgmax=op({maxPoolWithArgmax_:maxPoolWithArgmax_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function maximum_(e,t){let n=convertToTensor(e,"a","maximum"),r=convertToTensor(t,"b","maximum");[n,r]=makeTypesMatch(n,r),"bool"===n.dtype&&(n=cast$3(n,"int32"),r=cast$3(r,"int32")),assertAndGetBroadcastShape(n.shape,r.shape);const a={a:n,b:r};return ENGINE.runKernel(Maximum$1,a)}const maximum$2=op({maximum_:maximum_});
/**
     * @license
     * Copyright 2020 Google Inc. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function mean_(e,t=null,n=!1){const r={x:convertToTensor(e,"x","mean")},a={axis:t,keepDims:n};return ENGINE.runKernel(Mean,r,a)}const mean$1=op({mean_:mean_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function zeros$1(e,t="float32"){if(assertNonNegativeIntegerDimensions(e),"complex64"===t){const t=zeros$1(e,"float32"),n=zeros$1(e,"float32");return complex$2(t,n)}const n=makeZerosTypedArray(sizeFromShape(e),t);return ENGINE.makeTensor(n,e,t)}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function ones(e,t="float32"){if(assertNonNegativeIntegerDimensions(e),"complex64"===t){const t=ones(e,"float32"),n=zeros$1(e,"float32");return complex$2(t,n)}const n=makeOnesTypedArray(sizeFromShape(e),t);return ENGINE.makeTensor(n,e,t)}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function meshgrid(e,t,{indexing:n="xy"}={}){if("xy"!==n&&"ij"!==n)throw new TypeError(`${n} is not a valid third argument to meshgrid`);if(void 0===e)return[];let r=convertToTensor(e,"x","meshgrid",e instanceof Tensor?e.dtype:"float32");if(void 0===t)return[r];let a=convertToTensor(t,"y","meshgrid",t instanceof Tensor?t.dtype:"float32");const i=sizeFromShape(r.shape),s=sizeFromShape(a.shape);return"xy"===n?(r=reshape$2(r,[1,-1]),a=reshape$2(a,[-1,1]),[matMul$1(ones([s,1],r.dtype),r),matMul$1(a,ones([1,i],a.dtype))]):(r=reshape$2(r,[-1,1]),a=reshape$2(a,[1,-1]),[matMul$1(r,ones([1,s],r.dtype)),matMul$1(ones([i,1],a.dtype),a)])}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function minimum_(e,t){let n=convertToTensor(e,"a","minimum"),r=convertToTensor(t,"b","minimum");[n,r]=makeTypesMatch(n,r),"bool"===n.dtype&&(n=cast$3(n,"int32"),r=cast$3(r,"int32")),assertAndGetBroadcastShape(n.shape,r.shape);const a={a:n,b:r};return ENGINE.runKernel(Minimum$1,a)}const minimum$2=op({minimum_:minimum_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function mirrorPad_(e,t,n){assert$1("reflect"===n||"symmetric"===n,(()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`));const r=convertToTensor(e,"x","mirrorPad");if(0===r.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");assert$1(t.length===r.rank,(()=>`Padding doesn't match input. Must be ${r.rank}. Got ${t.length}.`));const a="reflect"===n?1:0;for(let o=0;o<r.rank;o++)assert$1(2===t[o].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),assert$1(t[o][0]>=0&&t[o][0]<=r.shape[o]-a&&t[o][1]>=0&&t[o][1]<=r.shape[o]-a,(()=>`Padding in dimension ${o} cannot be greater than or equal to ${r.shape[o]-a} or less than 0 for input of shape ${r.shape}`));const i={paddings:t,mode:n},s={x:r};return ENGINE.runKernel(MirrorPad,s,i)}const mirrorPad$1=op({mirrorPad_:mirrorPad_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function mod_(e,t){let n=convertToTensor(e,"a","mod"),r=convertToTensor(t,"b","mod");[n,r]=makeTypesMatch(n,r);const a={a:n,b:r};return ENGINE.runKernel(Mod,a)}const mod$2=op({mod_:mod_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function moments_(e,t=null,n=!1){const r=parseAxisParam(t,(e=convertToTensor(e,"x","moments")).shape),a=mean$1(e,r,n);let i=a.shape;n||(i=expandShapeToKeepDim(a.shape,r));const s=square$2(sub$2(cast$3(e,"float32"),reshape$2(a,i)));return{mean:a,variance:mean$1(s,r,n)}}const moments=op({moments_:moments_});function multiRNNCell_(e,t,n,r){const a=convertToTensor(t,"data","multiRNNCell"),i=convertToTensorArray(n,"c","multiRNNCell"),s=convertToTensorArray(r,"h","multiRNNCell");let o=a;const l=[];for(let h=0;h<e.length;h++){const t=e[h](o,i[h],s[h]);l.push(t[0]),l.push(t[1]),o=t[1]}const u=[],c=[];for(let h=0;h<l.length;h+=2)u.push(l[h]),c.push(l[h+1]);return[u,c]}const multiRNNCell=op({multiRNNCell_:multiRNNCell_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function multinomial_(e,t,n,r=!1){const a=convertToTensor(e,"logits","multinomial"),i=a.size,s=a.rank;if(i<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${i}.`);if(s>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${s}`);n=n||Math.random();const o={logits:1===s?reshape$2(a,[1,-1]):a},l={numSamples:t,seed:n,normalized:r},u=ENGINE.runKernel(Multinomial,o,l);return 1===s?reshape$2(u,[u.size]):u}const multinomial$2=op({multinomial_:multinomial_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function notEqual_(e,t){let n=convertToTensor(e,"a","notEqual","string_or_numeric"),r=convertToTensor(t,"b","notEqual","string_or_numeric");[n,r]=makeTypesMatch(n,r),assertAndGetBroadcastShape(n.shape,r.shape);const a={a:n,b:r};return ENGINE.runKernel(NotEqual,a)}const notEqual$2=op({notEqual_:notEqual_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function oneHot_(e,t,n=1,r=0,a="int32"){if(t<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${t}`);const i={indices:convertToTensor(e,"indices","oneHot","int32")},s={dtype:a,depth:t,onValue:n,offValue:r};return ENGINE.runKernel(OneHot,i,s)}const oneHot$2=op({oneHot_:oneHot_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function onesLike_(e){const t={x:convertToTensor(e,"x","onesLike")};return ENGINE.runKernel(OnesLike,t)}const onesLike$2=op({onesLike_:onesLike_});function outerProduct_(e,t){const n=convertToTensor(e,"v1","outerProduct"),r=convertToTensor(t,"v2","outerProduct");assert$1(1===n.rank&&1===r.rank,(()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${n.rank} and ${r.rank}.`));const a=reshape$2(n,[-1,1]),i=reshape$2(r,[1,-1]);return matMul$1(a,i)}const outerProduct=op({outerProduct_:outerProduct_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function pad_(e,t,n=0){const r=convertToTensor(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const a={paddings:t,constantValue:n},i={x:r};return ENGINE.runKernel(PadV2,i,a)}const pad=op({pad_:pad_});function pad1d_(e,t,n=0){return assert$1(2===t.length,(()=>"Invalid number of paddings. Must be length of 2.")),pad(e,[t],n)}const pad1d=op({pad1d_:pad1d_});function pad2d_(e,t,n=0){return assert$1(2===t.length&&2===t[0].length&&2===t[1].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),pad(e,t,n)}const pad2d=op({pad2d_:pad2d_});function pad3d_(e,t,n=0){return assert$1(3===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),pad(e,t,n)}const pad3d=op({pad3d_:pad3d_});function pad4d_(e,t,n=0){return assert$1(4===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length&&2===t[3].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),pad(e,t,n)}const pad4d=op({pad4d_:pad4d_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function spaceToBatchND_(e,t,n){const r=convertToTensor(e,"x","spaceToBatchND");assert$1(r.rank>=1+t.length,(()=>`input rank ${r.rank} should be > than [blockShape] ${t.length}`)),assert$1(n.length===t.length,(()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${t.length}`)),assert$1(r.shape.reduce(((e,r,a)=>a>0&&a<=t.length?e&&(r+n[a-1][0]+n[a-1][1])%t[a-1]==0:e),!0),(()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${t.toString()}`));const a={x:r},i={blockShape:t,paddings:n};return ENGINE.runKernel(SpaceToBatchND,a,i)}const spaceToBatchND$2=op({spaceToBatchND_:spaceToBatchND_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function pool_(e,t,n,r,a,i,s){null==a&&(a=[1,1]),null==i&&(i=1),0===r&&(r="valid");const o=convertToTensor(e,"x","maxPool");let l=o,u=!1;3===o.rank&&(u=!0,l=reshape$2(o,[1,o.shape[0],o.shape[1],o.shape[2]])),assert$1(eitherStridesOrDilationsAreOne(i,a),(()=>`Error in pool: Either strides or dilations must be 1. Got strides ${i} and dilations '${a}'`));const c=computePool2DInfo(l.shape,t,i,a,r),h=[c.dilationHeight,c.dilationWidth];let d;d="same"===r?withSpaceToBatchBasePaddings([c.filterHeight,c.filterWidth],h):[[0,0],[0,0]];const p=1===h[0]&&1===h[1],[f,m]=requiredSpaceToBatchPaddings([c.inHeight,c.inWidth],h,d),g=p?r:"valid",y=p?l:spaceToBatchND$2(l,h,f),v=("avg"===n?()=>avgPool$2(y,t,i,g,s):()=>maxPool$2(y,t,i,g,s))(),b=p?v:batchToSpaceND$2(v,h,m);return u?reshape$2(b,[b.shape[1],b.shape[2],b.shape[3]]):b}function requiredSpaceToBatchPaddings(e,t,n){const r=n.map((e=>e[0])),a=n.map((e=>e[1])),i=e.concat(r,a),s=t.map(((e,t)=>(e-i[t]%e)%e)),o=a.map(((e,t)=>e+s[t]));return[t.map(((e,t)=>[r[t],o[t]])),t.map(((e,t)=>[0,s[t]]))]}function withSpaceToBatchBasePaddings(e,t){const n=e.map(((e,n)=>e+(e-1)*(t[n]-1))).map((e=>e-1)),r=n.map((e=>Math.floor(e/2))),a=n.map(((e,t)=>e-r[t]));return n.map(((e,t)=>[r[t],a[t]]))}const pool$1=op({pool_:pool_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function prelu_(e,t){const n={x:convertToTensor(e,"x","prelu"),alpha:convertToTensor(t,"alpha","prelu")};return ENGINE.runKernel(Prelu,n)}const prelu$2=op({prelu_:prelu_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function prod_(e,t=null,n=!1){let r=convertToTensor(e,"x","prod");"bool"===r.dtype&&(r=cast$3(r,"int32"));const a={x:r},i={axis:t,keepDims:n};return ENGINE.runKernel(Prod,a,i)}const prod$2=op({prod_:prod_});
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function raggedGather_(e,t,n,r){const a=e.map(((e,t)=>convertToTensor(e,`tensors${t}`,"raggedGather","int32"))),i={paramsNestedSplits:a,paramsDenseValues:convertToTensor(t,"paramsDenseValues","raggedGather"),indices:convertToTensor(n,"indices","raggedGather","int32")},s={outputRaggedRank:r},o=ENGINE.runKernel(RaggedGather,i,s);return{outputNestedSplits:o.slice(0,o.length-1),outputDenseValues:o[o.length-1]}}const raggedGather$2=op({raggedGather_:raggedGather_});
/**
     * @license
     * Copyright 2022 Google LLC.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function raggedRange_(e,t,n){const r=convertToTensor(e,"starts","raggedRange"),a={starts:r,limits:convertToTensor(t,"limits","raggedRange",r.dtype),deltas:convertToTensor(n,"deltas","raggedRange",r.dtype)},i=ENGINE.runKernel(RaggedRange,a);return{rtNestedSplits:i[0],rtDenseValues:i[1]}}const raggedRange$2=op({raggedRange_:raggedRange_});
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function raggedTensorToTensor_(e,t,n,r,a){const i=convertToTensor(e,"shape","raggedTensorToTensor","int32"),s=convertToTensor(t,"values","raggedTensorToTensor"),o=convertToTensor(n,"defaultValue","raggedTensorToTensor",s.dtype),l=r.map(((e,t)=>convertToTensor(e,`tensors${t}`,"raggedTensorToTensor","int32"))),u={shape:i,values:s,defaultValue:o,rowPartitionTensors:l},c={rowPartitionTypes:a};return ENGINE.runKernel(RaggedTensorToTensor,u,c)}const raggedTensorToTensor$2=op({raggedTensorToTensor_:raggedTensorToTensor_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function rand_(e,t,n){assertNonNegativeIntegerDimensions(e);const r=sizeFromShape(e);let a=null;if(null==n||"float32"===n)a=new Float32Array(r);else if("int32"===n)a=new Int32Array(r);else{if("bool"!==n)throw new Error(`Unknown data type ${n}`);a=new Uint8Array(r)}for(let i=0;i<r;i++)a[i]=t();return ENGINE.makeTensor(a,e,n)}const rand=op({rand_:rand_});var alea$1={exports:{}};alea$1.exports,function(e){!function(e,t,n){function r(e){var t=this,n=function(){var e=4022871197,t=function(t){t=String(t);for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)};return t}();t.next=function(){var e=2091639*t.s0+2.3283064365386963e-10*t.c;return t.s0=t.s1,t.s1=t.s2,t.s2=e-(t.c=0|e)},t.c=1,t.s0=n(" "),t.s1=n(" "),t.s2=n(" "),t.s0-=n(e),t.s0<0&&(t.s0+=1),t.s1-=n(e),t.s1<0&&(t.s1+=1),t.s2-=n(e),t.s2<0&&(t.s2+=1),n=null}function a(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function i(e,t){var n=new r(e),i=t&&t.state,s=n.next;return s.int32=function(){return 4294967296*n.next()|0},s.double=function(){return s()+11102230246251565e-32*(2097152*s()|0)},s.quick=s,i&&("object"==typeof i&&a(i,n),s.state=function(){return a(n,{})}),s}t&&t.exports?t.exports=i:this.alea=i}(0,e)}(alea$1);var aleaExports=alea$1.exports,xor128$1={exports:{}};xor128$1.exports,function(e){!function(e,t,n){function r(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function a(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function i(e,t){var n=new r(e),i=t&&t.state,s=function(){return(n.next()>>>0)/4294967296};return s.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},s.int32=n.next,s.quick=s,i&&("object"==typeof i&&a(i,n),s.state=function(){return a(n,{})}),s}t&&t.exports?t.exports=i:this.xor128=i}(0,e)}(xor128$1);var xor128Exports=xor128$1.exports,xorwow$1={exports:{}};xorwow$1.exports,function(e){!function(e,t,n){function r(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function a(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function i(e,t){var n=new r(e),i=t&&t.state,s=function(){return(n.next()>>>0)/4294967296};return s.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},s.int32=n.next,s.quick=s,i&&("object"==typeof i&&a(i,n),s.state=function(){return a(n,{})}),s}t&&t.exports?t.exports=i:this.xorwow=i}(0,e)}(xorwow$1);var xorwowExports=xorwow$1.exports,xorshift7$1={exports:{}};xorshift7$1.exports,function(e){!function(e,t,n){function r(e){var t=this;t.next=function(){var e,n,r=t.x,a=t.i;return e=r[a],n=(e^=e>>>7)^e<<24,n^=(e=r[a+1&7])^e>>>10,n^=(e=r[a+3&7])^e>>>3,n^=(e=r[a+4&7])^e<<7,e=r[a+7&7],n^=(e^=e<<13)^e<<9,r[a]=n,t.i=a+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function a(e,t){return t.x=e.x.slice(),t.i=e.i,t}function i(e,t){null==e&&(e=+new Date);var n=new r(e),i=t&&t.state,s=function(){return(n.next()>>>0)/4294967296};return s.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},s.int32=n.next,s.quick=s,i&&(i.x&&a(i,n),s.state=function(){return a(n,{})}),s}t&&t.exports?t.exports=i:this.xorshift7=i}(0,e)}(xorshift7$1);var xorshift7Exports=xorshift7$1.exports,xor4096$1={exports:{}};xor4096$1.exports,function(e){!function(e,t,n){function r(e){var t=this;t.next=function(){var e,n,r=t.w,a=t.X,i=t.i;return t.w=r=r+1640531527|0,n=a[i+34&127],e=a[i=i+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=a[i]=n^e,t.i=i,n+(r^r>>>16)|0},function(e,t){var n,r,a,i,s,o=[],l=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,l=Math.max(l,t.length)),a=0,i=-32;i<l;++i)t&&(r^=t.charCodeAt((i+32)%t.length)),0===i&&(s=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,i>=0&&(s=s+1640531527|0,a=0==(n=o[127&i]^=r+s)?a+1:0);for(a>=128&&(o[127&(t&&t.length||0)]=-1),a=127,i=512;i>0;--i)r=o[a+34&127],n=o[a=a+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,o[a]=r^n;e.w=s,e.X=o,e.i=a}(t,e)}function a(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function i(e,t){null==e&&(e=+new Date);var n=new r(e),i=t&&t.state,s=function(){return(n.next()>>>0)/4294967296};return s.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},s.int32=n.next,s.quick=s,i&&(i.X&&a(i,n),s.state=function(){return a(n,{})}),s}t&&t.exports?t.exports=i:this.xor4096=i}(0,e)}(xor4096$1);var xor4096Exports=xor4096$1.exports,tychei$1={exports:{}};tychei$1.exports,function(e){!function(e,t,n){function r(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,a=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^a,a=a-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^a,t.a=a-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function a(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function i(e,t){var n=new r(e),i=t&&t.state,s=function(){return(n.next()>>>0)/4294967296};return s.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},s.int32=n.next,s.quick=s,i&&("object"==typeof i&&a(i,n),s.state=function(){return a(n,{})}),s}t&&t.exports?t.exports=i:this.tychei=i}(0,e)}(tychei$1);var tycheiExports=tychei$1.exports,seedrandom$1={exports:{}};const __viteBrowserExternal={},__viteBrowserExternal$1=Object.freeze(Object.defineProperty({__proto__:null,default:__viteBrowserExternal},Symbol.toStringTag,{value:"Module"})),require$$0=getAugmentedNamespace(__viteBrowserExternal$1);!function(e){!function(t,n,r){var a,i=256,s="random",o=r.pow(i,6),l=r.pow(2,52),u=2*l,c=i-1;function h(e,c,h){var y=[],v=m(f((c=1==c?{entropy:!0}:c||{}).entropy?[e,g(n)]:null==e?function(){try{var e;return a&&(e=a.randomBytes)?e=e(i):(e=new Uint8Array(i),(t.crypto||t.msCrypto).getRandomValues(e)),g(e)}catch(e2){var r=t.navigator,s=r&&r.plugins;return[+new Date,t,s,t.screen,g(n)]}}():e,3),y),b=new d(y),x=function(){for(var e=b.g(6),t=o,n=0;e<l;)e=(e+n)*i,t*=i,n=b.g(1);for(;e>=u;)e/=2,t/=2,n>>>=1;return(e+n)/t};return x.int32=function(){return 0|b.g(4)},x.quick=function(){return b.g(4)/4294967296},x.double=x,m(g(b.S),n),(c.pass||h||function(e,t,n,a){return a&&(a.S&&p(a,b),e.state=function(){return p(b,{})}),n?(r[s]=e,t):e})(x,v,"global"in c?c.global:this==r,c.state)}function d(e){var t,n=e.length,r=this,a=0,s=r.i=r.j=0,o=r.S=[];for(n||(e=[n++]);a<i;)o[a]=a++;for(a=0;a<i;a++)o[a]=o[s=c&s+e[a%n]+(t=o[a])],o[s]=t;(r.g=function(e){for(var t,n=0,a=r.i,s=r.j,o=r.S;e--;)t=o[a=c&a+1],n=n*i+o[c&(o[a]=o[s=c&s+t])+(o[s]=t)];return r.i=a,r.j=s,n})(i)}function p(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function f(e,t){var n,r=[],a=typeof e;if(t&&"object"==a)for(n in e)try{r.push(f(e[n],t-1))}catch(e2){}return r.length?r:"string"==a?e:e+"\0"}function m(e,t){for(var n,r=e+"",a=0;a<r.length;)t[c&a]=c&(n^=19*t[c&a])+r.charCodeAt(a++);return g(t)}function g(e){return String.fromCharCode.apply(0,e)}if(m(r.random(),n),e.exports){e.exports=h;try{a=require$$0}catch(y){}}else r["seed"+s]=h}("undefined"!=typeof self?self:commonjsGlobal,[],Math)}(seedrandom$1);var seedrandomExports=seedrandom$1.exports,alea=aleaExports,xor128=xor128Exports,xorwow=xorwowExports,xorshift7=xorshift7Exports,xor4096=xor4096Exports,tychei=tycheiExports,sr=seedrandomExports;sr.alea=alea,sr.xor128=xor128,sr.xorwow=xorwow,sr.xorshift7=xorshift7,sr.xor4096=xor4096,sr.tychei=tychei;var seedrandom=sr;
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class MPRandGauss{constructor(e,t,n,r,a){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);const i=a||Math.random();this.random=seedrandom.alea(i.toString())}nextValue(){if(!isNaN(this.nextVal)){const e=this.nextVal;return this.nextVal=NaN,e}let e,t,n=!1;for(;!n;){let r,a,i;do{r=2*this.random()-1,a=2*this.random()-1,i=r*r+a*a}while(i>=1||0===i);const s=Math.sqrt(-2*Math.log(i)/i);e=this.mean+this.stdDev*r*s,t=this.mean+this.stdDev*a*s,this.truncated&&!this.isValidTruncated(e)||(n=!0)}return this.truncated&&!this.isValidTruncated(t)||(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class RandGamma{constructor(e,t,n,r){this.alpha=e,this.beta=1/t,this.dtype=n;const a=r||Math.random();this.randu=seedrandom.alea(a.toString()),this.randn=new MPRandGauss(0,1,n,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let e,t,n,r,a,i;for(;;){do{r=this.randn.nextValue(),i=1+this.c*r}while(i<=0);if(i*=i*i,e=r*r,t=1-.331*e*e,n=.5*e+this.d*(1-i+Math.log(i)),a=this.randu(),a<t||Math.log(a)<n)break}return i=1/this.beta*this.d*i,this.alpha<1&&(i*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(i)}convertValue(e){return"float32"===this.dtype?e:Math.round(e)}}class UniformRandom{constructor(e=0,t=1,n,r){if(this.canReturnFloat=()=>null==this.dtype||"float32"===this.dtype,this.min=e,this.range=t-e,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${t} <= 1 and dtype is not float`);this.random=seedrandom.alea(r)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function randomGamma_(e,t,n=1,r="float32",a){if(assertNonNegativeIntegerDimensions(e),null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error(`Unsupported data type ${r}`);const i=new RandGamma(t,n,r,a),s=buffer(e,r);for(let o=0;o<s.values.length;o++)s.values[o]=i.nextValue();return s.toTensor()}const randomGamma=op({randomGamma_:randomGamma_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function randomNormal_(e,t=0,n=1,r,a){if(assertNonNegativeIntegerDimensions(e),null!=r&&"bool"===r)throw new Error(`Unsupported data type ${r}`);const i=new MPRandGauss(t,n,r,!1,a),s=buffer(e,r);for(let o=0;o<s.values.length;o++)s.values[o]=i.nextValue();return s.toTensor()}const randomNormal$1=op({randomNormal_:randomNormal_});
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function randomStandardNormal_(e,t,n){if(null!=t&&"bool"===t)throw new Error(`Unsupported data type ${t}`);return randomNormal$1(e,0,1,t,n)}const randomStandardNormal=op({randomStandardNormal_:randomStandardNormal_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function randomUniform_(e,t=0,n=1,r="float32",a){assertNonNegativeIntegerDimensions(e);const i=buffer(e,r),s=new UniformRandom(t,n,null,a);for(let o=0;o<i.values.length;o++)i.values[o]=s.nextValue();return i.toTensor()}const randomUniform=op({randomUniform_:randomUniform_});
/**
     * @license
     * Copyright 2023 Google LLC.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function randomUniformInt_(e,t,n,r){return randomUniform(e,t,n,"int32",r)}const randomUniformInt=op({randomUniformInt_:randomUniformInt_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function range$4(e,t,n=1,r="float32"){if(0===n)throw new Error("Cannot have a step of zero");const a={start:e,stop:t,step:n,dtype:r};return ENGINE.runKernel(Range,{},a)}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function real_(e){const t={input:convertToTensor(e,"input","real")};return ENGINE.runKernel(Real,t)}const real$2=op({real_:real_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function reciprocal_(e){const t={x:convertToTensor(e,"x","reciprocal")};return ENGINE.runKernel(Reciprocal,t)}const reciprocal$2=op({reciprocal_:reciprocal_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function relu_(e){const t={x:convertToTensor(e,"x","relu")};return ENGINE.runKernel(Relu$1,t)}const relu$2=op({relu_:relu_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function relu6_(e){const t={x:convertToTensor(e,"x","relu6")};return ENGINE.runKernel(Relu6$1,t)}const relu6$2=op({relu6_:relu6_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function reverse_(e,t){const n={x:convertToTensor(e,"x","reverse")},r={dims:t};return ENGINE.runKernel(Reverse,n,r)}const reverse$2=op({reverse_:reverse_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function reverse1d_(e){const t=convertToTensor(e,"x","reverse");return assert$1(1===t.rank,(()=>`Error in reverse1D: x must be rank 1 but got rank ${t.rank}.`)),reverse$2(t,0)}const reverse1d=op({reverse1d_:reverse1d_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function reverse2d_(e,t){const n=convertToTensor(e,"x","reverse");return assert$1(2===n.rank,(()=>`Error in reverse2D: x must be rank 2 but got rank ${n.rank}.`)),reverse$2(n,t)}const reverse2d=op({reverse2d_:reverse2d_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function reverse3d_(e,t){const n=convertToTensor(e,"x","reverse");return assert$1(3===n.rank,(()=>`Error in reverse3D: x must be rank 3 but got rank ${n.rank}.`)),reverse$2(n,t)}const reverse3d=op({reverse3d_:reverse3d_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function reverse4d_(e,t){const n=convertToTensor(e,"x","reverse");return assert$1(4===n.rank,(()=>`Error in reverse4D: x must be rank 4 but got rank ${n.rank}.`)),reverse$2(n,t)}const reverse4d=op({reverse4d_:reverse4d_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function round_(e){const t={x:convertToTensor(e,"x","round")};return ENGINE.runKernel(Round,t)}const round$2=op({round_:round_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function rsqrt_(e){const t={x:convertToTensor(e,"x","rsqrt","float32")};return ENGINE.runKernel(Rsqrt,t)}const rsqrt$2=op({rsqrt_:rsqrt_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function selu_(e){const t={x:convertToTensor(e,"x","selu")};return ENGINE.runKernel(Selu$1,t)}const selu$2=op({selu_:selu_});function separableConv2d_(e,t,n,r,a,i=[1,1],s="NHWC"){const o=convertToTensor(e,"x","separableConv2d"),l=convertToTensor(t,"depthwiseFilter","separableConv2d"),u=convertToTensor(n,"pointwiseFilter","separableConv2d");let c=o,h=!1;if(3===o.rank&&(h=!0,c=reshape$2(o,[1,o.shape[0],o.shape[1],o.shape[2]])),"NCHW"===s)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");assert$1(4===c.rank,(()=>`Error in separableConv2d: input must be rank 4, but got rank ${c.rank}.`)),assert$1(4===l.rank,(()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`)),assert$1(4===u.rank,(()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`)),assert$1(1===u.shape[0],(()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${u.shape[0]}.`)),assert$1(1===u.shape[1],(()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${u.shape[1]}.`));const d=l.shape[2],p=l.shape[3];assert$1(u.shape[2]===d*p,(()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${d*p}, but got ${u.shape[2]}.`));const f=depthwiseConv2d$2(c,l,r,a,s,i),m=conv2d$2(f,u,1,"valid",s);return h?reshape$2(m,[m.shape[1],m.shape[2],m.shape[3]]):m}const separableConv2d=op({separableConv2d_:separableConv2d_});
/**
     * @license
     * Copyright 2020 Google Inc. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */async function setdiff1dAsync_(e,t){const n=convertToTensor(e,"x","setdiff1d"),r=convertToTensor(t,"y","setdiff1d");assert$1(n.dtype===r.dtype,(()=>`x and y should have the same dtype, but got x (${n.dtype}) and y (${r.dtype}).`)),assert$1(1===n.rank,(()=>`x should be 1D tensor, but got x (${n.shape}).`)),assert$1(1===r.rank,(()=>`y should be 1D tensor, but got y (${r.shape}).`));const a=await n.data(),i=await r.data(),s=new Set(i);let o=0;for(let c=0;c<a.length;c++)s.has(a[c])||o++;const l=new TensorBuffer([o],n.dtype),u=new TensorBuffer([o],"int32");for(let c=0,h=0;c<a.length;c++)s.has(a[c])||(l.values[h]=a[c],u.values[h]=c,h++);return[l.toTensor(),u.toTensor()]}const setdiff1dAsync=setdiff1dAsync_;
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function sign_(e){const t={x:convertToTensor(e,"x","sign")};return ENGINE.runKernel(Sign,t)}const sign$2=op({sign_:sign_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function sin_(e){const t={x:convertToTensor(e,"x","sin","float32")};return ENGINE.runKernel(Sin,t)}const sin$2=op({sin_:sin_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function sinh_(e){const t={x:convertToTensor(e,"x","sinh")};return ENGINE.runKernel(Sinh,t)}const sinh$2=op({sinh_:sinh_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function slice1d_(e,t,n){const r=convertToTensor(e,"x","slice1d");return assert$1(1===r.rank,(()=>`slice1d expects a rank-1 tensor, but got a rank-${r.rank} tensor`)),slice$2(r,[t],[n])}const slice1d=op({slice1d_:slice1d_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function slice2d_(e,t,n){const r=convertToTensor(e,"x","slice2d");return assert$1(2===r.rank,(()=>`slice2d expects a rank-2 tensor, but got a rank-${r.rank} tensor`)),slice$2(r,t,n)}const slice2d=op({slice2d_:slice2d_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function slice3d_(e,t,n){const r=convertToTensor(e,"x","slice3d");return assert$1(3===r.rank,(()=>`slice3d expects a rank-3 tensor, but got a rank-${r.rank} tensor`)),slice$2(r,t,n)}const slice3d=op({slice3d_:slice3d_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function slice4d_(e,t,n){const r=convertToTensor(e,"x","slice4d");return assert$1(4===r.rank,(()=>`slice4d expects a rank-4 tensor, but got a rank-${r.rank} tensor`)),slice$2(r,t,n)}const slice4d=op({slice4d_:slice4d_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function softmax_(e,t=-1){const n=convertToTensor(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${t}`);const r={logits:n},a={dim:t};return ENGINE.runKernel(Softmax$2,r,a)}const softmax$2=op({softmax_:softmax_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function fft_(e){assert$1("complex64"===e.dtype,(()=>`The dtype for tf.spectral.fft() must be complex64 but got ${e.dtype}.`));const t={input:e};return ENGINE.runKernel(FFT,t)}const fft$2=op({fft_:fft_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function ifft_(e){assert$1("complex64"===e.dtype,(()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${e.dtype}.`));const t={input:e};return ENGINE.runKernel(IFFT,t)}const ifft$2=op({ifft_:ifft_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function irfft_(e){const t=e.shape[e.shape.length-1],n=e.size/t;let r;if(t<=2){const a=reshape$2(e,[n,t]);r=ifft$2(a)}else{const a=[n,2*(t-1)],i=reshape$2(real$2(e),[n,t]),s=reshape$2(imag$2(e),[n,t]),o=reverse$2(slice$2(i,[0,1],[n,t-2]),1),l=mul(reverse$2(slice$2(s,[0,1],[n,t-2]),1),scalar(-1)),u=concat$2([i,o],1),c=concat$2([s,l],1),h=reshape$2(complex$2(u,c),[a[0],a[1]]);r=ifft$2(h)}if(r=real$2(r),3===e.rank&&0!==e.shape[0]){const t=r,n=e.shape[0];r=reshape$2(r,[n,r.shape[0]/n,r.shape[1]]),t.dispose()}return r}const irfft=op({irfft_:irfft_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function split_(e,t,n=0){const r={x:convertToTensor(e,"x","split")},a={numOrSizeSplits:t,axis:n};return ENGINE.runKernel(SplitV,r,a)}const split$3=op({split_:split_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function rfft_(e,t){assert$1("float32"===e.dtype,(()=>`The dtype for rfft() must be real value but got ${e.dtype}`));let n=e.shape[e.shape.length-1];const r=e.size/n;let a;if(null!=t&&t<n){const r=e.shape.map((e=>0)),i=e.shape.map((e=>e));i[e.shape.length-1]=t,a=slice$2(e,r,i),n=t}else if(null!=t&&t>n){const r=e.shape.map((e=>e));r[e.shape.length-1]=t-n,a=concat$2([e,zeros$1(r)],e.shape.length-1),n=t}else a=e;const i=zerosLike$2(a),s=reshape$2(complex$2(a,i),[r,n]),o=fft$2(s),l=Math.floor(n/2)+1,u=real$2(o),c=imag$2(o),h=split$3(u,[l,n-l],u.shape.length-1),d=split$3(c,[l,n-l],c.shape.length-1),p=a.shape.slice();return p[a.shape.length-1]=l,reshape$2(complex$2(h[0],d[0]),p)}const rfft=op({rfft_:rfft_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function squaredDifference_(e,t){let n=convertToTensor(e,"a","squaredDifference"),r=convertToTensor(t,"b","squaredDifference");[n,r]=makeTypesMatch(n,r),assertAndGetBroadcastShape(n.shape,r.shape);const a={a:n,b:r};return ENGINE.runKernel(SquaredDifference,a,{})}const squaredDifference$2=op({squaredDifference_:squaredDifference_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function squeeze_(e,t){const n=convertToTensor(e,"x","squeeze","string_or_numeric");return reshape$2(n,squeezeShape(n.shape,t).newShape)}const squeeze=op({squeeze_:squeeze_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function stack_(e,t=0){const n=convertToTensorArray(e,"tensors","stack","string_or_numeric");assert$1(n.length>=1,(()=>"Pass at least one tensor to tf.stack")),n.length>0&&assert$1(t<=n[0].rank,(()=>"Axis must be <= rank of the tensor"));const r=n,a={axis:t};return ENGINE.runKernel(Pack,r,a)}const stack=op({stack_:stack_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function step_(e,t=0){const n={x:convertToTensor(e,"x","step")},r={alpha:t};return ENGINE.runKernel(Step,n,r)}const step$2=op({step_:step_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function stridedSlice_(e,t,n,r,a=0,i=0,s=0,o=0,l=0){const u={x:convertToTensor(e,"x","stridedSlice","string_or_numeric")},c={begin:t,end:n,strides:r,beginMask:a,endMask:i,ellipsisMask:s,newAxisMask:o,shrinkAxisMask:l};return ENGINE.runKernel(StridedSlice,u,c)}const stridedSlice$2=op({stridedSlice_:stridedSlice_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function tan_(e){const t={x:convertToTensor(e,"x","tan","float32")};return ENGINE.runKernel(Tan,t)}const tan$2=op({tan_:tan_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function tensor1d(e,t){assertNonNull(e);const n=inferShape(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return makeTensor(e,null,n,t)}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function tensor2d(e,t,n){if(assertNonNull(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");const r=inferShape(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return makeTensor(e,t,r,n)}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function tensor3d(e,t,n){if(assertNonNull(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");const r=inferShape(e,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return makeTensor(e,t,r,n)}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function tensor4d(e,t,n){if(assertNonNull(e),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");const r=inferShape(e,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return makeTensor(e,t,r,n)}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function tensor5d(e,t,n){if(assertNonNull(e),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");const r=inferShape(e,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return makeTensor(e,t,r,n)}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function tensor6d(e,t,n){if(assertNonNull(e),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");const r=inferShape(e,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return makeTensor(e,t=t||r,r,n)}function validateUpdateShape(e,t,n){const r=t.rank>1?t.shape[t.rank-1]:1,a=t.rank>1?t.rank-1:1,i=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${t.shape}, shape: ${e}, sliceDim: ${r}, and batchDim: ${a}.`;if(n.rank<a)throw new Error(i+` update.rank < ${a}. `);if(e.length<r+(n.rank-a))throw new Error(i+` Output shape length < ${r+(n.rank-a)}`);if(n.rank!==a+e.length-r)throw new Error(i+" update.rank != "+(a+e.length-r));for(let s=0;s<a;++s)if(n.shape[s]!==t.shape[s])throw new Error(i+` updates.shape[${s}] (${n.shape[s]}) != indices.shape[${s}] (${t.shape[s]}).`);for(let s=0;s<n.rank-a;++s)if(n.shape[s+a]!==e[s+r])throw new Error(i+` updates.shape[${s+a}] (${n.shape[s+a]}) != shape[${s+a}] (${e[s+a]})`)}function validateInput$1(e,t,n){if(t.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${t.rank}.`);if(e.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${e.rank}.`);if("int32"!==t.dtype)throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${t.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(0===n.length){if(0===t.size)throw new Error(`Indices specified for empty output. indices shape: ${t.shape}`);if(0===e.size)throw new Error(`Updates specified for empty output. updates shape: ${e.shape}`)}validateUpdateShape(n,t,e)}function calculateShapes(e,t,n){const r=t.shape.length,a=r>1?t.shape[r-1]:1,i=n.length;let s=1;for(let l=a;l<i;++l)s*=n[l];const o=a<1?1:a;return{sliceRank:a,numUpdates:sizeFromShape(t.shape)/o,sliceSize:s,strides:[...computeStrides(n.slice(0,a)),1],outputSize:sizeFromShape(n)}}
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function tensorScatterUpdate_(e,t,n){const r=convertToTensor(e,"tensor","tensorScatterupdate"),a=convertToTensor(t,"indices","tensorScatterupdate","int32"),i=convertToTensor(n,"updates","tensorScatterupdate");if(validateInput$1(i,a,r.shape),r.dtype!==i.dtype)throw new Error(`tensor and updates must have the same dtype, instead they are ${r.dtype} and ${i.dtype}.`);const s={tensor:r,indices:a,updates:i};return ENGINE.runKernel(TensorScatterUpdate,s,{})}const tensorScatterUpdate$2=op({tensorScatterUpdate_:tensorScatterUpdate_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function topk_(e,t=1,n=!0){const r=convertToTensor(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");const a=r.shape[r.shape.length-1];if(t<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${t}`);if(t>a)throw new Error(`'k' passed to topk() must be <= the last dimension (${a}) but got ${t}`);const i={x:r},s={k:t,sorted:n},[o,l]=ENGINE.runKernel(TopK,i,s);return{values:o,indices:l}}const topk=op({topk_:topk_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function truncatedNormal_(e,t=0,n=1,r,a){if(assertNonNegativeIntegerDimensions(e),null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");const i=new MPRandGauss(t,n,r,!0,a),s=buffer(e,r);for(let o=0;o<s.values.length;o++)s.values[o]=i.nextValue();return s.toTensor()}const truncatedNormal=op({truncatedNormal_:truncatedNormal_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function unique_(e,t=0){const n=convertToTensor(e,"x","unique","string_or_numeric");assert$1(n.rank>0,(()=>"The input tensor must be at least 1D"));const r={x:n},a={axis:t},[i,s]=ENGINE.runKernel(Unique,r,a);return{values:i,indices:s}}const unique$3=op({unique_:unique_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function unsortedSegmentSum_(e,t,n){const r=convertToTensor(e,"x","unsortedSegmentSum"),a=convertToTensor(t,"segmentIds","unsortedSegmentSum","int32");assert$1(isInt(n),(()=>"numSegments must be of dtype int"));const i={x:r,segmentIds:a},s={numSegments:n};return ENGINE.runKernel(UnsortedSegmentSum,i,s)}const unsortedSegmentSum$2=op({unsortedSegmentSum_:unsortedSegmentSum_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function unstack_(e,t=0){const n=convertToTensor(e,"x","unstack","string_or_numeric");assert$1(t>=-n.shape.length&&t<n.shape.length,(()=>`Axis = ${t} is not in [-${n.shape.length}, ${n.shape.length})`));const r={value:n},a={axis:t};return ENGINE.runKernel(Unpack,r,a)}const unstack=op({unstack_:unstack_});
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function upperBound$1(e,t){return searchSorted$2(e,t,"right")}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function variable(e,t=!0,n,r){return ENGINE.makeVariable(e,t,n,r)}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function whereImpl$2(e,t){const n=[];for(let i=0;i<t.length;i++)t[i]&&n.push(i);const r=buffer(e,"int32"),a=buffer([n.length,e.length],"int32");for(let i=0;i<n.length;i++){const t=r.indexToLoc(n[i]),s=i*e.length;a.values.set(t,s)}return a.toTensor()}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */async function whereAsync_(e){const t=convertToTensor(e,"condition","whereAsync","bool"),n=await t.data(),r=whereImpl$2(t.shape,n);return e!==t&&t.dispose(),r}const whereAsync=whereAsync_;
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */async function booleanMaskAsync_(e,t,n){const r=convertToTensor(e,"tensor","boolMask"),a=convertToTensor(t,"mask","boolMask","bool"),i=null==n?0:n,s=a.rank,o=r.shape;assert$1(s>0,(()=>"mask cannot be scalar")),assertShapesMatch(o.slice(i,i+s),a.shape,"mask's shape must match the first K dimensions of tensor's shape,");let l=1;for(let m=i;m<i+s;m++)l*=o[m];const u=o.slice(0,i).concat([l],o.slice(i+s)),c=reshape$2(r,u),h=reshape$2(a,[-1]),d=await whereAsync(h),p=squeeze(d,[1]),f=gather$1(c,p,i);return e!==r&&r.dispose(),t!==a&&a.dispose(),p.dispose(),c.dispose(),h.dispose(),d.dispose(),f}const booleanMaskAsync=booleanMaskAsync_;
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function transpose_(e,t,n){const r=convertToTensor(e,"x","transpose");if(null==t&&(t=r.shape.map(((e,t)=>t)).reverse()),assert$1(r.rank===t.length,(()=>`Error in transpose: rank of input ${r.rank} must match length of perm ${t}.`)),t.forEach((e=>{assert$1(e>=0&&e<r.rank,(()=>`All entries in 'perm' must be between 0 and ${r.rank-1} but got ${t}`))})),r.rank<=1)return r.clone();const a={x:r},i={perm:t};return"complex64"===r.dtype?tidy((()=>{let e=real$2(r),t=imag$2(r);return e=ENGINE.runKernel(Transpose,{x:e},i),t=ENGINE.runKernel(Transpose,{x:t},i),n&&(t=neg$2(t)),complex$2(e,t)})):ENGINE.runKernel(Transpose,a,i)}const transpose$2=op({transpose_:transpose_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function movingAverage_(e,t,n,r,a=!0){const i=convertToTensor(e,"v","movingAverage"),s=convertToTensor(t,"x","movingAverage"),o=convertToTensor(n,"decay","movingAverage");assertTypesMatch(i,s),assert$1(arraysEqual(i.shape,s.shape),(()=>"Shape mismatch in v and x"));const l=scalar(1),u=sub$2(l,o);let c=mul(sub$2(s,i),u);if(a){assert$1(null!=r,(()=>"When using zeroDebias: true, step is required."));const e=convertToTensor(r,"step","movingAverage");c=div$1(c,sub$2(l,pow$2(o,e)))}return add$1(i,c)}const movingAverage=op({movingAverage_:movingAverage_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function scatterND_(e,t,n){assertNonNegativeIntegerDimensions(n);const r=convertToTensor(e,"indices","scatterND","int32"),a=convertToTensor(t,"updates","scatterND");validateInput$1(a,r,n);const i={indices:r,updates:a},s={shape:n};return ENGINE.runKernel(ScatterNd,i,s)}const scatterND=op({scatterND_:scatterND_});function validateInput(e,t,n,r){if("int32"!==e.dtype)throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${e.shape}.`);const a=e.rank>0?e.shape[0]:1,i=e.rank>1?e.shape[1]:1;if(n.length!==i)throw new Error(`outputShape has incorrect number of elements:, ${n.length}, should be: ${i}.`);const s=t.size;if(0!==t.rank&&(1!==t.rank||s!==a))throw new Error(`sparseValues has incorrect shape ${t.shape}, should be [] or [${a}]`);if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function sparseToDense_(e,t,n,r=0){assertNonNegativeIntegerDimensions(n);const a=convertToTensor(e,"sparseIndices","sparseToDense","int32"),i=convertToTensor(t,"sparseValues","sparseToDense","string_or_numeric"),s=convertToTensor(r,"defaultValue","sparseToDense",i.dtype);validateInput(a,i,n,s);const o={sparseIndices:a,sparseValues:i,defaultValue:s},l={outputShape:n};return ENGINE.runKernel(SparseToDense,o,l)}const sparseToDense$2=op({sparseToDense_:sparseToDense_});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function gatherND_(e,t){const n=convertToTensor(t,"indices","gatherND","int32"),r={params:convertToTensor(e,"x","gatherND","string_or_numeric"),indices:n};return ENGINE.runKernel(GatherNd,r)}const gatherND=op({gatherND_:gatherND_});
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function getNoiseShape(e,t){if(null==t)return e.shape.slice();if(arraysEqual(e.shape,t))return t;if(e.shape.length===t.length){const n=[];for(let r=0;r<e.shape.length;r++)null==t[r]&&null!=e.shape[r]?n.push(e.shape[r]):n.push(t[r]);return n}return t}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function dropout_(e,t,n,r){const a=convertToTensor(e,"x","dropout");if(assert$1("float32"===a.dtype,(()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${a.dtype} tensor instead.`)),assert$1(t>=0&&t<1,(()=>`rate must be a float in the range [0, 1), but got ${t}.`)),0===t)return e instanceof Tensor?a.clone():a;const i=getNoiseShape(a,n),s=1-t,o=div$1(floor$2(add$1(randomUniform(i,0,1,"float32",r),s)),s);return mul(a,o)}const dropout$1=op({dropout_:dropout_});
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function enclosingPowerOfTwo(e){return Math.floor(Math.pow(2,Math.ceil(Math.log(e)/Math.log(2))))}function cosineWindow(e,t,n){const r=1-e%2,a=new Float32Array(e);for(let i=0;i<e;++i){const s=2*Math.PI*i/(e+r-1);a[i]=t-n*Math.cos(s)}return tensor1d(a,"float32")}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */async function inTopKAsync_(e,t,n=1){const r=convertToTensor(e,"predictions","inTopK"),a=convertToTensor(t,"targets","inTopK");assert$1(r.rank>1,(()=>`inTopK() expects the predictions to be of rank 2 or higher, but got ${r.rank}`)),assert$1(r.rank-1===a.rank,(()=>`predictions rank should be 1 larger than targets rank, but got predictions rank ${r.rank} and targets rank ${a.rank}`)),assertShapesMatch(r.shape.slice(0,r.shape.length-1),a.shape,"predictions's shape should be align with the targets' shape, except the last dimension.");const i=r.shape[r.shape.length-1];assert$1(n>0&&n<=i,(()=>`'k' passed to inTopK() must be > 0 && <= the predictions last dimension (${i}), but got ${n}`));const s=await r.data(),o=await a.data(),[l,u]=[s.length/i,i],c=getTypedArrayFromDType("bool",l);for(let h=0;h<l;h++){const e=h*u,t=s.subarray(e,e+u),r=[];for(let n=0;n<t.length;n++)r.push({value:t[n],index:n});r.sort(((e,t)=>t.value-e.value)),c[h]=0;for(let a=0;a<n;a++)if(r[a].index===o[h]){c[h]=1;break}}return e!==r&&r.dispose(),t!==a&&a.dispose(),tensor(c,a.shape,"bool")}const inTopKAsync=inTopKAsync_;
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function conv2DBackpropFilter_(e,t,n,r,a,i="NHWC",s){let o=e;3===e.rank&&(o=reshape$2(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let l=t;3===l.rank&&(l=reshape$2(t,[1,t.shape[0],t.shape[1],t.shape[2]])),assert$1(4===o.rank,(()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${o.shape}.`)),assert$1(4===l.rank,(()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`)),assert$1(4===n.length,(()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`));const u="NHWC"===i?o.shape[3]:o.shape[1],c="NHWC"===i?l.shape[3]:l.shape[1];assert$1(u===n[2],(()=>`Error in conv2dDerFilter: depth of input ${u}) must match input depth in filter (${n[2]}.`)),assert$1(c===n[3],(()=>`Error in conv2dDerFilter: depth of dy (${c}) must match output depth for filter (${n[3]}).`)),checkPadOnDimRoundingMode("conv2dDerFilter",a,s);const h={x:o,dy:l},d={strides:r,pad:a,dataFormat:i,dimRoundingMode:s,filterShape:n};return ENGINE.runKernel(Conv2DBackpropFilter,h,d)}const conv2DBackpropFilter$2=op({conv2DBackpropFilter_:conv2DBackpropFilter_});
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function getFusedDyActivation(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return mul(e,step$2(t));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function getFusedBiasGradient(e,t){let n=t;const r=getReductionAxes(e.shape,t.shape);return r.length>0&&(n=sum$2(n,r)),reshape$2(n,e.shape)}function applyActivation$1(e,t,n,r){if("linear"===t)return e;if("relu"===t)return relu$2(e);if("elu"===t)return elu$3(e);if("relu6"===t)return relu6$2(e);if("prelu"===t)return prelu$2(e,n);if("leakyrelu"===t)return leakyRelu$2(e,r);if("sigmoid"===t)return sigmoid$2(e);throw new Error(`Unknown fused activation ${t}.`)}const shouldFuse=(e,t)=>!(e>0)||"linear"===t;
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function fusedConv2d_({x:e,filter:t,strides:n,pad:r,dataFormat:a="NHWC",dilations:i=[1,1],dimRoundingMode:s,bias:o,activation:l="linear",preluActivationWeights:u,leakyreluAlpha:c}){if(l=l||"linear",!1===shouldFuse(ENGINE.state.gradientDepth,l)){assert$1("NHWC"===a,(()=>`Error in fused conv2d: got dataFormat of ${a} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`));let h=conv2d$2(e,t,n,r,a,i,s);return null!=o&&(h=add$1(h,o)),applyActivation$1(h,l,u,c)}const h=convertToTensor(e,"x","conv2d","float32"),d=convertToTensor(t,"filter","conv2d","float32");let p=h,f=!1;3===h.rank&&(f=!0,p=reshape$2(h,[1,h.shape[0],h.shape[1],h.shape[2]])),assert$1(4===p.rank,(()=>`Error in fused conv2d: input must be rank 4, but got rank ${p.rank}.`)),assert$1(4===d.rank,(()=>`Error in fused conv2d: filter must be rank 4, but got rank ${d.rank}.`)),checkPadOnDimRoundingMode("fused conv2d",r,s);const m="NHWC"===a?p.shape[3]:p.shape[1];assert$1(d.shape[2]===m,(()=>`Error in conv2d: depth of input (${m}) must match input depth for filter ${d.shape[2]}.`)),assert$1(eitherStridesOrDilationsAreOne(n,i),(()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${i}'`));const g=computeConv2DInfo(p.shape,d.shape,n,i,r,s);let y,v;if(null!=o&&(y=convertToTensor(o,"bias","fused conv2d"),[y]=makeTypesMatch(y,h),"NHWC"===a?assertAndGetBroadcastShape(g.outShape,y.shape):(assert$1(y.shape.length<=1,(()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${y.shape.length}.`)),assert$1(0===y.shape.length||y.shape[0]===g.outChannels||1===y.shape[0],(()=>`Error in fused conv2d: bias shape (${y.shape}) is not compatible with the number of output channels (${g.outChannels})`)))),null!=u){const e=u.shape;if(assert$1(e.length<=1||3===e.length,(()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${e.length}.`)),1===e.length)assert$1(1===e[0]||e[0]===g.outChannels,(()=>`Error in fused conv2d: PReLU activation weights (${e}) is not compatible with the number of output channels (${g.outChannels}).`));else if(3===e.length)try{assertAndGetBroadcastShape(e,g.outShape)}catch(e2){const n=`Error in fused conv2d: PReLU activation weights (${e}) is not compatible with the output shape of the conv2d (${g.outShape}).`;throw Error(n)}v=convertToTensor(u,"prelu weights","fused conv2d")}const b=(e,t)=>{assert$1("NHWC"===a,(()=>`Error in gradient of fused conv2D: got dataFormat of ${a} but only NHWC is currently supported.`));const[s,o,u,c]=t,h=getFusedDyActivation(e,u,l);assert$1(tupleValuesAreOne(i),(()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`));const d=[conv2DBackpropInput$2(o.shape,h,s,n,r),conv2DBackpropFilter$2(o,h,s.shape,n,r)];if(null!=c){const e=getFusedBiasGradient(c,h);d.push(e)}return d},x={x:p,filter:d,bias:y,preluActivationWeights:v},T={strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:s,activation:l,leakyreluAlpha:c};if(null==o){return customGrad(((e,t,n)=>{let r=ENGINE.runKernel(FusedConv2D,x,T);return n([t,e,r]),f&&(r=reshape$2(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:b}}))(p,d)}return customGrad(((e,t,n,r)=>{let a=ENGINE.runKernel(FusedConv2D,x,T);return r([t,e,a,n]),f&&(a=reshape$2(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:b}}))(p,d,y)}const conv2d$1=op({fusedConv2d_:fusedConv2d_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function depthwiseConv2dNativeBackpropFilter_(e,t,n,r,a,i=[1,1],s){let o=e;3===e.rank&&(o=reshape$2(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let l=t;3===l.rank&&(l=reshape$2(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const u={x:o,dy:l},c={strides:r,pad:a,dimRoundingMode:s,dilations:i,filterShape:n};return ENGINE.runKernel(DepthwiseConv2dNativeBackpropFilter,u,c)}const depthwiseConv2dNativeBackpropFilter$2=op({depthwiseConv2dNativeBackpropFilter_:depthwiseConv2dNativeBackpropFilter_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function depthwiseConv2dNativeBackpropInput_(e,t,n,r,a,i=[1,1],s){let o=t,l=!1;3===t.rank&&(l=!0,o=reshape$2(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const u={dy:o,filter:n},c={strides:r,pad:a,dimRoundingMode:s,dilations:i,inputShape:e},h=ENGINE.runKernel(DepthwiseConv2dNativeBackpropInput,u,c);return l?reshape$2(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const depthwiseConv2dNativeBackpropInput$2=op({depthwiseConv2dNativeBackpropInput_:depthwiseConv2dNativeBackpropInput_});
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function fusedDepthwiseConv2d_({x:e,filter:t,strides:n,pad:r,dataFormat:a="NHWC",dilations:i=[1,1],dimRoundingMode:s,bias:o,activation:l="linear",preluActivationWeights:u,leakyreluAlpha:c}){if(!1===shouldFuse(ENGINE.state.gradientDepth,l)){let h=depthwiseConv2d$2(e,t,n,r,a,i,s);return null!=o&&(h=add$1(h,o)),applyActivation$1(h,l,u,c)}const h=convertToTensor(e,"x","depthwiseConv2d","float32"),d=convertToTensor(t,"filter","depthwiseConv2d","float32");let p=h,f=!1;3===h.rank&&(f=!0,p=reshape$2(h,[1,h.shape[0],h.shape[1],h.shape[2]])),assert$1(4===p.rank,(()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${p.rank}.`)),assert$1(4===d.rank,(()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${d.rank}.`)),assert$1(p.shape[3]===d.shape[2],(()=>`Error in fused depthwiseConv2d: number of input channels (${p.shape[3]}) must match the inChannels dimension in filter ${d.shape[2]}.`)),null==i&&(i=[1,1]),assert$1(eitherStridesOrDilationsAreOne(n,i),(()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${n} and dilations '${i}'`)),checkPadOnDimRoundingMode("fused depthwiseConv2d",r,s);const m=computeConv2DInfo(p.shape,d.shape,n,i,r,s,!0);let g,y;null!=o&&(g=convertToTensor(o,"bias","fused conv2d"),[g]=makeTypesMatch(g,h),assertAndGetBroadcastShape(m.outShape,g.shape)),null!=u&&(y=convertToTensor(u,"prelu weights","fused depthwiseConv2d"));const v=(e,t)=>{assert$1(tupleValuesAreOne(i),(()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${i}'`));const[a,o,u,c]=t,h=getFusedDyActivation(e,u,l),d=depthwiseConv2dNativeBackpropInput$2(o.shape,h,a,n,r,i,s),p=depthwiseConv2dNativeBackpropFilter$2(o,h,a.shape,n,r,i,s);if(null!=c){return[d,p,getFusedBiasGradient(g,h)]}return[d,p]},b={x:p,filter:d,bias:g,preluActivationWeights:y},x={strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:s,activation:l,leakyreluAlpha:c};if(null==o){return customGrad(((e,t,n)=>{let r=ENGINE.runKernel(FusedDepthwiseConv2D,b,x);return n([t,e,r]),f&&(r=reshape$2(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:v}}))(p,d)}return customGrad(((e,t,n,r)=>{let a=ENGINE.runKernel(FusedDepthwiseConv2D,b,x);return r([t,e,a,n]),f&&(a=reshape$2(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:v}}))(p,d,g)}const depthwiseConv2d$1=op({fusedDepthwiseConv2d_:fusedDepthwiseConv2d_});
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function fusedMatMul_({a:e,b:t,transposeA:n=!1,transposeB:r=!1,bias:a,activation:i="linear",preluActivationWeights:s,leakyreluAlpha:o=.2}){if(!1===shouldFuse(ENGINE.state.gradientDepth,i)){let l=matMul$1(e,t,n,r);return null!=a&&(l=add$1(l,a)),applyActivation$1(l,i,s,o)}let l=convertToTensor(e,"a","fused matMul"),u=convertToTensor(t,"b","fused matMul");[l,u]=makeTypesMatch(l,u);const c=n?l.shape[l.rank-2]:l.shape[l.rank-1],h=r?u.shape[u.rank-1]:u.shape[u.rank-2],d=n?l.shape[l.rank-1]:l.shape[l.rank-2],p=r?u.shape[u.rank-2]:u.shape[u.rank-1],f=l.shape.slice(0,-2),m=u.shape.slice(0,-2),g=sizeFromShape(f),y=sizeFromShape(m);assert$1(c===h,(()=>`Error in fused matMul: inner shapes (${c}) and (${h}) of Tensors with shapes ${l.shape} and ${u.shape} and transposeA=${n} and transposeB=${r} must match.`));const v=assertAndGetBroadcastShape(l.shape.slice(0,-2),u.shape.slice(0,-2)).concat([d,p]),b=reshape$2(l,n?[g,c,d]:[g,d,c]),x=reshape$2(u,r?[y,p,h]:[y,h,p]);let T,_;null!=a&&(T=convertToTensor(a,"bias","fused matMul"),[T]=makeTypesMatch(T,l),assertAndGetBroadcastShape(v,T.shape)),null!=s&&(_=convertToTensor(s,"prelu weights","fused matMul"));const w=(e,t)=>{const[s,o,l,u]=t,c=getFusedDyActivation(reshape$2(e,l.shape),l,i);let h,d;if(n||r?!n&&r?(h=matMul$1(c,o,!1,!1),d=matMul$1(c,s,!0,!1)):n&&!r?(h=matMul$1(o,c,!1,!0),d=matMul$1(s,c,!1,!1)):(h=matMul$1(o,c,!0,!0),d=matMul$1(c,s,!0,!0)):(h=matMul$1(c,o,!1,!0),d=matMul$1(s,c,!0,!1)),null!=a){return[h,d,getFusedBiasGradient(u,c)]}return[h,d]},S={a:b,b:x,bias:T,preluActivationWeights:_},C={transposeA:n,transposeB:r,activation:i,leakyreluAlpha:o};if(null==a){return customGrad(((e,t,n)=>{const r=ENGINE.runKernel(_FusedMatMul,S,C);return n([e,t,r]),{value:reshape$2(r,v),gradFunc:w}}))(b,x)}return customGrad(((e,t,n,r)=>{const a=ENGINE.runKernel(_FusedMatMul,S,C);return r([e,t,a,n]),{value:reshape$2(a,v),gradFunc:w}}))(b,x,T)}const matMul=op({fusedMatMul_:fusedMatMul_}),fused_ops=Object.freeze(Object.defineProperty({__proto__:null,conv2d:conv2d$1,depthwiseConv2d:depthwiseConv2d$1,matMul:matMul},Symbol.toStringTag,{value:"Module"}));
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function hammingWindow_(e){return cosineWindow(e,.54,.46)}const hammingWindow=op({hammingWindow_:hammingWindow_});
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function hannWindow_(e){return cosineWindow(e,.5,.5)}const hannWindow=op({hannWindow_:hannWindow_});
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function frame_(e,t,n,r=!1,a=0){let i=0;const s=[];for(;i+t<=e.size;)s.push(slice$2(e,i,t)),i+=n;if(r)for(;i<e.size;){const r=i+t-e.size,o=concat$2([slice$2(e,i,t-r),fill$2([r],a)]);s.push(o),i+=n}return 0===s.length?tensor2d([],[0,t]):reshape$2(concat$2(s),[s.length,t])}const frame=op({frame_:frame_});
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function stft_(e,t,n,r,a=hannWindow){null==r&&(r=enclosingPowerOfTwo(t));const i=frame(e,t,n),s=mul(i,a(t));return rfft(s,r)}const stft=op({stft_:stft_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function cropAndResize_(e,t,n,r,a="bilinear",i=0){const s=convertToTensor(e,"image","cropAndResize"),o=convertToTensor(t,"boxes","cropAndResize","float32"),l=convertToTensor(n,"boxInd","cropAndResize","int32"),u=o.shape[0];assert$1(4===s.rank,(()=>`Error in cropAndResize: image must be rank 4,but got rank ${s.rank}.`)),assert$1(2===o.rank&&4===o.shape[1],(()=>`Error in cropAndResize: boxes must be have size [${u},4] but had shape ${o.shape}.`)),assert$1(1===l.rank&&l.shape[0]===u,(()=>`Error in cropAndResize: boxInd must be have size [${u}] but had shape ${o.shape}.`)),assert$1(2===r.length,(()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${r.length}.`)),assert$1(r[0]>=1&&r[1]>=1,(()=>`cropSize must be atleast [1,1], but was ${r}`)),assert$1("bilinear"===a||"nearest"===a,(()=>`method must be bilinear or nearest, but was ${a}`));const c={image:s,boxes:o,boxInd:l},h={method:a,extrapolationValue:i,cropSize:r};return ENGINE.runKernel(CropAndResize,c,h)}const cropAndResize$3=op({cropAndResize_:cropAndResize_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function flipLeftRight_(e){const t=convertToTensor(e,"image","flipLeftRight","float32");assert$1(4===t.rank,(()=>`Error in flipLeftRight: image must be rank 4,but got rank ${t.rank}.`));const n={image:t};return ENGINE.runKernel(FlipLeftRight,n,{})}const flipLeftRight=op({flipLeftRight_:flipLeftRight_});
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function grayscaleToRGB_(e){const t=convertToTensor(e,"image","grayscaleToRGB"),n=t.rank-1,r=t.shape[n];assert$1(t.rank>=2,(()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${t.rank}.`)),assert$1(1===r,(()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${r}.`));const a=new Array(t.rank);return a.fill(1,0,n),a[n]=3,tile$3(t,a)}const grayscaleToRGB=op({grayscaleToRGB_:grayscaleToRGB_});
/**
     * @license
     * Copyright 2023 Google LLC.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function rgbToGrayscale_(e){const t=convertToTensor(e,"image","RGBToGrayscale"),n=t.rank-1,r=t.shape[n];assert$1(t.rank>=2,(()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${t.rank}.`)),assert$1(3===r,(()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${r}.`));const a=t.dtype,i=cast$3(t,"float32"),s=tensor1d([.2989,.587,.114]);let o;switch(t.rank){case 2:o=einsum$2("ij,j->i",i,s);break;case 3:o=einsum$2("ijk,k->ij",i,s);break;case 4:o=einsum$2("ijkl,l->ijk",i,s);break;case 5:o=einsum$2("ijklm,m->ijkl",i,s);break;case 6:o=einsum$2("ijklmn,n->ijklm",i,s);break;default:throw new Error("Not a valid tensor rank.")}return o=expandDims$3(o,-1),cast$3(o,a)}const rgbToGrayscale=op({rgbToGrayscale_:rgbToGrayscale_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function rotateWithOffset_(e,t,n=0,r=.5){const a=convertToTensor(e,"image","rotateWithOffset","float32");assert$1(4===a.rank,(()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${a.rank}.`));const i={image:a},s={radians:t,fillValue:n,center:r};return ENGINE.runKernel(RotateWithOffset,i,s)}const rotateWithOffset=op({rotateWithOffset_:rotateWithOffset_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function nonMaxSuppSanityCheck(e,t,n,r,a,i){null==r&&(r=.5),null==a&&(a=Number.NEGATIVE_INFINITY),null==i&&(i=0);const s=e.shape[0];return n=Math.min(n,s),assert$1(0<=r&&r<=1,(()=>`iouThreshold must be in [0, 1], but was '${r}'`)),assert$1(2===e.rank,(()=>`boxes must be a 2D tensor, but was of rank '${e.rank}'`)),assert$1(4===e.shape[1],(()=>`boxes must have 4 columns, but 2nd dimension was ${e.shape[1]}`)),assert$1(1===t.rank,(()=>"scores must be a 1D tensor")),assert$1(t.shape[0]===s,(()=>`scores has incompatible shape with boxes. Expected ${s}, but was ${t.shape[0]}`)),assert$1(0<=i&&i<=1,(()=>`softNmsSigma must be in [0, 1], but was '${i}'`)),{maxOutputSize:n,iouThreshold:r,scoreThreshold:a,softNmsSigma:i}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function nonMaxSuppression_(e,t,n,r=.5,a=Number.NEGATIVE_INFINITY){const i=convertToTensor(e,"boxes","nonMaxSuppression","float32"),s=convertToTensor(t,"scores","nonMaxSuppression","float32"),o=nonMaxSuppSanityCheck(i,s,n,r,a),l={maxOutputSize:n=o.maxOutputSize,iouThreshold:r=o.iouThreshold,scoreThreshold:a=o.scoreThreshold};return ENGINE.runKernel(NonMaxSuppressionV3,{boxes:i,scores:s},l)}const nonMaxSuppression=op({nonMaxSuppression_:nonMaxSuppression_});
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function binaryInsert(e,t,n){const r=binarySearch(e,t,n),a=r<0?-(r+1):r;e.splice(a,0,t)}function binarySearch(e,t,n){return binarySearch_(e,t,n||defaultComparator)}function defaultComparator(e,t){return e>t?1:e<t?-1:0}function binarySearch_(e,t,n){let r=0,a=e.length,i=0,s=!1;for(;r<a;){i=r+(a-r>>>1);const o=n(t,e[i]);o>0?r=i+1:(a=i,s=!o)}return s?r:-r-1}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function nonMaxSuppressionV3Impl$2(e,t,n,r,a){return nonMaxSuppressionImpl_(e,t,n,r,a,0)}function nonMaxSuppressionV4Impl$2(e,t,n,r,a,i){return nonMaxSuppressionImpl_(e,t,n,r,a,0,!1,i,!0)}function nonMaxSuppressionV5Impl$2(e,t,n,r,a,i){return nonMaxSuppressionImpl_(e,t,n,r,a,i,!0)}function nonMaxSuppressionImpl_(e,t,n,r,a,i,s=!1,o=!1,l=!1){const u=[];for(let g=0;g<t.length;g++)t[g]>a&&u.push({score:t[g],boxIndex:g,suppressBeginIndex:0});u.sort(ascendingComparator);const c=i>0?-.5/i:0,h=[],d=[];for(;h.length<n&&u.length>0;){const t=u.pop(),{score:n,boxIndex:i,suppressBeginIndex:s}=t;if(n<a)break;let o=!1;for(let l=h.length-1;l>=s;--l){const n=intersectionOverUnion(e,i,h[l]);if(n>=r){o=!0;break}if(t.score=t.score*suppressWeight(r,c,n),t.score<=a)break}t.suppressBeginIndex=h.length,o||(t.score===n?(h.push(i),d.push(t.score)):t.score>a&&binaryInsert(u,t,ascendingComparator))}const p=h.length,f=n-p;o&&f>0&&(h.push(...new Array(f).fill(0)),d.push(...new Array(f).fill(0)));const m={selectedIndices:h};return s&&(m.selectedScores=d),l&&(m.validOutputs=p),m}function intersectionOverUnion(e,t,n){const r=e.subarray(4*t,4*t+4),a=e.subarray(4*n,4*n+4),i=Math.min(r[0],r[2]),s=Math.min(r[1],r[3]),o=Math.max(r[0],r[2]),l=Math.max(r[1],r[3]),u=Math.min(a[0],a[2]),c=Math.min(a[1],a[3]),h=Math.max(a[0],a[2]),d=Math.max(a[1],a[3]),p=(o-i)*(l-s),f=(h-u)*(d-c);if(p<=0||f<=0)return 0;const m=Math.max(i,u),g=Math.max(s,c),y=Math.min(o,h),v=Math.min(l,d),b=Math.max(y-m,0)*Math.max(v-g,0);return b/(p+f-b)}function suppressWeight(e,t,n){const r=Math.exp(t*n*n);return n<=e?r:0}function ascendingComparator(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */async function nonMaxSuppressionAsync_(e,t,n,r=.5,a=Number.NEGATIVE_INFINITY){const i=convertToTensor(e,"boxes","nonMaxSuppressionAsync"),s=convertToTensor(t,"scores","nonMaxSuppressionAsync"),o=nonMaxSuppSanityCheck(i,s,n,r,a);n=o.maxOutputSize,r=o.iouThreshold,a=o.scoreThreshold;const l=await Promise.all([i.data(),s.data()]),u=l[0],c=l[1],{selectedIndices:h}=nonMaxSuppressionV3Impl$2(u,c,n,r,a);return i!==e&&i.dispose(),s!==t&&s.dispose(),tensor1d(h,"int32")}const nonMaxSuppressionAsync=nonMaxSuppressionAsync_;
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function nonMaxSuppressionWithScore_(e,t,n,r=.5,a=Number.NEGATIVE_INFINITY,i=0){const s=convertToTensor(e,"boxes","nonMaxSuppression"),o=convertToTensor(t,"scores","nonMaxSuppression"),l=nonMaxSuppSanityCheck(s,o,n,r,a,i),u={boxes:s,scores:o},c={maxOutputSize:n=l.maxOutputSize,iouThreshold:r=l.iouThreshold,scoreThreshold:a=l.scoreThreshold,softNmsSigma:i=l.softNmsSigma},h=ENGINE.runKernel(NonMaxSuppressionV5,u,c);return{selectedIndices:h[0],selectedScores:h[1]}}const nonMaxSuppressionWithScore=op({nonMaxSuppressionWithScore_:nonMaxSuppressionWithScore_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */async function nonMaxSuppressionWithScoreAsync_(e,t,n,r=.5,a=Number.NEGATIVE_INFINITY,i=0){const s=convertToTensor(e,"boxes","nonMaxSuppressionAsync"),o=convertToTensor(t,"scores","nonMaxSuppressionAsync"),l=nonMaxSuppSanityCheck(s,o,n,r,a,i);n=l.maxOutputSize,r=l.iouThreshold,a=l.scoreThreshold,i=l.softNmsSigma;const u=await Promise.all([s.data(),o.data()]),c=u[0],h=u[1],{selectedIndices:d,selectedScores:p}=nonMaxSuppressionV5Impl$2(c,h,n,r,a,i);return s!==e&&s.dispose(),o!==t&&o.dispose(),{selectedIndices:tensor1d(d,"int32"),selectedScores:tensor1d(p)}}const nonMaxSuppressionWithScoreAsync=nonMaxSuppressionWithScoreAsync_;
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function nonMaxSuppressionPadded_(e,t,n,r=.5,a=Number.NEGATIVE_INFINITY,i=!1){const s=convertToTensor(e,"boxes","nonMaxSuppression"),o=convertToTensor(t,"scores","nonMaxSuppression"),l=nonMaxSuppSanityCheck(s,o,n,r,a,null),u={boxes:s,scores:o},c={maxOutputSize:l.maxOutputSize,iouThreshold:l.iouThreshold,scoreThreshold:l.scoreThreshold,padToMaxOutputSize:i},h=ENGINE.runKernel(NonMaxSuppressionV4,u,c);return{selectedIndices:h[0],validOutputs:h[1]}}const nonMaxSuppressionPadded=op({nonMaxSuppressionPadded_:nonMaxSuppressionPadded_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */async function nonMaxSuppressionPaddedAsync_(e,t,n,r=.5,a=Number.NEGATIVE_INFINITY,i=!1){const s=convertToTensor(e,"boxes","nonMaxSuppressionAsync"),o=convertToTensor(t,"scores","nonMaxSuppressionAsync"),l=nonMaxSuppSanityCheck(s,o,n,r,a,null),u=l.maxOutputSize,c=l.iouThreshold,h=l.scoreThreshold,[d,p]=await Promise.all([s.data(),o.data()]),{selectedIndices:f,validOutputs:m}=nonMaxSuppressionV4Impl$2(d,p,u,c,h,i);return s!==e&&s.dispose(),o!==t&&o.dispose(),{selectedIndices:tensor1d(f,"int32"),validOutputs:scalar(m,"int32")}}const nonMaxSuppressionPaddedAsync=nonMaxSuppressionPaddedAsync_;
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function resizeBilinear_(e,t,n=!1,r=!1){const a=convertToTensor(e,"images","resizeBilinear");assert$1(3===a.rank||4===a.rank,(()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${a.rank}.`)),assert$1(2===t.length,(()=>`Error in resizeBilinear: new shape must 2D, but got shape ${t}.`)),assert$1(!1===r||!1===n,(()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."));let i=a,s=!1;3===a.rank&&(s=!0,i=reshape$2(a,[1,a.shape[0],a.shape[1],a.shape[2]]));const o={images:i},l={alignCorners:n,halfPixelCenters:r,size:t},u=ENGINE.runKernel(ResizeBilinear,o,l);return s?reshape$2(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const resizeBilinear$3=op({resizeBilinear_:resizeBilinear_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function resizeNearestNeighbor_(e,t,n=!1,r=!1){const a=convertToTensor(e,"images","resizeNearestNeighbor");assert$1(3===a.rank||4===a.rank,(()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${a.rank}.`)),assert$1(2===t.length,(()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${t}.`)),assert$1("float32"===a.dtype||"int32"===a.dtype,(()=>"`images` must have `int32` or `float32` as dtype")),assert$1(!1===r||!1===n,(()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."));let i=a,s=!1;3===a.rank&&(s=!0,i=reshape$2(a,[1,a.shape[0],a.shape[1],a.shape[2]]));const o={images:i},l={alignCorners:n,halfPixelCenters:r,size:t},u=ENGINE.runKernel(ResizeNearestNeighbor,o,l);return s?reshape$2(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const resizeNearestNeighbor$2=op({resizeNearestNeighbor_:resizeNearestNeighbor_});
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * https://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function threshold_(e,t="binary",n=!1,r=.5){const a=convertToTensor(e,"image","threshold"),i=a.shape[0]*a.shape[1];let s,o,l,u,c=mul(tensor1d([r]),255);if(assert$1(3===a.rank,(()=>`Error in threshold: image must be rank 3,but got rank ${a.rank}.`)),assert$1(3===a.shape[2]||1===a.shape[2],(()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${a.shape[2]}.`)),assert$1("int32"===a.dtype||"float32"===a.dtype,(()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${a.dtype}.`)),assert$1("otsu"===t||"binary"===t,(()=>`Method must be binary or otsu, but was ${t}`)),3===a.shape[2]){[s,o,l]=split$3(a,[1,1,1],-1);const e=mul(s,.2989),t=mul(o,.587),n=mul(l,.114);u=add$1(add$1(e,t),n)}else u=e;if("otsu"===t){c=otsu(bincount$2(cast$3(round$2(u),"int32"),tensor([]),256),i)}const h=n?lessEqual$2(u,c):greater$2(u,c);return cast$3(mul(h,255),"int32")}function otsu(e,t){let n,r,a,i,s,o,l=tensor1d([-1]),u=tensor1d([0]),c=tensor1d([0]);for(let h=0;h<e.size-1;h++){n=slice$2(e,0,h+1),r=slice$2(e,h+1),s=div$1(sum$2(n),t),o=div$1(sum$2(r),t);const d=sum$2(mul(n,range$4(0,n.size)));a=div$1(d,sum$2(n));const p=fill$2(r.shape,n.size),f=add$1(range$4(0,r.size),p),m=mul(r,f);i=div$1(sum$2(m),sum$2(r));const g=sub$2(a,i),y=sub$2(a,i),v=mul(s,o);c=mul(mul(v,g),y);const b=greater$2(c,u);u=where(b,c,u),l=where(b,tensor1d([h]),l)}return l}const threshold$2=op({threshold_:threshold_});
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function transform_(e,t,n="nearest",r="constant",a=0,i){const s=convertToTensor(e,"image","transform","float32"),o=convertToTensor(t,"transforms","transform","float32");assert$1(4===s.rank,(()=>`Error in transform: image must be rank 4,but got rank ${s.rank}.`)),assert$1(2===o.rank&&(o.shape[0]===s.shape[0]||1===o.shape[0])&&8===o.shape[1],(()=>"Error in transform: Input transform should be batch x 8 or 1 x 8")),assert$1(null==i||2===i.length,(()=>`Error in transform: outputShape must be [height, width] or null, but got ${i}.`));const l={image:s,transforms:o},u={interpolation:n,fillMode:r,fillValue:a,outputShape:i};return ENGINE.runKernel(Transform,l,u)}const transform$3=op({transform_:transform_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function bandPart_(e,t,n){const r=convertToTensor(e,"a","bandPart");assert$1(r.rank>=2,(()=>`bandPart(): Rank must be at least 2, got ${r.rank}.`));const a=r.shape,[i,s]=r.shape.slice(-2);let o,l;"number"==typeof t?(assert$1(t%1==0,(()=>`bandPart(): numLower must be an integer, got ${t}.`)),assert$1(t<=i,(()=>`bandPart(): numLower (${t}) must not be greater than the number of rows (${i}).`)),o=convertToTensor(t<0?i:t,"numLower","bandPart")):(assert$1("int32"===t.dtype,(()=>"bandPart(): numLower's dtype must be an int32.")),o=where(less$2(t,0),i,minimum$2(t,i))),"number"==typeof n?(assert$1(n%1==0,(()=>`bandPart(): numUpper must be an integer, got ${n}.`)),assert$1(n<=s,(()=>`bandPart(): numUpper (${n}) must not be greater than the number of columns (${s}).`)),l=convertToTensor(n<0?s:n,"numUpper","bandPart")):(assert$1("int32"===n.dtype,(()=>"bandPart(): numUpper's dtype must be an int32.")),l=where(less$2(n,0),s,minimum$2(n,s)));const u=reshape$2(range$4(0,i,1,"int32"),[-1,1]),c=range$4(0,s,1,"int32"),h=sub$2(u,c),d=logicalAnd$2(lessEqual$2(h,o),greaterEqual$2(h,neg$2(l))),p=zeros$1([i,s],r.dtype);return reshape$2(stack(unstack(reshape$2(r,[-1,i,s])).map((e=>where(d,e,p)))),a)}const bandPart=op({bandPart_:bandPart_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function gramSchmidt_(e){let t;if(Array.isArray(e)){t=!1,assert$1(null!=e&&e.length>0,(()=>"Gram-Schmidt process: input must not be null, undefined, or empty"));const n=e[0].shape[0];for(let t=1;t<e.length;++t)assert$1(e[t].shape[0]===n,(()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${e[t].shape[0]} vs. ${n})`))}else t=!0,e=split$3(e,e.shape[0],0).map((e=>squeeze(e,[0])));assert$1(e.length<=e[0].shape[0],(()=>`Gram-Schmidt: Number of vectors (${e.length}) exceeds number of dimensions (${e[0].shape[0]}).`));const n=[],r=e;for(let a=0;a<e.length;++a)n.push(ENGINE.tidy((()=>{let e=r[a];if(a>0)for(let t=0;t<a;++t){const r=mul(sum$2(mul(n[t],e)),n[t]);e=sub$2(e,r)}return div$1(e,norm(e,"euclidean"))})));return t?stack(n,0):n}const gramSchmidt=op({gramSchmidt_:gramSchmidt_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function qr_(e,t=!1){if(assert$1(e.rank>=2,(()=>`qr() requires input tensor to have a rank >= 2, but got rank ${e.rank}`)),2===e.rank)return qr2d(e,t);{const n=e.shape.slice(0,e.shape.length-2).reduce(((e,t)=>e*t)),r=unstack(reshape$2(e,[n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),a=[],i=[];r.forEach((e=>{const[n,r]=qr2d(e,t);a.push(n),i.push(r)}));return[reshape$2(stack(a,0),e.shape),reshape$2(stack(i,0),e.shape)]}}function qr2d(e,t=!1){return ENGINE.tidy((()=>{assert$1(2===e.shape.length,(()=>`qr2d() requires a 2D Tensor, but got a ${e.shape.length}D Tensor.`));const n=e.shape[0],r=e.shape[1];let a=eye(n),i=clone(e);const s=tensor2d([[1]],[1,1]);let o=clone(s);const l=n>=r?r:n;for(let e=0;e<l;++e){const t=i,l=o,u=a;[o,i,a]=ENGINE.tidy((()=>{const t=slice$2(i,[e,e],[n-e,1]),l=norm(t),u=slice$2(i,[e,e],[1,1]),c=where(greater$2(u,0),tensor2d([[-1]]),tensor2d([[1]])),h=sub$2(u,mul(c,l)),d=div$1(t,h);o=1===d.shape[0]?clone(s):concat$2([s,slice$2(d,[1,0],[d.shape[0]-1,d.shape[1]])],0);const p=neg$2(div$1(matMul$1(c,h),l)),f=slice$2(i,[e,0],[n-e,r]),m=mul(p,o),g=transpose$2(o);if(0===e)i=sub$2(f,matMul$1(m,matMul$1(g,f)));else{const t=sub$2(f,matMul$1(m,matMul$1(g,f)));i=concat$2([slice$2(i,[0,0],[e,r]),t],0)}const y=transpose$2(m),v=slice$2(a,[0,e],[n,a.shape[1]-e]);if(0===e)a=sub$2(v,matMul$1(matMul$1(v,o),y));else{const t=sub$2(v,matMul$1(matMul$1(v,o),y));a=concat$2([slice$2(a,[0,0],[n,e]),t],1)}return[o,i,a]})),dispose([t,l,u])}return!t&&n>r&&(a=slice$2(a,[0,0],[n,r]),i=slice$2(i,[0,0],[r,r])),[a,i]}))}const qr=op({qr_:qr_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var Reduction,Reduction2;function computeWeightedLoss_(e,t,n=Reduction.SUM_BY_NONZERO_WEIGHTS){const r=convertToTensor(e,"losses","computeWeightedLoss");let a=null;null!=t&&(a=convertToTensor(t,"weights","computeWeightedLoss"));const i=null==a?r:mul(r,a);if(n===Reduction.NONE)return i;if(n===Reduction.SUM)return sum$2(i);if(n===Reduction.MEAN){if(null==a)return mean$1(i);{const e=r.size/a.size,t=div$1(sum$2(i),sum$2(a));return e>1?div$1(t,scalar(e)):t}}if(n===Reduction.SUM_BY_NONZERO_WEIGHTS){if(null==a)return div$1(sum$2(i),scalar(r.size));{const e=mul(a,ones(r.shape)),t=cast$3(sum$2(notEqual$2(e,scalar(0))),"float32");return div$1(sum$2(i),t)}}throw Error(`Unknown reduction: ${n}`)}Reduction2=Reduction||(Reduction={}),Reduction2[Reduction2.NONE=0]="NONE",Reduction2[Reduction2.MEAN=1]="MEAN",Reduction2[Reduction2.SUM=2]="SUM",Reduction2[Reduction2.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS";const computeWeightedLoss$1=op({computeWeightedLoss_:computeWeightedLoss_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function absoluteDifference_(e,t,n,r=Reduction.SUM_BY_NONZERO_WEIGHTS){const a=convertToTensor(e,"labels","absoluteDifference"),i=convertToTensor(t,"predictions","absoluteDifference");let s=null;null!=n&&(s=convertToTensor(n,"weights","absoluteDifference")),assertShapesMatch(a.shape,i.shape,"Error in absoluteDifference: ");const o=abs$2(sub$2(a,i));return computeWeightedLoss$1(o,s,r)}const absoluteDifference=op({absoluteDifference_:absoluteDifference_});function cosineDistance_(e,t,n,r,a=Reduction.SUM_BY_NONZERO_WEIGHTS){const i=convertToTensor(e,"labels","cosineDistance"),s=convertToTensor(t,"predictions","cosineDistance");let o=null;null!=r&&(o=convertToTensor(r,"weights","cosineDistance")),assertShapesMatch(i.shape,s.shape,"Error in cosineDistance: ");const l=scalar(1),u=sub$2(l,sum$2(mul(i,s),n,!0));return computeWeightedLoss$1(u,o,a)}const cosineDistance=op({cosineDistance_:cosineDistance_});function hingeLoss_(e,t,n,r=Reduction.SUM_BY_NONZERO_WEIGHTS){let a=convertToTensor(e,"labels","hingeLoss");const i=convertToTensor(t,"predictions","hingeLoss");let s=null;null!=n&&(s=convertToTensor(n,"weights","hingeLoss")),assertShapesMatch(a.shape,i.shape,"Error in hingeLoss: ");const o=scalar(1);a=sub$2(mul(scalar(2),a),o);const l=relu$2(sub$2(o,mul(a,i)));return computeWeightedLoss$1(l,s,r)}const hingeLoss=op({hingeLoss_:hingeLoss_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function huberLoss_(e,t,n,r=1,a=Reduction.SUM_BY_NONZERO_WEIGHTS){const i=convertToTensor(e,"labels","huberLoss"),s=convertToTensor(t,"predictions","huberLoss");let o=null;null!=n&&(o=convertToTensor(n,"weights","huberLoss")),assertShapesMatch(i.shape,s.shape,"Error in huberLoss: ");const l=scalar(r),u=abs$2(sub$2(s,i)),c=minimum$2(u,l),h=sub$2(u,c),d=add$1(mul(scalar(.5),square$2(c)),mul(l,h));return computeWeightedLoss$1(d,o,a)}const huberLoss=op({huberLoss_:huberLoss_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function logLoss_(e,t,n,r=1e-7,a=Reduction.SUM_BY_NONZERO_WEIGHTS){const i=convertToTensor(e,"labels","logLoss"),s=convertToTensor(t,"predictions","logLoss");let o=null;null!=n&&(o=convertToTensor(n,"weights","logLoss")),assertShapesMatch(i.shape,s.shape,"Error in logLoss: ");const l=scalar(1),u=scalar(r),c=neg$2(mul(i,log$4(add$1(s,u)))),h=mul(sub$2(l,i),log$4(add$1(sub$2(l,s),u))),d=sub$2(c,h);return computeWeightedLoss$1(d,o,a)}const logLoss=op({logLoss_:logLoss_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function meanSquaredError_(e,t,n,r=Reduction.SUM_BY_NONZERO_WEIGHTS){const a=convertToTensor(e,"labels","meanSquaredError"),i=convertToTensor(t,"predictions","meanSquaredError");let s=null;null!=n&&(s=convertToTensor(n,"weights","meanSquaredError")),assertShapesMatch(a.shape,i.shape,"Error in meanSquaredError: ");const o=squaredDifference$2(a,i);return computeWeightedLoss$1(o,s,r)}const meanSquaredError$1=op({meanSquaredError_:meanSquaredError_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function sigmoidCrossEntropyWithLogits_(e,t){const n=convertToTensor(e,"labels","sigmoidCrossEntropyWithLogits"),r=convertToTensor(t,"logits","sigmoidCrossEntropyWithLogits");assertShapesMatch(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");const a=relu$2(r),i=mul(r,n),s=log1p$2(exp$2(neg$2(abs$2(r))));return add$1(sub$2(a,i),s)}function sigmoidCrossEntropy_(e,t,n,r=0,a=Reduction.SUM_BY_NONZERO_WEIGHTS){let i=convertToTensor(e,"multiClassLabels","sigmoidCrossEntropy");const s=convertToTensor(t,"logits","sigmoidCrossEntropy");let o=null;if(null!=n&&(o=convertToTensor(n,"weights","sigmoidCrossEntropy")),assertShapesMatch(i.shape,s.shape,"Error in sigmoidCrossEntropy: "),r>0){const e=scalar(r),t=scalar(1),n=scalar(.5);i=add$1(mul(i,sub$2(t,e)),mul(n,e))}const l=sigmoidCrossEntropyWithLogits_(i,s);return computeWeightedLoss$1(l,o,a)}const sigmoidCrossEntropy=op({sigmoidCrossEntropy_:sigmoidCrossEntropy_});
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function softmaxCrossEntropyWithLogits_(e,t,n=-1){if(-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${t.rank} and dim was ${n}`);return customGrad(((e,t,r)=>{const a=logSumExp(t,[n],!0),i=sub$2(cast$3(t,"float32"),a);r([e,i]);const s=neg$2(mul(i,e));return{value:sum$2(s,[n]),gradFunc:(e,t)=>{const[r,a]=t,i=expandShapeToKeepDim(e.shape,[n]);return[mul(reshape$2(e,i),sub$2(cast$3(r,"float32"),exp$2(a))),mul(reshape$2(e,i),sub$2(exp$2(a),cast$3(r,"float32")))]}}}))(e,t)}function softmaxCrossEntropy_(e,t,n,r=0,a=Reduction.SUM_BY_NONZERO_WEIGHTS){let i=convertToTensor(e,"onehotLabels","softmaxCrossEntropy");const s=convertToTensor(t,"logits","softmaxCrossEntropy");let o=null;if(null!=n&&(o=convertToTensor(n,"weights","softmaxCrossEntropy")),assertShapesMatch(i.shape,s.shape,"Error in softmaxCrossEntropy: "),r>0){const e=scalar(r),t=scalar(1),n=scalar(i.shape[1]);i=add$1(mul(i,sub$2(t,e)),div$1(e,n))}const l=softmaxCrossEntropyWithLogits_(i,s);return computeWeightedLoss$1(l,o,a)}const softmaxCrossEntropy=op({softmaxCrossEntropy_:softmaxCrossEntropy_});
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function sparseFillEmptyRows_(e,t,n,r){const a=convertToTensor(e,"indices","sparseFillEmptyRows","int32"),i=convertToTensor(t,"values","sparseFillEmptyRows"),s=convertToTensor(n,"denseShape","sparseFillEmptyRows","int32"),o=convertToTensor(r,"defaultValue","sparseFillEmptyRows",i.dtype);if(2!==a.rank)throw new Error(`Indices should be Tensor2D but received shape\n        ${a.shape}`);if(1!==i.rank)throw new Error(`Values should be Tensor1D but received shape ${i.shape}`);if(1!==s.rank)throw new Error(`Dense shape should be Tensor1D but received shape ${s.shape}`);if(0!==o.rank)throw new Error(`Default value should be a scalar but received shape ${o.shape}`);const l={indices:a,values:i,denseShape:s,defaultValue:o},u=ENGINE.runKernel(SparseFillEmptyRows,l);return{outputIndices:u[0],outputValues:u[1],emptyRowIndicator:u[2],reverseIndexMap:u[3]}}const sparseFillEmptyRows$2=op({sparseFillEmptyRows_:sparseFillEmptyRows_});
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function sparseReshape_(e,t,n){const r=convertToTensor(e,"inputIndices","sparseReshape","int32"),a=convertToTensor(t,"inputShape","sparseReshape","int32"),i=convertToTensor(n,"newShape","sparseReshape","int32");if(2!==r.rank)throw new Error(`Input indices should be Tensor2D but received shape\n        ${r.shape}`);if(1!==a.rank)throw new Error(`Input shape should be Tensor1D but received shape ${a.shape}`);if(1!==i.rank)throw new Error(`New shape should be Tensor1D but received shape ${i.shape}`);const s={inputIndices:r,inputShape:a,newShape:i},o=ENGINE.runKernel(SparseReshape,s);return{outputIndices:o[0],outputShape:o[1]}}const sparseReshape$2=op({sparseReshape_:sparseReshape_});
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function sparseSegmentMean_(e,t,n){const r=convertToTensor(e,"data","sparseSegmentMean"),a=convertToTensor(t,"indices","sparseSegmentMean","int32"),i=convertToTensor(n,"segmentIds","sparseSegmentMean","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.rank)throw new Error(`Indices should be Tensor1D but received shape\n          ${a.shape}`);if(1!==i.rank)throw new Error(`Segment ids should be Tensor1D but received shape\n          ${i.shape}`);const s={data:r,indices:a,segmentIds:i};return ENGINE.runKernel(SparseSegmentMean,s)}const sparseSegmentMean$2=op({sparseSegmentMean_:sparseSegmentMean_});
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function sparseSegmentSum_(e,t,n){const r=convertToTensor(e,"data","sparseSegmentSum"),a=convertToTensor(t,"indices","sparseSegmentSum","int32"),i=convertToTensor(n,"segmentIds","sparseSegmentSum","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.rank)throw new Error(`Indices should be Tensor1D but received shape\n         ${a.shape}`);if(1!==i.rank)throw new Error(`Segment ids should be Tensor1D but received shape\n         ${i.shape}`);const s={data:r,indices:a,segmentIds:i};return ENGINE.runKernel(SparseSegmentSum,s)}const sparseSegmentSum$2=op({sparseSegmentSum_:sparseSegmentSum_});
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function stringNGrams_(e,t,n,r,a,i,s,o){const l=convertToTensor(e,"data","stringNGrams","string");if("string"!==l.dtype)throw new Error("Data must be of datatype string");if(1!==l.shape.length)throw new Error(`Data must be a vector, saw: ${l.shape}`);const u=convertToTensor(t,"dataSplits","stringNGrams");if("int32"!==u.dtype)throw new Error("Data splits must be of datatype int32");const c={separator:n,nGramWidths:r,leftPad:a,rightPad:i,padWidth:s,preserveShortSequences:o},h={data:l,dataSplits:u},d=ENGINE.runKernel(StringNGrams,h,c);return{nGrams:d[0],nGramsSplits:d[1]}}const stringNGrams$2=op({stringNGrams_:stringNGrams_});
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function stringSplit_(e,t,n=!0){const r=convertToTensor(e,"input","stringSplit","string"),a=convertToTensor(t,"delimiter","stringSplit","string");if(1!==r.rank)throw new Error(`Input should be Tensor1D but received shape ${r.shape}`);if(0!==a.rank)throw new Error(`Delimiter should be a scalar but received shape ${a.shape}`);const i={skipEmpty:n},s={input:r,delimiter:a},o=ENGINE.runKernel(StringSplit,s,i);return{indices:o[0],values:o[1],shape:o[2]}}const stringSplit$2=op({stringSplit_:stringSplit_});
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function stringToHashBucketFast_(e,t){const n=convertToTensor(e,"input","stringToHashBucketFast","string"),r={numBuckets:t};if(t<=0)throw new Error("Number of buckets must be at least 1");const a={input:n};return ENGINE.runKernel(StringToHashBucketFast,a,r)}const stringToHashBucketFast$2=op({stringToHashBucketFast_:stringToHashBucketFast_});
/**
     * @license
     * Copyright 2023 Google LLC.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function staticRegexReplace_(e,t,n,r=!0){const a=convertToTensor(e,"input","staticRegexReplace","string"),i={pattern:t,rewrite:n,replaceGlobal:r};return ENGINE.runKernel(StaticRegexReplace,{x:a},i)}const staticRegexReplace$2=op({staticRegexReplace_:staticRegexReplace_}),spectral$1={fft:fft$2,ifft:ifft$2,rfft:rfft,irfft:irfft},signal={hammingWindow:hammingWindow,hannWindow:hannWindow,frame:frame,stft:stft},image$1={flipLeftRight:flipLeftRight,grayscaleToRGB:grayscaleToRGB,resizeNearestNeighbor:resizeNearestNeighbor$2,resizeBilinear:resizeBilinear$3,rgbToGrayscale:rgbToGrayscale,rotateWithOffset:rotateWithOffset,cropAndResize:cropAndResize$3,nonMaxSuppression:nonMaxSuppression,nonMaxSuppressionAsync:nonMaxSuppressionAsync,nonMaxSuppressionWithScore:nonMaxSuppressionWithScore,nonMaxSuppressionWithScoreAsync:nonMaxSuppressionWithScoreAsync,nonMaxSuppressionPadded:nonMaxSuppressionPadded,nonMaxSuppressionPaddedAsync:nonMaxSuppressionPaddedAsync,threshold:threshold$2,transform:transform$3},linalg={bandPart:bandPart,gramSchmidt:gramSchmidt,qr:qr},losses={absoluteDifference:absoluteDifference,computeWeightedLoss:computeWeightedLoss$1,cosineDistance:cosineDistance,hingeLoss:hingeLoss,huberLoss:huberLoss,logLoss:logLoss,meanSquaredError:meanSquaredError$1,sigmoidCrossEntropy:sigmoidCrossEntropy,softmaxCrossEntropy:softmaxCrossEntropy},sparse$1={sparseFillEmptyRows:sparseFillEmptyRows$2,sparseReshape:sparseReshape$2,sparseSegmentMean:sparseSegmentMean$2,sparseSegmentSum:sparseSegmentSum$2},string$1={stringNGrams:stringNGrams$2,stringSplit:stringSplit$2,stringToHashBucketFast:stringToHashBucketFast$2,staticRegexReplace:staticRegexReplace$2},GLOBAL_CUSTOM_OBJECT=new Map,GLOBAL_CUSTOM_NAMES=new Map;
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class Serializable{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}}class SerializationMap{constructor(){this.classNameMap={}}static getMap(){return null==SerializationMap.instance&&(SerializationMap.instance=new SerializationMap),SerializationMap.instance}static register(e){SerializationMap.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function registerClass(e,t,n){assert$1(null!=e.className,(()=>"Class being registered does not have the static className property defined.")),assert$1("string"==typeof e.className,(()=>"className is required to be a string, but got type "+typeof e.className)),assert$1(e.className.length>0,(()=>"Class being registered has an empty-string as its className, which is disallowed.")),void 0===t&&(t="Custom"),void 0===n&&(n=e.className);const r=t+">"+n;return SerializationMap.register(e),GLOBAL_CUSTOM_OBJECT.set(r,e),GLOBAL_CUSTOM_NAMES.set(e,r),e}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class Optimizer extends Serializable{minimize(e,t=!1,n){const{value:r,grads:a}=this.computeGradients(e,n);if(null!=n){const e=n.map((e=>({name:e.name,tensor:a[e.name]})));this.applyGradients(e)}else this.applyGradients(a);return dispose(a),t?r:(r.dispose(),null)}get iterations(){return null==this.iterations_&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return variableGrads(e,t)}dispose(){null!=this.iterations_&&dispose(this.iterations_)}async saveIterations(){return null==this.iterations_&&(this.iterations_=0),{name:"iter",tensor:scalar(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(Optimizer,Symbol.hasInstance,{value:e=>null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients});
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
class AdadeltaOptimizer extends Optimizer{static get className(){return"Adadelta"}constructor(e,t,n=null){super(),this.learningRate=e,this.rho=t,this.epsilon=n,this.accumulatedGrads=[],this.accumulatedUpdates=[],null==n&&(this.epsilon=ENGINE.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map((e=>e.name)):Object.keys(e)).forEach(((t,n)=>{const r=ENGINE.registeredVariables[t];null==this.accumulatedGrads[n]&&(this.accumulatedGrads[n]={originalName:`${t}/accum_grad`,variable:tidy((()=>zerosLike$2(r).variable(false)))}),null==this.accumulatedUpdates[n]&&(this.accumulatedUpdates[n]={originalName:`${t}/accum_var`,variable:tidy((()=>zerosLike$2(r).variable(false)))});const a=Array.isArray(e)?e[n].tensor:e[t];if(null==a)return;const i=this.accumulatedGrads[n].variable,s=this.accumulatedUpdates[n].variable;tidy((()=>{const e=add$1(mul(i,this.rho),mul(square$2(a),1-this.rho)),t=mul(div$1(sqrt$2(add$1(s,this.epsilon)),sqrt$2(add$1(i,this.epsilon))),a),n=add$1(mul(s,this.rho),mul(square$2(t),1-this.rho));i.assign(e),s.assign(n);const o=add$1(mul(t,-this.learningRate),r);r.assign(o)}))})),this.incrementIterations()}dispose(){null!=this.accumulatedUpdates&&(dispose(this.accumulatedGrads.map((e=>e.variable))),dispose(this.accumulatedUpdates.map((e=>e.variable))))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map((e=>({name:e.originalName,tensor:e.variable}))))}async setWeights(e){const t=(e=await this.extractIterations(e)).length/2;this.accumulatedGrads=e.slice(0,t).map((e=>({originalName:e.name,variable:e.tensor.variable(false)}))),this.accumulatedUpdates=e.slice(t,2*t).map((e=>({originalName:e.name,variable:e.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class AdagradOptimizer extends Optimizer{static get className(){return"Adagrad"}constructor(e,t=.1){super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map((e=>e.name)):Object.keys(e)).forEach(((t,n)=>{const r=ENGINE.registeredVariables[t];if(null==this.accumulatedGrads[n]){const e=!1;this.accumulatedGrads[n]={originalName:`${t}/accumulator`,variable:tidy((()=>fill$2(r.shape,this.initialAccumulatorValue).variable(e)))}}const a=Array.isArray(e)?e[n].tensor:e[t];if(null==a)return;const i=this.accumulatedGrads[n].variable;tidy((()=>{const e=add$1(i,square$2(a));i.assign(e);const t=add$1(mul(div$1(a,sqrt$2(add$1(e,ENGINE.backend.epsilon()))),-this.learningRate),r);r.assign(t)}))})),this.incrementIterations()}dispose(){null!=this.accumulatedGrads&&dispose(this.accumulatedGrads.map((e=>e.variable)))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map((e=>({name:e.originalName,tensor:e.variable}))))}async setWeights(e){e=await this.extractIterations(e);this.accumulatedGrads=e.map((e=>({originalName:e.name,variable:e.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class AdamOptimizer extends Optimizer{static get className(){return"Adam"}constructor(e,t,n,r=null){super(),this.learningRate=e,this.beta1=t,this.beta2=n,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],tidy((()=>{this.accBeta1=scalar(t).variable(),this.accBeta2=scalar(n).variable()})),null==r&&(this.epsilon=ENGINE.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map((e=>e.name)):Object.keys(e);tidy((()=>{const n=sub$2(1,this.accBeta1),r=sub$2(1,this.accBeta2);t.forEach(((t,a)=>{const i=ENGINE.registeredVariables[t];null==this.accumulatedFirstMoment[a]&&(this.accumulatedFirstMoment[a]={originalName:`${t}/m`,variable:tidy((()=>zerosLike$2(i).variable(false)))}),null==this.accumulatedSecondMoment[a]&&(this.accumulatedSecondMoment[a]={originalName:`${t}/v`,variable:tidy((()=>zerosLike$2(i).variable(false)))});const s=Array.isArray(e)?e[a].tensor:e[t];if(null==s)return;const o=this.accumulatedFirstMoment[a].variable,l=this.accumulatedSecondMoment[a].variable,u=add$1(mul(o,this.beta1),mul(s,1-this.beta1)),c=add$1(mul(l,this.beta2),mul(square$2(s),1-this.beta2)),h=div$1(u,n),d=div$1(c,r);o.assign(u),l.assign(c);const p=add$1(mul(div$1(h,add$1(sqrt$2(d),this.epsilon)),-this.learningRate),i);i.assign(p)})),this.accBeta1.assign(mul(this.accBeta1,this.beta1)),this.accBeta2.assign(mul(this.accBeta2,this.beta2))})),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&dispose(this.accumulatedFirstMoment.map((e=>e.variable))),null!=this.accumulatedSecondMoment&&dispose(this.accumulatedSecondMoment.map((e=>e.variable)))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map((e=>({name:e.originalName,tensor:e.variable}))))}async setWeights(e){e=await this.extractIterations(e),tidy((()=>{this.accBeta1.assign(pow$2(this.beta1,this.iterations_+1)),this.accBeta2.assign(pow$2(this.beta2,this.iterations_+1))}));const t=e.length/2;this.accumulatedFirstMoment=e.slice(0,t).map((e=>({originalName:e.name,variable:e.tensor.variable(false)}))),this.accumulatedSecondMoment=e.slice(t,2*t).map((e=>({originalName:e.name,variable:e.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class AdamaxOptimizer extends Optimizer{static get className(){return"Adamax"}constructor(e,t,n,r=null,a=0){super(),this.learningRate=e,this.beta1=t,this.beta2=n,this.epsilon=r,this.decay=a,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],tidy((()=>{this.iteration=scalar(0).variable(),this.accBeta1=scalar(t).variable()})),null==r&&(this.epsilon=ENGINE.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map((e=>e.name)):Object.keys(e);tidy((()=>{const n=sub$2(1,this.accBeta1),r=div$1(-this.learningRate,add$1(mul(this.iteration,this.decay),1));t.forEach(((t,a)=>{const i=ENGINE.registeredVariables[t];null==this.accumulatedFirstMoment[a]&&(this.accumulatedFirstMoment[a]={originalName:`${t}/m`,variable:zerosLike$2(i).variable(false)}),null==this.accumulatedWeightedInfNorm[a]&&(this.accumulatedWeightedInfNorm[a]={originalName:`${t}/v`,variable:zerosLike$2(i).variable(false)});const s=Array.isArray(e)?e[a].tensor:e[t];if(null==s)return;const o=this.accumulatedFirstMoment[a].variable,l=this.accumulatedWeightedInfNorm[a].variable,u=add$1(mul(o,this.beta1),mul(s,1-this.beta1)),c=mul(l,this.beta2),h=abs$2(s),d=maximum$2(c,h);o.assign(u),l.assign(d);const p=add$1(mul(div$1(r,n),div$1(u,add$1(d,this.epsilon))),i);i.assign(p)})),this.iteration.assign(add$1(this.iteration,1)),this.accBeta1.assign(mul(this.accBeta1,this.beta1))})),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&dispose(this.accumulatedFirstMoment.map((e=>e.variable))),null!=this.accumulatedWeightedInfNorm&&dispose(this.accumulatedWeightedInfNorm.map((e=>e.variable)))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class SGDOptimizer extends Optimizer{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map((e=>e.name)):Object.keys(e)).forEach(((t,n)=>{const r=Array.isArray(e)?e[n].tensor:e[t];if(null==r)return;const a=ENGINE.registeredVariables[t];tidy((()=>{const e=add$1(mul(this.c,r),a);a.assign(e)}))})),this.incrementIterations()}setLearningRate(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=keep(scalar(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(0!==(e=await this.extractIterations(e)).length)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class MomentumOptimizer extends SGDOptimizer{static get className(){return"Momentum"}constructor(e,t,n=!1){super(e),this.learningRate=e,this.momentum=t,this.useNesterov=n,this.accumulations=[],this.m=scalar(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map((e=>e.name)):Object.keys(e)).forEach(((t,n)=>{const r=ENGINE.registeredVariables[t];if(null==this.accumulations[n]){const e=!1;this.accumulations[n]={originalName:`${t}/momentum`,variable:tidy((()=>zerosLike$2(r).variable(e)))}}const a=this.accumulations[n].variable,i=Array.isArray(e)?e[n].tensor:e[t];null!=i&&tidy((()=>{let e;const t=add$1(mul(this.m,a),i);e=this.useNesterov?add$1(mul(this.c,add$1(i,mul(t,this.m))),r):add$1(mul(this.c,t),r),a.assign(t),r.assign(e)}))})),this.incrementIterations()}dispose(){this.m.dispose(),null!=this.accumulations&&dispose(this.accumulations.map((e=>e.variable)))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map((e=>({name:e.originalName,tensor:e.variable}))))}async setWeights(e){e=await this.extractIterations(e);this.accumulations=e.map((e=>({originalName:e.name,variable:e.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class RMSPropOptimizer extends Optimizer{static get className(){return"RMSProp"}constructor(e,t=.9,n=0,r=null,a=!1){if(super(),this.learningRate=e,this.decay=t,this.momentum=n,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=a,null==r&&(this.epsilon=ENGINE.backend.epsilon()),null==e)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map((e=>e.name)):Object.keys(e)).forEach(((t,n)=>{const r=ENGINE.registeredVariables[t],a=!1;null==this.accumulatedMeanSquares[n]&&(this.accumulatedMeanSquares[n]={originalName:`${t}/rms`,variable:tidy((()=>zerosLike$2(r).variable(a)))}),null==this.accumulatedMoments[n]&&(this.accumulatedMoments[n]={originalName:`${t}/momentum`,variable:tidy((()=>zerosLike$2(r).variable(a)))}),null==this.accumulatedMeanGrads[n]&&this.centered&&(this.accumulatedMeanGrads[n]={originalName:`${t}/mg`,variable:tidy((()=>zerosLike$2(r).variable(a)))});const i=Array.isArray(e)?e[n].tensor:e[t];if(null==i)return;const s=this.accumulatedMeanSquares[n].variable,o=this.accumulatedMoments[n].variable;tidy((()=>{const e=add$1(mul(s,this.decay),mul(square$2(i),1-this.decay));if(this.centered){const t=this.accumulatedMeanGrads[n].variable,a=add$1(mul(t,this.decay),mul(i,1-this.decay)),l=div$1(mul(i,this.learningRate),sqrt$2(sub$2(e,add$1(square$2(a),this.epsilon)))),u=add$1(mul(o,this.momentum),l);s.assign(e),t.assign(a),o.assign(u);const c=sub$2(r,u);r.assign(c)}else{const e=add$1(mul(s,this.decay),mul(square$2(i),1-this.decay)),t=add$1(mul(o,this.momentum),div$1(mul(i,this.learningRate),sqrt$2(add$1(e,this.epsilon))));s.assign(e),o.assign(t);const n=sub$2(r,t);r.assign(n)}}))})),this.incrementIterations()}dispose(){null!=this.accumulatedMeanSquares&&dispose(this.accumulatedMeanSquares.map((e=>e.variable))),null!=this.accumulatedMeanGrads&&this.centered&&dispose(this.accumulatedMeanGrads.map((e=>e.variable))),null!=this.accumulatedMoments&&dispose(this.accumulatedMoments.map((e=>e.variable)))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map((e=>({name:e.originalName,tensor:e.variable}))))}async setWeights(e){e=await this.extractIterations(e);const t=this.centered?e.length/3:e.length/2,n=!1;this.accumulatedMeanSquares=e.slice(0,t).map((e=>({originalName:e.name,variable:e.tensor.variable(n)}))),this.accumulatedMoments=e.slice(t,2*t).map((e=>({originalName:e.name,variable:e.tensor.variable(n)}))),this.centered&&(this.accumulatedMeanGrads=e.slice(2*t,3*t).map((e=>({originalName:e.name,variable:e.tensor.variable(n)}))))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}
/**
     * @license
     * Copyright 2022 Google LLC.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const OPTIMIZERS=[AdadeltaOptimizer,AdagradOptimizer,AdamOptimizer,AdamaxOptimizer,MomentumOptimizer,RMSPropOptimizer,SGDOptimizer];function registerOptimizers(){for(const e of OPTIMIZERS)registerClass(e)}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const DEFAULT_FILE_NAME_PREFIX="model",DEFAULT_JSON_EXTENSION_NAME=".json",DEFAULT_WEIGHT_DATA_EXTENSION_NAME=".weights.bin";function defer(e){return new Promise((e=>setTimeout(e))).then(e)}class BrowserDownloads{constructor(e){if(!env().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(BrowserDownloads.URL_SCHEME)&&(e=e.slice(BrowserDownloads.URL_SCHEME.length)),null!=e&&0!==e.length||(e=DEFAULT_FILE_NAME_PREFIX),this.modelJsonFileName=e+DEFAULT_JSON_EXTENSION_NAME,this.weightDataFileName=e+DEFAULT_WEIGHT_DATA_EXTENSION_NAME}async save(e){if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");const t=CompositeArrayBuffer.join(e.weightData),n=window.URL.createObjectURL(new Blob([t],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const t=getModelJSONForModelArtifacts(e,[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}]),r=window.URL.createObjectURL(new Blob([JSON.stringify(t)],{type:"application/json"})),a=null==this.modelJsonAnchor?document.createElement("a"):this.modelJsonAnchor;if(a.download=this.modelJsonFileName,a.href=r,await defer((()=>a.dispatchEvent(new MouseEvent("click")))),null!=e.weightData){const e=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor;e.download=this.weightDataFileName,e.href=n,await defer((()=>e.dispatchEvent(new MouseEvent("click"))))}return{modelArtifactsInfo:getModelArtifactsInfoForJSON(e)}}}}BrowserDownloads.URL_SCHEME="downloads://";class BrowserFiles{constructor(e){if(null==e||e.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${e}`);this.jsonFile=e[0],this.weightsFiles=e.slice(1)}async load(){return new Promise(((e,t)=>{const n=new FileReader;n.onload=n=>{const r=JSON.parse(n.target.result),a=r.modelTopology;if(null==a)return void t(new Error(`modelTopology field is missing from file ${this.jsonFile.name}`));if(null==r.weightsManifest)return void t(new Error(`weightManifest field is missing from file ${this.jsonFile.name}`));if(0===this.weightsFiles.length)return void e({modelTopology:a});const i=getModelArtifactsForJSON(r,(e=>this.loadWeights(e)));e(i)},n.onerror=e=>t(`Failed to read model topology and weights manifest JSON from file '${this.jsonFile.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),n.readAsText(this.jsonFile)}))}loadWeights(e){const t=[],n=[];for(const i of e)t.push(...i.weights),n.push(...i.paths);const r=this.checkManifestAndWeightFiles(e),a=n.map((e=>this.loadWeightsFile(e,r[e])));return Promise.all(a).then((e=>[t,e]))}loadWeightsFile(e,t){return new Promise(((n,r)=>{const a=new FileReader;a.onload=e=>{const t=e.target.result;n(t)},a.onerror=t=>r(`Failed to weights data from file of path '${e}'.`),a.readAsArrayBuffer(t)}))}checkManifestAndWeightFiles(e){const t=[],n=this.weightsFiles.map((e=>basename(e.name))),r={};for(const a of e)a.paths.forEach((e=>{const a=basename(e);if(-1!==t.indexOf(a))throw new Error(`Duplicate file basename found in weights manifest: '${a}'`);if(t.push(a),-1===n.indexOf(a))throw new Error(`Weight file with basename '${a}' is not provided.`);r[e]=this.weightsFiles[n.indexOf(a)]}));if(t.length!==this.weightsFiles.length)throw new Error(`Mismatch in the number of files in weights manifest (${t.length}) and the number of weight files provided (${this.weightsFiles.length}).`);return r}}const browserDownloadsRouter=e=>env().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(BrowserDownloads.URL_SCHEME)?browserDownloads(e.slice(BrowserDownloads.URL_SCHEME.length)):null;function browserDownloads(e="model"){return new BrowserDownloads(e)}function browserFiles(e){return new BrowserFiles(e)}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function monitorPromisesProgress(e,t,n,r){var a,i,s;assert$1(null!=(a=e)&&Array.isArray(a)&&a.length>0,(()=>"promises must be a none empty array")),s=r=null==r?1:r,assert$1((i=n=null==n?0:n)>=0&&i<=1,(()=>`Progress fraction must be in range [0, 1], but got startFraction ${i}`)),assert$1(s>=0&&s<=1,(()=>`Progress fraction must be in range [0, 1], but got endFraction ${s}`)),assert$1(s>=i,(()=>`startFraction must be no more than endFraction, but got startFraction ${i} and endFraction ${s}`));let o=0;return Promise.all(e.map((a=>(a.then((a=>{const i=n+ ++o/e.length*(r-n);return t(i),a})),a))))}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */async function loadWeightsAsArrayBuffer(e,t){null==t&&(t={});const n=null==t.fetchFunc?env().platform.fetch:t.fetchFunc,r=e.map((e=>n(e,t.requestInit,{isBinary:!0}))),a=(null==t.onProgress?await Promise.all(r):await monitorPromisesProgress(r,t.onProgress,0,.5)).map((e=>e.arrayBuffer()));return null==t.onProgress?await Promise.all(a):await monitorPromisesProgress(a,t.onProgress,.5,1)}async function loadWeights(e,t="",n,r){return weightsLoaderFactory((e=>loadWeightsAsArrayBuffer(e,{requestInit:r})))(e,t,n)}function weightsLoaderFactory(e){return async(t,n="",r)=>{const a=t.map((()=>!1)),i={},s=null!=r?r.map((()=>!1)):[],o=[];if(t.forEach(((e,t)=>{let n=0;e.weights.forEach((e=>{const l="quantization"in e?e.quantization.dtype:e.dtype,u=DTYPE_VALUE_SIZE_MAP[l]*sizeFromShape(e.shape),c=()=>{a[t]=!0,null==i[t]&&(i[t]=[]),i[t].push({manifestEntry:e,groupOffset:n,sizeBytes:u})};null!=r?r.forEach(((t,n)=>{t===e.name&&(c(),s[n]=!0)})):c(),o.push(e.name),n+=u}))})),!s.every((e=>e))){const e=r.filter(((e,t)=>!s[t]));throw new Error(`Could not find weights in manifest with names: ${e.join(", ")}. \nManifest JSON has weights with names: ${o.join(", ")}.`)}const l=a.reduce(((e,t,n)=>(t&&e.push(n),e)),[]),u=[];l.forEach((e=>{t[e].paths.forEach((e=>{const t=n+(n.endsWith("/")?"":"/")+e;u.push(t)}))}));const c=await e(u),h={};let d=0;return l.forEach((e=>{const n=t[e].paths.length,r=new CompositeArrayBuffer(c.slice(d,d+n));i[e].forEach((e=>{const t=decodeWeights(r.slice(e.groupOffset,e.groupOffset+e.sizeBytes),[e.manifestEntry]);for(const n in t)h[n]=t[n]})),d+=n})),h}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */IORouterRegistry.registerSaveRouter(browserDownloadsRouter);const OCTET_STREAM_MIME_TYPE="application/octet-stream",JSON_TYPE="application/json";class HTTPRequest{constructor(e,t){if(this.DEFAULT_METHOD="POST",null==t&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,this.weightUrlConverter=t.weightUrlConverter,null!=t.fetchFunc?(assert$1("function"==typeof t.fetchFunc,(()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)")),this.fetch=t.fetchFunc):this.fetch=env().platform.fetch,assert$1(null!=e&&e.length>0,(()=>"URL path for http must not be null, undefined or empty.")),Array.isArray(e)&&assert$1(2===e.length,(()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`)),this.path=e,null!=t.requestInit&&null!=t.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData;const n=getModelJSONForModelArtifacts(e,[{paths:["./model.weights.bin"],weights:e.weightSpecs}]);if(t.body.append("model.json",new Blob([JSON.stringify(n)],{type:JSON_TYPE}),"model.json"),null!=e.weightData){const n=CompositeArrayBuffer.join(e.weightData);t.body.append("model.weights.bin",new Blob([n],{type:OCTET_STREAM_MIME_TYPE}),"model.weights.bin")}const r=await this.fetch(this.path,t);if(r.ok)return{modelArtifactsInfo:getModelArtifactsInfoForJSON(e),responses:[r]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${r.status}.`)}async load(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let t;try{t=await e.json()}catch(e2){let t=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?t+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":t+=" Please make sure the server is serving valid JSON for this request.",new Error(t)}const n=t.modelTopology,r=t.weightsManifest;if(null==n&&null==r)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return getModelArtifactsForJSON(t,(e=>this.loadWeights(e)))}async loadWeights(e){const t=Array.isArray(this.path)?this.path[1]:this.path,[n,r]=parseUrl$1(t),a=this.weightPathPrefix||n,i=getWeightSpecs(e),s=[],o=[];for(const l of e)for(const e of l.paths)null!=this.weightUrlConverter?o.push(this.weightUrlConverter(e)):s.push(a+e+r);this.weightUrlConverter&&s.push(...await Promise.all(o));return[i,await loadWeightsAsArrayBuffer(s,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})]}}function parseUrl$1(e){const t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}function isHTTPScheme(e){return null!=e.match(HTTPRequest.URL_SCHEME_REGEX)}HTTPRequest.URL_SCHEME_REGEX=/^https?:\/\//;const httpRouter=(e,t)=>{if("undefined"==typeof fetch&&(null==t||null==t.fetchFunc))return null;{let n=!0;if(n=Array.isArray(e)?e.every((e=>isHTTPScheme(e))):isHTTPScheme(e),n)return http(e,t)}return null};function http(e,t){return new HTTPRequest(e,t)}function browserHTTPRequest(e,t){return http(e,t)}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */IORouterRegistry.registerSaveRouter(httpRouter),IORouterRegistry.registerLoadRouter(httpRouter);class PassthroughLoader{constructor(e){this.modelArtifacts=e}load(){return this.modelArtifacts}}class PassthroughSaver{constructor(e){this.saveHandler=e}save(e){return this.saveHandler(e)}}class PassthroughAsync{constructor(e){e.load&&(this.load=()=>Promise.resolve(e.load())),e.save&&(this.save=t=>Promise.resolve(e.save(t)))}}function fromMemory(e,t,n,r){return new PassthroughAsync(fromMemorySync(...arguments))}function fromMemorySync(e,t,n,r){if(1===arguments.length){return null!=e.modelTopology||null!=e.weightSpecs?new PassthroughLoader(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new PassthroughLoader({modelTopology:e}))}return console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new PassthroughLoader({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r})}function withSaveHandler(e){return new PassthroughSaver(e)}function withSaveHandlerSync(e){return new PassthroughSaver(e)}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const io=Object.freeze(Object.defineProperty({__proto__:null,CompositeArrayBuffer:CompositeArrayBuffer,browserFiles:browserFiles,browserHTTPRequest:browserHTTPRequest,concatenateArrayBuffers:concatenateArrayBuffers,copyModel:copyModel,decodeWeights:decodeWeights,encodeWeights:encodeWeights,fromMemory:fromMemory,fromMemorySync:fromMemorySync,getLoadHandlers:getLoadHandlers,getModelArtifactsForJSON:getModelArtifactsForJSON,getModelArtifactsForJSONSync:getModelArtifactsForJSONSync,getModelArtifactsInfoForJSON:getModelArtifactsInfoForJSON,getSaveHandlers:getSaveHandlers,getWeightSpecs:getWeightSpecs,http:http,isHTTPScheme:isHTTPScheme,listModels:listModels,loadWeights:loadWeights,moveModel:moveModel,registerLoadRouter:registerLoadRouter,registerSaveRouter:registerSaveRouter,removeModel:removeModel,weightsLoaderFactory:weightsLoaderFactory,withSaveHandler:withSaveHandler,withSaveHandlerSync:withSaveHandlerSync},Symbol.toStringTag,{value:"Module"}));
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */let fromPixels2DContext$1;function fromPixels_(e,t=3){if(t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,r=!1,a=!1,i=!1,s=!1,o=!1;if(e.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&e instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement)a=!0;else if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement)i=!0;else if(null!=e.getContext)s=!0;else{if(!("undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap))throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${e.constructor.name}`);o=!0}if(null!=getKernel(FromPixels,ENGINE.backendName)){const n={pixels:e},r={numChannels:t};return ENGINE.runKernel(FromPixels,n,r)}const[l,u]=a?[e.videoWidth,e.videoHeight]:[e.width,e.height];let c,h;if(s)c=e.getContext("2d").getImageData(0,0,l,u).data;else if(r||n)c=e.data;else if(i||a||o){if(null==fromPixels2DContext$1)if("undefined"==typeof document){if("undefined"==typeof OffscreenCanvas||"undefined"==typeof OffscreenCanvasRenderingContext2D)throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");fromPixels2DContext$1=new OffscreenCanvas(1,1).getContext("2d")}else fromPixels2DContext$1=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});fromPixels2DContext$1.canvas.width=l,fromPixels2DContext$1.canvas.height=u,fromPixels2DContext$1.drawImage(e,0,0,l,u),c=fromPixels2DContext$1.getImageData(0,0,l,u).data}if(4===t)h=new Int32Array(c);else{const e=l*u;h=new Int32Array(e*t);for(let n=0;n<e;n++)for(let e=0;e<t;++e)h[n*t+e]=c[4*n+e]}return tensor3d(h,[u,l,t],"int32")}const fromPixels$1=op({fromPixels_:fromPixels_});function prepareAndValidate(e,t){const n=e.shape.length,r=t.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(r<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${r}.`);if("int32"!==t.dtype)throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.shape[r-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${t.shape[r-1]} vs. ${n}`);if(0===sizeFromShape(e.shape))throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${e.shape}.`);const a=t.shape,i=a[a.length-1];let s=1;for(let h=0;h<a.length-1;++h)s*=a[h];const o=e.shape,l=a.slice();l.pop();let u=1;for(let h=i;h<n;++h)u*=o[h],l.push(o[h]);const c=[...computeStrides(e.shape).map((e=>e/u)),1].slice(0,i);return[l,s,u,c]}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const NEW_AXIS=-2,SHRINK_AXIS=-1;function assertParamsValid(e,t,n){const r=e.shape.length;assert$1(r===t.length,(()=>`Error in slice${r}D: Length of begin ${t} must match the rank of the array (${r}).`)),assert$1(r===n.length,(()=>`Error in slice${r}D: Length of size ${n} must match the rank of the array (${r}).`));for(let a=0;a<r;++a)assert$1(t[a]+n[a]<=e.shape[a],(()=>`Error in slice${r}D: begin[${a}] + size[${a}] (${t[a]+n[a]}) would overflow input.shape[${a}] (${e.shape[a]})`))}function maskToAxes(e){const t=[];let n=0;for(;e>0;)1&e&&t.push(n),e/=2,n++;return t}function computeOutShape$2(e,t,n){const r=[];for(let a=0;a<e.length;a++)r[a]=Math.ceil((t[a]-e[a])/n[a]);return r}function stridesWithElidedDims(e,t,n,r){const a=[...e];for(let i=a.length;i<r.length;i++)a.push(1);for(let i=0;i<n;i++)0===i?a[t]=1:(a.splice(t,0,1),a.pop());return a}function unnormalizeAxis(e,t,n){return n<=e?n:n-(t-1)}function getElidedAxes(e,t){const n=[];for(let r=0;r<e;r++)n.push(t+r);return n}function getNormalizedAxes(e,t,n,r,a,i,s,o,l){const u=e.length;let c=new Array(u),h=new Array(u),d=new Array(u);if(t.length&&n>0){const l=t[0],u=n+1;c=startIndicesWithElidedDims(s,l,u,r,e),h=stopIndicesWithElidedDims(o,l,u,a,e),d=stridesWithElidedDims(i,l,u,e)}else for(let p=0;p<u;p++)c[p]=startForAxis(s,r,i,e,p,l),h[p]=stopForAxis(o,a,i,e,p,l),d[p]=stridesForAxis(i,p,l);return{begin:c,end:h,strides:d}}function startIndicesWithElidedDims(e,t,n,r,a){const i=[...a],s=getElidedAxes(n,t);for(let o=0;o<i.length;o++)if(s.indexOf(o)>-1)i[o]=0;else{const a=unnormalizeAxis(t,n,o);let s=r[a];e&1<<a&&(s=0),i[o]=s}return i}function stopIndicesWithElidedDims(e,t,n,r,a){const i=[...a],s=getElidedAxes(n,t);for(let o=0;o<i.length;o++)if(s.indexOf(o)>-1)i[o]=Number.MAX_SAFE_INTEGER;else{const a=unnormalizeAxis(t,n,o);let s=r[a];e&1<<a&&(s=Number.MAX_SAFE_INTEGER),i[o]=s}for(let o=0;o<i.length;o++){const e=a[o];i[o]<0&&(i[o]+=e),i[o]=clamp$1(0,i[o],a[o])}return i}function stridesForAxis(e,t,n){let r=e[t];return(n&1<<t||null==r)&&(r=1),r}function startForAxis(e,t,n,r,a,i){let s=t[a];const o=n[a]||1;(e&1<<a||i&1<<a||null==s)&&(s=o>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);const l=r[a];return s<0&&(s+=l),s=clamp$1(0,s,l-1),s}function stopForAxis(e,t,n,r,a,i){let s=t[a];const o=n[a]||1;(e&1<<a||i&1<<a||null==s)&&(s=o>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);const l=r[a];return s<0&&(s+=l),s=o>0?clamp$1(0,s,l):clamp$1(-1,s,l-1),s}function isSliceContinous(e,t,n){let r=n.length;for(let a=0;a<n.length;a++)if(n[a]>1){r=a;break}for(let a=r+1;a<n.length;a++)if(t[a]>0||n[a]!==e[a])return!1;return!0}function computeFlatOffset(e,t){let n=e.length>0?e[e.length-1]:1;for(let r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function parseSliceParams(e,t,n){let r;const a=e.shape.length;let i;return r="number"==typeof t?[t,...new Array(a-1).fill(0)]:t.length<a?t.concat(new Array(a-t.length).fill(0)):t.slice(),r.forEach((e=>{assert$1(-1!==e,(()=>"slice() does not support negative begin indexing."))})),i=null==n?new Array(a).fill(-1):"number"==typeof n?[n,...new Array(a-1).fill(-1)]:n.length<a?n.concat(new Array(a-n.length).fill(-1)):n,i=i.map(((t,n)=>t>=0?t:(assert$1(-1===t,(()=>`Negative size values should be exactly -1 but got ${t} for the slice() size at index ${n}.`)),e.shape[n]-r[n]))),[r,i]}function sliceInfo(e,t,n,r,a,i,s,o,l){let u;if(null==r?(u=new Array(t.length),u.fill(1)):u=r,null!=s&&0!=(s&s-1))throw new Error("Multiple ellipses in slice is not allowed.");let c=!1;const h={dims:u.length,numAddAxisAfterEllipsis:0,begin:t.slice(),end:n.slice(),strides:u.slice(),beginMask:a,endMask:i,ellipsisMask:s,newAxisMask:o,shrinkAxisMask:l};for(let v=0;v<h.dims;v++)c&&0!=(1<<v&o)&&h.numAddAxisAfterEllipsis++,1<<v&s&&(c=!0);c||(h.ellipsisMask|=1<<h.dims,h.dims++);const d={dims:e.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};buildDenseSpec(h,d);let p=!0,f=!0,m=!0;const g=[],y=[];for(let v=0;v<e.length;++v){if(0===d.strides[v])throw Error(`strides[${v}] must be non-zero`);const t=!!(d.shrinkAxisMask&1<<v),n=e[v];if(-1===n){g.push(t?1:-1);continue}const r=[d.beginMask&1<<v,d.endMask&1<<v],a=[d.strides[v]>0?0:-1,d.strides[v]>0?n:n-1];if(t&&d.strides[v]<=0)throw Error("only stride 1 allowed on non-range indexing.");m=m&&1===d.strides[v];const i=!!(d.beginMask&1<<v&&d.endMask&1<<v);if(d.beginValid&&d.endValid){if(t){const e=d.begin[v]<0?n+d.begin[v]:d.begin[v];if(d.begin[v]=e,d.end[v]=d.begin[v]+1,e<0||e>=n)throw Error(`slice index ${d.begin[v]} of dimension ${v} out of bounds.`)}else d.begin[v]=canonical(d.begin[v],0,d.strides[v],n,r,a),d.end[v]=canonical(d.end[v],1,d.strides[v],n,r,a);const e=1===d.strides[v]&&0===d.begin[v]&&d.end[v]===n;p=p&&e,f=f&&(0===v&&1===d.strides[v]||e)}else p=p&&1===d.strides[v]&&i,f=f&&(0===v&&1===d.strides[v]||i);let s,o=!1;if(d.beginValid&&d.endValid?(s=d.end[v]-d.begin[v],o=!0):t?(s=1,o=!0):i&&n>=0&&(s=d.strides[v]<0?-n:n,o=!0),o){let e;e=0===s||s<0!=d.strides[v]<0?0:Math.trunc(s/d.strides[v])+(s%d.strides[v]!=0?1:0),g.push(e)}else g.push(-1)}for(let v=0;v<d.finalShapeGatherIndices.length;++v){const e=d.finalShapeGatherIndices[v];e>=0?y.push(g[e]):e===NEW_AXIS&&y.push(1)}return{finalShapeSparse:y.filter(((e,t)=>d.finalShapeGatherIndices[t]!==NEW_AXIS)),finalShape:y,isIdentity:p,sliceDim0:f,isSimpleSlice:m,begin:d.begin,end:d.end,strides:d.strides}}function buildDenseSpec(e,t){t.beginMask=0,t.endMask=0,t.shrinkAxisMask=0;let n=0;t.beginValid=null!=e.begin,t.endValid=null!=e.end,t.begin=new Array(t.dims),t.end=new Array(t.dims),t.strides=new Array(t.dims),t.finalShapeGatherIndices=[],t.finalShapeGatherIndicesSparse=[],t.inputShapeGatherIndicesSparse=new Array(t.dims);for(let r=0;r<e.dims;r++)if(1<<r&e.ellipsisMask){const a=Math.min(t.dims-(e.dims-r)+1+e.numAddAxisAfterEllipsis,t.dims);for(;n<a;n++)t.begin[n]=0,t.end[n]=0,t.strides[n]=1,t.beginMask|=1<<n,t.endMask|=1<<n,t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(-1),t.inputShapeGatherIndicesSparse[n]=r}else if(1<<r&e.newAxisMask)t.finalShapeGatherIndices.push(NEW_AXIS),t.finalShapeGatherIndicesSparse.push(-1);else{if(n===t.begin.length)throw Error(`Index out of range using input dim ${n}; input has only ${t.dims} dims, ${t.begin.length}.`);null!=e.begin&&(t.begin[n]=e.begin[r]),null!=e.end&&(t.end[n]=e.end[r]),t.strides[n]=e.strides[r],e.beginMask&1<<r&&(t.beginMask|=1<<n),e.endMask&1<<r&&(t.endMask|=1<<n),e.shrinkAxisMask&1<<r?(t.finalShapeGatherIndices.push(SHRINK_AXIS),t.finalShapeGatherIndicesSparse.push(-1),t.shrinkAxisMask|=1<<n):(t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(r)),t.inputShapeGatherIndicesSparse[n]=r,n++}}function canonical(e,t,n,r,a,i){if(a[t])return n>0?i[t]:i[t+1&1];{const t=e<0?r+e:e;return t<i[0]?i[0]:t>i[1]?i[1]:t}}const slice_util=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:assertParamsValid,computeFlatOffset:computeFlatOffset,computeOutShape:computeOutShape$2,getNormalizedAxes:getNormalizedAxes,isSliceContinous:isSliceContinous,maskToAxes:maskToAxes,parseSliceParams:parseSliceParams,sliceInfo:sliceInfo,startForAxis:startForAxis,startIndicesWithElidedDims:startIndicesWithElidedDims,stopForAxis:stopForAxis,stopIndicesWithElidedDims:stopIndicesWithElidedDims,stridesForAxis:stridesForAxis,stridesWithElidedDims:stridesWithElidedDims},Symbol.toStringTag,{value:"Module"}));
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class OptimizerConstructors{static sgd(e){return new SGDOptimizer(e)}static momentum(e,t,n=!1){return new MomentumOptimizer(e,t,n)}static rmsprop(e,t=.9,n=0,r=null,a=!1){return new RMSPropOptimizer(e,t,n,r,a)}static adam(e=.001,t=.9,n=.999,r=null){return new AdamOptimizer(e,t,n,r)}static adadelta(e=.001,t=.95,n=null){return new AdadeltaOptimizer(e,t,n)}static adamax(e=.002,t=.9,n=.999,r=null,a=0){return new AdamaxOptimizer(e,t,n,r,a)}static adagrad(e,t=.1){return new AdagradOptimizer(e,t)}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const train=OptimizerConstructors,delayCallback="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate?setImmediate:e=>e();
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function nextFrame(){return new Promise((e=>delayCallback((()=>e()))))}
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function assertParamsConsistent(e,t){const n=e[0].length;e.forEach(((e,t)=>{assert$1(e.length===n,(()=>`Error in concat${n}D: rank of tensors[${t}] must be the same as the rank of the rest (${n})`))})),assert$1(t>=0&&t<n,(()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`));const r=e[0];e.forEach(((e,a)=>{for(let i=0;i<n;i++)assert$1(i===t||e[i]===r[i],(()=>`Error in concat${n}D: Shape of tensors[${a}] (${e}) does not match the shape of the rest (${r}) along the non-concatenated axis ${a}.`))}))}function computeOutShape$1(e,t){const n=e[0].slice();for(let r=1;r<e.length;r++)n[t]+=e[r][t];return n}
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var RowPartitionType$1,RowPartitionType2;function combineRaggedTensorToTensorShapes(e,t,n){let r=new Array;if(null==n&&null==t)return r;if(null==t)for(;r.length<e+n.length;)r.push(-1);else r=t.slice();if(null==n)return r;if(e+n.length!==r.length)throw new Error(`rt input.shape and shape=${t} are incompatible: rt input.rank = ${e+n.length}, but shape.rank = ${r.length}`);for(let a=1;a<n.length;++a){const i=n[a],s=r[r.length-n.length+a],o=r[s];if(i>=0)if(o>=0){if(o!==i)throw new Error(`rt input.shape and shape=${t} are incompatible: rt input.shape[${a+e}] = ${i} but shape[${a+e}] = ${o}`)}else r[s]=i}return r}function getRowPartitionTypesHelper(e){const t={FIRST_DIM_SIZE:RowPartitionType$1.FIRST_DIM_SIZE,VALUE_ROWIDS:RowPartitionType$1.VALUE_ROWIDS,ROW_LENGTHS:RowPartitionType$1.ROW_LENGTHS,ROW_SPLITS:RowPartitionType$1.ROW_SPLITS,ROW_LIMITS:RowPartitionType$1.ROW_LIMITS,ROW_STARTS:RowPartitionType$1.ROW_STARTS},n=[];for(const r of e){if(!(r in t))break;n.push(t[r])}return n}function getRaggedRank(e){return 0===e.length?0:e[0]===RowPartitionType$1.FIRST_DIM_SIZE?e.length-1:e.length}function validateDefaultValueShape(e,t){if(null==e||null==t)return;const n=e.length,r=t.length;if(n>=r)throw new Error(`defaultValue.shape=${e} and ragged tensor flatValues.shape=${t}, are incompatible: defaultValue.rank = ${n} must be less than ragged tensor input flatValues.rank = ${r})`);for(let a=0;a<Math.min(n,r-1);++a){const n=e[a],r=t[a+1];if(n>=0&&r>=0&&1!==n&&n!==r)throw new Error(`defaultValue.shape=${e}, and ragged tensor input flatValues.shape=${t} are incompatible: defaultValue.shape[${a-e.length}] = ${n} but ragged tensor input.flatValues.shape[${a-e.length}] = ${r}`)}}
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */RowPartitionType2=RowPartitionType$1||(RowPartitionType$1={}),RowPartitionType2[RowPartitionType2.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",RowPartitionType2[RowPartitionType2.VALUE_ROWIDS=1]="VALUE_ROWIDS",RowPartitionType2[RowPartitionType2.ROW_LENGTHS=2]="ROW_LENGTHS",RowPartitionType2[RowPartitionType2.ROW_SPLITS=3]="ROW_SPLITS",RowPartitionType2[RowPartitionType2.ROW_LIMITS=4]="ROW_LIMITS",RowPartitionType2[RowPartitionType2.ROW_STARTS=5]="ROW_STARTS";const PARALLELIZE_THRESHOLD=30;function computeOptimalWindowSize(e){return e<=PARALLELIZE_THRESHOLD?e:nearestDivisor(e,Math.floor(Math.sqrt(e)))}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function getImageCenter(e,t,n){return[n*("number"==typeof e?e:e[0]),t*("number"==typeof e?e:e[1])]}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function getReshaped(e,t,n,r=!0){let a=[];if(r)a=a.concat(t.slice(0)),a.push(e[0]/n),a=a.concat(e.slice(1));else{a=a.concat(e[0]);const n=t.length;for(let r=0;r<n;++r)a=a.concat([e[r+1]/t[r],t[r]]);a=a.concat(e.slice(n+1))}return a}function getPermuted(e,t,n=!0){const r=[];if(n){r.push(t);for(let n=t+1;n<e;++n)n<=2*t?(r.push(n),r.push(n-(t+1))):r.push(n)}else{const n=[],a=[];for(let r=1;r<e;++r)r>=2*t+1||r%2==1?a.push(r):n.push(r);r.push(...n),r.push(0),r.push(...a)}return r}function getReshapedPermuted(e,t,n,r=!0){const a=[];r?a.push(e[0]/n):a.push(e[0]*n);for(let i=1;i<e.length;++i)i<=t.length?r?a.push(t[i-1]*e[i]):a.push(e[i]/t[i-1]):a.push(e[i]);return a}function getSliceBeginCoords(e,t){const n=[0];for(let r=0;r<t;++r)n.push(e[r][0]);return n}function getSliceSize(e,t,n){const r=e.slice(0,1);for(let a=0;a<n;++a)r.push(e[a+1]-t[a][0]-t[a][1]);return r}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const SELU_SCALEALPHA=1.7580993408473768,SELU_SCALE=1.0507009873554805,ERF_P=.3275911,ERF_A1=.254829592,ERF_A2=-.284496736,ERF_A3=1.421413741,ERF_A4=-1.453152027,ERF_A5=1.061405429;
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function mergeRealAndImagArrays(e,t){if(e.length!==t.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${e.length}, imag: ${t.length}.`);const n=new Float32Array(2*e.length);for(let r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function splitRealAndImagArrays(e){const t=new Float32Array(e.length/2),n=new Float32Array(e.length/2);for(let r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}function complexWithEvenIndex(e){const t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t);for(let a=0;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}function complexWithOddIndex(e){const t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t);for(let a=2;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}function getComplexWithIndex(e,t){return{real:e[2*t],imag:e[2*t+1]}}function assignToTypedArray(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function exponents(e,t){const n=new Float32Array(e/2),r=new Float32Array(e/2);for(let a=0;a<Math.ceil(e/2);a++){const i=(t?2:-2)*Math.PI*(a/e);n[a]=Math.cos(i),r[a]=Math.sin(i)}return{real:n,imag:r}}function exponent(e,t,n){const r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const ARROW="->",ARROW_REGEX=/->/g,COMMA=",",ELLIPSIS="...";function decodeEinsumEquation(e,t){const n=((e=e.replace(/\s/g,"")).length-e.replace(ARROW_REGEX,"").length)/ARROW.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error(`Equation must contain exactly one arrow ("${ARROW}").`);const[r,a]=e.split(ARROW);assert$1(-1===r.indexOf(ELLIPSIS),(()=>`The ellipsis notation ("${ELLIPSIS}") is not supported yet.`));const i=r.split(COMMA),s=i.length;if(t!==s)throw new Error(`Expected ${s} input tensors, received ${t}`);if(s>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const o=[];for(let h=0;h<a.length;++h){const e=a[h];if(!i.some((t=>-1!==t.indexOf(e))))throw new Error(`Output subscripts contain the label ${e} not present in the input subscripts.`);-1===o.indexOf(e)&&o.push(e)}for(let h=0;h<r.length;++h){const e=r[h];-1===o.indexOf(e)&&e!==COMMA&&o.push(e)}const l=new Array(i.length);for(let h=0;h<s;++h){if(new Set(i[h].split("")).size!==i[h].length)throw new Error(`Found duplicate axes in input component ${i[h]}. Support for duplicate axes in input is not implemented yet.`);l[h]=[];for(let e=0;e<i[h].length;++e)l[h].push(o.indexOf(i[h][e]))}const u=o.length,c=[];for(let h=a.length;h<u;++h)c.push(h);return{allDims:o,summedDims:c,idDims:l}}function getEinsumPermutation(e,t){let n=new Array(e);n.fill(-1);for(let a=0;a<t.length;++a)n[t[a]]=a;const r=[];for(let a=0;a<e;++a)-1===n[a]&&r.push(a);return n=n.filter((e=>-1!==e)),{permutationIndices:n,expandDims:r}}function checkEinsumDimSizes(e,t,n){const r=new Array(e);for(let a=0;a<n.length;++a){const e=n[a].shape;for(let n=0;n<t[a].length;++n)void 0===r[t[a][n]]?r[t[a][n]]=e[n]:assert$1(r[t[a][n]]===e[n],(()=>`Expected dimension ${r[t[a][n]]} at axis ${n} of input shaped ${JSON.stringify(e)}, but got dimension ${e[n]}`))}}function getEinsumComputePath(e,t){const n=e,r=[];let a=0;0===e.length&&n.push(-1),a=e.length+1;for(let s=0;s<a;++s)r.push([]);const i=[];for(let s=0;s<n.length;++s){const e=findTermsWithDim(t,n[s]);for(const t of e)-1===i.indexOf(t)&&(r[s].push(t),i.push(t))}return{path:n,steps:r}}function isIdentityPermutation(e){return e.every(((e,t)=>e===t))}function findTermsWithDim(e,t){const n=[];for(let r=0;r<e.length;++r)0!==e[r].length&&-1===e[r].indexOf(t)&&-1!==t||n.push(r);return n}function prepareSplitSize(e,t,n=0){let r=[];if("number"==typeof t)assert$1(e.shape[n]%t==0,(()=>"Number of splits must evenly divide the axis.")),r=new Array(t).fill(e.shape[n]/t);else{assert$1(t.reduce(((e,t)=>(-1===t&&(e+=1),e)),0)<=1,(()=>"There should be only one negative value in split array."));const a=t.indexOf(-1);if(-1!==a){const r=t.reduce(((e,t)=>t>0?e+t:e));t[a]=e.shape[n]-r}assert$1(e.shape[n]===t.reduce(((e,t)=>e+t)),(()=>"The sum of sizes must match the size of the axis dimension.")),r=t}return r}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function getSparseFillEmptyRowsIndicesDenseShapeMismatch(e){return`Received SparseTensor with denseShape[0] = 0 but\n  indices.shape[0] = ${e}`}function getSparseFillEmptyRowsNegativeIndexErrorMessage(e,t){return`indices(${e}, 0) is invalid: ${t} < 0`}function getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(e,t,n){return`indices(${e}, 0) is invalid: ${t} >= ${n}`}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(e,t){return`only one output dimension may be -1, not both ${e} and ${t}`}function getSparseReshapeNegativeOutputDimErrorMessage(e,t){return`size ${e} must be non-negative, not ${t}`}function getSparseReshapeEmptyTensorZeroOutputDimErrorMessage(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function getSparseReshapeInputOutputMultipleErrorMessage(e,t){return`Input to reshape is a SparseTensor with ${sizeFromShape(e)}\n  dense values, but the requested shape requires a multiple of ${sizeFromShape(t)}. inputShape=${e} outputShape= ${t}`}function getSparseReshapeInputOutputMismatchErrorMessage(e,t){return`Input to reshape is a tensor with ${sizeFromShape(e)} dense values, but the requested shape has ${sizeFromShape(t)}. inputShape=${e} outputShape=${t}`}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function getSparseSegmentReductionNegativeSegmentIdsErrorMessage(){return"segment ids must be >= 0"}function getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage(){return"segment ids are not increasing"}function getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(e,t){return`Segment id ${e} out of range [0, ${t}), possibly because segmentIds input is not sorted.`}function getSparseSegmentReductionIndicesOutOfRangeErrorMessage(e,t,n){return`Bad: indices[${e}] == ${t} out of range [0, ${n})`}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function segOpComputeOptimalWindowSize(e,t){let n,r=!1;for(e<=PARALLELIZE_THRESHOLD?(n=e,r=!0):n=nearestDivisor(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=nearestDivisor(e,n+1);return n}function computeOutShape(e,t,n){const r=[],a=e.length;for(let i=0;i<a;i++)i!==t?r.push(e[i]):r.push(n);return r}function collectGatherOpShapeInfo(e,t,n,r){const a=t.shape.length,i=e.shape.length;if(0!==r&&(r<-a||r>a))throw new Error(`Expect batchDims in the range of [-${a}, ${a}], but got ${r}`);if(r<0&&(r+=a),r>i)throw new Error(`batchDims (${r}) must be less than rank(x) (\n    ${i}).`);if(n<r)throw new Error(`batchDims (${r}) must be less than or equal to axis (${n}).`);for(let h=0;h<r;++h)if(e.shape[h]!==t.shape[h])throw new Error(`x.shape[${h}]: ${e.shape[h]} should be equal to indices.shape[${h}]: ${t.shape[h]}.`);const s=e.shape[n],o=[];let l=1,u=1,c=1;for(let h=0;h<r;++h)o.push(e.shape[h]),l*=e.shape[h];for(let h=r;h<n;h++)o.push(e.shape[h]),u*=e.shape[h];for(let h=r;h<a;h++)o.push(t.shape[h]);for(let h=n+1;h<i;h++)o.push(e.shape[h]),c*=e.shape[h];return{batchSize:l,sliceSize:c,outerSize:u,dimSize:s,outputShape:o}}const segment_util=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:collectGatherOpShapeInfo,computeOutShape:computeOutShape,segOpComputeOptimalWindowSize:segOpComputeOptimalWindowSize},Symbol.toStringTag,{value:"Module"}));
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function fromUint8ToStringArray(e){try{return e.map((e=>decodeString(e)))}catch(err){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${err}`)}}function fromStringArrayToUint8(e){return e.map((e=>encodeString(e)))}const backend_util=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:ERF_A1,ERF_A2:ERF_A2,ERF_A3:ERF_A3,ERF_A4:ERF_A4,ERF_A5:ERF_A5,ERF_P:ERF_P,PARALLELIZE_THRESHOLD:PARALLELIZE_THRESHOLD,get RowPartitionType(){return RowPartitionType$1},SELU_SCALE:SELU_SCALE,SELU_SCALEALPHA:SELU_SCALEALPHA,applyActivation:applyActivation$1,assertAndGetBroadcastShape:assertAndGetBroadcastShape,assertAxesAreInnerMostDims:assertAxesAreInnerMostDims,assertParamsConsistent:assertParamsConsistent,assignToTypedArray:assignToTypedArray,axesAreInnerMostDims:axesAreInnerMostDims,calculateShapes:calculateShapes,checkEinsumDimSizes:checkEinsumDimSizes,checkPadOnDimRoundingMode:checkPadOnDimRoundingMode,combineLocations:combineLocations,combineRaggedTensorToTensorShapes:combineRaggedTensorToTensorShapes,complexWithEvenIndex:complexWithEvenIndex,complexWithOddIndex:complexWithOddIndex,computeConv2DInfo:computeConv2DInfo,computeConv3DInfo:computeConv3DInfo,computeDefaultPad:computeDefaultPad,computeDilation2DInfo:computeDilation2DInfo,computeOptimalWindowSize:computeOptimalWindowSize,computeOutAndReduceShapes:computeOutAndReduceShapes,computeOutShape:computeOutShape$1,computePool2DInfo:computePool2DInfo,computePool3DInfo:computePool3DInfo,convertConv2DDataFormat:convertConv2DDataFormat,decodeEinsumEquation:decodeEinsumEquation,eitherStridesOrDilationsAreOne:eitherStridesOrDilationsAreOne,expandShapeToKeepDim:expandShapeToKeepDim,exponent:exponent,exponents:exponents,fromStringArrayToUint8:fromStringArrayToUint8,fromUint8ToStringArray:fromUint8ToStringArray,getAxesPermutation:getAxesPermutation,getBroadcastDims:getBroadcastDims$1,getComplexWithIndex:getComplexWithIndex,getEinsumComputePath:getEinsumComputePath,getEinsumPermutation:getEinsumPermutation,getFusedBiasGradient:getFusedBiasGradient,getFusedDyActivation:getFusedDyActivation,getImageCenter:getImageCenter,getInnerMostAxes:getInnerMostAxes,getPermuted:getPermuted,getRaggedRank:getRaggedRank,getReductionAxes:getReductionAxes,getReshaped:getReshaped,getReshapedPermuted:getReshapedPermuted,getRowPartitionTypesHelper:getRowPartitionTypesHelper,getSliceBeginCoords:getSliceBeginCoords,getSliceSize:getSliceSize,getSparseFillEmptyRowsIndicesDenseShapeMismatch:getSparseFillEmptyRowsIndicesDenseShapeMismatch,getSparseFillEmptyRowsNegativeIndexErrorMessage:getSparseFillEmptyRowsNegativeIndexErrorMessage,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:getSparseFillEmptyRowsOutOfRangeIndexErrorMessage,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:getSparseReshapeEmptyTensorZeroOutputDimErrorMessage,getSparseReshapeInputOutputMismatchErrorMessage:getSparseReshapeInputOutputMismatchErrorMessage,getSparseReshapeInputOutputMultipleErrorMessage:getSparseReshapeInputOutputMultipleErrorMessage,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:getSparseReshapeMultipleNegativeOneOutputDimErrorMessage,getSparseReshapeNegativeOutputDimErrorMessage:getSparseReshapeNegativeOutputDimErrorMessage,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:getSparseSegmentReductionIndicesOutOfRangeErrorMessage,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:getSparseSegmentReductionNegativeSegmentIdsErrorMessage,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage,getUndoAxesPermutation:getUndoAxesPermutation,isIdentityPermutation:isIdentityPermutation,log:log$5,mergeRealAndImagArrays:mergeRealAndImagArrays,prepareAndValidate:prepareAndValidate,prepareSplitSize:prepareSplitSize,segment_util:segment_util,shouldFuse:shouldFuse,slice_util:slice_util,splitRealAndImagArrays:splitRealAndImagArrays,stridesOrDilationsArePositive:stridesOrDilationsArePositive,tupleValuesAreOne:tupleValuesAreOne,upcastType:upcastType,validateDefaultValueShape:validateDefaultValueShape,validateInput:validateInput$1,validateUpdateShape:validateUpdateShape,warn:warn},Symbol.toStringTag,{value:"Module"}));
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */registerOptimizers();
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
const absGradConfig={kernelName:Abs,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>mul(e,step$2(cast$3(n,"float32"),-1))}}},acosGradConfig={kernelName:Acos,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=square$2(cast$3(n,"float32")),r=sqrt$2(sub$2(scalar(1),t));return neg$2(div$1(e,r))}}}},acoshGradConfig={kernelName:Acosh,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=sqrt$2(sub$2(square$2(cast$3(n,"float32")),1));return div$1(e,t)}}}},addGradConfig={kernelName:Add$1,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,a=assertAndGetBroadcastShape(n.shape,r.shape);return{a:()=>{let t=e;const r=getReductionAxes(n.shape,a);return r.length>0&&(t=sum$2(t,r)),reshape$2(t,n.shape)},b:()=>{let t=e;const n=getReductionAxes(r.shape,a);return n.length>0&&(t=sum$2(t,n)),reshape$2(t,r.shape)}}}},addNGradConfig={kernelName:AddN,saveAllInputs:!0,gradFunc:(e,t)=>{const n={};return t.forEach(((t,r)=>{n[r]=()=>e.clone()})),n}},argMaxGradConfig={kernelName:ArgMax,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>zerosLike$2(n)}}},argMinGradConfig={kernelName:ArgMin,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>zerosLike$2(n)}}},asinGradConfig={kernelName:Asin,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>div$1(e,sqrt$2(sub$2(scalar(1),square$2(cast$3(n,"float32")))))}}},asinhGradConfig={kernelName:Asinh,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=sqrt$2(add$1(scalar(1),square$2(cast$3(n,"float32"))));return div$1(e,t)}}}},atan2GradConfig={kernelName:Atan2,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,a=assertAndGetBroadcastShape(n.shape,r.shape);return{a:()=>{const t=add$1(square$2(n),square$2(r));let i=mul(e,div$1(r,t));const s=getReductionAxes(n.shape,a);return s.length>0&&(i=sum$2(i,s)),reshape$2(i,n.shape)},b:()=>{const t=add$1(square$2(n),square$2(r));let i=neg$2(mul(e,div$1(n,t)));const s=getReductionAxes(r.shape,a);return s.length>0&&(i=sum$2(i,s)),reshape$2(i,r.shape)}}}},atanGradConfig={kernelName:Atan,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>div$1(e,add$1(square$2(cast$3(n,"float32")),1))}}},atanhGradConfig={kernelName:Atanh,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>div$1(e,sub$2(scalar(1),square$2(cast$3(n,"float32"))))}}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function avgPool3dGrad_(e,t,n,r,a,i){const s=convertToTensor(e,"dy","avgPool3dGrad"),o=convertToTensor(t,"input","avgPool3dGrad");let l=s,u=o,c=!1;4===o.rank&&(c=!0,l=reshape$2(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),u=reshape$2(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),assert$1(5===l.rank,(()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`)),assert$1(5===u.rank,(()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${u.rank}.`)),checkPadOnDimRoundingMode("avgPool3dGrad",a,i);const h={dy:l,input:u},d={filterSize:n,strides:r,pad:a,dimRoundingMode:i},p=ENGINE.runKernel(AvgPool3DGrad,h,d);return c?reshape$2(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const avgPool3dGrad=op({avgPool3dGrad_:avgPool3dGrad_}),avgPool3DGradConfig$2={kernelName:AvgPool3D,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{filterSize:a,strides:i,pad:s,dimRoundingMode:o}=n;return{x:()=>avgPool3dGrad(e,r,a,i,s,o)}}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function avgPoolGrad_(e,t,n,r,a){const i=convertToTensor(e,"dy","avgPoolGrad"),s=convertToTensor(t,"input","avgPoolGrad");assert$1(s.rank===i.rank,(()=>`Rank of input (${s.rank}) does not match rank of dy (${i.rank})`));let o=s,l=i,u=!1;3===s.rank&&(u=!0,o=reshape$2(s,[1,s.shape[0],s.shape[1],s.shape[2]]),l=reshape$2(i,[1,i.shape[0],i.shape[1],i.shape[2]])),assert$1(4===l.rank,(()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`)),assert$1(4===o.rank,(()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${o.rank}.`));const c={dy:l,input:o},h={filterSize:n,strides:r,pad:a},d=ENGINE.runKernel(AvgPoolGrad,c,h);return u?reshape$2(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const avgPoolGrad$2=op({avgPoolGrad_:avgPoolGrad_}),avgPoolGradConfig$2={kernelName:AvgPool,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{filterSize:a,strides:i,pad:s}=n;return{x:()=>avgPoolGrad$2(e,r,a,i,s)}}},batchMatMulGradConfig={kernelName:BatchMatMul,inputsToSave:["a","b"],gradFunc:(e,t,n)=>{const[r,a]=t,{transposeA:i,transposeB:s}=n;return i||s?!i&&s?{a:()=>matMul$1(e,a,!1,!1),b:()=>matMul$1(e,r,!0,!1)}:i&&!s?{a:()=>matMul$1(a,e,!1,!0),b:()=>matMul$1(r,e,!1,!1)}:{a:()=>matMul$1(a,e,!0,!0),b:()=>matMul$1(e,r,!0,!0)}:{a:()=>matMul$1(e,a,!1,!0),b:()=>matMul$1(r,e,!0,!1)}}},batchToSpaceNDGradConfig={kernelName:BatchToSpaceND,gradFunc:(e,t,n)=>{const{blockShape:r,crops:a}=n;return{x:()=>spaceToBatchND$2(e,r,a)}}},broadcastToGradConfig={kernelName:BroadcastTo,gradFunc:(e,t,n)=>{const r=n,a=r.inputShape,i=r.shape,s=Array.from(i);for(let l=a.length-1;l>=0;l--)if(a[l]===i[l])s[l]=1;else if(1!==a[l])throw new Error(`broadcastTo(): [${a}] cannot be broadcast to [${i}].`);const o=[];for(let l=0;l<s.length;l++)s[l]>1&&o.push(l);return{x:()=>sum$2(e,o,!0)}}},castGradConfig={kernelName:Cast,gradFunc:e=>({x:()=>e.clone()})},ceilGradConfig={kernelName:Ceil,gradFunc:e=>({x:()=>zerosLike$2(e)})},clipByValueGradConfig={kernelName:ClipByValue,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{clipValueMin:a,clipValueMax:i}=n;return{x:()=>where(logicalAnd$2(greaterEqual$2(r,a),lessEqual$2(r,i)),e,zerosLike$2(e))}}},complexAbsGradConfig={kernelName:ComplexAbs,inputsToSave:["x"],gradFunc:absGradConfig.gradFunc},concatGradConfig={kernelName:Concat,saveAllInputs:!0,gradFunc:(e,t,n)=>{const r=t.map((e=>e.shape)),{axis:a}=n,i=parseAxisParam(a,t[0].shape)[0],s=r.map((e=>e[i]));return split$3(e,s,i).map((e=>()=>e))}},conv2DGradConfig={kernelName:Conv2D$1,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const[r,a]=t,{dilations:i,strides:s,pad:o,dataFormat:l}=n;return assert$1(tupleValuesAreOne(i),(()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`)),{x:()=>conv2DBackpropInput$2(r.shape,e,a,s,o,l),filter:()=>conv2DBackpropFilter$2(r,e,a.shape,s,o,l)}}},conv2DBackpropInputGradConfig={kernelName:Conv2DBackpropInput,inputsToSave:["dy","filter"],gradFunc:(e,t,n)=>{const[r,a]=t,{strides:i,pad:s,dataFormat:o,dimRoundingMode:l}=n;return{dy:()=>conv2d$2(e,a,i,s,o,1,l),filter:()=>conv2DBackpropFilter$2(e,r,a.shape,i,s,o,l)}}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function conv3DBackpropFilter_(e,t,n,r,a){let i=e;4===e.rank&&(i=reshape$2(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]));let s=t;4===s.rank&&(s=reshape$2(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),assert$1(5===i.rank,(()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${i.shape}.`)),assert$1(5===s.rank,(()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${s.shape}.`)),assert$1(5===n.length,(()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${n}.`)),assert$1(i.shape[4]===n[3],(()=>`Error in conv3dDerFilter: depth of input ${i.shape[4]}) must match input depth in filter (${n[3]}.`)),assert$1(s.shape[4]===n[4],(()=>`Error in conv3dDerFilter: depth of dy (${s.shape[4]}) must match output depth for filter (${n[4]}).`));const o={x:i,dy:s},l={strides:r,pad:a,filterShape:n};return ENGINE.runKernel(Conv3DBackpropFilterV2,o,l)}const conv3DBackpropFilter=op({conv3DBackpropFilter_:conv3DBackpropFilter_}),conv3DGradConfig={kernelName:Conv3D$1,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const{dilations:r,strides:a,pad:i}=n;assert$1(tupleValuesAreOne(r),(()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`));const[s,o]=t;return{x:()=>conv3DBackpropInput$1(s.shape,e,o,a,i),filter:()=>conv3DBackpropFilter(s,e,o.shape,a,i)}}},cosGradConfig={kernelName:Cos,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>mul(neg$2(sin$2(cast$3(n,"float32"))),e)}}},coshGradConfig={kernelName:Cosh,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>mul(sinh$2(cast$3(n,"float32")),e)}}},cumsumGradConfig={kernelName:Cumsum,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{axis:a,exclusive:i,reverse:s}=n;return{x:()=>{const t=getAxesPermutation([a],r.rank);let n=cumsum$2(e,a,i,!s);return null!=t&&(n=transpose$2(n,t)),n}}}},depthwiseConv2dNativeGradConfig={kernelName:DepthwiseConv2dNative,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const{dilations:r,strides:a,pad:i,dimRoundingMode:s}=n,o=null==r?[1,1]:r;assert$1(tupleValuesAreOne(o),(()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${o}'`));const[l,u]=t;return assert$1(4===l.rank,(()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`)),assert$1(4===u.rank,(()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${u.rank}.`)),assert$1(l.shape[3]===u.shape[2],(()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${u.shape[2]}.`)),assert$1(eitherStridesOrDilationsAreOne(a,o),(()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${a} and dilations '${o}'.`)),checkPadOnDimRoundingMode("depthwiseConv2d",i,s),{x:()=>depthwiseConv2dNativeBackpropInput$2(l.shape,e,u,a,i,o,s),filter:()=>depthwiseConv2dNativeBackpropFilter$2(l,e,u.shape,a,i,o,s)}}},dilation2dGradConfig={kernelName:Dilation2D,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const[r,a]=t,i={x:r,filter:a,dy:e},s={x:r,filter:a,dy:e};return{x:()=>ENGINE.runKernel(Dilation2DBackpropInput,i,n),filter:()=>ENGINE.runKernel(Dilation2DBackpropFilter,s,n)}}},eluGradConfig$2={kernelName:Elu$1,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t,r={dy:e,y:n};return{x:()=>ENGINE.runKernel(EluGrad,r)}}},erfGradConfig={kernelName:Erf,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t,r=mul(exp$2(neg$2(square$2(n))),2/Math.sqrt(Math.PI));return{x:()=>mul(e,r)}}},expGradConfig={kernelName:Exp,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>mul(e,n)}}},expandDimsGradConfig={kernelName:ExpandDims,inputsToSave:["input"],gradFunc:(e,t)=>{const[n]=t;return{input:()=>reshape$2(e,n.shape)}}},expm1GradConfig={kernelName:Expm1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>mul(e,exp$2(n))}}},floorGradConfig={kernelName:Floor,gradFunc:e=>({x:()=>zerosLike$2(e)})},floorDivGradConfig={kernelName:FloorDiv,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,a=assertAndGetBroadcastShape(n.shape,r.shape);return{a:()=>{const t=div$1(e,cast$3(r,"float32")),i=getReductionAxes(n.shape,a);return i.length>0?reshape$2(sum$2(t,i),n.shape):t},b:()=>{let t=mul(e,cast$3(n,"float32"));const i=getReductionAxes(r.shape,a);i.length>0&&(t=reshape$2(sum$2(t,i),r.shape));const s=square$2(r);return neg$2(div$1(t,cast$3(s,"float32")))}}}},fusedBatchNormGradConfig={kernelName:FusedBatchNorm,inputsToSave:["x","mean","variance","scale"],gradFunc:(e,t,n)=>{const{varianceEpsilon:r}=n,[a,i,s,o]=t,l=null==o?scalar(1):o,u=getReductionAxes(i.shape,a.shape),c=[];if(1===i.rank){for(let e=0;e<a.shape.length-1;++e)c.push(a.shape[e]);c.push(1)}const h=sub$2(a,i),d=mul(e,l),p=rsqrt$2(add$1(s,scalar(r))),f=mul(mul(mul(p,p),p),scalar(-.5));return{x:()=>1===i.rank?reshape$2(mul(mul(e,tile$3(reshape$2(p,[1,1,1,i.shape[0]]),c)),l),a.shape):reshape$2(mul(mul(e,p),l),a.shape),mean:()=>{let e=mul(mul(p,scalar(-1)),d);return 1===i.rank&&(e=sum$2(e,u)),reshape$2(e,i.shape)},variance:()=>{let e=mul(mul(f,h),d);return 1===i.rank&&(e=sum$2(e,u)),reshape$2(e,i.shape)},scale:()=>{const t=mul(h,p);let n=mul(e,t);return 1===i.rank&&(n=sum$2(n,u)),reshape$2(n,i.shape)},offset:()=>{let t=e;return 1===i.rank&&(t=sum$2(t,u)),reshape$2(t,i.shape)}}}},gatherGradConfig={kernelName:GatherV2,inputsToSave:["x","indices"],gradFunc:(e,t,n)=>{const[r,a]=t,{axis:i,batchDims:s}=n,o=parseAxisParam(i,r.shape)[0],l=(e,t,n)=>()=>{const r=e.shape,a=t.size,s=r.slice(0,o),l=s.length,u=r.slice(i,r.length).slice(1),c=u.length,h=arrayRange(0,l),d=arrayRange(l+1,l+1+c),p=arrayConcat([s,[a],u]),f=reshape$2(n,p),m=reshape$2(t,[a]),g=arrayConcat([[l],h,d]),y=transpose$2(f,g);let v=unsortedSegmentSum$2(y,m,e.shape[o]);const b=getUndoAxesPermutation(g);return v=transpose$2(v,b),v};if(1===s){const t=r.shape[0],n=r.split(t,0);return{x:()=>stack(n.map(((t,n)=>l(t,a.slice(n,1),e.slice(n,1))()))).reshape(r.shape),indices:()=>a}}return{x:l(r,a,e),indices:()=>a}}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function arrayRange(e,t){const n=[];for(let r=e;r<t;++r)n.push(r);return n}function arrayConcat(e){const t=[];for(let n=0;n<e.length;++n)for(let r=0;r<e[n].length;++r)t.push(e[n][r]);return t}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const greaterEqualGradConfig={kernelName:GreaterEqual,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t;return{a:()=>zerosLike$2(n),b:()=>zerosLike$2(r)}}},identityGradConfig={kernelName:Identity$1,gradFunc:e=>({x:()=>cast$3(e,"float32")})},isFiniteGradConfig={kernelName:IsFinite,gradFunc:e=>({x:()=>zerosLike$2(e)})},isInfGradConfig={kernelName:IsInf,gradFunc:e=>({x:()=>zerosLike$2(e)})},isNanGradConfig={kernelName:IsNan,gradFunc:e=>({x:()=>zerosLike$2(e)})},leakyReluGradConfig={kernelName:LeakyRelu,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{alpha:a}=n,i=greater$2(r,0);return{x:()=>where(i,e,mul(e,a))}}},log1pGradConfig={kernelName:Log1p,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>div$1(e,add$1(n,1))}}},logGradConfig={kernelName:Log,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>div$1(e,cast$3(n,"float32"))}}},logSoftmaxGradConfig={kernelName:LogSoftmax$1,inputsToSave:[],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r]=t,{axis:a}=n;return{logits:()=>{const t=exp$2(r);return sub$2(e,mul(sum$2(e,a,!0),t))}}}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function localResponseNormalizationBackprop_(e,t,n,r=5,a=1,i=1,s=.5){const o={x:e,y:t,dy:n},l={depthRadius:r,bias:a,alpha:i,beta:s};return ENGINE.runKernel(LRNGrad,o,l)}const localResponseNormalizationBackprop=op({localResponseNormalizationBackprop_:localResponseNormalizationBackprop_}),lrnGradConfig={kernelName:LRN,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r,a]=t,{depthRadius:i,bias:s,alpha:o,beta:l}=n;return{x:()=>localResponseNormalizationBackprop(r,a,e,i,s,o,l)}}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function gradForMinAndMax(e,t,n,r){return t.rank<n.rank&&(t=reshape$2(t,expandShapeToKeepDim(t.shape,r))),e.rank<n.rank&&(e=reshape$2(e,expandShapeToKeepDim(e.shape,r))),{x:()=>mul(e,cast$3(equal$2(n,t),e.dtype))}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const maxGradConfig={kernelName:Max,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const r=n,{reductionIndices:a}=r,i=t[0],s=gradForMinAndMax(e,t[1],i,parseAxisParam(a,i.shape));return{x:()=>s.x()}}},maximumGradConfig={kernelName:Maximum$1,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t;return{a:()=>mul(e,cast$3(greaterEqual$2(n,r),"float32")),b:()=>mul(e,cast$3(less$2(n,r),"float32"))}}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function maxPool3dGrad_(e,t,n,r,a,i,s){const o=convertToTensor(e,"dy","maxPool3dGrad"),l=convertToTensor(t,"input","maxPool3dGrad"),u=convertToTensor(n,"output","maxPool3dGrad");let c=o,h=l,d=u,p=!1;4===l.rank&&(p=!0,c=reshape$2(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),h=reshape$2(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),d=reshape$2(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]])),assert$1(5===c.rank,(()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${c.rank}.`)),assert$1(5===h.rank,(()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${h.rank}.`)),assert$1(5===d.rank,(()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${d.rank}.`)),checkPadOnDimRoundingMode("maxPool3dGrad",i,s);const f={dy:c,input:h,output:d},m={filterSize:r,strides:a,pad:i,dimRoundingMode:s},g=ENGINE.runKernel(MaxPool3DGrad,f,m);return p?reshape$2(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}const maxPool3dGrad=op({maxPool3dGrad_:maxPool3dGrad_}),maxPool3DGradConfig$2={kernelName:MaxPool3D,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r,a]=t,{filterSize:i,strides:s,pad:o,dimRoundingMode:l}=n;return{x:()=>maxPool3dGrad(e,r,a,i,s,o,l)}}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function maxPoolGrad_(e,t,n,r,a,i,s){const o=convertToTensor(e,"dy","maxPoolGrad"),l=convertToTensor(t,"input","maxPoolGrad"),u=convertToTensor(n,"output","maxPoolGrad");assert$1(l.rank===o.rank,(()=>`Rank of input (${l.rank}) does not match rank of dy (${o.rank})`)),assert$1(4===o.rank,(()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${o.rank}.`)),assert$1(4===l.rank,(()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`)),checkPadOnDimRoundingMode("maxPoolGrad",i,s);const c={dy:o,input:l,output:u},h={filterSize:r,strides:a,pad:i,dimRoundingMode:s};return ENGINE.runKernel(MaxPoolGrad,c,h)}const maxPoolGrad$2=op({maxPoolGrad_:maxPoolGrad_}),maxPoolGradConfig$2={kernelName:MaxPool,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r,a]=t,{filterSize:i,strides:s,pad:o}=n;return{x:()=>maxPoolGrad$2(e,r,a,i,s,o)}}},meanGradConfig={kernelName:Mean,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{axis:a}=n,i=parseAxisParam(a,r.shape),s=sizeFromShape(computeOutAndReduceShapes(r.shape,i)[1]);return{x:()=>{const t=r.shape.slice();i.forEach((e=>{t[e]=1}));const n=reshape$2(e,t);return div$1(mul(n,ones(r.shape,"float32")),s)}}}},minGradConfig={kernelName:Min,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const r=n,{axis:a}=r,[i,s]=t,o=gradForMinAndMax(e,s,i,parseAxisParam(a,i.shape));return{x:()=>o.x()}}},minimumGradConfig={kernelName:Minimum$1,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t;return{a:()=>mul(e,cast$3(lessEqual$2(n,r),"float32")),b:()=>mul(e,cast$3(greater$2(n,r),"float32"))}}},mirrorPadGradConfig={kernelName:MirrorPad,inputsToSave:["x"],gradFunc:(e,t,n)=>{const r=t[0],{paddings:a}=n,i=a.map((e=>e[0]));return{x:()=>slice$2(e,i,r.shape)}}},modGradConfig={kernelName:Mod,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,a=assertAndGetBroadcastShape(n.shape,r.shape);return{a:()=>{const t=getReductionAxes(n.shape,a);return t.length>0?reshape$2(sum$2(e,t),n.shape):e},b:()=>{const t=mul(e,neg$2(floor$2(div$1(n,r)))),i=getReductionAxes(r.shape,a);return i.length>0?reshape$2(sum$2(t,i),r.shape):t}}}},multiplyGradConfig={kernelName:Multiply$1,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,a=assertAndGetBroadcastShape(n.shape,r.shape);return{a:()=>{const t=mul(e,cast$3(r,"float32")),i=getReductionAxes(n.shape,a);return i.length>0?reshape$2(sum$2(t,i),n.shape):t},b:()=>{const t=mul(e,cast$3(n,"float32")),i=getReductionAxes(r.shape,a);return i.length>0?reshape$2(sum$2(t,i),r.shape):t}}}},negGradConfig={kernelName:Neg,gradFunc:e=>({x:()=>neg$2(e)})},oneHotGradConfig={kernelName:OneHot,inputsToSave:["indices"],gradFunc:(e,t)=>{const n=t[0];return{indices:()=>zeros$1(n.shape,"float32")}}},onesLikeGradConfig={kernelName:OnesLike,gradFunc:e=>({x:()=>zerosLike$2(e)})},packGradConfig={kernelName:Pack,saveAllInputs:!0,gradFunc:(e,t,n)=>{const{axis:r}=n;return unstack(e,r).map((e=>()=>e))}},padV2GradConfig={kernelName:PadV2,inputsToSave:["x"],gradFunc:(e,t,n)=>{const r=t[0],{paddings:a}=n,i=a.map((e=>e[0]));return{x:()=>slice$2(e,i,r.shape)}}},powGradConfig={kernelName:Pow,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(e,t)=>{const[n,r,a]=t,i=n,s=r,o=assertAndGetBroadcastShape(i.shape,s.shape);return{a:()=>{const t=cast$3(s,"float32");let n=mul(e,mul(t,pow$2(i,sub$2(t,scalar(1)))));const r=getReductionAxes(i.shape,o);return r.length>0&&(n=sum$2(n,r)),reshape$2(n,i.shape)},b:()=>{const t=greater$2(i,0),n=where(t,log$4(i),zerosLike$2(i));let r=mul(e,mul(a,n));const l=getReductionAxes(s.shape,o);return l.length>0&&(r=sum$2(r,l)),reshape$2(r,s.shape)}}}},preluGradConfig={kernelName:Prelu,inputsToSave:["x","alpha"],gradFunc:(e,t)=>{const[n,r]=t,a=greater$2(n,0);return{x:()=>where(a,e,mul(e,r)),alpha:()=>{let t=where(a,zerosLike$2(e),mul(e,n));const i=getReductionAxes(r.shape,e.shape);return i.length>0&&(t=sum$2(t,i)),reshape$2(t,r.shape)}}}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2022 Google Inc. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function prodGradFn_(e,t,n){const r=e.shape.slice();r[n]=1;const a=reshape$2(t,r),i=cumprod$2(e,n,!0,!1),s=cumprod$2(e,n,!0,!0),o=mul(i,s);return mul(a,o)}function prodsGradFn_(e,t,n){const r=e.shape.length,a=r-n.length,i=getAxesPermutation(n,r);let s=e;null!=i&&(s=transpose$2(e,i));const o=s.shape.slice(),l=o.splice(r-n.length,n.length).reduce(((e,t)=>e*t),1);o.push(l);let u=prodGradFn_(s.reshape(o),t,a);if(u=u.reshape(s.shape),null!=i){const e=getUndoAxesPermutation(i);u=transpose$2(u,e)}return u}const prodGradConfig={kernelName:Prod,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{axis:a}=n;let i=[];return i=null==a?r.shape.map(((e,t)=>t)):"number"==typeof a?[a]:a,{x:()=>prodsGradFn_(r,e,i)}}},divGradConfig={kernelName:RealDiv,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,a=assertAndGetBroadcastShape(n.shape,r.shape);return{a:()=>{const t=div$1(e,cast$3(r,"float32")),i=getReductionAxes(n.shape,a);return i.length>0?reshape$2(sum$2(t,i),n.shape):t},b:()=>{let t=mul(e,cast$3(n,"float32"));const i=getReductionAxes(r.shape,a);i.length>0&&(t=reshape$2(sum$2(t,i),r.shape));const s=square$2(r);return neg$2(div$1(t,cast$3(s,"float32")))}}}},reciprocalGradConfig={kernelName:Reciprocal,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>div$1(e,neg$2(square$2(n)))}}},relu6GradConfig={kernelName:Relu6$1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t,r=mul(lessEqual$2(n,6),step$2(n));return{x:()=>mul(e,cast$3(r,"float32"))}}},reluGradConfig={kernelName:Relu$1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>mul(e,cast$3(step$2(n),"float32"))}}},reshapeGradConfig={kernelName:Reshape$1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>reshape$2(e,n.shape)}}},resizeBilinearGradConfig$2={kernelName:ResizeBilinear,inputsToSave:["images"],gradFunc:(e,t,n)=>{const[r]=t,a={dy:e,images:r};return{images:()=>ENGINE.runKernel(ResizeBilinearGrad,a,n)}}},resizeNearestNeighborGradConfig$2={kernelName:ResizeNearestNeighbor,inputsToSave:["images"],gradFunc:(e,t,n)=>{const[r]=t,a={dy:e,images:r};return{images:()=>ENGINE.runKernel(ResizeNearestNeighborGrad,a,n)}}},reverseGradConfig={kernelName:Reverse,gradFunc:(e,t,n)=>{const{dims:r}=n,a=parseAxisParam(r,e.shape);return{x:()=>reverse$2(e,a)}}},roundGradConfig={kernelName:Round,gradFunc:e=>({x:()=>zerosLike$2(e)})},rsqrtGradConfig={kernelName:Rsqrt,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>neg$2(div$1(e,mul(pow$2(n,1.5),2)))}}},selectGradConfig={kernelName:Select,inputsToSave:["condition"],gradFunc:(e,t)=>{const[n]=t;return{condition:()=>cast$3(zerosLike$2(n),"float32"),t:()=>mul(e,cast$3(n,e.dtype)),e:()=>mul(e,cast$3(logicalNot$2(n),e.dtype))}}},seluGradConfig={kernelName:Selu$1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=greater$2(n,scalar(0)),r=scalar(SELU_SCALEALPHA),a=scalar(SELU_SCALE),i=mul(e,a),s=mul(mul(e,r),exp$2(cast$3(n,"float32")));return where(t,i,s)}}}},sigmoidGradConfig={kernelName:Sigmoid$1,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>mul(e,mul(n,sub$2(scalar(1),n)))}}},signGradConfig={kernelName:Sign,gradFunc:e=>({x:()=>zerosLike$2(e)})},sinGradConfig={kernelName:Sin,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>mul(cos$2(cast$3(n,"float32")),e)}}},sinhGradConfig={kernelName:Sinh,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>mul(cosh$2(cast$3(n,"float32")),e)}}},sliceGradConfig={kernelName:Slice,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{begin:a,size:i}=n,s=r.shape,[o,l]=parseSliceParams(r,a,i),u=[];for(let c=0;c<e.rank;c++)u.push([o[c],s[c]-o[c]-l[c]]);return{x:()=>pad(e,u)}}},softmaxGradConfig={kernelName:Softmax$2,outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r]=t,{dim:a}=n,i=mul(e,r);return{logits:()=>sub$2(i,mul(sum$2(i,[a],true),r))}}},softplusGradConfig={kernelName:Softplus$1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>mul(e,sigmoid$2(n))}}},spaceToBatchNDGradConfig={kernelName:SpaceToBatchND,gradFunc:(e,t,n)=>{const{blockShape:r,paddings:a}=n;return{x:()=>batchToSpaceND$2(e,r,a)}}},splitVGradConfig={kernelName:SplitV,gradFunc:(e,t,n)=>{const{axis:r}=n;return{x:()=>concat$2(e,r)}}},sqrtGradConfig={kernelName:Sqrt,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>div$1(e,mul(sqrt$2(cast$3(n,"float32")),2))}}},squareGradConfig={kernelName:Square,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>mul(e,mul(cast$3(n,"float32"),2))}}},squaredDifferenceGradConfig={kernelName:SquaredDifference,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,a=scalar(2);return{a:()=>mul(e,mul(a,sub$2(n,r))),b:()=>mul(e,mul(a,sub$2(r,n)))}}},stepGradConfig={kernelName:Step,gradFunc:e=>({x:()=>zerosLike$2(e)})},subGradConfig={kernelName:Sub,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,a=assertAndGetBroadcastShape(n.shape,r.shape);return{a:()=>{let t=e;const r=getReductionAxes(n.shape,a);return r.length>0&&(t=sum$2(t,r)),reshape$2(t,n.shape)},b:()=>{let t=e;const n=getReductionAxes(r.shape,a);return n.length>0&&(t=sum$2(t,n)),reshape$2(neg$2(t),r.shape)}}}},sumGradConfig={kernelName:Sum,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,a=r.shape.slice(),{axis:i}=n;parseAxisParam(i,r.shape).forEach((e=>{a[e]=1}));const s=reshape$2(e,a),o=mul(s,ones(r.shape,"float32"));return{x:()=>o}}},tanGradConfig={kernelName:Tan,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>div$1(e,square$2(cos$2(n)))}}},tanhGradConfig={kernelName:Tanh$1,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>mul(sub$2(scalar(1),square$2(n)),e)}}},tileGradConfig={kernelName:Tile,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{reps:a}=n;return{x:()=>{let t=zerosLike$2(r);if(1===r.rank)for(let n=0;n<a[0];++n)t=add$1(t,slice$2(e,[n*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(let n=0;n<a[0];++n)for(let i=0;i<a[1];++i)t=add$1(t,slice$2(e,[n*r.shape[0],i*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(let n=0;n<a[0];++n)for(let i=0;i<a[1];++i)for(let s=0;s<a[2];++s)t=add$1(t,slice$2(e,[n*r.shape[0],i*r.shape[1],s*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error(`Gradient for tile operation is not implemented for rank-${r.rank} tensors yet.`);for(let n=0;n<a[0];++n)for(let i=0;i<a[1];++i)for(let s=0;s<a[2];++s)for(let o=0;o<a[3];++o)t=add$1(t,slice$2(e,[n*r.shape[0],i*r.shape[1],s*r.shape[2],o*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return t}}}},transposeGradConfig={kernelName:Transpose,gradFunc:(e,t,n)=>{const r=n,{perm:a}=r,i=getUndoAxesPermutation(a);return{x:()=>transpose$2(e,i)}}},unpackGradConfig={kernelName:Unpack,gradFunc:(e,t,n)=>{const r=n,{axis:a}=r;return{value:()=>stack(e,a)}}},unsortedSegmentSumGradConfig={kernelName:UnsortedSegmentSum,inputsToSave:["segmentIds"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>gatherDropNegatives(e,n)}}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function gatherDropNegatives(e,t){const n=maximum$2(t,zerosLike$2(t)),r=gather$1(e,n);let a=greaterEqual$2(t,scalar(0,"int32"));const i=r.rank-a.rank;for(let o=0;o<i;++o)a=expandDims$3(a,o+1);a=logicalAnd$2(a,ones(r.shape,"bool"));const s=zerosLike$2(r);return where(a,r,s)}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const zerosLikeGradConfig={kernelName:ZerosLike,gradFunc:e=>({x:()=>zerosLike$2(e)})},gradConfigs=[absGradConfig,acosGradConfig,acoshGradConfig,addGradConfig,addNGradConfig,argMaxGradConfig,argMinGradConfig,asinGradConfig,asinhGradConfig,atan2GradConfig,atanGradConfig,atanhGradConfig,avgPool3DGradConfig$2,avgPoolGradConfig$2,batchMatMulGradConfig,batchToSpaceNDGradConfig,broadcastToGradConfig,castGradConfig,ceilGradConfig,clipByValueGradConfig,complexAbsGradConfig,concatGradConfig,conv2DBackpropInputGradConfig,conv2DGradConfig,conv3DGradConfig,cosGradConfig,coshGradConfig,cumsumGradConfig,depthwiseConv2dNativeGradConfig,dilation2dGradConfig,divGradConfig,eluGradConfig$2,erfGradConfig,expGradConfig,expandDimsGradConfig,expm1GradConfig,floorDivGradConfig,floorGradConfig,fusedBatchNormGradConfig,gatherGradConfig,greaterEqualGradConfig,identityGradConfig,isFiniteGradConfig,isInfGradConfig,isNanGradConfig,leakyReluGradConfig,log1pGradConfig,logGradConfig,logSoftmaxGradConfig,lrnGradConfig,maxGradConfig,maxGradConfig,maximumGradConfig,maxPool3DGradConfig$2,maxPoolGradConfig$2,meanGradConfig,minGradConfig,minimumGradConfig,mirrorPadGradConfig,modGradConfig,multiplyGradConfig,negGradConfig,oneHotGradConfig,onesLikeGradConfig,packGradConfig,padV2GradConfig,padV2GradConfig,powGradConfig,preluGradConfig,prodGradConfig,reciprocalGradConfig,relu6GradConfig,reluGradConfig,reshapeGradConfig,resizeBilinearGradConfig$2,resizeNearestNeighborGradConfig$2,reverseGradConfig,roundGradConfig,rsqrtGradConfig,selectGradConfig,seluGradConfig,sigmoidGradConfig,signGradConfig,sinGradConfig,sinhGradConfig,sliceGradConfig,softmaxGradConfig,softplusGradConfig,spaceToBatchNDGradConfig,spaceToBatchNDGradConfig,splitVGradConfig,splitVGradConfig,sqrtGradConfig,squaredDifferenceGradConfig,squareGradConfig,stepGradConfig,subGradConfig,sumGradConfig,tanGradConfig,tanhGradConfig,tileGradConfig,transposeGradConfig,unpackGradConfig,unsortedSegmentSumGradConfig,zerosLikeGradConfig];
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */for(const m of gradConfigs)registerGradient(m);
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */getGlobalTensorClass().prototype.abs=function(){return this.throwIfDisposed(),abs$2(this)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.acos=function(){return this.throwIfDisposed(),acos$2(this)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.acosh=function(){return this.throwIfDisposed(),acosh$2(this)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.add=function(e){return this.throwIfDisposed(),add$1(this,e)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.all=function(e,t){return this.throwIfDisposed(),all$2(this,e,t)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.any=function(e,t){return this.throwIfDisposed(),any$3(this,e,t)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.argMax=function(e){return this.throwIfDisposed(),argMax$2(this,e)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.argMin=function(e){return this.throwIfDisposed(),argMin$2(this,e)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.asScalar=function(){return this.throwIfDisposed(),assert$1(1===this.size,(()=>"The array must have only 1 element.")),reshape$2(this,[])},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.asType=function(e){return this.throwIfDisposed(),cast$3(this,e)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.as1D=function(){return this.throwIfDisposed(),reshape$2(this,[this.size])},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.as2D=function(e,t){return this.throwIfDisposed(),reshape$2(this,[e,t])},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.as3D=function(e,t,n){return this.throwIfDisposed(),reshape$2(this,[e,t,n])},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),reshape$2(this,[e,t,n,r])},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.as5D=function(e,t,n,r,a){return this.throwIfDisposed(),reshape$2(this,[e,t,n,r,a])},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.asin=function(){return this.throwIfDisposed(),asin$2(this)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.asinh=function(){return this.throwIfDisposed(),asinh$2(this)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.atan=function(){return this.throwIfDisposed(),atan$2(this)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.atan2=function(e){return this.throwIfDisposed(),atan2$2(this,e)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.atanh=function(){return this.throwIfDisposed(),atanh$2(this)},getGlobalTensorClass().prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),avgPool$2(this,e,t,n,r)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),batchToSpaceND$2(this,e,t)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.batchNorm=function(e,t,n,r,a){return this.throwIfDisposed(),batchNorm$2(this,e,t,n,r,a)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.broadcastTo=function(e){return this.throwIfDisposed(),broadcastTo(this,e)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.cast=function(e){return this.throwIfDisposed(),cast$3(this,e)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.ceil=function(){return this.throwIfDisposed(),ceil$2(this)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.clipByValue=function(e,t){return this.throwIfDisposed(),clipByValue$2(this,e,t)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.concat=function(e,t){return this.throwIfDisposed(),e instanceof Tensor&&(e=[e]),concat$2([this,...e],t)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.conv1d=function(e,t,n,r,a,i){return this.throwIfDisposed(),conv1d(this,e,t,n,r,a,i)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.conv2dTranspose=function(e,t,n,r,a){return this.throwIfDisposed(),conv2dTranspose(this,e,t,n,r,a)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.conv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),conv2d$2(this,e,t,n,r,a,i)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.cos=function(){return this.throwIfDisposed(),cos$2(this)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.cosh=function(){return this.throwIfDisposed(),cosh$2(this)},
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the 'License');
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an 'AS IS' BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.cumprod=function(e,t,n){return this.throwIfDisposed(),cumprod$2(this,e,t,n)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.cumsum=function(e,t,n){return this.throwIfDisposed(),cumsum$2(this,e,t,n)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),depthToSpace$2(this,e,t)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.depthwiseConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),depthwiseConv2d$2(this,e,t,n,r,a,i)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.dilation2d=function(e,t,n,r,a){return this.throwIfDisposed(),dilation2d(this,e,t,n,r,a)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.divNoNan=function(e){return this.throwIfDisposed(),divNoNan(this,e)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.div=function(e){return this.throwIfDisposed(),div$1(this,e)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.dot=function(e){return this.throwIfDisposed(),dot$1(this,e)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.elu=function(){return this.throwIfDisposed(),elu$3(this)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.equal=function(e){return this.throwIfDisposed(),equal$2(this,e)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.erf=function(){return this.throwIfDisposed(),erf$2(this)},
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.euclideanNorm=function(e,t){return this.throwIfDisposed(),euclideanNorm(this,e,t)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.exp=function(){return this.throwIfDisposed(),exp$2(this)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.expandDims=function(e){return this.throwIfDisposed(),expandDims$3(this,e)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.expm1=function(){return this.throwIfDisposed(),expm1$2(this)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.fft=function(){return this.throwIfDisposed(),fft$2(this)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.flatten=function(){return this.throwIfDisposed(),reshape$2(this,[this.size])},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.floor=function(){return this.throwIfDisposed(),floor$2(this)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.floorDiv=function(e){return this.throwIfDisposed(),floorDiv$2(this,e)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.gather=function(e,t,n){return this.throwIfDisposed(),gather$1(this,e,t,n)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.greaterEqual=function(e){return this.throwIfDisposed(),greaterEqual$2(this,e)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.greater=function(e){return this.throwIfDisposed(),greater$2(this,e)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.ifft=function(){return this.throwIfDisposed(),ifft$2(this)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.irfft=function(){return this.throwIfDisposed(),irfft(this)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.isFinite=function(){return this.throwIfDisposed(),isFinite$3(this)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.isInf=function(){return this.throwIfDisposed(),isInf$2(this)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.isNaN=function(){return this.throwIfDisposed(),isNaN$3(this)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.leakyRelu=function(e){return this.throwIfDisposed(),leakyRelu$2(this,e)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.lessEqual=function(e){return this.throwIfDisposed(),lessEqual$2(this,e)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.less=function(e){return this.throwIfDisposed(),less$2(this,e)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.localResponseNormalization=function(e,t,n,r){return this.throwIfDisposed(),localResponseNormalization(this,e,t,n,r)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.logSigmoid=function(){return this.throwIfDisposed(),logSigmoid(this)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.logSoftmax=function(e){return this.throwIfDisposed(),logSoftmax(this,e)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.logSumExp=function(e,t){return this.throwIfDisposed(),logSumExp(this,e,t)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.log=function(){return this.throwIfDisposed(),log$4(this)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.log1p=function(){return this.throwIfDisposed(),log1p$2(this)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.logicalAnd=function(e){return this.throwIfDisposed(),logicalAnd$2(this,e)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.logicalNot=function(){return this.throwIfDisposed(),logicalNot$2(this)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.logicalOr=function(e){return this.throwIfDisposed(),logicalOr$2(this,e)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.logicalXor=function(e){return this.throwIfDisposed(),logicalXor(this,e)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.matMul=function(e,t,n){return this.throwIfDisposed(),matMul$1(this,e,t,n)},getGlobalTensorClass().prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),maxPool$2(this,e,t,n,r)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.max=function(e,t){return this.throwIfDisposed(),max$3(this,e,t)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.maximum=function(e){return this.throwIfDisposed(),maximum$2(this,e)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.mean=function(e,t){return this.throwIfDisposed(),mean$1(this,e,t)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.min=function(e,t){return this.throwIfDisposed(),min$3(this,e,t)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.minimum=function(e){return this.throwIfDisposed(),minimum$2(this,e)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.mirrorPad=function(e,t){return this.throwIfDisposed(),mirrorPad$1(this,e,t)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.mod=function(e){return this.throwIfDisposed(),mod$2(this,e)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.mul=function(e){return this.throwIfDisposed(),mul(this,e)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.neg=function(){return this.throwIfDisposed(),neg$2(this)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.norm=function(e,t,n){return this.throwIfDisposed(),norm(this,e,t,n)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.notEqual=function(e){return this.throwIfDisposed(),notEqual$2(this,e)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.oneHot=function(e,t=1,n=0){return this.throwIfDisposed(),oneHot$2(this,e,t,n)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.onesLike=function(){return this.throwIfDisposed(),onesLike$2(this)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.pad=function(e,t){return this.throwIfDisposed(),pad(this,e,t)},getGlobalTensorClass().prototype.pool=function(e,t,n,r,a,i){return this.throwIfDisposed(),pool$1(this,e,t,n,r,a,i)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.pow=function(e){return this.throwIfDisposed(),pow$2(this,e)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.prelu=function(e){return this.throwIfDisposed(),prelu$2(this,e)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.prod=function(e,t){return this.throwIfDisposed(),prod$2(this,e,t)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.reciprocal=function(){return this.throwIfDisposed(),reciprocal$2(this)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.relu=function(){return this.throwIfDisposed(),relu$2(this)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.relu6=function(){return this.throwIfDisposed(),relu6$2(this)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.reshapeAs=function(e){return this.throwIfDisposed(),reshape$2(this,e.shape)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.reshape=function(e){return this.throwIfDisposed(),reshape$2(this,e)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.resizeBilinear=function(e,t,n){return this.throwIfDisposed(),resizeBilinear$3(this,e,t,n)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.resizeNearestNeighbor=function(e,t,n){return this.throwIfDisposed(),resizeNearestNeighbor$2(this,e,t,n)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.reverse=function(e){return this.throwIfDisposed(),reverse$2(this,e)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.rfft=function(){return this.throwIfDisposed(),rfft(this)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.round=function(){return this.throwIfDisposed(),round$2(this)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.rsqrt=function(){return this.throwIfDisposed(),rsqrt$2(this)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.selu=function(){return this.throwIfDisposed(),selu$2(this)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.separableConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),separableConv2d(this,e,t,n,r,a,i)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.sigmoid=function(){return this.throwIfDisposed(),sigmoid$2(this)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.sign=function(){return this.throwIfDisposed(),sign$2(this)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.sin=function(){return this.throwIfDisposed(),sin$2(this)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.sinh=function(){return this.throwIfDisposed(),sinh$2(this)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.slice=function(e,t){return this.throwIfDisposed(),slice$2(this,e,t)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.softmax=function(e){return this.throwIfDisposed(),softmax$2(this,e)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.softplus=function(){return this.throwIfDisposed(),softplus$2(this)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),spaceToBatchND$2(this,e,t)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.split=function(e,t){return this.throwIfDisposed(),split$3(this,e,t)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.sqrt=function(){return this.throwIfDisposed(),sqrt$2(this)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.square=function(){return this.throwIfDisposed(),square$2(this)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.squaredDifference=function(e){return this.throwIfDisposed(),squaredDifference$2(this,e)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.squeeze=function(e){return this.throwIfDisposed(),squeeze(this,e)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.stack=function(e,t){this.throwIfDisposed();const n=e instanceof Tensor?[this,e]:[this,...e];return stack(n,t)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.step=function(e){return this.throwIfDisposed(),step$2(this,e)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.stridedSlice=function(e,t,n,r,a,i,s,o){return this.throwIfDisposed(),stridedSlice$2(this,e,t,n,r,a,i,s,o)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.sub=function(e){return this.throwIfDisposed(),sub$2(this,e)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.sum=function(e,t){return this.throwIfDisposed(),sum$2(this,e,t)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.tan=function(){return this.throwIfDisposed(),tan$2(this)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.tanh=function(){return this.throwIfDisposed(),tanh$2(this)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.tile=function(e){return this.throwIfDisposed(),tile$3(this,e)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.toBool=function(){return this.throwIfDisposed(),cast$3(this,"bool")},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.toFloat=function(){return this.throwIfDisposed(),cast$3(this,"float32")},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.toInt=function(){return this.throwIfDisposed(),cast$3(this,"int32")},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.topk=function(e,t){return this.throwIfDisposed(),topk(this,e,t)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.transpose=function(e){return this.throwIfDisposed(),transpose$2(this,e)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.unique=function(e){return this.throwIfDisposed(),unique$3(this,e)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),unsortedSegmentSum$2(this,e,t)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.unstack=function(e){return this.throwIfDisposed(),unstack(this,e)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.where=function(e,t){return this.throwIfDisposed(),where(e,this,t)},
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
getGlobalTensorClass().prototype.zerosLike=function(){return this.throwIfDisposed(),zerosLike$2(this)};
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */
class AttributeError extends Error{constructor(e){super(e),Object.setPrototypeOf(this,AttributeError.prototype)}}class RuntimeError extends Error{constructor(e){super(e),Object.setPrototypeOf(this,RuntimeError.prototype)}}class ValueError extends Error{constructor(e){super(e),Object.setPrototypeOf(this,ValueError.prototype)}}class NotImplementedError extends Error{constructor(e){super(e),Object.setPrototypeOf(this,NotImplementedError.prototype)}}class AssertionError extends Error{constructor(e){super(e),Object.setPrototypeOf(this,AssertionError.prototype)}}
/**
     * @license
     * Copyright 2022 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */class LruCache{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}put(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const e=this.cache.keys().next().value;this.cache.delete(e)}this.cache.set(e,t)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let t=0;t<this.maxEntries-e;t++){const e=this.cache.keys().next().value;this.cache.delete(e)}this.maxEntries=e}}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */function pyListRepeat(e,t){if(Array.isArray(e)){let n=[];for(let r=0;r<t;r++)n=n.concat(e);return n}{const n=new Array(t);return n.fill(e),n}}function assert(e,t){if(!e)throw new AssertionError(t)}function count(e,t){let n=0;for(const r of e)r===t&&n++;return n}function singletonOrArray(e){return 1===e.length?e[0]:e}function toList(e){return Array.isArray(e)?e:[e]}function toSnakeCase(e){const t=e.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==t[0]?t:"private"+t}function toCamelCase(e){return e.length<=1||-1===e.indexOf("_")?e:e.replace(/[_]+(\w|$)/g,((e,t)=>t.toUpperCase()))}let _GLOBAL_CUSTOM_OBJECTS={};function serializeKerasObject(e){if(null==e)return null;const t={};return t.className=e.getClassName(),t.config=e.getConfig(),t}function convertNDArrayScalarsInConfig(e){if(null!=e&&"object"==typeof e)if(Array.isArray(e))e.forEach((e=>convertNDArrayScalarsInConfig(e)));else{const t=Object.keys(e);for(const n of t){const t=e[n];null!=t&&"object"==typeof t&&(Array.isArray(t)||"ndarray"!==t.type||"number"!=typeof t.value?convertNDArrayScalarsInConfig(t):e[n]=t.value)}}}function deserializeKerasObject(e,t={},n={},r="object",a=!1){if("string"==typeof e){const a=e;let i;if(a in n)i=n[a];else if(a in _GLOBAL_CUSTOM_OBJECTS)i=_GLOBAL_CUSTOM_OBJECTS[a];else if(i=t[a],null==i)throw new ValueError(`Unknown ${r}: ${e}. This may be due to one of the following reasons:\n1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return i}{const i=e;if(null==i.className||null==i.config)throw new ValueError(`${r}: Improper config format: ${JSON.stringify(i)}.\n'className' and 'config' must set.`);const s=i.className;let o,l;if(s in n?[o,l]=n[s]:s in _GLOBAL_CUSTOM_OBJECTS?[o,l]=_GLOBAL_CUSTOM_OBJECTS.className:s in t&&([o,l]=t[s]),null==o)throw new ValueError(`Unknown ${r}: ${s}. This may be due to one of the following reasons:\n1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(null!=l){const e={};for(const n of Object.keys(_GLOBAL_CUSTOM_OBJECTS))e[n]=_GLOBAL_CUSTOM_OBJECTS[n];for(const a of Object.keys(n))e[a]=n[a];i.config.customObjects=e;const t=Object.assign({},_GLOBAL_CUSTOM_OBJECTS);for(const a of Object.keys(n))_GLOBAL_CUSTOM_OBJECTS[a]=n[a];convertNDArrayScalarsInConfig(i.config);const r=l(o,i.config,n,a);return _GLOBAL_CUSTOM_OBJECTS=Object.assign({},t),r}{const e=Object.assign({},_GLOBAL_CUSTOM_OBJECTS);for(const r of Object.keys(n))_GLOBAL_CUSTOM_OBJECTS[r]=n[r];const t=new o(i.config);return _GLOBAL_CUSTOM_OBJECTS=Object.assign({},e),t}}}function numberCompare(e,t){return e<t?-1:e>t?1:0}function reverseNumberCompare(e,t){return-1*numberCompare(e,t)}function unique$2(e){if(null==e)return e;const t=[];for(const n of e)-1===t.indexOf(n)&&t.push(n);return t}function isObjectEmpty(e){if(null==e)throw new ValueError(`Invalid value in obj: ${JSON.stringify(e)}`);for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}function checkStringTypeUnionValue(e,t,n){if(null!=n&&e.indexOf(n)<0)throw new ValueError(`${n} is not a valid ${t}.  Valid values are ${e} or null/undefined.`)}function checkArrayTypeAndLength(e,t,n=0,r=1/0){return assert(n>=0),assert(r>=n),Array.isArray(e)&&e.length>=n&&e.length<=r&&e.every((e=>typeof e===t))}function assertPositiveInteger(e,t){Array.isArray(e)?(assert$1(e.length>0,(()=>`${t} is unexpectedly an empty array.`)),e.forEach(((e,n)=>assertPositiveInteger(e,`element ${n+1} of ${t}`)))):assert$1(Number.isInteger(e)&&e>0,(()=>`Expected ${t} to be a positive integer, but got ${formatAsFriendlyString(e)}.`))}function formatAsFriendlyString(e){return null===e?"null":Array.isArray(e)?"["+e.map((e=>formatAsFriendlyString(e))).join(",")+"]":"string"==typeof e?`"${e}"`:`${e}`}function debounce$1(e,t,n){let r,a=null!=n?n():now();return(...i)=>{const s=null!=n?n():now();return s-a<t||(a=s,r=e(...i)),r}}function mapActivationToFusedKernel(e){return"relu"===e?"relu":"linear"===e?"linear":"elu"===e?"elu":null}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */let _nextUniqueTensorId=0;function getNextUniqueTensorId(){return _nextUniqueTensorId++}const _uidPrefixes={};function getUid(e=""){return e in _uidPrefixes||(_uidPrefixes[e]=0),_uidPrefixes[e]+=1,e+_uidPrefixes[e].toString()}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */const VALID_DATA_FORMAT_VALUES=["channelsFirst","channelsLast"],VALID_INTERPOLATION_FORMAT_VALUES=["nearest","bilinear"],VALID_PADDING_MODE_VALUES=["valid","same","causal"],VALID_POOL_MODE_VALUES=["max","avg"],VALID_BIDIRECTIONAL_MERGE_MODES=["sum","mul","concat","ave"],nameMap=new Map;function checkDataFormat(e){checkStringTypeUnionValue(VALID_DATA_FORMAT_VALUES,"DataFormat",e)}function checkInterpolationFormat(e){checkStringTypeUnionValue(VALID_INTERPOLATION_FORMAT_VALUES,"InterpolationFormat",e)}function checkPaddingMode(e){checkStringTypeUnionValue(VALID_PADDING_MODE_VALUES,"PaddingMode",e)}function checkPoolMode(e){checkStringTypeUnionValue(VALID_POOL_MODE_VALUES,"PoolMode",e)}const _nameScopeStack=[],_nameScopeDivider="/";function nameScope(e,t){_nameScopeStack.push(e);try{const e=t();return _nameScopeStack.pop(),e}catch(e2){throw _nameScopeStack.pop(),e2}}function currentNameScopePrefix(){return 0===_nameScopeStack.length?"":_nameScopeStack.join(_nameScopeDivider)+_nameScopeDivider}function getScopedTensorName(e){if(!isValidTensorName(e))throw new Error("Not a valid tensor name: '"+e+"'");return currentNameScopePrefix()+e}function getUniqueTensorName(e){if(!isValidTensorName(e))throw new Error("Not a valid tensor name: '"+e+"'");nameMap.has(e)||nameMap.set(e,0);const t=nameMap.get(e);if(nameMap.set(e,nameMap.get(e)+1),t>0){const n=`${e}_${t}`;return nameMap.set(n,1),n}return e}const tensorNameRegex=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function isValidTensorName(e){return!!e.match(tensorNameRegex)}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */function isInteger(e){return e===parseInt(e.toString(),10)}function arrayProd(e,t,n){null==t&&(t=0),null==n&&(n=e.length);let r=1;for(let a=t;a<n;++a)r*=e[a];return r}function min$2(e){if(0===e.length)return Number.NaN;let t=Number.POSITIVE_INFINITY;for(let n=0;n<e.length;n++){const r=e[n];r<t&&(t=r)}return t}function max$2(e){if(0===e.length)return Number.NaN;let t=Number.NEGATIVE_INFINITY;for(let n=0;n<e.length;n++){const r=e[n];r>t&&(t=r)}return t}function range$3(e,t){if(t<e)throw new ValueError(`end (${t}) < begin (${e}) is forbidden.`);const n=[];for(let r=e;r<t;++r)n.push(r);return n}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */let _epsilon;function epsilon$1(){return null==_epsilon&&(_epsilon=backend().epsilon()),_epsilon}function imageDataFormat(){return"channelsLast"}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */function cast$2(e,t){return cast$3(e,t)}function expandDims$2(e,t=-1){const n=e.shape.slice();return t<0&&(t=n.length+t+1),n.splice(t,0,1),reshape$2(e,n)}function repeat(e,t){return tidy((()=>{if(2!==e.shape.length)throw new ValueError(`repeat() expects a rank-2 tensor, but received a rank-${e.shape.length} tensor.`);return tile$2(expandDims$2(e,1),[1,t,1])}))}function flatten$1(e){const t=[arrayProd(e.shape)];return reshape$2(e,t)}function batchFlatten(e){if(e.rank<=1)throw new ValueError(`batchFlatten requires a minimum rank of 2. Got rank: ${e.rank}.`);const t=[e.shape[0],arrayProd(e.shape,1)];return reshape$2(e,t)}function sliceAlongFirstAxis(e,t,n){return tidy((()=>{switch(e.rank){case 1:return slice1d(e,t,n);case 2:return slice2d(e,[t,0],[n,e.shape[1]]);case 3:return slice3d(e,[t,0,0],[n,e.shape[1],e.shape[2]]);case 4:return slice4d(e,[t,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3]]);case 5:return slice$2(e,[t,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4]]);case 6:return slice$2(e,[t,0,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4],e.shape[5]]);default:throw new ValueError(`sliceAlongFirstAxis() received an unsupported tensor rank: ${e.rank}`)}}))}function sliceAlongLastAxis(e,t,n){return tidy((()=>{switch(e.rank){case 1:return slice1d(e,t,n);case 2:return slice2d(e,[0,t],[e.shape[0],n]);case 3:return slice3d(e,[0,0,t],[e.shape[0],e.shape[1],n]);case 4:return slice4d(e,[0,0,0,t],[e.shape[0],e.shape[1],e.shape[2],n]);default:throw new ValueError(`sliceAlongLastAxis() received an unsupported tensor rank: ${e.rank}`)}}))}function sliceAlongAxis(e,t,n,r){return tidy((()=>{switch(e.rank){case 1:return slice1d(e,t,n);case 2:switch(r){case 1:return sliceAlongFirstAxis(e,t,n);case 2:return sliceAlongLastAxis(e,t,n);default:throw new ValueError(`The axis is not within the rank of the tensor ${r}`)}case 3:switch(r){case 1:return sliceAlongFirstAxis(e,t,n);case 2:return slice3d(e,[0,t,0],[e.shape[0],n,e.shape[2]]);case 3:return sliceAlongLastAxis(e,t,n);default:throw new ValueError(`The axis is not within the rank of the tensor ${r}`)}case 4:switch(r){case 1:return sliceAlongFirstAxis(e,t,n);case 2:return slice4d(e,[0,t,0,0],[e.shape[0],n,e.shape[2],e.shape[3]]);case 3:return slice4d(e,[0,0,t,0],[e.shape[0],e.shape[1],n,e.shape[3]]);case 4:return sliceAlongLastAxis(e,t,n);default:throw new ValueError(`The axis is not within the rank of the tensor ${r}`)}default:throw new ValueError(`sliceAlongLastAxis() received an unsupported tensor rank: ${e.rank}`)}}))}function concatenate(e,t=-1){let n;return t<0&&(n=e[0].rank,t=0!==n?n:0),t===e[0].rank&&(t=-1),concat$2(e,t)}function concatAlongFirstAxis(e,t){switch(e.rank){case 1:return concat1d([e,t]);case 2:return concat2d([e,t],0);case 3:return concat3d([e,t],0);case 4:return concat4d([e,t],0);default:throw new ValueError(`concatAlongFirstAxis() received an unsupported tensor rank: ${e.rank}`)}}function tile$2(e,t){if(Array.isArray(t)||(t=[t]),e.rank!==t.length)throw new ValueError(`The length of input n (${t.length}) does not match the number of dimensions in input x (${e.rank})`);return tile$3(e,t)}function randomNormal(e,t=0,n=1,r,a){return randomNormal$1(e,t,n,r,a)}function dot(e,t,n,r){if(e.rank<2||t.rank<2)throw new NotImplementedError(`dot requires both inputs to be rank >= 2 but got x shape = ${e.shape} and y shape = ${t.shape}`);if(t.rank>=3){if(e.shape.slice(-1)[0]!==t.shape.slice(-2)[0])throw new NotImplementedError(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${e.shape} and  y shape = ${t.shape}`)}if(2===e.rank&&2===t.rank){return matMul({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?reshapeBias(e.rank,r,imageDataFormat()):null,activation:n})}{const a=e.shape.slice(),i=a.pop();e=reshape$2(e,[-1,i]);const s=t.shape.slice(),o=s.pop(),l=s.pop(),u=[...s,o],c=Array.from({length:t.rank},((e,n)=>0===n?t.rank-2:n<=t.rank-2?n-1:n));t=reshape$2(transpose$2(t,c),[l,-1]);const h=[...a,...u];return reshape$2(matMul({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?reshapeBias(e.rank,r,imageDataFormat()):null,activation:n}),h)}}function gather(e,t,n){return tidy((()=>(t=Array.isArray(t)?tensor1d(t,"int32"):cast$3(t,"int32"),gather$1(e,t,n))))}function square$1(e){return mul(e,e)}function reshapeBias(e,t,n){const r=t.shape;if(1!==t.rank&&t.rank!==e)throw new ValueError(`Unexpected bias dimensions: ${t.rank}; expected it to be 1 or ${e}`);if(5===e){if("channelsFirst"===n)return 1===r.length?reshape$2(t,[1,r[0],1,1,1]):reshape$2(t,[1,r[3],r[0],r[1],r[2]]);if("channelsLast"===n)return 1===r.length?reshape$2(t,[1,1,1,1,r[0]]):reshape$2(t,[1].concat(r))}else if(4===e){if("channelsFirst"===n)return 1===r.length?reshape$2(t,[1,r[0],1,1]):reshape$2(t,[1,r[2],r[0],r[1]]);if("channelsLast"===n)return 1===r.length?reshape$2(t,[1,1,1,r[0]]):reshape$2(t,[1].concat(r))}else if(3===e){if("channelsFirst"===n)return 1===r.length?reshape$2(t,[1,r[0],1]):reshape$2(t,[1,r[1],r[0]]);if("channelsLast"===n)return 1===r.length?reshape$2(t,[1,1,r[0]]):reshape$2(t,[1].concat(r))}else if(e<3)return t;throw new ValueError(`Unsupported input rank by biasAdd: ${t.rank}`)}function biasAdd(e,t,n){return tidy((()=>(null==n&&(n=imageDataFormat()),checkDataFormat(n),add$1(e,reshapeBias(e.rank,t,n)))))}function elu$2(e,t=1){if(1!==t)throw new NotImplementedError(`Support for alpha values other than 1 (${t}) is not implemented yet.`);return elu$3(e)}function softsign(e){return tidy((()=>div$1(e,add$1(abs$2(e),1))))}function dropout(e,t,n,r){return tidy((()=>dropout$1(e,t,n,r)))}function hardSigmoid(e){return tidy((()=>{const t=add$1(.5,mul(.2,e));return clipByValue$2(t,0,1)}))}function inTrainPhase(e,t,n=!1){return n?e():t()}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */const VALID_FAN_MODE_VALUES=["fanIn","fanOut","fanAvg"],VALID_DISTRIBUTION_VALUES=["normal","uniform","truncatedNormal"];
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */
function checkFanMode(e){checkStringTypeUnionValue(VALID_FAN_MODE_VALUES,"FanMode",e)}function checkDistribution(e){checkStringTypeUnionValue(VALID_DISTRIBUTION_VALUES,"Distribution",e)}class Initializer extends Serializable{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class Zeros extends Initializer{apply(e,t){return zeros$1(e,t)}}Zeros.className="Zeros",registerClass(Zeros);class Ones extends Initializer{apply(e,t){return ones(e,t)}}Ones.className="Ones",registerClass(Ones);class Constant extends Initializer{constructor(e){if(super(),"object"!=typeof e)throw new ValueError(`Expected argument of type ConstantConfig but got ${e}`);if(void 0===e.value)throw new ValueError(`config must have value set but got ${e}`);this.value=e.value}apply(e,t){return tidy((()=>mul(scalar(this.value),ones(e,t))))}getConfig(){return{value:this.value}}}Constant.className="Constant",registerClass(Constant);class RandomUniform extends Initializer{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,t){return randomUniform(e,this.minval,this.maxval,t,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}RandomUniform.className="RandomUniform",registerClass(RandomUniform);class RandomNormal extends Initializer{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new NotImplementedError(`randomNormal does not support dType ${t}.`);return randomNormal(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}RandomNormal.className="RandomNormal",registerClass(RandomNormal);class TruncatedNormal extends Initializer{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new NotImplementedError(`truncatedNormal does not support dType ${t}.`);return truncatedNormal(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}TruncatedNormal.className="TruncatedNormal",registerClass(TruncatedNormal);class Identity extends Initializer{constructor(e){super(),this.gain=null!=e.gain?e.gain:1}apply(e,t){return tidy((()=>{if(2!==e.length||e[0]!==e[1])throw new ValueError("Identity matrix initializer can only be used for 2D square matrices.");return mul(this.gain,eye(e[0]))}))}getConfig(){return{gain:this.gain}}}function computeFans(e,t="channelsLast"){let n,r;if(checkDataFormat(t),2===e.length)n=e[0],r=e[1];else if(-1!==[3,4,5].indexOf(e.length)){if("channelsFirst"===t){const t=arrayProd(e,2);n=e[1]*t,r=e[0]*t}else if("channelsLast"===t){const t=arrayProd(e,0,e.length-2);n=e[e.length-2]*t,r=e[e.length-1]*t}}else{const t=arrayProd(e);n=Math.sqrt(t),r=Math.sqrt(t)}return[n,r]}Identity.className="Identity",registerClass(Identity);class VarianceScaling extends Initializer{constructor(e){if(super(),e.scale<0)throw new ValueError(`scale must be a positive float. Got: ${e.scale}`);this.scale=null==e.scale?1:e.scale,this.mode=null==e.mode?"fanIn":e.mode,checkFanMode(this.mode),this.distribution=null==e.distribution?"normal":e.distribution,checkDistribution(this.distribution),this.seed=e.seed}apply(e,t){const n=computeFans(e),r=n[0],a=n[1];let i=this.scale;if("fanIn"===this.mode?i/=Math.max(1,r):"fanOut"===this.mode?i/=Math.max(1,a):i/=Math.max(1,(r+a)/2),"normal"===this.distribution){const n=Math.sqrt(i);if("float32"!==(t=t||"float32")&&"int32"!==t)throw new NotImplementedError(`${this.getClassName()} does not support dType ${t}.`);return truncatedNormal(e,0,n,t,this.seed)}{const n=Math.sqrt(3*i);return randomUniform(e,-n,n,t,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}VarianceScaling.className="VarianceScaling",registerClass(VarianceScaling);class GlorotUniform extends VarianceScaling{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:null==e?null:e.seed})}getClassName(){return VarianceScaling.className}}GlorotUniform.className="GlorotUniform",registerClass(GlorotUniform);class GlorotNormal extends VarianceScaling{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:null==e?null:e.seed})}getClassName(){return VarianceScaling.className}}GlorotNormal.className="GlorotNormal",registerClass(GlorotNormal);class HeNormal extends VarianceScaling{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}getClassName(){return VarianceScaling.className}}HeNormal.className="HeNormal",registerClass(HeNormal);class HeUniform extends VarianceScaling{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}getClassName(){return VarianceScaling.className}}HeUniform.className="HeUniform",registerClass(HeUniform);class LeCunNormal extends VarianceScaling{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}getClassName(){return VarianceScaling.className}}LeCunNormal.className="LeCunNormal",registerClass(LeCunNormal);class LeCunUniform extends VarianceScaling{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}getClassName(){return VarianceScaling.className}}LeCunUniform.className="LeCunUniform",registerClass(LeCunUniform);class Orthogonal extends Initializer{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=null==e.gain?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,t){return tidy((()=>{if(e.length<2)throw new NotImplementedError("Shape must be at least 2D.");if("int32"!==t&&"float32"!==t&&void 0!==t)throw new TypeError(`Unsupported data type ${t}.`);const n=sizeFromShape(e.slice(0,-1)),r=e[e.length-1],a=n*r;a>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${a}) elements: Slowness may result.`);const i=randomNormal([Math.max(r,n),Math.min(r,n)],0,1,t,this.seed),s=linalg.qr(i,!1);let o=s[0];const l=s[1].flatten().stridedSlice([0],[Math.min(r,n)*Math.min(r,n)],[Math.min(r,n)+1]);return o=mul(o,l.sign()),n<r&&(o=o.transpose()),mul(scalar(this.gain),o.reshape(e))}))}getConfig(){return{gain:this.gain,seed:this.seed}}}Orthogonal.className="Orthogonal",registerClass(Orthogonal);const INITIALIZER_IDENTIFIER_REGISTRY_SYMBOL_MAP={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function deserializeInitializer(e,t={}){return deserializeKerasObject(e,SerializationMap.getMap().classNameMap,t,"initializer")}function serializeInitializer(e){return serializeKerasObject(e)}function getInitializer(e){if("string"==typeof e){const t=e in INITIALIZER_IDENTIFIER_REGISTRY_SYMBOL_MAP?INITIALIZER_IDENTIFIER_REGISTRY_SYMBOL_MAP[e]:e;if("GlorotNormal"===t)return new GlorotNormal;if("GlorotUniform"===t)return new GlorotUniform;if("HeNormal"===t)return new HeNormal;if("HeUniform"===t)return new HeUniform;if("LeCunNormal"===t)return new LeCunNormal;if("LeCunUniform"===t)return new LeCunUniform;{const e={};return e.className=t,e.config={},deserializeInitializer(e)}}return e instanceof Initializer?e:deserializeInitializer(e)}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */function isArrayOfShapes(e){return Array.isArray(e)&&Array.isArray(e[0])}function normalizeShapeList(e){return 0===e.length?[]:Array.isArray(e[0])?e:[e]}function getExactlyOneTensor(e){let t;if(Array.isArray(e)){if(1!==e.length)throw new ValueError(`Expected Tensor length to be 1; got ${e.length}`);t=e[0]}else t=e;return t}function getExactlyOneShape(e){if(Array.isArray(e)&&Array.isArray(e[0])){if(1===e.length)return e[0];throw new ValueError(`Expected exactly 1 Shape; got ${e.length}`)}return e}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */function countParamsInWeights(e){let t=0;for(const n of e)0===n.shape.length?t+=1:t+=n.shape.reduce(((e,t)=>e*t));return t}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */const DEFAULT_VARIABLE_NAME_PREFIX="Variable";class LayerVariable{constructor(e,t="float32",n=DEFAULT_VARIABLE_NAME_PREFIX,r=!0,a=null){this.dtype=null==t?"float32":t,this.shape=e.shape,this.id=getNextUniqueTensorId(),n=null==n?DEFAULT_VARIABLE_NAME_PREFIX:n,this.originalName=getScopedTensorName(n),this.name=getUniqueTensorName(this.originalName),this.trainable_=r,this.constraint=a,this.val=variable(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),checkShapesMatch(this.val,e),this.val.id!==e.id&&(this.val.assign(e),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function checkShapesMatch(e,t){if(e.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(e.shape)+" vs. "+JSON.stringify(t.shape))}function batchGetValue(e){return e.map((e=>e.read()))}function batchSetValue(e){e.forEach((e=>{e[0].write(e[1])}))}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */class InputSpec{constructor(e){this.dtype=e.dtype,this.shape=e.shape,null!=e.shape?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class SymbolicTensor{constructor(e,t,n,r,a,i,s){this.dtype=e,this.shape=t,this.sourceLayer=n,this.inputs=r,this.callArgs=a,this.outputTensorIndex=s,this.id=getNextUniqueTensorId(),null!=i&&(this.originalName=getScopedTensorName(i),this.name=getUniqueTensorName(this.originalName)),this.rank=t.length}}let _nextNodeID=0,Node$1=class{constructor(e,t){this.callArgs=t,this.id=_nextNodeID++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const n of e.inboundLayers)null!=n&&n.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const t of this.inboundLayers)null!=t?e.push(t.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}},_nextLayerID=0;class Layer extends Serializable{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=_nextLayerID++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let t=e.name;if(!t){const e=this.getClassName();t=toSnakeCase(e)+"_"+getUid(e)}if(this.name=t,this.trainable_=null==e.trainable||e.trainable,null!=e.inputShape||null!=e.batchInputShape){let t;if(null!=e.batchInputShape)t=e.batchInputShape;else if(null!=e.inputShape){let n=null;null!=e.batchSize&&(n=e.batchSize),t=[n].concat(e.inputShape)}this.batchInputShape=t;let n=e.dtype;null==n&&(n=e.inputDType),null==n&&(n="float32"),this.dtype=n}null!=e.weights?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,t){return e.name+"_ib-"+t.toString()}getNodeAtIndex(e,t){if(0===this.inboundNodes.length)throw new RuntimeError(`The layer has never been called and thus has no defined ${t}.`);if(this.inboundNodes.length<=e)throw new ValueError(`Asked to get ${t} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return singletonOrArray(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return singletonOrArray(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new AttributeError(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(0===this.inboundNodes.length)throw new AttributeError(`Layer ${this.name} is not connected, no input to return.`);return singletonOrArray(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(0===this.inboundNodes.length)throw new AttributeError(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new AttributeError(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return singletonOrArray(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map((e=>e()))}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach((t=>t.trainable=e)),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter((e=>e.trainable)):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter((e=>!e.trainable)).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){const t=toList(e);if(null==this.inputSpec||0===this.inputSpec.length)return;const n=toList(this.inputSpec);if(t.length!==n.length)throw new ValueError(`Layer ${this.name} expects ${n.length} inputs, but it received ${t.length} input tensors. Input received: ${e}`);for(let r=0;r<t.length;r++){const e=t[r],a=n[r];if(null==a)continue;const i=e.rank;if(null!=a.ndim&&i!==a.ndim)throw new ValueError(`Input ${r} is incompatible with layer ${this.name}: expected ndim=${a.ndim}, found ndim=${i}`);if(null!=a.maxNDim&&i>a.maxNDim)throw new ValueError(`Input ${r} is incompatible with layer ${this.name}: expected max_ndim=${a.maxNDim}, found ndim=${i}`);if(null!=a.minNDim&&i<a.minNDim)throw new ValueError(`Input ${r} is incompatible with layer ${this.name}: expected min_ndim=${a.minNDim}, found ndim=${i}.`);if(null!=a.dtype&&e.dtype!==a.dtype)throw new ValueError(`Input ${r} is incompatible with layer ${this.name} : expected dtype=${a.dtype}, found dtype=${e.dtype}.`);if(a.axes){const t=e.shape;for(const e in a.axes){const n=Number(e),i=a.axes[e],s=n>=0?t[n]:t[t.length+n];if(null!=i&&-1===[i,null].indexOf(s))throw new ValueError(`Input ${r} is incompatible with layer ${this.name}: expected axis ${n} of input shape to have value ${i} but got shape ${t}.`)}}if(null!=a.shape)for(let t=0;t<a.shape.length;++t){const n=a.shape[t],i=e.shape[t];if(null!=n&&null!=i&&n!==i)throw new ValueError(`Input ${r} is incompatible with layer ${this.name}: expected shape=${a.shape}, found shape=${e.shape}.`)}}}call(e,t){return e}invokeCallHook(e,t){null!=this._callHook&&this._callHook(e,t)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,t){t=t||{},this.assertNotDisposed();const n=toList(e),r=checkAllSymbolic(e),a=checkNoneSymbolic(e);if(r===a)throw new ValueError("Arguments to apply() must be all SymbolicTensors or all Tensors");return nameScope(this.name,(()=>{if(!this.built){this.assertInputCompatibility(e);const t=[];for(const n of toList(e))t.push(n.shape);this.build(singletonOrArray(t)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),null===this._refCount&&a&&(this._refCount=1)}if(this.assertInputCompatibility(e),a){let r=this.call(e,t);this.supportsMasking&&this.setMaskMetadata(e,r);const a=toList(r),i=[];for(let e of a)-1!==n.indexOf(e)&&(e=e.clone()),i.push(e);if(r=singletonOrArray(i),null!=this.activityRegularizer)throw new NotImplementedError("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return r}{const n=collectInputShape(e),r=this.computeOutputShape(n);let a;const i=guessOutputDType(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?n[0]:n),a=null!=r&&r.length>0&&Array.isArray(r[0])?r.map(((n,r)=>new SymbolicTensor(i,n,this,toList(e),t,this.name,r))):new SymbolicTensor(i,r,this,toList(e),t,this.name),this.addInboundNode(e,a,null,null,n,r,t),this._refCount++,null!=this.activityRegularizer)throw new NotImplementedError("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return a}}))}warnOnIncompatibleInputShape(e){if(null!=this.batchInputShape)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let t=!1;this.batchInputShape.forEach(((n,r)=>{null!=n&&null!=e[r]&&e[r]!==n&&(t=!0)})),t&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new AttributeError(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const t of this.inboundNodes){const n=JSON.stringify(t.outputShapes);-1===e.indexOf(n)&&e.push(n)}if(1===e.length){const e=this.inboundNodes[0].outputShapes;return Array.isArray(e)&&Array.isArray(e[0])&&1===e.length?e[0]:e}throw new AttributeError(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new RuntimeError(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return countParamsInWeights(this.weights)}build(e){this.built=!0}getWeights(e=!1){return batchGetValue(e?this.trainableWeights:this.weights)}setWeights(e){tidy((()=>{const t=this.weights;if(t.length!==e.length)throw new ValueError(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${t.length} weights. Provided weights: ${e}...`);if(0===t.length)return;const n=[],r=batchGetValue(t);for(let a=0;a<r.length;++a){const i=r[a],s=t[a],o=e[a];if(!arraysEqual(i.shape,o.shape))throw new ValueError(`Layer weight shape ${i.shape} not compatible with provided weight shape ${o.shape}`);n.push([s,o])}batchSetValue(n)}))}addWeight(e,t,n,r,a,i,s,o){if(-1!==this._addedWeightNames.indexOf(e))throw new ValueError(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),null==n&&(n="float32"),this.fastWeightInitDuringBuild&&(r=null!=o?o():getInitializer("zeros"));const l=r.apply(t,n),u=new LayerVariable(l,n,e,i,s);return l.dispose(),null!=a&&this.addLoss((()=>a.apply(u.read()))),null==i&&(i=!0),i?this._trainableWeights.push(u):this._nonTrainableWeights.push(u),u}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){null==e||Array.isArray(e)&&0===e.length||(e=toList(e),void 0!==this._losses&&null!==this._losses&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,t){if(!this.supportsMasking){if(null!=t){if(!Array.isArray(t))throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);t.forEach((e=>{if(null!=e)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)}))}return null}return t}setMaskMetadata(e,t,n){if(!this.supportsMasking)return;const r=this.computeMask(e,n),a=toList(t),i=toList(r);if(a.length!==i.length)throw new Error(`${this.name} outputs ${a.length} tensors but ${a.length} masks for those tensors`);for(let s=0;s<a.length;s++)a[s].kerasMask=i[s]}addInboundNode(e,t,n,r,a,i,s=null){const o=toList(e);t=toList(t),n=toList(n),r=toList(r),a=normalizeShapeList(a),i=normalizeShapeList(i);const l=[],u=[],c=[];for(const h of o)l.push(h.sourceLayer),u.push(h.nodeIndex),c.push(h.tensorIndex);new Node$1({outboundLayer:this,inboundLayers:l,nodeIndices:u,tensorIndices:c,inputTensors:o,outputTensors:t,inputMasks:n,outputMasks:r,inputShapes:a,outputShapes:i},s);for(let h=0;h<t.length;h++)t[h].sourceLayer=this,t[h].nodeIndex=this.inboundNodes.length-1,t[h].tensorIndex=h}getConfig(){const e={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(e.batchInputShape=this.batchInputShape),null!=this.dtype&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach((e=>e.dispose())),this.weights.length}assertNotDisposed(){if(0===this._refCount)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(null===this._refCount)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return 0==--this._refCount&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function collectInputShape(e){e=toList(e);const t=[];for(const n of e)t.push(n.shape);return singletonOrArray(t)}function guessOutputDType(e){return"float32"}function getSourceInputs(e,t,n){if((null==t||null!=n&&n>0)&&(t=e.sourceLayer,n=e.nodeIndex),0===t.inboundNodes.length)return[e];{const e=t.inboundNodes[n];if(0===e.inboundLayers.length)return e.inputTensors;{const t=[];for(let n=0;n<e.inboundLayers.length;n++){const r=getSourceInputs(e.inputTensors[n],e.inboundLayers[n],e.nodeIndices[n]);for(const e of r)-1===t.indexOf(e)&&t.push(e)}return t}}}function checkAllSymbolic(e){let t=!0;for(const n of toList(e))if(!(n instanceof SymbolicTensor)){t=!1;break}return t}function checkNoneSymbolic(e){let t=!0;for(const n of toList(e))if(n instanceof SymbolicTensor){t=!1;break}return t}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */class InputLayer extends Layer{constructor(e){if(super({dtype:e.dtype,name:null!=e.name?e.name:getUid("input").toString()}),null==e.batchSize&&(e.batchSize=null),null==e.sparse&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,null!=e.inputShape&&null!=e.batchInputShape)throw new ValueError("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let t=e.batchInputShape;if(null==t){if(null==e.inputShape)throw new ValueError("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");t=[e.batchSize].concat(e.inputShape)}else if(null!=e.batchSize)throw new ValueError("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const n=e.dtype||"float32";this.batchInputShape=t,this.dtype=n,this.inputSpec=[{shape:t}];const r=new SymbolicTensor(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new Node$1({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[t],outputShapes:[t]})}apply(e,t){throw new ValueError(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}function Input(e){if(null==e.batchShape&&null==e.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=e.batchShape&&null!=e.shape)throw new ValueError("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let t=e.batchShape;null!=e.shape&&null==t&&(t=[null].concat(e.shape));let n=e.dtype;null==n&&(n="float32");return new InputLayer({batchInputShape:t,name:e.name,dtype:n,sparse:e.sparse}).inboundNodes[0].outputTensors[0]}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */function assertFeedCompatibility(e,t){if(null==e.dtype||e.dtype===t.dtype)return t;try{return cast$3(t,e.dtype)}catch(err){throw new ValueError(`The dtype of the feed (${t.dtype}) can not be cast to the dtype of the key '${e.name}' (${e.dtype}).`)}}InputLayer.className="InputLayer",registerClass(InputLayer);class FeedDict{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof FeedDict)for(const t in e.id2Value)this.id2Value[t]=e.id2Value[t],t in e.id2Mask&&(this.id2Mask[t]=e.id2Mask[t]);else{if(null==e)return;for(const t of e)this.add(t.key,t.value)}}add(e,t,n){if(null!=this.id2Value[e.id])throw new ValueError(`Duplicate key: name=${e.name}, id=${e.id}`);return this.id2Value[e.id]=assertFeedCompatibility(e,t),this.name2Id[e.name]=e.id,null!=n&&(this.id2Mask[e.id]=n),this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return null!=this.id2Value[e.id]}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof SymbolicTensor){if(null==this.id2Value[e.id])throw new ValueError(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}{const t=this.name2Id[e];if(null==t)throw new ValueError(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[t]}}getMask(e){if(e instanceof SymbolicTensor){if(null==this.id2Value[e.id])throw new ValueError(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}{const t=this.name2Id[e];if(null==t)throw new ValueError(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[t]}}disposeMasks(){null!=this.id2Mask&&dispose(this.id2Mask)}}const cachedSorted=new LruCache,cachedRecipientCounts=new LruCache;function updateCacheMaxEntries(e){null!=cachedSorted&&cachedSorted.setMaxEntries(e),null!=cachedRecipientCounts&&cachedRecipientCounts.setMaxEntries(e)}function execute(e,t,n,r){const a=null!=n&&n.training,i=Array.isArray(e),s=i?e:[e],o=s.map((e=>e.name)),l=[],u=t.names();for(const f of o)-1!==u.indexOf(f)?l.push(t.getValue(f)):l.push(null);null!=r&&(r.maxNumTensors=-1/0,r.minNumTensors=1/0);const c=o.join(",")+"|"+t.names().sort().join(",");let h,d=cachedSorted.get(c);if(null==d){const e=getTopologicalSortAndRecipientCounts(s,t);d=e.sorted,h=e.recipientCounts,cachedSorted.put(c,d),cachedRecipientCounts.put(c,h)}h={},a||Object.assign(h,cachedRecipientCounts.get(c));const p=new FeedDict(t);for(let f=0;f<d.length;++f){if(null!=r){const e=memory().numTensors;e>r.maxNumTensors&&(r.maxNumTensors=e),e<r.minNumTensors&&(r.minNumTensors=e)}const e=d[f],i=e.sourceLayer;if(i instanceof InputLayer)continue;const s=[],u=[],c=[];let m=!1;for(const n of e.inputs){const e=p.getValue(n),r=p.getMask(n);s.push(e),u.push(r),null!=r&&(m=!0),a||(h[n.name]--,0!==h[n.name]||t.hasKey(n)||-1!==o.indexOf(n.name)||e.isDisposed||!0===n.sourceLayer.stateful||c.push(e))}m&&((n=n||{}).mask=u[0]);const g=toList(i.apply(s,n));let y=null;i.supportsMasking&&(y=i.computeMask(s,u));const v=getNodeOutputs(e),b=Array.isArray(v)?v:[v];for(let t=0;t<b.length;++t){p.hasKey(b[t])||p.add(b[t],g[t],Array.isArray(y)?y[0]:y);const e=o.indexOf(b[t].name);-1!==e&&(l[e]=g[t])}a||dispose(c)}return p.disposeMasks(),i?l:l[0]}function getTopologicalSortAndRecipientCounts(e,t){assert$1(null!=e&&e.length>0,(()=>"Expected at least one fetch, got none"));let n=[],r={};if(1===e.length){const a=getTopologicalSortAndRecipientCountsForOneFetch(e[0],t);n=a.sorted,r=a.recipientMap}else{const a=new Set;for(const i of e){const{sorted:e,recipientMap:s}=getTopologicalSortAndRecipientCountsForOneFetch(i,t);for(const t of e)a.has(t.name)||(n.push(t),a.add(t.name));for(const t in s)null==r[t]&&(r[t]=new Set),s[t].forEach((e=>r[t].add(e)))}}return{sorted:n,recipientCounts:recipientMap2Counts(r)}}function recipientMap2Counts(e){const t={};for(const n in e)t[n]=e[n].size;return t}function getTopologicalSortAndRecipientCountsForOneFetch(e,t){const n=new Set,r=[],a={};for(const o of t.names())n.add(o);const i=[],s=[];for(i.push(e);i.length>0;){const e=i[i.length-1];if(n.has(e.name)){i.pop();continue}const t=s[s.length-1]===i.length-1;if(0===e.inputs.length||t)i.pop(),r.push(e),n.add(e.name),t&&s.pop();else{s.push(i.length-1);for(const t of e.inputs)null==a[t.name]&&(a[t.name]=new Set),a[t.name].add(e.name),n.has(t.name)||i.push(t)}}return{sorted:r,recipientMap:a}}function getNodeOutputs(e){let t;if(1===e.sourceLayer.inboundNodes.length)t=e.sourceLayer.output;else{let n=null;for(let t=0;t<e.sourceLayer.inboundNodes.length;++t)for(const r of e.sourceLayer.inboundNodes[t].outputTensors)if(r.id===e.id){n=t;break}t=e.sourceLayer.getOutputAt(n)}return t}
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const ENV$2=env();
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */
function calcL2Norms(e,t){return tidy((()=>sqrt$2(sum$2(mul(e,e),t,!0))))}ENV$2.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",(()=>100),updateCacheMaxEntries);class Constraint extends Serializable{getConfig(){return{}}}class MaxNorm extends Constraint{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=null!=e.maxValue?e.maxValue:this.defaultMaxValue,this.axis=null!=e.axis?e.axis:this.defaultAxis}apply(e){return tidy((()=>{const t=calcL2Norms(e,this.axis),n=clipByValue$2(t,0,this.maxValue);return mul(e,div$1(n,add$1(epsilon$1(),t)))}))}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}MaxNorm.className="MaxNorm",registerClass(MaxNorm);class UnitNorm extends Constraint{constructor(e){super(),this.defaultAxis=0,this.axis=null!=e.axis?e.axis:this.defaultAxis}apply(e){return tidy((()=>div$1(e,add$1(epsilon$1(),calcL2Norms(e,this.axis)))))}getConfig(){return{axis:this.axis}}}UnitNorm.className="UnitNorm",registerClass(UnitNorm);class NonNeg extends Constraint{apply(e){return relu$2(e)}}NonNeg.className="NonNeg",registerClass(NonNeg);class MinMaxNorm extends Constraint{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=null!=e.minValue?e.minValue:this.defaultMinValue,this.maxValue=null!=e.maxValue?e.maxValue:this.defaultMaxValue,this.rate=null!=e.rate?e.rate:this.defaultRate,this.axis=null!=e.axis?e.axis:this.defaultAxis}apply(e){return tidy((()=>{const t=calcL2Norms(e,this.axis),n=add$1(mul(this.rate,clipByValue$2(t,this.minValue,this.maxValue)),mul(1-this.rate,t));return mul(e,div$1(n,add$1(epsilon$1(),t)))}))}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}MinMaxNorm.className="MinMaxNorm",registerClass(MinMaxNorm);const CONSTRAINT_IDENTIFIER_REGISTRY_SYMBOL_MAP={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function serializeConstraint(e){return serializeKerasObject(e)}function deserializeConstraint(e,t={}){return deserializeKerasObject(e,SerializationMap.getMap().classNameMap,t,"constraint")}function getConstraint(e){if(null==e)return null;if("string"==typeof e){return deserializeConstraint({className:e in CONSTRAINT_IDENTIFIER_REGISTRY_SYMBOL_MAP?CONSTRAINT_IDENTIFIER_REGISTRY_SYMBOL_MAP[e]:e,config:{}})}return e instanceof Constraint?e:deserializeConstraint(e)}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */async function resolveScalarsInLogs(e){if(null==e)return;const t=[],n=[],r=[];for(const a in e){const i=e[a];if("number"!=typeof i){const e=i;t.push(e.data()),n.push(a),r.push(e)}}if(t.length>0){const a=await Promise.all(t);for(let t=0;t<a.length;++t)e[n[t]]=a[t][0];dispose(r)}}function disposeTensorsInLogs(e){if(null!=e)for(const t in e){const n=e[t];"number"!=typeof n&&n.dispose()}}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */var ModelLoggingVerbosity,ModelLoggingVerbosity2;ModelLoggingVerbosity2=ModelLoggingVerbosity||(ModelLoggingVerbosity={}),ModelLoggingVerbosity2[ModelLoggingVerbosity2.SILENT=0]="SILENT",ModelLoggingVerbosity2[ModelLoggingVerbosity2.VERBOSE=1]="VERBOSE";const DEFAULT_YIELD_EVERY_MS=125;class BaseCallback{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,t){}async onEpochEnd(e,t){}async onBatchBegin(e,t){}async onBatchEnd(e,t){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class CallbackList{constructor(e,t=10){null==e&&(e=[]),this.callbacks=e,this.queueLength=t}append(e){this.callbacks.push(e)}setParams(e){for(const t of this.callbacks)t.setParams(e)}setModel(e){for(const t of this.callbacks)t.setModel(e)}async onEpochBegin(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onEpochBegin(e,t)}async onEpochEnd(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onEpochEnd(e,t)}async onBatchBegin(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onBatchBegin(e,t)}async onBatchEnd(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onBatchEnd(e,t)}async onTrainBegin(e){null==e&&(e={});for(const t of this.callbacks)await t.onTrainBegin(e)}async onTrainEnd(e){null==e&&(e={});for(const t of this.callbacks)await t.onTrainEnd(e)}}class BaseLogger extends BaseCallback{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,t){null==t&&(t={});const n=null==t.size?0:t.size;this.seen+=n;for(const r in t){const e=t[r];if("number"==typeof e)this.totals.hasOwnProperty(r)||(this.totals[r]=0),this.totals[r]=this.totals[r]+e*n;else{let t;r in this.totals?t=this.totals[r]:this.totals[r]=0;const a=tidy((()=>add$1(this.totals[r],mul(e,n))));this.totals[r]=a,null!=t&&t.dispose()}}}async onEpochEnd(e,t){if(null!=t)for(const n of this.params.metrics)null!=this.totals[n]&&("number"==typeof this.totals[n]?t[n]=this.totals[n]/this.seen:tidy((()=>{const e=mul(div$1(1,this.seen),this.totals[n]);t[n]=e,this.totals[n].dispose(),keep(t[n])})))}}class History extends BaseCallback{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,t){null==t&&(t={}),this.epoch.push(e);for(const n in t)null==this.history[n]&&(this.history[n]=[]),this.history[n].push(t[n])}async syncData(){const e=[],t=[],n=[];for(const a in this.history){const r=this.history[a];for(let i=0;i<r.length;++i)if("number"!=typeof r[i]){const s=r[i];e.push(s.data()),t.push(a),n.push(i)}}const r=await Promise.all(e);for(let a=0;a<r.length;++a){this.history[t[a]][n[a]].dispose(),this.history[t[a]][n[a]]=r[a][0]}}}class CustomCallback extends BaseCallback{constructor(e,t){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||nextFrame,this.yieldEvery=t||"auto","auto"===this.yieldEvery&&(this.yieldEvery=DEFAULT_YIELD_EVERY_MS),"never"===this.yieldEvery&&null!=e.onYield)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");isNumber(this.yieldEvery)&&(this.maybeWait=debounce$1(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,t,n){const r=[];null!=this.yield&&(await resolveScalarsInLogs(n),r.push(this.yield(e,t,n))),r.push(this.nextFrameFunc()),await Promise.all(r)}async onEpochBegin(e,t){this.currentEpoch=e,null!=this.epochBegin&&(await resolveScalarsInLogs(t),await this.epochBegin(e,t))}async onEpochEnd(e,t){const n=[];null!=this.epochEnd&&(await resolveScalarsInLogs(t),n.push(this.epochEnd(e,t))),"epoch"===this.yieldEvery&&n.push(this.nextFrameFunc()),await Promise.all(n)}async onBatchBegin(e,t){null!=this.batchBegin&&(await resolveScalarsInLogs(t),await this.batchBegin(e,t))}async onBatchEnd(e,t){const n=[];null!=this.batchEnd&&(await resolveScalarsInLogs(t),n.push(this.batchEnd(e,t))),"batch"===this.yieldEvery?n.push(this.nextFrameFunc()):isNumber(this.yieldEvery)&&n.push(this.maybeWait(this.currentEpoch,e,t)),await Promise.all(n)}async onTrainBegin(e){null!=this.trainBegin&&(await resolveScalarsInLogs(e),await this.trainBegin(e))}async onTrainEnd(e){null!=this.trainEnd&&(await resolveScalarsInLogs(e),await this.trainEnd(e))}}function standardizeCallbacks(e,t){if(null==e&&(e={}),e instanceof BaseCallback)return[e];if(Array.isArray(e)&&e[0]instanceof BaseCallback)return e;return toList(e).map((e=>new CustomCallback(e,t)))}class CallbackConstructorRegistry{constructor(){}static registerCallbackConstructor(e,t){assert$1(e>=0&&Number.isInteger(e),(()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`)),CallbackConstructorRegistry.checkForDuplicate(t),null==CallbackConstructorRegistry.constructors[e]&&(CallbackConstructorRegistry.constructors[e]=[]),CallbackConstructorRegistry.constructors[e].push(t)}static checkForDuplicate(e){for(const t in CallbackConstructorRegistry.constructors){CallbackConstructorRegistry.constructors[+t].forEach((t=>{if(t===e)throw new ValueError("Duplicate callback constructor.")}))}}static clear(){CallbackConstructorRegistry.constructors={}}static createCallbacks(e){const t=[];for(const n in CallbackConstructorRegistry.constructors){const r=+n;e>=r&&t.push(...CallbackConstructorRegistry.constructors[r])}return t.map((e=>new e))}}function configureCallbacks(e,t,n,r,a,i,s,o,l){const u=new History,c=[new BaseLogger,...CallbackConstructorRegistry.createCallbacks(t)];null!=e&&c.push(...e),c.push(u);const h=new CallbackList(c);return h.setParams({epochs:n,initialEpoch:r,samples:a,steps:i,batchSize:s,verbose:t,doValidation:o,metrics:l}),{callbackList:h,history:u}}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */function deserialize(e,t={},n=!1){return deserializeKerasObject(e,SerializationMap.getMap().classNameMap,t,"layer",n)}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */function l2Normalize(e,t){return tidy((()=>{"float32"!==e.dtype&&(e=cast$3(e,"float32"));const n=sum$2(square$1(e),t,!0),r=fill$2(n.shape,epsilon$1()),a=sqrt$2(maximum$2(n,r));return div$1(e,a)}))}function meanSquaredError(e,t){return tidy((()=>mean$1(square$1(sub$2(t,e)),-1)))}function meanAbsoluteError(e,t){return tidy((()=>mean$1(abs$2(sub$2(t,e)),-1)))}function meanAbsolutePercentageError(e,t){return tidy((()=>{const n=sub$2(e,t),r=clipByValue$2(abs$2(e),epsilon$1(),Number.MAX_VALUE),a=abs$2(div$1(n,r));return mul(100,mean$1(a,-1))}))}function meanSquaredLogarithmicError(e,t){return tidy((()=>{const n=clipByValue$2(t,epsilon$1(),Number.MAX_VALUE),r=log$4(add$1(1,n)),a=clipByValue$2(e,epsilon$1(),Number.MAX_VALUE),i=log$4(add$1(1,a));return mean$1(square$1(sub$2(r,i)),-1)}))}function squaredHinge(e,t){return tidy((()=>{const n=maximum$2(0,sub$2(1,mul(e,t)));return mean$1(square$1(n),-1)}))}function hinge(e,t){return tidy((()=>{const n=maximum$2(0,sub$2(1,mul(e,t)));return mean$1(n,-1)}))}function categoricalHinge(e,t){return tidy((()=>{const n=sum$2(mul(e,t),-1),r=max$3(mul(sub$2(1,e),t),-1);return maximum$2(0,add$1(1,sub$2(r,n)))}))}function logcosh(e,t){return tidy((()=>{const n=Math.log(2),r=sub$2(t,e),a=sub$2(add$1(r,softplus$2(mul(-2,r))),n);return mean$1(a,-1)}))}function categoricalCrossentropy$1(e,t,n=!1){return tidy((()=>{if(n)t=softmax$2(t);else{const e=sum$2(t,t.shape.length-1,!0);t=div$1(t,e)}return t=clipByValue$2(t,epsilon$1(),1-epsilon$1()),neg$2(sum$2(mul(cast$3(e,"float32"),log$4(t)),t.shape.length-1))}))}function sparseCategoricalCrossentropy$1(e,t,n=!1){return tidy((()=>{const r=cast$3(floor$2(flatten$1(e)),"int32"),a=(t=clipByValue$2(t,epsilon$1(),1-epsilon$1())).shape;return categoricalCrossentropy$1(reshape$2(oneHot$2(r,a[a.length-1]),a),t,n)}))}function sigmoidCrossEntropyWithLogits(e,t){if(!arraysEqual(e.shape,t.shape))throw new ValueError(`logits and labels must have the same shape, but got shapes ${JSON.stringify(e.shape)} and ${JSON.stringify(t.shape)}`);return tidy((()=>{const n=relu$2(t),r=neg$2(abs$2(t));return add$1(sub$2(n,mul(t,e)),log1p$2(exp$2(r)))}))}function binaryCrossentropy$1(e,t){return tidy((()=>{let n;return n=clipByValue$2(t,epsilon$1(),1-epsilon$1()),n=log$4(div$1(n,sub$2(1,n))),mean$1(sigmoidCrossEntropyWithLogits(e,n),-1)}))}function kullbackLeiblerDivergence(e,t){return tidy((()=>{const n=clipByValue$2(e,epsilon$1(),1),r=clipByValue$2(t,epsilon$1(),1);return sum$2(mul(e,log$4(div$1(n,r))),-1)}))}function poisson(e,t){return tidy((()=>{const n=log$4(add$1(epsilon$1(),t));return mean$1(sub$2(t,mul(e,n)),-1)}))}function cosineProximity(e,t){return tidy((()=>{const n=l2Normalize(e,-1),r=l2Normalize(t,-1),a=mul(n,r);return neg$2(sum$2(a,-1))}))}CallbackConstructorRegistry.constructors={};const lossesMap={meanSquaredError:meanSquaredError,meanAbsoluteError:meanAbsoluteError,meanAbsolutePercentageError:meanAbsolutePercentageError,meanSquaredLogarithmicError:meanSquaredLogarithmicError,squaredHinge:squaredHinge,hinge:hinge,categoricalHinge:categoricalHinge,logcosh:logcosh,categoricalCrossentropy:categoricalCrossentropy$1,sparseCategoricalCrossentropy:sparseCategoricalCrossentropy$1,binaryCrossentropy:binaryCrossentropy$1,kullbackLeiblerDivergence:kullbackLeiblerDivergence,poisson:poisson,cosineProximity:cosineProximity};function get$2(e){if("string"==typeof e){if(e in lossesMap)return lossesMap[e];let t=`Unknown loss ${e}`;throw e.toLowerCase().includes("softmaxcrossentropy")&&(t=`Unknown loss ${e}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new ValueError(t)}return e}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */function binaryAccuracy(e,t){return tidy((()=>{const n=mul(.5,onesLike$2(t)),r=cast$2(greater$2(t,n),e.dtype);return mean$1(equal$2(e,r),-1)}))}function categoricalAccuracy(e,t){return tidy((()=>cast$2(equal$2(argMax$2(e,-1),argMax$2(t,-1)),"float32")))}function truePositives(e,t){return tidy((()=>cast$3(sum$2(logicalAnd$2(equal$2(e,1),equal$2(t,1))),"float32")))}function falsePositives(e,t){return tidy((()=>cast$3(sum$2(logicalAnd$2(equal$2(e,0),equal$2(t,1))),"float32")))}function precision(e,t){return tidy((()=>{const n=truePositives(e,t),r=falsePositives(e,t),a=add$1(n,r);return cast$3(where(greater$2(a,0),div$1(n,a),0),"float32")}))}function binaryCrossentropy(e,t){return binaryCrossentropy$1(e,t)}function sparseCategoricalAccuracy(e,t){return e.rank===t.rank&&(e=squeeze(e,[e.rank-1])),(t=argMax$2(t,-1)).dtype!==e.dtype&&(t=cast$3(t,e.dtype)),cast$3(equal$2(e,t),"float32")}const mse=meanSquaredError,MSE=meanSquaredError,mae=meanAbsoluteError,MAE=meanAbsoluteError,mape=meanAbsolutePercentageError,MAPE=meanAbsolutePercentageError,categoricalCrossentropy=categoricalCrossentropy$1,cosine=cosineProximity,sparseCategoricalCrossentropy=sparseCategoricalCrossentropy$1,metricsMap={binaryAccuracy:binaryAccuracy,categoricalAccuracy:categoricalAccuracy,precision:precision,categoricalCrossentropy:categoricalCrossentropy,sparseCategoricalCrossentropy:sparseCategoricalCrossentropy,mse:mse,MSE:MSE,mae:mae,MAE:MAE,mape:mape,MAPE:MAPE,cosine:cosine};function get$1(e){if("string"==typeof e&&e in metricsMap)return metricsMap[e];if("string"!=typeof e&&null!=e)return e;throw new ValueError(`Unknown metric ${e}`)}function getLossOrMetricName(e){if(assert(null!==e,`Unknown LossOrMetricFn ${e}`),"string"==typeof e)return e;{let t;for(const n of Object.keys(lossesMap))if(lossesMap[n]===e){t=n;break}if(void 0!==t)return t;for(const n of Object.keys(metricsMap))if(metricsMap[n]===e){t=n;break}return void 0!==t?t:e.name}}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */function getOptimizer(e){const t={Adagrad:()=>train.adagrad(.01),Adadelta:()=>train.adadelta(1,.95,epsilon$1()),Adam:()=>train.adam(.001,.9,.999,epsilon$1()),Adamax:()=>train.adamax(.002,.9,.999,epsilon$1(),0),RMSProp:()=>train.rmsprop(.001,.9,0,epsilon$1()),SGD:()=>train.sgd(.01)};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,e in t)return t[e]();throw new ValueError(`Unknown Optimizer ${e}`)}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */const MAX_USER_DEFINED_METADATA_SERIALIZED_LENGTH=1048576;function checkUserDefinedMetadata(e,t,n=!1){if(null==e||"object"!=typeof e||Object.getPrototypeOf(e)!==Object.prototype||!plainObjectCheck(e))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){const n=JSON.stringify(e);n.length>MAX_USER_DEFINED_METADATA_SERIALIZED_LENGTH&&console.warn(`User-defined metadata of model "${t}" is too large in size (length=${n.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${MAX_USER_DEFINED_METADATA_SERIALIZED_LENGTH}.`)}}function plainObjectCheck(e){if(null===e)return!0;if("object"==typeof e){if(Object.getPrototypeOf(e)===Object.prototype){const t=Object.keys(e);for(const n of t){if("string"!=typeof n)return!1;if(!plainObjectCheck(e[n]))return!1}return!0}if(Array.isArray(e)){for(const t of e)if(!plainObjectCheck(t))return!1;return!0}return!1}{const t=typeof e;return"string"===t||"number"===t||"boolean"===t}}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */function printSummary(e,t,n,r=console.log){const a=isModelSequentialLike(e),i=["Layer (type)","Input Shape","Output shape","Param #"];let s;if(a?(t=t||90,n=n||[.32,.61,.89,1]):(t=t||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map((e=>Math.floor(t*e)))),!a){i.push("Receives inputs"),s=[];for(const t in e.nodesByDepth)s.push(...e.nodesByDepth[t])}r("_".repeat(t)),printRow(i,n,r),r("=".repeat(t));const o=e.layers;for(let c=0;c<o.length;++c)a?printLayerSummary(o[c],n,r):printLayerSummaryWithConnections(o[c],n,s,r),r((c===o.length-1?"=":"_").repeat(t));e.checkTrainableWeightsConsistency();const l=countTrainableParams(e),u=countParamsInWeights(e.nonTrainableWeights);r(`Total params: ${l+u}`),r(`Trainable params: ${l}`),r(`Non-trainable params: ${u}`),r("_".repeat(t))}function countTrainableParams(e){let t;return t=null!=e.collectedTrainableWeights?countParamsInWeights(e.collectedTrainableWeights):countParamsInWeights(e.trainableWeights),t}function isModelSequentialLike(e){let t=!0;const n=[],r=[];for(const a in e.nodesByDepth)n.push(e.nodesByDepth[a]);for(const a of n){if(a.length>1||1===a.length&&a[0].inboundLayers.length>1){t=!1;break}r.push(...a)}if(t)for(const a of e.layers){let e=!1;for(const n of a.inboundNodes)if(-1!==r.indexOf(n)){if(e){t=!1;break}e=!0}if(!t)break}return t}function printRow(e,t,n=console.log){let r="";for(let a=0;a<e.length;++a)a>0&&(r=r.slice(0,r.length-1)+" "),r+=e[a],r=r.slice(0,t[a]),r+=" ".repeat(t[a]-r.length);n(r)}function printLayerSummary(e,t,n){let r,a;try{a=e.inboundNodes.map((e=>JSON.stringify(e.inputShapes))).join(",")}catch(err){a="multiple"}try{r=JSON.stringify(e.outputShape)}catch(err){r="multiple"}printRow([`${e.name} (${e.getClassName()})`,a,r,e.countParams().toString()],t,n)}function printLayerSummaryWithConnections(e,t,n,r){let a,i;try{i=e.inboundNodes.map((e=>JSON.stringify(e.inputShapes))).join(",")}catch(err){i="multiple"}try{a=JSON.stringify(e.outputShape)}catch(err){a="multiple"}const s=[];for(const c of e.inboundNodes)if(!(null!=n&&n.length>0&&-1===n.indexOf(c)))for(let e=0;e<c.inboundLayers.length;++e){const t=c.inboundLayers[e].name,n=c.nodeIndices[e],r=c.tensorIndices[e];s.push(`${t}[${n}][${r}]`)}const o=e.name,l=e.getClassName(),u=0===s.length?"":s[0];printRow([`${o} (${l})`,i,a,e.countParams().toString(),u],t,r);for(let c=1;c<s.length;++c)printRow(["","","","",s[c]],t,r)}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */function isArrayItemInputOrOutputName(e,t,n){return("inboundNodes"===e||"outputLayers"===e||"inputLayers"===e)&&0===t&&"string"==typeof n}function convertPythonicToTs(e,t){if(null===e)return null;if("string"==typeof e)return toCamelCase(e);if("number"==typeof e||"boolean"==typeof e)return e;if(e instanceof Array){const n=[],r=e.length;for(let a=0;a<r;++a){const r=e[a];isArrayItemInputOrOutputName(t,a,r)?n.push(r):n.push(convertPythonicToTs(r,t))}return n}{const t={};for(const n of Object.keys(e)){const r=e[n];if("name"===n&&"string"==typeof r)t[n]=r;else{const e=toCamelCase(n);t[e]=convertPythonicToTs(r,e)}}return t}}function convertTsToPythonic(e,t){if(null==e)return null;if("string"==typeof e)return toSnakeCase(e);if("number"==typeof e||"boolean"==typeof e)return e;if(e instanceof Array){const n=[],r=e.length;for(let a=0;a<r;++a){const r=e[a];isArrayItemInputOrOutputName(t,a,r)?n.push(r):n.push(convertTsToPythonic(r,t))}return n}{const t={};for(const n of Object.keys(e)){const r=e[n],a=toSnakeCase(n);t[a]="name"!==n&&"className"!==n||"string"!=typeof r?convertTsToPythonic(r,n):r}return t}}
/** @license See the LICENSE file. */const version$7="4.13.0",isKerasSavedModelFormat=e=>{const t=Object.keys(e);if(0===t.length)return!1;const n=t[0].split("/");return!isNaN(parseInt(n[n.length-1],10))};
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */class Container extends Layer{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,null==this.name){const e=this.getClassName().toLowerCase();this.name=getUid(e)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],unique$2(this.inputs).length!==this.inputs.length)throw new ValueError(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map((e=>e.name))}`);unique$2(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map((e=>e.name))}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const y of this.outputs){const e=y.sourceLayer,t=y.nodeIndex,n=y.tensorIndex;this.outputLayers.push(e),this.outputLayersNodeIndices.push(t),this.outputLayersTensorIndices.push(n)}for(const y of this.inputs){const e=y.sourceLayer,t=y.nodeIndex,n=y.tensorIndex;assert(0===t,"input layer has >1 nodes"),assert(0===n,"input layer has >1 tensors"),this.inputLayers.push(e),this.inputLayersNodeIndices.push(t),this.inputLayersTensorIndices.push(n)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let y=0;y<this.inputLayers.length;y++){const t=this.inputLayers[y];if(!(t instanceof InputLayer))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${y} (0-based) originates from layer type ${t.getClassName()}.`);this.inputNames.push(t.name),this.feedInputShapes.push(t.batchInputShape),this.feedInputNames.push(t.name)}for(const y of this.outputLayers)this.outputNames.push(y.name);this.internalInputShapes=this.inputs.map((e=>e.shape)),this.internalOutputShapes=this.outputs.map((e=>e.shape));const t={},n={},r={},a={},i={},s=[],o=(e,t,n,r,a,l)=>{null!=r&&null!=a&&null!=l||(r=e.sourceLayer,a=e.nodeIndex,l=e.tensorIndex);const u=r.inboundNodes[a];if(-1!==n.indexOf(u))throw new RuntimeError(`The tensor ${e.name} at layer "${r.name}" is part of a cycle.`);if(-1!==t.indexOf(u))return;this.containerNodes.add(Container.nodeKey(r,a)),r.id in i||(i[r.id]=Object.keys(i).length),-1===n.indexOf(u)&&n.push(u);const c=u.inboundLayers.length;for(let i=0;i<c;i++){const e=u.inputTensors[i],r=u.inboundLayers[i],a=u.nodeIndices[i],s=u.tensorIndices[i];o(e,t,n,r,a,s)}for(t.push(u);n.indexOf(u)>=0;)n.splice(n.indexOf(u),1);s.push(u)},l=[],u=[];for(const y of this.outputs)o(y,l,u);const c=s.slice().reverse();for(const y of c){n[y.id]=y,y.id in t||(t[y.id]=0);let e=t[y.id];const i=null==r[y.outboundLayer.id]?0:r[y.outboundLayer.id];e=Math.max(e,i),r[y.outboundLayer.id]=e,a[y.outboundLayer.id]=y.outboundLayer,t[y.id]=e;for(let r=0;r<y.inboundLayers.length;r++){const a=y.inboundLayers[r],i=y.nodeIndices[r],s=a.inboundNodes[i],o=null==t[s.id]?0:t[s.id];t[s.id]=Math.max(e+1,o),n[s.id]=s}}const h={};for(const y in t){const e=t[y];e in h||(h[e]=[]),h[e].push(n[y])}const d={};for(const y in r){const e=r[y];e in d||(d[e]=[]),d[e].push(a[y])}let p=Object.keys(d).map((e=>parseInt(e,10))).sort(reverseNumberCompare);this.layers=[];for(const y of p){const e=d[y];e.sort(((e,t)=>{const n=i[e.id],r=i[t.id];return n<r?-1:n>r?1:0}));for(const t of e)t instanceof Container&&this.internalContainerRefs.push(t),this.layers.push(t)}this.layersByDepth=d,p=Object.keys(h).map((e=>parseInt(e,10))).sort(reverseNumberCompare);const f=this.inputs.slice(),m=[];for(const y of p)for(const e of h[y]){const t=e.outboundLayer;if(null!=t){for(const n of e.inputTensors)if(-1===f.indexOf(n))throw new RuntimeError(`Graph disconnected: cannot obtain value for tensor ${n} at layer "${t.name}". The following previous layers were accessed without issue: ${m}`);for(const t of e.outputTensors)f.push(t);m.push(t.name)}}this.nodesByDepth=h;const g=this.layers.map((e=>e.name));for(const y of g){const e=g.filter((e=>e===y)).length;if(1!==e)throw new RuntimeError(`The name "${y}" is used ${e} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(g))}this.outboundNodes=[],this.inboundNodes=[],new Node$1({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map((e=>null)),outputMasks:this.outputs.map((e=>null)),inputShapes:this.inputs.map((e=>e.shape)),outputShapes:this.outputs.map((e=>e.shape))}),this.built=!0,this._refCount=1}assertNotDisposed(){if(0===this._refCount)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(0==--this._refCount){for(const t of this.layers)e.numDisposedVariables+=t.dispose().numDisposedVariables;for(const t of this.internalContainerRefs)e.numDisposedVariables+=t.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach((t=>{t._trainableWeights.forEach((t=>t.trainable=e))})),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new ValueError("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const t of this.layers)e=e.concat(t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.layers)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const e of this.layers)t.push(...e.trainableWeights);return t.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,t=!0){const n={};let r=0;const a=isKerasSavedModelFormat(e);a&&this.parseWeights(e);for(const s of this.layers)for(const[e,t]of s.weights.entries()){const i=a?`${t.name.split("/").slice(0,-1).join("/")+"/"}${e}`:t.originalName;if(null!=n[i])throw new ValueError(`Duplicate weight name: ${i}`);n[i]=t,r++}const i=[];for(const s in e){let r=s;if(null==n[s]){const e=s.split("/");r=e.slice(0,-2).concat([e[e.length-1]]).join("/")}if(null!=n[r])i.push([n[r],e[s]]);else if(t)throw new ValueError(`Provided weight data has no target variable: ${s}`);delete n[r]}if(t){const e=[];for(const t in n)e.push(t);if(e.length>0)throw new ValueError(`${e.length} of ${r} weights are not set: ${e}`)}batchSetValue(i)}parseWeights(e){for(const t in Object.keys(e)){const n=t.split("/"),r=["vars","layer_checkpoint_dependencies"],a=n.map((e=>e.startsWith("_")?e.slice(1):e)).filter((e=>!r.includes(e))).join("/");a!==t&&(e[a]=e[t],delete e[t])}}updatedConfig(){const e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion=`tfjs-layers ${version$7}`,t.backend="TensorFlow.js",t}toJSON(e,t=!0){const n=convertTsToPythonic(this.updatedConfig());return t?JSON.stringify(n):n}call(e,t){return tidy((()=>{e=toList(e);const n=new FeedDict;for(let t=0;t<this.inputs.length;++t)n.add(this.inputs[t],e[t]);return execute(this.outputs,n,t)}))}computeMask(e,t){return tidy((()=>{let n;return e=toList(e),n=null==t?pyListRepeat(null,e.length):toList(t),this.runInternalGraph(e,n)[1]}))}computeOutputShape(e){const t=normalizeShapeList(e);if(t.length!==this.inputLayers.length)throw new ValueError(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const n={};for(let s=0;s<t.length;s++){const e=this.inputLayers[s],r=t[s];n[e.name+"_0_0"]=r}const r=Object.keys(this.nodesByDepth).map((e=>parseInt(e,10))).sort(reverseNumberCompare);if(r.length>1)for(const s of r){const e=this.nodesByDepth[s];for(const t of e){const e=t.outboundLayer;if(-1!==this.inputLayers.map((e=>e.id)).indexOf(e.id))continue;const r=[];for(let s=0;s<t.inboundLayers.length;s++){const e=t.inboundLayers[s],a=t.nodeIndices[s],i=t.tensorIndices[s],o=n[`${e.name}_${a}_${i}`];r.push(o)}const a=normalizeShapeList(e.computeOutputShape(singletonOrArray(r))),i=e.inboundNodes.indexOf(t);for(let t=0;t<a.length;t++){n[`${e.name}_${i}_${t}`]=a[t]}}}const a=[],i=[];for(let s=0;s<this.outputLayers.length;s++){const e=this.outputLayers[s],t=this.outputLayersNodeIndices[s],n=this.outputLayersTensorIndices[s],r=`${e.name}_${t}_${n}`;i.push(r)}for(let s=0;s<i.length;s++){const e=i[s];assert(e in n),a.push(n[e])}return singletonOrArray(a)}runInternalGraph(e,t){null==t&&(t=pyListRepeat(null,e.length));const n={};for(let o=0;o<this.inputs.length;++o){const r=this.inputs[o],a=e[o],i=t[o];n[r.id]=[a,i]}const r=Object.keys(this.nodesByDepth).map((e=>parseInt(e,10))).sort(reverseNumberCompare);for(const o of r){const e=this.nodesByDepth[o];for(const t of e){const e=t.outboundLayer,r=t.inputTensors,a=t.outputTensors,i=new Array;for(const t of r)t.id in n&&i.push(n[t.id]);if(i.length===r.length){let r,s,o,l,u={};if(null!=t.callArgs&&(u=t.callArgs),1===i.length){const[t,n]=i[0];null==u.mask&&(u.mask=n),o=toList(e.call(t,u)),l=toList(e.computeMask(t,n)),r=[t],s=[n]}else r=i.map((e=>e[0])),s=i.map((e=>e[1])),null==u.mask&&(u.mask=s),o=toList(e.call(r,u)),l=toList(e.computeMask(r,s));if(e.activityRegularizer)throw new NotImplementedError("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let e=0;e<a.length;++e){const t=a[e],r=o[e],i=l[e];n[t.id]=[r,i]}}}}const a=[],i=[],s=[];for(const o of this.outputs){assert(o.id in n,`Could not compute output ${o.name} : ${o.id}`);const[e,t]=n[o.id];s.push(e.shape),a.push(e),i.push(t)}return[a,i,s]}buildNodeConversionMap(e){const t={};let n;for(const r of this.layers){n=r instanceof Container?1:0;for(let e=0;e<r.inboundNodes.length;e++){const a=Container.nodeKey(r,e);this.containerNodes.has(a)&&(t[a]=n,n+=1)}}return t}getLayer(e,t){if(null!=t)return this.findLayer(t);if(null==e)throw new ValueError("Provide either a layer name or layer index");if("number"==typeof e)return this.findLayer(e);for(const n of this.layers)if(n.name===e)return n;throw new ValueError(`No such layer: ${e}`)}findLayer(e){if(this.layers.length<=e)throw new ValueError(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}calculateLosses(){return tidy((()=>{const e=[];for(const t of this.layers)for(let n=0;n<t.inboundNodes.length;++n){const r=Container.nodeKey(t,n);this.containerNodes.has(r)&&e.push(...t.calculateLosses())}return e}))}getConfig(){const e={name:this.name},t=this.buildNodeConversionMap(this.layers),n=[];for(const i of this.layers){const e=i.getClassName(),r=i.getConfig(),a=[];for(let n=0;n<i.inboundNodes.length;n++){const e=i.inboundNodes[n],r=Container.nodeKey(i,n);let s={};if(this.containerNodes.has(r)){if(e.callArgs)try{JSON.stringify(e.callArgs),s=e.callArgs}catch(err){console.warn(`Layer ${i.name} was passed non-serializable keyword arguments: ${e.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),s={}}if(e.inboundLayers.length>0){const n=[];for(let r=0;r<e.inboundLayers.length;r++){const a=e.inboundLayers[r],i=e.nodeIndices[r],o=e.tensorIndices[r];let l=t[Container.nodeKey(a,i)];null==l&&(l=0),n.push([a.name,l,o,s])}a.push(n)}}}const s={};s.name=i.name,s.className=e,s.config=r,s.inboundNodes=a,n.push(s)}e.layers=n;const r=[];for(let i=0;i<this.inputLayers.length;i++){const e=this.inputLayers[i],n=this.inputLayersNodeIndices[i],a=Container.nodeKey(e,n);if(!this.containerNodes.has(a))continue;let s=t[a];null==s&&(s=0);const o=this.inputLayersTensorIndices[i];r.push([e.name,s,o])}e.inputLayers=r;const a=[];for(let i=0;i<this.outputLayers.length;i++){const e=this.outputLayers[i],n=this.outputLayersNodeIndices[i],r=Container.nodeKey(e,n);if(!this.containerNodes.has(r))continue;let s=t[r];null==s&&(s=0);const o=this.outputLayersTensorIndices[i];a.push([e.name,s,o])}return e.outputLayers=a,e}static fromConfig(e,t,n={},r=!1){const a={},i={};function s(e,t){e.name in i?i[e.name].push(t):i[e.name]=[t]}function o(e,t){const n=[];let r;for(const i of t){const o=i[0],l=i[1],u=i[2];if(r=null==i[3]?{}:i[3],!(o in a))return void s(e,t);const c=a[o];if(c.inboundNodes.length<=l)return void s(e,t);const h=c.inboundNodes[l];n.push(h.outputTensors[u])}n.length>0&&e.apply(singletonOrArray(n),r)}function l(e){const n=e.name,i=deserialize(e,null!=t.customObjects?t.customObjects:{});i.setFastWeightInitDuringBuild(r),a[n]=i;e.inboundNodes.forEach((e=>{if(!(e instanceof Array))throw new ValueError(`Corrupted configuration, expected array for nodeData: ${e}`);s(i,e)}))}const u=t.name,c=t.layers;for(const m of c)l(m);for(;!isObjectEmpty(i);)for(const e of c){const t=a[e.name];if(t.name in i){const e=i[t.name];delete i[t.name];for(const n of e)o(t,n)}}const h=[],d=[],p=t.inputLayers;for(const m of p){const e=m[0],t=m[1],n=m[2];assert(e in a);const r=a[e].inboundNodes[t].outputTensors;h.push(r[n])}const f=t.outputLayers;for(const m of f){const e=m[0],t=m[1],n=m[2];assert(e in a);const r=a[e].inboundNodes[t].outputTensors;d.push(r[n])}return new e({inputs:h,outputs:d,name:u})}get stateful(){if(this._stateful)throw new ValueError("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){tidy((()=>{this.layers.forEach((e=>{e.stateful&&e.resetStates()}))}))}}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */function standardizeSampleOrClassWeights(e,t,n){const r=t.length;if(null==e||Array.isArray(e)&&0===e.length)return t.map((e=>null));if(1===r)return Array.isArray(e)&&1===e.length?e:"object"==typeof e&&t[0]in e?[e[t[0]]]:[e];if(Array.isArray(e)){if(e.length!==r)throw new Error(`Provided ${n} is an array of ${e.length} element(s), but the model has ${r} outputs. Make sure a set of weights is provided for each model output.`);return e}if("object"==typeof e&&Object.keys(e).length>0&&"object"==typeof e[Object.keys(e)[0]]){const n=[];return t.forEach((t=>{t in e?n.push(e[t]):n.push(null)})),n}throw new Error(`The model has multiple (${r}) outputs, so ${n} must be either an array with ${r} elements or an object with ${t} keys. Provided ${n} not understood: ${JSON.stringify(e)}`)}function standardizeClassWeights(e,t){return standardizeSampleOrClassWeights(e,t,"classWeight")}async function standardizeWeights(e,t,n,r){if(null!=t||null!=r)throw new Error("Support sampleWeight is not implemented yet");if(null!=n){const t=tidy((()=>{if(1===e.shape.length)return clone(e);if(2===e.shape.length){if(e.shape[1]>1){return argMax$2(e,1)}if(1===e.shape[1])return reshape$2(e,[e.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${e.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}throw new Error(`Unexpected rank of target (y) tensor (${e.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)})),r=Array.from(await t.data());dispose(t);const a=[];return r.forEach((e=>{if(null==n[e])throw new Error(`classWeight must contain all classes in the training data. The class ${e} exists in the data but not in classWeight`);a.push(n[e])})),tensor1d(a,"float32")}return null}function computeWeightedLoss(e,t){return mul(e,t)}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */const DEFAULT_VALIDATION_BATCH_SIZE=32;function standardizeDataIteratorOutput(e,t){let n,r;const a=t;n=a.xs,r=a.ys,assert$1(null!=n&&null!=r,(()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${t}`));const i=flattenTensorOrArrayOrMap("input",e.inputNames,n),s=flattenTensorOrArrayOrMap("output",e.outputNames,r),o=i[0].shape[0];assert$1(i.length===e.inputs.length,(()=>`LayersModel has ${e.inputs.length} inputs, but the dataset provides ${i.length} inputs.  (Expected input keys: ${JSON.stringify(e.inputNames)})`)),assert$1(s.length===e.outputs.length,(()=>`LayersModel has ${e.outputs.length} outputs, but the dataset provides ${s.length} outputs.  (Expected output keys: ${JSON.stringify(e.outputNames)})`));for(let l=0;l<i.length;l++)assert$1(i[l].shape[0]===o,(()=>`Batch size mismatch: input ${e.inputNames[l]} has ${i[l].shape[0]}; expected  ${o} based on input ${e.inputNames[0]}.`));for(let l=0;l<s.length;l++)assert$1(s[l].shape[0]===o,(()=>`Batch size mismatch: output ${e.outputNames[l]} has ${s[l].shape[0]}; expected  ${o} based on input ${e.inputNames[0]}.`));return{xs:i,ys:s}}function flattenTensorOrArrayOrMap(e,t,n){if(n instanceof Tensor)return[n];if(Array.isArray(n))return assert$1(n.length===t.length,(()=>`Received an array of ${n.length} Tensors, but expected ${t.length} to match the ${e} keys ${t}.`)),n;{const r=[];for(const a of t){if(null==n[a])throw new ValueError(`The feature data generated by the dataset lacks the required ${e} key '${a}'.`);r.push(n[a])}return r}}function standardizeTensorValidationData(e){if(3===e.length)throw new NotImplementedError("Validation with sample weights is not implemented yet.");return{xs:e[0],ys:e[1]}}async function fitDataset(e,t,n){const r=null!=n.batchesPerEpoch;if(assert$1(null!=e.optimizer,(()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig).")),assert$1(null!=n,(()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call.")),assert$1(null!=n.epochs&&n.epochs>0&&Number.isInteger(n.epochs),(()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${n.epochs}`)),assert$1(!r||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),(()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${n.batchesPerEpoch}`)),assert$1(null==n.validationSplit,(()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead.")),e.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");e.isTraining=!0;try{const a=null!=n.validationData;let i,s;if(a)if(isDatasetObject(n.validationData))assert$1(null==n.validationBatches||n.validationBatches>0&&Number.isInteger(n.validationBatches),(()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${n.validationBatches}`));else{const e=standardizeTensorValidationData(n.validationData);i=e.xs,s=e.ys}const o=e.makeTrainFunction(),l=e.getDedupedMetricsNames();let u;u=a?l.slice().concat(l.map((e=>"val_"+e))):l.slice();const c=standardizeCallbacks(n.callbacks,n.yieldEvery),h=null==n.verbose?1:n.verbose,{callbackList:d,history:p}=configureCallbacks(c,h,n.epochs,null,null,getStepsPerEpoch(t,n),null,a,u);d.setModel(e),e.history=p,await d.onTrainBegin(),e.stopTraining_=!1;let f=null==n.initialEpoch?0:n.initialEpoch,m=await t.iterator();for(;f<n.epochs;){const u={};await d.onEpochBegin(f);let c=0,h=0;for(r||(m=await t.iterator());!r||c<n.batchesPerEpoch;){const t=await m.next();if(r&&t.done){console.warn(`You provided \`batchesPerEpoch\` as ${n.batchesPerEpoch}, but your dataset iterator ran out of data after ${c} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${n.batchesPerEpoch*n.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(null!=t.value){const{xs:r,ys:a}=standardizeDataIteratorOutput(e,t.value),i={};i.batch=h,i.size=r[0].shape[0],await d.onBatchBegin(h,i);const s=[];if(null!=n.classWeight){const t=standardizeClassWeights(n.classWeight,e.outputNames);for(let e=0;e<t.length;++e)s.push(await standardizeWeights(a[e],null,t[e]))}const u=r.concat(a).concat(s),p=o(u);dispose(u);for(let e=0;e<l.length;++e){const t=l[e],n=p[e];i[t]=n,keep(n)}await d.onBatchEnd(h,i),disposeTensorsInLogs(i),h++,c++}if(r?c>=n.batchesPerEpoch:t.done){if(a){let t;t=isDatasetObject(n.validationData)?toList(await e.evaluateDataset(n.validationData,{batches:n.validationBatches})):toList(e.evaluate(i,s,{batchSize:null==n.validationBatchSize?DEFAULT_VALIDATION_BATCH_SIZE:n.validationBatchSize,verbose:0}));for(let n=0;n<e.metricsNames.length;++n)u[`val_${e.metricsNames[n]}`]=t[n]}break}if(e.stopTraining_)break}if(await d.onEpochEnd(f,u),f++,e.stopTraining_)break}return await d.onTrainEnd(),await e.history.syncData(),e.history}finally{e.isTraining=!1}}function getStepsPerEpoch(e,t){let n=null;return null!=t.batchesPerEpoch?n=t.batchesPerEpoch:Number.isFinite(e.size)&&(n=e.size),n}function isDatasetObject(e){return"function"==typeof e.iterator}function isLazyIteratorObject(e){return"function"==typeof e.next}async function evaluateDataset(e,t,n){const r=null!=(n=n||{}).batches,a=e.testFunction;let i=[];if(n.verbose>0)throw new NotImplementedError("Verbose mode is not implemented yet.");assert$1(!r||n.batches>0&&Number.isInteger(n.batches),(()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(n.batches)}`));const s=isLazyIteratorObject(t)?t:await t.iterator();let o=0,l=0;for(;!r||l<n.batches;){const t=await s.next();if(i=tidy((()=>{if(t.value){const{xs:n,ys:r}=standardizeDataIteratorOutput(e,t.value),s=n.concat(r),u=tidy((()=>a(s)));if(dispose(s),0===l)for(let e=0;e<u.length;++e)i.push(scalar(0));const c=s[0].shape[0];for(let e=0;e<u.length;++e){const t=u[e],n=i[e];i[e]=tidy((()=>add$1(i[e],mul(c,t)))),l>0&&dispose(n)}dispose(u),o+=c,++l}return i})),t.done){r&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${n.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let u=0;u<i.length;++u){const e=i[u];i[u]=div$1(i[u],o),dispose(e)}return singletonOrArray(i)}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */function checkBatchSize(e){assert$1(e>0&&Number.isInteger(e),(()=>`batchSize is required to be a positive integer, but got ${e}`))}function sliceArrays(e,t,n){return null==e?[null]:Array.isArray(e)?e.map((e=>sliceAlongFirstAxis(e,t,n-t))):sliceAlongFirstAxis(e,t,n-t)}function sliceArraysByIndices(e,t){return tidy((()=>null==e?null:Array.isArray(e)?e.map((e=>sliceArraysByIndices(e,t))):gather(e,"int32"===t.dtype?t:cast$3(t,"int32"))))}function makeBatches(e,t){const n=[];let r=0,a=null;for(;r<e;)a=r+t,a>=e&&(a=e),n.push([r,a]),r=a;return n}function ensureTensorsRank2OrHigher(e){const t=[];e instanceof Tensor&&(e=[e]);for(let n=0;n<e.length;++n){const r=e[n];if(1===r.rank)t.push(expandDims$2(r,1));else{if(0===r.rank)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(r)}}return t}function disposeNewTensors(e,t){if(null==e)return;const n=[];if(t instanceof Tensor)n.push(t.id);else if(Array.isArray(t))t.forEach((e=>n.push(e.id)));else if(null!=t)for(const a in t){const e=t[a];n.push(e.id)}const r=[];if(e instanceof Tensor)-1===n.indexOf(e.id)&&r.push(e);else if(Array.isArray(e))e.forEach((e=>{-1===n.indexOf(e.id)&&r.push(e)}));else if(null!=e)for(const a in e){const t=e[a];-1===n.indexOf(t.id)&&r.push(t)}r.forEach((e=>{e.isDisposed||e.dispose()}))}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */function isDataTensor(e){return e instanceof Tensor}function isDataArray(e){return Array.isArray(e)}function isDataDict(e){return!isDataTensor(e)&&!isDataArray(e)}function standardizeInputData(e,t,n,r=!0,a=""){if(null==t||0===t.length){if(null!=e){let t=!1;if(isDataArray(e)&&e.length>0)t=!0;else if(isDataDict(e)){for(const n in e)if(e.hasOwnProperty(n)){t=!0;break}}else t=!0;if(t)throw new ValueError(`Error when checking model ${a} expected no data, but got ${e}`)}return[]}if(null==e)return t.map((e=>null));let i;if(isDataDict(e)){i=[];for(const n of t){if(null==e[n])throw new ValueError(`No data provided for "${n}". Need data for each key in: ${t}`);i.push(e[n])}}else if(isDataArray(e)){if(e.length!==t.length)throw new ValueError(`Error when checking model ${a}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${t.length} Tensor(s), but instead got the following list of Tensor(s): ${e}`);i=e}else{if(t.length>1)throw new ValueError(`The model ${a} expects ${t.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${e.shape}`);i=[e]}if(i=ensureTensorsRank2OrHigher(i),null!=n)for(let s=0;s<t.length;++s){if(null==n[s])continue;const e=i[s];if(e.shape.length!==n[s].length)throw new ValueError(`Error when checking ${a}: expected ${t[s]} to have ${n[s].length} dimension(s). but got array with shape ${e.shape}`);for(let t=0;t<n[s].length;++t){if(0===t&&!r)continue;const i=e.shape[t],o=n[s][t];if(null!=o&&o>=0&&i!==o)throw new ValueError(`${a} expected a batch of elements where each example has shape [${n[s].slice(1,n[s].length)}] (i.e.,tensor shape [*,${n[s].slice(1,n[s].length)}]) but the ${a} received an input with ${e.shape[0]} examples, each with shape [${e.shape.slice(1,e.shape.length)}] (tensor shape [${e.shape}])`)}}return i}function checkArrayLengths(e,t,n){const r=unique$2(e.map((e=>e.shape[0])));r.sort();const a=unique$2(t.map((e=>e.shape[0])));if(a.sort(),r.length>1)throw new ValueError(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map((e=>e.shape)))}`);if(a.length>1)throw new ValueError(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map((e=>e.shape)))}`);if(r.length>0&&a.length>0&&!arraysEqual(r,a))throw new ValueError(`Input Tensors should have the same number of samples as target Tensors. Found ${r[0]} input sample(s) and ${a[0]} target sample(s).`)}function checkLossAndTargetCompatibility(e,t,n){const r=[meanSquaredError,binaryCrossentropy$1,categoricalCrossentropy$1];for(let a=0;a<e.length;++a){const i=e[a],s=t[a],o=n[a];if(null!=s){if(s===categoricalCrossentropy$1&&1===i.shape[i.shape.length-1])throw new ValueError(`You are passing a target array of shape ${i.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(-1!==r.indexOf(s)){const e=i.shape.slice(1),t=o.slice(1);for(let n=0;n<e.length;++n){const r=e[n],a=t[n];if(null!=a&&r!==a)throw new ValueError(`A target Tensor with shape ${i.shape} was passed for an output of shape ${o}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function checkInputData(e,t,n,r=!0,a=""){let i;if(Array.isArray(e)){if(e.length!==t.length)throw new ValueError(`Error when checking model ${a}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${t.length} Tensor(s), but instead got ${e.length} Tensors(s).`);i=e}else{if(t.length>1)throw new ValueError(`The model expects ${t.length} ${a} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(e.shape)}.`);i=[e]}if(null!=n)for(let s=0;s<t.length;++s){if(null==n[s])continue;const e=i[s];if(e.shape.length!==n[s].length)throw new ValueError(`Error when checking ${a}: expected ${t[s]} to have ${n[s].length} dimension(s), but got array with shape ${JSON.stringify(e.shape)}`);for(let i=0;i<n[s].length;++i){if(0===i&&!r)continue;const o=e.shape[i],l=n[s][i];if(null!=l&&l!==o)throw new ValueError(`Error when checking ${a}: expected ${t[s]} to have shape ${JSON.stringify(n[s])} but got array with shape ${JSON.stringify(e.shape)}.`)}}}function collectMetrics(e,t){if(null==e||Array.isArray(e)&&0===e.length)return t.map((e=>[]));let n;if("string"==typeof e||"function"==typeof e)n=[e];else{if(!Array.isArray(e)&&"object"!=typeof e)throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${e}`);n=e}if(Array.isArray(n))return t.map((e=>n));{const e=[];for(const r of t){let t=n.hasOwnProperty(r)?n[r]:[];Array.isArray(t)||(t=[t]),e.push(t)}return e}}const LAYERS_MODEL_FORMAT_NAME="layers-model";class LayersModel extends Container{constructor(e){super(e),this.isTraining=!1}summary(e,t,n=console.log){if(!this.built)throw new ValueError("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");printSummary(this,e,t,n)}compile(e){if(null==e.loss&&(e.loss=[]),this.loss=e.loss,"string"==typeof e.optimizer)this.optimizer_=getOptimizer(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof Optimizer))throw new ValueError("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let t=[];if(Array.isArray(e.loss)||"string"==typeof e.loss||"function"==typeof e.loss)if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new ValueError(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);const n=e.loss;t=n.map((e=>get$2(e)))}else{const n=get$2(e.loss);this.outputs.forEach((e=>{t.push(n)}))}else{e.loss=e.loss;for(const t in e.loss)if(-1===this.outputNames.indexOf(t))throw new ValueError(`Unknown entry in loss dictionary: "${t}". Only expected the following keys: ${this.outputNames}`);for(const n of this.outputNames)null==e.loss[n]&&console.warn(`Output "${n}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${n} during training`),t.push(get$2(e.loss[n]))}this.lossFunctions=t,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let i=0;i<this.outputs.length;++i){const e=this.internalOutputShapes[i],t=this.outputNames[i];this.feedOutputNames.push(t),this.feedOutputShapes.push(e),this.feedLossFns.push(this.lossFunctions[i])}const n=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],nameScope("loss",(()=>{for(let e=0;e<this.outputs.length;++e){if(-1!==n.indexOf(e))continue;const t=this.lossFunctions[e];this.outputs.length>1&&(this.metricsTensors.push([t,e]),this.metricsNames.push(this.outputNames[e]+"_loss"))}}));const r=collectMetrics(e.metrics,this.outputNames),a=(e,t,n)=>{this.outputNames.length>1&&(t=this.outputNames[e]+"_"+t),this.metricsNames.push(t),this.metricsTensors.push([n,e])};nameScope("metric",(()=>{for(let e=0;e<this.outputs.length;++e){if(-1!==n.indexOf(e))continue;(t=>{let n,r,i;for(const s of t){if("string"==typeof s&&-1!==["accuracy","acc","crossentropy","ce"].indexOf(s)){const t=this.internalOutputShapes[e];let a;1===t[t.length-1]||this.lossFunctions[e]===binaryCrossentropy$1?-1!==["accuracy","acc"].indexOf(s)?r=binaryAccuracy:-1!==["crossentropy","ce"].indexOf(s)&&(r=binaryCrossentropy):this.lossFunctions[e]===sparseCategoricalCrossentropy$1?-1!==["accuracy","acc"].indexOf(s)?r=sparseCategoricalAccuracy:-1!==["crossentropy","ce"].indexOf(s)&&(r=sparseCategoricalCrossentropy):-1!==["accuracy","acc"].indexOf(s)?r=categoricalAccuracy:-1!==["crossentropy","ce"].indexOf(s)&&(r=categoricalCrossentropy),-1!==["accuracy","acc"].indexOf(s)?a="acc":-1!==["crossentropy","ce"].indexOf(s)&&(a="ce"),i=r,n=""+a}else{const e=get$1(s);i=e,n=""+getLossOrMetricName(s)}let t;nameScope(n,(()=>{t=i})),a(e,n,t)}})(r[e])}})),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,t,n={}){const r=null==n.batchSize?32:n.batchSize;checkBatchSize(r);const a=this.standardizeUserDataXY(e,t,!0,r);try{const e=a[0].concat(a[1]);this.makeTestFunction();const t=this.testFunction;return singletonOrArray(this.testLoop(t,e,r,n.verbose,n.steps))}finally{disposeNewTensors(a[0],e),disposeNewTensors(a[1],t)}}async evaluateDataset(e,t){return this.makeTestFunction(),evaluateDataset(this,e,t)}checkNumSamples(e,t,n,r="steps"){let a;if(null!=n){if(a=null,null!=t)throw new ValueError(`If ${r} is set, batchSize must be null or undefined.Got batchSize = ${t}`)}else{if(null==e)throw new ValueError(`Either the input data should have a defined shape, or ${r} shoud be specified.`);a=Array.isArray(e)?e[0].shape[0]:e.shape[0]}return a}execute(e,t){if(Array.isArray(t)&&0===t.length)throw new ValueError("`outputs` is an empty Array, which is not allowed.");const n=Array.isArray(t),r=n?t:[t],a=this.retrieveSymbolicTensors(r),i=new FeedDict;if(e instanceof Tensor&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new ValueError(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let t=0;t<this.inputs.length;++t)i.add(this.inputs[t],e[t])}else for(const o of this.inputs){const t=e[o.name];if(null==t)throw new ValueError(`No value is provided for the model's input ${o.name}`);i.add(o,t)}const s=execute(a,i);return n?s:s[0]}retrieveSymbolicTensors(e){const t=pyListRepeat(null,e.length);let n=e.length;for(const r of this.layers){const a=Array.isArray(r.output)?r.output:[r.output],i=a.map((e=>e.name));for(let r=0;r<e.length;++r){const s=i.indexOf(e[r]);if(-1!==s&&(t[r]=a[s],n--),0===n)break}if(0===n)break}if(n>0){const n=[];throw t.forEach(((t,r)=>{null==t&&n.push(e[r])})),new ValueError(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(n)}`)}return t}predictLoop(e,t=32,n=!1){return tidy((()=>{const r=this.checkNumSamples(e);if(n)throw new NotImplementedError("Verbose predictLoop() is not implemented yet.");const a=makeBatches(r,t),i=this.outputs.map((e=>[]));for(let t=0;t<a.length;++t){tidy((()=>{const n=a[t][0],r=a[t][1],i=sliceArrays(e,n,r),s=[];if(Array.isArray(i))for(let e=0;e<i.length;++e)s.push({key:this.inputs[e],value:i[e]});else s.push({key:this.inputs[0],value:i});const o=new FeedDict(s);return execute(this.outputs,o)})).forEach(((e,t)=>i[t].push(e)))}return singletonOrArray(i.map((e=>concat$2(e,0))))}))}predict(e,t={}){const n=ensureTensorsRank2OrHigher(e);checkInputData(n,this.inputNames,this.feedInputShapes,!1);try{const e=null==t.batchSize?32:t.batchSize;return checkBatchSize(e),this.predictLoop(n,e)}finally{disposeNewTensors(n,e)}}predictOnBatch(e){checkInputData(e,this.inputNames,this.feedInputShapes,!0);const t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}standardizeUserDataXY(e,t,n=!0,r){if(null==this.optimizer_)throw new RuntimeError("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const a=[];for(let i=0;i<this.feedOutputShapes.length;++i){const e=this.feedOutputShapes[i];this.feedLossFns[i]===sparseCategoricalCrossentropy$1?a.push(e.slice(0,e.length-1).concat([1])):a.push(e)}if(checkArrayLengths(e=standardizeInputData(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=standardizeInputData(t,this.feedOutputNames,a,!1,"target")),checkLossAndTargetCompatibility(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=r&&r>0&&e[0].shape[0]%r!=0)throw new ValueError(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${r}. Found: ${e[0].shape[0]} sample(s).`);return[e,t]}async standardizeUserData(e,t,n,r,a=!0,i){const[s,o]=this.standardizeUserDataXY(e,t,a,i);if(null!=n)throw new Error("sample weight is not supported yet.");let l=null;if(null!=r){const e=standardizeClassWeights(r,this.outputNames);l=[];for(let t=0;t<e.length;++t)l.push(await standardizeWeights(o[t],null,e[t]))}return[s,o,l]}testLoop(e,t,n,r=0,a){return tidy((()=>{const i=this.checkNumSamples(t,n,a,"steps"),s=[];if(r>0)throw new NotImplementedError("Verbose mode is not implemented yet.");if(null!=a)throw new NotImplementedError("steps mode in testLoop() is not implemented yet");{const r=makeBatches(i,n),a=tensor1d(range$3(0,i));for(let n=0;n<r.length;++n){const i=r[n][0],o=r[n][1],l=sliceAlongFirstAxis(a,i,o-i),u=sliceArraysByIndices(t,l),c=e(u);if(0===n)for(let e=0;e<c.length;++e)s.push(scalar(0));for(let e=0;e<c.length;++e){const t=c[e];s[e]=add$1(s[e],mul(o-i,t))}}for(let e=0;e<s.length;++e)s[e]=div$1(s[e],i)}return s}))}getDedupedMetricsNames(){const e=this.metricsNames,t=[];for(let n=0;n<e.length;++n){const r=e[n];let a=r;if(count(e,r)>1){a+=`_${count(e.slice(0,n),r)}`}t.push(a)}return t}makeTrainFunction(){return e=>{const t=[],n=e.slice(0,this.inputs.length),r=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),a=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+2*this.outputs.length),i=[],s=this.collectedTrainableWeights.map((e=>e.read()));return[this.optimizer_.minimize((()=>{const e=[];for(let t=0;t<this.inputs.length;++t)e.push({key:this.inputs[t],value:n[t]});const s=new FeedDict(e),o=execute(this.outputs,s,{training:!0});let l;for(let n=0;n<this.lossFunctions.length;++n){let e=(0,this.lossFunctions[n])(r[n],o[n]);null!=a[n]&&(e=computeWeightedLoss(e,a[n]));const i=mean$1(e);t.push(i),l=0===n?e:add$1(l,e)}for(let n=0;n<this.metricsTensors.length;++n){let e;if(this.outputs.length>1&&n<this.outputs.length)e=t[n];else{const t=this.metricsTensors[n][0],a=this.metricsTensors[n][1];e=mean$1(t(r[a],o[a]))}keep(e),i.push(e)}return l=mean$1(l),this.calculateLosses().forEach((e=>{l=add$1(l,e)})),l}),!0,s)].concat(i)}}makeTestFunction(){this.testFunction=e=>tidy((()=>{const t=[];let n;const r=e.slice(0,this.inputs.length),a=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=[];for(let e=0;e<this.inputs.length;++e)i.push({key:this.inputs[e],value:r[e]});const s=new FeedDict(i),o=execute(this.outputs,s);for(let e=0;e<this.lossFunctions.length;++e){const r=this.lossFunctions[e],i=mean$1(r(a[e],o[e]));n=0===e?i:add$1(n,i),t.push(n)}for(let e=0;e<this.metricsTensors.length;++e){const n=this.metricsTensors[e][0],r=this.metricsTensors[e][1],i=mean$1(n(a[r],o[r]));t.push(i)}return t}))}async fit(e,t,n={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");let r,a,i,s,o,l,u,c,h;this.isTraining=!0;try{const d=null==n.batchSize?32:n.batchSize;checkBatchSize(d);const p=!1,f=await this.standardizeUserData(e,t,n.sampleWeight,n.classWeight,p,d);r=f[0],a=f[1],h=f[2];let m,g=!1;if(null!=n.validationData&&n.validationData.length>0){if(g=!0,2!==n.validationData.length)throw 3===n.validationData.length?new NotImplementedError("validationData including sample weights is not supported yet."):new ValueError(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${n.validationData} is invalid.`);o=n.validationData[0],l=n.validationData[1];const e=!0,t=await this.standardizeUserData(o,l,null,null,e,d);u=t[0],c=t[1],m=u.concat(c)}else if(null!=n.validationSplit&&n.validationSplit>0&&n.validationSplit<1){g=!0;const e=Math.floor(r[0].shape[0]*(1-n.validationSplit)),t=r[0].shape[0];u=sliceArrays(r,e,t),i=r,r=sliceArrays(r,0,e),c=sliceArrays(a,e,t),s=a,a=sliceArrays(a,0,e),m=u.concat(c)}else null!=n.validationSteps&&(g=!0);const y=r.concat(a).concat(h);this.checkTrainableWeightsConsistency();const v=this.makeTrainFunction(),b=this.getDedupedMetricsNames();let x,T;g?(this.makeTestFunction(),x=this.testFunction,T=b.slice().concat(b.map((e=>"val_"+e)))):(x=null,m=[],T=b.slice());const _=standardizeCallbacks(n.callbacks,n.yieldEvery);return await this.fitLoop(v,y,b,d,n.epochs,n.verbose,_,x,m,n.shuffle,T,n.initialEpoch,null,null)}finally{this.isTraining=!1,disposeNewTensors(r,e),disposeNewTensors(a,t),disposeNewTensors(i,e),disposeNewTensors(s,t),disposeNewTensors(u,o),disposeNewTensors(c,l),null!=h&&dispose(h)}}async fitLoop(e,t,n,r,a,i,s,o,l,u,c,h,d,p){null==r&&(r=32),null==a&&(a=1),null==u&&(u=!0),null==h&&(h=0);let f=!1;if(null!=o&&null!=l&&(f=!0),null!=p&&(f=!0,null==d))throw new ValueError("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const m=this.checkNumSamples(t,r,d,"steps_per_epoch");let g;null!=m&&(g=range$3(0,m)),null==i&&(i=1);const{callbackList:y,history:v}=configureCallbacks(s,i,a,h,m,d,r,f,c);y.setModel(this),this.history=v,await y.onTrainBegin(),this.stopTraining_=!1;for(let b=h;b<a;++b){await y.onEpochBegin(b);const a={};if(null!=d)throw new NotImplementedError("stepsPerEpoch mode is not implemented yet.");{if("batch"===u)throw new NotImplementedError("batch shuffling is not implemneted yet");u&&shuffle(g);const i=tensor1d(g),s=makeBatches(m,r);for(let u=0;u<s.length;++u){const c={};if(await y.onBatchBegin(u,c),tidy((()=>{const h=s[u][0],d=s[u][1],p=sliceAlongFirstAxis(i,h,d-h);c.batch=u,c.size=d-h;const m=sliceArraysByIndices(t,p),g=e(m);for(let e=0;e<n.length;++e){const t=n[e],r=g[e];c[t]=r,keep(r)}if(u===s.length-1&&f){const e=this.testLoop(o,l,r);for(let t=0;t<n.length;++t){const r=n[t],i=e[t];keep(i),a["val_"+r]=i}}})),await y.onBatchEnd(u,c),disposeTensorsInLogs(c),this.stopTraining_)break}i.dispose()}if(await y.onEpochEnd(b,a),this.stopTraining_)break}return await y.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,t){return fitDataset(this,e,t)}async trainOnBatch(e,t){const n=await this.standardizeUserData(e,t),r=n[0],a=n[1],i=this.makeTrainFunction()(r.concat(a)),s=[];for(const o of i){const e=await o.data();s.push(e[0])}return dispose(i),disposeNewTensors(n[0],e),disposeNewTensors(n[1],t),singletonOrArray(s)}getNamedWeights(e){const t=[],n=null!=e&&e.trainableOnly,r=n?this.trainableWeights:this.weights,a=this.getWeights(n);for(let i=0;i<r.length;++i)n&&!r[i].trainable||t.push({name:r[i].originalName,tensor:a[i]});return t}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(0===e.refCountAfterDispose&&null!=this.optimizer&&this.isOptimizerOwned){const t=memory().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-memory().numTensors}return e}getLossIdentifiers(){let e;if("string"==typeof this.loss)e=toSnakeCase(this.loss);else if(Array.isArray(this.loss)){for(const e of this.loss)if("string"!=typeof e)throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map((e=>toSnakeCase(e)))}else{const t=Object.keys(this.loss);e={};const n=this.loss;for(const r of t){if("string"!=typeof n[r])throw new Error("Serialization of non-string loss is not supported.");e[r]=toSnakeCase(n[r])}}return e}getMetricIdentifiers(){if("string"==typeof this.metrics||"function"==typeof this.metrics)return[toSnakeCase(getLossOrMetricName(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map((e=>toSnakeCase(getLossOrMetricName(e))));{const e={};for(const t in this.metrics)e[t]=toSnakeCase(getLossOrMetricName(this.metrics[t]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(null!=e.weighted_metrics)throw new Error("Loading weight_metrics is not supported yet.");if(null!=e.loss_weights)throw new Error("Loading loss_weights is not supported yet.");if(null!=e.sample_weight_mode)throw new Error("Loading sample_weight_mode is not supported yet.");const t=deserialize(convertPythonicToTs(e.optimizer_config));let n,r;if("string"==typeof e.loss)n=toCamelCase(e.loss);else if(Array.isArray(e.loss))n=e.loss.map((e=>toCamelCase(e)));else if(null!=e.loss){n={};for(const t in e.loss)n[t]=toCamelCase(e.loss[t])}if(Array.isArray(e.metrics))r=e.metrics.map((e=>toCamelCase(e)));else if(null!=e.metrics){r={};for(const t in e.metrics)r[t]=toCamelCase(e.metrics[t])}this.compile({loss:n,metrics:r,optimizer:t})}async save(e,t){if("string"==typeof e){const t=getSaveHandlers(e);if(0===t.length)throw new ValueError(`Cannot find any save handlers for URL '${e}'`);if(t.length>1)throw new ValueError(`Found more than one (${t.length}) save handlers for URL '${e}'`);e=t[0]}if(null==e.save)throw new ValueError("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const n=await encodeWeights(this.getNamedWeights(t)),r={modelTopology:this.toJSON(null,!1),format:LAYERS_MODEL_FORMAT_NAME,generatedBy:`TensorFlow.js tfjs-layers v${version$7}`,convertedBy:null};if(null!=t&&t.includeOptimizer&&null!=this.optimizer){r.trainingConfig=this.getTrainingConfig();const e="optimizer",{data:t,specs:a}=await encodeWeights(await this.optimizer.getWeights(),e);n.specs.push(...a),n.data=concatenateArrayBuffers([n.data,t])}if(null!=this.userDefinedMetadata){const e=!0;checkUserDefinedMetadata(this.userDefinedMetadata,this.name,e),r.userDefinedMetadata=this.userDefinedMetadata}return r.weightData=n.data,r.weightSpecs=n.specs,e.save(r)}setUserDefinedMetadata(e){checkUserDefinedMetadata(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}LayersModel.className="Model",registerClass(LayersModel);class Functional extends LayersModel{}Functional.className="Functional",registerClass(Functional);
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */
class Sequential extends LayersModel{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=null!=e.name?e.name:getUid("sequential_"),null!=e.layers)for(const t of e.layers)this.add(t)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some((e=>e<0)))throw new ValueError(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){const t=e instanceof Sequential||e instanceof LayersModel;let n;if(t){if(n=e,1!==n.outputs.length)throw new ValueError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==n.inputs.length)throw new ValueError("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===e.inboundNodes.length){if(null==e.batchInputShape)throw new ValueError("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const t=Input({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(t)}if(t)this.outputs=n.outputs,this.inputs=n.inputs;else{if(1!==e.inboundNodes.length)throw new ValueError(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(1!==e.inboundNodes[0].outputTensors.length)throw new ValueError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=getSourceInputs(this.outputs[0])}this.inboundNodes=[],new Node$1({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:pyListRepeat(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map((e=>e.shape)),outputShapes:this.outputs[0].shape})}else{const t=e.apply(this.outputs[0]);if(Array.isArray(t))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[t],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,t){return null==this.model&&this.build(),this.model.call(e,t)}build(e){if(getExactlyOneShape(e),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new LayersModel({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,t,n=console.log){this.built||this.build(),super.summary(e,t,n)}setWeights(e){null==this.model&&this.build(),this.model.setWeights(e)}evaluate(e,t,n={}){if(!this.built)throw new RuntimeError("The model needs to be compiled before being used.");return this.model.evaluate(e,t,n)}async evaluateDataset(e,t){if(!this.built)throw new RuntimeError("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,t)}predict(e,t={}){return null==this.model&&this.build(),this.model.predict(e,t)}predictOnBatch(e){return null==this.model&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return null==this.model?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,t,n={}){if(!this.built)throw new RuntimeError("The model needs to be compiled before being used.");return this.model.fit(e,t,n)}async fitDataset(e,t){if(!this.built)throw new RuntimeError("The model needs to be compiled before being used.");return this.model.fitDataset(e,t)}async trainOnBatch(e,t){return this.model.trainOnBatch(e,t)}static fromConfig(e,t,n={},r=!1){let a,i={};if(t instanceof Array){if(null==t[0].className||"Merge"===t[0].className)throw new ValueError("Legacy serialization format not supported yet.");a=t}else assert$1(null!=t.layers,(()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field.")),a=t.layers,delete t.layers,i=t;const s=new e(i);if(!(s instanceof Sequential))throw new NotImplementedError(`Sequential.fromConfig called on non-Sequential input: ${s}`);for(const o of a){const e=deserialize(o,void 0,r);r&&e.setFastWeightInitDuringBuild(!0),s.add(e)}return s}set stopTraining(e){if(null==this.model)throw new ValueError("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(null==this.model)throw new ValueError("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const t of this.layers){const n={};n.className=t.getClassName(),n.config=t.getConfig(),e.push(n)}return{name:this.name,layers:e}}}Sequential.className="Sequential",registerClass(Sequential);
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */
let Activation$1=class extends Serializable{getConfig(){return{}}};class Elu extends Activation$1{apply(e,t=1){return elu$2(e,t)}}Elu.className="elu",registerClass(Elu);class Selu extends Activation$1{apply(e){return selu$2(e)}}Selu.className="selu",registerClass(Selu);class Relu extends Activation$1{apply(e){return relu$2(e)}}Relu.className="relu",registerClass(Relu);class Relu6 extends Activation$1{apply(e){return tidy((()=>minimum$2(6,relu$2(e))))}}Relu6.className="relu6",registerClass(Relu6);class Linear extends Activation$1{apply(e){return e}}Linear.className="linear",registerClass(Linear);class Sigmoid extends Activation$1{apply(e){return sigmoid$2(e)}}Sigmoid.className="sigmoid",registerClass(Sigmoid);class HardSigmoid extends Activation$1{apply(e){return hardSigmoid(e)}}HardSigmoid.className="hardSigmoid",registerClass(HardSigmoid);class Softplus extends Activation$1{apply(e){return softplus$2(e)}}Softplus.className="softplus",registerClass(Softplus);class Softsign extends Activation$1{apply(e){return softsign(e)}}Softsign.className="softsign",registerClass(Softsign);class Tanh extends Activation$1{apply(e){return tanh$2(e)}}Tanh.className="tanh",registerClass(Tanh);let Softmax$1=class extends Activation$1{apply(e,t=-1){return softmax$2(e,t)}};Softmax$1.className="softmax",registerClass(Softmax$1);class LogSoftmax extends Activation$1{apply(e,t=-1){return logSoftmax(e,t)}}LogSoftmax.className="logSoftmax",registerClass(LogSoftmax);class Swish extends Activation$1{apply(e,t=1){return tidy((()=>mul(sigmoid$2(mul(e,t)),e)))}}Swish.className="swish",registerClass(Swish);class Mish extends Activation$1{apply(e){return tidy((()=>mul(e,tanh$2(softplus$2(e)))))}}function serializeActivation(e){return e.getClassName()}function deserializeActivation(e,t={}){return deserializeKerasObject(e,SerializationMap.getMap().classNameMap,t,"activation")}function getActivation(e){if(null==e){const e={className:"linear",config:{}};return deserializeActivation(e)}if("string"==typeof e){const t={};return t.className=e,t.config={},deserializeActivation(t)}return e instanceof Activation$1?e:deserializeActivation(e)}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */function assertObjectArgs(e){if(null!=e&&"object"!=typeof e)throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${e}`)}Mish.className="mish",registerClass(Mish);class Regularizer extends Serializable{}class L1L2 extends Regularizer{constructor(e){super(),assertObjectArgs(e),this.l1=null==e||null==e.l1?.01:e.l1,this.l2=null==e||null==e.l2?.01:e.l2,this.hasL1=0!==this.l1,this.hasL2=0!==this.l2}apply(e){return tidy((()=>{let t=zeros$1([1]);return this.hasL1&&(t=add$1(t,sum$2(mul(this.l1,abs$2(e))))),this.hasL2&&(t=add$1(t,sum$2(mul(this.l2,square$1(e))))),reshape$2(t,[])}))}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,t){return new e({l1:t.l1,l2:t.l2})}}L1L2.className="L1L2",registerClass(L1L2);const REGULARIZER_IDENTIFIER_REGISTRY_SYMBOL_MAP={l1l2:"L1L2"};function serializeRegularizer(e){return serializeKerasObject(e)}function deserializeRegularizer(e,t={}){return deserializeKerasObject(e,SerializationMap.getMap().classNameMap,t,"regularizer")}function getRegularizer(e){if(null==e)return null;if("string"==typeof e){return deserializeRegularizer({className:e in REGULARIZER_IDENTIFIER_REGISTRY_SYMBOL_MAP?REGULARIZER_IDENTIFIER_REGISTRY_SYMBOL_MAP[e]:e,config:{}})}return e instanceof Regularizer?e:deserializeRegularizer(e)}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */class ReLU extends Layer{constructor(e){super(null==e?{}:e),this.supportsMasking=!0,null!=e&&(this.maxValue=e.maxValue)}call(e,t){e=getExactlyOneTensor(e);let n=relu$2(e);return null!=this.maxValue&&(n=clipByValue$2(n,0,this.maxValue)),n}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},t=super.getConfig();return Object.assign(e,t),e}}ReLU.className="ReLU",registerClass(ReLU);class LeakyReLU extends Layer{constructor(e){super(null==e?{}:e),this.DEFAULT_ALPHA=.3,null==e&&(e={}),this.alpha=null==e.alpha?this.DEFAULT_ALPHA:e.alpha}call(e,t){const n=getExactlyOneTensor(e);return leakyRelu$2(n,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}LeakyReLU.className="LeakyReLU",registerClass(LeakyReLU);class PReLU extends Layer{constructor(e){if(super(null==e?{}:e),this.DEFAULT_ALPHA_INITIALIZER="zeros",null==e&&(e={}),this.supportsMasking=!0,this.alphaInitializer=getInitializer(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=getRegularizer(e.alphaRegularizer),this.alphaConstraint=getConstraint(e.alphaConstraint),null==e.sharedAxes)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else{if("number"!=typeof e.sharedAxes)throw new ValueError(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`);this.sharedAxes=[e.sharedAxes]}}build(e){const t=(e=getExactlyOneShape(e)).slice(1);if(null!=this.sharedAxes)for(const r of this.sharedAxes)t[r-1]=1;this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const n={};if(null!=this.sharedAxes)for(let r=1;r<e.length;++r)n[r]=e[r];this.inputSpec=[new InputSpec({ndim:e.length,axes:n})],this.built=!0}call(e,t){return e=getExactlyOneTensor(e),prelu$2(e,this.alpha.read())}getConfig(){const e={alphaInitializer:serializeInitializer(this.alphaInitializer),alphaRegularizer:serializeRegularizer(this.alphaRegularizer),alphaConstraint:serializeConstraint(this.alphaConstraint),sharedAxes:this.sharedAxes},t=super.getConfig();return Object.assign(e,t),e}}PReLU.className="PReLU",registerClass(PReLU);let ELU$3=class extends Layer{constructor(e){if(super(null==e?{}:e),this.DEFAULT_ALPHA=1,null==e&&(e={}),null!=e.alpha&&e.alpha!==this.DEFAULT_ALPHA)throw new NotImplementedError(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=null==e.alpha?this.DEFAULT_ALPHA:e.alpha}call(e,t){const n=getExactlyOneTensor(e);return elu$3(n)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}};ELU$3.className="ELU",registerClass(ELU$3);class ThresholdedReLU extends Layer{constructor(e){super(null==e?{}:e),this.DEFAULT_THETA=1,null==e&&(e={}),this.theta=null==e.theta?this.DEFAULT_THETA:e.theta}call(e,t){const n=getExactlyOneTensor(e);return mul(n,cast$3(greater$2(n,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},t=super.getConfig();return Object.assign(e,t),e}}ThresholdedReLU.className="ThresholdedReLU",registerClass(ThresholdedReLU);class Softmax extends Layer{constructor(e){super(null==e?{}:e),this.DEFAULT_AXIS=1,null==e&&(e={}),this.softmax=(new Softmax$1).apply,this.axis=null==e.axis?this.DEFAULT_AXIS:e.axis}call(e,t){return tidy((()=>{let n=getExactlyOneTensor(e);const r=t.mask;if(null!=r){const e=mul(sub$2(ones(n.shape),cast$3(r,n.dtype)),scalar(-1e9));n=add$1(n,e)}return this.axis instanceof Array?this.axis.length>1?exp$2(sub$2(n,logSumExp(n,this.axis,!0))):this.softmax(n,this.axis[0]):this.softmax(n,this.axis)}))}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */
function normalizeArray(e,t,n){if("number"==typeof e)return pyListRepeat(e,t);if(e.length!==t)throw new ValueError(`The ${n} argument must be an integer or tuple of ${t} integers. Received: ${e.length} elements.`);for(let r=0;r<t;++r){const a=e[r];if(!isInteger(a))throw new ValueError(`The ${n} argument must be an integer or tuple of ${t} integers. Received: ${JSON.stringify(e)} including a non-integer number ${a}`)}return e}function convOutputLength(e,t,n,r,a=1){if(null==e)return e;let i;return i="same"===n?e:e-(t+(t-1)*(a-1))+1,Math.floor((i+r-1)/r)}function deconvLength(e,t,n,r){if(null==e)return null;if("valid"===r)e=e*t+max$2([n-t,0]);else{if("same"!==r)throw new ValueError(`Unsupport padding mode: ${r}.`);e*=t}return e}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */function preprocessConv2DInput(e,t){return tidy((()=>(checkDataFormat(t),"channelsFirst"===t?transpose$2(e,[0,2,3,1]):e)))}function preprocessConv3DInput(e,t){return tidy((()=>(checkDataFormat(t),"channelsFirst"===t?transpose$2(e,[0,2,3,4,1]):e)))}function conv1dWithBias(e,t,n,r=1,a="valid",i,s=1){return tidy((()=>{if(null==i&&(i=imageDataFormat()),checkDataFormat(i),3!==e.shape.length)throw new ValueError(`The input of a conv1dWithBias operation should be 3, but is ${e.shape.length} instead.`);if(3!==t.shape.length)throw new ValueError(`The kernel for a conv1dWithBias operation should be 3, but is ${t.shape.length} instead`);if(null!=n&&1!==n.shape.length)throw new ValueError(`The bias for a conv1dWithBias operation should be 1, but is ${t.shape.length} instead`);if("channelsFirst"===i&&(e=transpose$2(e,[0,2,1])),"causal"===a)throw new NotImplementedError("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let o=conv1d(e,t,r,"same"===a?"same":"valid","NWC",s);return null!=n&&(o=biasAdd(o,n)),o}))}function conv2dWithBiasActivation(e,t,n,r=[1,1],a="valid",i,s,o=null){return tidy((()=>{if(null==i&&(i=imageDataFormat()),checkDataFormat(i),3!==e.rank&&4!==e.rank)throw new ValueError(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${e.rank}.`);if(3!==t.rank&&4!==t.rank)throw new ValueError(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${e.rank}.`);let l=preprocessConv2DInput(e,i);if("causal"===a)throw new NotImplementedError("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=conv2d$1({x:l,filter:t,strides:r,pad:"same"===a?"same":"valid",dilations:s,dataFormat:"NHWC",bias:n,activation:o}),"channelsFirst"===i&&(l=transpose$2(l,[0,3,1,2])),l}))}function conv3dWithBias(e,t,n,r=[1,1,1],a="valid",i,s){return tidy((()=>{if(null==i&&(i=imageDataFormat()),checkDataFormat(i),4!==e.rank&&5!==e.rank)throw new ValueError(`conv3dWithBias expects input to be of rank 4 or 5, but received ${e.rank}.`);if(4!==t.rank&&5!==t.rank)throw new ValueError(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${e.rank}.`);let o=preprocessConv3DInput(e,i);if("causal"===a)throw new NotImplementedError("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return o=conv3d(o,t,r,"same"===a?"same":"valid","NDHWC",s),null!=n&&(o=biasAdd(o,n)),"channelsFirst"===i&&(o=transpose$2(o,[0,4,1,2,3])),o}))}Softmax.className="Softmax",registerClass(Softmax);class BaseConv extends Layer{constructor(e,t){if(super(t),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",BaseConv.verifyArgs(t),this.rank=e,assertPositiveInteger(this.rank,"rank"),1!==this.rank&&2!==this.rank&&3!==this.rank)throw new NotImplementedError(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=normalizeArray(t.kernelSize,e,"kernelSize"),this.strides=normalizeArray(null==t.strides?1:t.strides,e,"strides"),this.padding=null==t.padding?"valid":t.padding,checkPaddingMode(this.padding),this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,checkDataFormat(this.dataFormat),this.activation=getActivation(t.activation),this.useBias=null==t.useBias||t.useBias,this.biasInitializer=getInitializer(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=getConstraint(t.biasConstraint),this.biasRegularizer=getRegularizer(t.biasRegularizer),this.activityRegularizer=getRegularizer(t.activityRegularizer),this.dilationRate=normalizeArray(null==t.dilationRate?1:t.dilationRate,e,"dilationRate"),1===this.rank&&Array.isArray(this.dilationRate)&&1!==this.dilationRate.length)throw new ValueError(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(2===this.rank){if("number"==typeof this.dilationRate)this.dilationRate=[this.dilationRate,this.dilationRate];else if(2!==this.dilationRate.length)throw new ValueError(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(3===this.rank)if("number"==typeof this.dilationRate)this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(3!==this.dilationRate.length)throw new ValueError(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}static verifyArgs(e){if(assert("kernelSize"in e,"required key 'kernelSize' not in config"),"number"!=typeof e.kernelSize&&!checkArrayTypeAndLength(e.kernelSize,"number",1,3))throw new ValueError(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:serializeActivation(this.activation),useBias:this.useBias,biasInitializer:serializeInitializer(this.biasInitializer),biasRegularizer:serializeRegularizer(this.biasRegularizer),activityRegularizer:serializeRegularizer(this.activityRegularizer),biasConstraint:serializeConstraint(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}class Conv extends BaseConv{constructor(e,t){super(e,t),this.kernel=null,Conv.verifyArgs(t),this.filters=t.filters,assertPositiveInteger(this.filters,"filters"),this.kernelInitializer=getInitializer(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=getConstraint(t.kernelConstraint),this.kernelRegularizer=getRegularizer(t.kernelRegularizer)}build(e){e=getExactlyOneShape(e);const t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new ValueError(`The channel dimension of the input should be defined. Found ${e[t]}`);const n=e[t],r=this.kernelSize.concat([n,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[t]:n}}],this.built=!0}call(e,t){return tidy((()=>{let t;e=getExactlyOneTensor(e);const n=null==this.bias?null:this.bias.read(),r=mapActivationToFusedKernel(this.activation.getClassName());if(null!=r&&2===this.rank)t=conv2dWithBiasActivation(e,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate,r);else{if(1===this.rank)t=conv1dWithBias(e,this.kernel.read(),n,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(2===this.rank)t=conv2dWithBiasActivation(e,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate);else{if(3!==this.rank)throw new NotImplementedError("convolutions greater than 3D are not implemented yet.");t=conv3dWithBias(e,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate)}null!=this.activation&&(t=this.activation.apply(t))}return t}))}computeOutputShape(e){e=getExactlyOneShape(e);const t=[],n="channelsLast"===this.dataFormat?e.slice(1,e.length-1):e.slice(2);for(let a=0;a<n.length;++a){const e=convOutputLength(n[a],this.kernelSize[a],this.padding,this.strides[a],"number"==typeof this.dilationRate?this.dilationRate:this.dilationRate[a]);t.push(e)}let r=[e[0]];return"channelsLast"===this.dataFormat?(r=r.concat(t),r.push(this.filters)):(r.push(this.filters),r=r.concat(t)),r}getConfig(){const e={filters:this.filters,kernelInitializer:serializeInitializer(this.kernelInitializer),kernelRegularizer:serializeRegularizer(this.kernelRegularizer),kernelConstraint:serializeConstraint(this.kernelConstraint)},t=super.getConfig();return Object.assign(e,t),e}static verifyArgs(e){if(!("filters"in e)||"number"!=typeof e.filters||e.filters<1)throw new ValueError(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}}class Conv2D extends Conv{constructor(e){super(2,e),Conv2D.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if("number"!=typeof e.kernelSize&&!checkArrayTypeAndLength(e.kernelSize,"number",1,2))throw new ValueError(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}Conv2D.className="Conv2D",registerClass(Conv2D);class Conv3D extends Conv{constructor(e){super(3,e),Conv3D.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if("number"!=typeof e.kernelSize&&(!Array.isArray(e.kernelSize)||1!==e.kernelSize.length&&3!==e.kernelSize.length))throw new ValueError(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}Conv3D.className="Conv3D",registerClass(Conv3D);class Conv2DTranspose extends Conv2D{constructor(e){if(super(e),this.inputSpec=[new InputSpec({ndim:4})],"same"!==this.padding&&"valid"!==this.padding)throw new ValueError(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(4!==(e=getExactlyOneShape(e)).length)throw new ValueError("Input should have rank 4; Received input shape: "+JSON.stringify(e));const t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new ValueError("The channel dimension of the inputs should be defined. Found `None`.");const n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new InputSpec({ndim:4,axes:{[t]:n}})],this.built=!0}call(e,t){return tidy((()=>{let t=getExactlyOneTensor(e);if(4!==t.shape.length)throw new ValueError(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${t.shape.length}`);const n=t.shape,r=n[0];let a,i;"channelsFirst"===this.dataFormat?(a=2,i=3):(a=1,i=2);const s=n[a],o=n[i],l=this.kernelSize[0],u=this.kernelSize[1],c=this.strides[0],h=this.strides[1],d=[r,deconvLength(s,c,l,this.padding),deconvLength(o,h,u,this.padding),this.filters];"channelsLast"!==this.dataFormat&&(t=transpose$2(t,[0,2,3,1]));let p=conv2dTranspose(t,this.kernel.read(),d,this.strides,this.padding);return"channelsLast"!==this.dataFormat&&(p=transpose$2(p,[0,3,1,2])),null!=this.bias&&(p=biasAdd(p,this.bias.read(),this.dataFormat)),null!=this.activation&&(p=this.activation.apply(p)),p}))}computeOutputShape(e){const t=(e=getExactlyOneShape(e)).slice();let n,r,a;"channelsFirst"===this.dataFormat?(n=1,r=2,a=3):(n=3,r=1,a=2);const i=this.kernelSize[0],s=this.kernelSize[1],o=this.strides[0],l=this.strides[1];return t[n]=this.filters,t[r]=deconvLength(t[r],o,i,this.padding),t[a]=deconvLength(t[a],l,s,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}Conv2DTranspose.className="Conv2DTranspose",registerClass(Conv2DTranspose);class Conv3DTranspose extends Conv3D{constructor(e){if(super(e),this.inputSpec=[new InputSpec({ndim:5})],"same"!==this.padding&&"valid"!==this.padding)throw new ValueError(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(5!==(e=getExactlyOneShape(e)).length)throw new ValueError("Input should have rank 5; Received input shape: "+JSON.stringify(e));const t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new ValueError("The channel dimension of the inputs should be defined. Found `None`.");const n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new InputSpec({ndim:5,axes:{[t]:n}})],this.built=!0}call(e,t){return tidy((()=>{let t=getExactlyOneTensor(e);if(5!==t.shape.length)throw new ValueError(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${t.shape.length}`);const n=t.shape,r=n[0];let a,i,s;"channelsFirst"===this.dataFormat?(s=2,a=3,i=4):(s=1,a=2,i=3);const o=n[s],l=n[a],u=n[i],c=this.kernelSize[0],h=this.kernelSize[1],d=this.kernelSize[2],p=this.strides[0],f=this.strides[1],m=this.strides[2],g=[r,deconvLength(o,p,c,this.padding),deconvLength(l,f,h,this.padding),deconvLength(u,m,d,this.padding),this.filters];"channelsLast"!==this.dataFormat&&(t=transpose$2(t,[0,2,3,4,1]));let y=conv3dTranspose(t,this.kernel.read(),g,this.strides,this.padding);return"channelsLast"!==this.dataFormat&&(y=transpose$2(y,[0,4,1,2,3])),null!==this.bias&&(y=biasAdd(y,this.bias.read(),this.dataFormat)),null!==this.activation&&(y=this.activation.apply(y)),y}))}computeOutputShape(e){const t=(e=getExactlyOneShape(e)).slice();let n,r,a,i;"channelsFirst"===this.dataFormat?(n=1,r=2,a=3,i=4):(n=4,r=1,a=2,i=3);const s=this.kernelSize[0],o=this.kernelSize[1],l=this.kernelSize[2],u=this.strides[0],c=this.strides[1],h=this.strides[2];return t[n]=this.filters,t[r]=deconvLength(t[r],u,s,this.padding),t[a]=deconvLength(t[a],c,o,this.padding),t[i]=deconvLength(t[i],h,l,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}Conv3DTranspose.className="Conv3DTranspose",registerClass(Conv3DTranspose);class SeparableConv extends Conv{constructor(e,t){if(super(e,t),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,null==t.filters)throw new ValueError("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=t.kernelInitializer||null!=t.kernelRegularizer||null!=t.kernelConstraint)throw new ValueError("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=t.padding&&"same"!==t.padding&&"valid"!==t.padding)throw new ValueError(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(t.padding)}`);this.depthMultiplier=null==t.depthMultiplier?1:t.depthMultiplier,this.depthwiseInitializer=getInitializer(t.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=getRegularizer(t.depthwiseRegularizer),this.depthwiseConstraint=getConstraint(t.depthwiseConstraint),this.pointwiseInitializer=getInitializer(t.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=getRegularizer(t.pointwiseRegularizer),this.pointwiseConstraint=getConstraint(t.pointwiseConstraint)}build(e){if((e=getExactlyOneShape(e)).length<this.rank+2)throw new ValueError(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);const t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t]||e[t]<0)throw new ValueError(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[t])}`);const n=e[t],r=this.kernelSize.concat([n,this.depthMultiplier]),a=[];for(let s=0;s<this.rank;++s)a.push(1);a.push(n*this.depthMultiplier,this.filters);const i=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,i,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",a,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,i,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,i,this.biasConstraint):this.bias=null,this.inputSpec=[new InputSpec({ndim:this.rank+2,axes:{[t]:n}})],this.built=!0}call(e,t){return tidy((()=>{let t;if(e=getExactlyOneTensor(e),1===this.rank)throw new NotImplementedError("1D separable convolution is not implemented yet.");return 2===this.rank&&("channelsFirst"===this.dataFormat&&(e=transpose$2(e,[0,2,3,1])),t=separableConv2d(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(t=biasAdd(t,this.bias.read(),this.dataFormat)),null!=this.activation&&(t=this.activation.apply(t)),"channelsFirst"===this.dataFormat&&(t=transpose$2(t,[0,3,1,2])),t}))}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=serializeInitializer(this.depthwiseInitializer),e.pointwiseInitializer=serializeInitializer(this.pointwiseInitializer),e.depthwiseRegularizer=serializeRegularizer(this.depthwiseRegularizer),e.pointwiseRegularizer=serializeRegularizer(this.pointwiseRegularizer),e.depthwiseConstraint=serializeConstraint(this.depthwiseConstraint),e.pointwiseConstraint=serializeConstraint(this.pointwiseConstraint),e}}SeparableConv.className="SeparableConv";class SeparableConv2D extends SeparableConv{constructor(e){super(2,e)}}SeparableConv2D.className="SeparableConv2D",registerClass(SeparableConv2D);class Conv1D extends Conv{constructor(e){super(1,e),Conv1D.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if("number"!=typeof e.kernelSize&&!checkArrayTypeAndLength(e.kernelSize,"number",1,1))throw new ValueError(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}Conv1D.className="Conv1D",registerClass(Conv1D);class Cropping2D extends Layer{constructor(e){super(e),"number"==typeof e.cropping?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:"number"==typeof e.cropping[0]?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=void 0===e.dataFormat?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return"channelsFirst"===this.dataFormat?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,t){return tidy((()=>{if(e=getExactlyOneTensor(e),"channelsLast"===this.dataFormat){const t=sliceAlongAxis(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return sliceAlongAxis(t,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}{const t=sliceAlongAxis(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return sliceAlongAxis(t,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}}))}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}Cropping2D.className="Cropping2D",registerClass(Cropping2D);class UpSampling2D extends Layer{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=null==e.size?this.DEFAULT_SIZE:e.size,this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,checkDataFormat(this.dataFormat),this.interpolation=null==e.interpolation?"nearest":e.interpolation,checkInterpolationFormat(this.interpolation)}computeOutputShape(e){if("channelsFirst"===this.dataFormat){const t=null==e[2]?null:this.size[0]*e[2],n=null==e[3]?null:this.size[1]*e[3];return[e[0],e[1],t,n]}{const t=null==e[1]?null:this.size[0]*e[1],n=null==e[2]?null:this.size[1]*e[2];return[e[0],t,n,e[3]]}}call(e,t){return tidy((()=>{let t=getExactlyOneTensor(e);const n=t.shape;if("channelsFirst"===this.dataFormat){t=transpose$2(t,[0,2,3,1]);const e=this.size[0]*n[2],r=this.size[1]*n[3],a="nearest"===this.interpolation?image$1.resizeNearestNeighbor(t,[e,r]):image$1.resizeBilinear(t,[e,r]);return transpose$2(a,[0,3,1,2])}{const e=this.size[0]*n[1],r=this.size[1]*n[2];return"nearest"===this.interpolation?image$1.resizeNearestNeighbor(t,[e,r]):image$1.resizeBilinear(t,[e,r])}}))}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */
function depthwiseConv2d(e,t,n=[1,1],r="valid",a,i){return tidy((()=>{null==a&&(a=imageDataFormat()),checkDataFormat(a);let s=preprocessConv2DInput(e,a);if(4!==e.rank)throw new ValueError(`Input for depthwiseConv2d is required to be 4-D, but is instead ${e.rank}-D`);if(4!==t.rank)throw new ValueError(`depthwiseKernel is required to be 4-D, but is instead ${t.rank}-D`);return s=depthwiseConv2d$2(s,t,n,"same"===r?"same":"valid","NHWC",i),"channelsFirst"===a&&(s=transpose$2(s,[0,3,1,2])),s}))}UpSampling2D.className="UpSampling2D",registerClass(UpSampling2D);class DepthwiseConv2D extends BaseConv{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=null==e.depthMultiplier?1:e.depthMultiplier,this.depthwiseInitializer=getInitializer(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=getConstraint(e.depthwiseConstraint),this.depthwiseRegularizer=getRegularizer(e.depthwiseRegularizer)}build(e){if((e=getExactlyOneShape(e)).length<4)throw new ValueError(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const t="channelsFirst"===this.dataFormat?1:3;if(null==e[t]||e[t]<0)throw new ValueError(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[t]}).`);const n=e[t],r=[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return tidy((()=>{let t=depthwiseConv2d(e=getExactlyOneTensor(e),this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(t=biasAdd(t,this.bias.read(),this.dataFormat)),null!=this.activation&&(t=this.activation.apply(t)),t}))}computeOutputShape(e){e=getExactlyOneShape(e);const t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,a=convOutputLength(t,this.kernelSize[0],this.padding,this.strides[0]),i=convOutputLength(n,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[e[0],r,a,i]:[e[0],a,i,r]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=serializeInitializer(this.depthwiseInitializer),e.depthwiseRegularizer=serializeRegularizer(this.depthwiseRegularizer),e.depthwiseConstraint=serializeConstraint(this.depthwiseRegularizer),e}}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */
function standardizeArgs(e,t,n,r){if(Array.isArray(e)){if(null!=t||null!=n)throw new ValueError("When inputs is an array, neither initialState or constants should be provided");null!=r&&(n=e.slice(e.length-r,e.length),e=e.slice(0,e.length-r)),e.length>1&&(t=e.slice(1,e.length)),e=e[0]}function a(e){return null==e||Array.isArray(e)?e:[e]}return{inputs:e,initialState:t=a(t),constants:n=a(n)}}function rnn(e,t,n,r=!1,a,i,s=!1,o=!1){return tidy((()=>{const l=t.shape.length;if(l<3)throw new ValueError(`Input should be at least 3D, but is ${l}D.`);const u=[1,0].concat(range$3(2,l));if(t=transpose$2(t,u),null!=i)throw new NotImplementedError("The rnn() functoin of the deeplearn.js backend does not support constants yet.");s&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),null!=a&&((a=cast$3(cast$3(a,"bool"),"float32")).rank===l-1&&(a=expandDims$3(a,-1)),a=transpose$2(a,u)),r&&(t=reverse$2(t,0),null!=a&&(a=reverse$2(a,0)));const c=[];let h,d=n;const p=t.shape[0],f=unstack(t);let m,g;null!=a&&(m=unstack(a));for(let t=0;t<p;++t){const n=f[t],r=tidy((()=>e(n,d)));if(null==a)h=r[0],d=r[1];else{const e=tidy((()=>{const e=m[t],n=sub$2(onesLike$2(e),e);return{output:add$1(mul(r[0],e),mul(d[0],n)),newStates:d.map(((t,a)=>add$1(mul(r[1][a],e),mul(t,n))))}}));h=e.output,d=e.newStates}o&&c.push(h)}if(o){g=stack(c,1)}return[h,g,d]}))}DepthwiseConv2D.className="DepthwiseConv2D",registerClass(DepthwiseConv2D);class RNN extends Layer{constructor(e){let t;if(super(e),null==e.cell)throw new ValueError("cell property is missing for the constructor of RNN.");if(t=Array.isArray(e.cell)?new StackedRNNCells({cells:e.cell}):e.cell,null==t.stateSize)throw new ValueError("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=t,this.returnSequences=null!=e.returnSequences&&e.returnSequences,this.returnState=null!=e.returnState&&e.returnState,this.goBackwards=null!=e.goBackwards&&e.goBackwards,this._stateful=null!=e.stateful&&e.stateful,this.unroll=null!=e.unroll&&e.unroll,this.supportsMasking=!0,this.inputSpec=[new InputSpec({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(null==this.states_){return range$3(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map((e=>null))}return this.states_}setStates(e){this.states_=e}computeOutputShape(e){isArrayOfShapes(e)&&(e=e[0]);let t=this.cell.stateSize;Array.isArray(t)||(t=[t]);const n=t[0];let r;if(r=this.returnSequences?[e[0],e[1],n]:[e[0],n],this.returnState){const n=[];for(const r of t)n.push([e[0],r]);return[r].concat(n)}return r}computeMask(e,t){return tidy((()=>{Array.isArray(t)&&(t=t[0]);const e=this.returnSequences?t:null;if(this.returnState){const t=this.states.map((e=>null));return[e].concat(t)}return e}))}get states(){if(null==this.states_){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[];for(let n=0;n<e;++n)t.push(null);return t}return this.states_}set states(e){this.states_=e}build(e){if(null!=this.numConstants)throw new NotImplementedError("Constants support is not implemented in RNN yet.");isArrayOfShapes(e)&&(e=e[0]);const t=this.stateful?e[0]:null,n=e.slice(2);this.inputSpec[0]=new InputSpec({shape:[t,null,...n]});const r=[e[0]].concat(e.slice(2));let a;if(this.cell.build(r),a=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!arraysEqual(this.stateSpec.map((e=>e.shape[e.shape.length-1])),a))throw new ValueError(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=a.map((e=>new InputSpec({shape:[null,e]})));this.stateful&&this.resetStates()}resetStates(e,t=!1){tidy((()=>{if(!this.stateful)throw new AttributeError("Cannot call resetStates() on an RNN Layer that is not stateful.");const n=this.inputSpec[0].shape[0];if(null==n)throw new ValueError("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==this.states_)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((e=>zeros$1([n,e]))):this.states_=[zeros$1([n,this.cell.stateSize])];else if(null==e)dispose(this.states_),null!=this.keptStates&&(dispose(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((e=>zeros$1([n,e]))):this.states_[0]=zeros$1([n,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new ValueError(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);!0===t?this.keptStates.push(this.states_.slice()):dispose(this.states_);for(let t=0;t<this.states_.length;++t){const r=e[t],a=Array.isArray(this.cell.stateSize)?this.cell.stateSize[t]:this.cell.stateSize,i=[n,a];if(!arraysEqual(r.shape,i))throw new ValueError(`State ${t} is incompatible with layer ${this.name}: expected shape=${i}, received shape=${r.shape}`);this.states_[t]=r}}this.states_=this.states_.map((e=>keep(e.clone())))}))}apply(e,t){let n=null==t?null:t.initialState,r=null==t?null:t.constants;null==t&&(t={});const a=standardizeArgs(e,n,r,this.numConstants);e=a.inputs,n=a.initialState,r=a.constants;let i=[],s=[];if(null!=n){t.initialState=n,i=i.concat(n),this.stateSpec=[];for(const e of n)this.stateSpec.push(new InputSpec({shape:e.shape}));s=s.concat(this.stateSpec)}null!=r&&(t.constants=r,i=i.concat(r),this.numConstants=r.length);if(i[0]instanceof SymbolicTensor){const n=[e].concat(i),r=this.inputSpec.concat(s),a=this.inputSpec;this.inputSpec=r;const o=super.apply(n,t);return this.inputSpec=a,o}return super.apply(e,t)}call(e,t){return tidy((()=>{const n=null==t?null:t.mask,r=null==t?null:t.training;let a=null==t?null:t.initialState;e=getExactlyOneTensor(e),null==a&&(a=this.stateful?this.states_:this.getInitialState(e));const i=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(a.length!==i)throw new ValueError(`RNN Layer has ${i} state(s) but was passed ${a.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const s={training:r},o=rnn(((e,t)=>{const n=this.cell.call([e].concat(t),s);return[n[0],n.slice(1)]}),e,a,this.goBackwards,n,null,this.unroll,this.returnSequences),l=o[0],u=o[1],c=o[2];this.stateful&&this.resetStates(c,r);const h=this.returnSequences?u:l;return this.returnState?[h].concat(c):h}))}getInitialState(e){return tidy((()=>{let t=zeros$1(e.shape);return t=sum$2(t,[1,2]),t=expandDims$2(t),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map((e=>e>1?tile$2(t,[1,e]):t)):this.cell.stateSize>1?[tile$2(t,[1,this.cell.stateSize])]:[t]}))}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),null!=this.cell&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(t.numConstants=this.numConstants);const n=this.cell.getConfig();return this.getClassName()===RNN.className&&(t.cell={className:this.cell.getClassName(),config:n}),Object.assign(Object.assign(Object.assign({},n),e),t)}static fromConfig(e,t,n={}){const r=deserialize(t.cell,n);return new e(Object.assign(t,{cell:r}))}}RNN.className="RNN",registerClass(RNN);class RNNCell extends Layer{}class SimpleRNNCell extends RNNCell{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,assertPositiveInteger(this.units,"units"),this.activation=getActivation(null==e.activation?this.DEFAULT_ACTIVATION:e.activation),this.useBias=null==e.useBias||e.useBias,this.kernelInitializer=getInitializer(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=getInitializer(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=getInitializer(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=getRegularizer(e.kernelRegularizer),this.recurrentRegularizer=getRegularizer(e.recurrentRegularizer),this.biasRegularizer=getRegularizer(e.biasRegularizer),this.kernelConstraint=getConstraint(e.kernelConstraint),this.recurrentConstraint=getConstraint(e.recurrentConstraint),this.biasConstraint=getConstraint(e.biasConstraint),this.dropout=min$2([1,max$2([0,null==e.dropout?0:e.dropout])]),this.recurrentDropout=min$2([1,max$2([0,null==e.recurrentDropout?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=getExactlyOneShape(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return tidy((()=>{if(2!==e.length)throw new ValueError(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let n=e[1];e=e[0];const r=null!=t.training&&t.training;let a;0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=generateDropoutMask({ones:()=>onesLike$2(e),rate:this.dropout,training:r,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=generateDropoutMask({ones:()=>onesLike$2(n),rate:this.recurrentDropout,training:r,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,s=this.recurrentDropoutMask;a=dot(null!=i?mul(e,i):e,this.kernel.read()),null!=this.bias&&(a=biasAdd(a,this.bias.read())),null!=s&&(n=mul(n,s));let o=add$1(a,dot(n,this.recurrentKernel.read()));return null!=this.activation&&(o=this.activation.apply(o)),[o,o]}))}getConfig(){const e=super.getConfig(),t={units:this.units,activation:serializeActivation(this.activation),useBias:this.useBias,kernelInitializer:serializeInitializer(this.kernelInitializer),recurrentInitializer:serializeInitializer(this.recurrentInitializer),biasInitializer:serializeInitializer(this.biasInitializer),kernelRegularizer:serializeRegularizer(this.kernelRegularizer),recurrentRegularizer:serializeRegularizer(this.recurrentRegularizer),biasRegularizer:serializeRegularizer(this.biasRegularizer),activityRegularizer:serializeRegularizer(this.activityRegularizer),kernelConstraint:serializeConstraint(this.kernelConstraint),recurrentConstraint:serializeConstraint(this.recurrentConstraint),biasConstraint:serializeConstraint(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),t)}}SimpleRNNCell.className="SimpleRNNCell",registerClass(SimpleRNNCell);class SimpleRNN extends RNN{constructor(e){e.cell=new SimpleRNNCell(e),super(e)}call(e,t){return tidy((()=>{null!=this.cell.dropoutMask&&(dispose(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(dispose(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==t?null:t.mask,r=null==t?null:t.training,a=null==t?null:t.initialState;return super.call(e,{mask:n,training:r,initialState:a})}))}static fromConfig(e,t){return new e(t)}}SimpleRNN.className="SimpleRNN",registerClass(SimpleRNN);class GRUCell extends RNNCell{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new ValueError("GRUCell does not support reset_after parameter set to true.");this.units=e.units,assertPositiveInteger(this.units,"units"),this.activation=getActivation(void 0===e.activation?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=getActivation(void 0===e.recurrentActivation?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=null==e.useBias||e.useBias,this.kernelInitializer=getInitializer(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=getInitializer(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=getInitializer(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=getRegularizer(e.kernelRegularizer),this.recurrentRegularizer=getRegularizer(e.recurrentRegularizer),this.biasRegularizer=getRegularizer(e.biasRegularizer),this.kernelConstraint=getConstraint(e.kernelConstraint),this.recurrentConstraint=getConstraint(e.recurrentConstraint),this.biasConstraint=getConstraint(e.biasConstraint),this.dropout=min$2([1,max$2([0,null==e.dropout?0:e.dropout])]),this.recurrentDropout=min$2([1,max$2([0,null==e.recurrentDropout?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){const t=(e=getExactlyOneShape(e))[e.length-1];this.kernel=this.addWeight("kernel",[t,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return tidy((()=>{if(2!==e.length)throw new ValueError(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);const n=null!=t.training&&t.training;let r=e[1];e=e[0],0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=generateDropoutMask({ones:()=>onesLike$2(e),rate:this.dropout,training:n,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=generateDropoutMask({ones:()=>onesLike$2(r),rate:this.recurrentDropout,training:n,count:3,dropoutFunc:this.dropoutFunc}));const a=this.dropoutMask,i=this.recurrentDropoutMask;let s,o,l;0<this.dropout&&this.dropout<1&&(e=mul(e,a[0]));let u=dot(e,this.kernel.read());this.useBias&&(u=biasAdd(u,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=mul(r,i[0]));const c=this.recurrentKernel.read(),[h,d]=split$3(c,[2*this.units,this.units],c.rank-1),p=dot(r,h),[f,m,g]=split$3(u,3,u.rank-1),[y,v]=split$3(p,2,p.rank-1);s=this.recurrentActivation.apply(add$1(f,y)),o=this.recurrentActivation.apply(add$1(m,v));const b=dot(mul(o,r),d);l=this.activation.apply(add$1(g,b));const x=add$1(mul(s,r),mul(add$1(1,neg$2(s)),l));return[x,x]}))}getConfig(){const e=super.getConfig(),t={units:this.units,activation:serializeActivation(this.activation),recurrentActivation:serializeActivation(this.recurrentActivation),useBias:this.useBias,kernelInitializer:serializeInitializer(this.kernelInitializer),recurrentInitializer:serializeInitializer(this.recurrentInitializer),biasInitializer:serializeInitializer(this.biasInitializer),kernelRegularizer:serializeRegularizer(this.kernelRegularizer),recurrentRegularizer:serializeRegularizer(this.recurrentRegularizer),biasRegularizer:serializeRegularizer(this.biasRegularizer),activityRegularizer:serializeRegularizer(this.activityRegularizer),kernelConstraint:serializeConstraint(this.kernelConstraint),recurrentConstraint:serializeConstraint(this.recurrentConstraint),biasConstraint:serializeConstraint(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),t)}}GRUCell.className="GRUCell",registerClass(GRUCell);class GRU extends RNN{constructor(e){0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new GRUCell(e),super(e)}call(e,t){return tidy((()=>{null!=this.cell.dropoutMask&&(dispose(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(dispose(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==t?null:t.mask,r=null==t?null:t.training,a=null==t?null:t.initialState;return super.call(e,{mask:n,training:r,initialState:a})}))}static fromConfig(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}GRU.className="GRU",registerClass(GRU);class LSTMCell extends RNNCell{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,assertPositiveInteger(this.units,"units"),this.activation=getActivation(void 0===e.activation?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=getActivation(void 0===e.recurrentActivation?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=null==e.useBias||e.useBias,this.kernelInitializer=getInitializer(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=getInitializer(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=getInitializer(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=getRegularizer(e.kernelRegularizer),this.recurrentRegularizer=getRegularizer(e.recurrentRegularizer),this.biasRegularizer=getRegularizer(e.biasRegularizer),this.kernelConstraint=getConstraint(e.kernelConstraint),this.recurrentConstraint=getConstraint(e.recurrentConstraint),this.biasConstraint=getConstraint(e.biasConstraint),this.dropout=min$2([1,max$2([0,null==e.dropout?0:e.dropout])]),this.recurrentDropout=min$2([1,max$2([0,null==e.recurrentDropout?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var t;const n=(e=getExactlyOneShape(e))[e.length-1];let r;if(this.kernel=this.addWeight("kernel",[n,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){const e=this.biasInitializer,n=this.units;r=new((t=class extends Initializer{apply(t,r){const a=e.apply([n]),i=(new Ones).apply([n]),s=e.apply([2*n]);return concatAlongFirstAxis(concatAlongFirstAxis(a,i),s)}}).className="CustomInit",t)}else r=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,r,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,t){return tidy((()=>{const n=null!=t.training&&t.training;if(3!==e.length)throw new ValueError(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let r=e[1];const a=e[2];e=e[0],0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=generateDropoutMask({ones:()=>onesLike$2(e),rate:this.dropout,training:n,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=generateDropoutMask({ones:()=>onesLike$2(r),rate:this.recurrentDropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,s=this.recurrentDropoutMask;let o,l,u,c;0<this.dropout&&this.dropout<1&&(e=mul(e,i[0]));let h=dot(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=mul(r,s[0])),h=add$1(h,dot(r,this.recurrentKernel.read())),this.useBias&&(h=biasAdd(h,this.bias.read()));const[d,p,f,m]=split$3(h,4,h.rank-1);o=this.recurrentActivation.apply(d),l=this.recurrentActivation.apply(p),u=add$1(mul(l,a),mul(o,this.activation.apply(f))),c=this.recurrentActivation.apply(m);const g=mul(c,this.activation.apply(u));return[g,g,u]}))}getConfig(){const e=super.getConfig(),t={units:this.units,activation:serializeActivation(this.activation),recurrentActivation:serializeActivation(this.recurrentActivation),useBias:this.useBias,kernelInitializer:serializeInitializer(this.kernelInitializer),recurrentInitializer:serializeInitializer(this.recurrentInitializer),biasInitializer:serializeInitializer(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:serializeRegularizer(this.kernelRegularizer),recurrentRegularizer:serializeRegularizer(this.recurrentRegularizer),biasRegularizer:serializeRegularizer(this.biasRegularizer),activityRegularizer:serializeRegularizer(this.activityRegularizer),kernelConstraint:serializeConstraint(this.kernelConstraint),recurrentConstraint:serializeConstraint(this.recurrentConstraint),biasConstraint:serializeConstraint(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),t)}}LSTMCell.className="LSTMCell",registerClass(LSTMCell);class LSTM extends RNN{constructor(e){0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new LSTMCell(e),super(e)}call(e,t){return tidy((()=>{null!=this.cell.dropoutMask&&(dispose(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(dispose(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==t?null:t.mask,r=null==t?null:t.training,a=null==t?null:t.initialState;return super.call(e,{mask:n,training:r,initialState:a})}))}static fromConfig(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}LSTM.className="LSTM",registerClass(LSTM);class StackedRNNCells extends RNNCell{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const t of this.cells.slice().reverse())Array.isArray(t.stateSize)?e.push(...t.stateSize):e.push(t.stateSize);return e}call(e,t){return tidy((()=>{let n=e.slice(1);const r=[];for(const e of this.cells.slice().reverse())Array.isArray(e.stateSize)?r.push(n.splice(0,e.stateSize.length)):r.push(n.splice(0,1));r.reverse();const a=[];let i;for(let s=0;s<this.cells.length;++s){const o=this.cells[s];n=r[s],i=0===s?[e[0]].concat(n):[i[0]].concat(n),i=o.call(i,t),a.push(i.slice(1))}n=[];for(const e of a.slice().reverse())n.push(...e);return[i[0]].concat(n)}))}build(e){let t;isArrayOfShapes(e)&&(e=e[0]),this.cells.forEach(((n,r)=>{nameScope(`RNNCell_${r}`,(()=>{n.build(e),t=Array.isArray(n.stateSize)?n.stateSize[0]:n.stateSize,e=[e[0],t]}))})),this.built=!0}getConfig(){const e=super.getConfig(),t={cells:this.cells.map((e=>({className:e.getClassName(),config:e.getConfig()})))};return Object.assign(Object.assign({},e),t)}static fromConfig(e,t,n={}){const r=[];for(const a of t.cells)r.push(deserialize(a,n));return new e({cells:r})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const t of this.cells)e.push(...t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.cells)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const e of this.cells)t.push(...e.trainableWeights);return t.concat(e)}return e}getWeights(){const e=[];for(const t of this.cells)e.push(...t.weights);return batchGetValue(e)}setWeights(e){const t=[];for(const n of this.cells){const r=n.weights.length,a=e.splice(r);for(let e=0;e<n.weights.length;++e)t.push([n.weights[e],a[e]])}batchSetValue(t)}}function generateDropoutMask(e){const{ones:t,rate:n,training:r=!1,count:a=1,dropoutFunc:i}=e,s=()=>null!=i?i(t(),n):dropout(t(),n),o=()=>inTrainPhase(s,t,r);if(!a||a<=1)return keep(o().clone());return Array(a).fill(void 0).map(o).map((e=>keep(e.clone())))}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */StackedRNNCells.className="StackedRNNCells",registerClass(StackedRNNCells);var __rest=globalThis&&globalThis.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n};class ConvRNN2D extends RNN{constructor(e){if(e.unroll)throw new NotImplementedError("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new NotImplementedError("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new InputSpec({ndim:5})]}call(e,t){return tidy((()=>{if(null!=this.cell.dropoutMask&&(dispose(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(dispose(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),t&&t.constants)throw new ValueError("ConvRNN2D cell does not support constants");const n=null==t?null:t.mask,r=null==t?null:t.training,a=null==t?null:t.initialState;return super.call(e,{mask:n,training:r,initialState:a})}))}computeOutputShape(e){let t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0],...t.slice(2)]),this.returnState&&(t=[t,...Array(2).fill([e[0],...t.slice(-3)])]),t}getInitialState(e){return tidy((()=>{const{stateSize:t}=this.cell,n=e.shape,r=this.computeSingleOutputShape(n),a=zeros$1([r[0],...r.slice(2)]);return Array.isArray(t)?Array(t.length).fill(a):[a]}))}resetStates(e,t=!1){tidy((()=>{if(!this.stateful)throw new AttributeError("Cannot call resetStates() on an RNN Layer that is not stateful.");const n=this.inputSpec[0].shape,r=this.computeSingleOutputShape(n),a=[r[0],...r.slice(2)];if(null==n[0])throw new ValueError("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==this.getStates())Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((()=>zeros$1(a))):this.states_=[zeros$1(a)];else if(null==e)dispose(this.states_),null!=this.keptStates&&(dispose(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((()=>zeros$1(a))):this.states_[0]=zeros$1(a);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new ValueError(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t?this.keptStates.push(this.states_.slice()):dispose(this.states_);for(let t=0;t<this.states_.length;++t){const n=e[t],r=a;if(!arraysEqual(n.shape,r))throw new ValueError(`State ${t} is incompatible with layer ${this.name}: expected shape=${r}, received shape=${n.shape}`);this.states_[t]=n}}this.states_=this.states_.map((e=>keep(e.clone())))}))}computeSingleOutputShape(e){const{dataFormat:t,filters:n,kernelSize:r,padding:a,strides:i,dilationRate:s}=this.cell,o="channelsFirst"===t,l=e[o?3:2],u=e[o?4:3],c=convOutputLength(l,r[0],a,i[0],s[0]),h=convOutputLength(u,r[1],a,i[1],s[1]);return[...e.slice(0,2),...o?[n,c,h]:[c,h,n]]}}ConvRNN2D.className="ConvRNN2D";class ConvLSTM2DCell extends LSTMCell{constructor(e){const{filters:t,kernelSize:n,strides:r,padding:a,dataFormat:i,dilationRate:s}=e;super(Object.assign(Object.assign({},e),{units:t})),this.filters=t,assertPositiveInteger(this.filters,"filters"),this.kernelSize=normalizeArray(n,2,"kernelSize"),this.kernelSize.forEach((e=>assertPositiveInteger(e,"kernelSize"))),this.strides=normalizeArray(r||1,2,"strides"),this.strides.forEach((e=>assertPositiveInteger(e,"strides"))),this.padding=a||"valid",checkPaddingMode(this.padding),this.dataFormat=i||"channelsLast",checkDataFormat(this.dataFormat),this.dilationRate=normalizeArray(s||1,2,"dilationRate"),this.dilationRate.forEach((e=>assertPositiveInteger(e,"dilationRate")))}build(e){var t;e=getExactlyOneShape(e);const n="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[n])throw new ValueError(`The channel dimension of the input should be defined. Found ${e[n]}`);const r=e[n],a=this.kernelSize.concat([r,4*this.filters]);this.kernel=this.addWeight("kernel",a,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const i=this.kernelSize.concat([this.filters,4*this.filters]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",i,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let e;if(this.unitForgetBias){const n=this.biasInitializer,r=this.filters;e=new((t=class extends Initializer{apply(e,t){return concatenate([n.apply([r]),ones([r]),n.apply([2*r])])}}).className="CustomInit",t)}else e=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.filters],null,e,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,t){return tidy((()=>{if(3!==e.length)throw new ValueError(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);const n=t.training||!1,r=e[0],a=e[1],i=e[2];0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=generateDropoutMask({ones:()=>onesLike$2(r),rate:this.dropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));const s=this.dropoutMask,o=(e,t,n)=>t&&t[n]?mul(t[n],e):e;let l=o(r,s,0),u=o(r,s,1),c=o(r,s,2),h=o(r,s,3);0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=generateDropoutMask({ones:()=>onesLike$2(a),rate:this.recurrentDropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));const d=this.recurrentDropoutMask;let p=o(a,d,0),f=o(a,d,1),m=o(a,d,2),g=o(a,d,3);const[y,v,b,x]=split$3(this.kernel.read(),4,3),[T,_,w,S]=this.useBias?split$3(this.bias.read(),4):[null,null,null,null];l=this.inputConv(l,y,T,this.padding),u=this.inputConv(u,v,_,this.padding),c=this.inputConv(c,b,w,this.padding),h=this.inputConv(h,x,S,this.padding);const[C,E,k,I]=split$3(this.recurrentKernel.read(),4,3);p=this.recurrentConv(p,C),f=this.recurrentConv(f,E),m=this.recurrentConv(m,k),g=this.recurrentConv(g,I);const A=this.recurrentActivation.apply(add$1(l,p)),N=this.recurrentActivation.apply(add$1(u,f)),$=add$1(mul(N,i),mul(A,this.activation.apply(add$1(c,m)))),D=mul(this.recurrentActivation.apply(add$1(h,g)),this.activation.apply($));return[D,D,$]}))}getConfig(){const e=super.getConfig(),t=__rest(e,["units"]),n={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},t),n)}inputConv(e,t,n,r){const a=conv2d$2(e,t,this.strides,r||"valid","channelsFirst"===this.dataFormat?"NCHW":"NHWC",this.dilationRate);return n?biasAdd(a,n,this.dataFormat):a}recurrentConv(e,t){return conv2d$2(e,t,1,"same","channelsFirst"===this.dataFormat?"NCHW":"NHWC")}}ConvLSTM2DCell.className="ConvLSTM2DCell",registerClass(ConvLSTM2DCell);class ConvLSTM2D extends ConvRNN2D{constructor(e){const t=new ConvLSTM2DCell(e);super(Object.assign(Object.assign({},e),{cell:t}))}static fromConfig(e,t){return new e(t)}}ConvLSTM2D.className="ConvLSTM2D",registerClass(ConvLSTM2D);
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */
class Dropout extends Layer{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(null==this.noiseShape)return this.noiseShape;const t=e.shape,n=[];for(let r=0;r<this.noiseShape.length;++r)n.push(null==this.noiseShape[r]?t[r]:this.noiseShape[r]);return n}call(e,t){return tidy((()=>{this.invokeCallHook(e,t);const n=getExactlyOneTensor(e);if(0<this.rate&&this.rate<1){const e=null!=t.training&&t.training,r=this.getNoiseShape(n);return inTrainPhase((()=>dropout(n,this.rate,r,this.seed)),(()=>n),e)}return e}))}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=super.getConfig();return Object.assign(e,t),e}dispose(){return super.dispose()}}Dropout.className="Dropout",registerClass(Dropout);class SpatialDropout1D extends Dropout{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const t=e.shape;return[t[0],1,t[2]]}}SpatialDropout1D.className="SpatialDropout1D",registerClass(SpatialDropout1D);class Dense extends Layer{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",null==e.batchInputShape&&null==e.inputShape&&null!=e.inputDim){let t=null;null!=e.batchSize&&(t=e.batchSize),this.batchInputShape=[t,e.inputDim]}this.units=e.units,assertPositiveInteger(this.units,"units"),this.activation=getActivation(e.activation),null!=e.useBias&&(this.useBias=e.useBias),this.kernelInitializer=getInitializer(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=getInitializer(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=getConstraint(e.kernelConstraint),this.biasConstraint=getConstraint(e.biasConstraint),this.kernelRegularizer=getRegularizer(e.kernelRegularizer),this.biasRegularizer=getRegularizer(e.biasRegularizer),this.activityRegularizer=getRegularizer(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){const t=(e=getExactlyOneShape(e))[e.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:t}}],this.built=!0}computeOutputShape(e){const t=(e=getExactlyOneShape(e)).slice();return t[t.length-1]=this.units,t}call(e,t){return tidy((()=>{this.invokeCallHook(e,t);const n=getExactlyOneTensor(e),r=mapActivationToFusedKernel(this.activation.getClassName());let a;return null!=r?a=dot(n,this.kernel.read(),r,this.bias?this.bias.read():null):(a=dot(n,this.kernel.read()),null!=this.bias&&(a=biasAdd(a,this.bias.read())),null!=this.activation&&(a=this.activation.apply(a))),a}))}getConfig(){const e={units:this.units,activation:serializeActivation(this.activation),useBias:this.useBias,kernelInitializer:serializeInitializer(this.kernelInitializer),biasInitializer:serializeInitializer(this.biasInitializer),kernelRegularizer:serializeRegularizer(this.kernelRegularizer),biasRegularizer:serializeRegularizer(this.biasRegularizer),activityRegularizer:serializeRegularizer(this.activityRegularizer),kernelConstraint:serializeConstraint(this.kernelConstraint),biasConstraint:serializeConstraint(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}Dense.className="Dense",registerClass(Dense);class Flatten extends Layer{constructor(e){super(e=e||{}),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=getExactlyOneShape(e);for(const t of e.slice(1))if(null==t)throw new ValueError(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],arrayProd(e,1)]}call(e,t){return tidy((()=>{this.invokeCallHook(e,t);let n=getExactlyOneTensor(e);if("channelsFirst"===this.dataFormat&&n.rank>1){const e=[0];for(let t=2;t<n.rank;++t)e.push(t);e.push(1),n=transpose$2(n,e)}return batchFlatten(n)}))}getConfig(){const e={};null!=this.dataFormat&&(e.dataFormat=this.dataFormat);const t=super.getConfig();return Object.assign(e,t),e}}Flatten.className="Flatten",registerClass(Flatten);class Activation extends Layer{constructor(e){super(e),this.supportsMasking=!0,this.activation=getActivation(e.activation)}call(e,t){return tidy((()=>{this.invokeCallHook(e,t);const n=getExactlyOneTensor(e);return this.activation.apply(n)}))}getConfig(){const e={activation:serializeActivation(this.activation)},t=super.getConfig();return Object.assign(e,t),e}}Activation.className="Activation",registerClass(Activation);class RepeatVector extends Layer{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,t){return tidy((()=>repeat(e=getExactlyOneTensor(e),this.n)))}getConfig(){const e={n:this.n},t=super.getConfig();return Object.assign(e,t),e}}RepeatVector.className="RepeatVector",registerClass(RepeatVector);class Reshape extends Layer{constructor(e){super(e),this.targetShape=e.targetShape;for(let t=0;t<this.targetShape.length;++t)this.isUnknown(this.targetShape[t])&&(this.targetShape[t]=null)}isUnknown(e){return e<0||null==e}fixUnknownDimension(e,t){const n="Total size of new array must be unchanged.",r=t.slice();let a=1,i=null;for(let o=0;o<r.length;++o){const e=r[o];if(this.isUnknown(e)){if(null!==i)throw new ValueError("Can only specifiy one unknown dimension.");i=o}else a*=e}const s=arrayProd(e);if(null!==i){if(0===a||s%a!=0)throw new ValueError(n);r[i]=s/a}else if(s!==a)throw new ValueError(n);return r}computeOutputShape(e){let t=!1;for(let n=0;n<e.length;++n)if(this.isUnknown(e[n])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,t){return tidy((()=>{this.invokeCallHook(e,t);const n=getExactlyOneTensor(e),r=n.shape,a=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return reshape$2(n,a)}))}getConfig(){const e={targetShape:this.targetShape},t=super.getConfig();return Object.assign(e,t),e}}Reshape.className="Reshape",registerClass(Reshape);class Permute extends Layer{constructor(e){if(super(e),null==e.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);const t=range$3(1,e.dims.length+1);if(!arraysEqual(e.dims.slice().sort(),t))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new InputSpec({ndim:this.dims.length+1})]}computeOutputShape(e){const t=(e=getExactlyOneShape(e)).slice();return this.dims.forEach(((n,r)=>{t[r+1]=e[n]})),t}call(e,t){return transpose$2(getExactlyOneTensor(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},t=super.getConfig();return Object.assign(e,t),e}}Permute.className="Permute",registerClass(Permute);class Masking extends Layer{constructor(e){super(null==e?{}:e),this.supportsMasking=!0,this.maskValue=null!=e?null==e.maskValue?0:e.maskValue:0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={maskValue:this.maskValue};return Object.assign(t,e),t}computeMask(e,t){const n=getExactlyOneTensor(e);return any$3(notEqual$2(n,this.maskValue),-1)}call(e,t){return tidy((()=>{this.invokeCallHook(e,t);const n=getExactlyOneTensor(e),r=any$3(notEqual$2(n,this.maskValue),-1,!0);return mul(n,cast$3(r,n.dtype))}))}}Masking.className="Masking",registerClass(Masking);
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */
class Embedding extends Layer{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==e.batchInputShape&&null==e.inputShape){let t=null;null!=e.batchSize&&(t=e.batchSize),null==e.inputLength?this.batchInputShape=[t,null]:this.batchInputShape=[t].concat(toList(e.inputLength))}this.inputDim=e.inputDim,assertPositiveInteger(this.inputDim,"inputDim"),this.outputDim=e.outputDim,assertPositiveInteger(this.outputDim,"outputDim"),this.embeddingsInitializer=getInitializer(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=getRegularizer(e.embeddingsRegularizer),this.activityRegularizer=getRegularizer(e.activityRegularizer),this.embeddingsConstraint=getConstraint(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,t){return tidy((()=>this.maskZero?(e=getExactlyOneTensor(e),notEqual$2(e,zerosLike$2(e))):null))}computeOutputShape(e){if(e=getExactlyOneShape(e),null==this.inputLength)return[...e,this.outputDim];const t=toList(this.inputLength);if(t.length!==e.length-1)throw new ValueError(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let n=0;for(let r=0;r<t.length;++r){const a=t[r],i=e[r+1];if(null!=a&&null!=i&&a!==i)throw new ValueError(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);null==a&&(t[n]=i),n++}}return[e[0],...t,this.outputDim]}call(e,t){return tidy((()=>{this.invokeCallHook(e,t);let n=getExactlyOneTensor(e);"int32"!==n.dtype&&(n=cast$2(n,"int32"));const r=gather(this.embeddings.read(),reshape$2(n,[n.size]));return reshape$2(r,getExactlyOneShape(this.computeOutputShape(n.shape)))}))}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:serializeInitializer(this.embeddingsInitializer),embeddingsRegularizer:serializeRegularizer(this.embeddingsRegularizer),activityRegularizer:serializeRegularizer(this.activityRegularizer),embeddingsConstraint:serializeConstraint(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=super.getConfig();return Object.assign(e,t),e}}Embedding.className="Embedding",registerClass(Embedding);
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */
class Merge extends Layer{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new NotImplementedError}computeElementwiseOpOutputShape(e,t){if(null==e||null==t)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(0===t.length)return e;const n=e.slice(0,e.length-t.length);for(let r=0;r<t.length;++r){const a=e[e.length-t.length+r],i=t[r];if(null==a||null==i||a<0||i<0)n.push(null);else if(1===a)n.push(i);else if(1===i)n.push(a);else{if(a!==i)throw new ValueError("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));n.push(a)}}return n}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[getExactlyOneShape(e)]),e.length<2)throw new ValueError(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let t=[];for(const a of e)null!=a&&null!==a[0]&&t.push(a[0]);if(t=unique$2(t),t.length>1)throw new ValueError(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let n=null==e[0]?null:e[0].slice(1);for(let a=1;a<e.length;++a){const t=null==e[a]?null:e[a].slice(1);n=this.computeElementwiseOpOutputShape(n,t)}const r=e.map((e=>e.length));-1===e.indexOf(null)&&1===unique$2(r).length?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,t){return tidy((()=>{if(this.reshapeRequired){const t=[],n=e.map((e=>e.rank));if(-1===n.indexOf(null)){const r=max$2(n);for(let n of e){const e=n.rank;for(let t=0;t<r-e;++t)n=expandDims$2(n,1);t.push(n)}return this.mergeFunction(t)}{let n=!1;for(const i of e){const e=i.rank;if(null==e){const e=i.shape,r=e[0],a=e.slice(1).concat([r]);let s=reshape$2(i,[r].concat(arrayProd(e.slice(1))));s=transpose$2(s,[1,0]),s=reshape$2(s,a),t.push(s),n=!0}else if(e>1){const r=range$3(1,e).concat([0]);t.push(transpose$2(i,r)),n=!0}else t.push(i)}let r=this.mergeFunction(t);const a=r.rank;if(n)if(null==a){const e=r.shape,t=e[e.length-1],n=[t].concat(e.slice(0,e.length-1));r=reshape$2(transpose$2(reshape$2(r,[-1,t]),[1,0]),n)}else if(a>1){const e=[a-1].concat(range$3(0,a-1));r=transpose$2(r,e)}return r}}return this.mergeFunction(e)}))}computeOutputShape(e){let t;t=null==e[0]?null:e[0].slice(1);for(let r=1;r<e.length;++r){const n=null==e[r]?null:e[r].slice(1);t=this.computeElementwiseOpOutputShape(t,n)}let n=[];for(const r of e)null!=r&&null!==r[0]&&n.push(r[0]);return n=unique$2(n),t=1===n.length?n.concat(t):[null].concat(t),t}computeMask(e,t){return tidy((()=>{if(null==t)return null;if(!Array.isArray(t))throw new ValueError("`mask` should be an Array");if(!Array.isArray(e))throw new ValueError("`inputs` should be an Array");if(t.length!==e.length)throw new ValueError(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${t.length})`);if(t.every((e=>null==e)))return null;let n=(t=t.map((e=>null==e?e:expandDims$3(e,0))))[0];for(let e=1;e<t.length-1;++e)n=logicalAnd$2(n,t[e]);return n}))}}class Add extends Merge{constructor(e){super(e)}mergeFunction(e){return tidy((()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=add$1(t,e[n]);return t}))}}Add.className="Add",registerClass(Add);class Multiply extends Merge{constructor(e){super(e)}mergeFunction(e){return tidy((()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=mul(t,e[n]);return t}))}}Multiply.className="Multiply",registerClass(Multiply);class Average extends Merge{constructor(e){super(e)}mergeFunction(e){return tidy((()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=add$1(t,e[n]);return mul(1/e.length,t)}))}}Average.className="Average",registerClass(Average);class Maximum extends Merge{constructor(e){super(e)}mergeFunction(e){return tidy((()=>{let t=e[0];for(let n=1;n<e.length;++n)t=maximum$2(t,e[n]);return t}))}}Maximum.className="Maximum",registerClass(Maximum);class Minimum extends Merge{constructor(e){super(e)}mergeFunction(e){return tidy((()=>{let t=e[0];for(let n=1;n<e.length;++n)t=minimum$2(t,e[n]);return t}))}}Minimum.className="Minimum",registerClass(Minimum);class Concatenate extends Merge{constructor(e){super(e),this.DEFAULT_AXIS=-1,null==e&&(e={}),this.axis=null==e.axis?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!Array.isArray(e)||!Array.isArray(e[0])||1===e.length)throw new ValueError("A `Concatenate` layer should be called on a list of at least 2 inputs");let t=!0;for(const r of e)if(null!=r){t=!1;break}if(t)return;const n=[];for(let r=0;r<e.length;++r){const t=e[r].slice();t.splice(this.axis,1);let a=!1;for(const e of n)if(arraysEqual(e,t)){a=!0;break}a||n.push(t)}if(n.length>1)throw new ValueError("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return tidy((()=>concatenate(e,this.axis)))}computeOutputShape(e){if(!Array.isArray(e)||!Array.isArray(e[0]))throw new ValueError("A `Concatenate` layer should be called on a list of inputs.");const t=e,n=t[0].slice(),r=this.axis<0?n.length+this.axis:this.axis;for(const a of t.slice(1)){if(null==n[r]||null==a[r]){n[r]=null;break}n[r]+=a[r]}return n}computeMask(e,t){if(null==t)return null;if(!Array.isArray(t))throw new ValueError("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new ValueError("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new ValueError(`Mismatch in the length of mask (${t.length}) and the legnth of inputs (${e.length})`);return tidy((()=>{let n=!0;if(t.forEach((e=>{null==e||(n=!1)})),n)return null;const r=[];for(let i=0;i<e.length;++i)null==t[i]?r.push(cast$3(onesLike$2(e[i]),"bool")):t[i].rank<e[i].rank?r.push(expandDims$3(t[i],-1)):r.push(t[i]);const a=concat$2(r,this.axis);return all$2(a,-1,!1)}))}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}function interpretAxis(e,t){for(;e<0;)e+=t;return e}function batchDot(e,t,n){if(e.shape.length>3||t.shape.length>3)throw new NotImplementedError("batchDot is not implemented for tensors of 4D or higher rank yet");if(assert$1(e.shape.length>=2,(()=>`batchDot requires the rank of x to be >= 2, but got ${e.shape.length}`)),assert$1(e.shape.length>=2,(()=>`batchDot requires the rank of y to be >= 2, but got ${t.shape.length}`)),"number"==typeof n&&(n=[n,n]),"complex64"===e.dtype||"complex64"===t.dtype)throw new NotImplementedError("batchDot is not implemented for complex64-type Tensors yet.");const r=e.shape.length,a=t.shape.length;null==n&&(n=[r-1,a-2]);const i=n;return tidy((()=>{let n,s;if(r>a){n=r-a;const e=[];for(let t=0;t<n;++t)e.push(1);t=reshape$2(t,t.shape.concat(e))}else if(a>r){n=a-r;const t=[];for(let e=0;e<n;++e)t.push(1);e=reshape$2(e,e.shape.concat(t))}else n=0;if(2===e.shape.length&&2===t.shape.length)s=i[0]===i[1]?sum$2(mul(e,t),i[0]):sum$2(mul(transpose$2(e,[1,0]),t),i[1]);else{const n=i[0]!==e.shape.length-1,r=i[1]===t.shape.length-1;s=matMul$1(e,t,n,r)}if(n>0){let e;e=r>a?r+a-3:r-1;const t=[];for(let r=e;r<e+n;++r)t.push(r);s=squeeze(s,t)}return 1===s.shape.length&&(s=expandDims$3(s,1)),s}))}Concatenate.className="Concatenate",registerClass(Concatenate);class Dot extends Merge{constructor(e){super(e),this.axes=e.axes,this.normalize=null!=e.normalize&&e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){assert$1(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(()=>"A `Dot` layer should be called on a list of exactly 2 inputs."));const t=e[0],n=e[1];if(t.length>3||n.length>3)throw new NotImplementedError("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,n);if(t[r[0]]!==n[r[1]])throw new ValueError(`Dimension incompatibility: ${t[r[0]]} !== ${n[r[1]]}`)}mergeFunction(e){if(2!==e.length)throw new ValueError(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let t,n=e[0],r=e[1];return t=Array.isArray(this.axes)?this.axes.map(((t,n)=>interpretAxis(t,e[n].shape.length))):[interpretAxis(this.axes,n.shape.length),interpretAxis(this.axes,r.shape.length)],this.normalize&&(n=l2Normalize(n,t[0]),r=l2Normalize(r,t[1])),batchDot(n,r,t)}interpretAxes(e,t){let n;return n=Array.isArray(this.axes)?this.axes:[interpretAxis(this.axes,e.length),interpretAxis(this.axes,t.length)],n}computeOutputShape(e){assert$1(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(()=>"A `Dot` layer should be called on a list of exactly 2 inputs."));const t=e[0].slice(),n=e[1].slice();if(t.length>3||n.length>3)throw new NotImplementedError("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,n);t.splice(r[0],1),n.splice(r[1],1),n.splice(0,1);const a=t.concat(n);return 1===a.length&&a.push(1),a}computeMask(e,t){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},t=super.getConfig();return Object.assign(e,t),e}}Dot.className="Dot",registerClass(Dot);
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */
class GaussianNoise extends Layer{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={stddev:this.stddev};return Object.assign(t,e),t}call(e,t){return tidy((()=>{this.invokeCallHook(e,t);const n=getExactlyOneTensor(e);return inTrainPhase((()=>add$1(randomNormal(n.shape,0,this.stddev),n)),(()=>n),t.training||!1)}))}}GaussianNoise.className="GaussianNoise",registerClass(GaussianNoise);class GaussianDropout extends Layer{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return tidy((()=>{this.invokeCallHook(e,t);const n=getExactlyOneTensor(e);if(this.rate>0&&this.rate<1){return inTrainPhase((()=>{const e=Math.sqrt(this.rate/(1-this.rate));return mul(n,randomNormal(n.shape,1,e))}),(()=>n),t.training||!1)}return n}))}}GaussianDropout.className="GaussianDropout",registerClass(GaussianDropout);class AlphaDropout extends Layer{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||getExactlyOneTensor(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return tidy((()=>{if(this.rate<1&&this.rate>0){const n=this._getNoiseShape(e);return inTrainPhase((()=>{const t=getExactlyOneTensor(e),r=-1.7580993408473766;let a=greaterEqual$2(randomUniform(n),this.rate);a=cast$2(a,"float32");const i=((1-this.rate)*(1+this.rate*r**2))**-.5,s=-i*r*this.rate,o=add$1(mul(t,a),mul(add$1(a,-1),r));return add$1(mul(o,i),s)}),(()=>getExactlyOneTensor(e)),t.training||!1)}return e}))}}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */
function batchNormalization(e,t,n,r,a,i=.001){let s;if(2===e.rank)s=batchNorm2d(e,t,n,r,a,i);else if(3===e.rank)s=batchNorm3d(e,t,n,r,a,i);else{if(4!==e.rank)throw new NotImplementedError(`batchNormalization is not implemented for array of rank ${e.rank} yet`);s=batchNorm4d(e,t,n,r,a,i)}return s}function regularNormalizeBatchInTraining(e,t,n,r,a=.001){return tidy((()=>{const i=moments(e,r),s=i.mean,o=i.variance;return[batchNormalization(e,s,o,n,t,a),s,o]}))}function broadcastNormalizeBatchInTraining(e,t,n,r,a=.001){return tidy((()=>{const i=moments(e,r),s=i.mean,o=i.variance,l=[];for(const t of range$3(0,e.rank))-1!==r.indexOf(t)?l.push(1):l.push(e.shape[t]);const u=reshape$2(s,l),c=reshape$2(o,l),h=null==t?null:reshape$2(t,l),d=null==n?null:reshape$2(n,l);return[batchNormalization(e,u,c,d,h,a),s,o]}))}function normalizeBatchInTraining(e,t,n,r,a=.001){return arraysEqual(r.slice().sort(),range$3(0,e.rank-1))?regularNormalizeBatchInTraining(e,t,n,r,a):broadcastNormalizeBatchInTraining(e,t,n,r,a)}AlphaDropout.className="AlphaDropout",registerClass(AlphaDropout);class BatchNormalization extends Layer{constructor(e){null==e&&(e={}),super(e),this.supportsMasking=!0,this.axis=null==e.axis?-1:e.axis,this.momentum=null==e.momentum?.99:e.momentum,this.epsilon=null==e.epsilon?.001:e.epsilon,this.center=null==e.center||e.center,this.scale=null==e.scale||e.scale,this.betaInitializer=getInitializer(e.betaInitializer||"zeros"),this.gammaInitializer=getInitializer(e.gammaInitializer||"ones"),this.movingMeanInitializer=getInitializer(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=getInitializer(e.movingVarianceInitializer||"ones"),this.betaConstraint=getConstraint(e.betaConstraint),this.gammaConstraint=getConstraint(e.gammaConstraint),this.betaRegularizer=getRegularizer(e.betaRegularizer),this.gammaRegularizer=getRegularizer(e.gammaRegularizer)}build(e){e=getExactlyOneShape(e);const t=this.axis>=0?this.axis:this.axis+e.length,n=e[t];if(null==n)throw new ValueError(`Axis ${t} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new InputSpec({ndim:e.length,axes:{[t]:n}})];const r=[n];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,t){return tidy((()=>{const n=null!=t.training&&t.training,r=getExactlyOneTensor(e),a=r.shape,i=a.length,s=range$3(0,i),o=this.axis>=0?this.axis:this.axis+i;s.splice(o,1);const l=pyListRepeat(1,i);l[o]=a[o];const u=s.slice();u.sort();const c=!arraysEqual(u,range$3(0,i).slice(0,i-1));if(!n)return(()=>{if(c){const e=reshape$2(this.movingMean.read(),l),t=reshape$2(this.movingVariance.read(),l),n=this.center?reshape$2(this.beta.read(),l):null,a=this.scale?reshape$2(this.gamma.read(),l):null;return batchNormalization(r,e,t,n,a,this.epsilon)}return batchNormalization(r,this.movingMean.read(),this.movingVariance.read(),null==this.beta?null:this.beta.read(),null==this.gamma?null:this.gamma.read(),this.epsilon)})();const[h,d,p]=normalizeBatchInTraining(r,this.gamma.read(),this.beta.read(),s,this.epsilon),f=(e,t,n)=>{tidy((()=>{const r=1-n,a=e.read(),i=mul(sub$2(a,t),r);e.write(sub$2(a,i))}))};return(()=>{f(this.movingMean,d,this.momentum),f(this.movingVariance,p,this.momentum)})(),h}))}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:serializeInitializer(this.betaInitializer),gammaInitializer:serializeInitializer(this.gammaInitializer),movingMeanInitializer:serializeInitializer(this.movingMeanInitializer),movingVarianceInitializer:serializeInitializer(this.movingVarianceInitializer),betaRegularizer:serializeRegularizer(this.betaRegularizer),gammaRegularizer:serializeRegularizer(this.gammaRegularizer),betaConstraint:serializeConstraint(this.betaConstraint),gammaConstraint:serializeConstraint(this.gammaConstraint)},t=super.getConfig();return Object.assign(e,t),e}}BatchNormalization.className="BatchNormalization",registerClass(BatchNormalization);class LayerNormalization extends Layer{constructor(e){if(null==e&&(e={}),super(e),this.axis=null==e.axis?-1:e.axis,"number"==typeof this.axis){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else{if(!Array.isArray(this.axis))throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);for(const e of this.axis)if(!Number.isInteger(e))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}this.epsilon=null==e.epsilon?.001:e.epsilon,this.center=null==e.center||e.center,this.scale=null==e.scale||e.scale,this.betaInitializer=getInitializer(e.betaInitializer||"zeros"),this.gammaInitializer=getInitializer(e.gammaInitializer||"ones"),this.betaRegularizer=getRegularizer(e.betaRegularizer),this.gammaRegularizer=getRegularizer(e.gammaRegularizer),this.supportsMasking=!0}build(e){const t=(e=getExactlyOneShape(e)).length;"number"==typeof this.axis&&(this.axis=[this.axis]);for(let r=0;r<this.axis.length;++r)this.axis[r]<0&&(this.axis[r]+=t);for(const r of this.axis)if(r<0||r>=t)throw new Error(`Invalid axis: ${r}`);if(this.axis.length!==unique$2(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const n=this.axis.map((t=>e[t]));this.scale?this.gamma=this.addWeight("gamma",n,"float32",this.gammaInitializer,this.gammaRegularizer,true):this.gamma=null,this.center?this.beta=this.addWeight("beta",n,"float32",this.betaInitializer,this.betaRegularizer,true):this.beta=null,this.built=!0}call(e,t){const n=getExactlyOneTensor(e),r=n.shape,a=r.length;return tidy((()=>{let{mean:e,variance:t}=moments(n,this.axis,!0);const i=pyListRepeat(1,a);for(const n of this.axis)i[n]=r[n];const s=e=>null!=e&&e.shape.length!==a?reshape$2(e,i):e;let o=this.scale?s(this.gamma.read()):null,l=this.center?s(this.beta.read()):null;const u=[],c=[];for(let n=0;n<a;++n)-1!==this.axis.indexOf(n)?(u.push(r[n]),c.push(1)):(u.push(1),c.push(r[n]));return e=tile$3(e,u),t=tile$3(t,u),null!=o&&(o=tile$3(o,c)),null!=l&&(l=tile$3(l,c)),batchNormalization(n,e,t,l,o,this.epsilon)}))}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:serializeInitializer(this.betaInitializer),gammaInitializer:serializeInitializer(this.gammaInitializer),betaRegularizer:serializeRegularizer(this.betaRegularizer),gammaRegularizer:serializeRegularizer(this.gammaRegularizer)},t=super.getConfig();return Object.assign(e,t),e}}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */
function spatial2dPadding(e,t,n){return tidy((()=>{if(4!==e.rank)throw new ValueError(`temporalPadding expects input tensor to be 4-D, but received a ${e.rank}-D tensor.`);if(null==t&&(t=[[1,1],[1,1]]),2!==t.length||2!==t[0].length||2!==t[1].length)throw new ValueError("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==n&&(n=imageDataFormat()),"channelsLast"!==n&&"channelsFirst"!==n)throw new ValueError(`Unknown data format: ${n}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let r;return r="channelsFirst"===n?[[0,0],[0,0],t[0],t[1]]:[[0,0],t[0],t[1],[0,0]],pad(e,r)}))}LayerNormalization.className="LayerNormalization",registerClass(LayerNormalization);class ZeroPadding2D extends Layer{constructor(e){if(null==e&&(e={}),super(e),this.dataFormat=null==e.dataFormat?imageDataFormat():e.dataFormat,null==e.padding)this.padding=[[1,1],[1,1]];else if("number"==typeof e.padding)this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,2!==e.padding.length)throw new ValueError(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let t,n;if("number"==typeof e.padding[0])t=[e.padding[0],e.padding[0]],n=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,2!==e.padding[0].length)throw new ValueError(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(t=e.padding[0],2!==e.padding[1].length)throw new ValueError(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);n=e.padding[1]}this.padding=[t,n]}this.inputSpec=[new InputSpec({ndim:4})]}computeOutputShape(e){let t,n;return e=getExactlyOneShape(e),"channelsFirst"===this.dataFormat?(t=null!=e[2]&&e[2]>=0?e[2]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[3]&&e[3]>=0?e[3]+this.padding[1][0]+this.padding[1][1]:null,[e[0],e[1],t,n]):(t=null!=e[1]&&e[1]>=0?e[1]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[2]&&e[2]>=0?e[2]+this.padding[1][0]+this.padding[1][1]:null,[e[0],t,n,e[3]])}call(e,t){return tidy((()=>spatial2dPadding(getExactlyOneTensor(e),this.padding,this.dataFormat)))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */
function pool2d(e,t,n,r,a,i){return tidy((()=>{let s;checkDataFormat(a),checkPoolMode(i),checkPaddingMode(r),null==n&&(n=[1,1]),null==r&&(r="valid"),null==a&&(a=imageDataFormat()),null==i&&(i="max"),e=preprocessConv2DInput(e,a);const o="same"===r?"same":"valid";return s="max"===i?maxPool$2(e,t,n,o):avgPool$2(e,t,n,o),"channelsFirst"===a&&(s=transpose$2(s,[0,3,1,2])),s}))}function pool3d$1(e,t,n,r,a,i){return tidy((()=>{let s;checkDataFormat(a),checkPoolMode(i),checkPaddingMode(r),null==n&&(n=[1,1,1]),null==r&&(r="valid"),null==a&&(a=imageDataFormat()),null==i&&(i="max"),e=preprocessConv3DInput(e,a);const o="same"===r?"same":"valid";return s="max"===i?maxPool3d$1(e,t,n,o):avgPool3d(e,t,n,o),"channelsFirst"===a&&(s=transpose$2(s,[0,4,1,2,3])),s}))}ZeroPadding2D.className="ZeroPadding2D",registerClass(ZeroPadding2D);class Pooling1D extends Layer{constructor(e){if(null==e.poolSize&&(e.poolSize=2),super(e),"number"==typeof e.poolSize)this.poolSize=[e.poolSize];else{if(!Array.isArray(e.poolSize)||1!==e.poolSize.length||"number"!=typeof e.poolSize[0])throw new ValueError(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);this.poolSize=e.poolSize}if(assertPositiveInteger(this.poolSize,"poolSize"),null==e.strides)this.strides=this.poolSize;else if("number"==typeof e.strides)this.strides=[e.strides];else{if(!Array.isArray(e.strides)||1!==e.strides.length||"number"!=typeof e.strides[0])throw new ValueError(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);this.strides=e.strides}assertPositiveInteger(this.strides,"strides"),this.padding=null==e.padding?"valid":e.padding,checkPaddingMode(this.padding),this.inputSpec=[new InputSpec({ndim:3})]}computeOutputShape(e){const t=convOutputLength((e=getExactlyOneShape(e))[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}call(e,t){return tidy((()=>{this.invokeCallHook(e,t),e=expandDims$2(getExactlyOneTensor(e),2);const n=this.poolingFunction(getExactlyOneTensor(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return squeeze(n,[2])}))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=super.getConfig();return Object.assign(e,t),e}}class MaxPooling1D extends Pooling1D{constructor(e){super(e)}poolingFunction(e,t,n,r,a){return checkDataFormat(a),checkPaddingMode(r),pool2d(e,t,n,r,a,"max")}}MaxPooling1D.className="MaxPooling1D",registerClass(MaxPooling1D);class AveragePooling1D extends Pooling1D{constructor(e){super(e)}poolingFunction(e,t,n,r,a){return checkDataFormat(a),checkPaddingMode(r),pool2d(e,t,n,r,a,"avg")}}AveragePooling1D.className="AveragePooling1D",registerClass(AveragePooling1D);class Pooling2D extends Layer{constructor(e){if(null==e.poolSize&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],null==e.strides)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(2!==e.strides.length)throw new ValueError(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];assertPositiveInteger(this.poolSize,"poolSize"),assertPositiveInteger(this.strides,"strides"),this.padding=null==e.padding?"valid":e.padding,this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,checkDataFormat(this.dataFormat),checkPaddingMode(this.padding),this.inputSpec=[new InputSpec({ndim:4})]}computeOutputShape(e){e=getExactlyOneShape(e);let t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2];return t=convOutputLength(t,this.poolSize[0],this.padding,this.strides[0]),n=convOutputLength(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n]:[e[0],t,n,e[3]]}call(e,t){return tidy((()=>(this.invokeCallHook(e,t),this.poolingFunction(getExactlyOneTensor(e),this.poolSize,this.strides,this.padding,this.dataFormat))))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class MaxPooling2D extends Pooling2D{constructor(e){super(e)}poolingFunction(e,t,n,r,a){return checkDataFormat(a),checkPaddingMode(r),pool2d(e,t,n,r,a,"max")}}MaxPooling2D.className="MaxPooling2D",registerClass(MaxPooling2D);class AveragePooling2D extends Pooling2D{constructor(e){super(e)}poolingFunction(e,t,n,r,a){return checkDataFormat(a),checkPaddingMode(r),pool2d(e,t,n,r,a,"avg")}}AveragePooling2D.className="AveragePooling2D",registerClass(AveragePooling2D);class Pooling3D extends Layer{constructor(e){if(null==e.poolSize&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],null==e.strides)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(3!==e.strides.length)throw new ValueError(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];assertPositiveInteger(this.poolSize,"poolSize"),assertPositiveInteger(this.strides,"strides"),this.padding=null==e.padding?"valid":e.padding,this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,checkDataFormat(this.dataFormat),checkPaddingMode(this.padding),this.inputSpec=[new InputSpec({ndim:5})]}computeOutputShape(e){e=getExactlyOneShape(e);let t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[4]:e[3];return t=convOutputLength(t,this.poolSize[0],this.padding,this.strides[0]),n=convOutputLength(n,this.poolSize[1],this.padding,this.strides[1]),r=convOutputLength(r,this.poolSize[2],this.padding,this.strides[2]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n,r]:[e[0],t,n,r,e[4]]}call(e,t){return tidy((()=>(this.invokeCallHook(e,t),this.poolingFunction(getExactlyOneTensor(e),this.poolSize,this.strides,this.padding,this.dataFormat))))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class MaxPooling3D extends Pooling3D{constructor(e){super(e)}poolingFunction(e,t,n,r,a){return checkDataFormat(a),checkPaddingMode(r),pool3d$1(e,t,n,r,a,"max")}}MaxPooling3D.className="MaxPooling3D",registerClass(MaxPooling3D);class AveragePooling3D extends Pooling3D{constructor(e){super(e)}poolingFunction(e,t,n,r,a){return checkDataFormat(a),checkPaddingMode(r),pool3d$1(e,t,n,r,a,"avg")}}AveragePooling3D.className="AveragePooling3D",registerClass(AveragePooling3D);class GlobalPooling1D extends Layer{constructor(e){super(e),this.inputSpec=[new InputSpec({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,t){throw new NotImplementedError}}class GlobalAveragePooling1D extends GlobalPooling1D{constructor(e){super(e||{})}call(e,t){return tidy((()=>{const t=getExactlyOneTensor(e);return mean$1(t,1)}))}}GlobalAveragePooling1D.className="GlobalAveragePooling1D",registerClass(GlobalAveragePooling1D);class GlobalMaxPooling1D extends GlobalPooling1D{constructor(e){super(e||{})}call(e,t){return tidy((()=>{const t=getExactlyOneTensor(e);return max$3(t,1)}))}}GlobalMaxPooling1D.className="GlobalMaxPooling1D",registerClass(GlobalMaxPooling1D);class GlobalPooling2D extends Layer{constructor(e){super(e),this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,checkDataFormat(this.dataFormat),this.inputSpec=[new InputSpec({ndim:4})]}computeOutputShape(e){return"channelsLast"===this.dataFormat?[e[0],e[3]]:[e[0],e[1]]}call(e,t){throw new NotImplementedError}getConfig(){const e={dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class GlobalAveragePooling2D extends GlobalPooling2D{call(e,t){return tidy((()=>{const t=getExactlyOneTensor(e);return"channelsLast"===this.dataFormat?mean$1(t,[1,2]):mean$1(t,[2,3])}))}}GlobalAveragePooling2D.className="GlobalAveragePooling2D",registerClass(GlobalAveragePooling2D);class GlobalMaxPooling2D extends GlobalPooling2D{call(e,t){return tidy((()=>{const t=getExactlyOneTensor(e);return"channelsLast"===this.dataFormat?max$3(t,[1,2]):max$3(t,[2,3])}))}}GlobalMaxPooling2D.className="GlobalMaxPooling2D",registerClass(GlobalMaxPooling2D);
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */
class Wrapper extends Layer{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return null!=this.layer&&this.layer.trainable}set trainable(e){null!=this.layer&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=super.getConfig();return Object.assign(e,t),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),null!=this.layer&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,t,n={}){const r=deserialize(t.layer,n);delete t.layer;const a={layer:r};return Object.assign(a,t),new e(a)}}class TimeDistributed extends Wrapper{constructor(e){super(e),this.supportsMasking=!0}build(e){if((e=getExactlyOneShape(e)).length<3)throw new ValueError(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];const t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),super.build(e)}computeOutputShape(e){const t=[(e=getExactlyOneShape(e))[0]].concat(e.slice(2)),n=this.layer.computeOutputShape(t),r=e[1];return[n[0],r].concat(n.slice(1))}call(e,t){return tidy((()=>rnn(((e,n)=>[getExactlyOneTensor(this.layer.call(e,t)),[]]),e=getExactlyOneTensor(e),[],!1,null,null,!1,!0)[1]))}}function checkBidirectionalMergeMode(e){checkStringTypeUnionValue(VALID_BIDIRECTIONAL_MERGE_MODES,"BidirectionalMergeMode",e)}TimeDistributed.className="TimeDistributed",registerClass(TimeDistributed);const DEFAULT_BIDIRECTIONAL_MERGE_MODE="concat";class Bidirectional extends Wrapper{constructor(e){super(e);const t=e.layer.getConfig(),n={};n.className=e.layer.getClassName(),n.config=t,this.forwardLayer=deserialize(n),t.goBackwards=!0!==t.goBackwards;const r={};if(r.className=e.layer.getClassName(),r.config=t,this.backwardLayer=deserialize(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=void 0===e.mergeMode?DEFAULT_BIDIRECTIONAL_MERGE_MODE:e.mergeMode,checkBidirectionalMergeMode(this.mergeMode),e.weights)throw new NotImplementedError("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,null!=this.forwardLayer&&(this.forwardLayer.trainable=e),null!=this.backwardLayer&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const t=e.length,n=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,n)),this.backwardLayer.setWeights(e.slice(n))}computeOutputShape(e){let t,n,r,a=this.forwardLayer.computeOutputShape(e);return Array.isArray(a)&&Array.isArray(a[0])||(a=[a]),this.returnState?(r=a.slice(1),t=a[0]):t=a[0],"concat"===this.mergeMode?(t[t.length-1]*=2,n=[t]):n=null==this.mergeMode?[t,t.slice()]:[t],this.returnState?null==this.mergeMode?n.concat(r).concat(r.slice()):[t].concat(r).concat(r.slice()):singletonOrArray(n)}apply(e,t){let n=null==t?null:t.initialState,r=null==t?null:t.constants;null==t&&(t={});const a=standardizeArgs(e,n,r,this.numConstants);if(e=a.inputs,n=a.initialState,r=a.constants,Array.isArray(e)&&(n=e.slice(1),e=e[0]),(null==n||0===n.length)&&null==r)return super.apply(e,t);const i=[],s=[];if(null!=n){const e=n.length;if(e%2>0)throw new ValueError("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=n,i.push(...n);const r=n.map((e=>new InputSpec({shape:e.shape})));this.forwardLayer.stateSpec=r.slice(0,e/2),this.backwardLayer.stateSpec=r.slice(e/2),s.push(...r)}if(null!=r)throw new NotImplementedError("Support for constants in Bidirectional layers is not implemented yet.");const o=i[0]instanceof SymbolicTensor;for(const l of i)if(l instanceof SymbolicTensor!==o)throw new ValueError("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(o){const n=[e].concat(i),r=this.inputSpec.concat(s),a=this.inputSpec;this.inputSpec=r;const o=super.apply(n,t);return this.inputSpec=a,o}return super.apply(e,t)}call(e,t){return tidy((()=>{const n=t.initialState;let r,a,i,s;if(null==n)r=this.forwardLayer.call(e,t),a=this.backwardLayer.call(e,t);else{const i=n.slice(0,n.length/2),s=n.slice(n.length/2);r=this.forwardLayer.call(e,Object.assign(t,{initialState:i})),a=this.backwardLayer.call(e,Object.assign(t,{initialState:s}))}return this.returnState&&(Array.isArray(r)&&(i=r.slice(1).concat(a.slice(1))),r=r[0],a=a[0]),this.returnSequences&&(a=reverse$2(a,1)),"concat"===this.mergeMode?s=concatenate([r,a]):"sum"===this.mergeMode?s=add$1(r,a):"ave"===this.mergeMode?s=mul(.5,add$1(r,a)):"mul"===this.mergeMode?s=mul(r,a):null==this.mergeMode&&(s=[r,a]),this.returnState?null==this.mergeMode?s.concat(i):[s].concat(i):s}))}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){nameScope(this.forwardLayer.name,(()=>{this.forwardLayer.build(e)})),nameScope(this.backwardLayer.name,(()=>{this.backwardLayer.build(e)})),this.built=!0}computeMask(e,t){let n;if(Array.isArray(t)&&(t=t[0]),n=this.returnSequences?null==this.mergeMode?[t,t]:t:null==this.mergeMode?[null,null]:null,this.returnState){const e=this.forwardLayer.states.map((e=>null));return Array.isArray(n)?n.concat(e).concat(e):[n].concat(e).concat(e)}return n}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),null!=this.forwardLayer&&this.forwardLayer.setFastWeightInitDuringBuild(e),null!=this.backwardLayer&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},t=super.getConfig();return Object.assign(e,t),e}static fromConfig(e,t){const n=deserialize(t.layer);if(delete t.layer,null!=t.numConstants)throw new NotImplementedError("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const r=t;return r.layer=n,new e(r)}}Bidirectional.className="Bidirectional",registerClass(Bidirectional);
/**
     * @license
     * Copyright 2022 CodeSmith LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */
class Rescaling extends Layer{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return tidy((()=>("float32"!==(e=getExactlyOneTensor(e)).dtype&&(e=cast$2(e,"float32")),add$1(mul(e,this.scale),this.offset))))}}Rescaling.className="Rescaling",registerClass(Rescaling);
/**
     * @license
     * Copyright 2022 CodeSmith LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */
const{resizeBilinear:resizeBilinear$2,cropAndResize:cropAndResize$2}=image$1;class CenterCrop extends Layer{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,t,n,r,a,i,s,o){return tidy((()=>{let l,u=!1;const c=[t/i,n/s,(r+t)/i,(a+n)/s],h=[];3===e.rank?(u=!0,l=stack([e])):l=e;for(let e=0;e<l.shape[0];e++)h.push(c);const d=tensor(h,[h.length,4]),p=range$4(0,h.length,1,"int32"),f=cropAndResize$2(l,d,p,[r,a],"nearest");return cast$2(u?getExactlyOneTensor(unstack(f)):f,o)}))}upsize(e,t,n,r){return tidy((()=>cast$2(resizeBilinear$2(e,[t,n]),r)))}call(e,t){return tidy((()=>{const t=getExactlyOneTensor(e),n=t.dtype,r=t.shape,a=r[r.length-3],i=r[r.length-2];let s=0;a!==this.height&&(s=Math.floor((a-this.height)/2));let o=0;return i!==this.width&&(o=Math.floor((i-this.width)/2),0===o&&(o=1)),s>=0&&o>=0?this.centerCrop(t,s,o,this.height,this.width,a,i,n):this.upsize(e,this.height,this.width,n)}))}getConfig(){const e={height:this.height,width:this.width},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){const t=(e=getExactlyOneShape(e)).length-3,n=e.length-2;return e[t]=this.height,e[n]=this.width,e}}
/**
     * @license
     * Copyright 2022 CodeSmith LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */
function encodeCategoricalInputs(e,t,n,r){let a=getExactlyOneTensor(e);if("int32"!==a.dtype&&(a=cast$2(a,"int32")),"int"===t)return a;const i=a.shape;if(0===a.rank&&(a=expandDims$3(a,-1)),"oneHot"===t&&1!==a.shape[a.shape.length-1]&&(a=expandDims$3(a,-1)),a.rank>2)throw new ValueError(`When outputMode is not int, maximum output rank is 2 Received outputMode ${t} and input shape ${i} which would result in output rank ${a.rank}.`);const s=["multiHot","oneHot"].includes(t),o=a;let l;if(l=denseBincount$2(o,void 0!==r&&"count"===t?r:[],n,s),"tfIdf"!==t)return l;if(r)return mul(l,r);throw new ValueError("When outputMode is 'tfIdf', weights must be provided.")}
/**
     * @license
     * Copyright 2022 CodeSmith LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */CenterCrop.className="CenterCrop",registerClass(CenterCrop);class CategoryEncoding extends Layer{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){const e={numTokens:this.numTokens,outputMode:this.outputMode},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){return null==(e=getExactlyOneShape(e))?[this.numTokens]:"oneHot"===this.outputMode&&1!==e[e.length-1]?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,t){return tidy((()=>{let n;if("int32"!==(e=getExactlyOneTensor(e)).dtype&&(e=cast$2(e,"int32")),void 0!==t.countWeights){if("count"!==this.outputMode)throw new ValueError(`countWeights is not used when outputMode !== count.\n              Received countWeights=${t.countWeights}`);n=getExactlyOneTensor(t.countWeights)}const r=max$3(e),a=min$3(e),i=greater$2(this.numTokens,r).bufferSync().get(0),s=greaterEqual$2(a,0).bufferSync().get(0);if(!i||!s)throw new ValueError(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return encodeCategoricalInputs(e,this.outputMode,this.numTokens,n)}))}}CategoryEncoding.className="CategoryEncoding",registerClass(CategoryEncoding);
/**
     * @license
     * Copyright 2022 CodeSmith LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */
const INTERPOLATION_KEYS$1=["bilinear","nearest"],INTERPOLATION_METHODS$1=new Set(INTERPOLATION_KEYS$1);class Resizing extends Layer{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation){if(!INTERPOLATION_METHODS$1.has(e.interpolation))throw new ValueError(`Invalid interpolation parameter: ${e.interpolation} is not implemented`);this.interpolation=e.interpolation}else this.interpolation="bilinear";this.cropToAspectRatio=Boolean(e.cropToAspectRatio)}computeOutputShape(e){const t=(e=getExactlyOneShape(e))[2];return[this.height,this.width,t]}getConfig(){const e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return tidy((()=>{const t=[this.height,this.width];if("bilinear"===this.interpolation)return image$1.resizeBilinear(e,t,!this.cropToAspectRatio);if("nearest"===this.interpolation)return image$1.resizeNearestNeighbor(e,t,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...INTERPOLATION_METHODS$1]} are supported`)}))}}Resizing.className="Resizing",registerClass(Resizing);
/**
     * @license
     * Copyright 2023 CodeSmith LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */
class RandomSeed{constructor(e){this.seed=e}next(){if(void 0!==this.seed)return this.seed++}}RandomSeed.className="RandomSeed";
/**
     * @license
     * Copyright 2023 CodeSmith LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */
class BaseRandomLayer extends Layer{constructor(e){super(e),this.randomGenerator=new RandomSeed(e.seed)}getConfig(){const e={seed:this.randomGenerator.seed},t=super.getConfig();return Object.assign(e,t),e}}BaseRandomLayer.className="BaseRandomLayer";
/**
     * @license
     * Copyright 2023 CodeSmith LLC
     *
     * Use of this source code is governed by an MIT-style
     * license that can be found in the LICENSE file or at
     * https://opensource.org/licenses/MIT.
     * =============================================================================
     */
const INTERPOLATION_KEYS=["bilinear","nearest"],INTERPOLATION_METHODS=new Set(INTERPOLATION_KEYS);class RandomWidth extends BaseRandomLayer{constructor(e){super(e);const{factor:t,interpolation:n="bilinear"}=e;if(this.factor=t,Array.isArray(this.factor)&&2===this.factor.length)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else{if(Array.isArray(this.factor)||!(this.factor>0))throw new ValueError(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);this.widthLower=-this.factor,this.widthUpper=this.factor}if(this.widthLower<-1||this.widthUpper<-1)throw new ValueError(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new ValueError(`factor cannot have upper bound less than lower bound.\n        Got upper bound: ${this.widthUpper}.\n        Got lower bound: ${this.widthLower}\n      `);if(n){if(!INTERPOLATION_METHODS.has(n))throw new ValueError(`Invalid interpolation parameter: ${n} is not implemented`);this.interpolation=n}}getConfig(){const e={factor:this.factor,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){const t=(e=getExactlyOneShape(e))[2];return[this.imgHeight,-1,t]}call(e,t){return tidy((()=>{const t=getExactlyOneTensor(e);this.imgHeight=t.shape[t.shape.length-3];const n=t.shape[t.shape.length-2];this.widthFactor=randomUniform([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let r=this.widthFactor.dataSync()[0]*n;r=Math.round(r);const a=[this.imgHeight,r];switch(this.interpolation){case"bilinear":return image$1.resizeBilinear(e,a);case"nearest":return image$1.resizeNearestNeighbor(e,a);default:throw new Error(`Interpolation is ${this.interpolation}\n          but only ${[...INTERPOLATION_METHODS]} are supported`)}}))}}RandomWidth.className="RandomWidth",registerClass(RandomWidth);
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
const ENV$1=env();
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     *
     * =============================================================================
     */
var DataType,DataType2,SaverDef,SaverDef2,CheckpointFormatVersion;ENV$1.registerFlag("KEEP_INTERMEDIATE_TENSORS",(()=>!1),(e=>{e&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")})),DataType2=DataType||(DataType={}),DataType2[DataType2.DT_INVALID=0]="DT_INVALID",DataType2[DataType2.DT_FLOAT=1]="DT_FLOAT",DataType2[DataType2.DT_DOUBLE=2]="DT_DOUBLE",DataType2[DataType2.DT_INT32=3]="DT_INT32",DataType2[DataType2.DT_UINT8=4]="DT_UINT8",DataType2[DataType2.DT_INT16=5]="DT_INT16",DataType2[DataType2.DT_INT8=6]="DT_INT8",DataType2[DataType2.DT_STRING=7]="DT_STRING",DataType2[DataType2.DT_COMPLEX64=8]="DT_COMPLEX64",DataType2[DataType2.DT_INT64=9]="DT_INT64",DataType2[DataType2.DT_BOOL=10]="DT_BOOL",DataType2[DataType2.DT_QINT8=11]="DT_QINT8",DataType2[DataType2.DT_QUINT8=12]="DT_QUINT8",DataType2[DataType2.DT_QINT32=13]="DT_QINT32",DataType2[DataType2.DT_BFLOAT16=14]="DT_BFLOAT16",DataType2[DataType2.DT_QINT16=15]="DT_QINT16",DataType2[DataType2.DT_QUINT16=16]="DT_QUINT16",DataType2[DataType2.DT_UINT16=17]="DT_UINT16",DataType2[DataType2.DT_COMPLEX128=18]="DT_COMPLEX128",DataType2[DataType2.DT_HALF=19]="DT_HALF",DataType2[DataType2.DT_RESOURCE=20]="DT_RESOURCE",DataType2[DataType2.DT_VARIANT=21]="DT_VARIANT",DataType2[DataType2.DT_UINT32=22]="DT_UINT32",DataType2[DataType2.DT_UINT64=23]="DT_UINT64",DataType2[DataType2.DT_FLOAT_REF=101]="DT_FLOAT_REF",DataType2[DataType2.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",DataType2[DataType2.DT_INT32_REF=103]="DT_INT32_REF",DataType2[DataType2.DT_UINT8_REF=104]="DT_UINT8_REF",DataType2[DataType2.DT_INT16_REF=105]="DT_INT16_REF",DataType2[DataType2.DT_INT8_REF=106]="DT_INT8_REF",DataType2[DataType2.DT_STRING_REF=107]="DT_STRING_REF",DataType2[DataType2.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",DataType2[DataType2.DT_INT64_REF=109]="DT_INT64_REF",DataType2[DataType2.DT_BOOL_REF=110]="DT_BOOL_REF",DataType2[DataType2.DT_QINT8_REF=111]="DT_QINT8_REF",DataType2[DataType2.DT_QUINT8_REF=112]="DT_QUINT8_REF",DataType2[DataType2.DT_QINT32_REF=113]="DT_QINT32_REF",DataType2[DataType2.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",DataType2[DataType2.DT_QINT16_REF=115]="DT_QINT16_REF",DataType2[DataType2.DT_QUINT16_REF=116]="DT_QUINT16_REF",DataType2[DataType2.DT_UINT16_REF=117]="DT_UINT16_REF",DataType2[DataType2.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",DataType2[DataType2.DT_HALF_REF=119]="DT_HALF_REF",DataType2[DataType2.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",DataType2[DataType2.DT_VARIANT_REF=121]="DT_VARIANT_REF",DataType2[DataType2.DT_UINT32_REF=122]="DT_UINT32_REF",DataType2[DataType2.DT_UINT64_REF=123]="DT_UINT64_REF",SaverDef2=SaverDef||(SaverDef={}),(CheckpointFormatVersion=SaverDef2.CheckpointFormatVersion||(SaverDef2.CheckpointFormatVersion={}))[CheckpointFormatVersion.LEGACY=0]="LEGACY",CheckpointFormatVersion[CheckpointFormatVersion.V1=1]="V1",CheckpointFormatVersion[CheckpointFormatVersion.V2=2]="V2";
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
const CUSTOM_OPS={};function getRegisteredOp(e){return CUSTOM_OPS[e]}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function getParamValue(e,t,n,r,a){const i=t.inputParams[e];if(i&&void 0!==i.inputIndexStart){const e=i.inputIndexStart,s=0===i.inputIndexEnd?void 0:void 0===i.inputIndexEnd?e+1:i.inputIndexEnd,o=e<0?t.inputNames.length+e:e;if("tensor"===i.type)return getTensor(t.inputNames[o],n,r,a);if("tensors"===i.type){const i=t.inputs.slice(e,s);return t.inputNames.slice(e,s).filter(((e,t)=>{var n;return"NoOp"!==(null===(n=i[t])||void 0===n?void 0:n.op)})).map((e=>getTensor(e,n,r,a)))}const l=getTensor(t.inputNames[o],n,r,a),u=l.dataSync();return"number"===i.type?u[0]:toNestedArray(l.shape,u)}const s=t.attrParams[e];return s&&s.value}function getTensor(e,t,n,r){const[a,i]=parseNodeName(e,n);if(null!=r){const e=r.getHashTableHandleByName(a);if(null!=e)return e}const s=n.currentContextIds.find((e=>!!t[getNodeNameWithContextId(a,e)]));return void 0!==s?t[getNodeNameWithContextId(a,s)][i]:void 0}function getTensorsForCurrentContext(e,t,n){return t[getNodeNameWithContextId(e,n.currentContextId)]}function getNodeNameAndIndex(e,t){const[n,r,a]=parseNodeName(e,t);return[getNodeNameWithContextId(n,t&&t.currentContextId),r,a]}function getNodeNameWithContextId(e,t){return t?`${e}-${t}`:e}function parseNodeName(e,t){if(""===e)return["",0,void 0];const n=null!=t&&null!=t.parseNodeNameCache;if(n){const n=t.parseNodeNameCache.get(e);if(null!=n)return n}const r=e.split(":");let a;if(1===r.length)a=[e,0,void 0];else{const e=r[0],t=3===r.length?r[1]:void 0;a=[e,Number(r[r.length-1]),t]}return n&&t.parseNodeNameCache.set(e,a),a}function getPadding(e,t,n){let r=getParamValue("pad",e,t,n);if("explicit"===r){r=getParamValue("explicitPaddings",e,t,n);const a=[[0,0],[0,0],[0,0],[0,0]];for(let e=0;e<4;e++)a[e][0]=r[2*e],a[e][1]=r[2*e+1];return a}return r}function cloneTensor(e){return e.kept?e:clone(e)}
/**
     * @license
     * Copyright 2023 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const json$i=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],arithmetic=Object.freeze(Object.defineProperty({__proto__:null,json:json$i},Symbol.toStringTag,{value:"Module"})),json$h=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsFinite",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsInf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],basicMath=Object.freeze(Object.defineProperty({__proto__:null,json:json$h},Symbol.toStringTag,{value:"Module"})),json$g=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}],control=Object.freeze(Object.defineProperty({__proto__:null,json:json$g},Symbol.toStringTag,{value:"Module"})),json$f=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],convolution=Object.freeze(Object.defineProperty({__proto__:null,json:json$f},Symbol.toStringTag,{value:"Module"})),json$e=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniformInt",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number"},{tfName:"maxval",name:"maxval",type:"number"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],creation=Object.freeze(Object.defineProperty({__proto__:null,json:json$e},Symbol.toStringTag,{value:"Module"})),json$d=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],dynamic=Object.freeze(Object.defineProperty({__proto__:null,json:json$d},Symbol.toStringTag,{value:"Module"})),json$c=[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],evaluation=Object.freeze(Object.defineProperty({__proto__:null,json:json$c},Symbol.toStringTag,{value:"Module"})),json$b=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],graph=Object.freeze(Object.defineProperty({__proto__:null,json:json$b},Symbol.toStringTag,{value:"Module"})),json$a=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"InitializeTable",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]},{tfOpName:"InitializeTableV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],hashTable=Object.freeze(Object.defineProperty({__proto__:null,json:json$a},Symbol.toStringTag,{value:"Module"})),json$9=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}],image=Object.freeze(Object.defineProperty({__proto__:null,json:json$9},Symbol.toStringTag,{value:"Module"})),json$8=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BitwiseAnd",category:"logical",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}]}],logical=Object.freeze(Object.defineProperty({__proto__:null,json:json$8},Symbol.toStringTag,{value:"Module"})),json$7=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"MatrixBandPart",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"numLower",type:"tensor"},{start:1,name:"numUpper",type:"tensor"}]}],matrices=Object.freeze(Object.defineProperty({__proto__:null,json:json$7},Symbol.toStringTag,{value:"Module"})),json$6=[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]}],normalization=Object.freeze(Object.defineProperty({__proto__:null,json:json$6},Symbol.toStringTag,{value:"Module"})),json$5=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],reduction=Object.freeze(Object.defineProperty({__proto__:null,json:json$5},Symbol.toStringTag,{value:"Module"})),json$4=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]},{tfOpName:"TensorScatterUpdate",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],sliceJoin=Object.freeze(Object.defineProperty({__proto__:null,json:json$4},Symbol.toStringTag,{value:"Module"})),json$3=[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}],sparse=Object.freeze(Object.defineProperty({__proto__:null,json:json$3},Symbol.toStringTag,{value:"Module"})),json$2=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],spectral=Object.freeze(Object.defineProperty({__proto__:null,json:json$2},Symbol.toStringTag,{value:"Module"})),json$1=[{tfOpName:"StaticRegexReplace",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"pattern",name:"pattern",type:"string"},{tfName:"rewrite",name:"rewrite",type:"string"},{tfName:"replace_global",name:"replaceGlobal",type:"bool"}]},{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}],string=Object.freeze(Object.defineProperty({__proto__:null,json:json$1},Symbol.toStringTag,{value:"Module"})),json=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"EnsureShape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}],transformation=Object.freeze(Object.defineProperty({__proto__:null,json:json},Symbol.toStringTag,{value:"Module"}));
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
class OperationMapper{static get Instance(){return this._instance||(this._instance=new this)}constructor(){const e=[].concat(...[arithmetic,basicMath,control,convolution,creation,dynamic,evaluation,graph,hashTable,image,logical,matrices,normalization,reduction,sliceJoin,sparse,spectral,string,transformation].map((e=>e.json)));this.opMappers=e.reduce(((e,t)=>(e[t.tfOpName]=t,e)),{})}transformGraph(e,t={}){const n=e.node,r=[],a=[],i=[],s=n.reduce(((e,t)=>(e[t.name]=this.mapNode(t),t.op.startsWith("Placeholder")?r.push(e[t.name]):"Const"===t.op?a.push(e[t.name]):null!=t.input&&0!==t.input.length||i.push(e[t.name]),e)),{});let o=[];const l=[];let u={},c={};null!=t&&(u=this.mapSignatureEntries(t.inputs),c=this.mapSignatureEntries(t.outputs));const h=Object.keys(s);h.forEach((e=>{const t=s[e];t.inputNames.forEach(((e,n)=>{const[r,,a]=getNodeNameAndIndex(e),i=s[r];if(null!=i.outputs){const e=i.outputs.indexOf(a);if(-1!==e){const a=`${r}:${e}`;t.inputNames[n]=a}}t.inputs.push(i),i.children.push(t)}))})),0===Object.keys(c).length?h.forEach((e=>{const t=s[e];0===t.children.length&&l.push(t)})):Object.keys(c).forEach((e=>{const[t]=getNodeNameAndIndex(e),n=s[t];null!=n&&(n.signatureKey=c[e],l.push(n))})),Object.keys(u).length>0?Object.keys(u).forEach((e=>{const[t]=getNodeNameAndIndex(e),n=s[t];n&&(n.signatureKey=u[e],o.push(n))})):o=r;let d={};null!=e.library&&null!=e.library.function&&(d=e.library.function.reduce(((e,t)=>(e[t.signature.name]=this.mapFunction(t),e)),{}));const p={nodes:s,inputs:o,outputs:l,weights:a,placeholders:r,signature:t,functions:d};return i.length>0&&(p.initNodes=i),p}mapSignatureEntries(e){return Object.keys(e||{}).reduce(((t,n)=>(t[e[n].name]=n,t)),{})}mapNode(e){const t=getRegisteredOp(e.op)||this.opMappers[e.op]||{};null==e.attr&&(e.attr={});const n={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map((e=>e.startsWith("^")?e.slice(1):e)),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr,outputs:t.outputs};return null!=t.inputs&&(n.inputParams=t.inputs.reduce(((e,t)=>(e[t.name]={type:t.type,inputIndexStart:t.start,inputIndexEnd:t.end},e)),{})),null!=t.attrs&&(n.attrParams=t.attrs.reduce(((t,n)=>{const r=n.type;let a;switch(n.type){case"string":a=getStringParam(e.attr,n.tfName,n.defaultValue),void 0===a&&n.tfDeprecatedName&&(a=getStringParam(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"string[]":a=getStringArrayParam(e.attr,n.tfName,n.defaultValue),void 0===a&&n.tfDeprecatedName&&(a=getStringArrayParam(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number":a=getNumberParam(e.attr,n.tfName,n.defaultValue||0),void 0===a&&n.tfDeprecatedName&&(a=getNumberParam(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number[]":a=getNumericArrayParam(e.attr,n.tfName,n.defaultValue),void 0===a&&n.tfDeprecatedName&&(a=getNumericArrayParam(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool":a=getBoolParam(e.attr,n.tfName,n.defaultValue),void 0===a&&n.tfDeprecatedName&&(a=getBoolParam(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool[]":a=getBoolArrayParam(e.attr,n.tfName,n.defaultValue),void 0===a&&n.tfDeprecatedName&&(a=getBoolArrayParam(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape":a=getTensorShapeParam(e.attr,n.tfName,n.defaultValue),void 0===a&&n.tfDeprecatedName&&(a=getTensorShapeParam(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape[]":a=getTensorShapeArrayParam(e.attr,n.tfName,n.defaultValue),void 0===a&&n.tfDeprecatedName&&(a=getTensorShapeArrayParam(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype":a=getDtypeParam(e.attr,n.tfName,n.defaultValue),void 0===a&&n.tfDeprecatedName&&(a=getDtypeParam(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype[]":a=getDtypeArrayParam(e.attr,n.tfName,n.defaultValue),void 0===a&&n.tfDeprecatedName&&(a=getDtypeArrayParam(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"func":a=getFuncParam(e.attr,n.tfName,n.defaultValue),void 0===a&&n.tfDeprecatedName&&(a=getFuncParam(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error(`Unsupported param type: ${n.type} for op: ${e.op}`)}return t[n.name]={value:a,type:r},t}),{})),n}mapFunction(e){const t=e.nodeDef,n=[];let r={};null!=t&&(r=t.reduce(((e,t)=>(e[t.name]=this.mapNode(t),"Const"===t.op&&n.push(e[t.name]),e)),{}));const a=[],i=[];e.signature.inputArg.forEach((e=>{const[t]=getNodeNameAndIndex(e.name),n={name:t,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:parseDtypeParam(e.type),type:"dtype"}},children:[]};n.signatureKey=e.name,a.push(n),r[t]=n}));Object.keys(r).forEach((e=>{const t=r[e];t.inputNames.forEach(((e,n)=>{const[a,,i]=getNodeNameAndIndex(e),s=r[a];if(null!=s.outputs){const e=s.outputs.indexOf(i);if(-1!==e){const r=`${a}:${e}`;t.inputNames[n]=r}}t.inputs.push(s),s.children.push(t)}))}));const s=e.ret;e.signature.outputArg.forEach((e=>{const[t,n]=getNodeNameAndIndex(s[e.name]),a=r[t];null!=a&&(a.defaultOutput=n,i.push(a))}));const o=this.mapArgsToSignature(e);return{nodes:r,inputs:a,outputs:i,weights:n,placeholders:[],signature:o}}mapArgsToSignature(e){return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce(((e,t)=>(e[t.name]=this.mapArgToTensorInfo(t),e)),{}),outputs:e.signature.outputArg.reduce(((t,n)=>(t[n.name]=this.mapArgToTensorInfo(n,e.ret),t)),{})}}mapArgToTensorInfo(e,t){let n=e.name;return null!=t&&(n=t[n]),{name:n,dtype:e.type}}}function decodeBase64(e){const t=env().global;if(void 0!==t.atob)return t.atob(e);if("undefined"!=typeof Buffer)return new Buffer(e,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}function parseStringParam(e,t){const n=Array.isArray(e)?String.fromCharCode.apply(null,e):decodeBase64(e);return t?n:n.toLowerCase()}function getStringParam(e,t,n,r=!1){const a=e[t];return null!=a?parseStringParam(a.s,r):n}function getBoolParam(e,t,n){const r=e[t];return r?r.b:n}function getNumberParam(e,t,n){const r=e[t]||{},a=null!=r.i?r.i:null!=r.f?r.f:n;return"number"==typeof a?a:parseInt(a,10)}function parseDtypeParam(e){switch("string"==typeof e&&(e=DataType[e]),e){case DataType.DT_FLOAT:case DataType.DT_HALF:return"float32";case DataType.DT_INT32:case DataType.DT_INT64:case DataType.DT_INT8:case DataType.DT_UINT8:return"int32";case DataType.DT_BOOL:return"bool";case DataType.DT_DOUBLE:return"float32";case DataType.DT_STRING:return"string";default:return null}}function getFuncParam(e,t,n){const r=e[t];return r&&r.func?r.func.name:n}function getDtypeParam(e,t,n){const r=e[t];return r&&r.type?parseDtypeParam(r.type):n}function getDtypeArrayParam(e,t,n){const r=e[t];return r&&r.list&&r.list.type?r.list.type.map((e=>parseDtypeParam(e))):n}function parseTensorShapeParam(e){if(!e.unknownRank)return null!=e.dim?e.dim.map((e=>"number"==typeof e.size?e.size:parseInt(e.size,10))):[]}function getTensorShapeParam(e,t,n){const r=e[t];return r&&r.shape?parseTensorShapeParam(r.shape):n}function getNumericArrayParam(e,t,n){const r=e[t];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map((e=>"number"==typeof e?e:parseInt(e,10))):n}function getStringArrayParam(e,t,n,r=!1){const a=e[t];return a&&a.list&&a.list.s?a.list.s.map((e=>parseStringParam(e,r))):n}function getTensorShapeArrayParam(e,t,n){const r=e[t];return r&&r.list&&r.list.shape?r.list.shape.map((e=>parseTensorShapeParam(e))):n}function getBoolArrayParam(e,t,n){const r=e[t];return r&&r.list&&r.list.b?r.list.b:n}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class NodeValueImpl{constructor(e,t,n){this.node=e,this.tensorMap=t,this.context=n,this.inputs=[],this.attrs={},this.inputs=e.inputNames.map((e=>this.getInput(e))),null!=e.rawAttrs&&(this.attrs=Object.keys(e.rawAttrs).reduce(((e,t)=>(e[t]=this.getAttr(t),e)),{}))}getInput(e){return getTensor(e,this.tensorMap,this.context)}getAttr(e,t){const n=this.node.rawAttrs[e];if(null!=n.tensor)return getTensor(e,this.tensorMap,this.context);if(null!=n.i||null!=n.f)return getNumberParam(this.node.rawAttrs,e,t);if(null!=n.s)return getStringParam(this.node.rawAttrs,e,t);if(null!=n.b)return getBoolParam(this.node.rawAttrs,e,t);if(null!=n.shape)return getTensorShapeParam(this.node.rawAttrs,e,t);if(null!=n.type)return getDtypeParam(this.node.rawAttrs,e,t);if(null!=n.list){if(null!=n.list.i||null!=n.list.f)return getNumericArrayParam(this.node.rawAttrs,e,t);if(null!=n.list.s)return getStringArrayParam(this.node.rawAttrs,e,t);if(null!=n.list.shape)return getTensorShapeArrayParam(this.node.rawAttrs,e,t);if(null!=n.list.b)return getBoolArrayParam(this.node.rawAttrs,e,t);if(null!=n.list.type)return getDtypeArrayParam(this.node.rawAttrs,e,t)}return t}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const tfOps=Object.freeze(Object.defineProperty({__proto__:null,OP_SCOPE_SUFFIX:OP_SCOPE_SUFFIX,abs:abs$2,acos:acos$2,acosh:acosh$2,add:add$1,addN:addN$2,all:all$2,any:any$3,argMax:argMax$2,argMin:argMin$2,asin:asin$2,asinh:asinh$2,atan:atan$2,atan2:atan2$2,atanh:atanh$2,avgPool:avgPool$2,avgPool3d:avgPool3d,basicLSTMCell:basicLSTMCell,batchNorm:batchNorm$2,batchNorm2d:batchNorm2d,batchNorm3d:batchNorm3d,batchNorm4d:batchNorm4d,batchToSpaceND:batchToSpaceND$2,bincount:bincount$2,bitwiseAnd:bitwiseAnd$2,booleanMaskAsync:booleanMaskAsync,broadcastArgs:broadcastArgs$2,broadcastTo:broadcastTo,buffer:buffer,cast:cast$3,ceil:ceil$2,clipByValue:clipByValue$2,clone:clone,complex:complex$2,concat:concat$2,concat1d:concat1d,concat2d:concat2d,concat3d:concat3d,concat4d:concat4d,conv1d:conv1d,conv2d:conv2d$2,conv2dTranspose:conv2dTranspose,conv3d:conv3d,conv3dTranspose:conv3dTranspose,cos:cos$2,cosh:cosh$2,cosineWindow:cosineWindow,cumprod:cumprod$2,cumsum:cumsum$2,denseBincount:denseBincount$2,depthToSpace:depthToSpace$2,depthwiseConv2d:depthwiseConv2d$2,diag:diag$2,dilation2d:dilation2d,div:div$1,divNoNan:divNoNan,dot:dot$1,dropout:dropout$1,einsum:einsum$2,elu:elu$3,enclosingPowerOfTwo:enclosingPowerOfTwo,ensureShape:ensureShape,equal:equal$2,erf:erf$2,euclideanNorm:euclideanNorm,exp:exp$2,expandDims:expandDims$3,expm1:expm1$2,eye:eye,fft:fft$2,fill:fill$2,floor:floor$2,floorDiv:floorDiv$2,fused:fused_ops,gather:gather$1,gatherND:gatherND,greater:greater$2,greaterEqual:greaterEqual$2,ifft:ifft$2,imag:imag$2,image:image$1,inTopKAsync:inTopKAsync,irfft:irfft,isFinite:isFinite$3,isInf:isInf$2,isNaN:isNaN$3,leakyRelu:leakyRelu$2,less:less$2,lessEqual:lessEqual$2,linalg:linalg,linspace:linspace,localResponseNormalization:localResponseNormalization,log:log$4,log1p:log1p$2,logSigmoid:logSigmoid,logSoftmax:logSoftmax,logSumExp:logSumExp,logicalAnd:logicalAnd$2,logicalNot:logicalNot$2,logicalOr:logicalOr$2,logicalXor:logicalXor,losses:losses,lowerBound:lowerBound$1,matMul:matMul$1,max:max$3,maxPool:maxPool$2,maxPool3d:maxPool3d$1,maxPoolWithArgmax:maxPoolWithArgmax,maximum:maximum$2,mean:mean$1,meshgrid:meshgrid,min:min$3,minimum:minimum$2,mirrorPad:mirrorPad$1,mod:mod$2,moments:moments,movingAverage:movingAverage,mul:mul,multiRNNCell:multiRNNCell,multinomial:multinomial$2,neg:neg$2,norm:norm,notEqual:notEqual$2,oneHot:oneHot$2,ones:ones,onesLike:onesLike$2,op:op,outerProduct:outerProduct,pad:pad,pad1d:pad1d,pad2d:pad2d,pad3d:pad3d,pad4d:pad4d,pool:pool$1,pow:pow$2,prelu:prelu$2,print:print,prod:prod$2,raggedGather:raggedGather$2,raggedRange:raggedRange$2,raggedTensorToTensor:raggedTensorToTensor$2,rand:rand,randomGamma:randomGamma,randomNormal:randomNormal$1,randomStandardNormal:randomStandardNormal,randomUniform:randomUniform,randomUniformInt:randomUniformInt,range:range$4,real:real$2,reciprocal:reciprocal$2,relu:relu$2,relu6:relu6$2,reshape:reshape$2,reverse:reverse$2,reverse1d:reverse1d,reverse2d:reverse2d,reverse3d:reverse3d,reverse4d:reverse4d,rfft:rfft,round:round$2,rsqrt:rsqrt$2,scalar:scalar,scatterND:scatterND,searchSorted:searchSorted$2,selu:selu$2,separableConv2d:separableConv2d,setdiff1dAsync:setdiff1dAsync,sigmoid:sigmoid$2,sign:sign$2,signal:signal,sin:sin$2,sinh:sinh$2,slice:slice$2,slice1d:slice1d,slice2d:slice2d,slice3d:slice3d,slice4d:slice4d,softmax:softmax$2,softplus:softplus$2,spaceToBatchND:spaceToBatchND$2,sparse:sparse$1,sparseToDense:sparseToDense$2,spectral:spectral$1,split:split$3,sqrt:sqrt$2,square:square$2,squaredDifference:squaredDifference$2,squeeze:squeeze,stack:stack,step:step$2,stridedSlice:stridedSlice$2,string:string$1,sub:sub$2,sum:sum$2,tan:tan$2,tanh:tanh$2,tensor:tensor,tensor1d:tensor1d,tensor2d:tensor2d,tensor3d:tensor3d,tensor4d:tensor4d,tensor5d:tensor5d,tensor6d:tensor6d,tensorScatterUpdate:tensorScatterUpdate$2,tile:tile$3,topk:topk,transpose:transpose$2,truncatedNormal:truncatedNormal,unique:unique$3,unsortedSegmentSum:unsortedSegmentSum$2,unstack:unstack,upperBound:upperBound$1,variable:variable,where:where,whereAsync:whereAsync,zeros:zeros$1,zerosLike:zerosLike$2},Symbol.toStringTag,{value:"Module"})),executeOp$k=(e,t,n,r=tfOps)=>{switch(e.op){case"BiasAdd":case"AddV2":case"Add":return[r.add(getParamValue("a",e,t,n),getParamValue("b",e,t,n))];case"AddN":return[r.addN(getParamValue("tensors",e,t,n))];case"FloorMod":case"Mod":return[r.mod(getParamValue("a",e,t,n),getParamValue("b",e,t,n))];case"Mul":return[r.mul(getParamValue("a",e,t,n),getParamValue("b",e,t,n))];case"RealDiv":case"Div":return[r.div(getParamValue("a",e,t,n),getParamValue("b",e,t,n))];case"DivNoNan":return[r.divNoNan(getParamValue("a",e,t,n),getParamValue("b",e,t,n))];case"FloorDiv":return[r.floorDiv(getParamValue("a",e,t,n),getParamValue("b",e,t,n))];case"Sub":return[r.sub(getParamValue("a",e,t,n),getParamValue("b",e,t,n))];case"Minimum":return[r.minimum(getParamValue("a",e,t,n),getParamValue("b",e,t,n))];case"Maximum":return[r.maximum(getParamValue("a",e,t,n),getParamValue("b",e,t,n))];case"Pow":return[r.pow(getParamValue("a",e,t,n),getParamValue("b",e,t,n))];case"SquaredDifference":return[r.squaredDifference(getParamValue("a",e,t,n),getParamValue("b",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}},executeOp$j=(e,t,n,r=tfOps)=>{switch(e.op){case"Abs":case"ComplexAbs":return[r.abs(getParamValue("x",e,t,n))];case"Acos":return[r.acos(getParamValue("x",e,t,n))];case"Acosh":return[r.acosh(getParamValue("x",e,t,n))];case"Asin":return[r.asin(getParamValue("x",e,t,n))];case"Asinh":return[r.asinh(getParamValue("x",e,t,n))];case"Atan":return[r.atan(getParamValue("x",e,t,n))];case"Atan2":return[r.atan2(getParamValue("x",e,t,n),getParamValue("y",e,t,n))];case"Atanh":return[r.atanh(getParamValue("x",e,t,n))];case"Ceil":return[r.ceil(getParamValue("x",e,t,n))];case"Complex":return[r.complex(getParamValue("real",e,t,n),getParamValue("imag",e,t,n))];case"Cos":return[r.cos(getParamValue("x",e,t,n))];case"Cosh":return[r.cosh(getParamValue("x",e,t,n))];case"Elu":return[r.elu(getParamValue("x",e,t,n))];case"Erf":return[r.erf(getParamValue("x",e,t,n))];case"Exp":return[r.exp(getParamValue("x",e,t,n))];case"Expm1":return[r.expm1(getParamValue("x",e,t,n))];case"Floor":return[r.floor(getParamValue("x",e,t,n))];case"Log":return[r.log(getParamValue("x",e,t,n))];case"Log1p":return[r.log1p(getParamValue("x",e,t,n))];case"Imag":return[r.imag(getParamValue("x",e,t,n))];case"Neg":return[r.neg(getParamValue("x",e,t,n))];case"Reciprocal":return[r.reciprocal(getParamValue("x",e,t,n))];case"Real":return[r.real(getParamValue("x",e,t,n))];case"Relu":return[r.relu(getParamValue("x",e,t,n))];case"Round":return[r.round(getParamValue("x",e,t,n))];case"Selu":return[r.selu(getParamValue("x",e,t,n))];case"Sigmoid":return[r.sigmoid(getParamValue("x",e,t,n))];case"Sin":return[r.sin(getParamValue("x",e,t,n))];case"Sign":return[r.sign(getParamValue("x",e,t,n))];case"Sinh":return[r.sinh(getParamValue("x",e,t,n))];case"Softplus":return[r.softplus(getParamValue("x",e,t,n))];case"Sqrt":return[r.sqrt(getParamValue("x",e,t,n))];case"Square":return[r.square(getParamValue("x",e,t,n))];case"Tanh":return[r.tanh(getParamValue("x",e,t,n))];case"Tan":return[r.tan(getParamValue("x",e,t,n))];case"ClipByValue":return[r.clipByValue(getParamValue("x",e,t,n),getParamValue("clipValueMin",e,t,n),getParamValue("clipValueMax",e,t,n))];case"Relu6":return[r.relu6(getParamValue("x",e,t,n))];case"Rsqrt":return[r.rsqrt(getTensor(e.inputNames[0],t,n))];case"LeakyRelu":return[r.leakyRelu(getParamValue("x",e,t,n),getParamValue("alpha",e,t,n))];case"Prelu":return[r.prelu(getParamValue("x",e,t,n),getParamValue("alpha",e,t,n))];case"IsNan":return[r.isNaN(getTensor(e.inputNames[0],t,n))];case"IsInf":return[r.isInf(getTensor(e.inputNames[0],t,n))];case"IsFinite":return[r.isFinite(getTensor(e.inputNames[0],t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}};
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function assertShapesMatchAllowUndefinedSize(e,t,n=""){if("number"!=typeof e&&"number"!=typeof t){assert$1(e.length===t.length,(()=>n+` Shapes ${e} and ${t} must match`));for(let r=0;r<e.length;r++){const a=e[r],i=t[r];assert$1(a<0||i<0||a===i,(()=>n+` Shapes ${e} and ${t} must match`))}}}function fullDefinedShape(e){return"number"!=typeof e&&!e.some((e=>e<0))}function inferElementShape(e,t,n){let r=mergeElementShape(e,n);const a=!fullDefinedShape(r);if(a&&0===t.length)throw new Error(`Tried to calculate elements of an empty list with non-fully-defined elementShape: ${r}`);if(a&&t.forEach((e=>{r=mergeElementShape(e.shape,r)})),!fullDefinedShape(r))throw new Error(`Non-fully-defined elementShape: ${r}`);return r}function mergeElementShape(e,t){if("number"==typeof e)return t;if("number"==typeof t)return e;if(e.length!==t.length)throw new Error(`Incompatible ranks during merge: ${e} vs. ${t}`);const n=[];for(let r=0;r<e.length;++r){const a=e[r],i=t[r];if(a>=0&&i>=0&&a!==i)throw new Error(`Incompatible shape during merge: ${e} vs. ${t}`);n[r]=a>=0?a:i}return n}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class TensorArray{constructor(e,t,n,r,a,i,s){this.name=e,this.dtype=t,this.maxSize=n,this.elementShape=r,this.identicalElementShapes=a,this.dynamicSize=i,this.clearAfterRead=s,this.tensors=[],this.closed_=!1,this.idTensor=scalar(0),keep(this.idTensor)}get id(){return this.idTensor.id}get closed(){return this.closed_}clearAndClose(e){this.tensors.forEach((t=>{null!=e&&e.has(t.tensor.id)||t.tensor.dispose()})),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}size(){return this.tensors.length}read(e){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||e>=this.size())throw new Error(`Tried to read from index ${e}, but array size is: ${this.size()}`);const t=this.tensors[e];if(t.cleared)throw new Error(`TensorArray ${this.name}: Could not read index ${e} twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).`);return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor}readMany(e){return e.map((e=>this.read(e)))}write(e,t){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error(`Tried to write to index ${e}, but array is not resizeable and size is: ${this.maxSize}`);const n=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e},\n          because the value dtype is ${t.dtype}, but TensorArray dtype is ${this.dtype}.`);if(0!==this.size()||null!=this.elementShape&&0!==this.elementShape.length||(this.elementShape=t.shape),assertShapesMatchAllowUndefinedSize(this.elementShape,t.shape,`TensorArray ${this.name}: Could not write to TensorArray index ${e}.`),n.read)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been read.`);if(n.written)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been written.`);n.tensor=t,keep(t),n.written=!0,this.tensors[e]=n}writeMany(e,t){if(e.length!==t.length)throw new Error(`TensorArray ${this.name}: could not write multiple tensors,because the index size: ${e.length} is not the same as tensors size: ${t.length}.`);e.forEach(((e,n)=>this.write(e,t[n])))}gather(e,t){if(t&&t!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but gather requested dtype ${t}`);if(e)e=e.slice(0,this.size());else{e=[];for(let t=0;t<this.size();t++)e.push(t)}if(0===e.length)return tensor([],[0].concat(this.elementShape));const n=this.readMany(e);return assertShapesMatchAllowUndefinedSize(this.elementShape,n[0].shape,"TensorArray shape mismatch: "),stack(n,0)}concat(e){if(e&&e!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but concat requested dtype ${e}`);if(0===this.size())return tensor([],[0].concat(this.elementShape));const t=[];for(let r=0;r<this.size();r++)t.push(r);const n=this.readMany(t);return assertShapesMatchAllowUndefinedSize(this.elementShape,n[0].shape,`TensorArray shape mismatch: tensor array shape (${this.elementShape}) vs first tensor shape (${n[0].shape})`),concat$2(n,0)}scatter(e,t){if(t.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${t.dtype}`);if(e.length!==t.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${t.shape[0]}`);const n=Math.max(...e);if(!this.dynamicSize&&n>=this.maxSize)throw new Error(`Max index must be < array size (${n}  vs. ${this.maxSize})`);this.writeMany(e,unstack(t,0))}split(e,t){if(t.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${t.dtype}`);let n=0;const r=e.map((e=>(n+=e,n)));if(n!==t.shape[0])throw new Error(`Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ${n}, and tensor's shape is: ${t.shape}`);if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error(`TensorArray's size is not equal to the size of lengths (${this.maxSize} vs. ${e.length}), and the TensorArray is not marked as dynamically resizeable`);const a=0===n?0:t.size/n,i=[];tidy((()=>{t=reshape$2(t,[1,n,a]);for(let n=0;n<e.length;++n){const s=[0,0===n?0:r[n-1],0],o=[1,e[n],a];i[n]=reshape$2(slice$2(t,s,o),this.elementShape)}return i}));const s=[];for(let o=0;o<e.length;o++)s[o]=o;this.writeMany(s,i)}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class TensorList{get id(){return this.idTensor.id}constructor(e,t,n,r=-1){this.tensors=e,this.elementShape=t,this.elementDtype=n,null!=e&&e.forEach((e=>{if(n!==e.dtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${e.dtype}`);assertShapesMatchAllowUndefinedSize(t,e.shape,"TensorList shape mismatch: "),keep(e)})),this.idTensor=scalar(0),this.maxNumElements=r,keep(this.idTensor)}copy(){return new TensorList([...this.tensors],this.elementShape,this.elementDtype)}clearAndClose(e){this.tensors.forEach((t=>{null!=e&&e.has(t.id)||t.dispose()})),this.tensors.length=0,this.idTensor.dispose()}size(){return this.tensors.length}stack(e,t,n=-1){if(t!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t}, but list elements ${this.elementDtype}`);if(-1!==n&&this.tensors.length!==n)throw new Error(`Operation expected a list with ${n} elements but got a list with ${this.tensors.length} elements.`);assertShapesMatchAllowUndefinedSize(e,this.elementShape,"TensorList shape mismatch: ");const r=inferElementShape(this.elementShape,this.tensors,e);return tidy((()=>{const e=this.tensors.map((e=>reshape$2(e,r)));return stack(e,0)}))}popBack(e,t){if(t!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t}, but list elements ${this.elementDtype}`);if(0===this.size())throw new Error("Trying to pop from an empty list.");const n=inferElementShape(this.elementShape,this.tensors,e),r=this.tensors.pop();return r.kept=!1,assertShapesMatchAllowUndefinedSize(r.shape,e,"TensorList shape mismatch: "),reshape$2(r,n)}pushBack(e){if(e.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e.dtype}, but list elements ${this.elementDtype}`);if(assertShapesMatchAllowUndefinedSize(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");keep(e),this.tensors.push(e)}resize(e){if(e<0)throw new Error(`TensorListResize expects size to be non-negative. Got: ${e}`);if(-1!==this.maxNumElements&&e>this.maxNumElements)throw new Error(`TensorListResize input size ${e} is greater maxNumElement ${this.maxNumElements}.`);const t=new TensorList([],this.elementShape,this.elementDtype,this.maxNumElements);t.tensors.length=e;for(let n=0;n<Math.min(this.tensors.length,e);++n)t.tensors[n]=this.tensors[n];return t}getItem(e,t,n){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);if(e<0||e>this.tensors.length)throw new Error(`Trying to access element ${e} in a list with ${this.tensors.length} elements.`);if(null==this.tensors[e])throw new Error(`element at index ${e} is null.`);assertShapesMatchAllowUndefinedSize(this.tensors[e].shape,t,"TensorList shape mismatch: ");const r=inferElementShape(this.elementShape,this.tensors,t);return reshape$2(this.tensors[e],r)}setItem(e,t){if(t.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${this.elementDtype}`);if(e<0||-1!==this.maxNumElements&&e>=this.maxNumElements)throw new Error(`Trying to set element ${e} in a list with max ${this.maxNumElements} elements.`);assertShapesMatchAllowUndefinedSize(this.elementShape,t.shape,"TensorList shape mismatch: "),keep(t),null!=this.tensors[e]&&(this.tensors[e].kept=!1),this.tensors[e]=t}gather(e,t,n){if(t!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t}, but list elements ${this.elementDtype}`);assertShapesMatchAllowUndefinedSize(this.elementShape,n,"TensorList shape mismatch: "),e=e.slice(0,this.size());const r=inferElementShape(this.elementShape,this.tensors,n);return 0===e.length?tensor([],[0].concat(r)):tidy((()=>{const t=e.map((e=>reshape$2(this.tensors[e],r)));return stack(t,0)}))}concat(e,t){if(e&&e!==this.elementDtype)throw new Error(`TensorList dtype is ${this.elementDtype} but concat requested dtype ${e}`);assertShapesMatchAllowUndefinedSize(this.elementShape,t,"TensorList shape mismatch: ");const n=inferElementShape(this.elementShape,this.tensors,t);return 0===this.size()?tensor([],[0].concat(n)):tidy((()=>{const e=this.tensors.map((e=>reshape$2(e,n)));return concat$2(e,0)}))}}function fromTensor(e,t,n){const r=e.dtype;if(e.shape.length<1)throw new Error(`Tensor must be at least a vector, but saw shape: ${e.shape}`);if(e.dtype!==n)throw new Error(`Invalid data types; op elements ${e.dtype}, but list elements ${n}`);assertShapesMatchAllowUndefinedSize(e.shape.slice(1),t,"TensorList shape mismatch: ");const a=unstack(e);return new TensorList(a,t,r)}function reserve(e,t,n,r){return new TensorList([],e,t,r)}function scatter(e,t,n,r){if(t.length!==e.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${t.length} vs. ${e.shape[0]}`);const a=Math.max(...t);if(null!=r&&-1!==r&&a>=r)throw new Error(`Max index must be < array size (${a}  vs. ${r})`);const i=new TensorList([],n,e.dtype,r),s=unstack(e,0);return t.forEach(((e,t)=>{i.setItem(e,s[t])})),i}function split$2(e,t,n){let r=0;const a=t.map((e=>(r+=e,r)));if(r!==e.shape[0])throw new Error(`Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ${r}, and tensor's shape is: ${e.shape}`);const i=mergeElementShape(e.shape.slice(1),n),s=0===r?0:e.size/r,o=tidy((()=>{const n=[];e=reshape$2(e,[1,r,s]);for(let r=0;r<t.length;++r){const o=[0,0===r?0:a[r-1],0],l=[1,t[r],s];n[r]=reshape$2(slice$2(e,o,l),i)}return e.dispose(),n})),l=new TensorList([],n,e.dtype,t.length);for(let u=0;u<o.length;u++)l.setItem(u,o[u]);return l}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const executeOp$i=async(e,t,n)=>{switch(e.op){case"If":case"StatelessIf":{const r=getParamValue("thenBranch",e,t,n),a=getParamValue("elseBranch",e,t,n),i=getParamValue("cond",e,t,n),s=getParamValue("args",e,t,n);return(await i.data())[0]?n.functionMap[r].executeFunctionAsync(s,n.tensorArrayMap,n.tensorListMap):n.functionMap[a].executeFunctionAsync(s,n.tensorArrayMap,n.tensorListMap)}case"While":case"StatelessWhile":{const r=getParamValue("body",e,t,n),a=getParamValue("cond",e,t,n),i=getParamValue("args",e,t,n),s=await n.functionMap[a].executeFunctionAsync(i,n.tensorArrayMap,n.tensorListMap),o=i.map((e=>e.id));let l=await s[0].data();s.forEach((e=>{e.kept||-1!==o.indexOf(e.id)||e.dispose()}));let u=i;for(;l[0];){const e=u;u=await n.functionMap[r].executeFunctionAsync(u,n.tensorArrayMap,n.tensorListMap);const t=u.map((e=>e.id));e.forEach((e=>{e.kept||-1!==o.indexOf(e.id)||-1!==t.indexOf(e.id)||e.dispose()}));const i=await n.functionMap[a].executeFunctionAsync(u,n.tensorArrayMap,n.tensorListMap);l=await i[0].data(),i.forEach((e=>{e.kept||-1!==o.indexOf(e.id)||-1!==t.indexOf(e.id)||e.dispose()}))}return u}case"LoopCond":return[cloneTensor(getParamValue("pred",e,t,n))];case"Switch":{const r=getParamValue("pred",e,t,n);let a=getParamValue("data",e,t,n);return a.kept||(a=cloneTensor(a)),(await r.data())[0]?[void 0,a]:[a,void 0]}case"Merge":{const r=e.inputNames.find((e=>void 0!==getTensor(e,t,n)));if(r){return[cloneTensor(getTensor(r,t,n))]}return}case"Enter":{const r=getParamValue("frameName",e,t,n),a=getParamValue("tensor",e,t,n);return n.enterFrame(r),[cloneTensor(a)]}case"Exit":{const r=getParamValue("tensor",e,t,n);return n.exitFrame(),[cloneTensor(r)]}case"NextIteration":{const r=getParamValue("tensor",e,t,n);return n.nextIteration(),[cloneTensor(r)]}case"TensorArrayV3":{const r=getParamValue("size",e,t,n),a=getParamValue("dtype",e,t,n),i=getParamValue("elementShape",e,t,n),s=getParamValue("dynamicSize",e,t,n),o=getParamValue("clearAfterRead",e,t,n),l=getParamValue("identicalElementShapes",e,t,n),u=getParamValue("name",e,t,n),c=new TensorArray(u,a,r,i,l,s,o);return n.addTensorArray(c),[c.idTensor,scalar(1)]}case"TensorArrayWriteV3":{const r=getParamValue("tensorArrayId",e,t,n),a=getParamValue("index",e,t,n),i=getParamValue("tensor",e,t,n),s=n.getTensorArray(r.id);return s.write(a,i),[s.idTensor]}case"TensorArrayReadV3":{const r=getParamValue("tensorArrayId",e,t,n),a=getParamValue("index",e,t,n);return[n.getTensorArray(r.id).read(a)]}case"TensorArrayGatherV3":{const r=getParamValue("tensorArrayId",e,t,n),a=getParamValue("indices",e,t,n),i=getParamValue("dtype",e,t,n);return[n.getTensorArray(r.id).gather(a,i)]}case"TensorArrayScatterV3":{const r=getParamValue("tensorArrayId",e,t,n),a=getParamValue("indices",e,t,n),i=getParamValue("tensor",e,t,n),s=n.getTensorArray(r.id);return s.scatter(a,i),[s.idTensor]}case"TensorArrayConcatV3":{const r=getParamValue("tensorArrayId",e,t,n),a=n.getTensorArray(r.id),i=getParamValue("dtype",e,t,n);return[a.concat(i)]}case"TensorArraySplitV3":{const r=getParamValue("tensorArrayId",e,t,n),a=getParamValue("tensor",e,t,n),i=getParamValue("lengths",e,t,n),s=n.getTensorArray(r.id);return s.split(i,a),[s.idTensor]}case"TensorArraySizeV3":{const r=getParamValue("tensorArrayId",e,t,n);return[scalar(n.getTensorArray(r.id).size(),"int32")]}case"TensorArrayCloseV3":{const r=getParamValue("tensorArrayId",e,t,n),a=n.getTensorArray(r.id);return a.clearAndClose(),[a.idTensor]}case"TensorListSetItem":{const r=getParamValue("tensorListId",e,t,n),a=getParamValue("index",e,t,n),i=getParamValue("tensor",e,t,n),s=n.getTensorList(r.id);return s.setItem(a,i),[s.idTensor]}case"TensorListGetItem":{const r=getParamValue("tensorListId",e,t,n),a=getParamValue("index",e,t,n),i=getParamValue("elementShape",e,t,n),s=getParamValue("elementDType",e,t,n);return[n.getTensorList(r.id).getItem(a,i,s)]}case"TensorListScatterV2":case"TensorListScatter":{const r=getParamValue("indices",e,t,n),a=scatter(getParamValue("tensor",e,t,n),r,getParamValue("elementShape",e,t,n),getParamValue("numElements",e,t,n));return n.addTensorList(a),[a.idTensor]}case"TensorListReserve":case"EmptyTensorList":{const r=getParamValue("elementShape",e,t,n),a=getParamValue("elementDType",e,t,n);let i;i="TensorListReserve"===e.op?"numElements":"maxNumElements";const s=getParamValue(i,e,t,n),o=reserve(r,a,s,"TensorListReserve"===e.op?-1:s);return n.addTensorList(o),[o.idTensor]}case"TensorListGather":{const r=getParamValue("tensorListId",e,t,n),a=getParamValue("indices",e,t,n),i=getParamValue("elementShape",e,t,n),s=getParamValue("elementDType",e,t,n);return[n.getTensorList(r.id).gather(a,s,i)]}case"TensorListStack":{const r=getParamValue("tensorListId",e,t,n),a=getParamValue("elementShape",e,t,n),i=getParamValue("elementDType",e,t,n),s=getParamValue("numElements",e,t,n);return[n.getTensorList(r.id).stack(a,i,s)]}case"TensorListFromTensor":{const r=fromTensor(getParamValue("tensor",e,t,n),getParamValue("elementShape",e,t,n),getParamValue("elementDType",e,t,n));return n.addTensorList(r),[r.idTensor]}case"TensorListConcat":case"TensorListConcatV2":{const r=getParamValue("tensorListId",e,t,n),a=n.getTensorList(r.id),i=getParamValue("dtype",e,t,n),s=getParamValue("elementShape",e,t,n);return[a.concat(i,s)]}case"TensorListPushBack":{const r=getParamValue("tensorListId",e,t,n),a=getParamValue("tensor",e,t,n),i=n.getTensorList(r.id);return i.pushBack(a),[i.idTensor]}case"TensorListPopBack":{const r=getParamValue("tensorListId",e,t,n),a=getParamValue("elementShape",e,t,n),i=getParamValue("elementDType",e,t,n);return[n.getTensorList(r.id).popBack(a,i)]}case"TensorListSplit":{const r=getParamValue("tensor",e,t,n),a=getParamValue("elementShape",e,t,n),i=split$2(r,getParamValue("lengths",e,t,n),a);return n.addTensorList(i),[i.idTensor]}case"TensorListLength":{const r=getParamValue("tensorListId",e,t,n);return[scalar(n.getTensorList(r.id).size(),"int32")]}case"TensorListResize":{const r=getParamValue("tensorListId",e,t,n),a=getParamValue("size",e,t,n),i=n.getTensorList(r.id).resize(a);return n.addTensorList(i),[i.idTensor]}default:throw TypeError(`Node type ${e.op} is not implemented`)}};
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function fusedConvAndDepthWiseParams(e,t,n){const[r,a]=getParamValue("fusedOps",e,t,n),i="biasadd"===r,s=!i,o="prelu"===a,l="fusedbatchnorm"===r,u=getParamValue("numArgs",e,t,n);if(i){if(o&&2!==u)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!o&&i&&1!==u)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(l)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");const c=getParamValue("strides",e,t,n),h=getPadding(e,t,n),d=getParamValue("dataFormat",e,t,n).toUpperCase(),p=getParamValue("dilations",e,t,n);let[f,m]=getParamValue("args",e,t,n);s&&(m=f,f=void 0);return{stride:c,pad:h,dataFormat:d,dilations:p,biasArg:f,preluArg:m,activationFunc:a,leakyreluAlpha:getParamValue("leakyreluAlpha",e,t,n)}}const executeOp$h=(e,t,n,r=tfOps)=>{switch(e.op){case"Conv1D":{const a=getParamValue("stride",e,t,n),i=getParamValue("pad",e,t,n),s=getParamValue("dataFormat",e,t,n).toUpperCase(),o=getParamValue("dilation",e,t,n);return[r.conv1d(getParamValue("x",e,t,n),getParamValue("filter",e,t,n),a,i,s,o)]}case"Conv2D":{const a=getParamValue("strides",e,t,n),i=getPadding(e,t,n),s=getParamValue("dataFormat",e,t,n).toUpperCase(),o=getParamValue("dilations",e,t,n);return[r.conv2d(getParamValue("x",e,t,n),getParamValue("filter",e,t,n),[a[1],a[2]],i,s,[o[1],o[2]])]}case"_FusedConv2D":{const{stride:a,pad:i,dataFormat:s,dilations:o,biasArg:l,preluArg:u,activationFunc:c,leakyreluAlpha:h}=fusedConvAndDepthWiseParams(e,t,n);return[r.fused.conv2d({x:getParamValue("x",e,t,n),filter:getParamValue("filter",e,t,n),strides:[a[1],a[2]],pad:i,dataFormat:s,dilations:[o[1],o[2]],bias:l,activation:c,preluActivationWeights:u,leakyreluAlpha:h})]}case"FusedDepthwiseConv2dNative":{const{stride:a,pad:i,dataFormat:s,dilations:o,biasArg:l,preluArg:u,activationFunc:c,leakyreluAlpha:h}=fusedConvAndDepthWiseParams(e,t,n);return[r.fused.depthwiseConv2d({x:getParamValue("x",e,t,n),filter:getParamValue("filter",e,t,n),strides:[a[1],a[2]],pad:i,dataFormat:s,dilations:[o[1],o[2]],bias:l,activation:c,preluActivationWeights:u,leakyreluAlpha:h})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{const a=getParamValue("outputShape",e,t,n),i=getParamValue("strides",e,t,n),s=getPadding(e,t,n);return[r.conv2dTranspose(getParamValue("x",e,t,n),getParamValue("filter",e,t,n),a,[i[1],i[2]],s)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{const a=getParamValue("strides",e,t,n),i=getPadding(e,t,n),s=getParamValue("dilations",e,t,n),o=getParamValue("dataFormat",e,t,n).toUpperCase();return[r.depthwiseConv2d(getParamValue("input",e,t,n),getParamValue("filter",e,t,n),[a[1],a[2]],i,o,[s[1],s[2]])]}case"Conv3D":{const a=getParamValue("strides",e,t,n),i=getParamValue("pad",e,t,n),s=getParamValue("dataFormat",e,t,n).toUpperCase(),o=getParamValue("dilations",e,t,n);return[r.conv3d(getParamValue("x",e,t,n),getParamValue("filter",e,t,n),[a[1],a[2],a[3]],i,s,[o[1],o[2],o[3]])]}case"AvgPool":{const a=getParamValue("strides",e,t,n),i=getParamValue("pad",e,t,n),s=getParamValue("kernelSize",e,t,n);return[r.avgPool(getParamValue("x",e,t,n),[s[1],s[2]],[a[1],a[2]],i)]}case"MaxPool":{const a=getParamValue("strides",e,t,n),i=getParamValue("pad",e,t,n),s=getParamValue("kernelSize",e,t,n);return[r.maxPool(getParamValue("x",e,t,n),[s[1],s[2]],[a[1],a[2]],i)]}case"MaxPoolWithArgmax":{const a=getParamValue("strides",e,t,n),i=getParamValue("pad",e,t,n),s=getParamValue("kernelSize",e,t,n),o=getParamValue("includeBatchInIndex",e,t,n),{result:l,indexes:u}=r.maxPoolWithArgmax(getParamValue("x",e,t,n),[s[1],s[2]],[a[1],a[2]],i,o);return[l,u]}case"AvgPool3D":{const a=getParamValue("strides",e,t,n),i=getParamValue("pad",e,t,n),s=getParamValue("kernelSize",e,t,n);return[r.avgPool3d(getParamValue("x",e,t,n),[s[1],s[2],s[3]],[a[1],a[2],a[3]],i)]}case"MaxPool3D":{const a=getParamValue("strides",e,t,n),i=getParamValue("pad",e,t,n),s=getParamValue("kernelSize",e,t,n);return[r.maxPool3d(getParamValue("x",e,t,n),[s[1],s[2],s[3]],[a[1],a[2],a[3]],i)]}case"Dilation2D":{const a=getParamValue("strides",e,t,n),i=getParamValue("pad",e,t,n),s=getParamValue("dilations",e,t,n),o=a[1],l=a[2],u=s[1],c=s[2];return[r.dilation2d(getParamValue("x",e,t,n),getParamValue("filter",e,t,n),[o,l],i,[u,c],"NHWC")]}default:throw TypeError(`Node type ${e.op} is not implemented`)}},executeOp$g=(e,t,n,r=tfOps)=>{switch(e.op){case"Fill":{const a=getParamValue("shape",e,t,n),i=getParamValue("dtype",e,t,n),s=getParamValue("value",e,t,n);return[r.fill(a,s,i)]}case"LinSpace":{const a=getParamValue("start",e,t,n),i=getParamValue("stop",e,t,n),s=getParamValue("num",e,t,n);return[r.linspace(a,i,s)]}case"Multinomial":{const a=getParamValue("logits",e,t,n),i=getParamValue("numSamples",e,t,n),s=getParamValue("seed",e,t,n);return[r.multinomial(a,i,s)]}case"OneHot":{const a=getParamValue("indices",e,t,n),i=getParamValue("depth",e,t,n),s=getParamValue("onValue",e,t,n),o=getParamValue("offValue",e,t,n),l=getParamValue("dtype",e,t,n);return[r.oneHot(a,i,s,o,l)]}case"Ones":return[r.ones(getParamValue("shape",e,t,n),getParamValue("dtype",e,t,n))];case"OnesLike":return[r.onesLike(getParamValue("x",e,t,n))];case"RandomStandardNormal":return[r.randomStandardNormal(getParamValue("shape",e,t,n),getParamValue("dtype",e,t,n),getParamValue("seed",e,t,n))];case"RandomUniform":return[r.randomUniform(getParamValue("shape",e,t,n),getParamValue("minval",e,t,n),getParamValue("maxval",e,t,n),getParamValue("dtype",e,t,n))];case"RandomUniformInt":return[r.randomUniformInt(getParamValue("shape",e,t,n),getParamValue("minval",e,t,n),getParamValue("maxval",e,t,n),getParamValue("seed",e,t,n))];case"Range":{const a=getParamValue("start",e,t,n),i=getParamValue("stop",e,t,n),s=getParamValue("step",e,t,n);return[r.range(a,i,s,getParamValue("dtype",e,t,n))]}case"TruncatedNormal":{const a=getParamValue("shape",e,t,n),i=getParamValue("mean",e,t,n),s=getParamValue("stdDev",e,t,n),o=getParamValue("seed",e,t,n);return[r.truncatedNormal(a,i,s,getParamValue("dtype",e,t,n),o)]}case"Zeros":return[r.zeros(getParamValue("shape",e,t,n),getParamValue("dtype",e,t,n))];case"ZerosLike":return[r.zerosLike(getParamValue("x",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}};
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function nmsParams(e,t,n){return{boxes:getParamValue("boxes",e,t,n),scores:getParamValue("scores",e,t,n),maxOutputSize:getParamValue("maxOutputSize",e,t,n),iouThreshold:getParamValue("iouThreshold",e,t,n),scoreThreshold:getParamValue("scoreThreshold",e,t,n),softNmsSigma:getParamValue("softNmsSigma",e,t,n)}}const executeOp$f=async(e,t,n,r,a=tfOps)=>{switch(e.op){case"NonMaxSuppressionV5":{const{boxes:r,scores:i,maxOutputSize:s,iouThreshold:o,scoreThreshold:l,softNmsSigma:u}=nmsParams(e,t,n),c=await a.image.nonMaxSuppressionWithScoreAsync(r,i,s,o,l,u);return[c.selectedIndices,c.selectedScores]}case"NonMaxSuppressionV4":{const{boxes:r,scores:i,maxOutputSize:s,iouThreshold:o,scoreThreshold:l}=nmsParams(e,t,n),u=getParamValue("padToMaxOutputSize",e,t,n),c=await a.image.nonMaxSuppressionPaddedAsync(r,i,s,o,l,u);return[c.selectedIndices,c.validOutputs]}case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":{const{boxes:r,scores:i,maxOutputSize:s,iouThreshold:o,scoreThreshold:l}=nmsParams(e,t,n);return[await a.image.nonMaxSuppressionAsync(r,i,s,o,l)]}case"Where":{const r=a.cast(getParamValue("condition",e,t,n),"bool"),i=[await a.whereAsync(r)];return r.dispose(),i}case"ListDiff":return a.setdiff1dAsync(getParamValue("x",e,t,n),getParamValue("y",e,t,n));default:throw TypeError(`Node type ${e.op} is not implemented`)}},executeOp$e=(e,t,n,r=tfOps)=>{switch(e.op){case"LowerBound":{const a=getParamValue("sortedSequence",e,t,n),i=getParamValue("values",e,t,n);return[r.lowerBound(a,i)]}case"TopKV2":{const a=getParamValue("x",e,t,n),i=getParamValue("k",e,t,n),s=getParamValue("sorted",e,t,n),o=r.topk(a,i,s);return[o.values,o.indices]}case"UpperBound":{const a=getParamValue("sortedSequence",e,t,n),i=getParamValue("values",e,t,n);return[r.upperBound(a,i)]}case"Unique":{const a=getParamValue("x",e,t,n),i=r.unique(a);return[i.values,i.indices]}case"UniqueV2":{const a=getParamValue("x",e,t,n),i=getParamValue("axis",e,t,n),s=r.unique(a,i);return[s.values,s.indices]}default:throw TypeError(`Node type ${e.op} is not implemented`)}},executeOp$d=(e,t,n,r=tfOps)=>{switch(e.op){case"Const":return t[e.name];case"PlaceholderWithDefault":const a=getParamValue("default",e,t,n);return[getTensor(e.name,t,n)||a];case"Placeholder":return[getTensor(e.name,t,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":return[cloneTensor(getParamValue("x",e,t,n))];case"IdentityN":return getParamValue("x",e,t,n).map((e=>cloneTensor(e)));case"Snapshot":return[cloneTensor(getParamValue("x",e,t,n))];case"Shape":return[r.tensor1d(getParamValue("x",e,t,n).shape,"int32")];case"ShapeN":return getParamValue("x",e,t,n).map((e=>r.tensor1d(e.shape)));case"Size":return[r.scalar(getParamValue("x",e,t,n).size,"int32")];case"Rank":return[r.scalar(getParamValue("x",e,t,n).rank,"int32")];case"NoOp":return[r.scalar(1)];case"Print":const i=getParamValue("x",e,t,n),s=getParamValue("data",e,t,n),o=getParamValue("message",e,t,n),l=getParamValue("summarize",e,t,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(o);for(let e=0;e<s.length;e++)console.log(Array.prototype.slice.call(s[e].dataSync()).slice(0,l));return[i];default:throw TypeError(`Node type ${e.op} is not implemented`)}};
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
class HashTable{get id(){return this.handle.id}constructor(e,t){this.keyDType=e,this.valueDType=t,this.handle=scalar(0),this.tensorMap=new Map,keep(this.handle)}clearAndClose(){this.tensorMap.forEach((e=>e.dispose())),this.tensorMap.clear(),this.handle.dispose()}size(){return this.tensorMap.size}tensorSize(){return scalar(this.size(),"int32")}async import(e,t){this.checkKeyAndValueTensor(e,t);const n=await e.data();return this.tensorMap.forEach((e=>e.dispose())),this.tensorMap.clear(),tidy((()=>{const e=unstack(t),r=n.length,a=e.length;assert$1(r===a,(()=>`The number of elements doesn't match, keys has ${r} elements, the values has ${a} elements.`));for(let t=0;t<r;t++){const r=n[t],a=e[t];keep(a),this.tensorMap.set(r,a)}return this.handle}))}async find(e,t){this.checkKeyAndValueTensor(e,t);const n=await e.data();return tidy((()=>{const e=[];for(let r=0;r<n.length;r++){const a=n[r],i=this.findWithDefault(a,t);e.push(i)}return stack(e)}))}findWithDefault(e,t){const n=this.tensorMap.get(e);return null!=n?n:t}checkKeyAndValueTensor(e,t){if(e.dtype!==this.keyDType)throw new Error(`Expect key dtype ${this.keyDType}, but got ${e.dtype}`);if(t.dtype!==this.valueDType)throw new Error(`Expect value dtype ${this.valueDType}, but got ${t.dtype}`)}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const executeOp$c=async(e,t,n,r)=>{switch(e.op){case"HashTable":case"HashTableV2":{const a=r.getHashTableHandleByName(e.name);if(null!=a)return[a];{const a=getParamValue("keyDType",e,t,n),i=getParamValue("valueDType",e,t,n),s=new HashTable(a,i);return r.addHashTable(e.name,s),[s.handle]}}case"InitializeTable":case"InitializeTableV2":case"LookupTableImport":case"LookupTableImportV2":{const a=getParamValue("tableHandle",e,t,n,r),i=getParamValue("keys",e,t,n),s=getParamValue("values",e,t,n),o=r.getHashTableById(a.id);return[await o.import(i,s)]}case"LookupTableFind":case"LookupTableFindV2":{const a=getParamValue("tableHandle",e,t,n,r),i=getParamValue("keys",e,t,n),s=getParamValue("defaultValue",e,t,n),o=r.getHashTableById(a.id);return[await o.find(i,s)]}case"LookupTableSize":case"LookupTableSizeV2":{const a=getParamValue("tableHandle",e,t,n,r);return[r.getHashTableById(a.id).tensorSize()]}default:throw TypeError(`Node type ${e.op} is not implemented`)}},executeOp$b=(e,t,n,r=tfOps)=>{switch(e.op){case"ResizeBilinear":{const a=getParamValue("images",e,t,n),i=getParamValue("size",e,t,n),s=getParamValue("alignCorners",e,t,n),o=getParamValue("halfPixelCenters",e,t,n);return[r.image.resizeBilinear(a,[i[0],i[1]],s,o)]}case"ResizeNearestNeighbor":{const a=getParamValue("images",e,t,n),i=getParamValue("size",e,t,n),s=getParamValue("alignCorners",e,t,n),o=getParamValue("halfPixelCenters",e,t,n);return[r.image.resizeNearestNeighbor(a,[i[0],i[1]],s,o)]}case"CropAndResize":{const a=getParamValue("image",e,t,n),i=getParamValue("boxes",e,t,n),s=getParamValue("boxInd",e,t,n),o=getParamValue("cropSize",e,t,n),l=getParamValue("method",e,t,n),u=getParamValue("extrapolationValue",e,t,n);return[r.image.cropAndResize(a,i,s,o,l,u)]}case"ImageProjectiveTransformV3":{const a=getParamValue("images",e,t,n),i=getParamValue("transforms",e,t,n),s=getParamValue("outputShape",e,t,n),o=getParamValue("fillValue",e,t,n),l=getParamValue("interpolation",e,t,n),u=getParamValue("fillMode",e,t,n);return[r.image.transform(a,i,l.toLowerCase(),u.toLowerCase(),o,s)]}default:throw TypeError(`Node type ${e.op} is not implemented`)}},executeOp$a=(e,t,n,r=tfOps)=>{switch(e.op){case"Equal":return[r.equal(getParamValue("a",e,t,n),getParamValue("b",e,t,n))];case"NotEqual":return[r.notEqual(getParamValue("a",e,t,n),getParamValue("b",e,t,n))];case"Greater":return[r.greater(getParamValue("a",e,t,n),getParamValue("b",e,t,n))];case"GreaterEqual":return[r.greaterEqual(getParamValue("a",e,t,n),getParamValue("b",e,t,n))];case"Less":return[r.less(getParamValue("a",e,t,n),getParamValue("b",e,t,n))];case"LessEqual":return[r.lessEqual(getParamValue("a",e,t,n),getParamValue("b",e,t,n))];case"LogicalAnd":return[r.logicalAnd(getParamValue("a",e,t,n),getParamValue("b",e,t,n))];case"LogicalNot":return[r.logicalNot(getParamValue("a",e,t,n))];case"LogicalOr":return[r.logicalOr(getParamValue("a",e,t,n),getParamValue("b",e,t,n))];case"Select":case"SelectV2":return[r.where(getParamValue("condition",e,t,n),getParamValue("a",e,t,n),getParamValue("b",e,t,n))];case"BitwiseAnd":return[r.bitwiseAnd(getParamValue("a",e,t,n),getParamValue("b",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}},executeOp$9=(e,t,n,r=tfOps)=>{switch(e.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[r.matMul(getParamValue("a",e,t,n),getParamValue("b",e,t,n),getParamValue("transposeA",e,t,n),getParamValue("transposeB",e,t,n))];case"Einsum":return[r.einsum(getParamValue("equation",e,t,n),...getParamValue("tensors",e,t,n))];case"Transpose":return[r.transpose(getParamValue("x",e,t,n),getParamValue("perm",e,t,n))];case"_FusedMatMul":const[a,i]=getParamValue("fusedOps",e,t,n),s="biasadd"===a,o="prelu"===i,l=getParamValue("numArgs",e,t,n),u=getParamValue("leakyreluAlpha",e,t,n);if(s){if(o&&2!==l)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!o&&1!==l)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}const[c,h]=getParamValue("args",e,t,n);return[r.fused.matMul({a:getParamValue("a",e,t,n),b:getParamValue("b",e,t,n),transposeA:getParamValue("transposeA",e,t,n),transposeB:getParamValue("transposeB",e,t,n),bias:c,activation:i,preluActivationWeights:h,leakyreluAlpha:u})];case"MatrixBandPart":return[r.linalg.bandPart(getParamValue("a",e,t,n),getParamValue("numLower",e,t,n),getParamValue("numUpper",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}},executeOp$8=(e,t,n,r=tfOps)=>{switch(e.op){case"EuclideanNorm":return[r.euclideanNorm(getParamValue("x",e,t,n),getParamValue("axis",e,t,n),getParamValue("keepDims",e,t,n))];case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[r.batchNorm(getParamValue("x",e,t,n),getParamValue("mean",e,t,n),getParamValue("variance",e,t,n),getParamValue("offset",e,t,n),getParamValue("scale",e,t,n),getParamValue("epsilon",e,t,n))];case"LRN":return[r.localResponseNormalization(getParamValue("x",e,t,n),getParamValue("radius",e,t,n),getParamValue("bias",e,t,n),getParamValue("alpha",e,t,n),getParamValue("beta",e,t,n))];case"Softmax":return[r.softmax(getParamValue("x",e,t,n))];case"LogSoftmax":return[r.logSoftmax(getParamValue("x",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}},executeOp$7=(e,t,n,r=tfOps)=>{switch(e.op){case"RaggedGather":{const{outputNestedSplits:a,outputDenseValues:i}=r.raggedGather(getParamValue("paramsNestedSplits",e,t,n),getParamValue("paramsDenseValues",e,t,n),getParamValue("indices",e,t,n),getParamValue("outputRaggedRank",e,t,n));return a.concat(i)}case"RaggedRange":{const{rtNestedSplits:a,rtDenseValues:i}=r.raggedRange(getParamValue("starts",e,t,n),getParamValue("limits",e,t,n),getParamValue("splits",e,t,n));return[a,i]}case"RaggedTensorToTensor":return[r.raggedTensorToTensor(getParamValue("shape",e,t,n),getParamValue("values",e,t,n),getParamValue("defaultValue",e,t,n),getParamValue("rowPartitionTensors",e,t,n),getParamValue("rowPartitionTypes",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}},executeOp$6=(e,t,n,r=tfOps)=>{switch(e.op){case"Max":{const a=getParamValue("axis",e,t,n),i=getParamValue("keepDims",e,t,n);return[r.max(getParamValue("x",e,t,n),a,i)]}case"Mean":{const a=getParamValue("axis",e,t,n),i=getParamValue("keepDims",e,t,n);return[r.mean(getParamValue("x",e,t,n),a,i)]}case"Min":{const a=getParamValue("axis",e,t,n),i=getParamValue("keepDims",e,t,n);return[r.min(getParamValue("x",e,t,n),a,i)]}case"Sum":{const a=getParamValue("axis",e,t,n),i=getParamValue("keepDims",e,t,n);return[r.sum(getParamValue("x",e,t,n),a,i)]}case"All":{const a=getParamValue("axis",e,t,n),i=getParamValue("keepDims",e,t,n);return[r.all(getParamValue("x",e,t,n),a,i)]}case"Any":{const a=getParamValue("axis",e,t,n),i=getParamValue("keepDims",e,t,n);return[r.any(getParamValue("x",e,t,n),a,i)]}case"ArgMax":{const a=getParamValue("axis",e,t,n);return[r.argMax(getParamValue("x",e,t,n),a)]}case"ArgMin":{const a=getParamValue("axis",e,t,n);return[r.argMin(getParamValue("x",e,t,n),a)]}case"Prod":{const a=getParamValue("axis",e,t,n),i=getParamValue("keepDims",e,t,n);return[r.prod(getParamValue("x",e,t,n),a,i)]}case"Cumprod":{const a=getParamValue("axis",e,t,n),i=getParamValue("exclusive",e,t,n),s=getParamValue("reverse",e,t,n);return[r.cumprod(getParamValue("x",e,t,n),a,i,s)]}case"Cumsum":{const a=getParamValue("axis",e,t,n),i=getParamValue("exclusive",e,t,n),s=getParamValue("reverse",e,t,n);return[r.cumsum(getParamValue("x",e,t,n),a,i,s)]}case"Bincount":const a=getParamValue("x",e,t,n),i=getParamValue("weights",e,t,n),s=getParamValue("size",e,t,n);return[r.bincount(a,i,s)];case"DenseBincount":{const a=getParamValue("x",e,t,n),i=getParamValue("weights",e,t,n),s=getParamValue("size",e,t,n),o=getParamValue("binaryOutput",e,t,n);return[r.denseBincount(a,i,s,o)]}default:throw TypeError(`Node type ${e.op} is not implemented`)}},executeOp$5=(e,t,n,r=tfOps)=>{switch(e.op){case"ConcatV2":case"Concat":{const a=getParamValue("n",e,t,n),i=getParamValue("axis",e,t,n);let s=getParamValue("tensors",e,t,n);return s=s.slice(0,a),[r.concat(s,i)]}case"Gather":{const a=getParamValue("x",e,t,n),i=getParamValue("indices",e,t,n);return[r.gather(a,r.cast(i,"int32"),0)]}case"GatherV2":{const a=getParamValue("axis",e,t,n),i=getParamValue("batchDims",e,t,n),s=getParamValue("x",e,t,n),o=getParamValue("indices",e,t,n);return[r.gather(s,r.cast(o,"int32"),a,i)]}case"Reverse":{const a=getParamValue("dims",e,t,n),i=[];for(let e=0;e<a.length;e++)a[e]&&i.push(e);const s=getParamValue("x",e,t,n);return[r.reverse(s,i)]}case"ReverseV2":{const a=getParamValue("axis",e,t,n),i=getParamValue("x",e,t,n);return[r.reverse(i,a)]}case"Slice":{const a=getParamValue("begin",e,t,n),i=getParamValue("size",e,t,n);return[r.slice(getParamValue("x",e,t,n),a,i)]}case"StridedSlice":{const a=getParamValue("begin",e,t,n),i=getParamValue("end",e,t,n),s=getParamValue("strides",e,t,n),o=getParamValue("beginMask",e,t,n),l=getParamValue("endMask",e,t,n),u=getParamValue("ellipsisMask",e,t,n),c=getParamValue("newAxisMask",e,t,n),h=getParamValue("shrinkAxisMask",e,t,n),d=getParamValue("x",e,t,n);return[r.stridedSlice(d,a,i,s,o,l,u,c,h)]}case"Pack":return tidy((()=>{const a=getParamValue("axis",e,t,n),i=getParamValue("tensors",e,t,n),s=i[0].shape,o=r.squeeze(i[0]).shape,l=i.map((e=>{const t=arraysEqual(e.shape,s);if(!t&&!arraysEqual(r.squeeze(e).shape,o))throw new Error("the input tensors shape does not match");return t?e:r.reshape(e,s)}));return[r.stack(l,a)]}));case"Unpack":{const a=getParamValue("axis",e,t,n),i=getParamValue("tensor",e,t,n);return r.unstack(i,a)}case"Tile":{const a=getParamValue("reps",e,t,n);return[r.tile(getParamValue("x",e,t,n),a)]}case"Split":case"SplitV":{const a=getParamValue("axis",e,t,n),i=getParamValue("numOrSizeSplits",e,t,n),s=getParamValue("x",e,t,n);return r.split(s,i,a)}case"ScatterNd":{const a=getParamValue("indices",e,t,n),i=getParamValue("values",e,t,n),s=getParamValue("shape",e,t,n);return[r.scatterND(a,i,s)]}case"GatherNd":{const a=getParamValue("x",e,t,n),i=getParamValue("indices",e,t,n);return[r.gatherND(a,i)]}case"SparseToDense":{const a=getParamValue("sparseIndices",e,t,n),i=getParamValue("outputShape",e,t,n),s=getParamValue("sparseValues",e,t,n),o=getParamValue("defaultValue",e,t,n);return[r.sparseToDense(a,s,i,s.dtype===o.dtype?o:r.cast(o,s.dtype))]}case"TensorScatterUpdate":{const a=getParamValue("indices",e,t,n),i=getParamValue("values",e,t,n),s=getParamValue("tensor",e,t,n);return[r.tensorScatterUpdate(s,a,i)]}default:throw TypeError(`Node type ${e.op} is not implemented`)}},executeOp$4=(e,t,n,r=tfOps)=>{switch(e.op){case"SparseFillEmptyRows":{const{outputIndices:a,outputValues:i,emptyRowIndicator:s,reverseIndexMap:o}=r.sparse.sparseFillEmptyRows(getParamValue("indices",e,t,n),getParamValue("values",e,t,n),getParamValue("denseShape",e,t,n),getParamValue("defaultValue",e,t,n));return[a,i,s,o]}case"SparseReshape":{const{outputIndices:a,outputShape:i}=r.sparse.sparseReshape(getParamValue("inputIndices",e,t,n),getParamValue("inputShape",e,t,n),getParamValue("newShape",e,t,n));return[a,i]}case"SparseSegmentMean":return[r.sparse.sparseSegmentMean(getParamValue("data",e,t,n),getParamValue("indices",e,t,n),getParamValue("segmentIds",e,t,n))];case"SparseSegmentSum":return[r.sparse.sparseSegmentSum(getParamValue("data",e,t,n),getParamValue("indices",e,t,n),getParamValue("segmentIds",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}},executeOp$3=(e,t,n,r=tfOps)=>{switch(e.op){case"FFT":return[r.fft(getParamValue("x",e,t,n))];case"IFFT":return[r.ifft(getParamValue("x",e,t,n))];case"RFFT":return[r.rfft(getParamValue("x",e,t,n))];case"IRFFT":return[r.irfft(getParamValue("x",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}},executeOp$2=(e,t,n,r=tfOps)=>{switch(e.op){case"StaticRegexReplace":return[r.string.staticRegexReplace(getParamValue("input",e,t,n),getParamValue("pattern",e,t,n),getParamValue("rewrite",e,t,n),getParamValue("replaceGlobal",e,t,n))];case"StringNGrams":{const{nGrams:a,nGramsSplits:i}=r.string.stringNGrams(getParamValue("data",e,t,n),getParamValue("dataSplits",e,t,n),getParamValue("separator",e,t,n),getParamValue("nGramWidths",e,t,n),getParamValue("leftPad",e,t,n),getParamValue("rightPad",e,t,n),getParamValue("padWidth",e,t,n),getParamValue("preserveShortSequences",e,t,n));return[a,i]}case"StringSplit":{const{indices:a,values:i,shape:s}=r.string.stringSplit(getParamValue("input",e,t,n),getParamValue("delimiter",e,t,n),getParamValue("skipEmpty",e,t,n));return[a,i,s]}case"StringToHashBucketFast":return[r.string.stringToHashBucketFast(getParamValue("input",e,t,n),getParamValue("numBuckets",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}},executeOp$1=(e,t,n,r=tfOps)=>{switch(e.op){case"Cast":return[r.cast(getParamValue("x",e,t,n),getParamValue("dtype",e,t,n))];case"ExpandDims":{const a=getParamValue("axis",e,t,n);return[r.expandDims(getParamValue("x",e,t,n),a)]}case"Squeeze":{const a=getParamValue("axis",e,t,n);return[r.squeeze(getParamValue("x",e,t,n),a)]}case"Reshape":return[r.reshape(getParamValue("x",e,t,n),getParamValue("shape",e,t,n))];case"EnsureShape":return[r.ensureShape(getParamValue("x",e,t,n),getParamValue("shape",e,t,n))];case"MirrorPad":return[r.mirrorPad(getParamValue("x",e,t,n),getParamValue("padding",e,t,n),getParamValue("mode",e,t,n))];case"PadV2":case"Pad":return[r.pad(getParamValue("x",e,t,n),getParamValue("padding",e,t,n),getParamValue("constantValue",e,t,n))];case"SpaceToBatchND":{const a=getParamValue("blockShape",e,t,n),i=getParamValue("paddings",e,t,n);return[r.spaceToBatchND(getParamValue("x",e,t,n),a,i)]}case"BatchToSpaceND":{const a=getParamValue("blockShape",e,t,n),i=getParamValue("crops",e,t,n);return[r.batchToSpaceND(getParamValue("x",e,t,n),a,i)]}case"DepthToSpace":{const a=getParamValue("blockSize",e,t,n),i=getParamValue("dataFormat",e,t,n).toUpperCase();return[r.depthToSpace(getParamValue("x",e,t,n),a,i)]}case"BroadcastTo":return[r.broadcastTo(getParamValue("x",e,t,n),getParamValue("shape",e,t,n))];case"BroadcastArgs":return[r.broadcastArgs(getParamValue("s0",e,t,n),getParamValue("s1",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}};
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function executeOp(e,t,n,r,a=tidy){const i=((e,t,n)=>{switch(e.category){case"arithmetic":return a((()=>executeOp$k(e,t,n)));case"basic_math":return a((()=>executeOp$j(e,t,n)));case"control":return executeOp$i(e,t,n);case"convolution":return a((()=>executeOp$h(e,t,n)));case"creation":return a((()=>executeOp$g(e,t,n)));case"dynamic":return executeOp$f(e,t,n);case"evaluation":return a((()=>executeOp$e(e,t,n)));case"image":return a((()=>executeOp$b(e,t,n)));case"graph":return a((()=>executeOp$d(e,t,n)));case"logical":return a((()=>executeOp$a(e,t,n)));case"matrices":return a((()=>executeOp$9(e,t,n)));case"normalization":return a((()=>executeOp$8(e,t,n)));case"ragged":return a((()=>executeOp$7(e,t,n)));case"reduction":return a((()=>executeOp$6(e,t,n)));case"slice_join":return a((()=>executeOp$5(e,t,n)));case"sparse":return a((()=>executeOp$4(e,t,n)));case"spectral":return a((()=>executeOp$3(e,t,n)));case"string":return a((()=>executeOp$2(e,t,n)));case"transformation":return a((()=>executeOp$1(e,t,n)));case"hash_table":return executeOp$c(e,t,n,r);case"custom":const i=getRegisteredOp(e.op);if(i&&i.customExecutor)return i.customExecutor(new NodeValueImpl(e,t,n));throw TypeError(`Custom op ${e.op} is not registered.`);default:throw TypeError(`Unknown op '${e.op}'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()`)}})(e,t,n);return isPromise$1(i)?i.then((e=>[].concat(e))):[].concat(i)}class ExecutionContext{constructor(e={},t={},n={},r={},a){this.weightMap=e,this.tensorArrayMap=t,this.tensorListMap=n,this.functionMap=r,this.parseNodeNameCache=a,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}newFrame(e,t){return{id:e,frameName:t,iterationId:0}}set currentContext(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())}get currentContext(){return this.contexts}get currentContextId(){return this._currentContextIds[0]}get currentContextIds(){return this._currentContextIds}generateCurrentContextIds(){const e=[];for(let t=0;t<this.contexts.length-1;t++){const n=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(n))}e.push(""),this._currentContextIds=e}contextIdforContexts(e){return e?e.map((e=>0===e.id&&0===e.iterationId?"":`${e.frameName}-${e.iterationId}`)).join("/"):""}enterFrame(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}exitFrame(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()}nextIteration(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");{this.contexts=this.contexts.slice(),this.lastId++;const e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}}getWeight(e){return this.weightMap[e]}addTensorArray(e){this.tensorArrayMap[e.id]=e}getTensorArray(e){return this.tensorArrayMap[e]}addTensorList(e){this.tensorListMap[e.id]=e}getTensorList(e){return this.tensorListMap[e]}dispose(e){for(const t in this.tensorArrayMap)this.tensorArrayMap[t].clearAndClose(e);for(const t in this.tensorListMap)this.tensorListMap[t].clearAndClose(e)}}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function getExecutionSubgraph(e,t,n,r){const a=new Set,i=[];let s=null,o=null;const l=new Set,u=new Set(Object.keys(e).map((e=>parseNodeName(e)[0])));r=r||[];const c=new Set(r.map((e=>parseNodeName(e.name)[0]))),h=[...t];for(;h.length>0;){const e=h.pop();(isControlFlow(e)||isDynamicShape(e)||isHashTable(e))&&null==s&&(s=e,o=s.children.map((e=>e.name)).filter((e=>a.has(e)))),a.add(e.name),null==n[e.name]&&(u.has(e.name)||c.has(e.name)||(0!==e.inputs.length?e.inputs.forEach((e=>{l.has(e.name)||(l.add(e.name),h.push(e))})):i.push(e.name)))}return{inputs:e,outputs:t,usedNodes:a,missingInputs:i,dynamicNode:s,syncInputs:o}}function getNodesInTopologicalOrder(e,t){const{usedNodes:n,inputs:r}=t,a=Object.keys(r).map((e=>parseNodeName(e)[0])).map((t=>e.nodes[t])),i=e.initNodes||[],s=e=>n.has("string"==typeof e?e:e.name);function o(e){return[...new Map(e.map((e=>[e.name,e]))).values()]}const l=o([...a,...e.weights,...i]).filter(s),u=o([...l,...Object.values(e.nodes)]).filter(s),c=new Map(u.map((e=>[e.name,e]))),h={};for(const m of u){h[m.name]=h[m.name]||0;for(const e of m.children)s(e)||(h[e.name]=Number.POSITIVE_INFINITY),h[e.name]=(h[e.name]||0)+1}const d=Object.entries(h).filter((([,e])=>0===e)).map((([e])=>e)),p=[...d];for(;d.length>0;){const e=d.pop(),t=c.get(e);for(const n of t.children.filter(s))0==--h[n.name]&&(p.push(n.name),d.push(n.name))}const f=filterPredefinedReachableNodes(p.map((e=>c.get(e))),l);return validateNodesExecutionOrder(f,l),f}function filterPredefinedReachableNodes(e,t){const n=new Map(e.map((e=>[e.name,e]))),r=t.map((e=>e.name)),a=new Set(r);for(;r.length>0;){const e=r.pop(),t=n.get(e);for(const i of t.children)n.has(i.name)&&!a.has(i.name)&&(a.add(i.name),r.push(i.name))}return e.filter((e=>a.has(e.name)))}class NodesExecutionOrderError extends Error{constructor(e){super(`NodesExecutionOrderError: ${e}`)}}function validateNodesExecutionOrder(e,t){const n=new Map(e.map(((e,t)=>[e.name,t]))),r=new Set(t.map((e=>e.name))),a=e=>r.has("string"==typeof e?e:e.name),i=new Set(e.map((e=>e.name))),s=e=>i.has("string"==typeof e?e:e.name);for(const o of e){for(const e of o.children.filter(s)){if(!n.has(e.name))throw new NodesExecutionOrderError(`Child ${e.name} of node ${o.name} is unreachable.`);if(n.get(o.name)>n.get(e.name))throw new NodesExecutionOrderError(`Node ${o.name} is scheduled to run after its child ${e.name}.`)}if(!a(o))for(const e of o.inputs){if(!n.has(e.name))throw new NodesExecutionOrderError(`Input ${e.name} of node ${o.name} is unreachable.`);if(n.get(e.name)>n.get(o.name))throw new NodesExecutionOrderError(`Node ${o.name} is scheduled to run before its input ${e.name}.`)}}}function getNodeLiveUntilMap(e){const t=new Map(e.map(((e,t)=>[e.name,t]))),n=Number.MAX_SAFE_INTEGER,r=e.map(((e,t)=>isControlFlow(e)?n:t)),a=e=>{const n=r[t.get(e.name)];return null==n?-1:n},i=e.map(((e,t)=>e.children.map(a).reduce(((e,t)=>Math.max(e,t)),r[t]))),s=new Map;for(let o=0;o<e.length;++o){const t=i[o];if(t===n)continue;const r=e[o],a=e[t];s.has(a.name)||s.set(a.name,[]),s.get(a.name).push(r)}return s}const CONTROL_FLOW_OPS=new Set(["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"]),DYNAMIC_SHAPE_OPS=new Set(["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"]),HASH_TABLE_OPS=new Set(["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"]);function isControlFlow(e){return CONTROL_FLOW_OPS.has(e.op)}function isDynamicShape(e){return DYNAMIC_SHAPE_OPS.has(e.op)}function isHashTable(e){return HASH_TABLE_OPS.has(e.op)}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class GraphExecutor{get weightIds(){return this.parent?this.parent.weightIds:this._weightIds}get functionExecutorMap(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}get weightMap(){return this.parent?this.parent.weightMap:this._weightMap}set weightMap(e){const t=Object.keys(e).map((t=>e[t].map((e=>e.id))));this._weightIds=[].concat(...t),this._weightMap=e}set resourceManager(e){this._resourceManager=e}get inputs(){return this._inputs.map((e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0})))}get outputs(){return this._outputs.map((e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0})))}get inputNodes(){return this._inputs.map((e=>e.signatureKey||e.name))}get outputNodes(){return this._outputs.map((e=>{const t=e.signatureKey||e.name;return e.defaultOutput?`${t}:${e.defaultOutput}`:t}))}get functions(){return Object.keys(this._functions).reduce(((e,t)=>(e[t]=this._functions[t].signature,e)),{})}constructor(e,t){this.graph=e,this.parent=t,this.compiledMap=new Map,this.parseNodeNameCache=new Map,this._weightMap={},this.SEPARATOR=",",this._functions={},this._functionExecutorMap={},this.keepIntermediateTensors=!1,this._outputs=e.outputs,this._inputs=e.inputs,this._initNodes=e.initNodes,this._signature=e.signature,this._functions=e.functions,null!=e.functions&&Object.keys(e.functions).forEach((t=>{this._functionExecutorMap[t]=new GraphExecutor(e.functions[t],this)}))}getCompilationKey(e,t){const n=e.map((e=>e.name)).sort(),r=t.map((e=>e.name)).sort();return n.join(this.SEPARATOR)+"--"+r.join(this.SEPARATOR)}compile(e,t){const n=getExecutionSubgraph(e,t,this.weightMap,this._initNodes),{missingInputs:r,dynamicNode:a,syncInputs:i}=n;if(null!=a)throw new Error(`This execution contains the node '${a.name}', which has the dynamic op '${a.op}'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [${i}]`);if(r.length>0){const n=t.map((e=>e.name)),a=Object.keys(e);throw new Error(`Cannot compute the outputs [${n}] from the provided inputs [${a}]. Missing the following inputs: [${r}]`)}const s=getNodesInTopologicalOrder(this.graph,n);return{orderedNodes:s,nodeLiveUntilMap:getNodeLiveUntilMap(s)}}cloneAndKeepTensor(e){if(null==e)return null;const t=e.clone();return keep(t),t}cloneTensorList(e){if(!e)return null;return e.map((e=>this.cloneAndKeepTensor(e)))}cloneTensorMap(e){return Object.fromEntries(Object.entries(e).map((([e,t])=>[e,this.cloneTensorList(t)])))}execute(e,t){this.disposeIntermediateTensors(),e=this.mapInputs(e);const n=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t);const r=n.map((e=>this.graph.nodes[parseNodeName(e)[0]])),a=t.map((e=>parseNodeName(e)[0])),i=new Set(a);let s=a.map((e=>this.graph.nodes[e]));0===s.length&&(s=this._outputs);const o=this.getCompilationKey(r,s);let l=this.compiledMap.get(o);null==l&&(l=this.compile(e,s),this.compiledMap.set(o,l));try{this.keepIntermediateTensors=env().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(e2){this.keepIntermediateTensors=!1,console.warn(e2.message)}const u={},c={};return tidy((()=>{const n=new ExecutionContext(this.weightMap,u,c,this.functionExecutorMap,this.parseNodeNameCache),r=Object.assign({},this.weightMap);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap)),Object.keys(e).forEach((t=>{const[a,i]=parseNodeName(t,n),s=[];s[i]=e[t],r[a]=s,this.keepIntermediateTensors&&(this.clonedTensorsMap[a]=this.cloneTensorList(s))}));const a=this.getFrozenTensorIds(r),{orderedNodes:s,nodeLiveUntilMap:o}=l;for(const e of s){if(r[e.name])continue;const t=executeOp(e,r,n,this._resourceManager);if(isPromise$1(t))throw new Error(`The execution of the op '${e.op}' returned a promise. Please use model.executeAsync() instead.`);r[e.name]=t,this.keepIntermediateTensors&&(this.clonedTensorsMap[e.name]=this.cloneTensorList(t)),this.checkTensorForDisposalWithNodeLiveUntilInfo(e,r,n,a,i,o.get(e.name))}return null==this.parent&&n.dispose(a),t.map((e=>getTensor(e,r,n)))}))}getFrozenTensorIds(e){const t=[].concat.apply([],Object.keys(e).map((t=>e[t])).map((e=>e.map((e=>e.id)))));return new Set(t)}checkTensorForDisposal(e,t,n,r,a,i,s){if(!isControlFlow(t)&&!i.has(e)){for(const r of n[e])null!=r&&(s[r.id]=(s[r.id]||0)+t.children.length);for(const e of t.inputs){if(isControlFlow(e))continue;const t=getTensorsForCurrentContext(e.name,n,r);if(null!=t)for(const e of t){if(!e||e.kept||a.has(e.id))continue;const t=s[e.id];1===t?(e.dispose(),delete s[e.id]):null!=t&&s[e.id]--}}}}checkTensorForDisposalWithNodeLiveUntilInfo(e,t,n,r,a,i){var s;if(!isControlFlow(e)&&null!=i)for(const o of i){if(isControlFlow(s=o)||a.has(s.name))continue;const e=getTensorsForCurrentContext(o.name,t,n);for(const t of e)!t||t.kept||r.has(t.id)||t.dispose()}}async executeAsync(e,t){return this._executeAsync(e,t)}disposeIntermediateTensors(){this.clonedTensorsMap&&(Object.values(this.clonedTensorsMap).forEach((e=>{for(const t of e)t&&!t.isDisposed&&t.dispose()})),this.clonedTensorsMap=null)}getIntermediateTensors(){return this.clonedTensorsMap}async _executeAsync(e,t,n=!1,r={},a={}){this.disposeIntermediateTensors(),n||(e=this.mapInputs(e),this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t));try{this.keepIntermediateTensors=env().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(e2){this.keepIntermediateTensors=!1,console.warn(e2.message)}const i=new ExecutionContext(this.weightMap,r,a,this.functionExecutorMap,this.parseNodeNameCache);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap));const s=await this.executeWithControlFlow(e,i,t,n),o=t.map((e=>getTensor(e,s,i))),l=o.map((e=>e.id)),u=Object.keys(e).map((t=>e[t].id)),c=new Set([...l,...u,...this.weightIds]);return Object.values(s).forEach((e=>{e.forEach((e=>{!e||e.isDisposed||c.has(e.id)||e.dispose()}))})),null==this.parent&&i.dispose(c),o}async executeFunctionAsync(e,t,n){const r=e.reduce(((e,t,n)=>(e[this.inputs[n].name]=t,e)),{});return this._executeAsync(r,this.outputNodes,!0,t,n)}async executeWithControlFlow(e,t,n,r){const a=Object.keys(e),i=a.map((e=>this.graph.nodes[parseNodeName(e)[0]])),s=n.map((e=>parseNodeName(e)[0])),o=new Set(s);let l=s.map((e=>this.graph.nodes[e]));0===l.length&&(l=this._outputs);const{usedNodes:u,missingInputs:c,dynamicNode:h,syncInputs:d}=getExecutionSubgraph(e,l,this.weightMap,this._initNodes),p=[...i,...this.graph.weights,...this._initNodes||[]].map((e=>({node:e,contexts:t.currentContext}))),f=Object.assign({},this.weightMap);Object.keys(e).forEach((t=>{const[n,r]=parseNodeName(t),a=[];a[r]=e[t],f[n]=a}));const m={},g=this.getFrozenTensorIds(f),y={};for(;p.length>0;){const e=this.processStack(i,p,t,f,y,g,o,m,u);await Promise.all(e)}null!=h||r||console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead.");const v=l.filter((e=>!isControlFlow(e)&&!getTensor(e.name,f,t))).map((e=>e.name));if(v.length>0){let e="";throw null!=h&&(e=`Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [${d}]`),new Error(`Cannot compute the outputs [${v}] from the provided inputs [${a}]. Consider providing the following inputs: [${c}]. ${e}`)}return f}processStack(e,t,n,r,a,i,s,o,l){const u=[];for(;t.length>0;){const e=t.pop();n.currentContext=e.contexts;let c="";if("Enter"===e.node.op&&getParamValue("isConstant",e.node,r,n)&&([c]=getNodeNameAndIndex(e.node.name,n)),null==r[e.node.name]){const h=executeOp(e.node,r,n,this._resourceManager);c||([c]=getNodeNameAndIndex(e.node.name,n));const d=n.currentContext;isPromise$1(h)?u.push(h.then((u=>(r[c]=u,this.keepIntermediateTensors&&(this.clonedTensorsMap[c]=this.cloneTensorList(u)),n.currentContext=d,this.checkTensorForDisposal(c,e.node,r,n,i,s,o),this.processChildNodes(e.node,t,n,r,a,l),u)))):(r[c]=h,this.keepIntermediateTensors&&(this.clonedTensorsMap[c]=this.cloneTensorList(h)),this.checkTensorForDisposal(c,e.node,r,n,i,s,o),this.processChildNodes(e.node,t,n,r,a,l))}else this.processChildNodes(e.node,t,n,r,a,l)}return u}processChildNodes(e,t,n,r,a,i){e.children.forEach((e=>{const[s]=getNodeNameAndIndex(e.name,n);!a[s]&&i.has(e.name)&&("Merge"===e.op?e.inputNames.some((e=>!!getTensor(e,r,n)))&&(a[s]=!0,t.push({contexts:n.currentContext,node:e})):e.inputNames.every((e=>!!getTensor(e,r,n)))&&(a[s]=!0,t.push({contexts:n.currentContext,node:e})))}))}dispose(){Object.keys(this.weightMap).forEach((e=>this.weightMap[e].forEach((e=>e.dispose()))))}checkInputShapeAndType(e){Object.keys(e).forEach((t=>{const n=e[t],[r]=parseNodeName(t),a=this.graph.nodes[r];if(a.attrParams.shape&&a.attrParams.shape.value){const e=a.attrParams.shape.value;assert$1(e.length===n.shape.length&&n.shape.every(((t,n)=>-1===e[n]||e[n]===t)),(()=>`The shape of dict['${a.name}'] provided in model.execute(dict) must be [${e}], but was [${n.shape}]`))}a.attrParams.dtype&&a.attrParams.dtype.value&&assert$1(n.dtype===a.attrParams.dtype.value,(()=>`The dtype of dict['${a.name}'] provided in model.execute(dict) must be ${a.attrParams.dtype.value}, but was ${n.dtype}`))}))}mapInputs(e){var t,n;const r={};for(const a in e){const i=null===(n=null===(t=this._signature)||void 0===t?void 0:t.inputs)||void 0===n?void 0:n[a];null!=i?r[i.name]=e[a]:r[a]=e[a]}return r}checkInputs(e){const t=Object.keys(e).filter((e=>{const[t]=parseNodeName(e);return null==this.graph.nodes[t]}));if(t.length>0)throw new Error(`The dict provided in model.execute(dict) has keys: [${t}] that are not part of graph`)}mapOutputs(e){return e.map((e=>{var t,n;const r=null===(n=null===(t=this._signature)||void 0===t?void 0:t.outputs)||void 0===n?void 0:n[e];return null!=r?r.name:e}),{})}checkOutputs(e){e.forEach((e=>{const[t]=parseNodeName(e);if(!this.graph.nodes[t])throw new Error(`The output '${e}' is not found in the graph`)}))}}class ResourceManager{constructor(e={},t={}){this.hashTableNameToHandle=e,this.hashTableMap=t}addHashTable(e,t){this.hashTableNameToHandle[e]=t.handle,this.hashTableMap[t.id]=t}getHashTableHandleByName(e){return this.hashTableNameToHandle[e]}getHashTableById(e){return this.hashTableMap[e]}dispose(){for(const e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(const e in this.hashTableNameToHandle)this.hashTableNameToHandle[e].dispose(),delete this.hashTableNameToHandle[e]}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const TFHUB_SEARCH_PARAM="?tfjs-format=file",DEFAULT_MODEL_NAME="model.json";class GraphModel{get modelVersion(){return this.version}get inputNodes(){return this.executor.inputNodes}get outputNodes(){return this.executor.outputNodes}get inputs(){return this.executor.inputs}get outputs(){return this.executor.outputs}get weights(){return this.executor.weightMap}get metadata(){return this.artifacts.userDefinedMetadata}get modelSignature(){return this.signature}get modelStructuredOutputKeys(){return this.structuredOutputKeys}constructor(e,t={},n=io){this.modelUrl=e,this.loadOptions=t,this.version="n/a",this.io=n,null==t&&(this.loadOptions={}),this.resourceManager=new ResourceManager}findIOHandler(){const e=this.modelUrl;if(null!=e.load)this.handler=e;else if(null!=this.loadOptions.requestInit)this.handler=this.io.browserHTTPRequest(e,this.loadOptions);else{const t=this.io.getLoadHandlers(e,this.loadOptions);if(0===t.length)t.push(this.io.browserHTTPRequest(e,this.loadOptions));else if(t.length>1)throw new Error(`Found more than one (${t.length}) load handlers for URL '${[e]}'`);this.handler=t[0]}}load(){if(this.findIOHandler(),null==this.handler.load)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const e=this.handler.load();return isPromise$1(e)?e.then((e=>this.loadSync(e))):this.loadSync(e)}loadSync(e){this.artifacts=e;const t=this.artifacts.modelTopology;let n=this.artifacts.signature;if(null!=this.artifacts.userDefinedMetadata){const e=this.artifacts.userDefinedMetadata;null!=e.signature&&(n=e.signature),null!=e.structuredOutputKeys&&(this.structuredOutputKeys=e.structuredOutputKeys)}this.signature=n,this.version=`${t.versions.producer}.${t.versions.minConsumer}`;const r=this.io.decodeWeights(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new GraphExecutor(OperationMapper.Instance.transformGraph(t,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(r),this.executor.resourceManager=this.resourceManager,null!=e.modelInitializer&&null!=e.modelInitializer.node){const t=OperationMapper.Instance.transformGraph(e.modelInitializer);this.initializer=new GraphExecutor(t),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializerSignature=e.initializerSignature}return!0}async save(e,t){if("string"==typeof e){const t=this.io.getSaveHandlers(e);if(0===t.length)throw new Error(`Cannot find any save handlers for URL '${e}'`);if(t.length>1)throw new Error(`Found more than one (${t.length}) save handlers for URL '${e}'`);e=t[0]}if(null==e.save)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return e.save(this.artifacts)}addStructuredOutputNames(e){if(this.structuredOutputKeys){const t={};return(e instanceof Tensor?[e]:e).forEach(((e,n)=>t[this.structuredOutputKeys[n]]=e)),t}return e}predict(e,t){const n=this.execute(e,this.outputNodes);return this.addStructuredOutputNames(n)}async predictAsync(e,t){const n=await this.executeAsync(e,this.outputNodes);return this.addStructuredOutputNames(n)}normalizeInputs(e){var t;if(!(e instanceof Tensor||Array.isArray(e))){const n=null===(t=this.signature)||void 0===t?void 0:t.inputs;if(null!=n)for(const t in n){const r=n[t];null!=r.resourceId&&(e[t]=this.resourceIdToCapturedInput[r.resourceId])}return e}e=Array.isArray(e)?e:[e];const n=Object.keys(this.resourceIdToCapturedInput).length;if(e.length+n!==this.inputNodes.length)throw new Error(`Input tensor count mismatch, the graph model has ${this.inputNodes.length-n} non-resource placeholders, while there are ${e.length} input tensors provided.`);let r=0;return this.inputNodes.reduce(((t,n)=>{var a,i,s;const o=null===(s=null===(i=null===(a=this.signature)||void 0===a?void 0:a.inputs)||void 0===i?void 0:i[n])||void 0===s?void 0:s.resourceId;return t[n]=null!=o?this.resourceIdToCapturedInput[o]:e[r++],t}),{})}normalizeOutputs(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]}executeInitializerGraph(){return null==this.initializer?[]:null==this.initializerSignature?this.initializer.execute({},[]):this.initializer.execute({},Object.keys(this.initializerSignature.outputs))}async executeInitializerGraphAsync(){return null==this.initializer?[]:null==this.initializerSignature?this.initializer.executeAsync({},[]):this.initializer.executeAsync({},Object.keys(this.initializerSignature.outputs))}setResourceIdToCapturedInput(e){if(this.resourceIdToCapturedInput={},this.initializerSignature){const t=this.initializerSignature.outputs,n=Object.keys(t);for(let r=0;r<n.length;r++){const a=t[n[r]];this.resourceIdToCapturedInput[a.resourceId]=e[r]}}}execute(e,t){null==this.resourceIdToCapturedInput&&this.setResourceIdToCapturedInput(this.executeInitializerGraph()),e=this.normalizeInputs(e),t=this.normalizeOutputs(t);const n=this.executor.execute(e,t);return n.length>1?n:n[0]}async executeAsync(e,t){null==this.resourceIdToCapturedInput&&this.setResourceIdToCapturedInput(await this.executeInitializerGraphAsync()),e=this.normalizeInputs(e),t=this.normalizeOutputs(t);const n=await this.executor.executeAsync(e,t);return n.length>1?n:n[0]}getIntermediateTensors(){return this.executor.getIntermediateTensors()}disposeIntermediateTensors(){this.executor.disposeIntermediateTensors()}convertTensorMapToTensorsMap(e){return Object.keys(e).reduce(((t,n)=>(t[n]=[e[n]],t)),{})}dispose(){this.executor.dispose(),this.initializer&&(this.initializer.dispose(),this.resourceIdToCapturedInput&&dispose(this.resourceIdToCapturedInput)),this.resourceManager.dispose()}}async function loadGraphModel(e,t={},n=io){if(null==e)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");null==t&&(t={}),t.fromTFHub&&"string"==typeof e&&(e=getTFHubUrl(e));const r=new GraphModel(e,t,n);return await r.load(),r}function getTFHubUrl(e){return e.endsWith("/")||(e+="/"),`${e}${DEFAULT_MODEL_NAME}${TFHUB_SEARCH_PARAM}`}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     *
     * =============================================================================
     */var ZipMismatchMode,ZipMismatchMode2;
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function assertNotComplex$1(e,t){Array.isArray(e)||(e=[e]),e.forEach((e=>{null!=e&&assert$1("complex64"!==e.dtype,(()=>`${t} does not support complex64 tensors in the CPU backend.`))}))}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */ZipMismatchMode2=ZipMismatchMode||(ZipMismatchMode={}),ZipMismatchMode2[ZipMismatchMode2.FAIL=0]="FAIL",ZipMismatchMode2[ZipMismatchMode2.SHORTEST=1]="SHORTEST",ZipMismatchMode2[ZipMismatchMode2.LONGEST=2]="LONGEST";const whereImpl$1=whereImpl$2;class MathBackendCPU extends KernelBackend{nextDataId(){return MathBackendCPU.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new DataStorage(this,engine())}write(e,t,n){this.firstUse&&(this.firstUse=!1,env().get("IS_NODE")&&warn("\n============================\nHi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. \n============================"));const r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:n,refCount:1}),r}makeTensorInfo(e,t,n){let r;if("string"===t&&null!=n&&n.length>0&&isString(n[0])){const a=n.map((e=>encodeString(e)));r=this.write(a,e,t)}else r=this.write(n,e,t);return{dataId:r,shape:e,dtype:t}}refCount(e){if(this.data.has(e)){return this.data.get(e).refCount}return 0}incRef(e){this.data.get(e).refCount++}decRef(e){if(this.data.has(e)){this.data.get(e).refCount--}}move(e,t,n,r,a){this.data.set(e,{values:t,dtype:r,refCount:a})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:t,complexTensorInfos:n}=this.data.get(e);if("complex64"===t){return mergeRealAndImagArrays(this.readSync(n.real.dataId),this.readSync(n.imag.dataId))}return convertBackendValuesAndArrayBuffer(this.data.get(e).values,t)}bufferSync(e){const t=this.readSync(e.dataId);if("string"===e.dtype)try{const n=t.map((e=>decodeString(e)));return buffer(e.shape,e.dtype,n)}catch(n){throw new Error("Failed to decode encoded string bytes into utf-8")}return buffer(e.shape,e.dtype,t)}makeOutput(e,t,n){return engine().makeTensorFromTensorInfo(this.makeTensorInfo(t,n,e),this)}disposeData(e,t=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:n}=this.data.get(e);null!=n&&(this.disposeData(n.real.dataId,!0),this.disposeData(n.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const t=now();e();return{kernelMs:now()-t}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){assertNotComplex$1([e],"where");const t=this.readSync(e.dataId);return whereImpl$1(e.shape,t)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the License);
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an AS IS BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function simpleAbsImpl(e){const t=new Float32Array(e.length);for(let n=0;n<e.length;++n)t[n]=Math.abs(e[n]);return t}MathBackendCPU.nextDataId=0;const abs$1=e=>{const{x:t}=e.inputs,n=e.backend;assertNotComplex$1(t,"abs");let r=new Float32Array(sizeFromShape(t.shape));return r=simpleAbsImpl(n.data.get(t.dataId).values),n.makeOutput(r,t.shape,t.dtype)},absConfig$1={kernelName:Abs,backendName:"cpu",kernelFunc:abs$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function createSimpleBinaryKernelImpl(e){return(t,n,r,a,i)=>{const s=assertAndGetBroadcastShape(t,n),o=s.length,l=computeStrides(s),u=getTypedArrayFromDType(i,sizeFromShape(s)),c=t.length,h=n.length,d=computeStrides(t),p=computeStrides(n),f=getBroadcastDims$1(t,s),m=getBroadcastDims$1(n,s);if(f.length+m.length===0)for(let g=0;g<u.length;++g)u[g]=e(r[g%r.length],a[g%a.length]);else for(let g=0;g<u.length;++g){const t=indexToLoc(g,o,l),n=t.slice(-c);f.forEach((e=>n[e]=0));const i=locToIndex(n,c,d),s=t.slice(-h);m.forEach((e=>s[e]=0));const y=locToIndex(s,h,p);u[g]=e(r[i],a[y])}return[u,s]}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function complex$1(e){const{inputs:t,backend:n}=e,{real:r,imag:a}=t,i=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,o=n.makeTensorInfo(r.shape,"complex64");return n.data.get(o.dataId).complexTensorInfos={real:n.makeTensorInfo(r.shape,"float32",i),imag:n.makeTensorInfo(a.shape,"float32",s)},o}const complexConfig$1={kernelName:Complex,backendName:"cpu",kernelFunc:complex$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function zeros(e,t,n="float32"){if("complex64"===n){return complex$1({inputs:{real:zeros(e,t,"float32"),imag:zeros(e,t,"float32")},backend:e})}const r=makeZerosTypedArray(sizeFromShape(t),n);return e.makeTensorInfo(t,n,r)}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function identity$1(e){const{inputs:t,backend:n}=e,{x:r}=t;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const identityConfig$1={kernelName:Identity$1,backendName:"cpu",kernelFunc:identity$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function real$1(e){const{inputs:t,backend:n}=e,{input:r}=t,a=n.data.get(r.dataId).complexTensorInfos.real,i=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,i)}const realConfig$1={kernelName:Real,backendName:"cpu",kernelFunc:real$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function castImpl(e,t,n,r){if("int32"===r){return[t,"int32",Int32Array.from(e)]}if("bool"===r){const r=toTypedArray([0],n),[a,i]=createSimpleBinaryKernelImpl(((e,t)=>e!==t?1:0))(t,[],e,r,"bool");return[i,"bool",a]}throw new Error(`Error in Cast: failed to cast ${n} to ${r}`)}function cast$1(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{dtype:i}=r;if("complex64"===i){if("complex64"===a.dtype)return identity$1({inputs:{x:a},backend:n});const e=zeros(n,a.shape,a.dtype),t=cast$1({inputs:{x:a},backend:n,attrs:{dtype:"float32"}}),r=complex$1({inputs:{real:t,imag:e},backend:n});return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),r}if("complex64"===a.dtype){const e=real$1({inputs:{input:a},backend:n}),t=cast$1({inputs:{x:e},backend:n,attrs:{dtype:i}});return n.disposeIntermediateTensorInfo(e),t}if(!hasEncodingLoss(a.dtype,i)){const e=identity$1({inputs:{x:a},backend:n});return{dataId:e.dataId,shape:e.shape,dtype:i}}const s=n.data.get(a.dataId).values,[o,l,u]=castImpl(s,a.shape,a.dtype,i);return n.makeTensorInfo(o,l,u)}const castConfig$1={kernelName:Cast,backendName:"cpu",kernelFunc:cast$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function binaryKernelFunc$1(e,t,n,r){return null==n?({inputs:n,backend:a})=>{const{a:i,b:s}=n,o=a;assertNotComplex$1([i,s],e);const l=o.data.get(i.dataId).values,u=o.data.get(s.dataId).values,c="string"===i.dtype?fromUint8ToStringArray(l):l,h="string"===i.dtype?fromUint8ToStringArray(u):u,d=r||i.dtype,[p,f]=t(i.shape,s.shape,c,h,d);return o.makeTensorInfo(f,d,p)}:({inputs:e,backend:a})=>{const{a:i,b:s}=e,o=a;if("complex64"===i.dtype||"complex64"===s.dtype){const e=cast$1({inputs:{x:i},backend:o,attrs:{dtype:"complex64"}}),t=o.data.get(e.dataId),r=t.complexTensorInfos.real,a=t.complexTensorInfos.imag,l=o.data.get(r.dataId).values,u=o.data.get(a.dataId).values,c=cast$1({inputs:{x:s},backend:o,attrs:{dtype:"complex64"}}),h=o.data.get(c.dataId),d=h.complexTensorInfos.real,p=h.complexTensorInfos.imag,f=o.data.get(d.dataId).values,m=o.data.get(p.dataId).values,[g,y,v]=n(i.shape,s.shape,l,u,f,m),b=o.makeTensorInfo(v,"float32",g),x=o.makeTensorInfo(v,"float32",y),T=complex$1({inputs:{real:b,imag:x},backend:o});return o.disposeIntermediateTensorInfo(e),o.disposeIntermediateTensorInfo(c),o.disposeIntermediateTensorInfo(b),o.disposeIntermediateTensorInfo(x),T}{const e=o.data.get(i.dataId).values,n=o.data.get(s.dataId).values,a=r||i.dtype,[l,u]=t(i.shape,s.shape,e,n,a);return o.makeTensorInfo(u,a,l)}}}function createComplexBinaryKernelImpl(e){return(t,n,r,a,i,s)=>{const o=assertAndGetBroadcastShape(t,n),l=sizeFromShape(o),u=o.length,c=computeStrides(o),h=getTypedArrayFromDType("float32",l),d=getTypedArrayFromDType("float32",l),p=getBroadcastDims$1(t,o),f=getBroadcastDims$1(n,o),m=mergeRealAndImagArrays(r,a),g=mergeRealAndImagArrays(i,s),y=t.length,v=computeStrides(t),b=n.length,x=computeStrides(n);if(p.length+f.length===0)for(let T=0;T<h.length;T++){const t=T%m.length,n=T%g.length,r=e(m[2*t],m[2*t+1],g[2*n],g[2*n+1]);h[T]=r.real,d[T]=r.imag}else for(let T=0;T<h.length;T++){const t=indexToLoc(T,u,c),n=t.slice(-y);p.forEach((e=>n[e]=0));const r=locToIndex(n,y,v),a=t.slice(-b);f.forEach((e=>a[e]=0));const i=locToIndex(a,b,x),s=e(m[2*r],m[2*r+1],g[2*i],g[2*i+1]);h[T]=s.real,d[T]=s.imag}return[h,d,o]}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const addImpl=createSimpleBinaryKernelImpl(((e,t)=>e+t)),addComplexImpl=createComplexBinaryKernelImpl(((e,t,n,r)=>({real:e+n,imag:t+r}))),add=binaryKernelFunc$1(Add$1,addImpl,addComplexImpl),addConfig$1={kernelName:Add$1,backendName:"cpu",kernelFunc:add};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function bincountImpl(e,t,n,r,a){const i=sizeFromShape(r),s=makeZerosTypedArray(a,n);for(let o=0;o<e.length;o++){const n=e[o];if(n<0)throw new Error("Input x must be non-negative!");n>=a||(s[n]+=i>0?t[o]:1)}return s}function bincountReduceImpl(e,t,n,r=!1){const a=e.shape[0],i=e.shape[1],s=buffer([a,n],t.dtype);for(let o=0;o<a;o++)for(let a=0;a<i;a++){const i=e.get(o,a);if(i<0)throw new Error("Input x must be non-negative!");i>=n||(r?s.set(1,o,i):t.size>0?s.set(s.get(o,i)+t.get(o,a),o,i):s.set(s.get(o,i)+1,o,i))}return s}
/**
     * @license
     * Copyright 2023 Google LLC.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const bitwiseAndImpl=createSimpleBinaryKernelImpl(((e,t)=>e&t)),bitwiseAnd$1=binaryKernelFunc$1(BitwiseAnd,bitwiseAndImpl),bitwiseAndConfig$1={kernelName:BitwiseAnd,backendName:"cpu",kernelFunc:bitwiseAnd$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function createSimpleUnaryImpl(e){return(t,n,r)=>{const a=getArrayFromDType(n,t.length);for(let i=0;i<t.length;++i)a[i]=e(t[i],r);return a}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function unaryKernelFunc$1(e,t,n){return unaryKernelFuncFromImpl(e,createSimpleUnaryImpl(t),n)}function unaryKernelFuncFromImpl(e,t,n){return({inputs:r,attrs:a,backend:i})=>{const{x:s}=r;assertNotComplex$1(s,e);const o=i,l=o.data.get(s.dataId).values;let u;if("string"===s.dtype){if(!Array.isArray(l))throw new Error("String tensor's value was not an instance of Array");u=fromUint8ToStringArray(l)}else u=l;const c=n||s.dtype,h=t(u,c,a);return o.makeTensorInfo(s.shape,c,h)}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the License);
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an AS IS BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const ceilImpl=createSimpleUnaryImpl((e=>Math.ceil(e))),ceil$1=unaryKernelFuncFromImpl(Ceil,ceilImpl),ceilConfig$1={kernelName:Ceil,backendName:"cpu",kernelFunc:ceil$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function concatImpl$1(e,t,n,r){const a=getArrayFromDType(n,sizeFromShape(t));if(r&&"string"!==n){let t=0;e.forEach((e=>{const n=sizeFromShape(e.shape);a.set(e.vals,t),t+=n}))}else{let r=0;e.forEach((e=>{const i="string"===n?fromUint8ToStringArray(e.vals):e.vals;let s=0;for(let n=0;n<e.shape[0];++n){const o=n*t[1]+r;for(let t=0;t<e.shape[1];++t)a[o+t]=i[s++]}r+=e.shape[1]}))}return a}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const equalImpl=createSimpleBinaryKernelImpl(((e,t)=>e===t?1:0)),equal$1=binaryKernelFunc$1(Equal,equalImpl,null,"bool"),equalConfig$1={kernelName:Equal,backendName:"cpu",kernelFunc:equal$1},expImpl=createSimpleUnaryImpl((e=>Math.exp(e))),exp$1=unaryKernelFuncFromImpl(Exp,expImpl,"float32"),expConfig$1={kernelName:Exp,backendName:"cpu",kernelFunc:exp$1},expm1Impl=createSimpleUnaryImpl((e=>Math.expm1(e))),expm1$1=unaryKernelFuncFromImpl(Expm1,expm1Impl),expm1Config$1={kernelName:Expm1,backendName:"cpu",kernelFunc:expm1$1},floorImpl=createSimpleUnaryImpl((e=>Math.floor(e))),floor$1=unaryKernelFuncFromImpl(Floor,floorImpl),floorConfig$1={kernelName:Floor,backendName:"cpu",kernelFunc:floor$1},floorDivImpl=createSimpleBinaryKernelImpl(((e,t)=>Math.floor(e/t))),floorDiv$1=binaryKernelFunc$1(FloorDiv,floorDivImpl,null,"int32"),floorDivConfig$1={kernelName:FloorDiv,backendName:"cpu",kernelFunc:floorDiv$1};
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function gatherNdImpl(e,t,n,r,a,i,s,o,l){const u=buffer([r,i],n);for(let c=0;c<r;c++){const n=[];let r=0;for(let t=0;t<a;t++){const i=e[c*a+t];r+=i*s[t],n.push(i)}if(r<0||r>=l/i)throw new Error(`Invalid indices: ${n} does not index into ${o}`);for(let e=0;e<i;e++)u.values[c*i+e]=t.get(...t.indexToLoc(r*i+e))}return u}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function gatherV2Impl(e,t,n){const r=buffer(n,e.dtype);for(let a=0;a<r.size;++a){const n=r.indexToLoc(a).slice(),i=n[0],s=n[2],o=t.locToIndex([i,s]);n[2]=t.values[o];const l=e.locToIndex(n);0<=l&&l<e.values.length&&(r.values[a]=e.values[l])}return r}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const greaterImpl=createSimpleBinaryKernelImpl(((e,t)=>e>t?1:0)),greater$1=binaryKernelFunc$1(Greater,greaterImpl,null,"bool"),greaterConfig$1={kernelName:Greater,backendName:"cpu",kernelFunc:greater$1},greaterEqualImpl=createSimpleBinaryKernelImpl(((e,t)=>e>=t?1:0)),greaterEqual$1=binaryKernelFunc$1(GreaterEqual,greaterEqualImpl,null,"bool"),greaterEqualConfig$1={kernelName:GreaterEqual,backendName:"cpu",kernelFunc:greaterEqual$1},lessImpl=createSimpleBinaryKernelImpl(((e,t)=>e<t?1:0)),less$1=binaryKernelFunc$1(Less,lessImpl,null,"bool"),lessConfig$1={kernelName:Less,backendName:"cpu",kernelFunc:less$1},lessEqualImpl=createSimpleBinaryKernelImpl(((e,t)=>e<=t?1:0)),lessEqual$1=binaryKernelFunc$1(LessEqual,lessEqualImpl,null,"bool"),lessEqualConfig$1={kernelName:LessEqual,backendName:"cpu",kernelFunc:lessEqual$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function linSpaceImpl(e,t,n){const r=(t-e)/(n-1),a=makeZerosTypedArray(n,"float32");a[0]=e;for(let i=1;i<a.length;i++)a[i]=a[i-1]+r;return a}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the License);
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an AS IS BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const logImpl=createSimpleUnaryImpl((e=>Math.log(e))),log$3=unaryKernelFuncFromImpl(Log,logImpl),logConfig$1={kernelName:Log,backendName:"cpu",kernelFunc:log$3};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function maxImpl$1(e,t,n,r){const a=getTypedArrayFromDType(r,sizeFromShape(n));for(let i=0;i<a.length;++i){const n=i*t;let r=e[n];for(let a=0;a<t;++a){const t=e[n+a];(Number.isNaN(t)||t>r)&&(r=t)}a[i]=r}return a}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const maximumImpl=createSimpleBinaryKernelImpl(((e,t)=>Math.max(e,t))),maximum$1=binaryKernelFunc$1(Maximum$1,maximumImpl),maximumConfig$1={kernelName:Maximum$1,backendName:"cpu",kernelFunc:maximum$1},minimumImpl=createSimpleBinaryKernelImpl(((e,t)=>Math.min(e,t))),minimum$1=binaryKernelFunc$1(Minimum$1,minimumImpl),minimumConfig$1={kernelName:Minimum$1,backendName:"cpu",kernelFunc:minimum$1},multiplyImpl=createSimpleBinaryKernelImpl(((e,t)=>e*t)),multiplyComplexImpl=createComplexBinaryKernelImpl(((e,t,n,r)=>({real:e*n-t*r,imag:e*r+t*n}))),multiply$1=binaryKernelFunc$1(Multiply$1,multiplyImpl,multiplyComplexImpl),multiplyConfig$1={kernelName:Multiply$1,backendName:"cpu",kernelFunc:multiply$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function negImpl(e,t,n){const r=createScalarValue(-1,n);return multiplyImpl([],t,r,e,n)}function neg$1(e){const{inputs:t,backend:n}=e,{x:r}=t;assertNotComplex$1(r,"neg");const a=n.data.get(r.dataId).values,[i,s]=negImpl(a,r.shape,r.dtype);return n.makeTensorInfo(s,r.dtype,i)}const negConfig$1={kernelName:Neg,backendName:"cpu",kernelFunc:neg$1},notEqualImpl=createSimpleBinaryKernelImpl(((e,t)=>e!==t?1:0)),notEqual$1=binaryKernelFunc$1(NotEqual,notEqualImpl,null,"bool"),notEqualConfig$1={kernelName:NotEqual,backendName:"cpu",kernelFunc:notEqual$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function transposeImpl$1(e,t,n,r,a){const i=t.length,s=sizeFromShape(t),o=computeStrides(t),l=computeStrides(a),u=getTypedArrayFromDType(n,sizeFromShape(a));for(let c=0;c<s;++c){const t=indexToLoc(c,i,o),n=new Array(t.length);for(let e=0;e<n.length;e++)n[e]=t[r[e]];u[locToIndex(n,i,l)]=e[c]}return u}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function transpose$1(e){const{inputs:t,attrs:n,backend:r}=e,{x:a}=t,{perm:i}=n;assertNotComplex$1(a,"transpose");const s=a.shape.length,o=new Array(s);for(let u=0;u<o.length;u++)o[u]=a.shape[i[u]];const l=transposeImpl$1(r.data.get(a.dataId).values,a.shape,a.dtype,i,o);return{dataId:r.write(l,o,a.dtype),shape:o,dtype:a.dtype}}const transposeConfig$1={kernelName:Transpose,backendName:"cpu",kernelFunc:transpose$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function prodImpl(e,t,n,r){const[a,i]=computeOutAndReduceShapes(e,r),s=upcastType(t,"int32"),o=makeZerosTypedArray(sizeFromShape(a),s),l=sizeFromShape(i);for(let u=0;u<o.length;++u){const e=u*l;let t=1;for(let r=0;r<l;++r)t*=n[e+r];o[u]=t}return{outVals:o,outShape:a,outDtype:s}}function prod$1(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:s}=r;assertNotComplex$1(a,"prod");const o=a.shape.length,l=parseAxisParam(i,a.shape),u=getAxesPermutation(l,o);let c=l,h=a;const d=[];null!=u&&(h=transpose$1({inputs:{x:a},backend:n,attrs:{perm:u}}),d.push(h),c=getInnerMostAxes(c.length,o));const p=n.data.get(h.dataId).values,{outVals:f,outShape:m,outDtype:g}=prodImpl(h.shape,h.dtype,p,c);let y=m;return s&&(y=expandShapeToKeepDim(m,l)),d.forEach((e=>n.disposeIntermediateTensorInfo(e))),n.makeTensorInfo(y,g,f)}const prodConfig$1={kernelName:Prod,backendName:"cpu",kernelFunc:prod$1};
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function validateIndices(e,t,n){e.forEach(((e,r)=>{if(e<0||e>=n){const a=indexToLoc(r,t.length,computeStrides(t)).join(",");throw new Error(`indices[${a}] = ${e} is not in [0, ${n})`)}}))}function validateSplits(e,t){for(let n=0;n<e.length;++n){const r=e[n],a=n===e.length-1?t:e[n+1].length;if(0===r.length)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>a)throw new Error("Ragged splits must not point past values");for(let e=1;e<r.length;++e)if(r[e-1]>r[e])throw new Error("Ragged splits must be sorted in ascending order")}}function makeSplits(e,t,n,r){const a=[];let i=0;const s=t.length-1+n.length,o=new Array(s).fill(null).map((()=>[0]));validateSplits(n,r);let l=1;for(let u=0;u<t.length-1;++u){l*=t[u];const e=t[u+1];for(let t=1;t<l+1;++t)o[u].push(t*e)}for(let u=0;u<e.length;++u){let r=e[u],s=e[u]+1;for(let e=0;e<n.length;++e){const a=n[e],i=e+t.length-1;if(i>=0){const e=o[i],t=e[e.length-1]-a[r];for(let n=r;n<s;++n)o[i].push(a[n+1]+t)}r=a[r],s=a[s]}s!==r&&(a.push([r,s]),i+=s-r)}return{outSplits:o,valueSlices:a,numValues:i}}function getSplits(e){const t=[];for(let n=0;n<e.length;++n){const r=getArrayFromDType("int32",e[n].length);t.push(r),e[n].forEach(((e,t)=>r[t]=e))}return t}function computeFlatOuterDims(e,t){const n=e.slice(0,t);for(;n.length<t;)n.push(1);for(let r=t;r<e.length;r++)n[t-1]*=e[r];return n}function writeValueSlices(e,t,n,r,a,i){const s=computeFlatOuterDims(t,2)[1],o=computeFlatOuterDims(i,2)[1];let l=0;for(const u of n)for(let t=u[0];t<u[1];++t){for(let n=0;n<r;++n)a[l*o+n]=e[t*s+n];++l}}function getValues(e,t,n,r,a){const i=t.slice();i[0]=a;const s=getArrayFromDType(n,sizeFromShape(i)),o=e.length;return writeValueSlices(e,t,r,0===o?0:o/t[0],s,i),[s,i]}function raggedGatherImpl(e,t,n,r,a,i,s,o){if(0===e.length)throw new Error("paramsNestedSplits must be non empty");if(0===t[0].length)throw new Error("Split tensors must not be scalars");if(validateIndices(i,s,t[0][0]-1),0===r.length)throw new Error("params.rank must be nonzero");const l=r[0],{outSplits:u,valueSlices:c,numValues:h}=makeSplits(i,s,e,l),d=getSplits(u),p=getValues(n,r,a,c,h);return[d,p[0],p[1]]}
/**
     * @license
     * Copyright 2022 Google LLC.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const INT32_MAX=2147483647;function raggedRangeImpl(e,t,n,r,a,i,s){if(t.length>1)throw new Error("starts must be a scalar or vector");if(a.length>1)throw new Error("limits must be a scalar or vector");if(s.length>1)throw new Error("deltas must be a scalar or vector");const o=0===t.length,l=0===a.length,u=0===s.length,c=[];o||c.push(t[0]),l||c.push(a[0]),u||c.push(s[0]);for(let m=1;m<c.length;++m)if(c[m]!==c[m-1])throw new Error("starts, limits, and deltas must have the same shape");const h=0===c.length?1:c[0],d=getArrayFromDType("int32",h+1);d[0]=0;for(let m=0;m<h;++m){const t=o?e[0]:e[m],n=l?r[0]:r[m],a=u?i[0]:i[m];if(0===a)throw new Error("Requires delta != 0");let s;if(a>0&&n<t||a<0&&n>t)s=0;else if(s=Math.ceil(Math.abs((n-t)/a)),s>INT32_MAX)throw new Error(`Requires ((limit - start) / delta) <= ${INT32_MAX}`);d[m+1]=d[m]+s}const p=getArrayFromDType(n,d[h]);let f=0;for(let m=0;m<h;++m){const t=d[m+1]-d[m];let n=o?e[0]:e[m];const r=u?i[0]:i[m];for(let e=0;e<t;++e)p[f++]=n,n+=r}return[d,p]}
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var RowPartitionType=RowPartitionType$1;class RaggedTensorToTensorOp{constructor(e,t,n,r,a,i,s,o,l,u){this.shape=e,this.shapeShape=t,this.values=n,this.valuesShape=r,this.valuesDType=a,this.defaultValue=i,this.defaultValueShape=s,this.rowPartitionValues=o,this.rowPartitionValuesShapes=l,this.rowPartitionTypes=getRowPartitionTypesHelper(u),this.raggedRank=getRaggedRank(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===RowPartitionType.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===RowPartitionType.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case RowPartitionType.VALUE_ROWIDS:return RaggedTensorToTensorOp.getMaxWidthValueRowID(t);case RowPartitionType.ROW_SPLITS:return RaggedTensorToTensorOp.getMaxWidthRowSplit(t);default:throw new Error(`Cannot handle partition type ${RowPartitionType[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const t=e.length;if(0===t||1===t)return 0;let n=0;for(let r=0;r<t-1;++r){const t=e[r+1]-e[r];t>n&&(n=t)}return n}static getMaxWidthValueRowID(e){const t=e.length;if(0===t)return 0;let n=0,r=e[0],a=0;for(let i=1;i<t;++i){const t=e[i];t!==r&&(r=t,a=Math.max(i-n,a),n=i)}return Math.max(t-n,a)}tensorShapeFromTensor(e,t,n=!0){if(0===t.length){if(-1===e[0])return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return makeShape(e,n)}calculateOutputSize(e){const t=this.valuesShape;validateDefaultValueShape(this.defaultValueShape,t);const n=this.tensorShapeFromTensor(this.shape,this.shapeShape),r=combineRaggedTensorToTensorShapes(this.raggedRank,n,t);r[0]<0&&(r[0]=e);for(let a=1;a<=this.raggedRank;++a)r[a]<0&&(r[a]=this.getMaxWidth(a));return r}calculateFirstParentOutputIndex(e,t,n){const r=Math.min(e,n),a=[];let i=0;for(let s=0;s<r;++s,i+=t)a.push(i);for(let s=r;s<e;++s)a.push(-1);return assert$1(a.length===e,(()=>"Final length of result must be equal to firstDimension.")),a}calculateOutputIndexRowSplit(e,t,n,r){const a=e.length,i=[];for(let s=0;s<a-1;++s){const a=e[s+1]-e[s];let o=Math.min(r,a),l=t[s];-1===l&&(o=0);for(let e=0;e<o;++e)i.push(l),l+=n;for(let e=0;e<a-o;++e)i.push(-1)}if(a>0&&i.length!==e[a-1])throw new Error("Invalid row split size.");return i}calculateOutputIndexValueRowID(e,t,n,r){const a=e.length,i=[];if(0===a)return[];let s=0,o=e[0];if(o>=t.length)throw new Error(`Got currentValueRowId=${o}, which is not less than ${t.length}`);let l=t[o];i.push(l);for(let u=1;u<a;++u){const a=e[u];if(a===o)l>=0&&(++s,s<r?l+=n:l=-1);else{if(s=0,o=a,a>=t.length)throw new Error(`Got nextValueRowId=${a} which is not less than ${t.length}`);l=t[a]}i.push(l)}if(i.length!==e.length)throw new Error("Invalid row ids.");return i}calculateOutputIndex(e,t,n,r){const a=this.getRowPartitionTensor(e),i=this.getRowPartitionTypeByDimension(e);switch(i){case RowPartitionType.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(a,t,n,r);case RowPartitionType.ROW_SPLITS:if(a.length-1>t.length)throw new Error(`Row partition size is greater than output size: ${a.length-1} > ${t.length}`);return this.calculateOutputIndexRowSplit(a,t,n,r);default:throw new Error(`Unsupported partition type: ${RowPartitionType[i]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(0===this.rowPartitionTypes.length)throw new Error("No row_partition_types given.");const t=this.rowPartitionTypes[0];switch(t){case RowPartitionType.FIRST_DIM_SIZE:return e[0];case RowPartitionType.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case RowPartitionType.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${RowPartitionType[t]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const e=this.getFirstDimensionSize(),t=this.calculateOutputSize(e),n=new Array(this.raggedRank+1);n[n.length-1]=1;for(let i=n.length-2;i>=0;--i)n[i]=n[i+1]*t[i+1];const r=makeShape(t,!1),a=getArrayFromDType(this.valuesDType,sizeFromShape(r));if(n[0]*t[0]>0){let i=this.calculateFirstParentOutputIndex(e,n[0],t[0]);for(let e=1;e<=this.raggedRank;++e){i=this.calculateOutputIndex(e-1,i,n[e],t[e])}this.setOutput(this.raggedRank,i,a,r)}return[r,a]}setOutput(e,t,n,r){if(0===n.length)return;const a=this.values,i=n;let s=r.slice();s=s.slice(e+1);const o=sizeFromShape(s),l=t.length;let u=this.defaultValue;if(u.length!==o&&1!==u.length){const e=this.defaultValueShape;tidy((()=>{const t=reshape$2(u,e),n=broadcastTo(t,s);u=n.dataSync()}))}let c=0,h=0,d=0;for(let p=0;p<=l;++p){let e=p<l?t[p]:-1;if(e!==d){if(h<d){const e=a.subarray(c*o);copyArray(i.subarray(h*o),e,(d-h)*o)}if(p>=l){const t=n.length;e=Math.floor(t/o)}if(e>d)if(1===this.defaultValue.length)i.subarray(d*o,e*o).fill(this.defaultValue[0]),d=e;else for(;e>d;){copyArray(i.slice(d*o),u,o),++d}e<0?(c=p+1,h=d):(c=p,h=d,d=h+1)}else++d}}}function copyArray(e,t,n){for(let r=0;r<n;r++)e[r]=t[r]}function makeShape(e,t){const n=[];for(let r of e){if(r<0){if(!t)throw new Error(`Dimension ${r} must be >= 0`);if(r<-1)throw new Error(`Dimension ${r} must be >= -1`);r=-1}n.push(r)}return n}function raggedTensorToTensorImpl(e,t,n,r,a,i,s,o,l,u){return new RaggedTensorToTensorOp(e,t,n,r,a,i,s,o,l,u).compute()}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function rangeImpl(e,t,n,r){if(e===t||e<t&&n<0||t<e&&n>1)return makeZerosTypedArray(0,r);const a=makeZerosTypedArray(Math.abs(Math.ceil((t-e)/n)),r);t<e&&1===n&&(n=-1),a[0]=e;for(let i=1;i<a.length;i++)a[i]=a[i-1]+n;return a}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the License);
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an AS IS BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const rsqrtImpl=createSimpleUnaryImpl((e=>1/Math.sqrt(e))),rsqrt$1=unaryKernelFuncFromImpl(Rsqrt,rsqrtImpl),rsqrtConfig$1={kernelName:Rsqrt,backendName:"cpu",kernelFunc:rsqrt$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function scatterImpl(e,t,n,r,a,i,s,o,l,u){const c=[r/a,a],h=e.values,d=t.values;if(0===r)return buffer(n,t.dtype);const p=l instanceof TensorBuffer?l:buffer(c,t.dtype);"string"==typeof l||"number"==typeof l?p.values.fill(l):"boolean"==typeof l&&p.values.fill(+l);for(let f=0;f<i;f++){const e=[];let i=0;for(let t=0;t<s;t++){const n=h[f*s+t];e.push(n),i+=n*o[t]}if(i<0||i>=r/a)throw new Error(`Invalid indices: ${e} does not index into ${n}`);for(let n=0;n<a;n++)u?p.values[i*a+n]+=d[f*a+n]:p.values[i*a+n]=0===t.rank?d[0]:d[f*a+n]}return p}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the License);
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an AS IS BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const sigmoidImpl=createSimpleUnaryImpl((e=>1/(1+Math.exp(-e)))),sigmoid$1=unaryKernelFunc$1(Sigmoid$1,(e=>1/(1+Math.exp(-e)))),sigmoidConfig$1={kernelName:Sigmoid$1,backendName:"cpu",kernelFunc:sigmoid$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function sliceImpl(e,t,n,r,a){const i=isSliceContinous(r,t,n),s=sizeFromShape(n),o=computeStrides(r);if(i){const n=computeFlatOffset(t,o);return"string"===a?e.slice(n,n+s):e.subarray(n,n+s)}const l=buffer(r,a,"string"===a?fromUint8ToStringArray(e):e),u=buffer(n,a);for(let c=0;c<u.size;++c){const e=u.indexToLoc(c),n=e.map(((e,n)=>e+t[n]));u.set(l.get(...n),...e)}return"string"===a?fromStringArrayToUint8(u.values):u.values}function slice$1(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{begin:i,size:s}=r;assertNotComplex$1(a,"slice");const[o,l]=parseSliceParams(a,i,s);assertParamsValid(a,o,l);const u=sliceImpl(n.data.get(a.dataId).values,o,l,a.shape,a.dtype);return n.makeTensorInfo(l,a.dtype,u)}const sliceConfig$1={kernelName:Slice,backendName:"cpu",kernelFunc:slice$1};
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function sparseFillEmptyRowsImpl(e,t,n,r,a,i,s){const o=t[0],l=i[0],u=new Array(l),c=new Array(o),h=t[1];if(0===l){if(0!==o)throw new Error(getSparseFillEmptyRowsIndicesDenseShapeMismatch(o));return[getArrayFromDType(n,0),[0,h],getArrayFromDType(a,0),u,c]}let d=!0,p=0;const f=new Array(l).fill(0);for(let g=0;g<o;++g){const t=e[g*h];if(t<0)throw new Error(getSparseFillEmptyRowsNegativeIndexErrorMessage(g,t));if(t>=l)throw new Error(getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(g,t,l));++f[t],d=d&&t>=p,p=t}let m=!0;for(let g=0;g<l;++g){const e=0===f[g];u[g]=e,m=m&&!e,f[g]=Math.max(f[g],1),g>0&&(f[g]+=f[g-1])}if(m&&d){const t=e,n=r;for(let e=0;e<o;++e)c[e]=e;return[t,[o,h],n,u,c]}{const t=f[l-1],i=getArrayFromDType(n,t*h),d=getArrayFromDType(a,t),p=new Array(l).fill(0);for(let n=0;n<o;++n){const t=e[n*h],a=p[t],s=(0===t?0:f[t-1])+a;p[t]++;for(let r=0;r<h;++r)i[s*h+r]=e[n*h+r];d[s]=r[n],c[n]=s}for(let e=0;e<l;++e){if(0===p[e]){const t=0===e?0:f[e-1];i[t*h+0]=e;for(let e=1;e<h;++e)i[t*h+e]=0;d[t]=s}}return[i,[t,h],d,u,c]}}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function sparseReshapeImpl(e,t,n,r,a){const i=sizeFromShape(r),s=t[0],o=a.length,l=[];let u=1,c=-1;for(let m=0;m<o;++m){const e=a[m];if(-1===e){if(-1!==c)throw new Error(getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(c,m));c=m,l.push(1)}else{if(e<0)throw new Error(getSparseReshapeNegativeOutputDimErrorMessage(m,e));u*=e,l.push(e)}}if(-1!==c){if(u<=0)throw new Error(getSparseReshapeEmptyTensorZeroOutputDimErrorMessage());const e=Math.trunc(i/u);if(u*e!==i)throw new Error(getSparseReshapeInputOutputMultipleErrorMessage(r,l));l[c]=e}if(sizeFromShape(l)!==i)throw new Error(getSparseReshapeInputOutputMismatchErrorMessage(r,l));const h=r.length,d=[];if(h>0){d[h-1]=1;for(let e=h-2;e>=0;--e)d[e]=d[e+1]*r[e+1]}const p=[];if(o>0){p[o-1]=1;for(let e=o-2;e>=0;--e)p[e]=p[e+1]*l[e+1]}const f=getArrayFromDType(n,s*o);for(let m=0;m<s;++m){let t=0;for(let n=0;n<h;++n)t+=e[m*h+n]*d[n];for(let e=0;e<o;++e)f[m*o+e]=Math.trunc(t/p[e]),t%=p[e]}return[f,[s,o],l]}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function sparseSegmentReductionImpl(e,t,n,r,a,i=!1,s=0){const o=r.length,l=[t[0],e.length/t[0]],u=l[1],c=o>0?a[o-1]+1:0;if(c<0)throw new Error(getSparseSegmentReductionNegativeSegmentIdsErrorMessage());const h=t.slice();h[0]=c;const d=getArrayFromDType(n,h.reduce(((e,t)=>e*t),1));if(0===o)return c>0&&d.fill(s),[d,h];if(c<=0)throw new Error(getSparseSegmentReductionNegativeSegmentIdsErrorMessage());let p=0,f=1,m=0,g=a[p];for(;;){let t=0;if(f<o){if(t=a[f],g===t){++f;continue}if(g>=t)throw new Error(getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage())}if(g<0||g>=c)throw new Error(getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(g,c));g>m&&d.fill(s,m*u,g*u);for(let n=p;n<f;++n){const t=r[n];if(t<0||t>=l[0])throw new Error(getSparseSegmentReductionIndicesOutOfRangeErrorMessage(n,r[n],l[0]));for(let n=0;n<u;n++)d[g*u+n]+=e[t*u+n]}if(i)for(let e=0;e<u;e++)d[g*u+e]/=f-p;if(p=f,++f,m=g+1,g=t,f>o)break}return m<c&&d.fill(s,m*u,c*u),[d,h]}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the License);
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an AS IS BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const sqrtImpl=createSimpleUnaryImpl((e=>Math.sqrt(e))),sqrt$1=unaryKernelFunc$1(Sqrt,(e=>Math.sqrt(e))),sqrtConfig$1={kernelName:Sqrt,backendName:"cpu",kernelFunc:sqrt$1},squaredDifferenceImpl=createSimpleBinaryKernelImpl(((e,t)=>{const n=e-t;return n*n})),squaredDifference$1=binaryKernelFunc$1(SquaredDifference,squaredDifferenceImpl),squaredDifferenceConfig$1={kernelName:SquaredDifference,backendName:"cpu",kernelFunc:squaredDifference$1},staticRegexReplaceImpl=createSimpleUnaryImpl(((e,t)=>{const{pattern:n,replaceGlobal:r,rewrite:a}=t;return e.replace(new RegExp(n,r?"g":""),a)})),staticRegexReplace$1=unaryKernelFuncFromImpl(StaticRegexReplace,staticRegexReplaceImpl),staticRegexReplaceConfig$1={kernelName:StaticRegexReplace,backendName:"cpu",kernelFunc:staticRegexReplace$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function stridedSliceImpl(e,t,n,r){const a=buffer(e,t.dtype);for(let i=0;i<a.size;i++){const e=a.indexToLoc(i),s=new Array(e.length);for(let t=0;t<s.length;t++)s[t]=e[t]*n[t]+r[t];a.set(t.get(...s),...e)}return a}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class StringNGramsOp{constructor(e,t,n,r,a,i){this.separator=encodeString(e),this.nGramWidths=t,this.leftPad=encodeString(n),this.rightPad=encodeString(r),this.padWidth=a,this.preserveShort=i}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,t){const n=this.getPadWidth(t);return Math.max(0,e+2*n-t+1)}createNGrams(e,t,n,r,a,i){for(let s=0;s<a;++s){const o=this.getPadWidth(i),l=Math.max(0,o-s),u=Math.max(0,o-(a-(s+1))),c=i-(l+u),h=t+(l>0?0:s-o);let d=0;d+=l*this.leftPad.length;for(let t=0;t<c;++t)d+=e[h+t].length;d+=u*this.rightPad.length;d+=(l+u+c-1)*this.separator.length,n[r+s]=new Uint8Array(d);const p=n[r+s];let f=0;const m=e=>e.forEach((e=>p[f++]=e));for(let e=0;e<l;++e)m(this.leftPad),m(this.separator);for(let t=0;t<c-1;++t)m(e[h+t]),m(this.separator);if(c>0){m(e[h+c-1]);for(let e=0;e<u;++e)m(this.separator),m(this.rightPad)}else{for(let e=0;e<u-1;++e)m(this.rightPad),m(this.separator);m(this.rightPad)}}}compute(e,t){const n=e.length,r=t.length;if(r>0){let e=t[0];if(0!==e)throw new Error(`First split value must be 0, got ${e}`);for(let a=1;a<r;++a){let r=t[a]>=e;if(r=r&&t[a]<=n,!r)throw new Error(`Invalid split value ${t[a]}, must be in [${e}, ${n}]`);e=t[a]}if(e!==n)throw new Error(`Last split value must be data size. Expected ${n}, got ${e}`)}const a=r-1,i=getArrayFromDType("int32",r);if(0===n||0===r){const e=new Array(n);for(let t=0;t<=a;++t)i[t]=0;return[e,i]}i[0]=0;for(let o=1;o<=a;++o){const e=t[o]-t[o-1];let n=0;this.nGramWidths.forEach((t=>{n+=this.getNumNGrams(e,t)})),this.preserveShort&&e>0&&0===n&&(n=1),i[o]=i[o-1]+n}const s=new Array(i[a]);for(let o=0;o<a;++o){const n=t[o];let r=i[o];if(this.nGramWidths.forEach((a=>{const i=t[o+1]-t[o],l=this.getNumNGrams(i,a);this.createNGrams(e,n,s,r,l,a),r+=l})),this.preserveShort&&r===i[o]){const a=t[o+1]-t[o];if(0===a)continue;const i=a+2*this.padWidth,l=1;this.createNGrams(e,n,s,r,l,i)}}return[s,i]}}function stringNGramsImpl(e,t,n,r,a,i,s,o){return new StringNGramsOp(n,r,a,i,s,o).compute(e,t)}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function split$1(e,t,n,r){if(!e.length)return;if(0===t.length){for(let t=0;t<e.length;++t)r.push(e.subarray(t,t+1));return}if(1===t.length){const a=t[0];let i=e.indexOf(a);for(;-1!==i;){const t=e.subarray(0,i);n&&0===t.length||r.push(t),i=(e=e.subarray(i+1)).indexOf(a)}return void(n&&0===e.length||r.push(e))}let a=0;for(let i=0;i<e.length+1;i++)if(i===e.length||-1!==t.indexOf(e[i])){const t=e.subarray(a,i);n&&0===t.length||r.push(t),a=i+1}}function stringSplitImpl(e,t,n){const r=e.length,a=[];let i=0,s=0;const o=new Array(r);for(let d=0;d<r;++d){const r=a.length;split$1(e[d],t,n,a);const l=a.length-r;o[d]=l,i+=l,s=Math.max(s,l)}const l=getArrayFromDType("int32",2*i),u=new Array(i),c=[r,s];let h=0;for(let d=0;d<r;++d)for(let e=0;e<o[d];++e)l[2*h]=d,l[2*h+1]=e,u[h]=a[h],++h;return[l,u,c]}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function stringToHashBucketFastImpl(e,t){const n=getArrayFromDType("int32",e.length);for(let r=0;r<e.length;++r)n[r]=fingerPrint64(e[r]).modulo(t).getLowBitsUnsigned();return n}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const subImpl=createSimpleBinaryKernelImpl(((e,t)=>e-t)),subComplexImpl=createComplexBinaryKernelImpl(((e,t,n,r)=>({real:e-n,imag:t-r}))),sub$1=binaryKernelFunc$1(Sub,subImpl,subComplexImpl),subConfig$1={kernelName:Sub,backendName:"cpu",kernelFunc:sub$1};
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function tileImpl(e,t){const n=new Array(e.rank);for(let a=0;a<n.length;a++)n[a]=e.shape[a]*t[a];const r=buffer(n,e.dtype);for(let a=0;a<r.values.length;++a){const t=r.indexToLoc(a),n=new Array(e.rank);for(let r=0;r<n.length;r++)n[r]=t[r]%e.shape[r];const i=e.locToIndex(n);r.values[a]=e.values[i]}return r}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const comparePair=(e,t)=>{const n=t.value-e.value;return 0===n?e.index-t.index:n};function select$2(e,t,n=0,r=e.length-1){for(;r>n;){if(r-n>600){const a=r-n+1,i=t-n+1,s=Math.log(a),o=.5*Math.exp(2*s/3),l=.5*Math.sqrt(s*o*(a-o)/a)*Math.sign(i-a/2);select$2(e,t,Math.max(n,Math.floor(t-i*o/a+l)),Math.min(r,Math.floor(t+(a-i)*o/a+l)))}const a=e[t];let i=n,s=r;for(swap(e,n,t),comparePair(e[r],a)>0&&swap(e,n,r);i<s;){for(swap(e,i,s),i++,s--;comparePair(e[i],a)<0;)i+=1;for(;comparePair(e[s],a)>0;)s-=1}0===comparePair(e[n],a)?swap(e,n,s):(s+=1,swap(e,s,r)),s<=t&&(n=s+1),t<=s&&(r=s-1)}}function topKImpl(e,t,n,r,a){const i=t[t.length-1],[s,o]=[e.length/i,i],l=getTypedArrayFromDType(n,s*r),u=getTypedArrayFromDType("int32",s*r);for(let h=0;h<s;h++){const t=h*o,n=e.subarray(t,t+o);let i=new Array(n.length);n.forEach(((e,t)=>i[t]={value:e,index:t})),r<i.length&&(select$2(i,r),i=i.slice(0,r)),a&&i.sort(comparePair);const s=h*r,c=l.subarray(s,s+r),d=u.subarray(s,s+r);for(let e=0;e<r;e++)c[e]=i[e].value,d[e]=i[e].index}const c=t.slice();return c[c.length-1]=r,[buffer(c,n,l),buffer(c,"int32",u)]}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function uniqueImpl(e,t,n,r){const a=parseAxisParam(t,n)[0],i=[1,n[0],1];for(let f=0;f<a;f++)i[0]*=n[f];i[1]=n[a];for(let f=a+1;f<n.length;f++)i[2]*=n[f];const s=new Map,o=new Int32Array(n[a]),l=new TensorBuffer(i,r,e),u=[],c=1===i[0]&&1===i[2];for(let f=0;f<n[a];f++){let t;if(c)t=e[f].toString();else{const e=[];for(let t=0;t<i[0];t++)for(let n=0;n<i[2];n++)e.push(l.get(t,f,n));t=e.join(",")}const n=s.get(t);if(null!=n)o[f]=n;else{const e=s.size;s.set(t,e),o[f]=e,u.push(f)}}const h=i.slice();h[1]=s.size;const d=new TensorBuffer(h,r);u.forEach(((e,t)=>{for(let n=0;n<i[0];n++)for(let r=0;r<i[2];r++)d.set(l.get(n,e,r),n,t,r)}));const p=n.slice();return p[a]=h[1],{outputValues:d.values,outputShape:p,indices:o}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const shared=Object.freeze(Object.defineProperty({__proto__:null,addImpl:addImpl,bincountImpl:bincountImpl,bincountReduceImpl:bincountReduceImpl,bitwiseAndImpl:bitwiseAndImpl,castImpl:castImpl,ceilImpl:ceilImpl,concatImpl:concatImpl$1,equalImpl:equalImpl,expImpl:expImpl,expm1Impl:expm1Impl,floorDivImpl:floorDivImpl,floorImpl:floorImpl,gatherNdImpl:gatherNdImpl,gatherV2Impl:gatherV2Impl,greaterEqualImpl:greaterEqualImpl,greaterImpl:greaterImpl,lessEqualImpl:lessEqualImpl,lessImpl:lessImpl,linSpaceImpl:linSpaceImpl,logImpl:logImpl,maxImpl:maxImpl$1,maximumImpl:maximumImpl,minimumImpl:minimumImpl,multiplyImpl:multiplyImpl,negImpl:negImpl,notEqualImpl:notEqualImpl,prodImpl:prodImpl,raggedGatherImpl:raggedGatherImpl,raggedRangeImpl:raggedRangeImpl,raggedTensorToTensorImpl:raggedTensorToTensorImpl,rangeImpl:rangeImpl,rsqrtImpl:rsqrtImpl,scatterImpl:scatterImpl,sigmoidImpl:sigmoidImpl,simpleAbsImpl:simpleAbsImpl,sliceImpl:sliceImpl,sparseFillEmptyRowsImpl:sparseFillEmptyRowsImpl,sparseReshapeImpl:sparseReshapeImpl,sparseSegmentReductionImpl:sparseSegmentReductionImpl,sqrtImpl:sqrtImpl,squaredDifferenceImpl:squaredDifferenceImpl,staticRegexReplaceImpl:staticRegexReplaceImpl,stridedSliceImpl:stridedSliceImpl,stringNGramsImpl:stringNGramsImpl,stringSplitImpl:stringSplitImpl,stringToHashBucketFastImpl:stringToHashBucketFastImpl,subImpl:subImpl,tileImpl:tileImpl,topKImpl:topKImpl,transposeImpl:transposeImpl$1,uniqueImpl:uniqueImpl},Symbol.toStringTag,{value:"Module"}));
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */registerBackend("cpu",(()=>new MathBackendCPU),1);
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the License);
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an AS IS BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
const elu$1=unaryKernelFunc$1(Elu$1,(e=>e>=0?e:Math.exp(e)-1)),eluConfig$1={kernelName:Elu$1,backendName:"cpu",kernelFunc:elu$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function leakyRelu$1(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{alpha:i}=r;assertNotComplex$1([a],"leakyRelu");const s=sizeFromShape(a.shape),o=n.data.get(a.dataId).values,l=getTypedArrayFromDType("float32",s);for(let u=0;u<o.length;u++)l[u]=o[u]<0?i*o[u]:o[u];return n.makeTensorInfo(a.shape,"float32",l)}const leakyReluConfig$1={kernelName:LeakyRelu,backendName:"cpu",kernelFunc:leakyRelu$1},preluImpl=createSimpleBinaryKernelImpl(((e,t)=>e<0?t*e:e));
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the License);
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an AS IS BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function prelu$1(e){const{inputs:t,backend:n}=e,{x:r,alpha:a}=t;assertNotComplex$1([r,a],"prelu");const i=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,[o,l]=preluImpl(r.shape,a.shape,i,s,"float32");return n.makeTensorInfo(l,"float32",o)}const preluConfig$1={kernelName:Prelu,backendName:"cpu",kernelFunc:prelu$1},relu$1=unaryKernelFunc$1(Relu$1,(e=>Math.max(0,e))),reluConfig$1={kernelName:Relu$1,backendName:"cpu",kernelFunc:relu$1},relu6$1=unaryKernelFunc$1(Relu6$1,(e=>Math.min(Math.max(0,e),6))),relu6Config$1={kernelName:Relu6$1,backendName:"cpu",kernelFunc:relu6$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the License);
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an AS IS BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function applyActivation(e,t,n,r,a){if("linear"===n)return identity$1({inputs:{x:t},backend:e});if("relu"===n)return relu$1({inputs:{x:t},backend:e});if("elu"===n)return elu$1({inputs:{x:t},backend:e});if("relu6"===n)return relu6$1({inputs:{x:t},backend:e});if("prelu"===n)return prelu$1({inputs:{x:t,alpha:r},backend:e});if("leakyrelu"===n)return leakyRelu$1({inputs:{x:t},backend:e,attrs:{alpha:a}});if("sigmoid"===n)return sigmoid$1({inputs:{x:t},backend:e});throw new Error(`Activation ${n} has not been implemented for the CPU backend.`)}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function reshape$1(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{shape:i}=r,s=sizeFromShape(a.shape),o=inferFromImplicitShape(i,s),l=sizeFromShape(o);assert$1(s===l,(()=>`The new shape (${o}) has ${l} elements and the old shape (${a.shape}) has ${s} elements. The new shape and old shape must have the same number of elements.`)),n.incRef(a.dataId);const u=n.data.get(a.dataId);if(null!=u.complexTensorInfos){const e=u.complexTensorInfos.real,t=u.complexTensorInfos.imag;e.shape=o,t.shape=o}return{dataId:a.dataId,shape:o,dtype:a.dtype}}const reshapeConfig$1={kernelName:Reshape$1,backendName:"cpu",kernelFunc:reshape$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the License);
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an AS IS BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function batchMatMul$1(e){const{inputs:t,backend:n,attrs:r}=e,{a:a,b:i}=t,{transposeA:s,transposeB:o}=r;assertNotComplex$1([a,i],"matMul");const l=a.shape.length,u=i.shape.length,c=s?a.shape[l-2]:a.shape[l-1],h=o?i.shape[u-1]:i.shape[u-2],d=s?a.shape[l-1]:a.shape[l-2],p=o?i.shape[u-2]:i.shape[u-1],f=a.shape.slice(0,-2),m=i.shape.slice(0,-2),g=sizeFromShape(f),y=sizeFromShape(m),v=assertAndGetBroadcastShape(a.shape.slice(0,-2),i.shape.slice(0,-2)).concat([d,p]);assert$1(c===h,(()=>`Error in matMul: inner shapes (${c}) and (${h}) of Tensors with shapes ${a.shape} and ${i.shape} and transposeA=${s} and transposeB=${o} must match.`));const b=o?[y,p,h]:[y,h,p],x=reshape$1({inputs:{x:a},backend:n,attrs:{shape:s?[g,c,d]:[g,d,c]}}),T=reshape$1({inputs:{x:i},backend:n,attrs:{shape:b}}),_=s?x.shape[1]:x.shape[2],w=s?x.shape[2]:x.shape[1],S=o?T.shape[1]:T.shape[2],C=Math.max(g,y),E=n.data.get(x.dataId).values,k=n.data.get(T.dataId).values,I=computeStrides(x.shape),A=computeStrides(T.shape),[N,$,D]=s?[I[0],1,I[1]]:[I[0],I[1],1],[P,R,M]=o?[1,A[1],A[0]]:[A[1],1,A[0]],O=w*S,F=buffer([C,w,S],x.dtype),L=F.values,B=n.blockSize;for(let V=0;V<C;V++){const e=V%g,t=V%y;for(let n=0;n<w;n+=B){const r=Math.min(n+B,w);for(let a=0;a<S;a+=B){const i=Math.min(a+B,S);for(let s=0;s<_;s+=B){const o=Math.min(s+B,_);for(let l=n;l<r;l++)for(let n=a;n<i;n++){let r=0;for(let a=s;a<o;a++){r+=E[e*N+l*$+a*D]*k[a*P+n*R+t*M]}L[V*O+(l*S+n)]+=r}}}}}return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(T),n.makeTensorInfo(v,F.dtype,F.values)}const batchMatMulConfig$1={kernelName:BatchMatMul,backendName:"cpu",kernelFunc:batchMatMul$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the License);
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an AS IS BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function _fusedMatMul$1(e){const{inputs:t,backend:n,attrs:r}=e,{a:a,b:i,bias:s,preluActivationWeights:o}=t,{transposeA:l,transposeB:u,activation:c,leakyreluAlpha:h}=r;let d,p,f;const m=[];d=batchMatMul$1({inputs:{a:a,b:i},attrs:{transposeA:l,transposeB:u},backend:n}),s&&(p=add({inputs:{a:d,b:s},backend:n}),m.push(d),d=p),c&&(f=applyActivation(n,d,c,o,h),m.push(d),d=f);for(const g of m)n.disposeIntermediateTensorInfo(g);return d}const _fusedMatMulConfig$1={kernelName:_FusedMatMul,backendName:"cpu",kernelFunc:_fusedMatMul$1},acos$1=unaryKernelFunc$1(Acos,(e=>Math.acos(e))),acosConfig$1={kernelName:Acos,backendName:"cpu",kernelFunc:acos$1},acosh$1=unaryKernelFunc$1(Acosh,(e=>Math.acosh(e))),acoshConfig$1={kernelName:Acosh,backendName:"cpu",kernelFunc:acosh$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the License);
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an AS IS BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function addN$1(e){const{inputs:t,backend:n}=e,r=t;assertNotComplex$1(t,"addN");const a=r.map((e=>n.data.get(e.dataId).values)),i=buffer(r[0].shape,r[0].dtype),s=i.values;for(let o=0;o<r.length;o++){const e=a[o];for(let t=0;t<s.length;t++)s[t]+=e[t]}return n.makeTensorInfo(i.shape,i.dtype,i.values)}const addNConfig$1={kernelName:AddN,backendName:"cpu",kernelFunc:addN$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function all$1(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:s}=r;assertNotComplex$1(a,"all");const o=parseAxisParam(i,a.shape);let l=o;const u=getAxesPermutation(l,a.shape.length);let c=a;null!=u&&(c=transpose$1({inputs:{x:a},backend:n,attrs:{perm:u}}),l=getInnerMostAxes(l.length,a.shape.length)),assertAxesAreInnerMostDims("all",l,c.shape.length);const[h,d]=computeOutAndReduceShapes(c.shape,l),p=sizeFromShape(d),f=makeZerosTypedArray(sizeFromShape(h),c.dtype),m=n.data.get(c.dataId).values;for(let y=0;y<f.length;++y){const e=y*p;let t=m[e];for(let n=0;n<p;++n){const r=m[e+n];t=t&&r}f[y]=t}null!=u&&n.disposeIntermediateTensorInfo(c);const g=n.makeTensorInfo(h,c.dtype,f);if(s){const e=reshape$1({inputs:{x:g},backend:n,attrs:{shape:expandShapeToKeepDim(h,o)}});return n.disposeIntermediateTensorInfo(g),e}return g}const allConfig$1={kernelName:All,backendName:"cpu",kernelFunc:all$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function any$2(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:s}=r;assertNotComplex$1(a,"any");const o=parseAxisParam(i,a.shape);let l=o;const u=getAxesPermutation(l,a.shape.length);let c=a;null!=u&&(c=transpose$1({inputs:{x:a},backend:n,attrs:{perm:u}}),l=getInnerMostAxes(l.length,a.shape.length)),assertAxesAreInnerMostDims("any",l,c.shape.length);const[h,d]=computeOutAndReduceShapes(c.shape,l),p=sizeFromShape(d),f=makeZerosTypedArray(sizeFromShape(h),c.dtype),m=n.data.get(c.dataId).values;for(let y=0;y<f.length;++y){const e=y*p;let t=m[e];for(let n=0;n<p;++n){const r=m[e+n];t=t||r}f[y]=t}null!=u&&n.disposeIntermediateTensorInfo(c);const g=n.makeTensorInfo(h,c.dtype,f);if(s){const e=reshape$1({inputs:{x:g},backend:n,attrs:{shape:expandShapeToKeepDim(h,o)}});return n.disposeIntermediateTensorInfo(g),e}return g}const anyConfig$1={kernelName:Any,backendName:"cpu",kernelFunc:any$2};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function argMax$1(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i}=r;assertNotComplex$1(a,"argMax");let s=parseAxisParam(i,a.shape);const o=getAxesPermutation(s,a.shape.length);let l=a;const u=[];null!=o&&(l=transpose$1({inputs:{x:a},backend:n,attrs:{perm:o}}),u.push(l),s=getInnerMostAxes(s.length,l.shape.length)),s=[s[0]],assertAxesAreInnerMostDims("argMax",s,l.shape.length);const[c,h]=computeOutAndReduceShapes(l.shape,s),d=makeZerosTypedArray(sizeFromShape(c),"int32"),p=sizeFromShape(h),f=n.data.get(l.dataId).values;for(let m=0;m<d.length;++m){const e=m*p;let t=f[e],n=0;for(let r=0;r<p;++r){const a=f[e+r];a>t&&(t=a,n=r)}d[m]=n}return u.forEach((e=>n.disposeIntermediateTensorInfo(e))),n.makeTensorInfo(c,"int32",d)}const argMaxConfig$1={kernelName:ArgMax,backendName:"cpu",kernelFunc:argMax$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function argMin$1(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i}=r;assertNotComplex$1(a,"argMin");let s=parseAxisParam(i,a.shape);const o=getAxesPermutation(s,a.shape.length);let l=a;const u=[];null!=o&&(l=transpose$1({inputs:{x:a},backend:n,attrs:{perm:o}}),u.push(l),s=getInnerMostAxes(s.length,l.shape.length)),s=[s[0]],assertAxesAreInnerMostDims("argMin",s,l.shape.length);const[c,h]=computeOutAndReduceShapes(l.shape,s),d=makeZerosTypedArray(sizeFromShape(c),"int32"),p=sizeFromShape(h),f=n.data.get(l.dataId).values;for(let m=0;m<d.length;++m){const e=m*p;let t=f[e],n=0;for(let r=0;r<p;++r){const a=f[e+r];a<t&&(t=a,n=r)}d[m]=n}return u.forEach((e=>n.disposeIntermediateTensorInfo(e))),n.makeTensorInfo(c,"int32",d)}const argMinConfig$1={kernelName:ArgMin,backendName:"cpu",kernelFunc:argMin$1},asin$1=unaryKernelFunc$1(Asin,(e=>Math.asin(e))),asinConfig$1={kernelName:Asin,backendName:"cpu",kernelFunc:asin$1},asinh$1=unaryKernelFunc$1(Asinh,(e=>Math.asinh(e))),asinhConfig$1={kernelName:Asinh,backendName:"cpu",kernelFunc:asinh$1},atan$1=unaryKernelFunc$1(Atan,(e=>Math.atan(e))),atanConfig$1={kernelName:Atan,backendName:"cpu",kernelFunc:atan$1},atan2Impl=createSimpleBinaryKernelImpl(((e,t)=>Math.atan2(e,t))),atan2$1=binaryKernelFunc$1(Atan2,atan2Impl),atan2Config$1={kernelName:Atan2,backendName:"cpu",kernelFunc:atan2$1},atanh$1=unaryKernelFunc$1(Atanh,(e=>Math.atanh(e))),atanhConfig$1={kernelName:Atanh,backendName:"cpu",kernelFunc:atanh$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the License);
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an AS IS BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function pool(e,t,n,r,a,i){const s=a.strideHeight,o=a.strideWidth,l=a.dilationHeight,u=a.dilationWidth,c=a.effectiveFilterHeight,h=a.effectiveFilterWidth,d=a.padInfo.top,p=a.padInfo.left,f="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=buffer(a.outShape,n),g=m.values,y=a.outShape[1]*a.outShape[2]*a.outShape[3],v=a.outShape[2]*a.outShape[3],b=a.outShape[3];for(let x=0;x<a.batchSize;++x){const t=x*y,n=x*r[0];for(let m=0;m<a.inChannels;++m)for(let y=0;y<a.outHeight;++y){const x=y*s-d,T=Math.max(0,x),_=Math.min(a.inHeight,c+x),w=t+y*v;for(let t=0;t<a.outWidth;++t){const s=t*o-p,c=Math.max(0,s),d=Math.min(a.inWidth,h+s);let y=f,v=0,x=0;for(let t=T;t<_;t+=l){const a=n+t*r[1];for(let t=c;t<d;t+=u){const n=e[a+t*r[2]+m];"max"===i&&n>y?y=n:"avg"===i&&(v+=n,x++)}if(isNaN(y))break}g[w+t*b+m]="avg"===i?v/x:y}}}return m}function maxPoolPositions(e,t,n,r,a=!1,i=!1){const s=buffer(r.outShape,"int32"),o=r.strideHeight,l=r.strideWidth,u=r.dilationHeight,c=r.dilationWidth,h=r.effectiveFilterHeight,d=r.effectiveFilterWidth,p=r.padInfo.top,f=r.padInfo.left,m=buffer(t,n,e);for(let g=0;g<r.batchSize;++g)for(let e=0;e<r.inChannels;++e)for(let t=0;t<r.outHeight;++t){const n=t*o-p;let y=n;for(;y<0;)y+=u;const v=Math.min(r.inHeight,h+n);for(let o=0;o<r.outWidth;++o){const h=o*l-f;let p=h;for(;p<0;)p+=c;const b=Math.min(r.inWidth,d+h);let x=Number.NEGATIVE_INFINITY,T=-1;for(let t=y;t<v;t+=u){const s=t-n;for(let n=p;n<b;n+=c){const o=n-h,l=m.get(g,t,n,e);l>x&&(x=l,T=a?i?((g*r.inHeight+t)*r.inWidth+n)*r.inChannels+e:(t*r.inWidth+n)*r.inChannels+e:s*d+o)}}s.set(T,g,t,o,e)}}return s}function pool3d(e,t,n,r,a,i){const s=a.strideDepth,o=a.strideHeight,l=a.strideWidth,u=a.dilationDepth,c=a.dilationHeight,h=a.dilationWidth,d=a.effectiveFilterDepth,p=a.effectiveFilterHeight,f=a.effectiveFilterWidth,m=a.padInfo.front,g=a.padInfo.top,y=a.padInfo.left,v="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,b=buffer(a.outShape,n),x=b.values,T=a.outShape[1]*a.outShape[2]*a.outShape[3]*a.outShape[4],_=a.outShape[2]*a.outShape[3]*a.outShape[4],w=a.outShape[3]*a.outShape[4],S=a.outShape[4];for(let C=0;C<a.batchSize;++C){const t=C*T,n=C*r[0];for(let b=0;b<a.inChannels;++b)for(let T=0;T<a.outDepth;++T){const C=T*s-m;let E=C;for(;E<0;)E+=u;const k=Math.min(a.inDepth,d+C),I=t+T*_;for(let t=0;t<a.outHeight;++t){const s=t*o-g;let d=s;for(;d<0;)d+=c;const m=Math.min(a.inHeight,p+s),T=I+t*w;for(let t=0;t<a.outWidth;++t){const s=t*l-y;let o=s;for(;o<0;)o+=h;const p=Math.min(a.inWidth,f+s),g=T+t*S;let _=v,w=0,C=0;for(let t=E;t<k;t+=u){const a=n+t*r[1];for(let t=d;t<m;t+=c){const n=a+t*r[2];for(let t=o;t<p;t+=h){const a=e[n+t*r[3]+b];if("max"===i&&a>_?_=a:"avg"===i&&(w+=a,C++),isNaN(_))break}if(isNaN(_))break}if(isNaN(_))break}x[g+b]="avg"===i?w/Math.max(C,1):_}}}}return b}function maxPool3dPositions(e,t){const n=buffer(t.outShape,"int32"),r=t.strideDepth,a=t.strideHeight,i=t.strideWidth,s=t.dilationDepth,o=t.dilationHeight,l=t.dilationWidth,u=t.effectiveFilterDepth,c=t.effectiveFilterHeight,h=t.effectiveFilterWidth,d=t.padInfo.front,p=t.padInfo.top,f=t.padInfo.left;for(let m=0;m<t.batchSize;++m)for(let g=0;g<t.inChannels;++g)for(let y=0;y<t.outDepth;++y){const v=y*r-d;let b=v;for(;b<0;)b+=s;const x=Math.min(t.inDepth,u+v);for(let r=0;r<t.outHeight;++r){const u=r*a-p;let d=u;for(;d<0;)d+=o;const T=Math.min(t.inHeight,c+u);for(let a=0;a<t.outWidth;++a){const p=a*i-f;let _=p;for(;_<0;)_+=l;const w=Math.min(t.inWidth,h+p);let S=Number.NEGATIVE_INFINITY,C=-1;for(let t=b;t<x;t+=s){const n=t-v;for(let r=d;r<T;r+=o){const a=r-u;for(let i=_;i<w;i+=l){const s=i-p,o=e.get(m,t,r,i,g);o>=S&&(S=o,C=n*c*h+a*c+s)}}}n.set(C,m,y,r,a,g)}}}return n}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function avgPool$1(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t;assertNotComplex$1(a,"avgPool");const{filterSize:i,strides:s,pad:o,dimRoundingMode:l}=r;assert$1(eitherStridesOrDilationsAreOne(s,1),(()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${s} and dilations '1'`));const u=computePool2DInfo(a.shape,i,s,1,o,l);let c;if(1===u.filterWidth&&1===u.filterHeight&&arraysEqual(u.inShape,u.outShape))c=identity$1({inputs:{x:a},backend:n});else{const e=n.data.get(a.dataId).values,t=computeStrides(a.shape),r=pool(e,a.shape,a.dtype,t,u,"avg");c=n.makeTensorInfo(u.outShape,a.dtype,r.values)}return c}const avgPoolConfig$1={kernelName:AvgPool,backendName:"cpu",kernelFunc:avgPool$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function avgPool3D$1(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{filterSize:i,strides:s,pad:o,dimRoundingMode:l,dataFormat:u}=r;assertNotComplex$1(a,"avgPool3d");const c=computePool3DInfo(a.shape,i,s,1,o,l,u),h=pool3d(n.data.get(a.dataId).values,a.shape,a.dtype,computeStrides(a.shape),c,"avg");return n.makeTensorInfo(h.shape,"float32",h.values)}const avgPool3DConfig$1={kernelName:AvgPool3D,backendName:"cpu",kernelFunc:avgPool3D$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function avgPool3DGrad$1(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,input:i}=t,{filterSize:s,strides:o,pad:l,dimRoundingMode:u}=r;assertNotComplex$1([a,i],"avgPool3DGrad");const c=computePool3DInfo(i.shape,s,o,1,l,u),h=c.strideDepth,d=c.strideHeight,p=c.strideWidth,f=c.filterDepth,m=c.filterHeight,g=c.filterWidth,y=c.dilationDepth,v=c.dilationHeight,b=c.dilationWidth,x=c.effectiveFilterDepth,T=c.effectiveFilterHeight,_=c.effectiveFilterWidth,w=x-1-c.padInfo.front,S=_-1-c.padInfo.left,C=T-1-c.padInfo.top,E=buffer(i.shape,"float32"),k=1/(f*m*g),I=n.bufferSync(a);for(let A=0;A<c.batchSize;++A)for(let e=0;e<c.inChannels;++e)for(let t=0;t<c.inDepth;++t)for(let n=0;n<c.inHeight;++n)for(let r=0;r<c.inWidth;++r){const a=t-w,i=n-C,s=r-S;let o=0;for(let t=0;t<x;t+=y){const n=(a+t)/h;if(!(n<0||n>=c.outDepth||Math.floor(n)!==n))for(let t=0;t<T;t+=v){const r=(i+t)/d;if(!(r<0||r>=c.outHeight||Math.floor(r)!==r))for(let t=0;t<_;t+=b){const a=(s+t)/p;if(a<0||a>=c.outWidth||Math.floor(a)!==a)continue;o+=I.get(A,n,r,a,e)}}}E.set(o*k,A,t,n,r,e)}return n.makeTensorInfo(E.shape,E.dtype,E.values)}const avgPool3DGradConfig$1={kernelName:AvgPool3DGrad,backendName:"cpu",kernelFunc:avgPool3DGrad$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function avgPoolGrad$1(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,input:i}=t,s=i;assertNotComplex$1([a,i],"avgPoolGrad");const{filterSize:o,strides:l,pad:u}=r,c=computePool2DInfo(s.shape,o,l,1,u),h=c.strideHeight,d=c.strideWidth,p=c.filterHeight,f=c.filterWidth,m=c.dilationHeight,g=c.dilationWidth,y=c.effectiveFilterHeight,v=c.effectiveFilterWidth,b=v-1-c.padInfo.left,x=y-1-c.padInfo.top,T=buffer(s.shape,"float32"),_=1/(p*f),w=n.data.get(a.dataId).values,S=buffer(a.shape,"float32",w);for(let C=0;C<c.batchSize;++C)for(let e=0;e<c.inChannels;++e)for(let t=0;t<c.inHeight;++t)for(let n=0;n<c.inWidth;++n){const r=t-x,a=n-b;let i=0;for(let t=0;t<y;t+=m){const n=(r+t)/h;if(!(n<0||n>=c.outHeight||Math.floor(n)!==n))for(let t=0;t<v;t+=g){const r=(a+t)/d;if(r<0||r>=c.outWidth||Math.floor(r)!==r)continue;i+=S.get(C,n,r,e)}}T.set(i*_,C,t,n,e)}return n.makeTensorInfo(T.shape,T.dtype,T.values)}const avgPoolGradConfig$1={kernelName:AvgPoolGrad,backendName:"cpu",kernelFunc:avgPoolGrad$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function batchNorm$1(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,scale:i,offset:s,mean:o,variance:l}=t;assert$1(o.shape.length===l.shape.length,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),assert$1(null==s||o.shape.length===s.shape.length,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),assert$1(null==i||o.shape.length===i.shape.length,(()=>"Batch normalization gradient requires mean and scale to have equal ranks.")),assertNotComplex$1([a,o,l,i,s],"batchNorm");let{varianceEpsilon:u}=r;null==u&&(u=.001);const c=n.data.get(a.dataId).values,h=n.data.get(o.dataId).values,d=n.data.get(l.dataId).values,p=i?n.data.get(i.dataId).values:new Float32Array([1]),f=s?n.data.get(s.dataId).values:new Float32Array([0]),m=new Float32Array(c.length),g=f.length,y=p.length,v=d.length,b=h.length;let x=0,T=0,_=0,w=0;for(let S=0;S<c.length;++S)m[S]=f[x++]+(c[S]-h[T++])*p[_++]/Math.sqrt(d[w++]+u),x>=g&&(x=0),T>=b&&(T=0),_>=y&&(_=0),w>=v&&(w=0);return n.makeTensorInfo(a.shape,a.dtype,m)}const batchNormConfig$1={kernelName:FusedBatchNorm,backendName:"cpu",kernelFunc:batchNorm$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function batchToSpaceND$1(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:i,crops:s}=r;assertNotComplex$1([a],"batchToSpaceND");const o=i.reduce(((e,t)=>e*t)),l=getReshaped(a.shape,i,o),u=getPermuted(l.length,i.length),c=getReshapedPermuted(a.shape,i,o),h=getSliceBeginCoords(s,i.length),d=getSliceSize(c,s,i.length),p=reshape$1({inputs:{x:a},backend:n,attrs:{shape:l}}),f=transpose$1({inputs:{x:p},backend:n,attrs:{perm:u}}),m=reshape$1({inputs:{x:f},backend:n,attrs:{shape:c}}),g=slice$1({inputs:{x:m},backend:n,attrs:{begin:h,size:d}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),g}const batchToSpaceNDConfig$1={kernelName:BatchToSpaceND,backendName:"cpu",kernelFunc:batchToSpaceND$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function bincount$1(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,weights:i}=t,{size:s}=r,o=bincountImpl(n.data.get(a.dataId).values,n.data.get(i.dataId).values,i.dtype,i.shape,s);return n.makeTensorInfo([s],i.dtype,o)}const bincountConfig$1={kernelName:Bincount,backendName:"cpu",kernelFunc:bincount$1};
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function broadcastArgs$1(e){const{inputs:t,backend:n}=e,{s0:r,s1:a}=t,i=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,o=assertAndGetBroadcastShape(Array.from(i),Array.from(s));return n.makeTensorInfo([o.length],"int32",Int32Array.from(o))}const broadcastArgsConfig$1={kernelName:BroadcastArgs,backendName:"cpu",kernelFunc:broadcastArgs$1},clipByValue$1=unaryKernelFunc$1(ClipByValue,((e,t)=>{const n=t;return e>n.clipValueMax?n.clipValueMax:e<n.clipValueMin?n.clipValueMin:e})),clipByValueConfig$1={kernelName:ClipByValue,backendName:"cpu",kernelFunc:clipByValue$1},complexAbs$1=e=>{const{x:t}=e.inputs,n=e.backend,r=new Float32Array(sizeFromShape(t.shape)),a=n.data.get(t.dataId),i=a.complexTensorInfos.real,s=a.complexTensorInfos.imag,o=n.data.get(i.dataId).values,l=n.data.get(s.dataId).values;for(let u=0;u<o.length;u++){const e=o[u],t=l[u];r[u]=Math.hypot(e,t)}return n.makeOutput(r,t.shape,"float32")},complexAbsConfig$1={kernelName:ComplexAbs,backendName:"cpu",kernelFunc:complexAbs$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the License);
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an AS IS BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function imag$1(e){const{inputs:t,backend:n}=e,{input:r}=t,a=n.data.get(r.dataId).complexTensorInfos.imag,i=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,i)}const imagConfig$1={kernelName:Imag,backendName:"cpu",kernelFunc:imag$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function concat$1(e){const{inputs:t,backend:n,attrs:r}=e,{axis:a}=r,i=parseAxisParam(a,t[0].shape)[0],s=t.map((e=>e.shape));assertParamsConsistent(s,i);let o=computeOutShape$1(t.map((e=>e.shape)),i);if(0===sizeFromShape(o))return n.makeTensorInfo(o,t[0].dtype,[]);const l=t.filter((e=>sizeFromShape(e.shape)>0));if(1===l.length)return identity$1({inputs:{x:l[0]},backend:n});if("complex64"===l[0].dtype){const e=l.map((e=>real$1({inputs:{input:e},backend:n}))),t=l.map((e=>imag$1({inputs:{input:e},backend:n}))),r=concat$1({inputs:e,backend:n,attrs:{axis:i}}),a=concat$1({inputs:t,backend:n,attrs:{axis:i}}),s=complex$1({inputs:{real:r,imag:a},backend:n});return e.forEach((e=>n.disposeIntermediateTensorInfo(e))),t.forEach((e=>n.disposeIntermediateTensorInfo(e))),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(a),s}const u=l.map((e=>{const t=sizeFromShape(e.shape.slice(i));return reshape$1({inputs:{x:e},backend:n,attrs:{shape:[-1,t]}})})),c=u.map((e=>({vals:n.data.get(e.dataId).values,shape:e.shape})));o=computeOutShape$1(u.map((e=>e.shape)),1);const h=1===u[0].shape[0],d=concatImpl$1(c,o,t[0].dtype,h),p=computeOutShape$1(l.map((e=>e.shape)),i),f=n.makeTensorInfo(p,t[0].dtype,d);return u.forEach((e=>n.disposeIntermediateTensorInfo(e))),f}const concatConfig$1={kernelName:Concat,backendName:"cpu",kernelFunc:concat$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function conv2D(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i}=t,{strides:s,pad:o,dataFormat:l,dilations:u,dimRoundingMode:c}=r;assertNotComplex$1([a,i],"conv2d");const h=convertConv2DDataFormat(l),d=computeConv2DInfo(a.shape,i.shape,s,u,o,c,!1,h),p=d.filterHeight,f=d.filterWidth,m=d.dilationHeight,g=d.dilationWidth,y=d.padInfo.left,v=d.padInfo.top,b="channelsLast"===d.dataFormat,x=new TensorBuffer(d.outShape,a.dtype),T=computeStrides(a.shape),_=computeStrides(i.shape),w=T[0],S=b?T[1]:T[2],C=b?T[2]:1,E=b?1:T[1],k=x.strides[0],I=b?x.strides[1]:x.strides[2],A=b?x.strides[2]:1,N=b?1:x.strides[1],$=n.data.get(a.dataId).values,D=n.data.get(i.dataId).values,P=x.values;for(let R=0;R<d.batchSize;++R){const e=R*w,t=R*k;for(let n=0;n<d.outHeight;++n){const r=t+n*I,a=n*d.strideHeight-v;for(let t=0;t<p;++t){const n=a+t*m;if(n<0||n>=d.inHeight)continue;const i=t*_[0],s=e+n*S;for(let e=0;e<d.outWidth;++e){const t=r+e*A,n=e*d.strideWidth-y;for(let e=0;e<f;++e){const r=n+e*g;if(r<0||r>=d.inWidth)continue;const a=s+r*C;let o=i+e*_[1];for(let e=0;e<d.inChannels;++e){const n=$[a+e*E];for(let e=0;e<d.outChannels;++e)P[t+e*N]+=n*D[o+e];o+=d.outChannels}}}}}}return n.makeTensorInfo(x.shape,x.dtype,P)}const conv2DConfig$1={kernelName:Conv2D$1,backendName:"cpu",kernelFunc:conv2D};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function conv2DBackpropFilter$1(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,dy:i}=t,{strides:s,pad:o,dataFormat:l,dimRoundingMode:u,filterShape:c}=r;assertNotComplex$1([a,i],"conv2dBackpropFilter");const h=convertConv2DDataFormat(l),d=computeConv2DInfo(a.shape,c,s,1,o,u,!1,h),{strideHeight:p,strideWidth:f,filterHeight:m,filterWidth:g}=d,y="channelsLast"===d.dataFormat,v=new TensorBuffer(d.filterShape,"float32"),b=d.padInfo.left,x=d.padInfo.top,T=n.data.get(a.dataId).values,_=n.data.get(i.dataId).values,w=new TensorBuffer(a.shape,a.dtype,T),S=new TensorBuffer(i.shape,i.dtype,_);for(let C=0;C<m;++C){const e=Math.max(0,Math.ceil((x-C)/p)),t=Math.min(d.outHeight,(d.inHeight+x-C)/p);for(let n=0;n<g;++n){const r=Math.max(0,Math.ceil((b-n)/f)),a=Math.min(d.outWidth,(d.inWidth+b-n)/f);for(let i=0;i<d.inChannels;++i)for(let s=0;s<d.outChannels;++s){let o=0;for(let l=0;l<d.batchSize;++l)for(let u=e;u<t;++u){const e=C+u*p-x;for(let t=r;t<a;++t){const r=n+t*f-b;o+=y?w.get(l,e,r,i)*S.get(l,u,t,s):w.get(l,i,e,r)*S.get(l,s,u,t)}}v.set(o,C,n,i,s)}}}return n.makeTensorInfo(v.shape,v.dtype,v.values)}const conv2DBackpropFilterConfig$1={kernelName:Conv2DBackpropFilter,backendName:"cpu",kernelFunc:conv2DBackpropFilter$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function conv2DBackpropInput$1(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:i}=t,{inputShape:s,strides:o,pad:l,dataFormat:u,dimRoundingMode:c}=r;assertNotComplex$1([a,i],"conv2dBackpropInput");const h=computeStrides(i.shape),d=computeStrides(a.shape);let p=convertConv2DDataFormat(u);const f=computeConv2DInfo(s,i.shape,o,1,l,c,!1,p),m=new TensorBuffer(f.inShape,"float32"),g=m.values,y=n.data.get(a.dataId).values,v=n.data.get(i.dataId).values,[b,x,T]=h,{batchSize:_,filterHeight:w,filterWidth:S,inChannels:C,inHeight:E,inWidth:k,outChannels:I,outHeight:A,outWidth:N,strideHeight:$,strideWidth:D}=f;p=f.dataFormat;const P=w-1-f.padInfo.top,R=S-1-f.padInfo.left,M="channelsLast"===p,O=m.strides[0],F=M?m.strides[1]:m.strides[2],L=M?m.strides[2]:1,B=M?1:m.strides[1],V=d[0],U=M?d[1]:d[2],z=M?d[2]:1,G=M?1:d[1];for(let W=0;W<_;++W)for(let e=0;e<C;++e)for(let t=0;t<E;++t){const n=t-P,r=Math.max(0,Math.ceil(n/$)),a=Math.min(A,(w+n)/$);for(let i=0;i<k;++i){const s=i-R,o=Math.max(0,Math.ceil(s/D)),l=Math.min(N,(S+s)/D);let u=0;for(let t=r;t<a;++t){const r=t*$-n;for(let n=o;n<l;++n){const a=V*W+U*t+z*n,i=b*(w-1-r)+x*(S-1-(n*D-s))+T*e;for(let e=0;e<I;++e){u+=y[a+G*e]*v[i+e]}}}g[O*W+F*t+L*i+B*e]=u}}return n.makeTensorInfo(m.shape,m.dtype,m.values)}const conv2DBackpropInputConfig$1={kernelName:Conv2DBackpropInput,backendName:"cpu",kernelFunc:conv2DBackpropInput$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function conv3D$1(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i}=t,{strides:s,pad:o,dilations:l}=r;assertNotComplex$1([a,i],"conv3d");const u=computeConv3DInfo(a.shape,i.shape,s,l,o),{filterDepth:c,filterHeight:h,filterWidth:d,dilationDepth:p,dilationHeight:f,dilationWidth:m,padInfo:g}=u,y=g.front,v=g.left,b=g.top,x=new TensorBuffer(u.outShape,a.dtype),T=n.data.get(a.dataId).values,_=n.data.get(i.dataId).values,w=x.values,S=computeStrides(a.shape),C=computeStrides(i.shape);for(let E=0;E<u.batchSize;++E){const e=E*S[0],t=E*x.strides[0];for(let n=0;n<u.outDepth;++n){const r=t+n*x.strides[1],a=n*u.strideDepth-y;for(let t=0;t<c;++t){const n=a+t*p;if(n<0||n>=u.inDepth)continue;const i=t*C[0],s=e+n*S[1];for(let e=0;e<u.outHeight;++e){const t=r+e*x.strides[2],n=e*u.strideHeight-b;for(let e=0;e<h;++e){const r=n+e*f;if(r<0||r>=u.inHeight)continue;const a=i+e*C[1],o=s+r*S[2];for(let e=0;e<u.outWidth;++e){const n=t+e*u.outChannels,r=e*u.strideWidth-v;for(let e=0;e<d;++e){const t=r+e*m;if(t<0||t>=u.inWidth)continue;const i=a+e*C[2],s=o+t*u.inChannels;let l=i;for(let e=0;e<u.inChannels;++e){const t=T[s+e];for(let e=0;e<u.outChannels;++e)w[n+e]+=t*_[l+e];l+=u.outChannels}}}}}}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}const conv3DConfig$1={kernelName:Conv3D$1,backendName:"cpu",kernelFunc:conv3D$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function conv3DBackpropFilterV2$1(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,dy:i}=t,{strides:s,pad:o,filterShape:l}=r;assertNotComplex$1([a,i],"conv3dBackpropFilterV2");const u=computeStrides(a.shape),c=computeStrides(i.shape),h=computeConv3DInfo(a.shape,l,s,1,o),d=h.strideDepth,p=h.strideHeight,f=h.strideWidth,m=h.filterDepth,g=h.filterHeight,y=h.filterWidth,v=new TensorBuffer(h.filterShape,"float32"),b=v.values,[x,T,_,w]=v.strides,S=n.data.get(i.dataId).values,[C,E,k,I]=c,A=n.data.get(a.dataId).values,[N,$,D,P]=u,R=h.padInfo.front,M=h.padInfo.left,O=h.padInfo.top;for(let F=0;F<m;++F){const e=Math.max(0,Math.ceil((R-F)/d)),t=Math.min(h.outDepth,(h.inDepth+R-F)/d),n=F*x;for(let r=0;r<g;++r){const a=Math.max(0,Math.ceil((O-r)/p)),i=Math.min(h.outHeight,(h.inHeight+O-r)/p),s=r*T+n;for(let n=0;n<y;++n){const o=Math.max(0,Math.ceil((M-n)/f)),l=Math.min(h.outWidth,(h.inWidth+M-n)/f),u=n*_+s;for(let s=0;s<h.inChannels;++s){const c=s*w+u;for(let u=0;u<h.outChannels;++u){let m=0;for(let c=0;c<h.batchSize;++c){const h=c*N,g=c*C;for(let c=e;c<t;++c){const e=(F+c*d-R)*$+h,t=c*E+g;for(let c=a;c<i;++c){const a=(r+c*p-O)*D+e,i=c*k+t;for(let e=o;e<l;++e){const t=e*I+i;m+=A[(n+e*f-M)*P+a+s]*S[t+u]}}}}b[c+u]=m}}}}}return n.makeTensorInfo(v.shape,v.dtype,v.values)}const conv3DBackpropFilterV2Config$1={kernelName:Conv3DBackpropFilterV2,backendName:"cpu",kernelFunc:conv3DBackpropFilterV2$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function conv3DBackpropInputV2(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:i}=t,{pad:s,strides:o,inputShape:l}=r;assertNotComplex$1([a],"conv3dBackpropInputV2");const u=computeStrides(a.shape),c=computeStrides(i.shape),h=computeConv3DInfo(l,i.shape,o,1,s),d=new TensorBuffer(h.inShape,"float32"),p=d.values,[f,m,g,y]=d.strides,v=n.data.get(a.dataId).values,[b,x,T,_]=u,w=n.data.get(i.dataId).values,[S,C,E,k]=c,{batchSize:I,filterDepth:A,filterHeight:N,filterWidth:$,inChannels:D,inDepth:P,inHeight:R,inWidth:M,outChannels:O,outDepth:F,outHeight:L,outWidth:B,strideDepth:V,strideHeight:U,strideWidth:z}=h,G=A-1-h.padInfo.front,W=N-1-h.padInfo.top,H=$-1-h.padInfo.left;for(let j=0;j<I;++j)for(let e=0;e<D;++e)for(let t=0;t<P;++t){const n=t-G,r=Math.max(0,Math.ceil(n/V)),a=Math.min(F,(A+n)/V);for(let i=0;i<R;++i){const s=i-W,o=Math.max(0,Math.ceil(s/U)),l=Math.min(L,(N+s)/U);for(let u=0;u<M;++u){const c=u-H,h=Math.max(0,Math.ceil(c/z)),d=Math.min(B,($+c)/z);let I=0;for(let t=r;t<a;++t){const r=t*V-n;for(let n=o;n<l;++n){const a=n*U-s;for(let i=h;i<d;++i){const s=b*j+x*t+T*n+_*i,o=S*(A-1-r)+C*(N-1-a)+E*($-1-(i*z-c))+k*e;for(let e=0;e<O;++e){I+=v[s+e]*w[o+e]}}}}p[f*j+m*t+g*i+y*u+e]=I}}}return n.makeTensorInfo(d.shape,d.dtype,d.values)}const conv3DBackpropInputV2Config={kernelName:Conv3DBackpropInputV2,backendName:"cpu",kernelFunc:conv3DBackpropInputV2},cos$1=unaryKernelFunc$1(Cos,(e=>Math.cos(e))),cosConfig$1={kernelName:Cos,backendName:"cpu",kernelFunc:cos$1},cosh$1=unaryKernelFunc$1(Cosh,(e=>Math.cosh(e))),coshConfig$1={kernelName:Cosh,backendName:"cpu",kernelFunc:cosh$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function cropAndResize$1(e){const{inputs:t,backend:n,attrs:r}=e,{image:a,boxes:i,boxInd:s}=t,{cropSize:o,method:l,extrapolationValue:u}=r,[c,h,d,p]=a.shape,f=i.shape[0],[m,g]=o,y=buffer([f,m,g,p],"float32"),v=n.data.get(i.dataId).values,b=n.data.get(s.dataId).values,x=n.data.get(a.dataId).values,T=computeStrides(a.shape),_=computeStrides(y.shape);for(let w=0;w<f;w++){const e=4*w,t=v[e],n=v[e+1],r=v[e+2],a=v[e+3],i=b[w];if(i>=c)continue;const s=m>1?(r-t)*(h-1)/(m-1):0,o=g>1?(a-n)*(d-1)/(g-1):0;for(let c=0;c<m;c++){const e=m>1?t*(h-1)+c*s:.5*(t+r)*(h-1);if(e<0||e>h-1)for(let t=0;t<g;t++)for(let e=0;e<p;e++){const n=e+t*_[2]+c*_[1]+w*_[0];y.values[n]=u}else if("bilinear"===l){const t=Math.floor(e),r=Math.ceil(e),s=e-t;for(let e=0;e<g;e++){const l=g>1?n*(d-1)+e*o:.5*(n+a)*(d-1);if(l<0||l>d-1){for(let t=0;t<p;t++){const n=t+e*_[2]+c*_[1]+w*_[0];y.values[n]=u}continue}const h=Math.floor(l),f=Math.ceil(l),m=l-h;for(let n=0;n<p;n++){let a=n+h*T[2]+t*T[1]+i*T[0];const o=x[a];a=n+f*T[2]+t*T[1]+i*T[0];const l=x[a];a=n+h*T[2]+r*T[1]+i*T[0];const u=x[a];a=n+f*T[2]+r*T[1]+i*T[0];const d=o+(l-o)*m,p=u+(x[a]-u)*m;a=n+e*_[2]+c*_[1]+w*_[0],y.values[a]=d+(p-d)*s}}}else for(let t=0;t<g;++t){const r=g>1?n*(d-1)+t*o:.5*(n+a)*(d-1);if(r<0||r>d-1){for(let e=0;e<p;e++){const n=e+t*_[2]+c*_[1]+w*_[0];y.values[n]=u}continue}const s=Math.round(r),l=Math.round(e);for(let e=0;e<p;e++){const n=e+s*T[2]+l*T[1]+i*T[0],r=e+t*_[2]+c*_[1]+w*_[0];y.values[r]=x[n]}}}}return n.makeTensorInfo(y.shape,y.dtype,y.values)}const cropAndResizeConfig$1={kernelName:CropAndResize,backendName:"cpu",kernelFunc:cropAndResize$1};
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function cumprod$1(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,exclusive:s,reverse:o}=r;assertNotComplex$1(a,"cumprod");const l=getAxesPermutation([i],a.shape.length);let u=a;null!=l&&(u=transpose$1({inputs:{x:a},backend:n,attrs:{perm:l}}));const c=getInnerMostAxes(1,a.shape.length)[0];if(c!==u.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${c}`);const h=upcastType(u.dtype,"int32"),d=makeOnesTypedArray(sizeFromShape(u.shape),h),p=n.data.get(u.dataId).values,f=u.shape[u.shape.length-1],m=o?(e,t)=>e+f-t-1:(e,t)=>e+t;for(let y=0;y<p.length;y+=f)for(let e=0;e<f;e++){const t=m(y,e);if(0===e)d[t]=s?1:p[t];else{const n=m(y,e-1);d[t]=s?p[n]*d[n]:p[t]*d[n]}}const g=n.makeTensorInfo(u.shape,h,d);if(null!=l){const e=transpose$1({inputs:{x:g},backend:n,attrs:{perm:getUndoAxesPermutation(l)}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(u),e}return g}const cumprodConfig$1={kernelName:Cumprod,backendName:"cpu",kernelFunc:cumprod$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function cumsum$1(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,exclusive:s,reverse:o}=r;assertNotComplex$1(a,"cumsum");const l=getAxesPermutation([i],a.shape.length);let u=a;null!=l&&(u=transpose$1({inputs:{x:a},backend:n,attrs:{perm:l}}));const c=getInnerMostAxes(1,a.shape.length)[0];if(c!==u.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${c}`);const h=upcastType(u.dtype,"int32"),d=makeZerosTypedArray(sizeFromShape(u.shape),h),p=n.data.get(u.dataId).values,f=u.shape[u.shape.length-1],m=o?(e,t)=>e+f-t-1:(e,t)=>e+t;for(let y=0;y<p.length;y+=f)for(let e=0;e<f;e++){const t=m(y,e);if(0===e)d[t]=s?0:p[t];else{const n=m(y,e-1);d[t]=s?p[n]+d[n]:p[t]+d[n]}}const g=n.makeTensorInfo(u.shape,h,d);if(null!=l){const e=transpose$1({inputs:{x:g},backend:n,attrs:{perm:getUndoAxesPermutation(l)}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(u),e}return g}const cumsumConfig$1={kernelName:Cumsum,backendName:"cpu",kernelFunc:cumsum$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function denseBincount$1(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,weights:i}=t,{size:s,binaryOutput:o}=r;if(1===a.shape.length){const e=bincountImpl(n.data.get(a.dataId).values,n.data.get(i.dataId).values,i.dtype,i.shape,s);return n.makeTensorInfo([s],i.dtype,e)}if(2===a.shape.length){const e=bincountReduceImpl(n.bufferSync(a),n.bufferSync(i),s,o);return n.makeTensorInfo(e.shape,i.dtype,e.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${a.shape.length}.`)}const denseBincountConfig$1={kernelName:DenseBincount,backendName:"cpu",kernelFunc:denseBincount$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function depthToSpace$1(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockSize:i,dataFormat:s}=r;assert$1("NHWC"===s,(()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${s}`));const o=a.shape[0],l=a.shape[1],u=a.shape[2],c=a.shape[3],h=l*i,d=u*i,p=c/(i*i),f=n.data.get(a.dataId).values,m=new Float32Array(o*h*d*p);let g=0;for(let y=0;y<o;++y)for(let e=0;e<h;++e){const t=Math.floor(e/i),n=e%i;for(let e=0;e<d;++e){const r=Math.floor(e/i),a=(n*i+e%i)*p;for(let e=0;e<p;++e){const n=e+a+c*(r+u*(t+l*y));m[g++]=f[n]}}}return n.makeTensorInfo([o,h,d,p],a.dtype,m)}const depthToSpaceConfig$1={kernelName:DepthToSpace,backendName:"cpu",kernelFunc:depthToSpace$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function depthwiseConv2dNative$1(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i}=t,{strides:s,pad:o,dilations:l,dimRoundingMode:u}=r;assertNotComplex$1([a,i],"depthwiseConv2DNative");const c=computeStrides(a.shape),h=computeStrides(i.shape);let d=l;null==d&&(d=[1,1]),assert$1(eitherStridesOrDilationsAreOne(s,d),(()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${s} and dilations '${d}'`));const p=computeConv2DInfo(a.shape,i.shape,s,d,o,u,!0),{filterHeight:f,filterWidth:m,dilationHeight:g,dilationWidth:y,padInfo:v}=p,b=v.left,x=v.top,T=p.outChannels/p.inChannels,_=new TensorBuffer(p.outShape,a.dtype),w=n.data.get(a.dataId).values,S=n.data.get(i.dataId).values,C=_.values;for(let E=0;E<p.batchSize;++E){const e=E*c[0],t=E*_.strides[0];for(let n=0;n<p.outHeight;++n){const r=t+n*_.strides[1],a=n*p.strideHeight-x;for(let t=0;t<f;++t){const n=a+t*g;if(n<0||n>=p.inHeight)continue;const i=t*h[0],s=e+n*c[1];for(let e=0;e<p.outWidth;++e){const t=r+e*_.strides[2],n=e*p.strideWidth-b;for(let e=0;e<m;++e){const r=n+e*y;if(r<0||r>=p.inWidth)continue;const a=i+e*h[1],o=s+r*p.inChannels;let l=t,u=a;for(let e=0;e<p.inChannels;++e){const t=w[o+e];for(let e=0;e<T;++e)C[l+e]+=t*S[u+e];l+=T,u+=T}}}}}}return n.makeTensorInfo(_.shape,_.dtype,_.values)}const depthwiseConv2dNativeConfig$1={kernelName:DepthwiseConv2dNative,backendName:"cpu",kernelFunc:depthwiseConv2dNative$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function depthwiseConv2dNativeBackpropFilter$1(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,dy:i}=t,{strides:s,dilations:o,pad:l,dimRoundingMode:u,filterShape:c}=r;assertNotComplex$1([a,i],"depthwiseConv2dNativeBackpropFilter");const h=computeConv2DInfo(a.shape,c,s,o,l,u,!0),{strideHeight:d,strideWidth:p,filterHeight:f,filterWidth:m}=h,g=new TensorBuffer(h.filterShape,"float32"),y=h.padInfo.left,v=h.padInfo.top,b=h.outChannels/h.inChannels,x=n.data.get(a.dataId).values,T=new TensorBuffer(a.shape,a.dtype,x),_=n.data.get(i.dataId).values,w=new TensorBuffer(i.shape,i.dtype,_);for(let S=0;S<f;++S){const e=Math.max(0,Math.ceil((v-S)/d)),t=Math.min(h.outHeight,(h.inHeight+v-S)/d);for(let n=0;n<m;++n){const r=Math.max(0,Math.ceil((y-n)/p)),a=Math.min(h.outWidth,(h.inWidth+y-n)/p);for(let i=0;i<h.outChannels;++i){const s=Math.trunc(i/b),o=i%b;let l=0;for(let u=0;u<h.batchSize;++u)for(let o=e;o<t;++o){const e=S+o*d-v;for(let t=r;t<a;++t){const r=n+t*p-y;l+=T.get(u,e,r,s)*w.get(u,o,t,i)}}g.set(l,S,n,s,o)}}}return n.makeTensorInfo(g.shape,g.dtype,g.values)}const depthwiseConv2dNativeBackpropFilterConfig$1={kernelName:DepthwiseConv2dNativeBackpropFilter,backendName:"cpu",kernelFunc:depthwiseConv2dNativeBackpropFilter$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function depthwiseConv2dNativeBackpropInput$1(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:i}=t,{strides:s,dilations:o,pad:l,dimRoundingMode:u,inputShape:c}=r;assertNotComplex$1([a,i],"depthwiseConv2DNativeBackpropInput");const h=computeStrides(a.shape),d=computeStrides(i.shape),p=computeConv2DInfo(c,i.shape,s,o,l,u,!0),f=new TensorBuffer(p.inShape,"float32"),m=f.values,[g,y,v]=f.strides,b=n.data.get(a.dataId).values,[x,T,_]=h,w=n.data.get(i.dataId).values,[S,C,E]=d,{batchSize:k,filterHeight:I,filterWidth:A,inChannels:N,inHeight:$,inWidth:D,outChannels:P,outHeight:R,outWidth:M,strideHeight:O,strideWidth:F}=p,L=I-1-p.padInfo.top,B=A-1-p.padInfo.left,V=P/N;for(let U=0;U<k;++U)for(let e=0;e<N;++e)for(let t=0;t<$;++t){const n=t-L,r=Math.max(0,Math.ceil(n/O)),a=Math.min(R,(I+n)/O);for(let i=0;i<D;++i){const s=i-B,o=Math.max(0,Math.ceil(s/F)),l=Math.min(M,(A+s)/F);let u=0;for(let t=r;t<a;++t){const r=t*O-n;for(let n=o;n<l;++n){const a=x*U+T*t+_*n,i=S*(I-1-r)+C*(A-1-(n*F-s))+E*e;for(let t=0;t<V;++t){u+=b[a+(e*V+t)]*w[i+t]}}}m[g*U+y*t+v*i+e]=u}}return n.makeTensorInfo(f.shape,f.dtype,f.values)}const depthwiseConv2dNativeBackpropInputConfig$1={kernelName:DepthwiseConv2dNativeBackpropInput,backendName:"cpu",kernelFunc:depthwiseConv2dNativeBackpropInput$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function diag$1(e){const{inputs:t,backend:n}=e,{x:r}=t,a=sizeFromShape(r.shape),i=n.data.get(r.dataId).values,s=buffer([a,a],r.dtype),o=s.values;for(let u=0;u<i.length;u++)o[u*a+u]=i[u];const l=[...r.shape,...r.shape];return n.makeTensorInfo(l,s.dtype,s.values)}const diagConfig$1={kernelName:Diag,backendName:"cpu",kernelFunc:diag$1},dilation2DConfig$1={kernelName:Dilation2D,backendName:"cpu",kernelFunc:({inputs:e,backend:t,attrs:n})=>{const{x:r,filter:a}=e,{strides:i,pad:s,dilations:o}=n,l=t,u=l.data.get(r.dataId).values,c=r.shape.length,h=l.data.get(a.dataId).values,d=a.shape.length,{batchSize:p,inHeight:f,inWidth:m,inChannels:g,outHeight:y,outWidth:v,padInfo:b,strideHeight:x,strideWidth:T,filterHeight:_,filterWidth:w,dilationHeight:S,dilationWidth:C,outShape:E}=computeDilation2DInfo(r.shape,a.shape,i,s,"NHWC",o),k=sizeFromShape(E),I=E.length,A=getArrayFromDType(r.dtype,k);for(let N=0;N<p;++N)for(let e=0;e<y;++e){const t=e*x-b.top;for(let n=0;n<v;++n){const i=n*T-b.left;for(let s=0;s<g;++s){let o=Number.MIN_SAFE_INTEGER;for(let e=0;e<_;++e){const n=t+e*S;if(n>=0&&n<f)for(let t=0;t<w;++t){const l=i+t*C;if(l>=0&&l<m){const i=locToIndex([N,n,l,s],c,computeStrides(r.shape)),p=locToIndex([e,t,s],d,computeStrides(a.shape)),f=u[i]+h[p];f>o&&(o=f)}}}A[locToIndex([N,e,n,s],I,computeStrides(E))]=o}}}return{dataId:l.write(toTypedArray(A,r.dtype),E,r.dtype),shape:E,dtype:r.dtype}}},dilation2DBackpropFilterConfig={kernelName:Dilation2DBackpropFilter,backendName:"cpu",kernelFunc:({inputs:e,backend:t,attrs:n})=>{const{x:r,filter:a,dy:i}=e,{strides:s,pad:o,dilations:l}=n,u=t,c=toNestedArray(r.shape,u.data.get(r.dataId).values),h=toNestedArray(a.shape,u.data.get(a.dataId).values),{batchSize:d,inHeight:p,inWidth:f,inChannels:m,outHeight:g,outWidth:y,padInfo:v,strideHeight:b,strideWidth:x,filterHeight:T,filterWidth:_,dilationHeight:w,dilationWidth:S,outShape:C}=computeDilation2DInfo(r.shape,a.shape,s,o,"NHWC",l);assert$1(i.rank===C.length,(()=>`Error in ${Dilation2DBackpropFilter}, dy must have the same rank as output ${C.length}, but got ${i.rank}`));const E=toNestedArray(C,u.data.get(i.dataId).values),k=makeZerosNestedTypedArray(a.shape,a.dtype);for(let I=0;I<d;++I)for(let e=0;e<g;++e){const t=e*b-v.top;for(let n=0;n<y;++n){const r=n*x-v.left;for(let a=0;a<m;++a){let i=Number.MIN_SAFE_INTEGER,s=0,o=0;for(let e=0;e<T;++e){const n=t+e*w;if(n>=0&&n<p)for(let t=0;t<_;++t){const l=r+t*S;if(l>=0&&l<f){const r=c[I][n][l][a]+h[e][t][a];r>i&&(i=r,s=e,o=t)}}}k[s][o][a]+=E[I][e][n][a]}}}return{dataId:u.write(toTypedArray(k,r.dtype),a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}},dilation2DBackpropInputConfig={kernelName:Dilation2DBackpropInput,backendName:"cpu",kernelFunc:({inputs:e,backend:t,attrs:n})=>{const{x:r,filter:a,dy:i}=e,{strides:s,pad:o,dilations:l}=n,u=t,c=toNestedArray(r.shape,u.data.get(r.dataId).values),h=toNestedArray(a.shape,u.data.get(a.dataId).values),{batchSize:d,inHeight:p,inWidth:f,inChannels:m,outHeight:g,outWidth:y,padInfo:v,strideHeight:b,strideWidth:x,filterHeight:T,filterWidth:_,dilationHeight:w,dilationWidth:S,outShape:C}=computeDilation2DInfo(r.shape,a.shape,s,o,"NHWC",l);assert$1(i.rank===C.length,(()=>`Error in ${Dilation2DBackpropInput}, dy must have the same rank as output ${C.length}, but got ${i.rank}`));const E=toNestedArray(C,u.data.get(i.dataId).values),k=makeZerosNestedTypedArray(r.shape,r.dtype);for(let I=0;I<d;++I)for(let e=0;e<g;++e){const t=e*b-v.top;for(let n=0;n<y;++n){const r=n*x-v.left;for(let a=0;a<m;++a){let i=Number.MIN_SAFE_INTEGER,s=t<0?0:t,o=r<0?0:r;for(let e=0;e<T;++e){const n=t+e*w;if(n>=0&&n<p)for(let t=0;t<_;++t){const l=r+t*S;if(l>=0&&l<f){const r=c[I][n][l][a]+h[e][t][a];r>i&&(i=r,s=n,o=l)}}}k[I][s][o][a]+=E[I][e][n][a]}}}return{dataId:u.write(toTypedArray(k,r.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2023 Google LLC.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function draw(e){const{inputs:t,backend:n,attrs:r}=e,{image:a}=t,{canvas:i,options:s}=r,{contextOptions:o,imageOptions:l}=s||{},u=(null==l?void 0:l.alpha)||1,c=(null==o?void 0:o.contextType)||"2d";if("2d"!==c)throw new Error(`Context type ${o.contextType} is not supported by the CPU backend.`);const h=i.getContext(c,(null==o?void 0:o.contextAttributes)||{});if(null==h)throw new Error(`Could not get the context with ${c} type.`);const[d,p]=a.shape.slice(0,2),f=2===a.shape.length?1:a.shape[2],m=n.data.get(a.dataId).values,g="float32"===a.dtype?255:1,y=new Uint8ClampedArray(p*d*4);for(let b=0;b<d*p;++b){const e=[0,0,0,255*u];for(let n=0;n<f;n++){const t=m[b*f+n];if("float32"===a.dtype){if(t<0||t>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${t}.`)}else if("int32"===a.dtype&&(t<0||t>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${t}.`);1===f?(e[0]=t*g,e[1]=t*g,e[2]=t*g):e[n]=t*g}const t=4*b;y[t+0]=Math.round(e[0]),y[t+1]=Math.round(e[1]),y[t+2]=Math.round(e[2]),y[t+3]=Math.round(e[3])}i.width=p,i.height=d;const v=new ImageData(y,p,d);return h.putImageData(v,0,0),a}const drawConfig={kernelName:Draw,backendName:"cpu",kernelFunc:draw};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function sum$1(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:s}=r;let o;assertNotComplex$1(a,"sum"),o="bool"===a.dtype?cast$1({inputs:{x:a},backend:n,attrs:{dtype:"int32"}}):identity$1({inputs:{x:a},backend:n});const l=o.shape.length,u=parseAxisParam(i,o.shape),c=getAxesPermutation(u,l);let h=u,d=o;null!=c&&(d=transpose$1({inputs:{x:o},backend:n,attrs:{perm:c}}),h=getInnerMostAxes(h.length,l)),assertAxesAreInnerMostDims("sum",h,d.shape.length);const[p,f]=computeOutAndReduceShapes(d.shape,h);let m=zeros(n,p,upcastType(d.dtype,"int32"));const g=sizeFromShape(f),y=n.data.get(m.dataId).values,v=n.data.get(d.dataId).values;for(let b=0;b<y.length;++b){const e=b*g;let t=0;for(let n=0;n<g;++n)t+=v[e+n];y[b]=t}if(s){const e=m;m=reshape$1({inputs:{x:m},backend:n,attrs:{shape:expandShapeToKeepDim(m.shape,u)}}),n.disposeIntermediateTensorInfo(e)}return n.disposeIntermediateTensorInfo(o),null!=c&&n.disposeIntermediateTensorInfo(d),m}const sumConfig$1={kernelName:Sum,backendName:"cpu",kernelFunc:sum$1};
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function einsum$1(e){const{inputs:t,backend:n,attrs:r}=e,{equation:a}=r,i=t,{allDims:s,summedDims:o,idDims:l}=decodeEinsumEquation(a,i.length);checkEinsumDimSizes(s.length,l,i);const{path:u,steps:c}=getEinsumComputePath(o,l),h=c.length;let d=null,p=s.length;const f=[];for(let m=0;m<h;++m){for(const e of c[m]){const{permutationIndices:t,expandDims:r}=getEinsumPermutation(p,l[e]);let a;isIdentityPermutation(t)?a=i[e]:(a=transpose$1({inputs:{x:i[e]},backend:n,attrs:{perm:t}}),f.push(a));const s=a.shape.slice();for(let e=0;e<r.length;++e)s.splice(r[e],0,1);arraysEqual(a.shape,s)||(a=reshape$1({inputs:{x:a},backend:n,attrs:{shape:s}}),f.push(a)),null===d?d=a:(d=multiply$1({inputs:{a:a,b:d},backend:n}),f.push(d))}m<h-1&&(u[m]>=0&&(d=sum$1({inputs:{x:d},backend:n,attrs:{axis:u[m]-(s.length-p),keepDims:!1}}),f.push(d)),p--)}for(const m of f)m!==d&&n.disposeIntermediateTensorInfo(m);return d}const einsumConfig$1={kernelName:Einsum,backendName:"cpu",kernelFunc:einsum$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function eluGrad$1(e){const{inputs:t,backend:n}=e,{dy:r,y:a}=t;assertNotComplex$1([r,a],"eluGrad");const i=new Float32Array(sizeFromShape(a.shape)),s=n.data.get(a.dataId).values,o=n.data.get(r.dataId).values;for(let l=0;l<s.length;++l){const e=s[l];i[l]=e>=0?o[l]:o[l]*(e+1)}return n.makeTensorInfo(a.shape,"float32",i)}const eluGradConfig$1={kernelName:EluGrad,backendName:"cpu",kernelFunc:eluGrad$1},p=ERF_P,a1=ERF_A1,a2=ERF_A2,a3=ERF_A3,a4=ERF_A4,a5=ERF_A5,erf$1=unaryKernelFunc$1(Erf,(e=>{const t=Math.sign(e),n=Math.abs(e),r=1/(1+p*n);return t*(1-((((a5*r+a4)*r+a3)*r+a2)*r+a1)*r*Math.exp(-n*n))})),erfConfig$1={kernelName:Erf,backendName:"cpu",kernelFunc:erf$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the License);
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an AS IS BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function expandDims$1(e){const{inputs:t,backend:n,attrs:r}=e,{input:a}=t,{dim:i}=r,s=a.shape.length,o=a.shape.slice();let l=i;return i<0&&(assert$1(-(s+1)<=i,(()=>`Axis must be in the interval [${-(s+1)}, ${s}]`)),l=s+i+1),o.splice(l,0,1),reshape$1({inputs:{x:a},backend:n,attrs:{shape:o}})}const expandDimsConfig$1={kernelName:ExpandDims,backendName:"cpu",kernelFunc:expandDims$1},realDivImpl=createSimpleBinaryKernelImpl(((e,t)=>e/t)),div=binaryKernelFunc$1(RealDiv,realDivImpl),realDivConfig$1={kernelName:RealDiv,backendName:"cpu",kernelFunc:div};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function fftBatch(e,t,n){const r=e.shape,a=r[0],i=r[1],s=n.data.get(e.dataId),o=s.complexTensorInfos.real,l=s.complexTensorInfos.imag,u=[a,i],c=sizeFromShape(u),h=getTypedArrayFromDType("float32",c),d=getTypedArrayFromDType("float32",c);for(let g=0;g<a;g++){const e=slice$1({inputs:{x:o},backend:n,attrs:{begin:[g,0],size:[1,i]}}),r=slice$1({inputs:{x:l},backend:n,attrs:{begin:[g,0],size:[1,i]}}),a=complex$1({inputs:{real:e,imag:r},backend:n}),{real:s,imag:u}=fftImpl$1(a,t,n),c=mergeRealAndImagArrays(s,u);for(let t=0;t<i;t++){const e=getComplexWithIndex(c,t);h[g*i+t]=e.real,d[g*i+t]=e.imag}n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(a)}const p=n.makeTensorInfo(u,"float32",h),f=n.makeTensorInfo(u,"float32",d),m=complex$1({inputs:{real:p,imag:f},backend:n});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),m}function fftImpl$1(e,t,n){const r=sizeFromShape(e.shape),a=n.data.get(e.dataId),i=n.data.get(a.complexTensorInfos.real.dataId).values,s=n.data.get(a.complexTensorInfos.imag.dataId).values;if(isExponentOf2(r)){const a=fftRadix2(i,s,r,t,n),o=[e.shape[0],e.shape[1]];if(t){const e=n.makeTensorInfo(o,"float32",a.real),t=n.makeTensorInfo(o,"float32",a.imag),i=n.makeTensorInfo([],"float32",createScalarValue(r,"float32")),s=identity$1({inputs:{x:i},backend:n}),l=realDivConfig$1.kernelFunc({inputs:{a:e,b:i},backend:n}),u=realDivConfig$1.kernelFunc({inputs:{a:t,b:s},backend:n}),c=n.data.get(l.dataId).values,h=n.data.get(u.dataId).values;return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(u),{real:c,imag:h}}return a}return splitRealAndImagArrays(fourierTransformByMatmul(mergeRealAndImagArrays(i,s),r,t))}function isExponentOf2(e){return 0==(e&e-1)}function fftRadix2(e,t,n,r,a){if(1===n)return{real:e,imag:t};const i=mergeRealAndImagArrays(e,t),s=n/2,o=complexWithEvenIndex(i),l=o.real,u=o.imag,c=[l.length],h=a.makeTensorInfo(c,"float32",l),d=a.makeTensorInfo(c,"float32",u),p=complex$1({inputs:{real:h,imag:d},backend:a}),f=complexWithOddIndex(i),m=f.real,g=f.imag,y=[m.length],v=a.makeTensorInfo(y,"float32",m),b=a.makeTensorInfo(y,"float32",g),x=complex$1({inputs:{real:v,imag:b},backend:a}),T=fftRadix2(l,u,s,r,a),_=T.real,w=T.imag,S=[_.length],C=a.makeTensorInfo(S,"float32",_),E=a.makeTensorInfo(S,"float32",w),k=complex$1({inputs:{real:C,imag:E},backend:a}),I=fftRadix2(m,g,s,r,a),A=I.real,N=I.imag,$=[A.length],D=a.makeTensorInfo($,"float32",A),P=a.makeTensorInfo($,"float32",N),R=complex$1({inputs:{real:D,imag:P},backend:a}),M=exponents(n,r),O=[M.real.length],F=a.makeTensorInfo(O,"float32",M.real),L=a.makeTensorInfo(O,"float32",M.imag),B=complex$1({inputs:{real:F,imag:L},backend:a}),V=multiply$1({inputs:{a:B,b:R},backend:a}),U=add({inputs:{a:k,b:V},backend:a}),z=sub$1({inputs:{a:k,b:V},backend:a}),G=real$1({inputs:{input:U},backend:a}),W=real$1({inputs:{input:z},backend:a}),H=imag$1({inputs:{input:U},backend:a}),j=imag$1({inputs:{input:z},backend:a}),q=concat$1({inputs:[G,W],backend:a,attrs:{axis:0}}),K=concat$1({inputs:[H,j],backend:a,attrs:{axis:0}}),X=a.data.get(q.dataId).values,Y=a.data.get(K.dataId).values;return a.disposeIntermediateTensorInfo(h),a.disposeIntermediateTensorInfo(d),a.disposeIntermediateTensorInfo(p),a.disposeIntermediateTensorInfo(v),a.disposeIntermediateTensorInfo(b),a.disposeIntermediateTensorInfo(x),a.disposeIntermediateTensorInfo(C),a.disposeIntermediateTensorInfo(E),a.disposeIntermediateTensorInfo(k),a.disposeIntermediateTensorInfo(D),a.disposeIntermediateTensorInfo(P),a.disposeIntermediateTensorInfo(R),a.disposeIntermediateTensorInfo(F),a.disposeIntermediateTensorInfo(L),a.disposeIntermediateTensorInfo(B),a.disposeIntermediateTensorInfo(V),a.disposeIntermediateTensorInfo(U),a.disposeIntermediateTensorInfo(z),a.disposeIntermediateTensorInfo(G),a.disposeIntermediateTensorInfo(H),a.disposeIntermediateTensorInfo(W),a.disposeIntermediateTensorInfo(j),a.disposeIntermediateTensorInfo(q),a.disposeIntermediateTensorInfo(K),{real:X,imag:Y}}function fourierTransformByMatmul(e,t,n){const r=new Float32Array(2*t);for(let a=0;a<t;a++){let i=0,s=0;for(let r=0;r<t;r++){const o=exponent(a*r,t,n),l=getComplexWithIndex(e,r);i+=l.real*o.real-l.imag*o.imag,s+=l.real*o.imag+l.imag*o.real}n&&(i/=t,s/=t),assignToTypedArray(r,i,s,a)}return r}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function fft$1(e){const{inputs:t,backend:n}=e,{input:r}=t,a=sizeFromShape(r.shape),i=r.shape[r.shape.length-1],s=reshape$1({inputs:{x:r},backend:n,attrs:{shape:[a/i,i]}}),o=fftBatch(s,!1,n),l=reshape$1({inputs:{x:o},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(o),l}const fftConfig$1={kernelName:FFT,backendName:"cpu",kernelFunc:fft$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function fill$1(e){const{backend:t,attrs:n}=e,{shape:r,value:a,dtype:i}=n,s=i||inferDtype(a),o=getArrayFromDType(s,sizeFromShape(r));return fillValues(o,a,s),t.makeTensorInfo(r,s,o)}const fillConfig$1={kernelName:Fill,backendName:"cpu",kernelFunc:fill$1};function fillValues(e,t,n){e.fill(t)}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const flipLeftRightConfig$1={kernelName:FlipLeftRight,backendName:"cpu",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{image:r}=e,a=n,i=getTypedArrayFromDType(r.dtype,sizeFromShape(r.shape)),[s,o,l,u]=r.shape,c=a.data.get(r.dataId).values;for(let h=0;h<s;h++){const e=h*l*o*u;for(let t=0;t<o;t++){const n=t*(l*u);for(let t=0;t<l;t++){const r=t*u;for(let a=0;a<u;a++){const s=Math.round(l-t-1),o=e+n+r+a;let h=c[o];if(s>=0&&s<l){h=c[e+n+s*u+a]}i[o]=h}}}}return{dataId:a.write(i,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function fusedConv2D(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i,bias:s,preluActivationWeights:o}=t,{strides:l,pad:u,dataFormat:c,dilations:h,dimRoundingMode:d,activation:p,leakyreluAlpha:f}=r;let m=conv2D({inputs:{x:a,filter:i},backend:n,attrs:{strides:l,pad:u,dataFormat:c,dilations:h,dimRoundingMode:d}});if(s){const e=m;if("NCHW"===c&&1===s.shape.length&&1!==s.shape[0]){const e=reshape$1({inputs:{x:s},backend:n,attrs:{shape:[s.shape[0],1,1]}});m=add({inputs:{a:m,b:e},backend:n}),n.disposeIntermediateTensorInfo(e)}else m=add({inputs:{a:m,b:s},backend:n});n.disposeIntermediateTensorInfo(e)}if(p){const e=m;if("NCHW"===c&&"prelu"===p&&1===o.shape.length&&1!==o.shape[0]){const e=reshape$1({inputs:{x:o},backend:n,attrs:{shape:[o.shape[0],1,1]}});m=applyActivation(n,m,p,e,f),n.disposeIntermediateTensorInfo(e)}else m=applyActivation(n,m,p,o,f);n.disposeIntermediateTensorInfo(e)}return m}const fusedConv2DConfig$1={kernelName:FusedConv2D,backendName:"cpu",kernelFunc:fusedConv2D};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function fusedDepthwiseConv2D$1(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i,bias:s,preluActivationWeights:o}=t,{strides:l,pad:u,dataFormat:c,dilations:h,dimRoundingMode:d,activation:p,leakyreluAlpha:f}=r;let m=depthwiseConv2dNative$1({inputs:{x:a,filter:i},backend:n,attrs:{strides:l,pad:u,dataFormat:c,dilations:h,dimRoundingMode:d}});if(s){const e=m;m=add({inputs:{a:m,b:s},backend:n}),n.disposeIntermediateTensorInfo(e)}if(p){const e=m;m=applyActivation(n,m,p,o,f),n.disposeIntermediateTensorInfo(e)}return m}const fusedDepthwiseConv2DConfig$1={kernelName:FusedDepthwiseConv2D,backendName:"cpu",kernelFunc:fusedDepthwiseConv2D$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function gatherNd$1(e){const{inputs:t,backend:n}=e,{params:r,indices:a}=t,i=sizeFromShape(r.shape),s=a.shape,o=s[s.length-1],[l,u,c,h]=prepareAndValidate(r,a);if(0===u)return n.makeTensorInfo(l,r.dtype,[]);const d=gatherNdImpl(n.data.get(a.dataId).values,n.bufferSync(r),r.dtype,u,o,c,h,r.shape,i);return n.makeTensorInfo(l,r.dtype,d.values)}const gatherNdConfig$1={kernelName:GatherNd,backendName:"cpu",kernelFunc:gatherNd$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function gatherV2$1(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,indices:i}=t,{axis:s,batchDims:o}=r;assertNotComplex$1([a,i],"gatherV2");const l=parseAxisParam(s,a.shape)[0],u=n.data.get(i.dataId).values,c=a.shape[l];for(let b=0;b<u.length;++b){const e=u[b];assert$1(e<=c-1&&e>=0,(()=>`GatherV2: the index value ${e} is not in [0, ${c-1}]`))}let h=o;null==o&&(h=0);const d=sizeFromShape(i.shape),p=collectGatherOpShapeInfo(a,i,l,h),f=reshape$1({inputs:{x:a},backend:n,attrs:{shape:[p.batchSize,p.outerSize,p.dimSize,p.sliceSize]}}),m=reshape$1({inputs:{x:i},backend:n,attrs:{shape:[p.batchSize,d/p.batchSize]}}),g=[p.batchSize,p.outerSize,d/p.batchSize,p.sliceSize],y=n.bufferSync(m),v=gatherV2Impl(n.bufferSync(f),y,g);return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),n.makeTensorInfo(p.outputShape,v.dtype,v.values)}const gatherV2Config$1={kernelName:GatherV2,backendName:"cpu",kernelFunc:gatherV2$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function ifft$1(e){const{inputs:t,backend:n}=e,{input:r}=t,a=sizeFromShape(r.shape),i=r.shape[r.shape.length-1],s=reshape$1({inputs:{x:r},backend:n,attrs:{shape:[a/i,i]}}),o=fftBatch(s,!0,n),l=reshape$1({inputs:{x:o},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(o),l}const ifftConfig$1={kernelName:IFFT,backendName:"cpu",kernelFunc:ifft$1},isFinite$2=unaryKernelFunc$1(IsFinite,(e=>Number.isFinite(e)?1:0),"bool"),isFiniteConfig$1={kernelName:IsFinite,backendName:"cpu",kernelFunc:isFinite$2},isInf$1=unaryKernelFunc$1(IsInf,(e=>Math.abs(e)===1/0?1:0),"bool"),isInfConfig$1={kernelName:IsInf,backendName:"cpu",kernelFunc:isInf$1},isNaN$2=unaryKernelFunc$1(IsNan,(e=>Number.isNaN(e)?1:0),"bool"),isNaNConfig$1={kernelName:IsNan,backendName:"cpu",kernelFunc:isNaN$2};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the License);
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an AS IS BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function linSpace$1(e){const{backend:t,attrs:n}=e,{start:r,stop:a,num:i}=n,s=linSpaceImpl(r,a,i);return t.makeTensorInfo([s.length],"float32",s)}const linSpaceConfig$1={kernelName:LinSpace,backendName:"cpu",kernelFunc:linSpace$1},log1p$1=unaryKernelFunc$1(Log1p,(e=>Math.log1p(e))),log1pConfig$1={kernelName:Log1p,backendName:"cpu",kernelFunc:log1p$1},logicalAndImpl=createSimpleBinaryKernelImpl(((e,t)=>e&&t)),logicalAnd$1=binaryKernelFunc$1(LogicalAnd,logicalAndImpl,null,"bool"),logicalAndConfig$1={kernelName:LogicalAnd,backendName:"cpu",kernelFunc:logicalAnd$1},logicalNot$1=unaryKernelFunc$1(LogicalNot,(e=>e?0:1),"bool"),logicalNotConfig$1={kernelName:LogicalNot,backendName:"cpu",kernelFunc:logicalNot$1},logicalOrImpl=createSimpleBinaryKernelImpl(((e,t)=>e||t)),logicalOr$1=binaryKernelFunc$1(LogicalOr,logicalOrImpl,null,"bool"),logicalOrConfig$1={kernelName:LogicalOr,backendName:"cpu",kernelFunc:logicalOr$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the License);
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an AS IS BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function lRN(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{depthRadius:i,bias:s,alpha:o,beta:l}=r;assertNotComplex$1(a,"LRN");const u=a.shape[3],c=u-1,h=n.data.get(a.dataId).values,d=sizeFromShape(a.shape),p=new Float32Array(d);function f(e){const t=e%u;let n=e-t+Math.max(0,t-i);const r=e-t+Math.min(t+i,c);let a=0;for(;n<=r;n++){const e=h[n];a+=e*e}return a}for(let m=0;m<d;m++){const e=f(m),t=h[m]*Math.pow(s+o*e,-l);p[m]=t}return n.makeTensorInfo(a.shape,a.dtype,p)}const LRNConfig$1={kernelName:LRN,backendName:"cpu",kernelFunc:lRN};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function lRNGrad(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,y:i,dy:s}=t,{depthRadius:o,bias:l,alpha:u,beta:c}=r;assertNotComplex$1(s,"LRNGrad");const h=sizeFromShape(s.shape),d=s.shape[3],p=n.data.get(s.dataId).values,f=n.data.get(a.dataId).values,m=n.data.get(i.dataId).values,g=new Float32Array(h),y=h;for(let v=0;v<y;v++){const e=v%d,t=v-e+Math.max(0,e-o),n=v-e+Math.min(d,e+o+1);let r=0;for(let a=t;a<n;a++)r+=Math.pow(f[a],2);r=u*r+l;for(let a=t;a<n;a++){let e=-2*u*c*f[a]*m[v]/r;v===a&&(e+=Math.pow(r,-c)),e*=p[v],g[a]+=e}}return n.makeTensorInfo(s.shape,a.dtype,g)}const LRNGradConfig$1={kernelName:LRNGrad,backendName:"cpu",kernelFunc:lRNGrad};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function max$1(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{reductionIndices:i,keepDims:s}=r,o=n;let l=a.shape;const u=l.length,c=parseAxisParam(i,l);let h=c;const d=getAxesPermutation(h,u);let p=o.data.get(a.dataId).values;if(null!=d){const e=new Array(u);for(let t=0;t<e.length;t++)e[t]=l[d[t]];p=transposeImpl$1(p,l,a.dtype,d,e),h=getInnerMostAxes(h.length,u),l=e}assertNotComplex$1(a,"max"),assertAxesAreInnerMostDims("max",h,u);const[f,m]=computeOutAndReduceShapes(l,h),g=maxImpl$1(p,sizeFromShape(m),f,a.dtype),y=o.write(g,f,a.dtype);let v=f;if(s){v=expandShapeToKeepDim(f,c)}return{dataId:y,shape:v,dtype:a.dtype}}const maxConfig$1={kernelName:Max,backendName:"cpu",kernelFunc:max$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function maxPool$1(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t;assertNotComplex$1(a,"maxPool");const{filterSize:i,strides:s,pad:o,dimRoundingMode:l}=r;assert$1(eitherStridesOrDilationsAreOne(s,1),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${s} and dilations '1'`));const u=computePool2DInfo(a.shape,i,s,1,o,l);let c;if(1===u.filterWidth&&1===u.filterHeight&&arraysEqual(u.inShape,u.outShape))c=identity$1({inputs:{x:a},backend:n});else{const e=n.data.get(a.dataId).values,t=computeStrides(a.shape),r=pool(e,a.shape,a.dtype,t,u,"max");c=n.makeTensorInfo(u.outShape,a.dtype,r.values)}return c}const maxPoolConfig$1={kernelName:MaxPool,backendName:"cpu",kernelFunc:maxPool$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function maxPool3D(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{filterSize:i,strides:s,pad:o,dimRoundingMode:l,dataFormat:u}=r;assertNotComplex$1(a,"maxPool3d");const c=computePool3DInfo(a.shape,i,s,1,o,l,u),h=pool3d(n.data.get(a.dataId).values,a.shape,a.dtype,computeStrides(a.shape),c,"max");return n.makeTensorInfo(h.shape,"float32",h.values)}const maxPool3DConfig$1={kernelName:MaxPool3D,backendName:"cpu",kernelFunc:maxPool3D};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function maxPool3DGrad$1(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,input:i}=t,{filterSize:s,strides:o,pad:l,dimRoundingMode:u}=r;assertNotComplex$1([a,i],"maxPool3DGrad");const c=computePool3DInfo(i.shape,s,o,1,l,u),h=maxPool3dPositions(n.bufferSync(i),c),d=c.strideDepth,p=c.strideHeight,f=c.strideWidth,m=c.dilationDepth,g=c.dilationHeight,y=c.dilationWidth,v=c.effectiveFilterDepth,b=c.effectiveFilterHeight,x=c.effectiveFilterWidth,T=v-1-c.padInfo.front,_=x-1-c.padInfo.left,w=b-1-c.padInfo.top,S=buffer(i.shape,"float32"),C=n.bufferSync(a);for(let E=0;E<c.batchSize;++E)for(let e=0;e<c.inChannels;++e)for(let t=0;t<c.inDepth;++t)for(let n=0;n<c.inHeight;++n)for(let r=0;r<c.inWidth;++r){const a=t-T,i=n-w,s=r-_;let o=0;for(let t=0;t<v;t+=m){const n=(a+t)/d;if(!(n<0||n>=c.outDepth||Math.floor(n)!==n))for(let r=0;r<b;r+=g){const a=(i+r)/p;if(!(a<0||a>=c.outHeight||Math.floor(a)!==a))for(let i=0;i<x;i+=y){const l=(s+i)/f;if(l<0||l>=c.outWidth||Math.floor(l)!==l)continue;const u=v*b*x-1-h.get(E,n,a,l,e)===t*b*x+r*x+i?1:0;if(0===u)continue;o+=C.get(E,n,a,l,e)*u}}}S.set(o,E,t,n,r,e)}return n.makeTensorInfo(S.shape,S.dtype,S.values)}const maxPool3DGradConfig$1={kernelName:MaxPool3DGrad,backendName:"cpu",kernelFunc:maxPool3DGrad$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function maxPoolGrad$1(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,input:i,output:s}=t,o=i;assertNotComplex$1([i,s],"maxPoolGrad");const{filterSize:l,strides:u,pad:c,dimRoundingMode:h}=r,d=computePool2DInfo(o.shape,l,u,1,c,h),p=n.data.get(o.dataId).values,f=buffer(d.outShape,o.dtype,maxPoolPositions(p,o.shape,o.dtype,d).values),m=d.strideHeight,g=d.strideWidth,y=d.dilationHeight,v=d.dilationWidth,b=d.effectiveFilterHeight,x=d.effectiveFilterWidth,T=x-1-d.padInfo.left,_=b-1-d.padInfo.top,w=buffer(o.shape,"float32"),S=n.data.get(a.dataId).values,C=buffer(a.shape,"float32",S);for(let E=0;E<d.batchSize;++E)for(let e=0;e<d.inChannels;++e)for(let t=0;t<d.inHeight;++t)for(let n=0;n<d.inWidth;++n){const r=t-_,a=n-T;let i=0;for(let t=0;t<b;t+=y){const n=(r+t)/m;if(!(n<0||n>=d.outHeight||Math.floor(n)!==n))for(let r=0;r<x;r+=v){const s=(a+r)/g;if(s<0||s>=d.outWidth||Math.floor(s)!==s)continue;const o=b*x-1-f.get(E,n,s,e)===t*x+r?1:0;if(0===o)continue;i+=C.get(E,n,s,e)*o}}w.set(i,E,t,n,e)}return n.makeTensorInfo(w.shape,w.dtype,w.values)}const maxPoolGradConfig$1={kernelName:MaxPoolGrad,backendName:"cpu",kernelFunc:maxPoolGrad$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function maxPoolWithArgmaxImpl$1(e,t,n,r,a){const i=pool(e,t,n,computeStrides(t),a,"max"),s=maxPoolPositions(e,t,n,a,!0,r);return[i.values,s.values]}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const maxPoolWithArgmaxConfig$1={kernelName:MaxPoolWithArgmax,backendName:"cpu",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{x:r}=e,{filterSize:a,strides:i,pad:s,includeBatchInIndex:o}=t,l=n;assertNotComplex$1(r,"MaxPoolWithArgmax");const u=l.data.get(r.dataId).values,c=computePool2DInfo(r.shape,a,i,[1,1],s),[h,d]=maxPoolWithArgmaxImpl$1(u,r.shape,r.dtype,o,c),p=l.write(h,c.outShape,r.dtype),f=l.write(d,c.outShape,r.dtype);return[{dataId:p,shape:c.outShape,dtype:r.dtype},{dataId:f,shape:c.outShape,dtype:"int32"}]}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function mean(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:s}=r,o=parseAxisParam(i,a.shape),l=sizeFromShape(computeOutAndReduceShapes(a.shape,o)[1]),u=[],c=n.makeTensorInfo([],"float32",new Float32Array([l]));u.push(c);const h=cast$1({inputs:{x:a},backend:n,attrs:{dtype:"float32"}});u.push(h);const d=div({inputs:{a:h,b:c},backend:n});u.push(d);const p=sum$1({inputs:{x:d},backend:n,attrs:{axis:i,keepDims:s}});return u.forEach((e=>n.disposeIntermediateTensorInfo(e))),p}const meanConfig$1={kernelName:Mean,backendName:"cpu",kernelFunc:mean};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function min$1(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:s}=r;assertNotComplex$1(a,"min");const o=parseAxisParam(i,a.shape);let l=o;const u=getAxesPermutation(l,a.shape.length);let c=a;null!=u&&(c=transpose$1({inputs:{x:a},backend:n,attrs:{perm:u}}),l=getInnerMostAxes(l.length,a.shape.length)),assertAxesAreInnerMostDims("min",l,c.shape.length);const[h,d]=computeOutAndReduceShapes(c.shape,l),p=sizeFromShape(d),f=makeZerosTypedArray(sizeFromShape(h),c.dtype),m=n.data.get(c.dataId).values;for(let y=0;y<f.length;++y){const e=y*p;let t=m[e];for(let n=0;n<p;++n){const r=m[e+n];(Number.isNaN(r)||r<t)&&(t=r)}f[y]=t}null!=u&&n.disposeIntermediateTensorInfo(c);const g=n.makeTensorInfo(h,c.dtype,f);if(s){const e=reshape$1({inputs:{x:g},backend:n,attrs:{shape:expandShapeToKeepDim(h,o)}});return n.disposeIntermediateTensorInfo(g),e}return g}const minConfig$1={kernelName:Min,backendName:"cpu",kernelFunc:min$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function mirrorPad(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{paddings:i,mode:s}=r;assertNotComplex$1(a,"mirrorPad");const o=i.map(((e,t)=>e[0]+a.shape[t]+e[1])),l=i.map((e=>e[0])),u=i.map(((e,t)=>e[0]+a.shape[t])),c="reflect"===s?0:1,h=n.data.get(a.dataId).values,d=a.shape.length,p=computeStrides(a.shape),f=sizeFromShape(o),m=o.length,g=computeStrides(o),y=getTypedArrayFromDType(a.dtype,f);for(let v=0;v<f;v++){let e=indexToLoc(v,m,g);for(let n=0;n<m;n++)e[n]<l[n]?e[n]=2*l[n]-e[n]-c:e[n]>=u[n]&&(e[n]=2*(u[n]-1)-e[n]+c);e=e.map(((e,t)=>e-l[t]));const t=locToIndex(e,d,p);y[v]=h[t]}return{dataId:n.write(y,o,a.dtype),shape:o,dtype:a.dtype}}const mirrorPadConfig$1={kernelName:MirrorPad,backendName:"cpu",kernelFunc:mirrorPad},modImpl=createSimpleBinaryKernelImpl(((e,t)=>{const n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t})),mod$1=binaryKernelFunc$1(Mod,modImpl),modConfig$1={kernelName:Mod,backendName:"cpu",kernelFunc:mod$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function softmax$1(e){const{inputs:t,backend:n,attrs:r}=e,{logits:a}=t,{dim:i}=r,s=a.shape.length;let o=i;if(-1===o&&(o=s-1),o!==s-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${s} and dim was ${o}`);const l=parseAxisParam([o],a.shape),u=max$1({inputs:{x:a},backend:n,attrs:{reductionIndices:l,keepDims:!1}}),c=expandShapeToKeepDim(u.shape,l),h=reshape$1({inputs:{x:u},backend:n,attrs:{shape:c}}),d=sub$1({inputs:{a:a,b:h},backend:n}),p=exp$1({inputs:{x:d},backend:n}),f=sum$1({inputs:{x:p},backend:n,attrs:{axis:l,keepDims:!1}}),m=reshape$1({inputs:{x:f},backend:n,attrs:{shape:c}}),g=div({inputs:{a:p,b:m},backend:n});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),g}const softmaxConfig$1={kernelName:Softmax$2,backendName:"cpu",kernelFunc:softmax$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function multinomial$1(e){const{inputs:t,backend:n,attrs:r}=e,{logits:a}=t,{numSamples:i,seed:s,normalized:o}=r;assertNotComplex$1(a,"multinomial");const l=o?a:softmax$1({inputs:{logits:a},backend:n,attrs:{dim:-1}}),u=l.shape[0],c=l.shape[1],h=n.data.get(l.dataId).values,d=[u,i],p=makeZerosTypedArray(sizeFromShape(d),"int32");for(let f=0;f<u;++f){const e=f*c,t=new Float32Array(c-1);t[0]=h[e];for(let a=1;a<t.length;++a)t[a]=t[a-1]+h[e+a];const n=seedrandom.alea(s.toString()),r=f*i;for(let a=0;a<i;++a){const e=n();p[r+a]=t.length;for(let n=0;n<t.length;n++)if(e<t[n]){p[r+a]=n;break}}}return o||n.disposeIntermediateTensorInfo(l),n.makeTensorInfo(d,"int32",p)}const multinomialConfig$1={kernelName:Multinomial,backendName:"cpu",kernelFunc:multinomial$1},nonMaxSuppressionV3Impl$1=nonMaxSuppressionV3Impl$2;
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function nonMaxSuppressionV3$1(e){const{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:i}=t,{maxOutputSize:s,iouThreshold:o,scoreThreshold:l}=r;assertNotComplex$1(a,"NonMaxSuppression");const u=n.data.get(a.dataId).values,c=n.data.get(i.dataId).values,{selectedIndices:h}=nonMaxSuppressionV3Impl$1(u,c,s,o,l);return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}const nonMaxSuppressionV3Config$1={kernelName:NonMaxSuppressionV3,backendName:"cpu",kernelFunc:nonMaxSuppressionV3$1},nonMaxSuppressionV4Impl$1=nonMaxSuppressionV4Impl$2;
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function nonMaxSuppressionV4$1(e){const{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:i}=t,{maxOutputSize:s,iouThreshold:o,scoreThreshold:l,padToMaxOutputSize:u}=r;assertNotComplex$1(a,"NonMaxSuppressionPadded");const c=n.data.get(a.dataId).values,h=n.data.get(i.dataId).values,{selectedIndices:d,validOutputs:p}=nonMaxSuppressionV4Impl$1(c,h,s,o,l,u);return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([],"int32",new Int32Array([p]))]}const nonMaxSuppressionV4Config$1={kernelName:NonMaxSuppressionV4,backendName:"cpu",kernelFunc:nonMaxSuppressionV4$1},nonMaxSuppressionV5Impl$1=nonMaxSuppressionV5Impl$2;
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function nonMaxSuppressionV5$1(e){const{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:i}=t,{maxOutputSize:s,iouThreshold:o,scoreThreshold:l,softNmsSigma:u}=r;assertNotComplex$1(a,"NonMaxSuppressionWithScore");const c=n.data.get(a.dataId).values,h=n.data.get(i.dataId).values,d=s,p=o,f=l,m=u,{selectedIndices:g,selectedScores:y}=nonMaxSuppressionV5Impl$1(c,h,d,p,f,m);return[n.makeTensorInfo([g.length],"int32",new Int32Array(g)),n.makeTensorInfo([y.length],"float32",new Float32Array(y))]}const nonMaxSuppressionV5Config$1={kernelName:NonMaxSuppressionV5,backendName:"cpu",kernelFunc:nonMaxSuppressionV5$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function oneHot$1(e){const{inputs:t,backend:n,attrs:r}=e,{indices:a}=t,{dtype:i,depth:s,onValue:o,offValue:l}=r;assertNotComplex$1(a,"oneHot");const u=sizeFromShape(a.shape),c=new Float32Array(u*s);c.fill(l);const h=n.data.get(a.dataId).values;for(let d=0;d<u;++d)h[d]>=0&&h[d]<s&&(c[d*s+h[d]]=o);return n.makeTensorInfo([...a.shape,s],i,c)}const oneHotConfig$1={kernelName:OneHot,backendName:"cpu",kernelFunc:oneHot$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function zerosLike$1(e){const{inputs:t,backend:n}=e,{x:r}=t;if("string"===r.dtype)throw new Error("zerosLike is not supported for string tensors");if("complex64"===r.dtype){const e=real$1({inputs:{input:r},backend:n}),t=zerosLike$1({inputs:{x:e},backend:n}),a=imag$1({inputs:{input:r},backend:n}),i=zerosLike$1({inputs:{x:a},backend:n}),s=complex$1({inputs:{real:t,imag:i},backend:n});return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(i),s}return fill$1({backend:n,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}const zerosLikeConfig$1={kernelName:ZerosLike,backendName:"cpu",kernelFunc:zerosLike$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function onesLike$1(e){const{inputs:t,backend:n}=e,{x:r}=t;if("string"===r.dtype)throw new Error("onesLike is not supported for string tensors");if("complex64"===r.dtype){const e=real$1({inputs:{input:r},backend:n}),t=onesLike$1({inputs:{x:e},backend:n}),a=imag$1({inputs:{input:r},backend:n}),i=zerosLike$1({inputs:{x:a},backend:n}),s=complex$1({inputs:{real:t,imag:i},backend:n});return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(i),s}return fill$1({backend:n,attrs:{shape:r.shape,value:1,dtype:r.dtype}})}const onesLikeConfig$1={kernelName:OnesLike,backendName:"cpu",kernelFunc:onesLike$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function pack$1(e){const{inputs:t,backend:n,attrs:r}=e,{axis:a}=r;if(1===t.length)return expandDims$1({inputs:{input:t[0]},backend:n,attrs:{dim:a}});const i=t[0].shape,s=t[0].dtype;t.forEach((e=>{assertShapesMatch(i,e.shape,"All tensors passed to stack must have matching shapes"),assert$1(s===e.dtype,(()=>"All tensors passed to stack must have matching dtypes"))}));const o=[],l=t.map((e=>{const t=expandDims$1({inputs:{input:e},backend:n,attrs:{dim:a}});return o.push(t),t})),u=concat$1({inputs:l,backend:n,attrs:{axis:a}});return o.forEach((e=>n.disposeIntermediateTensorInfo(e))),u}const packConfig$1={kernelName:Pack,backendName:"cpu",kernelFunc:pack$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function padV2$1(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{paddings:i,constantValue:s}=r;assertNotComplex$1(a,"pad");const o=i.map(((e,t)=>e[0]+a.shape[t]+e[1])),l=i.map((e=>e[0])),u=n.data.get(a.dataId).values,c=sizeFromShape(a.shape),h=a.shape.length,d=computeStrides(a.shape),p=sizeFromShape(o),f=o.length,m=computeStrides(o),g=getTypedArrayFromDType(a.dtype,p);0!==s&&g.fill(s);for(let y=0;y<c;y++){g[locToIndex(indexToLoc(y,h,d).map(((e,t)=>e+l[t])),f,m)]=u[y]}return{dataId:n.write(g,o,a.dtype),shape:o,dtype:a.dtype}}const padV2Config$1={kernelName:PadV2,backendName:"cpu",kernelFunc:padV2$1},powImpl=createSimpleBinaryKernelImpl(((e,t)=>Math.pow(e,t))),pow$1=binaryKernelFunc$1(Pow,powImpl),powConfig$1={kernelName:Pow,backendName:"cpu",kernelFunc:pow$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function raggedGather$1(e){const{inputs:t,backend:n,attrs:r}=e,{paramsNestedSplits:a,paramsDenseValues:i,indices:s}=t,o=a.map((e=>n.data.get(e.dataId).values)),l=a.map((e=>e.shape)),u=n.data.get(i.dataId).values,c=n.data.get(s.dataId).values,[h,d,p]=raggedGatherImpl(o,l,u,i.shape,i.dtype,c,s.shape),f=h.map((e=>n.makeTensorInfo([e.length],"int32",e))),m=n.makeTensorInfo(p,i.dtype,d);return f.concat([m])}const raggedGatherConfig$1={kernelName:RaggedGather,backendName:"cpu",kernelFunc:raggedGather$1};
/**
     * @license
     * Copyright 2022 Google LLC.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function raggedRange$1(e){const{inputs:t,backend:n}=e,{starts:r,limits:a,deltas:i}=t,s=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,l=n.data.get(i.dataId).values,[u,c]=raggedRangeImpl(s,r.shape,r.dtype,o,a.shape,l,i.shape);return[n.makeTensorInfo([u.length],"int32",u),n.makeTensorInfo([c.length],r.dtype,c)]}const raggedRangeConfig$1={kernelName:RaggedRange,backendName:"cpu",kernelFunc:raggedRange$1};
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function raggedTensorToTensor$1(e){const{inputs:t,backend:n,attrs:r}=e,{shape:a,values:i,defaultValue:s,rowPartitionTensors:o}=t,{rowPartitionTypes:l}=r,u=n.data.get(a.dataId).values,c=n.data.get(i.dataId).values,h=n.data.get(s.dataId).values,d=o.map((e=>n.data.get(e.dataId).values)),p=o.map((e=>e.shape)),[f,m]=raggedTensorToTensorImpl(u,a.shape,c,i.shape,i.dtype,h,s.shape,d,p,l);return n.makeTensorInfo(f,i.dtype,m)}const raggedTensorToTensorConfig$1={kernelName:RaggedTensorToTensor,backendName:"cpu",kernelFunc:raggedTensorToTensor$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function range$2(e){const{backend:t,attrs:n}=e,{start:r,stop:a,dtype:i,step:s}=n,o=rangeImpl(r,a,s,i);return t.makeTensorInfo([o.length],i,o)}const rangeConfig$1={kernelName:Range,backendName:"cpu",kernelFunc:range$2},reciprocal$1=unaryKernelFunc$1(Reciprocal,(e=>1/e)),reciprocalConfig$1={kernelName:Reciprocal,backendName:"cpu",kernelFunc:reciprocal$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the License);
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an AS IS BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function resizeBilinear$1(e){const{inputs:t,backend:n,attrs:r}=e,{images:a}=t,{alignCorners:i,halfPixelCenters:s,size:o}=r;assertNotComplex$1(a,"resizeBilinear");const l=computeStrides(a.shape),[u,c]=o,[h,d,p,f]=a.shape,m=n.data.get(a.dataId).values,g=new Float32Array(sizeFromShape([h,u,c,f])),y=[i&&u>1?d-1:d,i&&c>1?p-1:p],v=[i&&u>1?u-1:u,i&&c>1?c-1:c];let b=0;const x=y[0]/v[0],T=y[1]/v[1];for(let _=0;_<h;_++)for(let e=0;e<u;e++){let t;t=s?x*(e+.5)-.5:x*e;const n=Math.max(0,Math.floor(t)),r=t-n,a=Math.min(d-1,Math.ceil(t)),i=_*l[0]+n*l[1],o=_*l[0]+a*l[1];for(let e=0;e<c;e++){let t;t=s?T*(e+.5)-.5:T*e;const n=Math.max(0,Math.floor(t)),a=t-n,u=Math.min(p-1,Math.ceil(t)),c=i+n*l[2],h=o+n*l[2],d=i+u*l[2],y=o+u*l[2];for(let e=0;e<f;e++){const t=m[c+e],n=m[h+e],i=t+(m[d+e]-t)*a,s=i+(n+(m[y+e]-n)*a-i)*r;g[b++]=s}}}return n.makeTensorInfo([h,u,c,f],"float32",g)}const resizeBilinearConfig$1={kernelName:ResizeBilinear,backendName:"cpu",kernelFunc:resizeBilinear$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function resizeBilinearGrad$1(e){const{inputs:t,backend:n,attrs:r}=e,{images:a,dy:i}=t,{alignCorners:s}=r;assertNotComplex$1([i,a],"resizeBilinearGrad");const o=computeStrides(a.shape),[l,u,c,h]=a.shape,[,d,p]=i.shape,f=new Float32Array(l*u*c*h),m=[s&&d>1?u-1:u,s&&p>1?c-1:c],g=[s&&d>1?d-1:d,s&&p>1?p-1:p],y=m[0]/g[0],v=m[1]/g[1],b=n.data.get(i.dataId).values;let x=0;for(let T=0;T<l;T++){const e=T*o[0];for(let t=0;t<d;t++){const n=t*y,r=Math.floor(n),a=Math.min(Math.ceil(n),u-1),i=e+r*o[1],s=e+a*o[1],l=n-r,d=1-l;for(let e=0;e<p;e++){const t=e*v,n=Math.floor(t),r=Math.min(Math.ceil(t),c-1),a=t-n,u=1-a,p=i+n*o[2],m=i+r*o[2],g=s+n*o[2],y=s+r*o[2],T=d*u,_=d*a,w=l*u,S=l*a;for(let e=0;e<h;e++){const t=b[x++];f[p+e]+=t*T,f[m+e]+=t*_,f[g+e]+=t*w,f[y+e]+=t*S}}}}return n.makeTensorInfo([l,c,u,h],"float32",f)}const resizeBilinearGradConfig$1={kernelName:ResizeBilinearGrad,backendName:"cpu",kernelFunc:resizeBilinearGrad$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function resizeNearestNeighbor$1(e){const{inputs:t,backend:n,attrs:r}=e,{images:a}=t,{alignCorners:i,halfPixelCenters:s,size:o}=r;assertNotComplex$1(a,"resizeNearestNeighbor");const l=computeStrides(a.shape),[u,c]=o,[h,d,p,f]=a.shape,m=n.data.get(a.dataId).values,g=new Float32Array(h*u*c*f),y=[i&&u>1?d-1:d,i&&c>1?p-1:p],v=[i&&u>1?u-1:u,i&&c>1?c-1:c],b=y[0]/v[0],x=y[1]/v[1];let T=0;for(let _=0;_<h;_++){const e=_*l[0];for(let t=0;t<u;t++){const n=s?b*(t+.5):b*t;let r=Math.min(d-1,i?Math.round(n):Math.floor(n));s&&(r=Math.max(0,r));const a=e+r*l[1];for(let e=0;e<c;e++){const t=s?x*(e+.5):x*e;let n=Math.min(p-1,i?Math.round(t):Math.floor(t));s&&(n=Math.max(0,n));const r=a+n*l[2];for(let e=0;e<f;e++){const t=m[r+e];g[T++]=t}}}}return n.makeTensorInfo([h,u,c,f],a.dtype,g)}const resizeNearestNeighborConfig$1={kernelName:ResizeNearestNeighbor,backendName:"cpu",kernelFunc:resizeNearestNeighbor$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function resizeNearestNeighborGrad$1(e){const{inputs:t,backend:n,attrs:r}=e,{images:a,dy:i}=t,{alignCorners:s}=r;assertNotComplex$1([i,a],"resizeNearestNeighborGrad");const o=computeStrides(a.shape),l=computeStrides(i.shape),[u,c,h,d]=a.shape,[,p,f]=i.shape,m=new Float32Array(u*c*h*d),g=n.data.get(i.dataId).values,y=[s&&p>1?c-1:c,s&&f>1?h-1:h],v=[s&&p>1?p-1:p,s&&f>1?f-1:f],b=y[0]/v[0],x=y[1]/v[1],T=1/b,_=1/x,w=2*Math.ceil(T)+2,S=2*Math.ceil(_)+2;for(let C=0;C<u;C++){const e=C*o[0];for(let t=0;t<c;t++){const n=e+t*o[1],r=Math.floor(t*T),a=Math.floor(r-w/2);for(let i=0;i<h;i++){const r=n+i*o[2],u=Math.floor(i*_),y=Math.floor(u-S/2);for(let n=0;n<d;n++){let o=0;for(let r=0;r<w;r++){const u=r+a;if(u<0||u>=p)continue;const d=e+u*l[1],m=u*b;if(t===Math.min(c-1,s?Math.round(m):Math.floor(m)))for(let e=0;e<S;e++){const t=e+y;if(t<0||t>=f)continue;const r=d+t*l[2],a=t*x;i===Math.min(h-1,s?Math.round(a):Math.floor(a))&&(o+=g[r+n])}}m[r+n]=o}}}}return n.makeTensorInfo(a.shape,a.dtype,m)}const resizeNearestNeighborGradConfig$1={kernelName:ResizeNearestNeighborGrad,backendName:"cpu",kernelFunc:resizeNearestNeighborGrad$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function reverse$1(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{dims:i}=r;assertNotComplex$1(a,"reverse");const s=a.shape.length,o=parseAxisParam(i,a.shape);if(0===s)return identity$1({inputs:{x:a},backend:n});const l=new TensorBuffer(a.shape,a.dtype),u=n.bufferSync(a);for(let c=0;c<l.size;c++){const e=l.indexToLoc(c),t=e.slice();o.forEach((e=>t[e]=a.shape[e]-1-t[e])),l.set(u.get(...t),...e)}return n.makeTensorInfo(l.shape,l.dtype,l.values)}const reverseConfig$1={kernelName:Reverse,backendName:"cpu",kernelFunc:reverse$1},rotateWithOffsetConfig$1={kernelName:RotateWithOffset,backendName:"cpu",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{image:r}=e,{radians:a,fillValue:i,center:s}=t,o=n,l=getTypedArrayFromDType(r.dtype,sizeFromShape(r.shape)),[u,c,h,d]=r.shape,[p,f]=getImageCenter(s,c,h),m=Math.sin(a),g=Math.cos(a),y=o.data.get(r.dataId).values;for(let v=0;v<u;v++){const e=v*h*c*d;for(let t=0;t<c;t++){const n=t*(h*d);for(let r=0;r<h;r++){const a=r*d;for(let s=0;s<d;s++){const o=[u,t,r,s],v=o[2],b=o[1];let x=(v-p)*g-(b-f)*m,T=(v-p)*m+(b-f)*g;x=Math.round(x+p),T=Math.round(T+f);let _=i;if("number"!=typeof i&&(_=3===s?255:i[s]),x>=0&&x<h&&T>=0&&T<c){_=y[e+T*(h*d)+x*d+s]}l[e+n+a+s]=_}}}}return{dataId:o.write(l,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},round$1=unaryKernelFunc$1(Round,(e=>{const t=Math.floor(e);return e-t<.5?Math.floor(e):e-t>.5?Math.ceil(e):t%2==0?t:t+1})),roundConfig$1={kernelName:Round,backendName:"cpu",kernelFunc:round$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function scatterNd$1(e){const{inputs:t,backend:n,attrs:r}=e,{indices:a,updates:i}=t,{shape:s}=r,{sliceRank:o,numUpdates:l,sliceSize:u,strides:c,outputSize:h}=calculateShapes(i,a,s),d=scatterImpl(n.bufferSync(a),n.bufferSync(i),s,h,u,l,o,c,0,!0);return n.makeTensorInfo(s,d.dtype,d.values)}const scatterNdConfig$1={kernelName:ScatterNd,backendName:"cpu",kernelFunc:scatterNd$1};
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function lowerBound(e,t){let n=0,r=e.length,a=0;for(;n<r;)a=Math.floor((n+r)/2),e[a]<t?n=a+1:r=a;return r}function upperBound(e,t){let n=0,r=e.length,a=0;for(;n<r;)a=Math.floor((n+r)/2),e[a]<=t?n=a+1:r=a;return r}function searchSortedImpl(e,t,n,r,a,i){const s=getArrayFromDType("int32",n*a);for(let o=0;o<n;++o){const n=e.slice(o*r,(o+1)*r),l=o*a;for(let e=0;e<a;++e)s[l+e]="left"===i?lowerBound(n,t[e+l]):upperBound(n,t[e+l])}return s}
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function searchSorted$1(e){const{inputs:t,backend:n,attrs:r}=e,{sortedSequence:a,values:i}=t,{side:s}=r,o=searchSortedImpl(n.data.get(a.dataId).values,n.data.get(i.dataId).values,a.shape[0],a.shape[1],i.shape[1],s);return n.makeTensorInfo(i.shape,"int32",o)}const searchSortedConfig$1={kernelName:SearchSorted,backendName:"cpu",kernelFunc:searchSorted$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function select$1(e){const{inputs:t,backend:n}=e,{condition:r,t:a,e:i}=t;assertNotComplex$1([r,a,i],"select");const s=r.shape.length,o=n.data.get(r.dataId).values,l=n.data.get(a.dataId).values,u=n.data.get(i.dataId).values,c=upcastType(a.dtype,i.dtype),h=makeZerosTypedArray(sizeFromShape(a.shape),c);let d=0;const p=0===s||s>1||1===a.shape.length?1:sizeFromShape(a.shape.slice(1));for(let f=0;f<o.length;f++)for(let e=0;e<p;e++)1===o[f]?h[d++]=l[f]:h[d++]=u[f];return n.makeTensorInfo(a.shape,c,h)}const selectConfig$1={kernelName:Select,backendName:"cpu",kernelFunc:select$1},scaleAlpha=SELU_SCALEALPHA,scale=SELU_SCALE,selu$1=unaryKernelFunc$1(Selu$1,(e=>e>=0?scale*e:scaleAlpha*(Math.exp(e)-1))),seluConfig$1={kernelName:Selu$1,backendName:"cpu",kernelFunc:selu$1},sign$1=unaryKernelFunc$1(Sign,(e=>e<0?-1:e>0?1:0)),signConfig$1={kernelName:Sign,backendName:"cpu",kernelFunc:sign$1},sin$1=unaryKernelFunc$1(Sin,(e=>Math.sin(e))),sinConfig$1={kernelName:Sin,backendName:"cpu",kernelFunc:sin$1},sinh$1=unaryKernelFunc$1(Sinh,(e=>Math.sinh(e))),sinhConfig$1={kernelName:Sinh,backendName:"cpu",kernelFunc:sinh$1},epsilon=1.1920928955078125e-7,threshold$1=Math.log(epsilon)+2,softplus$1=unaryKernelFunc$1(Softplus$1,(e=>{const t=e>-threshold$1,n=e<threshold$1,r=Math.exp(e);let a;return a=n?r:t?e:Math.log(1+r),a})),softplusConfig$1={kernelName:Softplus$1,backendName:"cpu",kernelFunc:softplus$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the License);
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an AS IS BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function spaceToBatchND$1(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:i,paddings:s}=r;assertNotComplex$1([a],"spaceToBatchND");const o=sizeFromShape(i),l=[[0,0]];l.push(...s);for(let g=1+i.length;g<a.shape.length;++g)l.push([0,0]);const u=padV2Config$1.kernelFunc({inputs:{x:a},backend:n,attrs:{paddings:l,constantValue:0}}),c=getReshaped(u.shape,i,o,!1),h=getPermuted(c.length,i.length,!1),d=getReshapedPermuted(u.shape,i,o,!1),p=reshape$1({inputs:{x:u},backend:n,attrs:{shape:c}}),f=transpose$1({inputs:{x:p},backend:n,attrs:{perm:h}}),m=reshape$1({inputs:{x:f},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),m}const spaceToBatchNDConfig$1={kernelName:SpaceToBatchND,backendName:"cpu",kernelFunc:spaceToBatchND$1};
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function sparseFillEmptyRows$1(e){const{inputs:t,backend:n}=e,{indices:r,values:a,denseShape:i,defaultValue:s}=t;if(1!==i.shape.length)throw new Error(`Dense shape must be a vector, saw:\n        ${i.shape}`);if(2!==r.shape.length)throw new Error(`Indices must be a matrix, saw:\n        ${r.shape}`);if(1!==a.shape.length)throw new Error(`Values must be a vector, saw:\n        ${a.shape}`);if(0!==s.shape.length)throw new Error(`Default value must be a scalar, saw:\n        ${s.shape}`);const o=n.data.get(r.dataId).values,l=n.data.get(a.dataId).values,u=n.data.get(i.dataId).values,c=n.data.get(s.dataId).values[0],[h,d,p,f,m]=sparseFillEmptyRowsImpl(o,r.shape,r.dtype,l,a.dtype,u,c);return[n.makeTensorInfo(d,r.dtype,h),n.makeTensorInfo([d[0]],a.dtype,p),n.makeTensorInfo([f.length],"bool",new Uint8Array(f.map((e=>Number(e))))),n.makeTensorInfo([m.length],r.dtype,new Int32Array(m))]}const sparseFillEmptyRowsConfig$1={kernelName:SparseFillEmptyRows,backendName:"cpu",kernelFunc:sparseFillEmptyRows$1};
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function sparseReshape$1(e){const{inputs:t,backend:n}=e,{inputIndices:r,inputShape:a,newShape:i}=t;if(2!==r.shape.length)throw new Error(`Input indices should be a matrix but received shape\n        ${r.shape}`);if(1!==a.shape.length)throw new Error(`Input shape should be a vector but received shape\n        ${a.shape}`);if(1!==i.shape.length)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);const s=Array.from(n.data.get(a.dataId).values),o=n.data.get(r.dataId).values,l=Array.from(n.data.get(i.dataId).values),[u,c,h]=sparseReshapeImpl(o,r.shape,r.dtype,s,l);return[n.makeTensorInfo(c,r.dtype,u),n.makeTensorInfo([h.length],i.dtype,new Int32Array(h))]}const sparseReshapeConfig$1={kernelName:SparseReshape,backendName:"cpu",kernelFunc:sparseReshape$1};
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function sparseSegmentMean$1(e){const{inputs:t,backend:n}=e,{data:r,indices:a,segmentIds:i}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error(`Indices should be a vector but received shape\n          ${a.shape}`);if(1!==i.shape.length)throw new Error(`Segment ids should be a vector but received shape\n          ${i.shape}`);if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const s=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,l=n.data.get(i.dataId).values,[u,c]=sparseSegmentReductionImpl(s,r.shape,r.dtype,o,l,!0);return n.makeTensorInfo(c,r.dtype,u)}const sparseSegmentMeanConfig$1={kernelName:SparseSegmentMean,backendName:"cpu",kernelFunc:sparseSegmentMean$1};
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function sparseSegmentSum$1(e){const{inputs:t,backend:n}=e,{data:r,indices:a,segmentIds:i}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error(`Indices should be a vector but received shape\n         ${a.shape}`);if(1!==i.shape.length)throw new Error(`Segment ids should be a vector but received shape\n         ${i.shape}`);if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const s=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,l=n.data.get(i.dataId).values,[u,c]=sparseSegmentReductionImpl(s,r.shape,r.dtype,o,l);return n.makeTensorInfo(c,r.dtype,u)}const sparseSegmentSumConfig$1={kernelName:SparseSegmentSum,backendName:"cpu",kernelFunc:sparseSegmentSum$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function sparseToDense$1(e){const{inputs:t,backend:n,attrs:r}=e,{sparseIndices:a,sparseValues:i,defaultValue:s}=t,{outputShape:o}=r,{sliceRank:l,numUpdates:u,sliceSize:c,strides:h,outputSize:d}=calculateShapes(i,a,o),p=!1,f=n.bufferSync(a);let m;switch(i.dtype){case"bool":m=scatterImpl(f,n.bufferSync(i),o,d,c,u,l,h,Boolean(n.data.get(s.dataId).values[0]),p);break;case"float32":m=scatterImpl(f,n.bufferSync(i),o,d,c,u,l,h,n.data.get(s.dataId).values[0],p);break;case"int32":m=scatterImpl(f,n.bufferSync(i),o,d,c,u,l,h,n.data.get(s.dataId).values[0],p);break;case"string":m=scatterImpl(f,n.bufferSync(i),o,d,c,u,l,h,decodeString(n.data.get(s.dataId).values[0]),p);break;default:throw new Error(`Unsupported type ${i.dtype}`)}return n.makeTensorInfo(o,m.dtype,m.values)}const sparseToDenseConfig$1={kernelName:SparseToDense,backendName:"cpu",kernelFunc:sparseToDense$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function splitV$1(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{numOrSizeSplits:i,axis:s}=r,o=parseAxisParam(s,a.shape)[0],l=prepareSplitSize(a,i,o),u=new Array(a.shape.length).fill(0),c=a.shape.slice();return l.map((e=>{const t=[...c];t[o]=e;const r=slice$1({inputs:{x:a},backend:n,attrs:{begin:u,size:t}});return u[o]+=e,r}))}const splitVConfig$1={kernelName:SplitV,backendName:"cpu",kernelFunc:splitV$1},squareConfig$1={kernelName:Square,backendName:"cpu",kernelFunc:({inputs:e,backend:t})=>{const{x:n}=e,r=t;assertNotComplex$1(n,"square");const a=r.data.get(n.dataId).values,i=new Float32Array(a.length);for(let s=0;s<a.length;++s){const e=a[s];i[s]=e*e}return{dataId:r.write(i,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}},step$1=unaryKernelFunc$1(Step,((e,t)=>{const n=t;return isNaN(e)?NaN:e>0?1:n.alpha})),stepConfig$1={kernelName:Step,backendName:"cpu",kernelFunc:step$1};
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function stridedSlice$1(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{begin:i,end:s,strides:o,beginMask:l,endMask:u,ellipsisMask:c,newAxisMask:h,shrinkAxisMask:d}=r;assertNotComplex$1(a,"stridedSlice");const{finalShapeSparse:p,finalShape:f,isIdentity:m,sliceDim0:g,isSimpleSlice:y,begin:v,end:b,strides:x}=sliceInfo(a.shape,i,s,o,l,u,c,h,d);let T;if(m)T=reshape$1({inputs:{x:a},backend:n,attrs:{shape:f}});else if(g||y){assert$1(a.shape.length>=1,(()=>`Input must have rank at least 1, got: ${a.shape.length}`));const e=computeOutShape$2(v,b,x),t=slice$1({inputs:{x:a},backend:n,attrs:{begin:v,size:e}});T=reshape$1({inputs:{x:t},backend:n,attrs:{shape:f}}),n.disposeIntermediateTensorInfo(t)}else{const e=stridedSliceImpl(p,n.bufferSync(a),x,v);T=n.makeTensorInfo(f,e.dtype,e.values)}return T}const stridedSliceConfig$1={kernelName:StridedSlice,backendName:"cpu",kernelFunc:stridedSlice$1};
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function stringNGrams$1(e){const{inputs:t,backend:n,attrs:r}=e,{separator:a,nGramWidths:i,leftPad:s,rightPad:o,padWidth:l,preserveShortSequences:u}=r,{data:c,dataSplits:h}=t,d=n.data.get(c.dataId).values,p=n.data.get(h.dataId).values,[f,m]=stringNGramsImpl(d,p,a,i,s,o,l,u);return[n.makeTensorInfo([f.length],"string",f),n.makeTensorInfo(h.shape,"int32",m)]}const stringNGramsConfig$1={kernelName:StringNGrams,backendName:"cpu",kernelFunc:stringNGrams$1};
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function stringSplit$1(e){const{inputs:t,backend:n,attrs:r}=e,{skipEmpty:a}=r,{input:i,delimiter:s}=t;if("string"!==i.dtype)throw new Error("Input must be of datatype string");if(1!==i.shape.length)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(0!==s.shape.length)throw new Error(`Delimiter must be a scalar, got shape: ${s.shape}`);const o=n.data.get(i.dataId).values,l=n.data.get(s.dataId).values[0],[u,c,h]=stringSplitImpl(o,l,a),d=c.length;return[n.makeTensorInfo([d,2],"int32",u),n.makeTensorInfo([d],"string",c),n.makeTensorInfo([2],"int32",new Int32Array(h))]}const stringSplitConfig$1={kernelName:StringSplit,backendName:"cpu",kernelFunc:stringSplit$1};
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function stringToHashBucketFast$1(e){const{inputs:t,backend:n,attrs:r}=e,{numBuckets:a}=r,{input:i}=t;if("string"!==i.dtype)throw new Error("Input must be of datatype string");if(a<=0)throw new Error("Number of buckets must be at least 1");const s=stringToHashBucketFastImpl(n.data.get(i.dataId).values,a);return n.makeTensorInfo(i.shape,"int32",s)}const stringToHashBucketFastConfig$1={kernelName:StringToHashBucketFast,backendName:"cpu",kernelFunc:stringToHashBucketFast$1},tan$1=unaryKernelFunc$1(Tan,(e=>Math.tan(e))),tanConfig$1={kernelName:Tan,backendName:"cpu",kernelFunc:tan$1},tanh$1=unaryKernelFunc$1(Tanh$1,(e=>Math.tanh(e))),tanhConfig$1={kernelName:Tanh$1,backendName:"cpu",kernelFunc:tanh$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the License);
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an AS IS BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function tensorScatterUpdate$1(e){const{inputs:t,backend:n}=e,{tensor:r,indices:a,updates:i}=t,{sliceRank:s,numUpdates:o,sliceSize:l,strides:u,outputSize:c}=calculateShapes(i,a,r.shape),h=n.bufferSync(a),d=n.bufferSync(i),p=n.bufferSync(r),f=scatterImpl(h,d,r.shape,c,l,o,s,u,p,!1);return n.makeTensorInfo(r.shape,f.dtype,f.values)}const tensorScatterUpdateConfig$1={kernelName:TensorScatterUpdate,backendName:"cpu",kernelFunc:tensorScatterUpdate$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function tile$1(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{reps:i}=r;assertNotComplex$1(a,"tile");const s=tileImpl(n.bufferSync(a),i);return n.makeTensorInfo(s.shape,s.dtype,s.values)}const tileConfig$1={kernelName:Tile,backendName:"cpu",kernelFunc:tile$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function topK$1(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{k:i,sorted:s}=r;assertNotComplex$1(a,"topk");const o=n.data.get(a.dataId).values,[l,u]=topKImpl(o,a.shape,a.dtype,i,s);return[n.makeTensorInfo(l.shape,l.dtype,l.values),n.makeTensorInfo(u.shape,u.dtype,u.values)]}const topKConfig$1={kernelName:TopK,backendName:"cpu",kernelFunc:topK$1};
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function transform$2(e){const{inputs:t,attrs:n,backend:r}=e,{image:a,transforms:i}=t,{interpolation:s,fillMode:o,fillValue:l,outputShape:u}=n,[c,h,d,p]=a.shape,[f,m]=null!=u?u:[h,d],g=[c,f,m,p],y=computeStrides(a.shape),v=y[0],b=y[1],x=y[2],T=computeStrides(g),_=T[0],w=T[1],S=T[2],C=getTypedArrayFromDType(a.dtype,sizeFromShape(g));C.fill(l);const E=r.data.get(a.dataId).values,k=r.data.get(i.dataId).values;for(let I=0;I<c;++I){const e=1===i.shape[0]?k:k.subarray(8*I,8*I+8);for(let t=0;t<f;++t)for(let n=0;n<m;++n)for(let r=0;r<p;++r){let a;const i=e[6]*n+e[7]*t+1;if(0===i)continue;const u=(e[0]*n+e[1]*t+e[2])/i,c=(e[3]*n+e[4]*t+e[5])/i,p=mapCoord(u,d,o),f=mapCoord(c,h,o);switch(s){case"nearest":a=nearestInterpolation(E,h,d,v,b,x,I,f,p,r,l);break;case"bilinear":a=bilinearInterpolation(E,h,d,v,b,x,I,f,p,r,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${s}`)}C[I*_+t*w+n*S+r]=a}return r.makeTensorInfo(g,a.dtype,C)}return{dataId:r.write(C,g,a.dtype),shape:a.shape,dtype:a.dtype}}const transformConfig$1={kernelName:Transform,backendName:"cpu",kernelFunc:transform$2};function mapCoord(e,t,n){switch(n){case"reflect":return mapCoordReflect(e,t);case"wrap":return mapCoordWrap(e,t);case"nearest":return mapCoordNearest(e,t);default:return mapCoordConstant(e)}}function mapCoordReflect(e,t){let n=e;if(n<0)if(t<=1)n=0;else{const e=2*t;n<e&&(n=e*Math.trunc(-n/e)+n),n=n<-t?n+e:-n-1}else if(n>t-1)if(t<=1)n=0;else{const e=2*t;n-=e*Math.trunc(n/e),n>=t&&(n=e-n-1)}return clamp$1(0,n,t-1)}function mapCoordWrap(e,t){let n=e;if(n<0)if(t<=1)n=0;else{const e=t-1;n+=t*(Math.trunc(-n/e)+1)}else if(n>t-1)if(t<=1)n=0;else{const e=t-1;n-=t*Math.trunc(n/e)}return clamp$1(0,n,t-1)}function mapCoordConstant(e,t){return e}function mapCoordNearest(e,t){return clamp$1(0,e,t-1)}function readWithFillValue(e,t,n,r,a,i,s,o,l,u,c){return 0<=o&&o<t&&0<=l&&l<n?e[s*r+o*a+l*i+u]:c}function nearestInterpolation(e,t,n,r,a,i,s,o,l,u,c){return readWithFillValue(e,t,n,r,a,i,s,Math.round(o),Math.round(l),u,c)}function bilinearInterpolation(e,t,n,r,a,i,s,o,l,u,c){const h=Math.floor(o),d=Math.floor(l),p=h+1,f=d+1;return(p-o)*((f-l)*readWithFillValue(e,t,n,r,a,i,s,h,d,u,c)+(l-d)*readWithFillValue(e,t,n,r,a,i,s,h,f,u,c))+(o-h)*((f-l)*readWithFillValue(e,t,n,r,a,i,s,p,d,u,c)+(l-d)*readWithFillValue(e,t,n,r,a,i,s,p,f,u,c))}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the License);
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an AS IS BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function unique$1(e){const{inputs:t,attrs:n,backend:r}=e,{axis:a}=n,{x:i}=t;assertNotComplex$1(i,"unique");const s=r.data.get(i.dataId).values,{outputValues:o,outputShape:l,indices:u}=uniqueImpl(s,a,i.shape,i.dtype);return[r.makeTensorInfo(l,i.dtype,o),r.makeTensorInfo([u.length],"int32",u)]}const uniqueConfig$1={kernelName:Unique,backendName:"cpu",kernelFunc:unique$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function unpack$1(e){const{inputs:t,backend:n,attrs:r}=e,{value:a}=t;let{axis:i}=r;i<0&&(i+=a.shape.length);const s=a.shape.length,o=a.shape[i],l=new Array(s-1);let u=0;for(let p=0;p<s;p++)p!==i&&(l[u++]=a.shape[p]);const c=new Array(s).fill(0),h=a.shape.slice();h[i]=1;const d=new Array(o);for(let p=0;p<d.length;p++){c[i]=p;const e=slice$1({inputs:{x:a},backend:n,attrs:{begin:c,size:h}});d[p]=reshape$1({inputs:{x:e},backend:n,attrs:{shape:l}}),n.disposeIntermediateTensorInfo(e)}return d}const unpackConfig$1={kernelName:Unpack,backendName:"cpu",kernelFunc:unpack$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function unsortedSegmentSum$1(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,segmentIds:i}=t,{numSegments:s}=r;assertNotComplex$1(a,"unsortedSegmentSum");const o=[],l=[],u=a.shape.length-i.shape.length;let c=i;for(let d=0;d<u;++d){const e=expandDims$1({inputs:{input:c},backend:n,attrs:{dim:d+1}});c=e,l.push(e)}for(let d=0;d<s;++d){const e=createScalarValue(d,"int32"),t=n.makeTensorInfo([],"int32",e),r=equal$1({inputs:{a:t,b:c},backend:n}),i=cast$1({inputs:{x:r},backend:n,attrs:{dtype:"float32"}}),s=multiply$1({inputs:{a:i,b:a},backend:n}),u=sum$1({inputs:{x:s},backend:n,attrs:{axis:0,keepDims:!1}});o.push(u),l.push(t),l.push(r),l.push(i),l.push(s),l.push(u)}const h=pack$1({inputs:o,backend:n,attrs:{axis:0}});return l.forEach((e=>n.disposeIntermediateTensorInfo(e))),h}const unsortedSegmentSumConfig$1={kernelName:UnsortedSegmentSum,backendName:"cpu",kernelFunc:unsortedSegmentSum$1},kernelConfigs$1=[_fusedMatMulConfig$1,absConfig$1,acosConfig$1,acoshConfig$1,addConfig$1,addNConfig$1,allConfig$1,anyConfig$1,argMaxConfig$1,argMinConfig$1,asinConfig$1,asinhConfig$1,atanConfig$1,atan2Config$1,atanhConfig$1,avgPoolConfig$1,avgPool3DConfig$1,avgPool3DGradConfig$1,avgPoolGradConfig$1,batchMatMulConfig$1,batchNormConfig$1,batchToSpaceNDConfig$1,bincountConfig$1,bitwiseAndConfig$1,broadcastArgsConfig$1,castConfig$1,ceilConfig$1,clipByValueConfig$1,complexConfig$1,complexAbsConfig$1,concatConfig$1,conv2DConfig$1,conv2DBackpropFilterConfig$1,conv2DBackpropInputConfig$1,conv3DConfig$1,conv3DBackpropFilterV2Config$1,conv3DBackpropInputV2Config,cosConfig$1,coshConfig$1,cropAndResizeConfig$1,cumprodConfig$1,cumsumConfig$1,denseBincountConfig$1,depthToSpaceConfig$1,depthwiseConv2dNativeConfig$1,depthwiseConv2dNativeBackpropFilterConfig$1,depthwiseConv2dNativeBackpropInputConfig$1,diagConfig$1,dilation2DConfig$1,dilation2DBackpropFilterConfig,dilation2DBackpropInputConfig,drawConfig,einsumConfig$1,eluConfig$1,eluGradConfig$1,equalConfig$1,erfConfig$1,expConfig$1,expandDimsConfig$1,expm1Config$1,fftConfig$1,fillConfig$1,flipLeftRightConfig$1,floorConfig$1,floorDivConfig$1,fusedConv2DConfig$1,fusedDepthwiseConv2DConfig$1,gatherNdConfig$1,gatherV2Config$1,greaterConfig$1,greaterEqualConfig$1,identityConfig$1,ifftConfig$1,imagConfig$1,isFiniteConfig$1,isInfConfig$1,isNaNConfig$1,leakyReluConfig$1,lessConfig$1,lessEqualConfig$1,linSpaceConfig$1,logConfig$1,log1pConfig$1,logicalAndConfig$1,logicalNotConfig$1,logicalOrConfig$1,LRNConfig$1,LRNGradConfig$1,maxConfig$1,maximumConfig$1,maxPoolConfig$1,maxPool3DConfig$1,maxPool3DGradConfig$1,maxPoolGradConfig$1,maxPoolWithArgmaxConfig$1,meanConfig$1,minConfig$1,minimumConfig$1,mirrorPadConfig$1,modConfig$1,multinomialConfig$1,multiplyConfig$1,negConfig$1,nonMaxSuppressionV3Config$1,nonMaxSuppressionV4Config$1,nonMaxSuppressionV5Config$1,notEqualConfig$1,oneHotConfig$1,onesLikeConfig$1,packConfig$1,padV2Config$1,powConfig$1,preluConfig$1,prodConfig$1,raggedGatherConfig$1,raggedRangeConfig$1,raggedTensorToTensorConfig$1,rangeConfig$1,realConfig$1,realDivConfig$1,reciprocalConfig$1,reluConfig$1,relu6Config$1,reshapeConfig$1,resizeBilinearConfig$1,resizeBilinearGradConfig$1,resizeNearestNeighborConfig$1,resizeNearestNeighborGradConfig$1,reverseConfig$1,rotateWithOffsetConfig$1,roundConfig$1,rsqrtConfig$1,scatterNdConfig$1,searchSortedConfig$1,selectConfig$1,seluConfig$1,sigmoidConfig$1,signConfig$1,sinConfig$1,sinhConfig$1,sliceConfig$1,softmaxConfig$1,softplusConfig$1,spaceToBatchNDConfig$1,sparseFillEmptyRowsConfig$1,sparseReshapeConfig$1,sparseSegmentMeanConfig$1,sparseSegmentSumConfig$1,sparseToDenseConfig$1,splitVConfig$1,sqrtConfig$1,squareConfig$1,squaredDifferenceConfig$1,staticRegexReplaceConfig$1,stepConfig$1,stridedSliceConfig$1,stringNGramsConfig$1,stringSplitConfig$1,stringToHashBucketFastConfig$1,subConfig$1,sumConfig$1,tanConfig$1,tanhConfig$1,tensorScatterUpdateConfig$1,tileConfig$1,topKConfig$1,transformConfig$1,transposeConfig$1,uniqueConfig$1,unpackConfig$1,unsortedSegmentSumConfig$1,zerosLikeConfig$1];
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */for(const m of kernelConfigs$1)registerKernel(m);
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const contexts={},WEBGL_ATTRIBUTES={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function setWebGLContext(e,t){contexts[e]=t}function getWebGLContext(e,t){if(!(e in contexts)||null!=t){const n=getWebGLRenderingContext(e,t);if(null===n)return console.log("Could not get context for WebGL version",e),null;contexts[e]=n}const n=contexts[e];return null==n||n.isContextLost()?(delete contexts[e],getWebGLContext(e)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),contexts[e])}function createCanvas(e){if(env().getBool("IS_SAFARI")||"undefined"==typeof OffscreenCanvas||2!==e){if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}return new OffscreenCanvas(300,150)}function getWebGLRenderingContext(e,t){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const n=null==t?createCanvas(e):t;return n.addEventListener("webglcontextlost",(t=>{t.preventDefault(),delete contexts[e]}),!1),env().getBool("SOFTWARE_WEBGL_ENABLED")&&(WEBGL_ATTRIBUTES.failIfMajorPerformanceCaveat=!1),1===e?n.getContext("webgl",WEBGL_ATTRIBUTES)||n.getContext("experimental-webgl",WEBGL_ATTRIBUTES):n.getContext("webgl2",WEBGL_ATTRIBUTES)}
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */var PackingScheme,PackingScheme2,TextureUsage,TextureUsage2,PhysicalTextureType,PhysicalTextureType2;function getUnpackedMatrixTextureShapeWidthHeight(e,t){return[t,e]}function getUnpackedArraySizeFromMatrixSize(e,t){return e*t}function getDenseTexShape(e){const t=sizeFromShape(e);return sizeToSquarishShape(Math.ceil(t/4))}function getPackedMatrixTextureShapeWidthHeight(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function getPackedRGBAArraySizeFromMatrixShape(e,t){const[n,r]=getPackedMatrixTextureShapeWidthHeight(e,t);return n*r*4}function getTextureConfig(e,t){const n=e;let r,a,i,s,o,l,u,c,h,d;return 2===env().getNumber("WEBGL_VERSION")?(r=n.R32F,a=n.R16F,i=n.RGBA16F,s=n.RGBA32F,o=n.RED,u=4,c=1,h=n.HALF_FLOAT,d=n.FLOAT,l=n.RGBA8):(r=e.RGBA,a=e.RGBA,i=e.RGBA,s=n.RGBA,o=e.RGBA,u=4,c=4,h=null!=t?t.HALF_FLOAT_OES:null,d=e.FLOAT,l=e.RGBA),{internalFormatFloat:r,internalFormatHalfFloat:a,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:s,textureFormatFloat:o,downloadTextureFormat:l,downloadUnpackNumChannels:u,defaultNumChannels:c,textureTypeHalfFloat:h,textureTypeFloat:d}}
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function callAndCheck(e,t){const n=t();return env().getBool("DEBUG")&&checkWebGLError(e),n}function checkWebGLError(e){const t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+getWebGLErrorMessage(e,t))}PackingScheme2=PackingScheme||(PackingScheme={}),PackingScheme2[PackingScheme2.DENSE=0]="DENSE",PackingScheme2[PackingScheme2.SHARED_BATCH=1]="SHARED_BATCH",TextureUsage2=TextureUsage||(TextureUsage={}),TextureUsage2[TextureUsage2.RENDER=0]="RENDER",TextureUsage2[TextureUsage2.UPLOAD=1]="UPLOAD",TextureUsage2[TextureUsage2.PIXELS=2]="PIXELS",TextureUsage2[TextureUsage2.DOWNLOAD=3]="DOWNLOAD",PhysicalTextureType2=PhysicalTextureType||(PhysicalTextureType={}),PhysicalTextureType2[PhysicalTextureType2.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",PhysicalTextureType2[PhysicalTextureType2.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",PhysicalTextureType2[PhysicalTextureType2.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",PhysicalTextureType2[PhysicalTextureType2.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",PhysicalTextureType2[PhysicalTextureType2.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16";const MIN_FLOAT16=5.96e-8,MAX_FLOAT16=65504;function canBeRepresented(e){return!!(env().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||MIN_FLOAT16<Math.abs(e)&&Math.abs(e)<MAX_FLOAT16)}function getWebGLErrorMessage(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${t}`}}function getExtensionOrThrow(e,t){return throwIfNull(e,(()=>e.getExtension(t)),'Extension "'+t+'" not supported on this browser.')}function createVertexShader$1(e,t){const n=throwIfNull(e,(()=>e.createShader(e.VERTEX_SHADER)),"Unable to create vertex WebGLShader.");if(callAndCheck(e,(()=>e.shaderSource(n,t))),callAndCheck(e,(()=>e.compileShader(n))),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function createFragmentShader(e,t){const n=throwIfNull(e,(()=>e.createShader(e.FRAGMENT_SHADER)),"Unable to create fragment WebGLShader.");if(callAndCheck(e,(()=>e.shaderSource(n,t))),callAndCheck(e,(()=>e.compileShader(n))),env().get("ENGINE_COMPILE_ONLY"))return n;if(!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw logShaderSourceAndInfoLog(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}const lineNumberRegex=/ERROR: [0-9]+:([0-9]+):/g;function logShaderSourceAndInfoLog(e,t){const n=lineNumberRegex.exec(t);if(null==n)return console.log(`Couldn't parse line number in error: ${t}`),void console.log(e);const r=+n[1],a=e.split("\n"),i=a.length.toString().length+2,s=a.map(((e,t)=>rightPad((t+1).toString(),i)+e));let o=0;for(let h=0;h<s.length;h++)o=Math.max(s[h].length,o);const l=s.slice(0,r-1),u=s.slice(r-1,r),c=s.slice(r);console.log(l.join("\n")),console.log(t.split("\n")[0]),console.log(`%c ${rightPad(u[0],o)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(c.join("\n"))}function createProgram(e){return throwIfNull(e,(()=>e.createProgram()),"Unable to create WebGLProgram.")}function linkProgram(e,t){if(callAndCheck(e,(()=>e.linkProgram(t))),!env().get("ENGINE_COMPILE_ONLY")&&!1===e.getProgramParameter(t,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function validateProgram(e,t){if(callAndCheck(e,(()=>e.validateProgram(t))),!1===e.getProgramParameter(t,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function createStaticVertexBuffer(e,t){const n=throwIfNull(e,(()=>e.createBuffer()),"Unable to create WebGLBuffer");return callAndCheck(e,(()=>e.bindBuffer(e.ARRAY_BUFFER,n))),callAndCheck(e,(()=>e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW))),n}function createStaticIndexBuffer(e,t){const n=throwIfNull(e,(()=>e.createBuffer()),"Unable to create WebGLBuffer");return callAndCheck(e,(()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n))),callAndCheck(e,(()=>e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW))),n}function createTexture(e){return throwIfNull(e,(()=>e.createTexture()),"Unable to create WebGLTexture.")}function validateTextureSize(e,t){const n=env().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){throw new Error("Requested texture size "+`[${e}x${t}]`+" is invalid.")}if(e>n||t>n){throw new Error("Requested texture size "+`[${e}x${t}]`+" greater than WebGL maximum on this browser / GPU "+`[${n}x${n}]`+".")}}function createFramebuffer(e){return throwIfNull(e,(()=>e.createFramebuffer()),"Unable to create WebGLFramebuffer.")}function bindVertexBufferToProgramAttribute(e,t,n,r,a,i,s){const o=e.getAttribLocation(t,n);return-1!==o&&(callAndCheck(e,(()=>e.bindBuffer(e.ARRAY_BUFFER,r))),callAndCheck(e,(()=>e.vertexAttribPointer(o,a,e.FLOAT,!1,i,s))),callAndCheck(e,(()=>e.enableVertexAttribArray(o))),!0)}function bindTextureUnit(e,t,n){validateTextureUnit(e,n),callAndCheck(e,(()=>e.activeTexture(e.TEXTURE0+n))),callAndCheck(e,(()=>e.bindTexture(e.TEXTURE_2D,t)))}function getProgramUniformLocationOrThrow(e,t,n){return throwIfNull(e,(()=>e.getUniformLocation(t,n)),'uniform "'+n+'" not present in program.')}function getProgramUniformLocation(e,t,n){return e.getUniformLocation(t,n)}function bindTextureToProgramUniformSampler(e,t,n,r){callAndCheck(e,(()=>bindTextureUnit(e,t,r))),callAndCheck(e,(()=>e.uniform1i(n,r)))}function bindColorTextureToFramebuffer(e,t,n){callAndCheck(e,(()=>e.bindFramebuffer(e.FRAMEBUFFER,n))),callAndCheck(e,(()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)))}function unbindColorTextureFromFramebuffer(e,t){callAndCheck(e,(()=>e.bindFramebuffer(e.FRAMEBUFFER,t))),callAndCheck(e,(()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)))}function validateFramebuffer(e){const t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+getFramebufferErrorMessage(e,t))}function getFramebufferErrorMessage(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${t}`}}function throwIfNull(e,t,n){const r=callAndCheck(e,(()=>t()));if(null==r)throw new Error(n);return r}function validateTextureUnit(e,t){const n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n){throw new Error(`textureUnit must be in ${`[gl.TEXTURE0, gl.TEXTURE${n}]`}.`)}}function getBatchDim(e,t=2){return sizeFromShape(e.slice(0,e.length-t))}function getRowsCols(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function getShapeAs3D(e){let t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[getBatchDim(e),...getRowsCols(e)]),t}function getTextureShapeFromLogicalShape(e,t=!1){let n=env().getNumber("WEBGL_MAX_TEXTURE_SIZE"),r=env().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");if(r===1/0&&env().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(r=n/2),t&&(n*=2,r*=2,1===(e=e.map(((t,n)=>n>=e.length-2?nearestLargerEven(e[n]):e[n]))).length&&(e=[2,e[0]])),2!==e.length){const t=squeezeShape(e);e=t.newShape}let a=sizeFromShape(e),i=null;e.length<=1&&a<=n?i=[1,a]:2===e.length&&e[0]<=n&&e[1]<=n?i=e:3===e.length&&e[0]*e[1]<=n&&e[2]<=n?i=[e[0]*e[1],e[2]]:3===e.length&&e[0]<=n&&e[1]*e[2]<=n?i=[e[0],e[1]*e[2]]:4===e.length&&e[0]*e[1]*e[2]<=n&&e[3]<=n?i=[e[0]*e[1]*e[2],e[3]]:4===e.length&&e[0]<=n&&e[1]*e[2]*e[3]<=n&&(i=[e[0],e[1]*e[2]*e[3]]);const s=null!=i&&Math.max(...i)>r&&Math.min(...i)<=(t?2:1)&&Math.min(...i)>0;if(null==i||s)if(t){const t=getBatchDim(e);let n=2,r=2;e.length&&([n,r]=getRowsCols(e)),a=t*(n/2)*(r/2),i=sizeToSquarishShape(a).map((e=>2*e))}else i=sizeToSquarishShape(a);return i}function isEven(e){return e%2==0}function isReshapeFree(e,t){if(arraysEqual(e=e.slice(-2),t=t.slice(-2)))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){const n=e[e.length-1],r=t[t.length-1];if(n===r)return!0;if(isEven(n)&&isEven(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&isEven(e[0])&&isEven(t[0])}let MAX_TEXTURE_SIZE,MAX_TEXTURES_IN_SHADER;function getWebGLMaxTextureSize(e){if(null==MAX_TEXTURE_SIZE){const t=getWebGLContext(e);MAX_TEXTURE_SIZE=t.getParameter(t.MAX_TEXTURE_SIZE)}return MAX_TEXTURE_SIZE}function getMaxTexturesInShader(e){if(null==MAX_TEXTURES_IN_SHADER){const t=getWebGLContext(e);MAX_TEXTURES_IN_SHADER=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,MAX_TEXTURES_IN_SHADER)}function getWebGLDisjointQueryTimerVersion(e){if(0===e)return 0;let t;const n=getWebGLContext(e);return t=hasExtension(n,"EXT_disjoint_timer_query_webgl2")&&2===e?2:hasExtension(n,"EXT_disjoint_timer_query")?1:0,t}function hasExtension(e,t){return null!=e.getExtension(t)}function isWebGLVersionEnabled(e){try{if(null!=getWebGLContext(e))return!0}catch(e2){return console.log("Error when getting WebGL context: ",e2),!1}return!1}function isCapableOfRenderingToFloatTexture(e){if(0===e)return!1;const t=getWebGLContext(e);if(1===e){if(!hasExtension(t,"OES_texture_float"))return!1}else if(!hasExtension(t,"EXT_color_buffer_float"))return!1;return createFloatTextureAndBindToFramebuffer(t)}function isDownloadFloatTextureEnabled(e){if(0===e)return!1;const t=getWebGLContext(e);if(1!==e){if(hasExtension(t,"EXT_color_buffer_float"))return createFloatTextureAndBindToFramebuffer(t);const e="EXT_color_buffer_half_float";if(hasExtension(t,e)){const n=t.getExtension(e);return createHalfFloatTextureAndBindToFramebuffer(t,n)}return!1}if(!hasExtension(t,"OES_texture_float"))return!1;if(!hasExtension(t,"WEBGL_color_buffer_float"))return!1;return createFloatTextureAndBindToFramebuffer(t)}function createFloatTextureAndBindToFramebuffer(e){const t=getTextureConfig(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n);e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);const r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);const a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),a}function createHalfFloatTextureAndBindToFramebuffer(e,t){const n=getTextureConfig(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r);e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const a=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,a),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);const i=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(a),i}function isWebGLFenceEnabled(e){if(2!==e)return!1;return null!=getWebGLContext(e).fenceSync}function assertNotComplex(e,t){Array.isArray(e)||(e=[e]),e.forEach((e=>{null!=e&&assert$1("complex64"!==e.dtype,(()=>`${t} does not support complex64 tensors in the WebGL backend.`))}))}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const ENV=env();
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function getGlslDifferences(){let e,t,n,r,a,i,s,o,l,u;return 2===env().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",a="texture",i="outputColor",s="out vec4 outputColor;",o=env().getBool("WEBGL2_ISNAN_CUSTOM")?"\n      bool isnan_custom(float val) {\n        uint floatToUint = floatBitsToUint(val);\n        return (floatToUint & 0x7fffffffu) > 0x7f800000u;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ":"",l="",u="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",a="texture2D",i="gl_FragColor",s="",o="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",l="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",u="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:a,output:i,defineOutput:s,defineSpecialNaN:o,defineSpecialInf:l,defineRound:u}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function getLogicalCoordinatesFromFlatIndex(e,t,n="index"){const r=computeStrides(t);return r.map(((t,a)=>`${`int ${e[a]} = ${n} / ${t}`}; ${a===r.length-1?`int ${e[a+1]} = ${n} - ${e[a]} * ${t}`:`index -= ${e[a]} * ${t}`};`)).join("")}function getOutputLogicalCoordinatesFromFlatIndexByUniform(e,t,n="index"){const r=computeStrides(t);return r.map(((t,a)=>`${`int ${e[a]} = ${n} / outShapeStrides[${a}]`}; ${a===r.length-1?`int ${e[a+1]} = ${n} - ${e[a]} * outShapeStrides[${a}]`:`index -= ${e[a]} * outShapeStrides[${a}]`};`)).join("")}function symbolicallyComputeStrides(e,t){const n=e.length,r=e.map((e=>`${t}[${e}]`)),a=new Array(n-1);a[n-2]=r[n-1];for(let i=n-3;i>=0;--i)a[i]=`(${a[i+1]} * ${r[i+1]})`;return a}function getLogicalCoordinatesFromFlatIndexByUniform(e,t,n="index"){const r=symbolicallyComputeStrides(e.map(((e,t)=>t)),t);return r.map(((t,a)=>`${`int ${e[a]} = ${n} / ${r[a]}`}; ${a===r.length-1?`int ${e[a+1]} = ${n} - ${e[a]} * ${r[a]}`:`index -= ${e[a]} * ${r[a]}`};`)).join("")}function getFlatIndexFrom3D(e){const t=computeStrides(e).map((e=>e.toString()));return`\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * ${t[0]} + coords.y * ${t[1]} + coords.z;\n  }\n`}function getFlatIndexFrom3DOutput(){return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n"}ENV.registerFlag("HAS_WEBGL",(()=>ENV.getNumber("WEBGL_VERSION")>0)),ENV.registerFlag("WEBGL_VERSION",(()=>isWebGLVersionEnabled(2)?2:isWebGLVersionEnabled(1)?1:0)),ENV.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",(()=>!1)),ENV.registerFlag("WEBGL_BUFFER_SUPPORTED",(()=>2===ENV.get("WEBGL_VERSION"))),ENV.registerFlag("WEBGL_CPU_FORWARD",(()=>!0)),ENV.registerFlag("WEBGL_FORCE_F16_TEXTURES",(()=>!1)),ENV.registerFlag("WEBGL_PACK",(()=>ENV.getBool("HAS_WEBGL"))),ENV.registerFlag("WEBGL_PACK_NORMALIZATION",(()=>ENV.getBool("WEBGL_PACK"))),ENV.registerFlag("WEBGL_PACK_CLIP",(()=>ENV.getBool("WEBGL_PACK"))),ENV.registerFlag("WEBGL_PACK_DEPTHWISECONV",(()=>ENV.getBool("WEBGL_PACK"))),ENV.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(()=>ENV.getBool("WEBGL_PACK"))),ENV.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(()=>ENV.getBool("WEBGL_PACK"))),ENV.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(()=>ENV.getBool("WEBGL_PACK"))),ENV.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(()=>ENV.getBool("WEBGL_PACK"))),ENV.registerFlag("WEBGL_PACK_REDUCE",(()=>ENV.getBool("WEBGL_PACK"))),ENV.registerFlag("WEBGL_LAZILY_UNPACK",(()=>ENV.getBool("WEBGL_PACK"))),ENV.registerFlag("WEBGL_CONV_IM2COL",(()=>ENV.getBool("WEBGL_PACK"))),ENV.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",(()=>ENV.getBool("WEBGL_PACK"))),ENV.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(()=>getWebGLMaxTextureSize(ENV.getNumber("WEBGL_VERSION")))),ENV.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(()=>getMaxTexturesInShader(ENV.getNumber("WEBGL_VERSION")))),ENV.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(()=>{const e=ENV.getNumber("WEBGL_VERSION");return 0===e?0:getWebGLDisjointQueryTimerVersion(e)})),ENV.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(()=>ENV.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!isMobile())),ENV.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(()=>isCapableOfRenderingToFloatTexture(ENV.getNumber("WEBGL_VERSION")))),ENV.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(()=>!ENV.getBool("WEBGL_FORCE_F16_TEXTURES")&&ENV.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))),ENV.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(()=>isDownloadFloatTextureEnabled(ENV.getNumber("WEBGL_VERSION")))),ENV.registerFlag("WEBGL_FENCE_API_ENABLED",(()=>isWebGLFenceEnabled(ENV.getNumber("WEBGL_VERSION")))),ENV.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(()=>ENV.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0)),ENV.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",(()=>-1),(e=>{if("number"!=typeof e)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${e}.`);if(e<0&&-1!==e)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${e}.`)})),ENV.registerFlag("WEBGL_FLUSH_THRESHOLD",(()=>isMobile()?1:-1),(e=>{if("number"!=typeof e)throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${e}.`);if(e<0&&-1!==e)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${e}.`)})),ENV.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",(()=>128)),ENV.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",(()=>!1)),ENV.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",(()=>1e5)),ENV.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",(()=>128)),ENV.registerFlag("WEBGL_EXP_CONV",(()=>!1)),ENV.registerFlag("SOFTWARE_WEBGL_ENABLED",(()=>ENV.getBool("IS_TEST"))),ENV.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",(()=>1/0)),ENV.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",(()=>!1)),ENV.registerFlag("WEBGL2_ISNAN_CUSTOM",(()=>!1)),ENV.registerFlag("ENGINE_COMPILE_ONLY",(()=>!1));const ENCODE_FLOAT_SNIPPET="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n",{getBroadcastDims:getBroadcastDims}=backend_util;
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function makeShader(e,t,n){const r=[];if(e.forEach((e=>{const t=sizeFromShape(e.shapeInfo.logicalShape);if(e.shapeInfo.isUniform?r.push(`uniform float ${e.name}${t>1?`[${t}]`:""};`):(r.push(`uniform sampler2D ${e.name};`),r.push(`uniform int offset${e.name};`)),n.enableShapeUniforms){const{uniformShape:t}=getUniformInfoFromShape(n.packedInputs,e.shapeInfo.logicalShape,e.shapeInfo.texShape);switch(t.length){case 1:r.push(`uniform int ${e.name}Shape;`);break;case 2:r.push(`uniform ivec2 ${e.name}Shape;`);break;case 3:r.push(`uniform ivec3 ${e.name}Shape;`);break;case 4:r.push(`uniform ivec4 ${e.name}Shape;`)}r.push(`uniform ivec2 ${e.name}TexShape;`)}})),n.enableShapeUniforms){switch(t.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;")}r.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach((e=>{r.push(`uniform ${e.type} ${e.name}${e.arrayIndex?`[${e.arrayIndex}]`:""};`)}));const a=r.join("\n"),i=e.map((e=>getInputSamplingSnippet(e,t,n.packedInputs,n.enableShapeUniforms))).join("\n"),s=t.texShape,o=getGlslDifferences(),l=getFloatTextureSampleSnippet(o);let u,c,h=getShaderPrefix(o);t.isPacked?(u=getPackedOutputSamplingSnippet(t.logicalShape,s,n.enableShapeUniforms),c=getFloatTextureSetRGBASnippet(o)):(u=getOutputSamplingSnippet(t.logicalShape,s,n.enableShapeUniforms),c=getFloatTextureSetRSnippet(o)),n.packedInputs&&(h+=SHADER_PACKED_PREFIX);return[h,l,c,a,u,i,n.userCode].join("\n")}function getSamplerFromInInfo(e,t=!1){const n=e.shapeInfo.logicalShape;switch(n.length){case 0:return getSamplerScalar(e,t);case 1:return getSampler1D(e,t);case 2:return getSampler2D(e,t);case 3:return getSampler3D(e,t);case 4:return getSampler4D(e,t);case 5:return getSampler5D(e);case 6:return getSampler6D(e);default:throw new Error(`${n.length}-D input sampling is not yet supported`)}}function getPackedSamplerFromInInfo(e,t){switch(e.shapeInfo.logicalShape.length){case 0:return getPackedSamplerScalar(e);case 1:return getPackedSampler1D(e,t);case 2:return getPackedSampler2D(e,t);case 3:return getPackedSampler3D(e,t);default:return getPackedSamplerND(e,t)}}function getInputSamplingSnippet(e,t,n=!1,r){let a="";a+=n?getPackedSamplerFromInInfo(e,r):getSamplerFromInInfo(e,r);const i=e.shapeInfo.logicalShape,s=t.logicalShape;return i.length<=s.length&&(a+=n?getPackedSamplerAtOutputCoords(e,t):getSamplerAtOutputCoords(e,t)),a}function getPackedOutputSamplingSnippet(e,t,n){switch(e.length){case 0:return getOutputScalarCoords();case 1:return getOutputPacked1DCoords(e,t,n);case 2:return getOutputPacked2DCoords(e,t,n);case 3:return getOutputPacked3DCoords(e,t,n);default:return getOutputPackedNDCoords(e,t,n)}}function getOutputSamplingSnippet(e,t,n){switch(e.length){case 0:return getOutputScalarCoords();case 1:return getOutput1DCoords(e,t,n);case 2:return getOutput2DCoords(e,t,n);case 3:return getOutput3DCoords(e,t,n);case 4:return getOutput4DCoords(e,t,n);case 5:return getOutput5DCoords(e,t);case 6:return getOutput6DCoords(e,t);default:throw new Error(`${e.length}-D output sampling is not yet supported`)}}function getFloatTextureSampleSnippet(e){return`\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return ${e.texture2D}(textureSampler, uv).r;\n    }\n  `}function getFloatTextureSetRSnippet(e){return`\n    void setOutput(float val) {\n      ${e.output} = vec4(val, 0, 0, 0);\n    }\n  `}function getFloatTextureSetRGBASnippet(e){return`\n    void setOutput(vec4 val) {\n      ${e.output} = val;\n    }\n  `}function getShaderPrefix(e){return`${e.version}\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ${e.varyingFs} vec2 resultUV;\n    ${e.defineOutput}\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    ${e.defineSpecialNaN}\n    ${e.defineSpecialInf}\n    ${e.defineRound}\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    ${SAMPLE_1D_SNIPPET}\n    ${SAMPLE_2D_SNIPPET}\n    ${SAMPLE_3D_SNIPPET}\n  `}const SAMPLE_1D_SNIPPET="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",SAMPLE_2D_SNIPPET="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",SAMPLE_3D_SNIPPET="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",SHADER_PACKED_PREFIX="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function getOutputScalarCoords(){return"\n    int getOutputCoords() {\n      return 0;\n    }\n  "}function getOutputPacked1DCoords(e,t,n){const r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return 1===r[0]?n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));\n      }\n    ":`\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ${r[1]}.0);\n      }\n    `:1===r[1]?n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));\n      }\n    ":`\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ${r[0]}.0);\n      }\n    `:n?"\n    int getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);\n    }\n  ":`\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${r[0]}, ${r[1]}));\n      return 2 * (resTexRC.x * ${r[1]} + resTexRC.y);\n    }\n  `}function getOutput1DCoords(e,t,n){return 1===t[0]?n?"\n      int getOutputCoords() {\n        return int(resultUV.x * float(outTexShape[1]));\n      }\n    ":`\n      int getOutputCoords() {\n        return int(resultUV.x * ${t[1]}.0);\n      }\n    `:1===t[1]?n?"\n      int getOutputCoords() {\n        return int(resultUV.y * float(outTexShape[0]));\n      }\n    ":`\n      int getOutputCoords() {\n        return int(resultUV.y * ${t[0]}.0);\n      }\n    `:n?"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      return resTexRC.x * outTexShape[1] + resTexRC.y;\n    }\n  ":`\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${t[0]}, ${t[1]}));\n      return resTexRC.x * ${t[1]} + resTexRC.y;\n    }\n  `}function getOutputPacked3DCoords(e,t,n){if(n)return"\n    ivec3 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";const r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],a=Math.ceil(e[2]/2),i=a*Math.ceil(e[1]/2);return`\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${r[0]}, ${r[1]}));\n      int index = resTexRC.x * ${r[1]} + resTexRC.y;\n\n      int b = index / ${i};\n      index -= b * ${i};\n\n      int r = 2 * (index / ${a});\n      int c = imod(index, ${a}) * 2;\n\n      return ivec3(b, r, c);\n    }\n  `}function getOutput3DCoords(e,t,n){if(n){return`\n  ivec3 getOutputCoords() {\n    ivec2 resTexRC = ivec2(resultUV.yx *\n                           vec2(outTexShape[0], outTexShape[1]));\n    int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n    ${getOutputLogicalCoordinatesFromFlatIndexByUniform(["r","c","d"],e)}\n    return ivec3(r, c, d);\n  }\n`}const r=getLogicalCoordinatesFromFlatIndex(["r","c","d"],e);return`\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${t[0]}, ${t[1]}));\n      int index = resTexRC.x * ${t[1]} + resTexRC.y;\n      ${r}\n      return ivec3(r, c, d);\n    }\n  `}function getOutputPackedNDCoords(e,t,n){if(n)return"\n    ivec4 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatchN = texelsInBatch * outShape[1];\n\n      int b2 = index / texelsInBatchN;\n      index -= b2 * texelsInBatchN;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec4(b2, b, r, c);\n    }\n  ";const r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],a=Math.ceil(e[e.length-1]/2),i=a*Math.ceil(e[e.length-2]/2);let s=i,o="",l="b, r, c";for(let u=2;u<e.length-1;u++)s*=e[e.length-u-1],o=`\n      int b${u} = index / ${s};\n      index -= b${u} * ${s};\n    `+o,l=`b${u}, `+l;return`\n    ivec${e.length} getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${r[0]}, ${r[1]}));\n      int index = resTexRC.x * ${r[1]} + resTexRC.y;\n\n      ${o}\n\n      int b = index / ${i};\n      index -= b * ${i};\n\n      int r = 2 * (index / ${a});\n      int c = imod(index, ${a}) * 2;\n\n      return ivec${e.length}(${l});\n    }\n  `}function getOutput4DCoords(e,t,n){if(n){return`\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      ${getOutputLogicalCoordinatesFromFlatIndexByUniform(["r","c","d","d2"],e)}\n      return ivec4(r, c, d, d2);\n    }\n  `}const r=getLogicalCoordinatesFromFlatIndex(["r","c","d","d2"],e);return`\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(${t[0]}, ${t[1]}));\n      int index = resTexRC.x * ${t[1]} + resTexRC.y;\n      ${r}\n      return ivec4(r, c, d, d2);\n    }\n  `}function getOutput5DCoords(e,t){const n=getLogicalCoordinatesFromFlatIndex(["r","c","d","d2","d3"],e);return`\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${t[0]},\n                             ${t[1]}));\n\n      int index = resTexRC.x * ${t[1]} + resTexRC.y;\n\n      ${n}\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  `}function getOutput6DCoords(e,t){const n=getLogicalCoordinatesFromFlatIndex(["r","c","d","d2","d3","d4"],e);return`\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(${t[0]}, ${t[1]}));\n      int index = resTexRC.x * ${t[1]} + resTexRC.y;\n\n      ${n}\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  `}function getOutputPacked2DCoords(e,t,n){const r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(arraysEqual(e,t))return n?"\n      ivec2 getOutputCoords() {\n        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2(${r[0]}, ${r[1]}));\n      }\n    `;const a=Math.ceil(e[1]/2);return n?"\n    ivec2 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec2(r, c);\n    }\n  ":`\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${r[0]}, ${r[1]}));\n\n      int index = resTexRC.x * ${r[1]} + resTexRC.y;\n      int r = 2 * (index / ${a});\n      int c = imod(index, ${a}) * 2;\n\n      return ivec2(r, c);\n    }\n  `}function getOutput2DCoords(e,t,n){return arraysEqual(e,t)?n?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(${t[0]}, ${t[1]}));\n      }\n    `:1===e[1]?n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(${t[0]}, ${t[1]}));\n        int index = resTexRC.x * ${t[1]} + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    `:1===e[0]?n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(${t[0]}, ${t[1]}));\n        int index = resTexRC.x * ${t[1]} + resTexRC.y;\n        return ivec2(0, index);\n      }\n    `:n?"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      int r = index / outShape[1];\n      int c = index - r * outShape[1];\n      return ivec2(r, c);\n    }\n  ":`\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${t[0]}, ${t[1]}));\n      int index = resTexRC.x * ${t[1]} + resTexRC.y;\n      int r = index / ${e[1]};\n      int c = index - r * ${e[1]};\n      return ivec2(r, c);\n    }\n  `}function getFlatOffsetUniformName(e){return`offset${e}`}function getPackedSamplerScalar(e){const t=e.name;return`\n    vec4 ${"get"+t.charAt(0).toUpperCase()+t.slice(1)}() {\n      return ${getGlslDifferences().texture2D}(${t}, halfCR);\n    }\n  `}function getSamplerScalar(e,t){const n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return`float ${r}() {return ${n};}`;const[a,i]=e.shapeInfo.texShape;if(1===a&&1===i)return`\n      float ${r}() {\n        return sampleTexture(${n}, halfCR);\n      }\n    `;const s=getFlatOffsetUniformName(n);if(t)return`\n    float ${r}() {\n      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], ${s});\n      return sampleTexture(${n}, uv);\n    }\n  `;const[o,l]=e.shapeInfo.texShape;return`\n    float ${r}() {\n      vec2 uv = uvFromFlat(${o}, ${l}, ${s});\n      return sampleTexture(${n}, uv);\n    }\n  `}function getPackedSampler1D(e,t){const n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape,i=getGlslDifferences();if(t)return`\n    vec4 ${r}(int index) {\n      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));\n      vec2 uv = packedUVfrom1D(\n        packedTexShape[0], packedTexShape[1], index);\n      return ${i.texture2D}(${n}, uv);\n    }\n  `;const s=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];return`\n    vec4 ${r}(int index) {\n      vec2 uv = packedUVfrom1D(\n        ${s[0]}, ${s[1]}, index);\n      return ${i.texture2D}(${n}, uv);\n    }\n  `}function getSampler1D(e,t){const n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return`\n      float ${r}(int index) {\n        ${getUniformSampler(e)}\n      }\n    `;const a=e.shapeInfo.texShape,i=a[0],s=a[1];if(1===s&&1===i)return`\n      float ${r}(int index) {\n        return sampleTexture(${n}, halfCR);\n      }\n    `;const o=getFlatOffsetUniformName(n);return 1===s?t?`\n      float ${r}(int index) {\n        vec2 uv = vec2(0.5, (float(index + ${o}) + 0.5) / float(${n}TexShape[0]));\n        return sampleTexture(${n}, uv);\n      }\n    `:`\n      float ${r}(int index) {\n        vec2 uv = vec2(0.5, (float(index + ${o}) + 0.5) / ${i}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `:1===i?t?`\n      float ${r}(int index) {\n        vec2 uv = vec2((float(index + ${o}) + 0.5) / float(${n}TexShape[1]), 0.5);\n        return sampleTexture(${n}, uv);\n      }\n    `:`\n      float ${r}(int index) {\n        vec2 uv = vec2((float(index + ${o}) + 0.5) / ${s}.0, 0.5);\n        return sampleTexture(${n}, uv);\n      }\n    `:t?`\n    float ${r}(int index) {\n      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index + ${o});\n      return sampleTexture(${n}, uv);\n    }\n  `:`\n    float ${r}(int index) {\n      vec2 uv = uvFromFlat(${i}, ${s}, index + ${o});\n      return sampleTexture(${n}, uv);\n    }\n  `}function getPackedSampler2D(e,t){const n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,s=i[0],o=i[1],l=getGlslDifferences();if(null!=i&&arraysEqual(n,i))return t?`\n      vec4 ${a}(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);\n\n        return ${l.texture2D}(${r}, uv);\n      }\n    `:`\n      vec4 ${a}(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(${o}.0, ${s}.0);\n\n        return ${l.texture2D}(${r}, uv);\n      }\n    `;if(t)return`\n    vec4 ${a}(int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(${r}Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);\n      return ${l.texture2D}(${r}, uv);\n    }\n  `;const u=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];return`\n    vec4 ${a}(int row, int col) {\n      vec2 uv = packedUVfrom2D(${Math.ceil(n[1]/2)}, ${u[0]}, ${u[1]}, row, col);\n      return ${l.texture2D}(${r}, uv);\n    }\n  `}function getSampler2D(e,t){const n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape;if(null!=i&&arraysEqual(n,i)){if(t)return`\n      float ${a}(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `;const e=i[0];return`\n    float ${a}(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2(${i[1]}.0, ${e}.0);\n      return sampleTexture(${r}, uv);\n    }\n  `}const{newShape:s,keptDims:o}=squeezeShape(n),l=s;if(l.length<n.length){const n=["row","col"];return`\n      ${getSamplerFromInInfo(squeezeInputInfo(e,l),t)}\n      float ${a}(int row, int col) {\n        return ${a}(${getSqueezedParams(n,o)});\n      }\n    `}if(e.shapeInfo.isUniform)return`\n      float ${a}(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));\n        ${getUniformSampler(e)}\n      }\n    `;const u=i[0],c=i[1],h=getFlatOffsetUniformName(r);return 1===c?t?`\n      float ${a}(int row, int col) {\n        float index = dot(vec3(row, col, ${h}), vec3(${r}Shape[1], 1, 1));\n        vec2 uv = vec2(0.5, (index + 0.5) / float(${r}TexShape[0]));\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n    float ${a}(int row, int col) {\n      float index = dot(vec3(row, col, ${h}), vec3(${n[1]}, 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / ${u}.0);\n      return sampleTexture(${r}, uv);\n    }\n  `:1===u?t?`\n      float ${a}(int row, int col) {\n        float index = dot(vec3(row, col, ${h}), vec3(${r}Shape[1], 1, 1));\n        vec2 uv = vec2((index + 0.5) / float(${r}TexShape[1]), 0.5);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n    float ${a}(int row, int col) {\n      float index = dot(vec3(row, col, ${h}), vec3(${n[1]}, 1, 1));\n      vec2 uv = vec2((index + 0.5) / ${c}.0, 0.5);\n      return sampleTexture(${r}, uv);\n    }\n  `:t?`\n      float ${a}(int row, int col) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ${r}Shape[1] + col + ${h};\n        vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n  float ${a}(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * ${n[1]} + col + ${h};\n    vec2 uv = uvFromFlat(${u}, ${c}, index);\n    return sampleTexture(${r}, uv);\n  }\n`}function getPackedSampler3D(e,t){const n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,s=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(1===n[0]){const r=[1,2],i=["b","row","col"];return`\n        ${getPackedSamplerFromInInfo(squeezeInputInfo(e,n.slice(1)),t)}\n        vec4 ${a}(int b, int row, int col) {\n          return ${a}(${getSqueezedParams(i,r)});\n        }\n      `}const o=getGlslDifferences();if(t)return`\n    vec4 ${a}(int b, int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(${r}Shape[2]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(${r}Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom3D(\n        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);\n      return ${o.texture2D}(${r}, uv);\n    }\n  `;const l=s[0],u=s[1],c=Math.ceil(n[2]/2);return`\n    vec4 ${a}(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ${l}, ${u}, ${c*Math.ceil(n[1]/2)}, ${c}, b, row, col);\n      return ${o.texture2D}(${r}, uv);\n    }\n  `}function getSampler3D(e,t){const n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[1]*n[2],s=n[2],{newShape:o,keptDims:l}=squeezeShape(n),u=o;if(u.length<n.length){const n=["row","col","depth"];return`\n        ${getSamplerFromInInfo(squeezeInputInfo(e,u),t)}\n        float ${a}(int row, int col, int depth) {\n          return ${a}(${getSqueezedParams(n,l)});\n        }\n      `}if(e.shapeInfo.isUniform)return`\n      float ${a}(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3(${i}, ${s}, 1)));\n        ${getUniformSampler(e)}\n      }\n    `;const c=e.shapeInfo.texShape,h=c[0],d=c[1],p=e.shapeInfo.flatOffset;if(d===i&&null==p)return t?`\n      float ${a}(int row, int col, int depth) {\n        int stride1 = ${r}Shape[2];\n        float texR = float(row);\n        float texC = dot(vec2(col, depth), vec2(stride1, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n        float ${a}(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2(${s}, 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2(${d}.0, ${h}.0);\n          return sampleTexture(${r}, uv);\n        }\n      `;if(d===s&&null==p)return t?`\n      float ${a}(int row, int col, int depth) {\n        float texR = dot(vec2(row, col), vec2(${r}Shape[1], 1));\n        float texC = float(depth);\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n    float ${a}(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${d}.0, ${h}.0);\n      return sampleTexture(${r}, uv);\n    }\n  `;const f=getFlatOffsetUniformName(r);return t?`\n    float ${a}(int row, int col, int depth) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int stride0 = ${r}Shape[1] * ${r}Shape[2];\n      int stride1 = ${r}Shape[2];\n      int index = row * stride0 + col * stride1 + depth + ${f};\n      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);\n      return sampleTexture(${r}, uv);\n    }\n    `:`\n      float ${a}(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ${i} + col * ${s} + depth + ${f};\n        vec2 uv = uvFromFlat(${h}, ${d}, index);\n        return sampleTexture(${r}, uv);\n      }\n  `}function getPackedSamplerND(e,t){const n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=getGlslDifferences();if(t)return`\n    vec4 ${r}(int b2, int b, int row, int col) {\n      int valuesPerRow = int(ceil(float(${n}Shape[3]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(${n}Shape[2]) / 2.0));\n      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);\n      texelsInBatch *= ${n}Shape[1];\n      index = b2 * texelsInBatch + index;\n      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));\n      int texR = index / packedTexShape[1];\n      int texC = index - texR * packedTexShape[1];\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${a.texture2D}(${n}, uv);\n    }\n  `;const i=e.shapeInfo.logicalShape,s=i.length,o=e.shapeInfo.texShape,l=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],u=l[0],c=l[1],h=Math.ceil(i[s-1]/2);let d=h*Math.ceil(i[s-2]/2),p="int b, int row, int col",f=`b * ${d} + (row / 2) * ${h} + (col / 2)`;for(let m=2;m<s-1;m++)p=`int b${m}, `+p,d*=i[s-m-1],f=`b${m} * ${d} + `+f;return`\n    vec4 ${r}(${p}) {\n      int index = ${f};\n      int texR = index / ${c};\n      int texC = index - texR * ${c};\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${c}, ${u});\n      return ${a.texture2D}(${n}, uv);\n    }\n  `}function getSampler4D(e,t){const n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[3],s=n[2]*i,o=n[1]*s,{newShape:l,keptDims:u}=squeezeShape(n);if(l.length<n.length){const n=["row","col","depth","depth2"];return`\n      ${getSamplerFromInInfo(squeezeInputInfo(e,l),t)}\n      float ${a}(int row, int col, int depth, int depth2) {\n        return ${a}(${getSqueezedParams(n,u)});\n      }\n    `}if(e.shapeInfo.isUniform)return`\n      float ${a}(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4(${o}, ${s}, ${i}, 1)));\n        ${getUniformSampler(e)}\n      }\n    `;const c=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,d=h[0],p=h[1],f=`int stride2 = ${r}Shape[3];`,m=`int stride1 = ${r}Shape[2] * stride2;`,g=`int stride0 = ${r}Shape[1] * stride1;`;if(p===o&&null==c)return t?`\n      float ${a}(int row, int col, int depth, int depth2) {\n        ${f}\n        ${m}\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(stride1, stride2, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n      float ${a}(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(${s}, ${i}, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${p}.0, ${d}.0);\n        return sampleTexture(${r}, uv);\n      }\n    `;if(p===i&&null==c)return t?`\n      float ${a}(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(${r}Shape[1] * ${r}Shape[2], ${r}Shape[2], 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n      float ${a}(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(${n[1]*n[2]}, ${n[2]}, 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${p}.0, ${d}.0);\n        return sampleTexture(${r}, uv);\n      }\n    `;const y=getFlatOffsetUniformName(r);return t?`\n    float ${a}(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      ${f}\n      ${m}\n      ${g}\n      int index = row * stride0 + col * stride1 +\n          depth * stride2 + depth2;\n      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index + ${y});\n      return sampleTexture(${r}, uv);\n    }\n  `:`\n    float ${a}(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${o} + col * ${s} +\n          depth * ${i} + depth2;\n      vec2 uv = uvFromFlat(${d}, ${p}, index + ${y});\n      return sampleTexture(${r}, uv);\n    }\n  `}function getSampler5D(e){const t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[4],i=t[3]*a,s=t[2]*i,o=t[1]*s,{newShape:l,keptDims:u}=squeezeShape(t);if(l.length<t.length){const t=["row","col","depth","depth2","depth3"];return`\n      ${getSamplerFromInInfo(squeezeInputInfo(e,l))}\n      float ${r}(int row, int col, int depth, int depth2, int depth3) {\n        return ${r}(${getSqueezedParams(t,u)});\n      }\n    `}if(e.shapeInfo.isUniform)return`\n      float ${r}(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4(${o}, ${s}, ${i}, ${a})) +\n          depth3;\n        ${getUniformSampler(e)}\n      }\n    `;const c=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,d=h[0],p=h[1];if(p===o&&null==c)return`\n      float ${r}(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4(${s}, ${i}, ${a}, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${p}.0, ${d}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;if(p===a&&null==c)return`\n      float ${r}(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4(${t[1]*t[2]*t[3]},\n               ${t[2]*t[3]}, ${t[3]}, 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${p}.0, ${d}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;return`\n    float ${r}(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${o} + col * ${s} + depth * ${i} +\n          depth2 * ${a} + depth3 + ${getFlatOffsetUniformName(n)};\n      vec2 uv = uvFromFlat(${d}, ${p}, index);\n      return sampleTexture(${n}, uv);\n    }\n  `}function getSampler6D(e){const t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:a,keptDims:i}=squeezeShape(t);if(a.length<t.length){const t=["row","col","depth","depth2","depth3","depth4"];return`\n      ${getSamplerFromInInfo(squeezeInputInfo(e,a))}\n      float ${r}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return ${r}(${getSqueezedParams(t,i)});\n      }\n    `}const s=t[5],o=t[4]*s,l=t[3]*o,u=t[2]*l,c=t[1]*u;if(e.shapeInfo.isUniform)return`\n      float ${r}(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4(${c}, ${u}, ${l}, ${o})) +\n          dot(\n            vec2(depth3, depth4),\n            vec2(${s}, 1)));\n        ${getUniformSampler(e)}\n      }\n    `;const h=e.shapeInfo.flatOffset,d=e.shapeInfo.texShape,p=d[0],f=d[1];if(f===c&&null==h)return`\n      float ${r}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4(${u}, ${l}, ${o}, ${s})) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${f}.0, ${p}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;if(f===s&&null==h)return`\n      float ${r}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4(${t[1]*t[2]*t[3]*t[4]},\n               ${t[2]*t[3]*t[4]},\n               ${t[3]*t[4]},\n               ${t[4]})) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${f}.0, ${p}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;return`\n    float ${r}(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${c} + col * ${u} + depth * ${l} +\n          depth2 * ${o} + depth3 * ${s} + depth4 + ${getFlatOffsetUniformName(n)};\n      vec2 uv = uvFromFlat(${p}, ${f}, index);\n      return sampleTexture(${n}, uv);\n    }\n  `}function getUniformSampler(e){const t=e.name,n=sizeFromShape(e.shapeInfo.logicalShape);return n<2?`return ${t};`:`\n    for (int i = 0; i < ${n}; i++) {\n      if (i == index) {\n        return ${t}[i];\n      }\n    }\n  `}function getPackedSamplerAtOutputCoords(e,t){const n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),a="get"+r+"AtOutCoords",i=e.shapeInfo.logicalShape.length,s=t.logicalShape.length,o=getBroadcastDims(e.shapeInfo.logicalShape,t.logicalShape),l=getCoordsDataType(s),u=s-i;let c;const h=["x","y","z","w","u","v"];c=0===i?"":s<2&&o.length>=1?"coords = 0;":o.map((e=>`coords.${h[e+u]} = 0;`)).join("\n");let d="";d=s<2&&i>0?"coords":e.shapeInfo.logicalShape.map(((e,t)=>`coords.${h[t+u]}`)).join(", ");let p="return outputValue;";const f=1===sizeFromShape(e.shapeInfo.logicalShape),m=1===sizeFromShape(t.logicalShape);if(1!==i||f||m){if(f&&!m)p=1===s?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(o.length){const e=i-2,t=i-1;o.indexOf(e)>-1&&o.indexOf(t)>-1?p="return vec4(outputValue.x);":o.indexOf(e)>-1?p="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":o.indexOf(t)>-1&&(p="return vec4(outputValue.xx, outputValue.zz);")}}else p="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return`\n    vec4 ${a}() {\n      ${l} coords = getOutputCoords();\n      ${c}\n      vec4 outputValue = get${r}(${d});\n      ${p}\n    }\n  `}function getSamplerAtOutputCoords(e,t){const n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),a="get"+r+"AtOutCoords",i=t.texShape,s=e.shapeInfo.texShape,o=e.shapeInfo.logicalShape.length,l=t.logicalShape.length;if(!e.shapeInfo.isUniform&&o===l&&null==e.shapeInfo.flatOffset&&arraysEqual(s,i))return`\n      float ${a}() {\n        return sampleTexture(${n}, resultUV);\n      }\n    `;const u=getCoordsDataType(l),c=getBroadcastDims(e.shapeInfo.logicalShape,t.logicalShape),h=l-o;let d;const p=["x","y","z","w","u","v"];d=0===o?"":l<2&&c.length>=1?"coords = 0;":c.map((e=>`coords.${p[e+h]} = 0;`)).join("\n");let f="";return f=l<2&&o>0?"coords":e.shapeInfo.logicalShape.map(((e,t)=>`coords.${p[t+h]}`)).join(", "),`\n    float ${a}() {\n      ${u} coords = getOutputCoords();\n      ${d}\n      return get${r}(${f});\n    }\n  `}function getCoordsDataType(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error(`GPU for rank ${e} is not yet supported`)}function getUniformInfoFromShape(e,t,n){const{newShape:r,keptDims:a}=squeezeShape(t),i=t.length,s=e&&3===i&&1===t[0],o=s?t.slice(1):r,l=!e&&i>1&&!arraysEqual(t,n)&&r.length<i||s;return{useSqueezeShape:l,uniformShape:l?o:t,keptDims:a}}function squeezeInputInfo(e,t){const n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function getSqueezedParams(e,t){return t.map((t=>e[t])).join(", ")}
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function compileProgram(e,t,n,r){const a=n.map(((e,n)=>{const r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}})),i=a.map((e=>e.shapeInfo)),s={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},o=makeShader(a,s,t),l=createFragmentShader(e.gl,o),u=e.createProgram(l);return env().get("ENGINE_COMPILE_ONLY")?{program:t,fragmentShader:l,source:o,webGLProgram:u,inShapeInfos:i,outShapeInfo:s,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(e.buildVao(u),Object.assign({program:t,fragmentShader:l,source:o,webGLProgram:u,inShapeInfos:i,outShapeInfo:s},getUniformLocations(e,t,u)))}function getUniformLocations(e,t,n){const r=[],a=[];let i,s,o,l=null,u=null;u=e.getUniformLocation(n,"NAN",!1),1===env().getNumber("WEBGL_VERSION")&&(l=e.getUniformLocation(n,"INFINITY",!1));const c=!1;for(const h of t.variableNames){const a={name:h,uniform:e.getUniformLocation(n,h,c),offset:e.getUniformLocation(n,`offset${h}`,c)};t.enableShapeUniforms&&(a.shape=e.getUniformLocation(n,`${h}Shape`,c),a.texShape=e.getUniformLocation(n,`${h}TexShape`,c)),r.push(a)}if(t.enableShapeUniforms&&(i=e.getUniformLocation(n,"outShape",c),o=e.getUniformLocation(n,"outShapeStrides",c),s=e.getUniformLocation(n,"outTexShape",c)),t.customUniforms)for(const h of t.customUniforms)a.push(e.getUniformLocation(n,h.name,c));return{variablesLocations:r,customUniformLocations:a,infLoc:l,nanLoc:u,outShapeLocation:i,outShapeStridesLocation:o,outTexShapeLocation:s}}function validateBinaryAndProgram(e,t){if(e.length!==t.length)throw Error(`Binary was compiled with ${e.length} inputs, but was executed with ${t.length} inputs`);e.forEach(((e,n)=>{const r=e.logicalShape,a=t[n],i=a.shape;if(!arraysEqual(r,i))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${r} and ${i} must match`);if(e.isUniform&&a.isUniform)return;const s=e.texShape,o=a.isUniform?null:a.texData.texShape;if(!arraysEqual(s,o))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${s} and ${o} must match`)}))}function runProgram(e,t,n,r,a){t.program.enableShapeUniforms||(validateBinaryAndProgram(t.inShapeInfos,n),validateBinaryAndProgram([t.outShapeInfo],[r]));const i=r.texData.texture,s=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(i.texture,s[0],s[1]):e.setOutputMatrixTexture(i.texture,s[0],s[1]),e.setProgram(t.webGLProgram),e.bindVertexArray(t.webGLProgram.vao),1===env().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN);for(let l=0;l<n.length;++l){const r=n[l],{uniform:a,offset:i,shape:s,texShape:o}=t.variablesLocations[l];if(s){const{uniformShape:n}=getUniformInfoFromShape(t.program.packedInputs,r.shape,r.texData.texShape);switch(n.length){case 1:e.gl.uniform1iv(s,new Int32Array(n));break;case 2:e.gl.uniform2iv(s,new Int32Array(n));break;case 3:e.gl.uniform3iv(s,new Int32Array(n));break;case 4:e.gl.uniform4iv(s,new Int32Array(n))}}if(o&&e.gl.uniform2i(o,r.texData.texShape[0],r.texData.texShape[1]),null!=a)if(r.isUniform)if(sizeFromShape(r.shape)<2)e.gl.uniform1f(a,r.uniformValues[0]);else{let t=r.uniformValues;t instanceof Float32Array||(t=new Float32Array(t)),e.gl.uniform1fv(a,t)}else null!=r.texData.slice&&null!=i&&e.gl.uniform1i(i,r.texData.slice.flatOffset),e.setInputMatrixTexture(r.texData.texture.texture,a,l)}const o=t.outShapeLocation;if(o)switch(r.shape.length){case 1:e.gl.uniform1iv(o,new Int32Array(r.shape));break;case 2:e.gl.uniform2iv(o,new Int32Array(r.shape));break;case 3:e.gl.uniform3iv(o,new Int32Array(r.shape));break;case 4:e.gl.uniform4iv(o,new Int32Array(r.shape))}if(t.outShapeStridesLocation){const n=computeStrides(r.shape);switch(r.shape.length){case 2:e.gl.uniform1iv(t.outShapeStridesLocation,new Int32Array(n));break;case 3:e.gl.uniform2iv(t.outShapeStridesLocation,new Int32Array(n));break;case 4:e.gl.uniform3iv(t.outShapeStridesLocation,new Int32Array(n))}}if(t.outTexShapeLocation&&e.gl.uniform2i(t.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),t.program.customUniforms&&a)for(let l=0;l<t.program.customUniforms.length;++l){const n=t.program.customUniforms[l],r=t.customUniformLocations[l],i=a[l];if("float"===n.type)e.gl.uniform1fv(r,i);else if("vec2"===n.type)e.gl.uniform2fv(r,i);else if("vec3"===n.type)e.gl.uniform3fv(r,i);else if("vec4"===n.type)e.gl.uniform4fv(r,i);else if("int"===n.type)e.gl.uniform1iv(r,i);else if("ivec2"===n.type)e.gl.uniform2iv(r,i);else if("ivec3"===n.type)e.gl.uniform3iv(r,i);else{if("ivec4"!==n.type)throw Error(`uniform type ${n.type} is not supported yet.`);e.gl.uniform4iv(r,i)}}e.executeProgram()}function makeShaderKey(e,t,n){let r="";t.concat(n).forEach((t=>{const a=null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0;if(e.enableShapeUniforms&&!t.isUniform){const i=t.texData.texShape,{useSqueezeShape:s,uniformShape:o,keptDims:l}=getUniformInfoFromShape(e.packedInputs,t.shape,i);let u="",c="",h="";if(1===o.length&&e.packedInputs){const e=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];u=`${e[0]>1}_${e[1]>1}`}else if(2!==o.length||e.packedInputs){if(o.length>2&&!e.packedInputs){const e=computeStrides(o);h=`${e[0]===i[1]}_${e[e.length-1]===i[1]}`}}else c=`${o[0]>1}_${o[1]>1}`;const d=t.shape.length,p=2===o.length&&arraysEqual(t.shape,i),f=1===sizeFromShape(t.shape),m=getBroadcastDims$1(t.shape,n.shape),g=!e.packedInputs&&d===n.shape.length&&arraysEqual(i,n.texData.texShape),y=e.packedInputs||o.length>2?"":`${i[0]>1}_${i[1]>1}`;r+=`${d}_${g}_${s?l:""}_${o.length}_${f}_${m}_${p}_${u}_${c}_${h}_${y}_${a}`}else{const e=t.isUniform?"uniform":t.texData.texShape;r+=`${t.shape}_${e}_${a}`}}));const a=e.userCode;let i=e.constructor.name;return i+="_"+r+"_"+a+`${env().getNumber("WEBGL_VERSION")}`,i}function useShapeUniforms(e){return env().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&e<=4}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class DecodeMatrixProgram{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=PackingScheme.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=getGlslDifferences();this.outputShape=e,this.enableShapeUniforms=useShapeUniforms(this.outputShape.length),this.userCode=`\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ${this.enableShapeUniforms?getOutputLogicalCoordinatesFromFlatIndexByUniform(["r","c","d"],e):getLogicalCoordinatesFromFlatIndex(["r","c","d"],e)}\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ${t.output} = result;\n      }\n    `}}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class DecodeMatrixPackedProgram{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=PackingScheme.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=getGlslDifferences();this.outputShape=e,this.enableShapeUniforms=useShapeUniforms(this.outputShape.length),this.userCode=`\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ${this.enableShapeUniforms?getOutputLogicalCoordinatesFromFlatIndexByUniform(["r","c","d"],e):getLogicalCoordinatesFromFlatIndex(["r","c","d"],e)}\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ${t.output} = result;\n      }\n    `}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class EncodeFloatProgram{constructor(e){this.variableNames=["A"],this.outTexUsage=TextureUsage.DOWNLOAD;const t=getGlslDifferences();this.outputShape=e,this.userCode=`\n      ${ENCODE_FLOAT_SNIPPET}\n\n      void main() {\n        float x = getAAtOutCoords();\n        ${t.output} = encode_float(x);\n      }\n    `}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class EncodeFloatPackedProgram{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=TextureUsage.DOWNLOAD;const t=getGlslDifferences();this.outputShape=e,this.userCode=`\n      ${ENCODE_FLOAT_SNIPPET}\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ${t.output} = encode_float(x);\n      }\n    `}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const CHANNEL_CHAR_TO_INDEX_MAP={R:0,G:1,B:2,A:3};class EncodeMatrixProgram{constructor(e,t=!1,n="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=getGlslDifferences();this.outputShape=e,this.enableShapeUniforms=useShapeUniforms(this.outputShape.length);let a="result";t&&(a="floor(result * 255. + 0.5)");let i="";for(let s=0;s<n.length;s++){const e=n[s];i+=`\n          if(offset == ${s}) {\n            result = values[${CHANNEL_CHAR_TO_INDEX_MAP[e]}];\n          }`}this.userCode=`\n      ${this.enableShapeUniforms?getFlatIndexFrom3DOutput():getFlatIndexFrom3D(e)}\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int flatIndex = getFlatIndex(coords);\n        float result = 0.;\n        int offset = imod(flatIndex, ${n.length});\n\n        flatIndex = idiv(flatIndex, ${n.length}, 1.);\n\n        int r = flatIndex / texShape[1];\n        if (r < texShape[0]) {\n          int c = imod(flatIndex, texShape[1]);\n          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n          vec4 values = ${r.texture2D}(A, uv);\n          ${i}\n        }\n        ${r.output} = vec4(${a}, 0., 0., 0.);\n      }\n    `}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class EncodeMatrixPackedProgram{constructor(e,t=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=getGlslDifferences();this.outputShape=e,this.enableShapeUniforms=useShapeUniforms(this.outputShape.length);let r="",a="result";t&&(a="floor(result * 255. + 0.5)");for(let i=0;i<=1;i++)for(let t=0;t<=1;t++){const a=2*i+t;r+=`\n          localCoords = coords;\n          if(localCoords[2] + ${t} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {\n          localCoords[2] += ${t};\n          if (localCoords[1] + ${i} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {\n            localCoords[1] += ${i};\n\n            flatIndex = getFlatIndex(localCoords);\n            offset = imod(flatIndex, 4);\n\n            flatIndex = idiv(flatIndex, 4, 1.);\n\n            int r = flatIndex / texShape[1];\n            int c = imod(flatIndex, texShape[1]);\n            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n            values = ${n.texture2D}(A, uv);\n\n            if (offset == 0) {\n              result[${a}] = values[0];\n            } else if (offset == 1) {\n              result[${a}] = values[1];\n            } else if (offset == 2) {\n              result[${a}] = values[2];\n            } else {\n              result[${a}] = values[3];\n            }\n          }\n        }\n        `}this.userCode=`\n        ${this.enableShapeUniforms?getFlatIndexFrom3DOutput():getFlatIndexFrom3D(e)}\n\n        void main() {\n          ivec3 coords = getOutputCoords();\n\n          vec4 result = vec4(0.);\n          int flatIndex, r, c, offset;\n          ivec3 localCoords;\n          vec2 uv;\n          vec4 values;\n\n          ${r}\n\n          ${n.output} = ${a};\n        }\n    `}}
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function createVertexShader(e){const t=getGlslDifferences();return createVertexShader$1(e,`${t.version}\n    precision highp float;\n    ${t.attribute} vec3 clipSpacePos;\n    ${t.attribute} vec2 uv;\n    ${t.varyingVs} vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }`)}function createVertexBuffer(e){return createStaticVertexBuffer(e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function createIndexBuffer(e){return createStaticIndexBuffer(e,new Uint16Array([0,1,2,2,1,3]))}function createAndConfigureTexture(e,t,n,r,a,i){validateTextureSize(t,n);const s=createTexture(e),o=e.TEXTURE_2D;return callAndCheck(e,(()=>e.bindTexture(o,s))),callAndCheck(e,(()=>e.texParameteri(o,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE))),callAndCheck(e,(()=>e.texParameteri(o,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE))),callAndCheck(e,(()=>e.texParameteri(o,e.TEXTURE_MIN_FILTER,e.NEAREST))),callAndCheck(e,(()=>e.texParameteri(o,e.TEXTURE_MAG_FILTER,e.NEAREST))),1===env().getNumber("WEBGL_VERSION")?callAndCheck(e,(()=>e.texImage2D(o,0,r,t,n,0,a,i,null))):callAndCheck(e,(()=>e.texStorage2D(o,1,r,t,n))),callAndCheck(e,(()=>e.bindTexture(e.TEXTURE_2D,null))),{texture:s,texShape:[n,t]}}function getInternalFormatForFloat32MatrixTexture(e){return e.internalFormatFloat}function createFloat32MatrixTexture(e,t,n,r){const[a,i]=getUnpackedMatrixTextureShapeWidthHeight(t,n);return createAndConfigureTexture(e,a,i,getInternalFormatForFloat32MatrixTexture(r),r.textureFormatFloat,e.FLOAT)}function getInternalFormatForFloat16MatrixTexture(e){return e.internalFormatHalfFloat}function createFloat16MatrixTexture(e,t,n,r){const[a,i]=getUnpackedMatrixTextureShapeWidthHeight(t,n);return createAndConfigureTexture(e,a,i,getInternalFormatForFloat16MatrixTexture(r),r.textureFormatFloat,r.textureTypeHalfFloat)}function getInternalFormatForUnsignedBytesMatrixTexture(e){return e.downloadTextureFormat}function createUnsignedBytesMatrixTexture(e,t,n,r){const[a,i]=getUnpackedMatrixTextureShapeWidthHeight(t,n);return createAndConfigureTexture(e,a,i,getInternalFormatForUnsignedBytesMatrixTexture(r),e.RGBA,e.UNSIGNED_BYTE)}function getInternalFormatForPackedMatrixTexture(e){return e.internalFormatPackedFloat}function createPackedMatrixTexture(e,t,n,r){const[a,i]=getPackedMatrixTextureShapeWidthHeight(t,n);return createAndConfigureTexture(e,a,i,getInternalFormatForPackedMatrixTexture(r),e.RGBA,e.FLOAT)}function getInternalFormatForFloat16PackedMatrixTexture(e){return e.internalFormatPackedHalfFloat}function createFloat16PackedMatrixTexture(e,t,n,r){const[a,i]=getPackedMatrixTextureShapeWidthHeight(t,n);return createAndConfigureTexture(e,a,i,getInternalFormatForFloat16PackedMatrixTexture(r),e.RGBA,r.textureTypeHalfFloat)}function bindVertexProgramAttributeStreams(e,t,n){callAndCheck(e,(()=>e.bindBuffer(e.ARRAY_BUFFER,n)));return bindVertexBufferToProgramAttribute(e,t,"clipSpacePos",n,3,20,0)&&bindVertexBufferToProgramAttribute(e,t,"uv",n,2,20,12)}function uploadDenseMatrixToTexture(e,t,n,r,a,i){let s,o,l;callAndCheck(e,(()=>e.bindTexture(e.TEXTURE_2D,t))),a instanceof Uint8Array?(s=new Uint8Array(n*r*4),o=e.UNSIGNED_BYTE,l=e.RGBA):(s=new Float32Array(n*r*4),o=e.FLOAT,l=i.internalFormatPackedFloat),s.set(a),2===env().getNumber("WEBGL_VERSION")?callAndCheck(e,(()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,n,r,e.RGBA,o,s))):callAndCheck(e,(()=>e.texImage2D(e.TEXTURE_2D,0,l,n,r,0,e.RGBA,o,s))),callAndCheck(e,(()=>e.bindTexture(e.TEXTURE_2D,null)))}function uploadPixelDataToTexture(e,t,n){callAndCheck(e,(()=>e.bindTexture(e.TEXTURE_2D,t))),n.data instanceof Uint8Array?2===env().getNumber("WEBGL_VERSION")?callAndCheck(e,(()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,n.width,n.height,e.RGBA,e.UNSIGNED_BYTE,n.data))):callAndCheck(e,(()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n.width,n.height,0,e.RGBA,e.UNSIGNED_BYTE,n.data))):2===env().getNumber("WEBGL_VERSION")?callAndCheck(e,(()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,n))):callAndCheck(e,(()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n))),callAndCheck(e,(()=>e.bindTexture(e.TEXTURE_2D,null)))}function createBufferFromOutputTexture(e,t,n,r){const a=e.createBuffer();callAndCheck(e,(()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,a)));const i=16*t*n;return callAndCheck(e,(()=>e.bufferData(e.PIXEL_PACK_BUFFER,i,e.STREAM_READ))),callAndCheck(e,(()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,0))),callAndCheck(e,(()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,null))),a}function downloadFloat32MatrixFromBuffer(e,t,n){const r=e,a=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,a),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),a}function downloadByteEncodedFloatMatrixFromOutputTexture(e,t,n,r){const[a,i]=getUnpackedMatrixTextureShapeWidthHeight(t,n),s=new Uint8Array(getUnpackedArraySizeFromMatrixSize(t*n,4));return callAndCheck(e,(()=>e.readPixels(0,0,a,i,r.downloadTextureFormat,e.UNSIGNED_BYTE,s))),new Float32Array(s.buffer)}function downloadPackedMatrixFromBuffer(e,t,n,r,a,i,s,o){const l=e,u=new Float32Array(getPackedRGBAArraySizeFromMatrixShape(i,s));return l.bindBuffer(l.PIXEL_PACK_BUFFER,t),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,u),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),u}function downloadMatrixFromPackedOutputTexture(e,t,n){const r=new Float32Array(t*n*4);return callAndCheck(e,(()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,r))),r}
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class GPGPUContext{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const t=env().getNumber("WEBGL_VERSION");if(null!=e?(this.gl=e,setWebGLContext(t,e)):this.gl=getWebGLContext(t),e=this.gl,2===env().getNumber("WEBGL_VERSION")){const t=e;this.createVertexArray=()=>callAndCheck(t,(()=>t.createVertexArray())),this.bindVertexArray=e=>callAndCheck(t,(()=>t.bindVertexArray(e))),this.deleteVertexArray=e=>callAndCheck(t,(()=>t.deleteVertexArray(e))),this.getVertexArray=()=>callAndCheck(t,(()=>t.getParameter(t.VERTEX_ARRAY_BINDING)))}else if(null!=e){const t=e.getExtension("OES_vertex_array_object");if(null==t)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>callAndCheck(e,(()=>t.createVertexArrayOES())),this.bindVertexArray=n=>callAndCheck(e,(()=>t.bindVertexArrayOES(n))),this.deleteVertexArray=n=>callAndCheck(e,(()=>t.deleteVertexArrayOES(n))),this.getVertexArray=()=>callAndCheck(e,(()=>e.getParameter(t.VERTEX_ARRAY_BINDING_OES)))}let n="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),1===env().getNumber("WEBGL_VERSION")){const e="OES_texture_float",t="OES_texture_half_float";if(this.textureFloatExtension=getExtensionOrThrow(this.gl,e),hasExtension(this.gl,t))this.textureHalfFloatExtension=getExtensionOrThrow(this.gl,t);else if(env().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),hasExtension(this.gl,r))this.colorBufferHalfFloatExtension=getExtensionOrThrow(this.gl,r);else if(env().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",hasExtension(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!hasExtension(this.gl,r))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension(r)}this.vertexBuffer=createVertexBuffer(this.gl),this.indexBuffer=createIndexBuffer(this.gl),this.framebuffer=createFramebuffer(this.gl),this.textureConfig=getTextureConfig(this.gl,this.textureHalfFloatExtension)}get debug(){return env().getBool("DEBUG")}dispose(){if(this.disposed)return;null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;callAndCheck(e,(()=>e.finish())),callAndCheck(e,(()=>e.bindFramebuffer(e.FRAMEBUFFER,null))),callAndCheck(e,(()=>e.deleteFramebuffer(this.framebuffer))),callAndCheck(e,(()=>e.bindBuffer(e.ARRAY_BUFFER,null))),callAndCheck(e,(()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null))),callAndCheck(e,(()=>e.deleteBuffer(this.indexBuffer))),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),createFloat32MatrixTexture(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),createFloat16MatrixTexture(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),createUnsignedBytesMatrixTexture(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),uploadPixelDataToTexture(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,n,r){this.throwIfDisposed(),uploadDenseMatrixToTexture(this.gl,e,t,n,r,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),createFloat16PackedMatrixTexture(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),createPackedMatrixTexture(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(unbindColorTextureFromFramebuffer(this.gl,this.framebuffer),this.outputTexture=null),callAndCheck(this.gl,(()=>this.gl.deleteTexture(e)))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,n){return this.downloadMatrixDriver(e,(()=>downloadByteEncodedFloatMatrixFromOutputTexture(this.gl,t,n,this.textureConfig)))}downloadPackedMatrixFromBuffer(e,t,n,r,a,i){return downloadPackedMatrixFromBuffer(this.gl,e,t,n,r,a,i,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,t){return downloadFloat32MatrixFromBuffer(this.gl,e,t)}createBufferFromTexture(e,t,n){this.bindTextureToFrameBuffer(e);const r=createBufferFromOutputTexture(this.gl,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,n;if(env().getBool("WEBGL_FENCE_API_ENABLED")){const r=e,a=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=()=>{const e=r.clientWaitSync(a,0,0);return e===r.ALREADY_SIGNALED||e===r.CONDITION_SATISFIED},t=a}else env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=()=>this.isQueryAvailable(t,env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):n=()=>!0;return{query:t,isFencePassed:n}}downloadMatrixFromPackedTexture(e,t,n){return this.downloadMatrixDriver(e,(()=>downloadMatrixFromPackedOutputTexture(this.gl,t,n)))}createProgram(e){this.throwIfDisposed();const t=this.gl;null==this.vertexShader&&(this.vertexShader=createVertexShader(t));const n=createProgram(t);callAndCheck(t,(()=>t.attachShader(n,this.vertexShader))),callAndCheck(t,(()=>t.attachShader(n,e))),linkProgram(t,n);const r=Object.assign(n,{vao:this.createVertexArray()});return this.debug&&validateProgram(t,r),r}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const t=this.gl;callAndCheck(t,(()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer))),bindVertexProgramAttributeStreams(t,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&(callAndCheck(this.gl,(()=>this.gl.deleteProgram(e))),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&validateProgram(this.gl,this.program),callAndCheck(this.gl,(()=>this.gl.useProgram(e)))}getUniformLocation(e,t,n=!0){return this.throwIfDisposed(),n?getProgramUniformLocationOrThrow(this.gl,e,t):getProgramUniformLocation(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),callAndCheck(this.gl,(()=>this.gl.getAttribLocation(e,t)))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),bindTextureToProgramUniformSampler(this.gl,e,t,n)}setOutputMatrixTexture(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)}setOutputPackedMatrixTexture(e,t,n){this.throwIfDisposed();const[r,a]=getPackedMatrixTextureShapeWidthHeight(t,n);this.setOutputMatrixTextureDriver(e,r,a)}setOutputMatrixWriteRegion(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)}setOutputPackedMatrixWriteRegion(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){null!=this.program&&validateProgram(this.gl,this.program),validateFramebuffer(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const e=this.getVertexArray();console.assert(e===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}callAndCheck(e,(()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),callAndCheck(this.gl,(()=>this.gl.finish()))}getQueryTimerExtension(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=getExtensionOrThrow(this.gl,2===env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(2===env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}const e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(2===env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const e=this.gl,t=this.getQueryTimerExtensionWebGL2();return void e.endQuery(t.TIME_ELAPSED_EXT)}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await repeatedTry((()=>this.disposed||this.isQueryAvailable(e,env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")))),this.getQueryTime(e,env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(0===t)return null;if(2===t){const t=this.gl;return t.getQueryParameter(e,t.QUERY_RESULT)/1e6}{const t=this.getQueryTimerExtensionWebGL1();return t.getQueryObjectEXT(e,t.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(0===t)return!0;if(2===t){const t=this.gl,n=this.getQueryTimerExtensionWebGL2(),r=t.getQueryParameter(e,t.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(n.GPU_DISJOINT_EXT)),r&&!this.disjoint}{const t=this.getQueryTimerExtensionWebGL1(),n=t.getQueryObjectEXT(e,t.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(t.GPU_DISJOINT_EXT)),n&&!this.disjoint}}pollFence(e){return new Promise((t=>{this.addItemToPoll((()=>e.isFencePassed()),(()=>t()))}))}pollItems(){const e=linearSearchLastTrue(this.itemsToPoll.map((e=>e.isDoneFn)));for(let t=0;t<=e;++t){const{resolveFn:e}=this.itemsToPoll[t];e()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1)return;let n;"setTimeoutCustom"in env().platform&&(n=env().platform.setTimeoutCustom.bind(env().platform)),repeatedTry((()=>(this.pollItems(),0===this.itemsToPoll.length)),(()=>0),null,n)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),bindColorTextureToFramebuffer(this.gl,e,this.framebuffer),this.debug&&validateFramebuffer(this.gl)}unbindTextureToFrameBuffer(){null!=this.outputTexture?(bindColorTextureToFramebuffer(this.gl,this.outputTexture,this.framebuffer),this.debug&&validateFramebuffer(this.gl)):unbindColorTextureFromFramebuffer(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);const n=t();return this.unbindTextureToFrameBuffer(),n}setOutputMatrixTextureDriver(e,t,n){this.throwIfDisposed();const r=this.gl;bindColorTextureToFramebuffer(r,e,this.framebuffer),this.debug&&validateFramebuffer(r),this.outputTexture=e,callAndCheck(r,(()=>r.viewport(0,0,t,n))),callAndCheck(r,(()=>r.scissor(0,0,t,n)))}setOutputMatrixWriteRegionDriver(e,t,n,r){this.throwIfDisposed(),callAndCheck(this.gl,(()=>this.gl.scissor(e,t,n,r)))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(null==this.program)throw new Error("No GPU program is currently set.")}}function linearSearchLastTrue(e){let t=0;for(;t<e.length;++t){if(!e[t]())break}return t-1}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const{addImpl:addImplCPU,bincountImpl:bincountImplCPU,bincountReduceImpl:bincountReduceImplCPU,bitwiseAndImpl:bitwiseAndImplCPU,castImpl:castImplCPU,ceilImpl:ceilImplCPU,concatImpl:concatImplCPU,equalImpl:equalImplCPU,expImpl:expImplCPU,expm1Impl:expm1ImplCPU,floorImpl:floorImplCPU,gatherNdImpl:gatherNdImplCPU,gatherV2Impl:gatherV2ImplCPU,greaterImpl:greaterImplCPU,greaterEqualImpl:greaterEqualImplCPU,lessImpl:lessImplCPU,lessEqualImpl:lessEqualImplCPU,linSpaceImpl:linSpaceImplCPU,logImpl:logImplCPU,maxImpl:maxImplCPU,maximumImpl:maximumImplCPU,minimumImpl:minimumImplCPU,multiplyImpl:multiplyImplCPU,negImpl:negImplCPU,notEqualImpl:notEqualImplCPU,prodImpl:prodImplCPU,raggedGatherImpl:raggedGatherImplCPU,raggedRangeImpl:raggedRangeImplCPU,raggedTensorToTensorImpl:raggedTensorToTensorImplCPU,rangeImpl:rangeImplCPU,rsqrtImpl:rsqrtImplCPU,scatterImpl:scatterImplCPU,sigmoidImpl:sigmoidImplCPU,simpleAbsImpl:simpleAbsImplCPU,sliceImpl:sliceImplCPU,sparseFillEmptyRowsImpl:sparseFillEmptyRowsImplCPU,sparseReshapeImpl:sparseReshapeImplCPU,sparseSegmentReductionImpl:sparseSegmentReductionImplCPU,sqrtImpl:sqrtImplCPU,staticRegexReplaceImpl:staticRegexReplaceImplCPU,stridedSliceImpl:stridedSliceImplCPU,stringNGramsImpl:stringNGramsImplCPU,stringSplitImpl:stringSplitImplCPU,stringToHashBucketFastImpl:stringToHashBucketFastImplCPU,subImpl:subImplCPU,tileImpl:tileImplCPU,topKImpl:topKImplCPU,transposeImpl:transposeImplCPU,uniqueImpl:uniqueImplCPU}=shared;
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function getVecChannels(e,t){return["x","y","z","w","u","v"].slice(0,t).map((t=>`${e}.${t}`))}function getChannels(e,t){return 1===t?[e]:getVecChannels(e,t)}function getSourceCoords$2(e,t){if(1===e)return"rc";let n="";for(let r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class PackProgram{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=useShapeUniforms(this.outputShape.length),0===this.rank)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{const e=getChannels("rc",this.rank),t=getCoordsDataType(this.rank),n=this.getOutOfBoundsCondition(e),r=this.getSetup(e),a=this.getOutput(e);this.userCode=`\n        void main() {\n          ${t} rc = getOutputCoords();\n\n          if(${n}) {\n            setOutput(vec4(0));\n          } else {\n            ${r}\n\n            setOutput(vec4(${a}));\n          }\n        }\n      `}}getSourceCoordsArr(e){const t=[];for(let n=0;n<=1;n++)for(let r=0;r<=1;r++){let a=`${0===n?"r":"rp1"}, ${0===r?"c":"cp1"}`;for(let t=2;t<this.rank;t++)a=`${e[e.length-1-t]},`+a;t.push(a)}return t}getOutOfBoundsCondition(e){if(1===this.rank)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let t="";for(let n=this.rank-2;n<this.rank;n++)t+=`${e[n]} >= ${this.enableShapeUniforms?`outShape[${n}]`:this.outputShape[n]}`,n<this.rank-1&&(t+="||");return t}getSetup(e){if(1===this.rank)return"";const t=e.slice(-2),n=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`\n      int r = ${t[0]};\n      int c = ${t[1]};\n      int rp1 = r + 1;\n      int cp1 = c + 1;\n\n      bool cEdge = cp1 >= ${n};\n      bool rEdge = rp1 >= ${r};\n    `}getOutput(e){const t=this.getSourceCoordsArr(e);if(1===this.rank){return`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`}return`getA(${t[0]}),\n            cEdge ? 0. : getA(${t[1]}),\n            rEdge ? 0. : getA(${t[2]}),\n            rEdge || cEdge ? 0. : getA(${t[3]})`}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class ReshapePackedProgram{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=useShapeUniforms(this.outputShape.length);let n="";for(let r=0;r<4;r++){let e="thisRC = rc;";r%2==1&&(e+="thisRC.z += 1;"),r>1&&(e+="thisRC.y += 1;"),n+=`\n        ${e}\n        ${r>0?"if(thisRC.y < rows && thisRC.z < cols){":""}\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[${r}] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        ${r>0?"}":""}\n      `}this.userCode=`\n      ${getReshapedInputCoords(t,this.enableShapeUniforms)}\n      ${this.enableShapeUniforms?getFlatIndexFrom3DOutput():getFlatIndexFrom3D(e)}\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};\n        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};\n\n        ${n}\n\n        setOutput(result);\n      }\n    `}}function getReshapedInputCoords(e,t){return`\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ${t?getLogicalCoordinatesFromFlatIndexByUniform(["r","c","d"],"inputShape"):getLogicalCoordinatesFromFlatIndex(["r","c","d"],e)}\n      return ivec3(r, c, d);\n    }\n  `}
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class TextureManager{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,t,n){const r=getPhysicalFromLogicalTextureType(t,n),a=getKeyFromTextureShape(e,r,n);a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]);const i=computeBytes(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=i,this.log();const e=this.freeTextures[a].pop();return this.usedTextures[a].push(e),e}let s;return r===PhysicalTextureType.PACKED_2X2_FLOAT32?s=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===PhysicalTextureType.PACKED_2X2_FLOAT16?s=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===PhysicalTextureType.UNPACKED_FLOAT32?s=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===PhysicalTextureType.UNPACKED_FLOAT16?s=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===PhysicalTextureType.PACKED_4X1_UNSIGNED_BYTE&&(s=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(s),this.numUsedTextures++,this._numBytesAllocated+=i,this.log(),s}releaseTexture(e,t,n,r){if(null==this.freeTextures)return;const a=getPhysicalFromLogicalTextureType(n,r),i=getKeyFromTextureShape(t,a,r);i in this.freeTextures||(this.freeTextures[i]=[]);const s=computeBytes(t,a,this.gpgpu.gl,this.gpgpu.textureConfig,r),o=env().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");-1!==o&&this._numBytesAllocated>o?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=s):(this.freeTextures[i].push(e),this.numFreeTextures++,this._numBytesFree+=s),this.numUsedTextures--;const l=this.usedTextures[i],u=l&&l.indexOf(e);if(null==u||u<0)throw new Error("Cannot release a texture that was never provided by this texture manager");l[u]=l[l.length-1],l.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const t=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*t)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(null!=this.freeTextures){for(const e in this.freeTextures)this.freeTextures[e].forEach((e=>{this.gpgpu.deleteMatrixTexture(e.texture)}));for(const e in this.usedTextures)this.usedTextures[e].forEach((e=>{this.gpgpu.deleteMatrixTexture(e.texture)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function numBytesForInternalFormat(e,t){const n=e;if(t===n.R32F)return 4;if(t===n.R16F)return 2;if(t===n.RGBA32F)return 16;if(t===e.RGBA)return 16;if(t===n.RGBA16F)return 8;if(t===n.RGBA8)return 4;throw new Error(`Unknown internal format ${t}`)}function computeBytes(e,t,n,r,a){const i=internalFormatForPhysicalTexType(t,r);let s;if(a){const[t,n]=getPackedMatrixTextureShapeWidthHeight(e[0],e[1]);s=t*n}else{const[t,n]=getUnpackedMatrixTextureShapeWidthHeight(e[0],e[1]);s=t*n}return s*numBytesForInternalFormat(n,i)}function internalFormatForPhysicalTexType(e,t){switch(e){case PhysicalTextureType.PACKED_2X2_FLOAT32:return getInternalFormatForPackedMatrixTexture(t);case PhysicalTextureType.PACKED_2X2_FLOAT16:return getInternalFormatForFloat16PackedMatrixTexture(t);case PhysicalTextureType.UNPACKED_FLOAT32:return getInternalFormatForFloat32MatrixTexture(t);case PhysicalTextureType.UNPACKED_FLOAT16:return getInternalFormatForFloat16MatrixTexture(t);case PhysicalTextureType.PACKED_4X1_UNSIGNED_BYTE:return getInternalFormatForUnsignedBytesMatrixTexture(t);default:throw new Error(`Unknown physical texture type ${e}`)}}function getPhysicalTextureForRendering(e){return env().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?PhysicalTextureType.PACKED_2X2_FLOAT32:PhysicalTextureType.UNPACKED_FLOAT32:e?PhysicalTextureType.PACKED_2X2_FLOAT16:PhysicalTextureType.UNPACKED_FLOAT16}function getPhysicalFromLogicalTextureType(e,t){if(e===TextureUsage.UPLOAD)return PhysicalTextureType.PACKED_2X2_FLOAT32;if(e===TextureUsage.RENDER||null==e)return getPhysicalTextureForRendering(t);if(e===TextureUsage.DOWNLOAD||e===TextureUsage.PIXELS)return PhysicalTextureType.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${e}`)}function getKeyFromTextureShape(e,t,n){return`${e[0]}_${e[1]}_${t}_${n}`}
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class UnaryOpProgram{constructor(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=useShapeUniforms(this.outputShape.length),this.userCode=`\n      float unaryOperation(float x) {\n        ${t}\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    `}}const CHECK_NAN_SNIPPET$1="if (isnan(x)) return x;",LINEAR$1="return x;",ABS$1="return abs(x);",ELU$2="return (x >= 0.0) ? x : (exp(x) - 1.0);",RELU$2=CHECK_NAN_SNIPPET$1+"\n  return (x < 0.0) ? 0.0 : x;\n",RELU6$2=CHECK_NAN_SNIPPET$1+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",CLONE="return x;",SIGMOID$2="return 1.0 / (1.0 + exp(-1.0 * x));",LINEAR="return x;",ELU$1="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",RELU$1="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",RELU6$1="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",SIGMOID$1="return 1.0 / (1.0 + exp(-1.0 * x));";class UnaryOpPackedProgram{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=useShapeUniforms(this.outputShape.length),this.userCode=`\n      vec4 unaryOperation(vec4 x) {\n        ${t}\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    `}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class UnpackProgram{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=useShapeUniforms(this.outputShape.length);const t=e.length,n=getChannels("rc",t),r=getCoordsDataType(t),a=getSourceCoords$2(t,n),i=n.slice(-2),s=t<=1?"rc":`vec2(${i.join(",")})`;this.userCode=`\n      void main() {\n        ${r} rc = getOutputCoords();\n        vec4 packedInput = getA(${a});\n\n        setOutput(getChannel(packedInput, ${s}));\n      }\n    `}}
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const whereImpl=whereImpl$2,EPSILON_FLOAT32=1e-7,EPSILON_FLOAT16=1e-4,binaryCaches={};function getBinaryCache(e){return e in binaryCaches||(binaryCaches[e]={}),binaryCaches[e]}const CPU_HANDOFF_SIZE_THRESHOLD=env().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),BEFORE_PAGING_CONSTANT=600;function numMBBeforeWarning(){return null==env().global.screen?1024:env().global.screen.height*env().global.screen.width*window.devicePixelRatio*BEFORE_PAGING_CONSTANT/1024/1024}class MathBackendWebGL extends KernelBackend{nextDataId(){return MathBackendWebGL.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!env().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let t;if(null!=e){if(e instanceof GPGPUContext)t=e;else{const n=getWebGLContext(env().getNumber("WEBGL_VERSION"),e);t=new GPGPUContext(n)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const e=getWebGLContext(env().getNumber("WEBGL_VERSION"));t=new GPGPUContext(e),this.binaryCache=getBinaryCache(env().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=t,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new TextureManager(this.gpgpu),this.numMBBeforeWarning=numMBBeforeWarning(),this.texData=new DataStorage(this,engine())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,t,n,r,a,i){const s=this.makeTensorInfo(t,n),o=this.texData.get(s.dataId);o.isPacked=!1,o.texture={texture:e,texShape:[r,a]},o.texShape=[r,a];const l=getShapeAs3D(t),u=new EncodeMatrixProgram(l,!1,i),c=this.runWebGLProgram(u,[s],n,[[r,a]]);return c.shape=t,o.texture=null,this.disposeIntermediateTensorInfo(s),c.dataId}write(e,t,n){if((env().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||env().getBool("DEBUG"))&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:TextureUsage.UPLOAD,refCount:1}),r}refCount(e){if(this.texData.has(e)){return this.texData.get(e).refCount}return 0}incRef(e){this.texData.get(e).refCount++}decRef(e){if(this.texData.has(e)){this.texData.get(e).refCount--}}move(e,t,n,r,a){if(env().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:TextureUsage.UPLOAD,refCount:a})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const t=this.texData.get(e),{values:n,dtype:r,complexTensorInfos:a,slice:i,shape:s,isPacked:o}=t;if(null!=i){let t;t=o?new UnaryOpPackedProgram(s,CLONE):new UnaryOpProgram(s,CLONE);const n=this.runWebGLProgram(t,[{dataId:e,shape:s,dtype:r}],r),a=this.readSync(n.dataId);return this.disposeIntermediateTensorInfo(n),a}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;const l=null!=this.activeTimers;let u,c;if(l&&(u=now()),"complex64"===r){c=mergeRealAndImagArrays(this.readSync(a.real.dataId),this.readSync(a.imag.dataId))}else c=this.getValuesFromTexture(e);return l&&(this.downloadWaitMs+=now()-u),this.convertAndCacheOnCPU(e,c)}async read(e){if(this.pendingRead.has(e)){const t=this.pendingRead.get(e);return new Promise((e=>t.push(e)))}const t=this.texData.get(e),{values:n,shape:r,slice:a,dtype:i,complexTensorInfos:s,isPacked:o}=t;if(null!=a){let t;t=o?new UnaryOpPackedProgram(r,CLONE):new UnaryOpProgram(r,CLONE);const n=this.runWebGLProgram(t,[{dataId:e,shape:r,dtype:i}],i),a=this.read(n.dataId);return this.disposeIntermediateTensorInfo(n),a}if(null!=n)return this.convertAndCacheOnCPU(e);if(env().getBool("DEBUG")&&!env().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===env().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let l,u,c=null;if("complex64"!==i&&env().get("WEBGL_BUFFER_SUPPORTED")){l=this.decode(e);const t=this.texData.get(l.dataId);c=this.gpgpu.createBufferFromTexture(t.texture.texture,...getDenseTexShape(r))}if(this.pendingRead.set(e,[]),"complex64"!==i&&await this.gpgpu.createAndWaitForFence(),"complex64"===i){const e=await Promise.all([this.read(s.real.dataId),this.read(s.imag.dataId)]);u=mergeRealAndImagArrays(e[0],e[1])}else if(null==c)u=this.getValuesFromTexture(e);else{const e=sizeFromShape(r);u=this.gpgpu.downloadFloat32MatrixFromBuffer(c,e)}if(null!=l&&this.disposeIntermediateTensorInfo(l),null!=c){const e=this.gpgpu.gl;callAndCheck(e,(()=>e.deleteBuffer(c)))}const h=this.convertAndCacheOnCPU(e,u),d=this.pendingRead.get(e);return this.pendingRead.delete(e),d.forEach((e=>e(h))),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&engine().removeDataId(e,this),this.pendingDeletes--),h}readToGPU(e,t={}){const n=this.texData.get(e),{values:r,shape:a,slice:i,dtype:s,isPacked:o,texture:l}=n;if("complex64"===s)throw new Error("Does not support reading texture for complex64 dtype.");if(null!=i){let n;n=o?new UnaryOpPackedProgram(a,CLONE):new UnaryOpProgram(a,CLONE);const r=this.runWebGLProgram(n,[{dataId:e,shape:a,dtype:s}],s),i=this.readToGPU(r,t);return this.disposeIntermediateTensorInfo(r),i}if(null==l)throw null!=r?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const u=this.decode(e,t.customTexShape),c=engine().makeTensorFromTensorInfo(u),h=this.texData.get(u.dataId);return Object.assign({tensorRef:c},h.texture)}bufferSync(e){const t=this.readSync(e.dataId);if("string"===e.dtype)try{const n=t.map((e=>decodeString(e)));return buffer(e.shape,e.dtype,n)}catch(n){throw new Error("Failed to decode encoded string bytes into utf-8")}return buffer(e.shape,e.dtype,t)}checkNumericalProblems(e){if(null!=e)for(let t=0;t<e.length;t++){const n=e[t];if(!canBeRepresented(n)){if(env().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error(`The value ${n} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`);throw Error(`The value ${n} cannot be represented on this device.`)}}}getValuesFromTexture(e){const{shape:t,dtype:n,isPacked:r}=this.texData.get(e),a=sizeFromShape(t);if(env().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const n=this.decode(e),r=this.texData.get(n.dataId),i=this.gpgpu.downloadMatrixFromPackedTexture(r.texture.texture,...getDenseTexShape(t)).subarray(0,a);return this.disposeIntermediateTensorInfo(n),i}const i=env().getBool("WEBGL_PACK")&&!0===r,s=i?getShapeAs3D(t):t,o=i?new EncodeFloatPackedProgram(s):new EncodeFloatProgram(s),l=this.runWebGLProgram(o,[{shape:s,dtype:n,dataId:e}],"float32"),u=this.texData.get(l.dataId),c=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(u.texture.texture,u.texShape[0],u.texShape[1]).subarray(0,a);return this.disposeIntermediateTensorInfo(l),c}timerAvailable(){return env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const t=this.activeTimers,n=[];let r=!1;null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,e();const a=flatten$2(this.activeTimers.map((e=>e.query))).filter((e=>null!=e)),i=flatten$2(this.activeTimers.map((e=>e.name))).filter((e=>null!=e));this.activeTimers=t,r&&(this.programTimersStack=null);const s={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const e=await Promise.all(a);s.kernelMs=sum$3(e),s.getExtraProfileInfo=()=>e.map(((e,t)=>({name:i[t],ms:e}))).map((e=>`${e.name}: ${e.ms}`)).join(", ")}else s.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,s})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:now(),endMs:null}}endTimer(e){return env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=now(),e)}async getQueryTime(e){if(env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const t=e;return t.endMs-t.startMs}disposeData(e,t=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:n}=this.texData.get(e);return null!=n&&(this.disposeData(n.real.dataId,t),this.disposeData(n.imag.dataId,t)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:t,dtype:n,texShape:r,usage:a,isPacked:i,slice:s}=this.texData.get(e),o=s&&s.origDataId||e,l=this.dataRefCount.get(o);l>1?this.dataRefCount.set(o,l-1):(this.dataRefCount.delete(o),null!=t&&(this.numBytesInGPU-=this.computeBytes(r,n),this.textureManager.releaseTexture(t,r,a,i)));const u=this.texData.get(e);u.texture=null,u.texShape=null,u.isPacked=!1,u.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,t=CPU_HANDOFF_SIZE_THRESHOLD){return env().getBool("WEBGL_CPU_FORWARD")&&e.every((e=>null==this.texData.get(e.dataId).texture&&sizeFromShape(e.shape)<t))}getGPGPUContext(){return this.gpgpu}where(e){warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const t=e.dataSync();return whereImpl(e.shape,t)}packedUnaryOp(e,t,n){const r=new UnaryOpPackedProgram(e.shape,t),a=this.compileAndRun(r,[e],n);return engine().makeTensorFromTensorInfo(a)}abs(e){if(this.shouldExecuteOnCPU([e])&&"complex64"!==e.dtype){const t=simpleAbsImplCPU(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,t)}if(env().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,ABS$1,e.dtype);const t=new UnaryOpProgram(e.shape,ABS$1),n=this.compileAndRun(t,[e]);return engine().makeTensorFromTensorInfo(n)}makeTensorInfo(e,t,n){let r;if("string"===t&&null!=n&&n.length>0&&isString(n[0])){const a=n.map((e=>encodeString(e)));r=this.write(a,e,t)}else r=this.write(n,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}makeOutput(e,t,n){return engine().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,n),this)}unpackTensor(e){const t=new UnpackProgram(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}packTensor(e){const t=new PackProgram(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}packedReshape(e,t){const n=[getBatchDim(e.shape),...getRowsCols(e.shape)],r={dtype:e.dtype,shape:n,dataId:e.dataId},a=[getBatchDim(t),...getRowsCols(t)],i=new ReshapePackedProgram(a,n),s=[n],o=this.runWebGLProgram(i,[r],e.dtype,s,!0);return{dataId:o.dataId,shape:t,dtype:o.dtype}}decode(e,t){const n=this.texData.get(e),{isPacked:r,shape:a,dtype:i}=n;if(null!=t){assert$1(sizeFromShape(a)<=t[0]*t[1]*4,(()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data."))}const s=getShapeAs3D(a);let o;o=r?new DecodeMatrixPackedProgram(s):new DecodeMatrixProgram(s);const l=[null!=t?t:getDenseTexShape(s)];return{dtype:i,shape:a,dataId:this.runWebGLProgram(o,[{shape:s,dtype:i,dataId:e}],i,l,!0,t).dataId}}runWebGLProgram(e,t,n,r,a=!1,i){const s=this.makeTensorInfo(e.outputShape,n),o=this.texData.get(s.dataId);if(e.packedOutput&&(o.isPacked=!0),e.outPackingScheme===PackingScheme.DENSE){const t=null!=i?i:getDenseTexShape(e.outputShape);o.texShape=t.map((e=>2*e))}if(null!=e.outTexUsage&&(o.usage=e.outTexUsage),0===sizeFromShape(s.shape))return o.values=getTypedArrayFromDType(s.dtype,0),s;const l=[],u=t.map((t=>{if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let n=this.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&sizeFromShape(t.shape)<=env().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}if(this.uploadToGPU(t.dataId),!!n.isPacked!=!!e.packedInputs)t=n.isPacked?this.unpackTensor(t):this.packTensor(t),l.push(t),n=this.texData.get(t.dataId);else if(n.isPacked&&!isReshapeFree(n.shape,t.shape)){const e=t,r=t.shape;t.shape=n.shape,t=this.packedReshape(t,r),l.push(t),n=this.texData.get(t.dataId),e.shape=r}return{shape:t.shape,texData:n,isUniform:!1}}));this.uploadToGPU(s.dataId);const c={shape:s.shape,texData:o,isUniform:!1},h=makeShaderKey(e,u,c),d=this.getAndSaveBinary(h,(()=>compileProgram(this.gpgpu,e,u,c))),p=null!=this.activeTimers;let f;p&&(f=this.startTimer()),env().get("ENGINE_COMPILE_ONLY")||runProgram(this.gpgpu,d,u,c,r),l.forEach((e=>this.disposeIntermediateTensorInfo(e))),p&&(f=this.endTimer(f),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(f)}));const m=env().getNumber("WEBGL_FLUSH_THRESHOLD");if(m>0){const e=now();e-this.lastGlFlushTime>m&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=e)}if(!env().getBool("WEBGL_LAZILY_UNPACK")&&o.isPacked&&!1===a){const e=this.unpackTensor(s);return this.disposeIntermediateTensorInfo(s),e}return s}compileAndRun(e,t,n,r,a=!1){n=n||t[0].dtype;return this.runWebGLProgram(e,t,n,r,a)}getAndSaveBinary(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){if(!this.disposed){if(!env().getBool("IS_TEST")){Object.keys(this.binaryCache).forEach((e=>{this.gpgpu.deleteProgram(this.binaryCache[e].webGLProgram),delete this.binaryCache[e]}))}this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0}}floatPrecision(){return null==this.floatPrecisionValue&&(this.floatPrecisionValue=tidy((()=>{if(!env().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=env().getBool("DEBUG");env().set("DEBUG",!1);const t=this.abs(scalar(1e-8)).dataSync()[0];if(env().set("DEBUG",e),t>0)return 32}return 16}))),this.floatPrecisionValue}epsilon(){return 32===this.floatPrecision()?EPSILON_FLOAT32:EPSILON_FLOAT16}uploadToGPU(e){const t=this.texData.get(e),{shape:n,dtype:r,values:a,texture:i,usage:s,isPacked:o}=t;if(null!=i)return;const l=null!=this.activeTimers;let u;l&&(u=now());let c=t.texShape;if(null==c&&(c=getTextureShapeFromLogicalShape(n,o),t.texShape=c),null!=a){const e=getShapeAs3D(n);let i,s=c[1],h=c[0];const d=a instanceof Uint8Array||a instanceof Uint8ClampedArray;!o&&d||([s,h]=getPackedMatrixTextureShapeWidthHeight(c[0],c[1])),i=o?new EncodeMatrixPackedProgram(e,d):new EncodeMatrixProgram(e,d);const p=d?[h,s]:c,f=this.makeTensorInfo(p,r),m=this.texData.get(f.dataId);m.usage=d?TextureUsage.PIXELS:TextureUsage.UPLOAD,m.texShape=p,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(f.dataId),s,h,a);const g=[[h,s]],y=!0,v=this.runWebGLProgram(i,[f],r,g,y),b=this.texData.get(v.dataId);t.texShape=b.texShape,t.isPacked=b.isPacked,t.usage=b.usage,env().get("ENGINE_COMPILE_ONLY")?this.disposeData(v.dataId):(t.texture=b.texture,t.values=null,this.texData.delete(v.dataId)),this.disposeIntermediateTensorInfo(f),l&&(this.uploadWaitMs+=now()-u)}else{const e=this.acquireTexture(c,s,r,o);t.texture=e}}convertAndCacheOnCPU(e,t){const n=this.texData.get(e),{dtype:r}=n;return null!=t&&(n.values=float32ToTypedArray(t,r)),n.values}acquireTexture(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){const e=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${e} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,t,r)}computeBytes(e,t){return e[0]*e[1]*bytesPerElement(t)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,t]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(t));return Promise.all(e)}for(const[,t]of Object.entries(this.binaryCache)){const n=new Promise((e=>{try{this.checkCompletion_(t),e(!0)}catch(n){throw n}}));e.push(n)}return Promise.all(e)}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await nextFrame(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(!1===this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)){if(console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),!1===this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS))throw logShaderSourceAndInfoLog(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.");throw new Error("Failed to link vertex and fragment shaders.")}return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:t,customUniformLocations:n,infLoc:r,nanLoc:a,outShapeLocation:i,outShapeStridesLocation:s,outTexShapeLocation:o}=getUniformLocations(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=t,e.customUniformLocations=n,e.infLoc=r,e.nanLoc=a,e.outShapeLocation=i,e.outShapeStridesLocation=s,e.outTexShapeLocation=o}}createTensorFromGPUData(e,t,n){e.channels=e.channels||"RGBA";const{texture:r,height:a,width:i,channels:s}=e,o=engine().backend;if(!o.gpgpu.gl.isTexture(r))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const l=o.writeTexture(r,t,n,a,i,s);return engine().makeTensorFromDataId(l,t,n,o)}}function float32ToTypedArray(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){const n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length);for(let t=0;t<n.length;++t)n[t]=Math.round(e[t]);return n}throw new Error(`Unknown dtype ${t}`)}
/**
     * @license
     * Copyright 2020 Google Inc. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */MathBackendWebGL.nextDataId=0,isBrowser()&&registerBackend("webgl",(()=>new MathBackendWebGL),2)
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */;const CHECK_NAN_SNIPPET="\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n";class BinaryOpProgram{constructor(e,t,n){this.variableNames=["A","B"],this.outputShape=assertAndGetBroadcastShape(t,n),this.enableShapeUniforms=useShapeUniforms(this.outputShape.length),this.userCode=`\n      float binaryOperation(float a, float b) {\n        ${e}\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    `}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const CHECK_NAN_SNIPPET_PACKED="\n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n";class BinaryOpPackedProgram{constructor(e,t,n,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=assertAndGetBroadcastShape(t,n);const a=this.outputShape.length;this.enableShapeUniforms=useShapeUniforms(a);let i="";if(r)if(0===a||1===sizeFromShape(this.outputShape))i="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else{if(i=`\n          ${getCoordsDataType(a)} coords = getOutputCoords();\n        `,1===a)this.enableShapeUniforms?i+="\n            result.y = (coords + 1) >= outShape ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ":i+=`\n            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          `;else{const e=getChannels("coords",a);this.enableShapeUniforms?i+=`\n            bool nextRowOutOfBounds =\n              (${e[a-2]} + 1) >= outShape[${a} - 2];\n            bool nextColOutOfBounds =\n              (${e[a-1]} + 1) >= outShape[${a} - 1];\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          `:i+=`\n            bool nextRowOutOfBounds =\n              (${e[a-2]} + 1) >= ${this.outputShape[a-2]};\n            bool nextColOutOfBounds =\n              (${e[a-1]} + 1) >= ${this.outputShape[a-1]};\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          `}}this.userCode=`\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ${e}\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ${i}\n\n        setOutput(result);\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function identity(e){const{inputs:t,backend:n}=e,{x:r}=t;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const identityConfig={kernelName:Identity$1,backendName:"webgl",kernelFunc:identity};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function complex(e){const{inputs:t,backend:n}=e,{real:r,imag:a}=t,i=n.makeTensorInfo(r.shape,"complex64"),s=n.texData.get(i.dataId),o=identity({inputs:{x:r},backend:n}),l=identity({inputs:{x:a},backend:n});return s.complexTensorInfos={real:o,imag:l},i}const complexConfig={kernelName:Complex,backendName:"webgl",kernelFunc:complex},LEAKYRELU="return (a < 0.) ? b * a : a;",LEAKYRELU_PACKED="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function leakyRelu(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{alpha:i}=r,s=n.makeTensorInfo([],"float32",createScalarValue(i,"float32")),o=env().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new BinaryOpPackedProgram(LEAKYRELU_PACKED,a.shape,s.shape):new BinaryOpProgram(LEAKYRELU,a.shape,s.shape),l=n.runWebGLProgram(o,[a,s],"float32");return n.disposeIntermediateTensorInfo(s),l}const leakyReluConfig={kernelName:LeakyRelu,backendName:"webgl",kernelFunc:leakyRelu},PRELU="return (a < 0.) ? b * a : a;",PRELU_PACKED="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function prelu(e){const{inputs:t,backend:n}=e,{x:r,alpha:a}=t,i=env().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new BinaryOpPackedProgram(PRELU_PACKED,r.shape,a.shape):new BinaryOpProgram(PRELU,r.shape,a.shape);return n.runWebGLProgram(i,[r,a],"float32")}const preluConfig={kernelName:Prelu,backendName:"webgl",kernelFunc:prelu},CHECK_NAN_SNIPPET_UNARY="if (isnan(x)) return x;";
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function unaryKernelFunc({opSnippet:e,packedOpSnippet:t,cpuKernelImpl:n,dtype:r}){return({inputs:a,backend:i})=>{const{x:s}=a,o=i,l=r||s.dtype;if(o.shouldExecuteOnCPU([s])&&null!=n){const e=o.texData.get(s.dataId),t=n(e.values,l);return o.makeTensorInfo(s.shape,l,t)}let u;return u=env().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&null!=t?new UnaryOpPackedProgram(s.shape,t):new UnaryOpProgram(s.shape,e),o.runWebGLProgram(u,[s],l)}}function binaryKernelFunc({opSnippet:e,packedOpSnippet:t,checkOutOfBounds:n=!1,supportsComplex:r=!1,cpuKernelImpl:a,dtype:i}){return({inputs:s,backend:o})=>{const{a:l,b:u}=s,c=o;if(r&&"complex64"===l.dtype){const t=c.texData.get(l.dataId),n=c.texData.get(u.dataId),[r,a]=[[t.complexTensorInfos.real,n.complexTensorInfos.real],[t.complexTensorInfos.imag,n.complexTensorInfos.imag]].map((t=>{const[n,r]=t,a={dataId:n.dataId,dtype:n.dtype,shape:l.shape},i={dataId:r.dataId,dtype:r.dtype,shape:u.shape},s=new BinaryOpProgram(e,l.shape,u.shape);return c.runWebGLProgram(s,[a,i],upcastType(n.dtype,r.dtype))})),i=complex({inputs:{real:r,imag:a},backend:c});return c.disposeIntermediateTensorInfo(r),c.disposeIntermediateTensorInfo(a),i}const h=i||upcastType(l.dtype,u.dtype);if(("string"===l.dtype||"string"===u.dtype||c.shouldExecuteOnCPU([l,u]))&&null!=a){const e=c.texData.get(l.dataId).values,t=c.texData.get(u.dataId).values,n="string"===l.dtype?fromUint8ToStringArray(e):e,r="string"===l.dtype?fromUint8ToStringArray(t):t,[i,s]=a(l.shape,u.shape,n,r,h),o=c.makeTensorInfo(s,h);return c.texData.get(o.dataId).values=i,o}let d;return d=env().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&null!=t?new BinaryOpPackedProgram(t,l.shape,u.shape,n):new BinaryOpProgram(e,l.shape,u.shape),c.runWebGLProgram(d,[l,u],h)}}function mapActivationToShaderProgram(e,t=!1){if("linear"===e)return t?LINEAR:LINEAR$1;if("relu"===e)return t?RELU$1:RELU$2;if("elu"===e)return t?ELU$1:ELU$2;if("relu6"===e)return t?RELU6$1:RELU6$2;if("prelu"===e)return t?PRELU_PACKED:PRELU;if("leakyrelu"===e)return t?LEAKYRELU_PACKED:LEAKYRELU;if("sigmoid"===e)return t?SIGMOID$1:SIGMOID$2;throw new Error(`Activation ${e} has not been implemented for the WebGL backend.`)}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class MatMulPackedProgram{constructor(e,t,n,r=!1,a=!1,i=!1,s=null,o=!1,l=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.enableShapeUniforms=useShapeUniforms(this.outputShape.length);const u=r?e[1]:e[2],c=Math.ceil(u/2),h=r?"i * 2, rc.y":"rc.y, i * 2",d=a?"rc.z, i * 2":"i * 2, rc.z",p=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],f=a?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let m="",g="";s&&(m=o?`vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ${s}\n        }`:l?`vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ${s}\n        }`:`vec4 activation(vec4 x) {\n          ${s}\n        }`,g="result = activation(result);");const y=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),l&&this.variableNames.push("leakyreluAlpha");let v="rc.x",b="rc.x";e[0]<t[0]?v=`imod(rc.x, ${e[0]})`:t[0]<e[0]&&(b=`imod(rc.x, ${t[0]})`),this.userCode=`\n      ${m}\n      // Don't use uniform for sharedDimensionPacked for performance.\n      const float sharedDimension = ${c}.0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        int batchA = ${v};\n        int batchB = ${b};\n        for (int i = 0; i < ${c}; i++) {\n          vec4 a = getMatrixA(batchA, ${h});\n          vec4 b = getMatrixB(batchB, ${d});\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += (${p[0]} * ${f[0]});\n          result += (${p[1]} * ${f[1]});\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        ${y}\n\n        ${g}\n\n        setOutput(result);\n      }\n    `}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const COMPLEX_MULTIPLY={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class BinaryOpComplexProgram{constructor(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=assertAndGetBroadcastShape(t,n),this.userCode=`\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ${e}\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const MUL="return a * b;";function multiply(e){const{inputs:t,backend:n}=e,{a:r,b:a}=t,i=upcastType(r.dtype,a.dtype);if("complex64"===r.dtype){const e=n.texData.get(r.dataId),t=n.texData.get(a.dataId),i=new BinaryOpComplexProgram(COMPLEX_MULTIPLY.REAL,r.shape,a.shape),s=new BinaryOpComplexProgram(COMPLEX_MULTIPLY.IMAG,r.shape,a.shape),o=[{dataId:e.complexTensorInfos.real.dataId,dtype:e.complexTensorInfos.real.dtype,shape:r.shape},{dataId:e.complexTensorInfos.imag.dataId,dtype:e.complexTensorInfos.imag.dtype,shape:r.shape},{dataId:t.complexTensorInfos.real.dataId,dtype:t.complexTensorInfos.real.dtype,shape:a.shape},{dataId:t.complexTensorInfos.imag.dataId,dtype:t.complexTensorInfos.imag.dtype,shape:a.shape}],l=n.runWebGLProgram(i,o,"float32"),u=n.runWebGLProgram(s,o,"float32"),c=complex({inputs:{real:l,imag:u},backend:n});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(u),c}if(n.shouldExecuteOnCPU([r,a])){const e=n.texData.get(r.dataId),t=n.texData.get(a.dataId),[s,o]=multiplyImplCPU(r.shape,a.shape,e.values,t.values,i),l=n.makeTensorInfo(o,i);return n.texData.get(l.dataId).values=s,l}let s;return s=env().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new BinaryOpPackedProgram(MUL,r.shape,a.shape):new BinaryOpProgram(MUL,r.shape,a.shape),n.runWebGLProgram(s,[r,a],i)}const multiplyConfig={kernelName:Multiply$1,backendName:"webgl",kernelFunc:multiply};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function packedReshape(e,t,n){const r=[getBatchDim(e.shape),...getRowsCols(e.shape)],a={dtype:e.dtype,shape:r,dataId:e.dataId},i=[getBatchDim(t),...getRowsCols(t)],s=new ReshapePackedProgram(i,r),o=[r],l=n.runWebGLProgram(s,[a],e.dtype,o,!0);return{dataId:l.dataId,shape:t,dtype:l.dtype}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function reshape(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{shape:i}=r,s=n,o=sizeFromShape(a.shape),l=inferFromImplicitShape(i,o),u=sizeFromShape(l);assert$1(o===u,(()=>`The new shape (${l}) has ${u} elements and the old shape (${a.shape}) has ${o} elements. The new shape and old shape must have the same number of elements.`));const c=s.texData.get(a.dataId);return!c.isPacked||isReshapeFree(a.shape,l)||null!==c.texture&&isReshapeFree(c.shape,l)?(s.incRef(a.dataId),{dataId:a.dataId,shape:l,dtype:a.dtype}):packedReshape(a,l,s)}const reshapeConfig={kernelName:Reshape$1,backendName:"webgl",kernelFunc:reshape};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class MeanProgram{constructor(e,t){this.variableNames=["x"];const{windowSize:n,batchSize:r,inSize:a,outSize:i}=e;this.outputShape=[r,i];const s=4*Math.floor(n/4),o=n%4;let l="sumValue += dot(values, ones);";if(null!=t){const e=1/t;l=`sumValue += dot(values * ${isInt(e)?e.toPrecision(2):e}, ones);`}let u="";a%n>0&&(u=`\n        if (inIdx < 0 || inIdx >= ${a}) {\n          return 0.0;\n        }\n      `),this.userCode=`\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ${u}\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${n};\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ${s}; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ${l}\n        }\n\n        int inIdx = inOffset + ${s};\n        if (${1===o}) {\n          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);\n\n          ${l}\n        } else if (${2===o}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1), 0.0, 0.0);\n\n          ${l}\n        } else if (${3===o}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2), 0.0);\n\n          ${l}\n        }\n        setOutput(sumValue);\n      }\n    `}}
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class ReduceProgram{constructor(e,t){this.variableNames=["x"];const{windowSize:n,batchSize:r,inSize:a,outSize:i}=e;this.outputShape=[r,i];let s="0.0",o="";"prod"===t?s="1.0":"min"===t?(s="1.0 / 1e-20",o="min"):"max"===t&&(s="-1.0 / 1e-20",o="max");let l=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"sum"===t?l="sumValue":"prod"===t?l="prodValue":"all"===t?l="allValue":"any"===t&&(l="anyValue");const u=4*Math.floor(n/4),c=n%4;let h=`\n      if (${"sum"===t}) {\n        sumValue += dot(values, ones);\n      } else if (${"prod"===t}) {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = ${o}(values, minMaxValue);\n        if (${"min"===t} || ${"max"===t}) {\n          minMaxValue = ${o}(values, minMaxValue);\n          bvec4 isNaN = isnan(values);\n          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {\n            minMaxValue = vec4(NAN);\n          }\n        }\n      }\n    `,d="vec4";"all"===t?(s="1.0",h="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",d="bvec4"):"any"===t&&(s="0.0",h="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",d="bvec4");let p="";a%n>0&&(p=`\n        if (inIdx < 0 || inIdx >= ${a}) {\n          return initializationValue;\n        }\n      `),this.userCode=`\n      const float initializationValue = ${s};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ${p}\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${n};\n\n        vec4 minMaxValue = vec4(${s});\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < ${u}; i += 4) {\n          int inIdx = inOffset + i;\n          ${d} values = ${d}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ${h}\n        }\n\n        int inIdx = inOffset + ${u};\n        if (${1===c}) {\n          ${d} values = ${d}(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          ${h}\n        } else if (${2===c}) {\n          ${d} values = ${d}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          ${h}\n        } else if (${3===c}) {\n          ${d} values = ${d}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          ${h}\n        }\n        setOutput(${l});\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function getReductionStages(e){const t=[];for(;0===t.length||1!==t[t.length-1].outSize;){const n=t.length?t[t.length-1].outSize:e[1],r=computeOptimalWindowSize(n);t.push({inSize:n,windowSize:r,outSize:Math.ceil(n/r)})}return t}function reduce$1(e,t,n,r){const a=getReductionStages(e.shape);let i=e;for(let s=0;s<a.length;s++){const{inSize:o,windowSize:l,outSize:u}=a[s];let c,h;c="mean"===n?0===s?new MeanProgram({windowSize:l,inSize:o,batchSize:e.shape[0],outSize:u},o):new MeanProgram({windowSize:l,inSize:o,batchSize:e.shape[0],outSize:u}):new ReduceProgram({windowSize:l,inSize:o,batchSize:e.shape[0],outSize:u},n),h=i,i=r.runWebGLProgram(c,[i],t),h.dataId!==e.dataId&&r.disposeIntermediateTensorInfo(h)}return i}
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class TransposeProgram{constructor(e,t){this.variableNames=["A"];const n=new Array(e.length);for(let i=0;i<n.length;i++)n[i]=e[t[i]];this.outputShape=n,this.rank=n.length;const r=getCoordsDataType(this.rank),a=getSwitchedCoords(t);this.userCode=`\n    void main() {\n      ${r} resRC = getOutputCoords();\n      setOutput(getA(${a}));\n    }\n    `}}function getSwitchedCoords(e){const t=e.length;if(t>6)throw Error(`Transpose for rank ${t} is not yet supported`);const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t);for(let a=0;a<e.length;a++)r[e[a]]=n[a];return r.join()}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class TransposePackedProgram{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const n=new Array(e.length);for(let u=0;u<n.length;u++)n[u]=e[t[u]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const r=getCoordsDataType(this.rank),a=getVecChannels("rc",this.rank),i=new Array(this.rank);for(let u=0;u<t.length;u++)i[t[u]]=a[u];const s=`vec2(${i.slice(-2).join()})`,o=`++${a[this.rank-1]} < ${n[this.rank-1]}`,l=`getChannel(getA(${i.join()}), ${s})`;this.userCode=`\n    void main() {\n      ${r} rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = ${l};\n      if(${o}) {\n        result[1] = ${l};\n      }\n      --${a[this.rank-1]};\n      if(++${a[this.rank-2]} < ${n[this.rank-2]}) {\n        result[2] = ${l};\n        if(${o}) {\n          result[3] = ${l};\n        }\n      }\n      setOutput(result);\n    }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function transposeImpl(e,t,n){const r=env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new TransposePackedProgram(e.shape,t):new TransposeProgram(e.shape,t);return n.runWebGLProgram(r,[e],e.dtype)}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function sumImpl(e,t,n,r){const a=t,i=e.shape.length,s=parseAxisParam(a,e.shape);let o=s;const l=getAxesPermutation(o,i),u=null!=l;let c=e;u&&(c=transposeImpl(e,l,r),o=getInnerMostAxes(o.length,i)),assertAxesAreInnerMostDims("sum",o,i);const[h,d]=computeOutAndReduceShapes(c.shape,o);let p=h;n&&(p=expandShapeToKeepDim(h,s));const f=sizeFromShape(d),m=reshape({inputs:{x:c},attrs:{shape:[sizeFromShape(e.shape)/f,f]},backend:r}),g=reduce$1(m,sumOutType(e.dtype),"sum",r),y=reshape({inputs:{x:g},attrs:{shape:p},backend:r});return r.disposeIntermediateTensorInfo(m),r.disposeIntermediateTensorInfo(g),u&&r.disposeIntermediateTensorInfo(c),y}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function sum(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:s}=r;return sumImpl(a,i,s,n)}const sumConfig={kernelName:Sum,backendName:"webgl",kernelFunc:sum};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function transpose(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{perm:i}=r,s=n,o=a.shape.length,l=new Array(o);for(let c=0;c<l.length;c++)l[c]=a.shape[i[c]];let u;if(s.shouldExecuteOnCPU([a])){const e=s.texData.get(a.dataId).values,t=transposeImplCPU(e,a.shape,a.dtype,i,l);u=s.makeTensorInfo(l,a.dtype);s.texData.get(u.dataId).values=t}else u=transposeImpl(a,i,s);return u}const transposeConfig={kernelName:Transpose,backendName:"webgl",kernelFunc:transpose},MATMUL_SHARED_DIM_THRESHOLD=1e3;
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function batchMatMulImpl({a:e,b:t,transposeA:n,transposeB:r,backend:a,bias:i=null,preluActivationWeights:s=null,leakyreluAlpha:o=0,activation:l=null}){const u=e.shape.length,c=t.shape.length,h=n?e.shape[u-2]:e.shape[u-1],d=r?t.shape[c-1]:t.shape[c-2],p=n?e.shape[u-1]:e.shape[u-2],f=r?t.shape[c-2]:t.shape[c-1],m=e.shape.slice(0,-2),g=t.shape.slice(0,-2),y=sizeFromShape(m),v=sizeFromShape(g),b=assertAndGetBroadcastShape(e.shape.slice(0,-2),t.shape.slice(0,-2)).concat([p,f]);assert$1(h===d,(()=>`Error in matMul: inner shapes (${h}) and (${d}) of Tensors with shapes ${e.shape} and ${t.shape} and transposeA=${n} and transposeB=${r} must match.`));const x=n?[y,h,p]:[y,p,h],T=r?[v,f,d]:[v,d,f],_=reshape({inputs:{x:e},backend:a,attrs:{shape:x}}),w=reshape({inputs:{x:t},backend:a,attrs:{shape:T}}),S=[_,w],C=Math.max(y,v),E=n?_.shape[1]:_.shape[2],k=null!=i,I=null!=s,A="leakyrelu"===l,N=null!=l?mapActivationToShaderProgram(l,!0):null;let $;if((1===p||1===f)&&E>MATMUL_SHARED_DIM_THRESHOLD&&!1===(k||I||A||null!=N)){let e=_,t=w;n&&(e=transpose({inputs:{x:_},backend:a,attrs:{perm:[0,2,1]}}),S.push(e)),r&&(t=transpose({inputs:{x:w},backend:a,attrs:{perm:[0,2,1]}}),S.push(t));const i=1===f;let s=e;1!==f&&(s=reshape({inputs:{x:e},backend:a,attrs:{shape:[C,E,1]}}),S.push(s));const o=1===f?2:1;let l=t;i&&(l=reshape({inputs:{x:t},backend:a,attrs:{shape:[C,1,E]}}),S.push(l));const u=multiply({inputs:{a:s,b:l},backend:a});$=sum({inputs:{x:u},backend:a,attrs:{axis:o,keepDims:!0}}),S.push(u)}else{const l=upcastType(e.dtype,t.dtype),u=new MatMulPackedProgram(x,T,[C,p,f],n,r,k,N,I,A),c=[_,w];if(null!=i&&c.push(i),I&&c.push(s),A){const e=a.makeTensorInfo([],"float32",createScalarValue(o,"float32"));c.push(e),S.push(e)}$=a.runWebGLProgram(u,c,l)}const D=reshape({inputs:{x:$},backend:a,attrs:{shape:b}});S.push($);for(const P of S)a.disposeIntermediateTensorInfo(P);return D}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the License);
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an AS IS BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function _fusedMatMul(e){const{inputs:t,backend:n,attrs:r}=e,{a:a,b:i,bias:s,preluActivationWeights:o}=t,{transposeA:l,transposeB:u,activation:c,leakyreluAlpha:h}=r;return batchMatMulImpl({a:a,b:i,transposeA:l,transposeB:u,backend:n,bias:s,preluActivationWeights:o,leakyreluAlpha:h,activation:c})}const _fusedMatMulConfig={kernelName:_FusedMatMul,backendName:"webgl",kernelFunc:_fusedMatMul},ABS="return abs(x);";
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function abs(e){const{inputs:t,backend:n}=e,{x:r}=t;if(n.shouldExecuteOnCPU([r])&&"complex64"!==r.dtype){const e=n.texData.get(r.dataId),t=simpleAbsImplCPU(e.values);return n.makeTensorInfo(r.shape,r.dtype,t)}let a;return a=env().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new UnaryOpPackedProgram(r.shape,ABS):new UnaryOpProgram(r.shape,ABS),n.runWebGLProgram(a,[r],r.dtype)}const absConfig={kernelName:Abs,backendName:"webgl",kernelFunc:abs},ACOS=CHECK_NAN_SNIPPET$1+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n",acos=unaryKernelFunc({opSnippet:ACOS}),acosConfig={kernelName:Acos,backendName:"webgl",kernelFunc:acos},ACOSH=CHECK_NAN_SNIPPET$1+"\n  if (x < 1.0) return NAN;\nreturn log(x + sqrt(x * x - 1.0));",acosh=unaryKernelFunc({opSnippet:ACOSH}),acoshConfig={kernelName:Acosh,backendName:"webgl",kernelFunc:acosh},ADD="return a + b;",addKernelFunc=binaryKernelFunc({opSnippet:ADD,packedOpSnippet:ADD,supportsComplex:!0,cpuKernelImpl:addImplCPU}),addConfig={kernelName:Add$1,backendName:"webgl",kernelFunc:addKernelFunc};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
class AddNProgram{constructor(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map(((e,t)=>`T${t}`));const n=[];this.variableNames.forEach((e=>{n.push(`float v${e} = get${e}AtOutCoords();`)}));const r=this.variableNames.map((e=>`v${e}`)).join(" + ");this.userCode=`\n      void main() {\n        ${n.join("\n        ")}\n\n        float result = ${r};\n        setOutput(result);\n      }\n    `}}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class AddNPackedProgram{constructor(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map(((e,t)=>`T${t}`));const n=[];this.variableNames.forEach((e=>{n.push(`vec4 v${e} = get${e}AtOutCoords();`)}));const r=this.variableNames.map((e=>`v${e}`)).join(" + ");this.userCode=`\n      void main() {\n        ${n.join("\n        ")}\n\n        vec4 result = ${r};\n        setOutput(result);\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function addN(e){const{inputs:t,backend:n}=e,r=t;if(1===r.length)return identity({inputs:{x:r[0]},backend:n});if(r.length>env().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const e=Math.floor(r.length/2),t=addN({inputs:r.slice(0,e),backend:n}),a=addN({inputs:r.slice(e),backend:n});return addN({inputs:[t,a],backend:n})}const a=r.map((e=>e.dtype)).reduce(((e,t)=>upcastType(e,t))),i=r.map((e=>e.shape)),s=env().getBool("WEBGL_PACK")?new AddNPackedProgram(r[0].shape,i):new AddNProgram(r[0].shape,i);return n.runWebGLProgram(s,r,a)}const addNConfig={kernelName:AddN,backendName:"webgl",kernelFunc:addN};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function all(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:s}=r,o=a.shape.length,l=parseAxisParam(i,a.shape);let u=l;const c=getAxesPermutation(u,o);let h=a;null!=c&&(h=transpose({inputs:{x:a},backend:n,attrs:{perm:c}}),u=getInnerMostAxes(u.length,o)),assertAxesAreInnerMostDims("all",u,o);const[d,p]=computeOutAndReduceShapes(h.shape,u),f=reshape({inputs:{x:h},backend:n,attrs:{shape:[-1,sizeFromShape(p)]}}),m=reduce$1(f,f.dtype,"all",n);let g;if(s){g=reshape({inputs:{x:m},backend:n,attrs:{shape:expandShapeToKeepDim(d,l)}})}else g=reshape({inputs:{x:m},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),null!=c&&n.disposeIntermediateTensorInfo(h),g}const allConfig={kernelName:All,backendName:"webgl",kernelFunc:all};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function any$1(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:s}=r,o=a.shape.length,l=parseAxisParam(i,a.shape);let u=l;const c=getAxesPermutation(u,o);let h=a;null!=c&&(h=transpose({inputs:{x:a},backend:n,attrs:{perm:c}}),u=getInnerMostAxes(u.length,o)),assertAxesAreInnerMostDims("any",u,o);const[d,p]=computeOutAndReduceShapes(h.shape,u),f=reshape({inputs:{x:h},backend:n,attrs:{shape:[-1,sizeFromShape(p)]}}),m=reduce$1(f,f.dtype,"any",n);let g;if(s){g=reshape({inputs:{x:m},backend:n,attrs:{shape:expandShapeToKeepDim(d,l)}})}else g=reshape({inputs:{x:m},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),null!=c&&n.disposeIntermediateTensorInfo(h),g}const anyConfig={kernelName:Any,backendName:"webgl",kernelFunc:any$1};
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class ArgMinMaxProgram{constructor(e,t,n){this.variableNames=["A"];const{windowSize:r,batchSize:a,outSize:i}=e;n||this.variableNames.push("bestIndicesA"),this.outputShape=[a,i];const s="max"===t?">":"<",o=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${r};\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ${r}; i++) {\n          int inIdx = ${o};\n          float candidate = getA(batch, inIdx);\n          if (candidate ${s} bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    `}}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class ArgMinMaxPackedProgram{constructor(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,assert$1(e.length>2,(()=>`Packed arg${n.charAt(0).toUpperCase()+n.slice(1)} supports only inputs with rank above 2.`));const a=e[e.length-1],i=Math.ceil(a/t);this.outputShape=e.slice(0,-1),i>1&&this.outputShape.push(i),r||this.variableNames.push("bestIndicesA");const s=this.outputShape,o=s.length,l=getCoordsDataType(o),u=getChannels("coords",o);let c,h;if(1===i){h=o+1;const e=getCoordsDataType(h);c=`\n        ${e} sourceLocR = ${e}(${u.join()}, 0);\n        ++${u[o-1]};\n        ${e} sourceLocG = ${e}(${u.join()}, 0);\n        ++${u[o-2]};\n        ${e} sourceLocA = ${e}(${u.join()}, 0);\n        --${u[o-1]};\n        ${e} sourceLocB = ${e}(${u.join()}, 0);\n        --${u[o-2]};`}else h=o,c=`\n        ${l} sourceLocR = coords;\n        ++${u[o-1]};\n        ${l} sourceLocG = coords;\n        ++${u[o-2]};\n        ${l} sourceLocA = coords;\n        --${u[o-1]};\n        ${l} sourceLocB = coords;\n        --${u[o-2]};`;const d=["x","y","z","w","u","v"].slice(0,h),p="."+d[h-1],f=d.map((e=>"int "+e)),m=getChannels("sourceLocR",h-1).concat("inIdx.r"),g=getChannels("sourceLocG",h-1).concat("inIdx.g"),y=getChannels("sourceLocB",h-1).concat("inIdx.b"),v=getChannels("sourceLocA",h-1).concat("inIdx.a"),b="max"===n?"greaterThan":"lessThan",x=r?"":`\n          inIdx = round(vec4(getBestIndicesAChannel(${m.join()}),\n                             getBestIndicesAChannel(${g.join()}),\n                             getBestIndicesAChannel(${y.join()}),\n                             getBestIndicesAChannel(${v.join()})));`,T=`vec4(\n            getAChannel(${m.join()}),\n            hasNextCol ? getAChannel(${g.join()}) : 0.,\n            hasNextRow ? getAChannel(${y.join()}) : 0.,\n            hasNextRow && hasNextCol ? getAChannel(${v.join()}) : 0.)`,_=r?"":`\n      float getBestIndicesAChannel(${f.join()}) {\n        return getChannel(getBestIndicesA(${d.join()}),\n                                          vec2(${d.slice(-2).join()}));\n      }`;this.userCode=`\n      float getAChannel(${f.join()}) {\n        return getChannel(getA(${d.join()}),\n                               vec2(${d.slice(-2).join()}));\n      }\n      ${_}\n      void main() {\n        ${l} coords = getOutputCoords();\n        bool hasNextCol = ${u[o-1]} < ${s[o-1]-1};\n        bool hasNextRow = ${u[o-2]} < ${s[o-2]-1};\n        ${c}\n        ivec4 srcIdx = ivec4(sourceLocR${p}, sourceLocG${p},\n          sourceLocB${p}, sourceLocA${p}) * ${t};\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ${T};\n\n        for (int i = 0; i < ${t}; i++) {\n          inIdx = srcIdx;\n          ${x}\n          vec4 candidate = ${T};\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(${b}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function argReduce(e,t,n,r=null){let a=t.shape[0],i=t.shape[1];null!=r&&(a=r.shape[0],i=r.shape[1]);const s=computeOptimalWindowSize(i),o={windowSize:s,inSize:i,batchSize:a,outSize:Math.ceil(i/s)},l=new ArgMinMaxProgram(o,n,null==r),u=[t];null!=r&&u.push(r);const c=e.runWebGLProgram(l,u,"int32");if(1===c.shape[1])return c;const h=argReduce(e,t,n,c);return e.disposeIntermediateTensorInfo(c),h}function argReducePacked(e,t,n,r=null){const a=null!=r?r.shape:t.shape,i=computeOptimalWindowSize(a[a.length-1]),s=new ArgMinMaxPackedProgram(a,i,n,null==r),o=null==r?[t]:[t,r],l=e.runWebGLProgram(s,o,"int32");if(l.shape.length===t.shape.length){const r=argReducePacked(e,t,n,l);return e.disposeIntermediateTensorInfo(l),r}return l}function argMinMaxReduce(e,t,n,r){const a=[n];if(assertAxesAreInnerMostDims("arg"+r.charAt(0).toUpperCase()+r.slice(1),a,t.shape.length),!env().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){const n=[],i=e.texData.get(t.dataId);let s=t;null!==i&&i.isPacked&&(s=e.unpackTensor(t),n.push(s));const[o,l]=computeOutAndReduceShapes(s.shape,a),u=sizeFromShape(l),c=reshape({inputs:{x:s},backend:e,attrs:{shape:[-1,u]}});n.push(c);const h=argReduce(e,c,r);n.push(h);const d=reshape({inputs:{x:h},backend:e,attrs:{shape:o}});return n.forEach((t=>e.disposeIntermediateTensorInfo(t))),d}return argReducePacked(e,t,r)}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function argMax(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i}=r;let s=parseAxisParam(i,a.shape);const o=getAxesPermutation(s,a.shape.length);let l=a;const u=[];null!=o&&(l=transpose({inputs:{x:a},backend:n,attrs:{perm:o}}),u.push(l),s=getInnerMostAxes(s.length,l.shape.length)),assertAxesAreInnerMostDims("argMax",[s[0]],l.shape.length);const c=argMinMaxReduce(n,l,s[0],"max");return u.forEach((e=>n.disposeIntermediateTensorInfo(e))),c}const argMaxConfig={kernelName:ArgMax,backendName:"webgl",kernelFunc:argMax};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function argMin(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i}=r;let s=parseAxisParam(i,a.shape);const o=getAxesPermutation(s,a.shape.length);let l=a;const u=[];null!=o&&(l=transpose({inputs:{x:a},backend:n,attrs:{perm:o}}),u.push(l),s=getInnerMostAxes(s.length,l.shape.length)),assertAxesAreInnerMostDims("argMin",[s[0]],l.shape.length);const c=argMinMaxReduce(n,l,s[0],"min");return u.forEach((e=>n.disposeIntermediateTensorInfo(e))),c}const argMinConfig={kernelName:ArgMin,backendName:"webgl",kernelFunc:argMin},ASIN=CHECK_NAN_SNIPPET$1+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n",asin=unaryKernelFunc({opSnippet:ASIN}),asinConfig={kernelName:Asin,backendName:"webgl",kernelFunc:asin},ASINH=CHECK_NAN_SNIPPET$1+"return log(x + sqrt(x * x + 1.0));",asinh=unaryKernelFunc({opSnippet:ASINH}),asinhConfig={kernelName:Asinh,backendName:"webgl",kernelFunc:asinh},ATAN=CHECK_NAN_SNIPPET$1+"\n  return atan(x);\n",atan=unaryKernelFunc({opSnippet:ATAN}),atanConfig={kernelName:Atan,backendName:"webgl",kernelFunc:atan},ATAN2=CHECK_NAN_SNIPPET+"\n  return atan(a, b);\n",ATAN2_PACKED="\n  vec4 result = atan(a, b);\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+CHECK_NAN_SNIPPET_PACKED+"\n  return result;\n",atan2=binaryKernelFunc({opSnippet:ATAN2,packedOpSnippet:ATAN2_PACKED}),atan2Config={kernelName:Atan2,backendName:"webgl",kernelFunc:atan2},ATANH=CHECK_NAN_SNIPPET$1+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\nreturn (log(1.0 + x) - log(1.0 - x)) / 2.0;",atanh=unaryKernelFunc({opSnippet:ATANH}),atanhConfig={kernelName:Atanh,backendName:"webgl",kernelFunc:atanh};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
class Pool2DProgram{constructor(e,t,n,r=!1,a=!1){if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");const i=e.filterWidth,s=e.strideHeight,o=e.strideWidth,l=e.dilationHeight,u=e.dilationWidth,c=e.effectiveFilterHeight,h=e.effectiveFilterWidth,d=e.padInfo.top,p=e.padInfo.left;this.outputShape=e.outShape;const f="avg"===t,m=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,g=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let y="0.0";if(f||(y="-1.0 / 1e-20"),n){const t=">=";return void(this.userCode=`\n        const ivec2 strides = ivec2(${s}, ${o});\n        const ivec2 pads = ivec2(${d}, ${p});\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < ${c};\n              wR += ${l}) {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ${e.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${h};\n                wC += ${u}) {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= ${e.inWidth}) {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value ${t} currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = ${r?a?m:g:`wR * ${h} + wC`};\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      `)}let v=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"avg"===t&&(v="avgValue / max(count, 1.0)");const b=4*Math.floor(i/4),x=i%4,T=`\n      if (${f}) {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    `;this.userCode=`\n      const ivec2 strides = ivec2(${s}, ${o});\n      const ivec2 pads = ivec2(${d}, ${p});\n      const float initializationValue = ${y};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= ${e.inWidth}) {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(${y});\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < ${c};\n            wR += ${l}) {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= ${e.inHeight}) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${b}; wC += 4) {\n            int xC = xCCorner + wC * ${u};\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${u}, d),\n              getValue(batch, xR, xC + 2 * ${u}, d),\n              getValue(batch, xR, xC + 3 * ${u}, d)\n            );\n\n            ${T}\n          }\n\n          int xC = xCCorner + ${b};\n          if (${1===x}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            ${T}\n          } else if (${2===x}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${u}, d),\n              initializationValue,\n              initializationValue\n            );\n\n            ${T}\n          } else if (${3===x}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${u}, d),\n              getValue(batch, xR, xC + 2 * ${u}, d),\n              initializationValue\n            );\n\n            ${T}\n          }\n        }\n        setOutput(${v});\n      }\n    `}}class Pool3DProgram{constructor(e,t,n,r=!1,a=!1){if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");const i=e.filterWidth,s=e.strideDepth,o=e.strideHeight,l=e.strideWidth,u=e.dilationDepth,c=e.dilationHeight,h=e.dilationWidth,d=e.effectiveFilterDepth,p=e.effectiveFilterHeight,f=e.effectiveFilterWidth,m=e.padInfo.front,g=e.padInfo.top,y=e.padInfo.left;this.outputShape=e.outShape;const v="avg"===t;let b="0.0";if(v||(b="-1.0 / 1e-20"),n){const t=">=";return void(this.userCode=`\n        const ivec3 strides =\n            ivec3(${s}, ${o}, ${l});\n        const ivec3 pads = ivec3(${m}, ${g}, ${y});\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < ${d};\n              wD += ${u}) {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= ${e.inDepth}) {\n              continue;\n            }\n\n            for (int wR = 0; wR < ${p};\n                wR += ${c}) {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= ${e.inHeight}) {\n                continue;\n              }\n\n              for (int wC = 0; wC < ${f};\n                  wC += ${h}) {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= ${e.inWidth}) {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value ${t} currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = ${r?a?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${p} * ${f} +\n                      wR * ${f} + wC`};\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      `)}let x=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"avg"===t&&(x="avgValue / max(count, 1.0)");const T=4*Math.floor(i/4),_=i%4,w=`\n      if (${v}) {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    `;this.userCode=`\n      const ivec3 strides =\n        ivec3(${s}, ${o}, ${l});\n      const ivec3 pads = ivec3(${m}, ${g}, ${y});\n      const float initializationValue = ${b};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= ${e.inWidth}) {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(${b});\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < ${d};\n            wD += ${u}) {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= ${e.inDepth}) {\n            continue;\n          }\n\n          for (int wR = 0; wR < ${p};\n            wR += ${c}) {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ${e.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${T}; wC += 4) {\n              int xC = xCCorner + wC * ${h};\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ${h}, ch),\n                getValue(batch, xD, xR, xC + 2 * ${h}, ch),\n                getValue(batch, xD, xR, xC + 3 * ${h}, ch)\n              );\n\n              ${w}\n            }\n\n            int xC = xCCorner + ${T};\n            if (${1===_}) {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              ${w}\n            } else if (${2===_}) {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ${h}, ch),\n                initializationValue,\n                initializationValue\n              );\n\n              ${w}\n            } else if (${3===_}) {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ${h}, ch),\n                getValue(batch, xD, xR, xC + 2 * ${h}, ch),\n                initializationValue\n              );\n\n              ${w}\n            }\n          }\n        }\n        setOutput(${x});\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function avgPool(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t;assertNotComplex(a,"avgPool");const{filterSize:i,strides:s,pad:o,dimRoundingMode:l}=r;assert$1(eitherStridesOrDilationsAreOne(s,1),(()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${s} and dilations '1'`));const u=computePool2DInfo(a.shape,i,s,1,o,l);if(1===u.filterWidth&&1===u.filterHeight&&arraysEqual(u.inShape,u.outShape))return identity({inputs:{x:a},backend:n});const c=new Pool2DProgram(u,"avg",!1);return n.runWebGLProgram(c,[a],"float32")}const avgPoolConfig={kernelName:AvgPool,backendName:"webgl",kernelFunc:avgPool};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function avgPool3D(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{filterSize:i,strides:s,pad:o,dimRoundingMode:l,dataFormat:u}=r,c=computePool3DInfo(a.shape,i,s,[1,1,1],o,l,u),h=new Pool3DProgram(c,"avg",!1);return n.runWebGLProgram(h,[a],"float32")}const avgPool3DConfig={kernelName:AvgPool3D,backendName:"webgl",kernelFunc:avgPool3D};
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class AvgPool2DBackpropProgram{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,i=e.dilationHeight,s=e.dilationWidth,o=e.effectiveFilterHeight,l=e.effectiveFilterWidth,u=o-1-e.padInfo.top,c=l-1-e.padInfo.left,h=1/(t*n);this.userCode=`\n      const ivec2 pads = ivec2(${u}, ${c});\n      const float avgMultiplier = float(${h});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${o};\n            wR += ${i}) {\n          float dyR = float(dyRCorner + wR) / ${r}.0;\n\n          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ${l};\n            wC+= ${s}) {\n            float dyC = float(dyCCorner + wC) / ${a}.0;\n\n            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class AvgPool3DBackpropProgram{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,a=e.strideDepth,i=e.strideHeight,s=e.strideWidth,o=e.dilationDepth,l=e.dilationHeight,u=e.dilationWidth,c=e.effectiveFilterDepth,h=e.effectiveFilterHeight,d=e.effectiveFilterWidth,p=c-1-e.padInfo.front,f=h-1-e.padInfo.top,m=d-1-e.padInfo.left,g=1/(t*n*r);this.userCode=`\n      const ivec3 pads = ivec3(${p}, ${f}, ${m});\n      const float avgMultiplier = float(${g});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ${c};\n            wD += ${o}) {\n          float dyD = float(dyDCorner + wD) / ${a}.0;\n\n          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ${h};\n              wR += ${l}) {\n            float dyR = float(dyRCorner + wR) / ${i}.0;\n\n            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ${d};\n                wC += ${u}) {\n              float dyC = float(dyCCorner + wC) / ${s}.0;\n\n              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function avgPool3DGrad(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,input:i}=t,s=i,{filterSize:o,strides:l,pad:u,dimRoundingMode:c}=r,h=computePool3DInfo(s.shape,o,l,[1,1,1],u,c),d=new AvgPool3DBackpropProgram(h);return n.runWebGLProgram(d,[a],s.dtype)}const avgPool3DGradConfig={kernelName:AvgPool3DGrad,backendName:"webgl",kernelFunc:avgPool3DGrad};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function avgPoolGrad(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,input:i}=t,s=i;assertNotComplex([a,i],"avgPoolGrad");const{filterSize:o,strides:l,pad:u}=r,c=computePool2DInfo(s.shape,o,l,1,u),h=new AvgPool2DBackpropProgram(c);return n.runWebGLProgram(h,[a],s.dtype)}const avgPoolGradConfig={kernelName:AvgPoolGrad,backendName:"webgl",kernelFunc:avgPoolGrad};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function batchMatMul(e){const{inputs:t,backend:n,attrs:r}=e,{a:a,b:i}=t,{transposeA:s,transposeB:o}=r;return batchMatMulImpl({a:a,b:i,transposeA:s,transposeB:o,backend:n})}const batchMatMulConfig={kernelName:BatchMatMul,backendName:"webgl",kernelFunc:batchMatMul};
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class BatchNormProgram{constructor(e,t,n,r,a,i){this.outputShape=[],this.variableNames=["x","mean","variance"],assertAndGetBroadcastShape(e,t),assertAndGetBroadcastShape(e,n);let s="0.0";null!=r&&(assertAndGetBroadcastShape(e,r),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");let o="1.0";null!=a&&(assertAndGetBroadcastShape(e,a),this.variableNames.push("scale"),o="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = ${s};\n        float scale = ${o};\n        float inv = scale * inversesqrt(variance + float(${i}));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    `}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class BatchNormPackedProgram{constructor(e,t,n,r,a,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],assertAndGetBroadcastShape(e,t),assertAndGetBroadcastShape(e,n);let s="vec4(0.0)";null!=r&&(assertAndGetBroadcastShape(e,r),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");let o="vec4(1.0)";null!=a&&(assertAndGetBroadcastShape(e,a),this.variableNames.push("scale"),o="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`\n      void main() {\n        vec4 offset = ${s};\n        vec4 scale = ${o};\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4(${i}));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const batchNorm=({inputs:e,backend:t,attrs:n})=>{const{x:r,mean:a,variance:i,offset:s,scale:o}=e;assert$1(a.shape.length===i.shape.length,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),assert$1(null==s||a.shape.length===s.shape.length,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),assert$1(null==o||a.shape.length===o.shape.length,(()=>"Batch normalization gradient requires mean and scale to have equal ranks."));let{varianceEpsilon:l}=n;null==l&&(l=.001);const u=[r,a,i];let c=null;null!=s&&(c=s.shape,u.push(s));let h=null;null!=o&&(h=o.shape,u.push(o));const d=env().getBool("WEBGL_PACK_NORMALIZATION")?new BatchNormPackedProgram(r.shape,a.shape,i.shape,c,h,l):new BatchNormProgram(r.shape,a.shape,i.shape,c,h,l);return t.runWebGLProgram(d,u,u[0].dtype)},batchNormConfig={kernelName:FusedBatchNorm,backendName:"webgl",kernelFunc:batchNorm};
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
class SliceProgram{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const t=getCoordsDataType(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const n=getCoords$1(this.rank);let r;r=`\n        ${t} sourceLoc;\n        ${t} coords = getOutputCoords();\n        ${e.map(((e,t)=>`sourceLoc.${coords[t]} = start[${t}] + coords.${coords[t]};`)).join("\n")}\n      `,this.userCode=`\n      void main() {\n        ${r}\n        setOutput(getSource(${n}));\n      }\n    `}}const coords=["x","y","z","w","u","v"];function getCoords$1(e){if(1===e)return"sourceLoc";if(e<=6)return coords.slice(0,e).map((e=>"sourceLoc."+e)).join(",");throw Error(`Slicing for rank ${e} is not yet supported`)}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class SlicePackedProgram{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const t=getCoordsDataType(this.rank),n=getChannels("coords",this.rank),r=getChannels("sourceLoc",this.rank),a=1===this.rank?"sourceLoc":`vec2(${r.slice(-2).join()})`,i=`getChannel(getSource(${r.join()}), ${a})`,s=`\n      result.x = ${i};\n      if (++${n[this.rank-1]} < ${e[this.rank-1]}) {\n        ++${r[this.rank-1]};\n        result.y = ${i};\n        --${r[this.rank-1]};\n      }\n    `,o=1===this.rank?"":`\n      --${n[this.rank-1]};\n      if (++${n[this.rank-2]} < ${e[this.rank-2]}) {\n        ++${r[this.rank-2]};\n        result.z = ${i};\n        if (++${n[this.rank-1]} < ${e[this.rank-1]}) {\n          ++${r[this.rank-1]};\n          result.w = ${i};\n        }\n      }\n    `,l=this.rank<=4?`sourceLoc = coords +\n            ${t}(${e.map(((e,t)=>`start[${t}]`)).join()});`:e.map(((e,t)=>`${r[t]} = ${n[t]} + start[${t}];`)).join("\n");this.userCode=`\n      void main() {\n        ${t} coords = getOutputCoords();\n        ${t} sourceLoc;\n        ${l}\n        vec4 result = vec4(0.);\n        ${s}\n        ${o}\n        setOutput(result);\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function shallowSlice(e,t,n,r){const a=r.texData.get(e.dataId),i=r.makeTensorInfo(n,e.dtype),s=r.texData.get(i.dataId);Object.assign(s,a),s.refCount=1,s.shape=n,s.dtype=e.dtype;let o=computeFlatOffset(t,computeStrides(e.shape));a.slice&&(o+=a.slice.flatOffset),s.slice={flatOffset:o,origDataId:a.slice&&a.slice.origDataId||e.dataId};const l=r.dataRefCount.get(s.slice.origDataId)||1;return r.dataRefCount.set(s.slice.origDataId,l+1),i}function slice(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{begin:i,size:s}=r,[o,l]=parseSliceParams(a,i,s);if(assertParamsValid(a,o,l),0===sizeFromShape(l))return n.makeTensorInfo(l,a.dtype,[]);if(n.shouldExecuteOnCPU([a])||"string"===a.dtype){const e=n.texData.get(a.dataId),t=sliceImplCPU(e.values,o,l,a.shape,a.dtype);return n.makeTensorInfo(l,a.dtype,t)}const{isPacked:u}=n.texData.get(a.dataId),c=isSliceContinous(a.shape,o,l);if(u||!c){const e=env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new SlicePackedProgram(l):new SliceProgram(l),t=[o];return n.runWebGLProgram(e,[a],a.dtype,t)}return n.uploadToGPU(a.dataId),shallowSlice(a,o,l,n)}const sliceConfig={kernelName:Slice,backendName:"webgl",kernelFunc:slice},batchToSpaceND=e=>{const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:i,crops:s}=r;assert$1(a.shape.length<=4,(()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"));const o=i.reduce(((e,t)=>e*t)),l=getReshaped(a.shape,i,o),u=getPermuted(l.length,i.length),c=getReshapedPermuted(a.shape,i,o),h=getSliceBeginCoords(s,i.length),d=getSliceSize(c,s,i.length),p=[],f=reshape({inputs:{x:a},backend:n,attrs:{shape:l}}),m=transpose({inputs:{x:f},backend:n,attrs:{perm:u}}),g=reshape({inputs:{x:m},backend:n,attrs:{shape:c}}),y=slice({inputs:{x:g},backend:n,attrs:{begin:h,size:d}});return p.push(f),p.push(m),p.push(g),p.forEach((e=>n.disposeIntermediateTensorInfo(e))),y},batchToSpaceNDConfig={kernelName:BatchToSpaceND,backendName:"webgl",kernelFunc:batchToSpaceND};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function bincount(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,weights:i}=t,{size:s}=r,o=n.readSync(a.dataId),l=n.readSync(i.dataId),u=bincountImplCPU(o,l,i.dtype,i.shape,s);return n.makeTensorInfo([s],i.dtype,u)}const bincountConfig={kernelName:Bincount,backendName:"webgl",kernelFunc:bincount},BITWISEAND="\n  int r = int(a.r) & int(b.r);\n  int g = int(a.g) & int(b.g);\n  int rb = int(a.b) & int(b.b);\n  int ra = int(a.a) & int(b.a);\n  return vec4(r, g, rb, ra);\n",BITWISEAND_UNPACKED="\n  return float(int(a.r) & int(b.r));\n";
/**
     * @license
     * Copyright 2023 Google LLC.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function bitwiseAnd(e){const{inputs:t,backend:n}=e,{a:r,b:a}=t,i=env().getBool("WEBGL_PACK_BINARY_OPERATIONS"),s=env().getNumber("WEBGL_VERSION");if(n.shouldExecuteOnCPU([r,a])||1===s){const e=n.texData.get(r.dataId).values,t=n.texData.get(a.dataId).values,[i,s]=bitwiseAndImplCPU(r.shape,a.shape,e,t,r.dtype),o=n.makeTensorInfo(s,r.dtype);return n.texData.get(o.dataId).values=i,o}let o;return o=i?new BinaryOpPackedProgram(BITWISEAND,r.shape,a.shape,!1):new BinaryOpProgram(BITWISEAND_UNPACKED,r.shape,a.shape),n.runWebGLProgram(o,[r,a],r.dtype)}const bitwiseAndConfig={kernelName:BitwiseAnd,backendName:"webgl",kernelFunc:bitwiseAnd};
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function broadcastArgs(e){const{inputs:t,backend:n}=e,{s0:r,s1:a}=t,i=n.readSync(r.dataId),s=n.readSync(a.dataId),o=assertAndGetBroadcastShape(Array.from(i),Array.from(s));return n.makeTensorInfo([o.length],"int32",Int32Array.from(o))}const broadcastArgsConfig={kernelName:BroadcastArgs,backendName:"webgl",kernelFunc:broadcastArgs},NOT_EQUAL="return float(a != b);",notEqual=binaryKernelFunc({opSnippet:NOT_EQUAL,cpuKernelImpl:notEqualImplCPU,dtype:"bool"}),notEqualConfig={kernelName:NotEqual,backendName:"webgl",kernelFunc:notEqual};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function real(e){const{inputs:t,backend:n}=e,{input:r}=t;return identity({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.real},backend:n})}const realConfig={kernelName:Real,backendName:"webgl",kernelFunc:real},TO_INT="return float(int(x));";
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function int(e,t){const n=new UnaryOpProgram(e.shape,TO_INT),r=t.runWebGLProgram(n,[e],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function cast(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{dtype:i}=r;if("complex64"===i){if("complex64"===a.dtype)return identity({inputs:{x:a},backend:n});const e=zeros$1(a.shape),t=cast({inputs:{x:a},backend:n,attrs:{dtype:"float32"}}),r=complex({inputs:{real:t,imag:e},backend:n});return e.dispose(),n.disposeIntermediateTensorInfo(t),r}if("complex64"===a.dtype){const e=real({inputs:{input:a},backend:n}),t=cast({inputs:{x:e},backend:n,attrs:{dtype:i}});return n.disposeIntermediateTensorInfo(e),t}if(!hasEncodingLoss(a.dtype,i)){const e=identity({inputs:{x:a},backend:n});return{dataId:e.dataId,shape:e.shape,dtype:i}}if(n.shouldExecuteOnCPU([a])){const e=n.texData.get(a.dataId).values,[t,r,s]=castImplCPU(e,a.shape,a.dtype,i);return n.makeTensorInfo(t,r,s)}if("int32"===i)return int(a,n);if("bool"===i){const e=n.makeTensorInfo([],"bool",getTypedArrayFromDType("bool",1)),t=notEqual({inputs:{a:a,b:e},backend:n});return n.disposeIntermediateTensorInfo(e),t}throw new Error(`Error in Cast: failed to cast ${a.dtype} to ${i}`)}const castConfig={kernelName:Cast,backendName:"webgl",kernelFunc:cast},CEIL="return ceil(x);",ceil=unaryKernelFunc({opSnippet:CEIL,packedOpSnippet:CEIL,cpuKernelImpl:ceilImplCPU}),ceilConfig={kernelName:Ceil,backendName:"webgl",kernelFunc:ceil};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
class ClipProgram{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode="\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class ClipPackedProgram{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode="\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function clipByValue(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{clipValueMin:i,clipValueMax:s}=r;let o;o=env().getBool("WEBGL_PACK_CLIP")?new ClipPackedProgram(a.shape):new ClipProgram(a.shape);const l=[[i],[s]];return n.runWebGLProgram(o,[a],a.dtype,l)}const clipByValueConfig={kernelName:ClipByValue,backendName:"webgl",kernelFunc:clipByValue};
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class ComplexAbsProgram{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function makeComplexComponentTensorInfo(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}}function complexAbs(e){const{inputs:t,backend:n}=e,{x:r}=t,a=n.texData.get(r.dataId),i=new ComplexAbsProgram(r.shape),s=[makeComplexComponentTensorInfo(r,a.complexTensorInfos.real),makeComplexComponentTensorInfo(r,a.complexTensorInfos.imag)];return n.runWebGLProgram(i,s,s[0].dtype)}const complexAbsConfig={kernelName:ComplexAbs,backendName:"webgl",kernelFunc:complexAbs};
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class ConcatProgram{constructor(e){this.outputShape=[],this.outputShape=computeOutShape$1(e,1),this.variableNames=e.map(((e,t)=>`T${t}`));const t=new Array(e.length-1);t[0]=e[0][1];for(let i=1;i<t.length;i++)t[i]=t[i-1]+e[i][1];const n=[`if (yC < ${t[0]}) setOutput(getT0(yR, yC));`];for(let i=1;i<t.length;i++){const e=t[i-1];n.push(`else if (yC < ${t[i]}) setOutput(getT${i}(yR, yC-${e}));`)}const r=t.length,a=t[t.length-1];n.push(`else setOutput(getT${r}(yR, yC-${a}));`),this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ${n.join("\n        ")}\n      }\n    `}}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class ConcatPackedProgram{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=computeOutShape$1(e,t);const n=this.outputShape,r=n.length,a=getCoordsDataType(r),i=getChannels("coords",r),s=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map(((e,t)=>`T${t}`));const o=new Array(e.length-1);o[0]=e[0][t];for(let f=1;f<o.length;f++)o[f]=o[f-1]+e[f][t];const l=s[t],u=s.slice(-2),c=s.join();let h=`if (${l} < ${o[0]}) {\n        return getChannel(\n            getT0(${c}), vec2(${u.join()}));\n        }`;for(let f=1;f<o.length;f++){const e=o[f-1];h+=`\n        if (${l} < ${o[f]}  && ${l} >= ${o[f-1]}) {\n          return getChannel(\n            getT${f}(${shiftedChannels(s,l,e)}),\n            vec2(${shiftedChannels(u,l,e)}));\n        }`}const d=o.length,p=o[o.length-1];h+=`\n        return getChannel(\n          getT${d}(${shiftedChannels(s,l,p)}),\n          vec2(${shiftedChannels(u,l,p)}));`,this.userCode=`\n      float getValue(${s.map((e=>"int "+e))}) {\n        ${h}\n      }\n\n      void main() {\n        ${a} coords = getOutputCoords();\n        vec4 result = vec4(getValue(${i}), 0., 0., 0.);\n\n        ${i[r-1]} = ${i[r-1]} + 1;\n        if (${i[r-1]} < ${n[r-1]}) {\n          result.g = getValue(${i});\n        }\n\n        ${i[r-2]} = ${i[r-2]} + 1;\n        if (${i[r-2]} < ${n[r-2]}) {\n          result.a = getValue(${i});\n        }\n\n        ${i[r-1]} = ${i[r-1]} - 1;\n        if (${i[r-2]} < ${n[r-2]} &&\n            ${i[r-1]} < ${n[r-1]}) {\n          result.b = getValue(${i});\n        }\n        setOutput(result);\n      }\n    `}}function shiftedChannels(e,t,n){const r=e.indexOf(t);return e.map(((e,t)=>t===r?`${e} - ${n}`:e)).join()}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function imag(e){const{inputs:t,backend:n}=e,{input:r}=t;return identity({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.imag},backend:n})}const imagConfig={kernelName:Imag,backendName:"webgl",kernelFunc:imag};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function concatImpl(e,t,n){const r=e[0].dtype;if("complex64"===r){const r=e.map((e=>real({inputs:{input:e},backend:n}))),a=e.map((e=>imag({inputs:{input:e},backend:n}))),i=concatImpl(r,t,n),s=concatImpl(a,t,n),o=complex({inputs:{real:i,imag:s},backend:n});return r.forEach((e=>n.disposeIntermediateTensorInfo(e))),a.forEach((e=>n.disposeIntermediateTensorInfo(e))),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(s),o}let a=n.shouldExecuteOnCPU(e);if("string"===r&&(a=!0),a){const a=e.map((e=>{const r=sizeFromShape(e.shape.slice(t));return reshape({inputs:{x:e},backend:n,attrs:{shape:[-1,r]}})})),i=a.map((e=>({vals:n.readSync(e.dataId),shape:e.shape}))),s=computeOutShape$1(a.map((e=>e.shape)),1),o=1===a[0].shape[0],l=concatImplCPU(i,s,r,o),u=computeOutShape$1(e.map((e=>e.shape)),t),c=n.makeTensorInfo(u,r,l);return a.forEach((e=>n.disposeIntermediateTensorInfo(e))),c}const i=e.filter((e=>sizeFromShape(e.shape)>0)),s=env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&i[0].shape.length>1;if(1===i.length){const t=s?new UnaryOpProgram(e[0].shape,CLONE):new UnaryOpPackedProgram(e[0].shape,CLONE);return n.runWebGLProgram(t,e,r)}const o=env().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(i.length>o){const e=[];for(let a=0;a<i.length;a+=o){const r=i.slice(a,a+o);e.push(concatImpl(r,t,n))}const r=concatImpl(e,t,n);for(const t of e)n.disposeIntermediateTensorInfo(t);return r}if(s){const e=new ConcatPackedProgram(i.map((e=>e.shape)),t);return n.runWebGLProgram(e,i,r)}const{tensors2D:l,outShape:u}=computeTensors2D(i,t,n),c=new ConcatProgram(l.map((e=>e.shape))),h=n.runWebGLProgram(c,l,r);l.forEach((e=>n.disposeIntermediateTensorInfo(e)));const d=reshape({inputs:{x:h},attrs:{shape:u},backend:n});return n.disposeIntermediateTensorInfo(h),d}function computeTensors2D(e,t,n){const r=computeOutShape$1(e.map((e=>e.shape)),t);return{tensors2D:e.map((e=>reshape({inputs:{x:e},attrs:{shape:[-1,sizeFromShape(e.shape.slice(t))]},backend:n}))),outShape:r}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function concat(e){const{inputs:t,backend:n,attrs:r}=e,{axis:a}=r,i=parseAxisParam(a,t[0].shape)[0],s=t.map((e=>e.shape));assertParamsConsistent(s,i);const o=computeOutShape$1(t.map((e=>e.shape)),i);if(0===sizeFromShape(o))return n.makeTensorInfo(o,t[0].dtype,[]);const l=t.filter((e=>sizeFromShape(e.shape)>0));return 1===l.length?identity({inputs:{x:l[0]},backend:n}):concatImpl(l,i,n)}const concatConfig={kernelName:Concat,backendName:"webgl",kernelFunc:concat};
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class Conv2DProgram{constructor(e,t=!1,n=null,r=!1,a=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const i=e.padInfo.top,s=e.padInfo.left,o=e.strideHeight,l=e.strideWidth,u=e.dilationHeight,c=e.dilationWidth,h=e.filterHeight,d=e.filterWidth,p=4*Math.floor(e.inChannels/4),f=e.inChannels%4,m="channelsLast"===e.dataFormat,g=m?1:2,y=m?2:3,v=m?3:1;let b="",x="";n&&(b=r?`float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:a?`float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`\n          float activation(float x) {\n            ${n}\n          }\n        `,x="result = activation(result);");const T=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${b}\n\n      const ivec2 strides = ivec2(${o}, ${l});\n      const ivec2 pads = ivec2(${i}, ${s});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[${v}];\n\n        ivec2 xRCCorner =\n            ivec2(coords[${g}], coords[${y}]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${h}; wR++) {\n          int xR = xRCorner + wR * ${u};\n\n          if (xR < 0 || xR >= ${e.inHeight}) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${d}; wC++) {\n            int xC = xCCorner + wC * ${c};\n\n            if (xC < 0 || xC >= ${e.inWidth}) {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ${p}; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (${m}) {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (${1===f}) {\n\n              if (${m}) {\n                dotProd +=\n                    getX(batch, xR, xC, ${p}) *\n                    getW(wR, wC, ${p}, d2);\n              } else {\n                dotProd +=\n                    getX(batch, ${p}, xR, xC) *\n                    getW(wR, wC, ${p}, d2);\n              }\n\n            } else if (${2===f}) {\n              vec2 wValues = vec2(\n                getW(wR, wC, ${p}, d2),\n                getW(wR, wC, ${p} + 1, d2)\n              );\n\n              if (${m}) {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ${p}),\n                  getX(batch, xR, xC, ${p} + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ${p}, xR, xC),\n                  getX(batch, ${p} + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (${3===f}) {\n              vec3 wValues = vec3(\n                getW(wR, wC, ${p}, d2),\n                getW(wR, wC, ${p} + 1, d2),\n                getW(wR, wC, ${p} + 2, d2)\n              );\n\n              if (${m}) {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ${p}),\n                  getX(batch, xR, xC, ${p} + 1),\n                  getX(batch, xR, xC, ${p} + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ${p}, xR, xC),\n                  getX(batch, ${p} + 1, xR, xC),\n                  getX(batch, ${p} + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ${T}\n        ${x}\n        setOutput(result);\n      }\n    `}}class Conv3DProgram{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const t=e.padInfo.front,n=e.padInfo.top,r=e.padInfo.left,a=e.strideDepth,i=e.strideHeight,s=e.strideWidth,o=e.dilationDepth,l=e.dilationHeight,u=e.dilationWidth,c=e.filterDepth,h=e.filterHeight,d=e.filterWidth,p=4*Math.floor(e.inChannels/4),f=e.inChannels%4;this.userCode=`\n      const ivec3 strides = ivec3(${a}, ${i}, ${s});\n      const ivec3 pads = ivec3(${t}, ${n}, ${r});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ${c}; wF++) {\n          int xF = xFCorner + wF * ${o};\n\n          if (xF < 0 || xF >= ${e.inDepth}) {\n            continue;\n          }\n\n          for (int wR = 0; wR < ${h}; wR++) {\n            int xR = xRCorner + wR * ${l};\n\n            if (xR < 0 || xR >= ${e.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${d}; wC++) {\n              int xC = xCCorner + wC * ${u};\n\n              if (xC < 0 || xC >= ${e.inWidth}) {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < ${p}; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if (${1===f}) {\n                dotProd +=\n                  getX(batch, xF, xR, xC, ${p}) *\n                  getW(wF, wR, wC, ${p}, d2);\n              } else if (${2===f}) {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, ${p}),\n                  getX(batch, xF, xR, xC, ${p} + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, ${p}, d2),\n                  getW(wF, wR, wC, ${p} + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if (${3===f}) {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, ${p}),\n                  getX(batch, xF, xR, xC, ${p} + 1),\n                  getX(batch, xF, xR, xC, ${p} + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, ${p}, d2),\n                  getW(wF, wR, wC, ${p} + 1, d2),\n                  getW(wF, wR, wC, ${p} + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class Conv2DPackedProgram{constructor(e,t=!1,n=null,r=!1,a=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=useShapeUniforms(this.outputShape.length);const i=e.padInfo.left,s=e.strideWidth,o=e.dilationWidth,l=e.filterHeight,u=e.filterWidth,c=u;let h="\n       int xR; int xC; int xCOffset;\n       vec4 wTexel; vec4 previous; vec4 final;";for(let m=0;m<u;m++)h+=`\n           vec4 xTexelC${2*m};\n           int xTexelC${2*m}Ready;\n           vec4 xTexelC${2*m+1};\n           int xTexelC${2*m+1}Ready;\n           vec4 xC${m};`;h+=`\n     for (int r = 0; r < ${l}; r++) {\n      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {\n       `;for(let m=0;m<u;m++)h+=`\n           xTexelC${2*m} = vec4(0.0);\n           xTexelC${2*m}Ready = 0;\n           xTexelC${2*m+1} = vec4(0.0);\n           xTexelC${2*m+1}Ready = 0;\n           xC${m} = vec4(0.0);`;h+="\n         xR = xRCorner + r * dilations[0];\n         if (xR >=0 && xR < inDims[0]) {\n       ";for(let m=0;m<(c+1)/2;m++){const t=2*m;if(h+=`\n           xC = xCCorner + ${t*o};\n           `,1===s){if(t<u&&(i%2==1?(h+=`\n                 xCOffset = xC + 1;\n                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t}Ready == 0) {\n                   xTexelC${t} = getX(batch, xR, xCOffset, d1);\n\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC${t}.zw = vec2(0.0);\n                   }\n                   xTexelC${t}Ready = 1;\n                 }\n               `,h+=1===o&&t>0?`\n                 xC${t} = vec4(xTexelC${t-2}.zw, xTexelC${t}.xy);\n                 `:`\n                   xCOffset = xC + 1 - 2;\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       previous.zw = vec2(0.0);\n                     }\n\n                     xC${t} = vec4(previous.zw, xTexelC${t}.xy);\n                   } else {\n                     xC${t} = vec4(0.0, 0.0, xTexelC${t}.xy);\n                   }\n                   `):h+=`\n                 if (xC >= 0 && xC < inDims[1] && xTexelC${t}Ready == 0) {\n                   xTexelC${t} = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC${t}.zw = vec2(0.0);\n                   }\n                   xTexelC${t}Ready = 1;\n                 }\n\n                 xC${t} = xTexelC${t};\n                 `,t+1<u)){const e=i%2==0?nearestLargerEven(o):o;o%2==0&&i%2==1||o%2!=0&&i%2!=1?(h+=`\n                   xCOffset = xC + imod(pads[1], 2) + ${e};\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t+1}Ready == 0) {\n                     xTexelC${t+1} = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       xTexelC${t+1}.zw = vec2(0.0);\n                     }\n                     xTexelC${t+1}Ready = 1;\n                   }\n                   `,h+=o>1?`\n                     xCOffset -= 2;\n                     if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                      previous = getX(batch, xR, xCOffset, d1);\n                      xC${t+1} = vec4(previous.zw, xTexelC${t+1}.xy);\n                     } else {\n                      xC${t+1} = vec4(0.0, 0.0, xTexelC${t+1}.xy);\n                     }\n                     `:`\n                     xC${t+1} = vec4(xTexelC${t}.zw, xTexelC${t+1}.xy);\n                     `):h+=1===e?`\n                     xC${t+1} = xTexelC${t};\n                     `:`\n                     xCOffset = xC + ${e};\n\n                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t+1}Ready == 0) {\n                       xTexelC${t+1} = getX(batch, xR, xCOffset, d1);\n                       if (xCOffset + 1 >= inDims[1]) {\n                         xTexelC${t+1}.zw = vec2(0.0);\n                       }\n                       xTexelC${t+1}Ready = 1;\n                     }\n\n                     xC${t+1} = xTexelC${t+1};\n                     `}}else t<u&&(i%2==1?(h+=`\n                 xCOffset = xC + 1 - strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t}Ready == 0) {\n                   xTexelC${t} = getX(batch, xR, xCOffset, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC${t}.zw = vec2(0.0);\n                   }\n                   xTexelC${t}Ready = 1;\n                 }\n\n                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${t+1}Ready == 0) {\n                   xTexelC${t+1} = getX(batch, xR, xC + 1, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xC + 2 >= inDims[1]) {\n                     xTexelC${t+1}.zw = vec2(0.0);\n                   }\n                   xTexelC${t+1}Ready = 1;\n                 }\n\n                 xC${t} = vec4(xTexelC${t}.zw, xTexelC${t+1}.zw);\n               `,t+1<u&&(h+=`\n                   final = vec4(0.0);\n                   xCOffset = xC + 1 + strides[1];\n                   if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                     final = getX(batch, xR, xCOffset, d1);\n                   }\n                   xC${t+1} = vec4(xTexelC${t+1}.xy, final.xy);\n                 `)):(h+=`\n                 if(xC >= 0 && xC < inDims[1] && xTexelC${t}Ready == 0) {\n                   xTexelC${t} = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC${t}.zw = vec2(0.0);\n                   }\n                   xTexelC${t}Ready = 1;\n                 }\n\n                 xCOffset = xC + strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t+1}Ready == 0) {\n                   xTexelC${t+1} = getX(batch, xR, xCOffset, d1);\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC${t+1}.zw = vec2(0.);\n                   }\n                   xTexelC${t+1}Ready = 1;\n                 }\n\n                 xC${t} = vec4(\n                   xTexelC${t}.xy, xTexelC${t+1}.xy);\n               `,t+1<u&&(h+=`\n                   xC${t+1} = vec4(xTexelC${t}.zw, xTexelC${t+1}.zw);\n                 `)));t<u&&(h+=`\n             wTexel = getW(r, ${t}, d1, d2);\n             dotProd += xC${t}.xxzz * vec4(wTexel.xy, wTexel.xy);\n             if(d1 + 1 < ${e.inChannels}) {\n               dotProd += xC${t}.yyww * vec4(wTexel.zw, wTexel.zw);\n             }\n           `,t+1<u&&(h+=`\n               wTexel = getW(r, ${t+1}, d1, d2);\n               dotProd += xC${t+1}.xxzz * vec4(wTexel.xy, wTexel.xy);\n               if(d1 + 1 < ${e.inChannels}) {\n                 dotProd += xC${t+1}.yyww * vec4(wTexel.zw, wTexel.zw);\n               }\n             `))}h+="\n     }\n   ",h+="\n     }\n   ",h+="\n     }\n   ";let d="",p="";n&&(d=r?`vec4 activation(vec4 a) {\n           vec4 b = getPreluActivationWeightsAtOutCoords();\n           ${n}\n         }`:a?`vec4 activation(vec4 a) {\n           vec4 b = getLeakyreluAlphaAtOutCoords();\n           ${n}\n         }`:`vec4 activation(vec4 x) {\n           ${n}\n         }`,p="result = activation(result);");const f=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n       ${d}\n\n       void main() {\n         ivec4 coords = getOutputCoords();\n         int batch = coords.x;\n         ivec2 xRCCorner = coords.yz * strides - pads;\n         int d2 = coords.w;\n         int xRCorner = xRCCorner.x;\n         int xCCorner = xRCCorner.y;\n\n         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n         vec4 dotProd = vec4(0.000000000000001);\n\n         ${h}\n\n         vec4 result = dotProd - vec4(0.000000000000001);\n         ${f}\n         ${p}\n         setOutput(result);\n       }\n     `}}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class Im2ColPackedProgram{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=useShapeUniforms(this.outputShape.length);const{dataFormat:n}=t,r=getGlslDifferences(),a="channelsLast"===n,i=a?1:2,s=a?2:3,o=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let l="";for(let u=0;u<=1;u++)for(let e=0;e<=1;e++)l+=`\n          blockIndex = rc.z + ${e};\n          pos = rc.y + ${u};\n\n          ${o}\n            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];\n            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);\n\n            if(d0 < inputShape[${i}] && d0 >= 0) {\n              // Use custom imod instead mod. On Intel GPU, mod may generate\n              // unexpected value.\n              // https://github.com/tensorflow/tfjs/issues/5447\n              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];\n              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /\n                  inChannels);\n\n              if(d1 < inputShape[${s}] && d1 >= 0) {\n\n                ch = imod(pos, inChannels);\n\n                if (${a}) {\n                  innerDims = vec2(d1, ch);\n                  result[${2*u+e}] = getChannel(\n                    getA(rc.x, d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[${2*u+e}] = getChannel(\n                    getA(rc.x, ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        `;this.userCode=`\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ${l}\n\n        ${r.output} = result;\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function getShapeForBatchMatMul(e,t){const n=e.length;return n>=3?t?[...e.slice(0,-3),e[n-3]*e[n-2],e[n-1]]:[...e.slice(0,-3),e[n-3],e[n-2]*e[n-1]]:!t&&1===n&&e[0]>1?[e[0],1]:null}function conv2dByMatMul({x:e,filter:t,convInfo:n,backend:r,bias:a=null,preluActivationWeights:i=null,leakyreluAlpha:s=0,activation:o=null}){const l=e.shape,u=r.texData.get(e.dataId),c=n.inChannels,h=l[0]*l[1]*l[2],d=n.outChannels,p="channelsLast"===n.dataFormat;let f;const m=[];if(null!=i){const e=getShapeForBatchMatMul(i.shape,p);null!=e&&(i=reshape({inputs:{x:i},backend:r,attrs:{shape:e}}),m.push(i))}if(null!=a){const e=getShapeForBatchMatMul(a.shape,p);null!=e&&(a=reshape({inputs:{x:a},backend:r,attrs:{shape:e}}),m.push(a))}if(!((1===h||1===d)&&c>MATMUL_SHARED_DIM_THRESHOLD)&&u.isPacked&&p&&null!=u.texture&&l[2]%2!=0&&arraysEqual(u.shape.slice(-3),l.slice(-3))){const c=l[0]*l[1]*(l[2]+1),h={dataId:e.dataId,shape:[1,c,n.inChannels],dtype:e.dtype},d=u.shape;u.shape=u.shape.slice(),u.shape[u.shape.length-2]++,assert$1(isReshapeFree(u.shape,h.shape),(()=>`packed reshape ${u.shape} to ${h.shape} isn't free`));const p=reshape({inputs:{x:t},backend:r,attrs:{shape:[1,n.inChannels,n.outChannels]}});m.push(p);const g=batchMatMulImpl({a:h,b:p,backend:r,transposeA:false,transposeB:false,bias:a,activation:o,preluActivationWeights:i,leakyreluAlpha:s}),y=r.texData.get(g.dataId);assert$1(y.isPacked,(()=>"batchMatMul result is expected to be packed")),u.shape=d,y.shape=n.outShape,f=identity({inputs:{x:g},backend:r}),f.shape=n.outShape,m.push(g)}else{const l=n.outHeight*n.outWidth,u=reshape({inputs:{x:e},backend:r,attrs:{shape:p?[n.batchSize,l,n.inChannels]:[n.batchSize,n.inChannels,l]}}),c=reshape({inputs:{x:t},backend:r,attrs:{shape:[1,n.inChannels,n.outChannels]}}),h=batchMatMulImpl({a:p?u:c,b:p?c:u,transposeA:!p,transposeB:false,backend:r,bias:a,activation:o,preluActivationWeights:i,leakyreluAlpha:s});f=reshape({inputs:{x:h},backend:r,attrs:{shape:n.outShape}}),m.push(u),m.push(c),m.push(h)}for(const g of m)r.disposeIntermediateTensorInfo(g);return f}function conv2dWithIm2Row({x:e,filter:t,convInfo:n,backend:r,bias:a=null,preluActivationWeights:i=null,leakyreluAlpha:s=0,activation:o=null}){const{filterWidth:l,filterHeight:u,inChannels:c,outWidth:h,outHeight:d,dataFormat:p}=n,f="channelsLast"===p,m=l*u*c,g=d*h,y=[n.batchSize,m,g],v=[];if(null!=i){const e=getShapeForBatchMatMul(i.shape,f);null!=e&&(i=reshape({inputs:{x:i},backend:r,attrs:{shape:e}}),v.push(i))}if(null!=a){const e=getShapeForBatchMatMul(a.shape,f);null!=e&&(a=reshape({inputs:{x:a},backend:r,attrs:{shape:e}}),v.push(a))}const b=reshape({inputs:{x:t},backend:r,attrs:{shape:[1,m,sizeFromShape(t.shape)/m]}});v.push(b);const x=new Im2ColPackedProgram(y,n),T=[e.shape,[n.padInfo.top,n.padInfo.left],[n.strideHeight,n.strideWidth],[n.dilationHeight,n.dilationWidth],[n.inChannels],[n.filterWidth*n.inChannels],[n.outWidth]],_=r.runWebGLProgram(x,[e],"float32",T),w=reshape({inputs:{x:_},backend:r,attrs:{shape:y}});v.push(_),v.push(w);const S=null!=a,C=null!=i,E="leakyrelu"===o,k=o?mapActivationToShaderProgram(o,!0):null,I=new MatMulPackedProgram(f?w.shape:b.shape,f?b.shape:w.shape,f?[n.batchSize,g,n.outChannels]:[n.batchSize,n.outChannels,g],!0,!1,S,k,C,E),A=f?[w,b]:[b,w];if(a&&A.push(a),C&&A.push(i),E){const e=r.makeTensorInfo([],"float32",createScalarValue(s,"float32"));A.push(e),v.push(e)}const N=r.runWebGLProgram(I,A,"float32"),$=reshape({inputs:{x:N},backend:r,attrs:{shape:n.outShape}});v.push(N);for(const D of v)r.disposeIntermediateTensorInfo(D);return $}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function conv2d(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i}=t,{strides:s,pad:o,dataFormat:l,dilations:u,dimRoundingMode:c}=r,h=convertConv2DDataFormat(l),d=computeConv2DInfo(a.shape,i.shape,s,u,o,c,!1,h);let p;if(1!==d.filterHeight||1!==d.filterWidth||1!==d.dilationHeight||1!==d.dilationWidth||1!==d.strideHeight||1!==d.strideWidth||"SAME"!==d.padInfo.type&&"VALID"!==d.padInfo.type)if(d.strideWidth<=2&&"channelsLast"===h&&env().getBool("WEBGL_EXP_CONV")){const e=new Conv2DPackedProgram(d),t=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];p=n.runWebGLProgram(e,[a,i],"float32",t)}else if(env().getBool("WEBGL_CONV_IM2COL"))p=conv2dWithIm2Row({x:a,filter:i,convInfo:d,backend:n});else{const e=new Conv2DProgram(d);p=n.runWebGLProgram(e,[a,i],"float32")}else p=conv2dByMatMul({x:a,filter:i,convInfo:d,backend:n});const f=reshape({inputs:{x:p},backend:n,attrs:{shape:d.outShape}});return n.disposeIntermediateTensorInfo(p),f}const conv2DConfig={kernelName:Conv2D$1,backendName:"webgl",kernelFunc:conv2d};
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class Conv2DDerFilterProgram{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,a=e.padInfo.left,i="channelsLast"===e.dataFormat;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ${e.batchSize}; b++) {\n          for (int yR = 0; yR < ${e.outHeight}; yR++) {\n            int xR = wR + yR * ${t} - ${r};\n\n            if (xR < 0 || xR >= ${e.inHeight}) {\n              continue;\n            }\n\n            for (int yC = 0; yC < ${e.outWidth}; yC++) {\n              int xC = wC + yC * ${n} - ${a};\n\n              if (xC < 0 || xC >= ${e.inWidth}) {\n                continue;\n              }\n\n              ${i?"float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);":"float dyValue = getDy(b, d2, yR, yC);\n              float xValue = getX(b, d1, xR, xC);\n              dotProd += (xValue * dyValue);"}\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class Conv2DDerInputProgram{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,i="channelsLast"===e.dataFormat,s=t-1-e.padInfo.top,o=n-1-e.padInfo.left,l=i?1:2,u=i?2:3,c=i?3:1;this.userCode=`\n      const ivec2 pads = ivec2(${s}, ${o});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[${c}];\n\n        ivec2 dyCorner = ivec2(coords[${l}], coords[${u}]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${t}; wR++) {\n          float dyR = float(dyRCorner + wR) / ${r}.0;\n\n          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ${t} - 1 - wR;\n\n          for (int wC = 0; wC < ${n}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${a}.0;\n\n            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ${n} - 1 - wC;\n\n            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {\n\n              if (${i}) {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class Conv3DDerFilterProgram{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,a=e.padInfo.front,i=e.padInfo.top,s=e.padInfo.left;this.userCode=`\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ${e.batchSize}; b++) {\n          for (int yF = 0; yF < ${e.outDepth}; yF++) {\n            int xF = wF + yF * ${t} - ${a};\n\n            if (xF < 0 || xF >= ${e.inDepth}) {\n              continue;\n            }\n\n            for (int yR = 0; yR < ${e.outHeight}; yR++) {\n              int xR = wR + yR * ${n} - ${i};\n\n              if (xR < 0 || xR >= ${e.inHeight}) {\n                continue;\n              }\n\n              for (int yC = 0; yC < ${e.outWidth}; yC++) {\n                int xC = wC + yC * ${r} - ${s};\n\n                if (xC < 0 || xC >= ${e.inWidth}) {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class Conv3DDerInputProgram{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,a=e.strideDepth,i=e.strideHeight,s=e.strideWidth,o=t-1-e.padInfo.front,l=n-1-e.padInfo.top,u=r-1-e.padInfo.left;this.userCode=`\n      const ivec3 pads = ivec3(${o}, ${l}, ${u});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ${t}; wF++) {\n          float dyF = float(dyFCorner + wF) / ${a}.0;\n\n          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = ${t} - 1 - wF;\n\n          for (int wR = 0; wR < ${n}; wR++) {\n            float dyR = float(dyRCorner + wR) / ${i}.0;\n\n            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = ${n} - 1 - wR;\n\n            for (int wC = 0; wC < ${r}; wC++) {\n              float dyC = float(dyCCorner + wC) / ${s}.0;\n\n              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = ${r} - 1 - wC;\n\n              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function conv2DBackpropFilter(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,dy:i}=t,{strides:s,pad:o,dataFormat:l,dimRoundingMode:u,filterShape:c}=r,h=convertConv2DDataFormat(l),d=computeConv2DInfo(a.shape,c,s,1,o,u,!1,h),p=new Conv2DDerFilterProgram(d);return n.runWebGLProgram(p,[a,i],"float32")}const conv2DBackpropFilterConfig={kernelName:Conv2DBackpropFilter,backendName:"webgl",kernelFunc:conv2DBackpropFilter};
/**
     * @license
     * Copyright 2023 Google LLC.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class Conv2DDerInputPackedProgram{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=useShapeUniforms(this.outputShape.length);const t=e.filterHeight,n=e.filterWidth,r=t-1-e.padInfo.top,a=n-1-e.padInfo.left;this.userCode=`\n      const ivec2 pads = ivec2(${r}, ${a});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n\n        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        vec4 result = vec4(0.);\n        for (int wR = 0; wR < ${t}; wR++) {\n          float dyR = float(dyRCorner + wR) / strides[0];\n          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n          int wRPerm = ${t} - 1 - wR;\n\n          for (int wC = 0; wC < ${n}; wC++) {\n            int wCPerm = ${n} - 1 - wC;\n\n            float dyC = float(dyCCorner + wC) / strides[1];\n            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)\n              && (fract(dyC) == 0.0);\n            int idyC = int(dyC);\n\n            float dyC2 = float(dyCCorner + wC + 1) / strides[1];\n            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)\n              && (fract(dyC2) == 0.0);\n            int idyC2 = int(dyC2);\n\n            if (idyCVal && idyCVal2) {\n              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {\n                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);\n                vec4 dySample = getDy(batch, idyR, idyC, d2);\n                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?\n                  dySample : getDy(batch, idyR, idyC2, d2);\n\n                vec2 dyValue = mod(float(idyC), 2.) == 0. ?\n                  dySample.xy : dySample.zw;\n                result.xy += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n\n                dyValue = mod(float(idyC2), 2.) == 0. ?\n                  dySample2.xy : dySample2.zw;\n                result.zw += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n              }\n            } else if (idyCVal) {\n              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {\n                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);\n                vec4 dySample = getDy(batch, idyR, idyC, d2);\n                vec2 dyValue = mod(float(idyC), 2.) == 0. ?\n                  dySample.xy : dySample.zw;\n                result.xy += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n              }\n            } else if (idyCVal2) {\n              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {\n                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);\n                vec4 dySample = getDy(batch, idyR, idyC2, d2);\n                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?\n                  dySample.xy : dySample.zw;\n                result.zw += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n              }\n            }\n          }\n        }\n        setOutput(result);\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function conv2DBackpropInput(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:i}=t,{inputShape:s,strides:o,pad:l,dataFormat:u,dimRoundingMode:c}=r,h=convertConv2DDataFormat(u),d=computeConv2DInfo(s,i.shape,o,1,l,c,!1,h);if(env().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&"channelsLast"===h){const e=[[d.strideHeight,d.strideWidth]],t=new Conv2DDerInputPackedProgram(d);return n.runWebGLProgram(t,[a,i],"float32",e)}{const e=new Conv2DDerInputProgram(d);return n.runWebGLProgram(e,[a,i],"float32")}}const conv2DBackpropInputConfig={kernelName:Conv2DBackpropInput,backendName:"webgl",kernelFunc:conv2DBackpropInput};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function conv3D(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i}=t,{strides:s,pad:o,dilations:l}=r,u=computeConv3DInfo(a.shape,i.shape,s,l,o),c=new Conv3DProgram(u);return n.runWebGLProgram(c,[a,i],"float32")}const conv3DConfig={kernelName:Conv3D$1,backendName:"webgl",kernelFunc:conv3D};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function conv3DBackpropFilterV2(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,dy:i}=t,{strides:s,pad:o,filterShape:l}=r,u=computeConv3DInfo(a.shape,l,s,1,o),c=new Conv3DDerFilterProgram(u);return n.runWebGLProgram(c,[a,i],"float32")}const conv3DBackpropFilterV2Config={kernelName:Conv3DBackpropFilterV2,backendName:"webgl",kernelFunc:conv3DBackpropFilterV2};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function conv3DBackpropInput(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:i}=t,{pad:s,strides:o,inputShape:l}=r,u=computeConv3DInfo(l,i.shape,o,1,s),c=new Conv3DDerInputProgram(u);return n.runWebGLProgram(c,[a,i],"float32")}const conv3DBackpropInputConfig={kernelName:Conv3DBackpropInputV2,backendName:"webgl",kernelFunc:conv3DBackpropInput},COS=CHECK_NAN_SNIPPET_UNARY+"\n  return cos(x);\n",COS_PACKED=`\n  vec4 result = cos(x);\n  bvec4 isNaN = isnan(x);\n  ${CHECK_NAN_SNIPPET_PACKED}\n  return result;\n`,cos=unaryKernelFunc({opSnippet:COS,packedOpSnippet:COS_PACKED}),cosConfig={kernelName:Cos,backendName:"webgl",kernelFunc:cos},COSH="\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n",cosh=unaryKernelFunc({opSnippet:COSH}),coshConfig={kernelName:Cosh,backendName:"webgl",kernelFunc:cosh};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
class CropAndResizeProgram{constructor(e,t,n,r,a){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[i,s,o,l]=e,[u]=t,[c,h]=n;this.outputShape=[u,c,h,l];const d="bilinear"===r?1:0,[p,f]=[s-1+".0",o-1+".0"],[m,g,y]=c>1?[""+(s-1)/(c-1),"(y2-y1) * height_ratio",`y1*${p} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${p}`],[v,b,x]=h>1?[""+(o-1)/(h-1),"(x2-x1) * width_ratio",`x1*${f} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${f}`];this.userCode=`\n      const float height_ratio = float(${m});\n      const float width_ratio = float(${v});\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ${i}) {\n          return;\n        }\n\n        float height_scale = ${g};\n        float width_scale = ${b};\n\n        float in_y = ${y};\n        if( in_y < 0.0 || in_y > ${p} ) {\n          setOutput(float(${a}));\n          return;\n        }\n        float in_x = ${x};\n        if( in_x < 0.0 || in_x > ${f} ) {\n          setOutput(float(${a}));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(${d} == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const cropAndResize=e=>{const{inputs:t,backend:n,attrs:r}=e,{image:a,boxes:i,boxInd:s}=t,{cropSize:o,method:l,extrapolationValue:u}=r,c=new CropAndResizeProgram(a.shape,i.shape,o,l,u);return n.runWebGLProgram(c,[a,i,s],"float32")},cropAndResizeConfig={kernelName:CropAndResize,backendName:"webgl",kernelFunc:cropAndResize};var CumOpType,CumOpType2;CumOpType2=CumOpType||(CumOpType={}),CumOpType2.Prod="*",CumOpType2.Sum="+";class CumProgram{constructor(e,t,n,r){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const a=this.outputShape.length,i=this.op===CumOpType.Prod?"1.0":"0.0",s=n?i:`getX(${getCoords(a,"coords",this.op)})`,o=this.outputShape[this.outputShape.length-1];let l="",u="";n?(l=r?"end != "+(o-1):"end != 0",u=r?"end + 1":"end - 1"):(l=r?`end + pow2 < ${o}`:"end >= pow2",u=r?"end + pow2":"end - pow2"),this.userCode=`\n      void main() {\n        ${getCoordsDataType(a)} coords = getOutputCoords();\n        int end = ${getFinalCoord(a,"coords",this.op)};\n        float val = ${s};\n        int pow2 = int(pow(2.0, index));\n        if (${l}) {\n          int idx = ${u};\n          ${getFinalCoord(a,"coords",this.op)} = idx;\n          val ${this.op}= getX(${getCoords(a,"coords",this.op)});\n        }\n        setOutput(val);\n      }\n    `}}function getCoords(e,t,n){if(1===e)return`${t}`;if(2===e)return`${t}.x, ${t}.y`;if(3===e)return`${t}.x, ${t}.y, ${t}.z`;if(4===e)return`${t}.x, ${t}.y, ${t}.z, ${t}.w`;throw new Error(`Cumulative ${n} for rank ${e} is not yet supported`)}function getFinalCoord(e,t,n){if(1===e)return`${t}`;if(2===e)return`${t}.y`;if(3===e)return`${t}.z`;if(4===e)return`${t}.w`;throw new Error(`Cumulative ${n} for rank ${e} is not yet supported`)}
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function cumImpl(e,t,n,r,a,i){const s=t.shape.length,o=getAxesPermutation([r],s);let l=t;null!=o&&(l=transpose({inputs:{x:t},backend:n,attrs:{perm:o}}));const u=getInnerMostAxes(1,s)[0];if(u!==s-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${t.shape.length-1} but got axis=${r}`);const c=l.shape[u];let h=identity({inputs:{x:l},backend:n});for(let d=0;d<=Math.ceil(Math.log2(c))-1;d++){const t=new CumProgram(e,l.shape,!1,i),r=[[d]],a=h;h=n.runWebGLProgram(t,[h],h.dtype,r),n.disposeIntermediateTensorInfo(a)}if(a){const t=new CumProgram(e,l.shape,a,i),r=h;h=n.runWebGLProgram(t,[h],h.dtype),n.disposeIntermediateTensorInfo(r)}if(null!=o){const e=transpose({inputs:{x:h},backend:n,attrs:{perm:getUndoAxesPermutation(o)}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(l),e}return h}
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function cumprod(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,exclusive:s,reverse:o}=r;return cumImpl(CumOpType.Prod,a,n,i,s,o)}const cumprodConfig={kernelName:Cumprod,backendName:"webgl",kernelFunc:cumprod};
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function cumsum(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,exclusive:s,reverse:o}=r;return cumImpl(CumOpType.Sum,a,n,i,s,o)}const cumsumConfig={kernelName:Cumsum,backendName:"webgl",kernelFunc:cumsum};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function denseBincount(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,weights:i}=t,{size:s,binaryOutput:o}=r;if(1===a.shape.length){const e=n.readSync(a.dataId),t=n.readSync(i.dataId),r=bincountImplCPU(e,t,i.dtype,i.shape,s);return n.makeTensorInfo([s],i.dtype,r)}if(2===a.shape.length){const e=n.bufferSync(a),t=n.bufferSync(i),r=bincountReduceImplCPU(e,t,s,o);return n.makeTensorInfo(r.shape,i.dtype,r.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${a.shape.length}.`)}const denseBincountConfig={kernelName:DenseBincount,backendName:"webgl",kernelFunc:denseBincount};
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class DepthToSpaceProgram{constructor(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode=`\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = ${this.getHeightCoordString()};\n      int w = ${this.getWidthCoordString()};\n      int d = ${this.getDepthCoordString()};\n\n      int in_h = h / ${t};\n      int offset_h = imod(h, ${t});\n      int in_w = w / ${t};\n      int offset_w = imod(w, ${t});\n      int offset_d = (offset_h * ${t} + offset_w) *\n        ${this.getOutputDepthSize()};\n      int in_d = d + offset_d;\n\n      float result = ${this.getInputSamplingString()};\n      setOutput(result);\n    }\n  `}getHeightCoordString(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}getWidthCoordString(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}getDepthCoordString(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}getOutputDepthSize(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function depthToSpace(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockSize:i,dataFormat:s}=r,o=a.shape[0],l=("NHWC"===s?a.shape[1]:a.shape[2])*i,u=("NHWC"===s?a.shape[2]:a.shape[3])*i,c=("NHWC"===s?a.shape[3]:a.shape[1])/(i*i),h=new DepthToSpaceProgram("NHWC"===s?[o,l,u,c]:[o,c,l,u],i,s);return n.runWebGLProgram(h,[a],a.dtype)}const depthToSpaceConfig={kernelName:DepthToSpace,backendName:"webgl",kernelFunc:depthToSpace};
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class DepthwiseConv2DProgram{constructor(e,t=!1,n=null,r=!1,a=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=useShapeUniforms(this.outputShape.length);const i=e.filterHeight,s=e.filterWidth,o=e.outChannels/e.inChannels;let l="",u="";n&&(l=r?`float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:a?`float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`\n          float activation(float x) {\n            ${n}\n          }\n        `,u="result = activation(result);");const c=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${l}\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ${o};\n        int q = d2 - d1 * ${o};\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ${i}; wR++) {\n          int xR = xRCorner + wR * dilations[0];\n\n          if (xR < 0 || xR >= inDims[0]) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${s}; wC++) {\n            int xC = xCCorner + wC * dilations[1];\n\n            if (xC < 0 || xC >= inDims[1]) {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ${c}\n        ${u}\n        setOutput(result);\n      }\n    `}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class DepthwiseConvPacked2DProgram{constructor(e,t=!1,n=null,r=!1,a=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=useShapeUniforms(this.outputShape.length);const i=e.outChannels/e.inChannels,s=e.padInfo.left,o=e.strideWidth,l=e.dilationWidth,u=e.filterHeight,c=e.filterWidth,h=c;let d="\n      int xR; int xC; int xCOffset;\n      vec4 wTexel; vec4 previous; vec4 final;";for(let g=0;g<c;g++)d+=`\n          vec4 xTexelC${2*g};\n          int xTexelC${2*g}Ready;\n          vec4 xTexelC${2*g+1};\n          int xTexelC${2*g+1}Ready;\n          vec4 xC${g};`;d+=`\n    for (int r = 0; r < ${u}; r++) {\n      `;for(let g=0;g<c;g++)d+=`\n          xTexelC${2*g} = vec4(0.0);\n          xTexelC${2*g}Ready = 0;\n          xTexelC${2*g+1} = vec4(0.0);\n          xTexelC${2*g+1}Ready = 0;\n          xC${g} = vec4(0.0);`;d+="\n        xR = xRCorner + r * dilations[0];\n        if (xR >=0 && xR < inDims[0]) {\n      ";for(let g=0;g<(h+1)/2;g++){const e=2*g;if(d+=`\n          xC = xCCorner + ${e*l};\n          `,1===o){if(e<c&&(s%2==1?(d+=`\n                xCOffset = xC + 1;\n                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${e}Ready == 0) {\n                  xTexelC${e} = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC${e}.zw = vec2(0.0);\n                  }\n                  xTexelC${e}Ready = 1;\n                }\n              `,d+=1===l&&e>0?`\n                xC${e} = vec4(xTexelC${e-2}.zw, xTexelC${e}.xy);\n                `:`\n                  xCOffset = xC + 1 - 2;\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                    previous = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      previous.zw = vec2(0.0);\n                    }\n\n                    xC${e} = vec4(previous.zw, xTexelC${e}.xy);\n                  } else {\n                    xC${e} = vec4(0.0, 0.0, xTexelC${e}.xy);\n                  }\n                  `):d+=`\n                if (xC >= 0 && xC < inDims[1] && xTexelC${e}Ready == 0) {\n                  xTexelC${e} = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC${e}.zw = vec2(0.0);\n                  }\n                  xTexelC${e}Ready = 1;\n                }\n\n                xC${e} = xTexelC${e};\n                `,e+1<c)){const t=s%2==0?nearestLargerEven(l):l;l%2==0&&s%2==1||l%2!=0&&s%2!=1?(d+=`\n                  xCOffset = xC + imod(pads[1], 2) + ${t};\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${e+1}Ready == 0) {\n                    xTexelC${e+1} = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      xTexelC${e+1}.zw = vec2(0.0);\n                    }\n                    xTexelC${e+1}Ready = 1;\n                  }\n                  `,d+=l>1?`\n                    xCOffset -= 2;\n                    if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n                     xC${e+1} = vec4(previous.zw, xTexelC${e+1}.xy);\n                    } else {\n                     xC${e+1} = vec4(0.0, 0.0, xTexelC${e+1}.xy);\n                    }\n                    `:`\n                    xC${e+1} = vec4(xTexelC${e}.zw, xTexelC${e+1}.xy);\n                    `):d+=1===t?`\n                    xC${e+1} = xTexelC${e};\n                    `:`\n                    xCOffset = xC + ${t};\n\n                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${e+1}Ready == 0) {\n                      xTexelC${e+1} = getX(batch, xR, xCOffset, d1);\n                      if (xCOffset + 1 >= inDims[1]) {\n                        xTexelC${e+1}.zw = vec2(0.0);\n                      }\n                      xTexelC${e+1}Ready = 1;\n                    }\n\n                    xC${e+1} = xTexelC${e+1};\n                    `}}else e<c&&(s%2==1?(d+=`\n                xCOffset = xC + 1 - strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${e}Ready == 0) {\n                  xTexelC${e} = getX(batch, xR, xCOffset, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC${e}.zw = vec2(0.0);\n                  }\n                  xTexelC${e}Ready = 1;\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${e+1}Ready == 0) {\n                  xTexelC${e+1} = getX(batch, xR, xC + 1, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xC + 2 >= inDims[1]) {\n                    xTexelC${e+1}.zw = vec2(0.0);\n                  }\n                  xTexelC${e+1}Ready = 1;\n                }\n\n                xC${e} = vec4(xTexelC${e}.zw, xTexelC${e+1}.zw);\n              `,e+1<c&&(d+=`\n                  final = vec4(0.0);\n                  xCOffset = xC + 1 + strides[1];\n                  if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xC${e+1} = vec4(xTexelC${e+1}.xy, final.xy);\n                `)):(d+=`\n                if(xC >= 0 && xC < inDims[1] && xTexelC${e}Ready == 0) {\n                  xTexelC${e} = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC${e}.zw = vec2(0.0);\n                  }\n                  xTexelC${e}Ready = 1;\n                }\n\n                xCOffset = xC + strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${e+1}Ready == 0) {\n                  xTexelC${e+1} = getX(batch, xR, xCOffset, d1);\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC${e+1}.zw = vec2(0.);\n                  }\n                  xTexelC${e+1}Ready = 1;\n                }\n\n                xC${e} = vec4(\n                  xTexelC${e}.xy, xTexelC${e+1}.xy);\n              `,e+1<c&&(d+=`\n                  xC${e+1} = vec4(xTexelC${e}.zw, xTexelC${e+1}.zw);\n                `)));e<c&&(d+=`\n            wTexel = getW(r, ${e}, d1, q);\n            dotProd += xC${e} * vec4(wTexel.xz, wTexel.xz);\n          `,e+1<c&&(d+=`\n              wTexel = getW(r, ${e+1}, d1, q);\n              dotProd += xC${e+1} * vec4(wTexel.xz, wTexel.xz);\n            `))}d+="\n    }\n  ",d+="\n      }\n    ";let p="",f="";n&&(p=r?`vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:a?`vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`vec4 activation(vec4 x) {\n          ${n}\n        }`,f="result = activation(result);");const m=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${p}\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ${i};\n        int q = d2 - d1 * ${i};\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n        vec4 dotProd = vec4(0.000000000000001);\n\n        ${d}\n\n        vec4 result = dotProd - vec4(0.000000000000001);\n        ${m}\n        ${f}\n        setOutput(result);\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function depthwiseConv2dNative(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i}=t,{strides:s,pad:o,dilations:l,dimRoundingMode:u}=r;let c=l;null==c&&(c=[1,1]),assert$1(eitherStridesOrDilationsAreOne(s,c),(()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${s} and dilations '${c}'`));const h=computeConv2DInfo(a.shape,i.shape,s,c,o,u,!0);let d;d=env().getBool("WEBGL_PACK_DEPTHWISECONV")&&h.strideWidth<=2&&h.outChannels/h.inChannels==1?new DepthwiseConvPacked2DProgram(h):new DepthwiseConv2DProgram(h);const p=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];return n.runWebGLProgram(d,[a,i],"float32",p)}const depthwiseConv2dNativeConfig={kernelName:DepthwiseConv2dNative,backendName:"webgl",kernelFunc:depthwiseConv2dNative};
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class DepthwiseConv2DDerFilterProgram{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,a=e.padInfo.left,i=e.outChannels/e.inChannels;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * ${i} + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < ${e.batchSize}; b++) {\n          for (int yR = 0; yR < ${e.outHeight}; yR++) {\n            int xR = wR + yR * ${t} - ${r};\n\n            if (xR < 0 || xR >= ${e.inHeight}) {\n              continue;\n            }\n\n            for (int yC = 0; yC < ${e.outWidth}; yC++) {\n              int xC = wC + yC * ${n} - ${a};\n\n              if (xC < 0 || xC >= ${e.inWidth}) {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class DepthwiseConv2DDerInputProgram{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,i=t-1-e.padInfo.top,s=n-1-e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode=`\n      const ivec2 pads = ivec2(${i}, ${s});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < ${t}; wR++) {\n          float dyR = float(dyRCorner + wR) / ${r}.0;\n\n          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ${t} - 1 - wR;\n\n          for (int wC = 0; wC < ${n}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${a}.0;\n\n            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ${n} - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < ${o}; dm++) {\n              int d2 = d1 * ${o} + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function depthwiseConv2dNativeBackpropFilter(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,dy:i}=t,{strides:s,dilations:o,pad:l,dimRoundingMode:u,filterShape:c}=r,h=computeConv2DInfo(a.shape,c,s,o,l,u,!0),d=new DepthwiseConv2DDerFilterProgram(h);return n.runWebGLProgram(d,[a,i],"float32")}const depthwiseConv2dNativeBackpropFilterConfig={kernelName:DepthwiseConv2dNativeBackpropFilter,backendName:"webgl",kernelFunc:depthwiseConv2dNativeBackpropFilter};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function depthwiseConv2dNativeBackpropInput(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:i}=t,{strides:s,dilations:o,pad:l,dimRoundingMode:u,inputShape:c}=r,h=computeConv2DInfo(c,i.shape,s,o,l,u,!0),d=new DepthwiseConv2DDerInputProgram(h);return n.runWebGLProgram(d,[a,i],"float32")}const depthwiseConv2dNativeBackpropInputConfig={kernelName:DepthwiseConv2dNativeBackpropInput,backendName:"webgl",kernelFunc:depthwiseConv2dNativeBackpropInput};
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class DiagProgram{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function diag(e){const{inputs:t,backend:n}=e,{x:r}=t,a=[...r.shape,...r.shape],i=sizeFromShape(r.shape),s=reshape({inputs:{x:r},backend:n,attrs:{shape:[i]}}),o=new DiagProgram(i),l=n.runWebGLProgram(o,[s],s.dtype),u=reshape({inputs:{x:l},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(l),u}const diagConfig={kernelName:Diag,backendName:"webgl",kernelFunc:diag};
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class Dilation2DProgram{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:t,inWidth:n,padInfo:r,strideHeight:a,strideWidth:i,filterHeight:s,filterWidth:o,dilationHeight:l,dilationWidth:u}=e,{top:c,left:h}=r;this.userCode=`\n      const ivec2 strides = ivec2(${a}, ${i});\n      const ivec2 pads = ivec2(${c}, ${h});\n      const float neg_infinity = -3.4e38;\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.w;\n        ivec2 outTopLeftCorner =\n            coords.yz * strides - pads;\n        int hBeg = outTopLeftCorner.x;\n        int wBeg = outTopLeftCorner.y;\n\n        float curVal = neg_infinity;\n        for (int h = 0; h < ${s}; h++) {\n          int hIn = hBeg + h * ${l};\n\n          if (hIn >= 0 && hIn < ${t}) {\n            for (int w = 0; w < ${o}; w++) {\n              int wIn = wBeg + w * ${u};\n\n              if (wIn >= 0 && wIn < ${n}) {\n                float xVal = getX(batch, hIn, wIn, d1);\n                float wVal = getW(h, w, d1);\n\n                float val = xVal + wVal;\n                if (val > curVal) {\n                  curVal = val;\n                }\n              }\n            }\n          }\n        }\n\n        float result = curVal;\n        setOutput(result);\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function dilation2D(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i}=t,{strides:s,pad:o,dilations:l}=r,u=computeDilation2DInfo(a.shape,i.shape,s,o,"NHWC",l);let c;const h=new Dilation2DProgram(u);c=n.runWebGLProgram(h,[a,i],"float32");const d=reshape({inputs:{x:c},backend:n,attrs:{shape:u.outShape}});return n.disposeIntermediateTensorInfo(c),d}const dilation2DConfig={kernelName:Dilation2D,backendName:"webgl",kernelFunc:dilation2D};
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function einsum(e){const{inputs:t,backend:n,attrs:r}=e,{equation:a}=r,i=t,{allDims:s,summedDims:o,idDims:l}=decodeEinsumEquation(a,i.length);checkEinsumDimSizes(s.length,l,i);const{path:u,steps:c}=getEinsumComputePath(o,l),h=c.length;let d=null,p=s.length;const f=[];for(let m=0;m<h;++m){for(const e of c[m]){const{permutationIndices:t,expandDims:r}=getEinsumPermutation(p,l[e]);let a;isIdentityPermutation(t)?a=i[e]:(a=transpose({inputs:{x:i[e]},backend:n,attrs:{perm:t}}),f.push(a));const s=a.shape.slice();for(let e=0;e<r.length;++e)s.splice(r[e],0,1);arraysEqual(a.shape,s)||(a=reshape({inputs:{x:a},backend:n,attrs:{shape:s}}),f.push(a)),null===d?d=a:(d=multiply({inputs:{a:a,b:d},backend:n}),f.push(d))}m<h-1&&(u[m]>=0&&(d=sum({inputs:{x:d},backend:n,attrs:{axis:u[m]-(s.length-p),keepDims:!1}}),f.push(d)),p--)}for(const m of f)m!==d&&n.disposeIntermediateTensorInfo(m);return d}const einsumConfig={kernelName:Einsum,backendName:"webgl",kernelFunc:einsum},ELU="return (x >= 0.0) ? x : (exp(x) - 1.0);",ELU_PACKED="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",elu=unaryKernelFunc({opSnippet:ELU,packedOpSnippet:ELU_PACKED}),eluConfig={kernelName:Elu$1,backendName:"webgl",kernelFunc:elu},ELU_DER="return (b >= 0.0) ? a : a * (b + 1.0);",ELU_DER_PACKED="\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",eluGrad=e=>{const{inputs:t,backend:n}=e,{dy:r,y:a}=t,i=env().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new BinaryOpPackedProgram(ELU_DER_PACKED,r.shape,a.shape):new BinaryOpProgram(ELU_DER,r.shape,a.shape);return n.runWebGLProgram(i,[r,a],r.dtype)},eluGradConfig={kernelName:EluGrad,backendName:"webgl",kernelFunc:eluGrad},PACKED_EQUAL="\n  return vec4(equal(a, b));\n",EQUAL="return float(a == b);",equal=binaryKernelFunc({opSnippet:EQUAL,packedOpSnippet:PACKED_EQUAL,dtype:"bool",cpuKernelImpl:equalImplCPU}),equalConfig={kernelName:Equal,backendName:"webgl",kernelFunc:equal},ERF=`\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = ${ERF_P};\n  float a1 = ${ERF_A1};\n  float a2 = ${ERF_A2};\n  float a3 = ${ERF_A3};\n  float a4 = ${ERF_A4};\n  float a5 = ${ERF_A5};\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n`,erf=unaryKernelFunc({opSnippet:ERF}),erfConfig={kernelName:Erf,backendName:"webgl",kernelFunc:erf},EXP=CHECK_NAN_SNIPPET_UNARY+"\n  return exp(x);\n",EXP_PACKED="\n  vec4 result = exp(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",exp=unaryKernelFunc({opSnippet:EXP,packedOpSnippet:EXP_PACKED,cpuKernelImpl:expImplCPU,dtype:"float32"}),expConfig={kernelName:Exp,backendName:"webgl",kernelFunc:exp};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the License);
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an AS IS BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function expandDims(e){const{inputs:t,attrs:n,backend:r}=e,{dim:a}=n,{input:i}=t,s=i.shape.length,o=i.shape.slice();let l=a;return a<0&&(assert$1(-(s+1)<=a,(()=>`Axis must be in the interval [${-(s+1)}, ${s}]`)),l=s+a+1),o.splice(l,0,1),reshape({inputs:{x:i},backend:r,attrs:{shape:o}})}const expandDimsConfig={kernelName:ExpandDims,backendName:"webgl",kernelFunc:expandDims},EXPM1="return exp(x) - 1.0;",expm1=unaryKernelFunc({opSnippet:EXPM1,packedOpSnippet:EXPM1,cpuKernelImpl:expm1ImplCPU}),expm1Config={kernelName:Expm1,backendName:"webgl",kernelFunc:expm1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
class FFTProgram{constructor(e,t,n){this.variableNames=["real","imag"];const r=t[1];this.outputShape=t;const a=n?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,i=n?`${r}.0`:"1.0";let s;if("real"===e)s="return real * expR - imag * expI;";else{if("imag"!==e)throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);s="return real * expI + imag * expR;"}this.userCode=`\n      const float exponentMultiplier = ${a};\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        ${s}\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float(${r});\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < ${r}; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / ${i};\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function fftImpl(e,t,n){const r=n.texData.get(e.dataId),a=sizeFromShape(e.shape),i=e.shape[e.shape.length-1],s=reshape({inputs:{x:e},backend:n,attrs:{shape:[a/i,i]}}),o=s.shape,l=new FFTProgram("real",o,t),u=new FFTProgram("imag",o,t),c=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:o},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:o}],h=n.runWebGLProgram(l,c,"float32"),d=n.runWebGLProgram(u,c,"float32"),p=complex({inputs:{real:h,imag:d},backend:n});n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d);const f=reshape({inputs:{x:p},backend:n,attrs:{shape:e.shape}});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(p),f}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function fft(e){const{inputs:t,backend:n}=e,{input:r}=t;return fftImpl(r,!1,n)}const fftConfig={kernelName:FFT,backendName:"webgl",kernelFunc:fft};
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class FillProgram{constructor(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode="\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function fill(e){const{backend:t,attrs:n}=e,{shape:r,value:a}=n;let{dtype:i}=n;if(i=i||inferDtype(a),"string"===i){const e=getArrayFromDType(i,sizeFromShape(r));return e.fill(a),t.makeTensorInfo(r,i,e)}{const e=new FillProgram(r,a),n=[[a]];return t.runWebGLProgram(e,[],i,n)}}const fillConfig={kernelName:Fill,backendName:"webgl",kernelFunc:fill};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class FlipLeftRightProgram{constructor(e){this.variableNames=["Image"],this.outputShape=[];const t=e[2];this.outputShape=e,this.userCode=`\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n\n          int coordX = ${t} - x - 1;\n          float outputValue;\n          if(coordX >= 0 && coordX < ${t}) {\n            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);\n          } else {\n            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const flipLeftRightConfig={kernelName:FlipLeftRight,backendName:"webgl",kernelFunc:({inputs:e,backend:t})=>{const{image:n}=e,r=t,a=new FlipLeftRightProgram(n.shape);return r.runWebGLProgram(a,[n],n.dtype)}},FLOOR="return floor(x);",floor=unaryKernelFunc({opSnippet:FLOOR,packedOpSnippet:FLOOR,cpuKernelImpl:floorImplCPU}),floorConfig={kernelName:Floor,backendName:"webgl",kernelFunc:floor},INT_DIV="\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",INT_DIV_PACKED="\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n",floorDiv=binaryKernelFunc({opSnippet:INT_DIV,packedOpSnippet:INT_DIV_PACKED,dtype:"int32"}),floorDivConfig={kernelName:FloorDiv,backendName:"webgl",kernelFunc:floorDiv};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
class FromPixelsProgram{constructor(e){this.variableNames=["A"];const t=getGlslDifferences(),[n,r]=e;this.outputShape=e,this.userCode=`\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${n}.0);\n\n        vec4 values = ${t.texture2D}(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    `}}
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class FromPixelsPackedProgram{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const t=getGlslDifferences(),[n,r]=e;this.outputShape=e,this.userCode=`\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2(${r}.0, ${n}.0);\n            vec4 values = ${t.texture2D}(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        ${t.output} = result;\n      }\n    `}}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const fromPixelsConfig={kernelName:FromPixels,backendName:"webgl",kernelFunc:fromPixels};let fromPixels2DContext,willReadFrequently=env().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function fromPixels(e){const{inputs:t,backend:n,attrs:r}=e;let{pixels:a}=t;const{numChannels:i}=r,s="undefined"!=typeof HTMLVideoElement&&a instanceof HTMLVideoElement,o="undefined"!=typeof HTMLImageElement&&a instanceof HTMLImageElement,[l,u]=s?[a.videoWidth,a.videoHeight]:[a.width,a.height],c=[u,l],h=[u,l,i];if(o||s){const e=env().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");null!=fromPixels2DContext&&e===willReadFrequently||(willReadFrequently=e,fromPixels2DContext=document.createElement("canvas").getContext("2d",{willReadFrequently:willReadFrequently})),fromPixels2DContext.canvas.width=l,fromPixels2DContext.canvas.height=u,fromPixels2DContext.drawImage(a,0,0,l,u),a=fromPixels2DContext.canvas}const d=n.makeTensorInfo(c,"int32");n.texData.get(d.dataId).usage=TextureUsage.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(d.dataId),a);const p=env().getBool("WEBGL_PACK")?new FromPixelsPackedProgram(h):new FromPixelsProgram(h),f=n.runWebGLProgram(p,[d],"int32");return n.disposeData(d.dataId),f}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function fusedConv2d(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i,bias:s,preluActivationWeights:o}=t,{strides:l,pad:u,dataFormat:c,dilations:h,dimRoundingMode:d,activation:p,leakyreluAlpha:f}=r,m=convertConv2DDataFormat(c),g=computeConv2DInfo(a.shape,i.shape,l,h,u,d,!1,m);let y;const v=[],b=null!=s,x=null!=o,T="leakyrelu"===p,_=()=>{const e=[a,i],t=(e,t)=>{if("NCHW"===t&&1===e.shape.length&&1!==e.shape[0]){const t=reshape({inputs:{x:e},backend:n,attrs:{shape:[e.shape[0],1,1]}});return v.push(t),t}return e};if(b&&e.push(t(s,c)),x&&e.push(t(o,c)),T){const t=n.makeTensorInfo([],"float32",createScalarValue(f,"float32"));e.push(t),v.push(t)}return e};if(1!==g.filterHeight||1!==g.filterWidth||1!==g.dilationHeight||1!==g.dilationWidth||1!==g.strideHeight||1!==g.strideWidth||"SAME"!==g.padInfo.type&&"VALID"!==g.padInfo.type)if(g.strideWidth<=2&&"channelsLast"===m&&env().getBool("WEBGL_EXP_CONV")){const e=p?mapActivationToShaderProgram(p,!0):null,t=new Conv2DPackedProgram(g,b,e,x,T),r=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],a=_();y=n.runWebGLProgram(t,a,"float32",r)}else if(env().getBool("WEBGL_CONV_IM2COL"))y=conv2dWithIm2Row({x:a,filter:i,convInfo:g,backend:n,bias:s,activation:p,preluActivationWeights:o,leakyreluAlpha:f});else{const e=p?mapActivationToShaderProgram(p,!1):null,t=new Conv2DProgram(g,b,e,x,T),r=_();y=n.runWebGLProgram(t,r,"float32")}else y=conv2dByMatMul({x:a,filter:i,convInfo:g,backend:n,bias:s,activation:p,preluActivationWeights:o,leakyreluAlpha:f});const w=reshape({inputs:{x:y},backend:n,attrs:{shape:g.outShape}});return v.push(y),v.forEach((e=>n.disposeIntermediateTensorInfo(e))),w}const fusedConv2DConfig={kernelName:FusedConv2D,backendName:"webgl",kernelFunc:fusedConv2d};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function fusedDepthwiseConv2D(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i,bias:s,preluActivationWeights:o}=t,{strides:l,pad:u,dilations:c,dimRoundingMode:h,activation:d,leakyreluAlpha:p}=r,f=[];let m=c;null==m&&(m=[1,1]),assert$1(eitherStridesOrDilationsAreOne(l,m),(()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${m}'`));const g=computeConv2DInfo(a.shape,i.shape,l,m,u,h,!0),y=env().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels==1,v=d?mapActivationToShaderProgram(d,y):null,b=[a,i],x=null!=s,T=null!=o,_="leakyrelu"===d;if(x&&b.push(s),T&&b.push(o),_){const e=n.makeTensorInfo([],"float32",createScalarValue(p,"float32"));b.push(e),f.push(e)}let w;w=y?new DepthwiseConvPacked2DProgram(g,x,v,T,_):new DepthwiseConv2DProgram(g,x,v,T,_);const S=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],C=n.runWebGLProgram(w,b,"float32",S);return f.forEach((e=>n.disposeIntermediateTensorInfo(e))),C}const fusedDepthwiseConv2DConfig={kernelName:FusedDepthwiseConv2D,backendName:"webgl",kernelFunc:fusedDepthwiseConv2D};class GatherNDProgram{constructor(e,t,n,r){this.sliceDim=e,this.strides=t,this.paramsShape=r,this.variableNames=["x","indices"],this.outputShape=n;const a=getCoordsDataType(n.length);let i="\n    int index;";for(let s=0;s<this.sliceDim;s++)i+=`\n          index = round(getIndices(coords[0], ${s}));\n          out_of_bounds = out_of_bounds || index < 0;\n          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[s]};\n          flattenIndex += index * ${this.strides[s]};`;this.userCode=`\n         void main() {\n          ${a} coords = getOutputCoords();\n          int flattenIndex = 0;\n          bool out_of_bounds = false;\n\n          ${i}\n\n          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));\n        }\n      `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function gatherNd(e){const{inputs:t,backend:n}=e,{params:r,indices:a}=t,i=a.shape,s=i[i.length-1],o=sizeFromShape(r.shape),[l,u,c,h]=prepareAndValidate(r,a),d=reshape({inputs:{x:a},backend:n,attrs:{shape:[u,s]}}),p=reshape({inputs:{x:r},backend:n,attrs:{shape:[sizeFromShape(r.shape)/c,c]}});if(n.shouldExecuteOnCPU([r,a])||"string"===r.dtype){const e=n.readSync(a.dataId),t=n.bufferSync(r),i=gatherNdImplCPU(e,t,r.dtype,u,s,c,h,r.shape,o);return n.makeTensorInfo(l,r.dtype,i.values)}const f=new GatherNDProgram(s,h,[u,c],r.shape),m=n.runWebGLProgram(f,[p,d],p.dtype),g=reshape({inputs:{x:m},backend:n,attrs:{shape:l}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),g}const gatherNdConfig={kernelName:GatherNd,backendName:"webgl",kernelFunc:gatherNd};
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class GatherProgram{constructor(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;const n=getCoordsDataType(this.rank),r=getSourceCoords$1(e);this.userCode=`\n      void main() {\n        ${n} resRC = getOutputCoords();\n        int index = int(getIndices(resRC.x, resRC.z));\n        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;\n        setOutput(inBounds * getA(${r}));\n      }\n    `}}function getSourceCoords$1(e,t){const n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[];for(let a=0;a<e.length;a++)2===a?r.push("index"):r.push(`${n[a]}`);return r.join()}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function gatherV2(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,indices:i}=t,{axis:s,batchDims:o}=r,l=parseAxisParam(s,a.shape)[0];if(env().get("DEBUG")){const e=n.readSync(i.dataId),t=a.shape[l];for(let n=0;n<e.length;++n){const r=e[n];assert$1(r<=t-1&&r>=0,(()=>`GatherV2: the index value ${r} is not in [0, ${t-1}]`))}}const u=collectGatherOpShapeInfo(a,i,l,o),c=sizeFromShape(i.shape),h=[],d=reshape({inputs:{x:a},backend:n,attrs:{shape:[u.batchSize,u.outerSize,u.dimSize,u.sliceSize]}}),p=reshape({inputs:{x:i},backend:n,attrs:{shape:[u.batchSize,c/u.batchSize]}});h.push(d),h.push(p);const f=[u.batchSize,u.outerSize,c/u.batchSize,u.sliceSize];if(n.shouldExecuteOnCPU([a,i])||"string"===a.dtype){const e=n.bufferSync(p),t=n.bufferSync(d),r=gatherV2ImplCPU(t,e,f);return h.forEach((e=>n.disposeIntermediateTensorInfo(e))),n.makeTensorInfo(u.outputShape,r.dtype,r.values)}const m=new GatherProgram(d.shape,f),g=n.runWebGLProgram(m,[d,p],d.dtype);h.push(g);const y=reshape({inputs:{x:g},backend:n,attrs:{shape:u.outputShape}});return h.forEach((e=>n.disposeIntermediateTensorInfo(e))),y}const gatherV2Config={kernelName:GatherV2,backendName:"webgl",kernelFunc:gatherV2},GREATER="return float(a > b);",GREATER_PACKED="\n  return vec4(greaterThan(a, b));\n",greater=binaryKernelFunc({opSnippet:GREATER,packedOpSnippet:GREATER_PACKED,cpuKernelImpl:greaterImplCPU,dtype:"bool"}),greaterConfig={kernelName:Greater,backendName:"webgl",kernelFunc:greater},GREATER_EQUAL="return float(a >= b);",GREATER_EQUAL_PACKED="\n  return vec4(greaterThanEqual(a, b));\n",greaterEqual=binaryKernelFunc({opSnippet:GREATER_EQUAL,packedOpSnippet:GREATER_EQUAL_PACKED,dtype:"bool",cpuKernelImpl:greaterEqualImplCPU}),greaterEqualConfig={kernelName:GreaterEqual,backendName:"webgl",kernelFunc:greaterEqual};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function ifft(e){const{inputs:t,backend:n}=e,{input:r}=t;return fftImpl(r,!0,n)}const ifftConfig={kernelName:IFFT,backendName:"webgl",kernelFunc:ifft},IS_FINITE="return float(!isnan(x) && !isinf(x));",isFinite$1=unaryKernelFunc({opSnippet:IS_FINITE,dtype:"bool"}),isFiniteConfig={kernelName:IsFinite,backendName:"webgl",kernelFunc:isFinite$1},IS_INF="return float(isinf(x));",isInf=unaryKernelFunc({opSnippet:IS_INF,dtype:"bool"}),isInfConfig={kernelName:IsInf,backendName:"webgl",kernelFunc:isInf},IS_NAN="return float(isnan(x));",isNaN$1=unaryKernelFunc({opSnippet:IS_NAN,dtype:"bool"}),isNaNConfig={kernelName:IsNan,backendName:"webgl",kernelFunc:isNaN$1},LESS="return float(a < b);",LESS_PACKED="\n  return vec4(lessThan(a, b));\n",less=binaryKernelFunc({opSnippet:LESS,packedOpSnippet:LESS_PACKED,cpuKernelImpl:lessImplCPU,dtype:"bool"}),lessConfig={kernelName:Less,backendName:"webgl",kernelFunc:less},LESS_EQUAL="return float(a <= b);",LESS_EQUAL_PACKED="\n  return vec4(lessThanEqual(a, b));\n",lessEqual=binaryKernelFunc({opSnippet:LESS_EQUAL,packedOpSnippet:LESS_EQUAL_PACKED,cpuKernelImpl:lessEqualImplCPU,dtype:"bool"}),lessEqualConfig={kernelName:LessEqual,backendName:"webgl",kernelFunc:lessEqual};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function linSpace(e){const{backend:t,attrs:n}=e,{start:r,stop:a,num:i}=n,s=linSpaceImplCPU(r,a,i);return t.makeTensorInfo([s.length],"float32",s)}const linSpaceConfig={kernelName:LinSpace,backendName:"webgl",kernelFunc:linSpace},LOG=CHECK_NAN_SNIPPET_UNARY+"\n  return x < 0.0 ? 0./0. : log(x);\n",LOG_PACKED="\n  vec4 result = log(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);\n  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);\n  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);\n  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);\n  return result;\n",log$2=unaryKernelFunc({opSnippet:LOG,packedOpSnippet:LOG_PACKED,cpuKernelImpl:logImplCPU}),logConfig={kernelName:Log,backendName:"webgl",kernelFunc:log$2},LOG1P=CHECK_NAN_SNIPPET_UNARY+"\n  return log(1.0 + x);\n",log1p=unaryKernelFunc({opSnippet:LOG1P}),log1pConfig={kernelName:Log1p,backendName:"webgl",kernelFunc:log1p},LOGICAL_AND="return float(a >= 1.0 && b >= 1.0);",LOGICAL_AND_PACKED="\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n",logicalAnd=binaryKernelFunc({opSnippet:LOGICAL_AND,packedOpSnippet:LOGICAL_AND_PACKED,dtype:"bool"}),logicalAndConfig={kernelName:LogicalAnd,backendName:"webgl",kernelFunc:logicalAnd},LOGICAL_NOT="return float(!(x >= 1.0));",logicalNot=unaryKernelFunc({opSnippet:LOGICAL_NOT}),logicalNotConfig={kernelName:LogicalNot,backendName:"webgl",kernelFunc:logicalNot},LOGICAL_OR="return float(a >= 1.0 || b >= 1.0);",LOGICAL_OR_PACKED="\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n",logicalOr=binaryKernelFunc({opSnippet:LOGICAL_OR,packedOpSnippet:LOGICAL_OR_PACKED,dtype:"bool"}),logicalOrConfig={kernelName:LogicalOr,backendName:"webgl",kernelFunc:logicalOr};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
class LRNProgram{constructor(e,t,n,r,a){this.variableNames=["x"],this.outputShape=[];const i=t,s=e[3]-1;let o;this.outputShape=e;const l=`float(${n}) + float(${r}) * sum`;o=.5===a?`inversesqrt(${l})`:1===a?`1.0/(${l})`:`exp(log(${l}) * float(-${a}));`,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -${i}; j <= ${i}; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  ${s}) {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * ${o};\n        setOutput(val);\n      }\n    `}}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class LRNPackedProgram{constructor(e,t,n,r,a){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const i=t,s=e[3]-1;let o;this.outputShape=e;const l=`float(${n}) + float(${r}) * sum`;o=.5===a?`inversesqrt(${l})`:1===a?`1.0/(${l})`:`exp(log(${l}) * float(-${a}));`,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < ${this.outputShape[3]};\n        bool hasNextRow = c < ${this.outputShape[2]};\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - ${i};\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - ${i}; j <= ${i}; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${s}));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * ${o};\n        setOutput(result);\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const lrn=e=>{const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{depthRadius:i,bias:s,alpha:o,beta:l}=r,u=env().getBool("WEBGL_PACK_NORMALIZATION")?new LRNPackedProgram(a.shape,i,s,o,l):new LRNProgram(a.shape,i,s,o,l);return n.runWebGLProgram(u,[a],a.dtype)},LRNConfig={kernelName:LRN,backendName:"webgl",kernelFunc:lrn};
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
class LRNGradProgram{constructor(e,t,n,r,a){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=r,this.beta=a,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < ${this.depth}; ++d) {\n          int depthBegin = int(max(0.0, float(d - ${t})));\n          int depthEnd = int(min(float(${this.depth}),\n              float(d + ${t} + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = ${this.depth};\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float(${r}) * norm + float(${n});\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float(${r})\n                * float(${a})\n                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * ${a});\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const lrnGrad=e=>{const{inputs:t,backend:n,attrs:r}=e,{x:a,y:i,dy:s}=t,{depthRadius:o,bias:l,alpha:u,beta:c}=r,h=new LRNGradProgram(a.shape,o,l,u,c);return n.runWebGLProgram(h,[a,i,s],a.dtype)},LRNGradConfig={kernelName:LRNGrad,backendName:"webgl",kernelFunc:lrnGrad};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function maxImpl(e,t,n,r){const a=sizeFromShape(t),i=reshape({inputs:{x:e},attrs:{shape:[sizeFromShape(e.shape)/a,a]},backend:r}),s=reduce$1(i,e.dtype,"max",r),o=reshape({inputs:{x:s},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(s),o}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function max(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{reductionIndices:i,keepDims:s}=r,o=a.shape.length,l=parseAxisParam(i,a.shape);let u=l;const c=getAxesPermutation(u,o),h=null!=c,d=n.shouldExecuteOnCPU([a]);let p=a;if(h){if(d){const e=n.texData.get(p.dataId).values,t=new Array(o);for(let n=0;n<t.length;n++)t[n]=a.shape[c[n]];const r=transposeImplCPU(e,a.shape,a.dtype,c,t);p=n.makeTensorInfo(t,a.dtype);n.texData.get(p.dataId).values=r}else p=transposeImpl(a,c,n);u=getInnerMostAxes(u.length,o)}assertAxesAreInnerMostDims("max",u,o);const[f,m]=computeOutAndReduceShapes(p.shape,u);let g,y=f;if(s&&(y=expandShapeToKeepDim(f,l)),d){const e=n.texData.get(p.dataId).values,t=maxImplCPU(e,sizeFromShape(m),y,a.dtype);g=n.makeTensorInfo(y,a.dtype);n.texData.get(g.dataId).values=t}else g=maxImpl(p,m,y,n);return h&&n.disposeIntermediateTensorInfo(p),g}const maxConfig={kernelName:Max,backendName:"webgl",kernelFunc:max},MAXIMUM=CHECK_NAN_SNIPPET+"\n  return max(a, b);\n",MAXIMUM_PACKED="\n  vec4 result = vec4(max(a, b));\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+CHECK_NAN_SNIPPET_PACKED+"\n  return result;\n",maximum=binaryKernelFunc({opSnippet:MAXIMUM,packedOpSnippet:MAXIMUM_PACKED,cpuKernelImpl:maximumImplCPU}),maximumConfig={kernelName:Maximum$1,backendName:"webgl",kernelFunc:maximum};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function maxPool(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t;assertNotComplex(a,"maxPool");const{filterSize:i,strides:s,pad:o,dimRoundingMode:l}=r;assert$1(eitherStridesOrDilationsAreOne(s,1),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${s} and dilations '1'`));const u=computePool2DInfo(a.shape,i,s,1,o,l);if(1===u.filterWidth&&1===u.filterHeight&&arraysEqual(u.inShape,u.outShape))return identity({inputs:{x:a},backend:n});const c=new Pool2DProgram(u,"max",!1);return n.runWebGLProgram(c,[a],a.dtype)}const maxPoolConfig={kernelName:MaxPool,backendName:"webgl",kernelFunc:maxPool};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function maxPool3d(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{filterSize:i,strides:s,pad:o,dataFormat:l,dimRoundingMode:u}=r,c=computePool3DInfo(a.shape,i,s,[1,1,1],o,u,l),h=new Pool3DProgram(c,"max",!1);return n.runWebGLProgram(h,[a],a.dtype)}const maxPool3DConfig={kernelName:MaxPool3D,backendName:"webgl",kernelFunc:maxPool3d};
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class MaxPool2DBackpropProgram{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideHeight,n=e.strideWidth,r=e.dilationHeight,a=e.effectiveFilterHeight,i=e.effectiveFilterWidth,s=a-1-e.padInfo.top,o=i-1-e.padInfo.left,l=a*i-1;this.userCode=`\n      const ivec2 pads = ivec2(${s}, ${o});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${a};\n          wR += ${r}) {\n          float dyR = float(dyRCorner + wR) / ${t}.0;\n\n          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ${i}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${n}.0;\n\n            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = ${l} - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * ${i} + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class MaxPool3DBackpropProgram{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,a=e.dilationDepth,i=e.dilationHeight,s=e.dilationWidth,o=e.effectiveFilterDepth,l=e.effectiveFilterHeight,u=e.effectiveFilterWidth,c=o-1-e.padInfo.front,h=l-1-e.padInfo.top,d=u-1-e.padInfo.left,p=o*l*u-1;this.userCode=`\n      const ivec3 pads = ivec3(${c}, ${h}, ${d});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ${o};\n           wD += ${a}) {\n          float dyD = float(dyDCorner + wD) / ${t}.0;\n\n          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ${l};\n              wR += ${i}) {\n            float dyR = float(dyRCorner + wR) / ${n}.0;\n\n            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ${u};\n                wC += ${s}) {\n              float dyC = float(dyCCorner + wC) / ${r}.0;\n\n              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = ${p} -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * ${l} * ${u} +\n                  wR * ${u} + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function maxPool3DGrad(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,input:i}=t,s=i,{filterSize:o,strides:l,pad:u,dimRoundingMode:c}=r,h=computePool3DInfo(s.shape,o,l,[1,1,1],u,c),d=new Pool3DProgram(h,"max",!0),p=n.runWebGLProgram(d,[s],s.dtype),f=new MaxPool3DBackpropProgram(h),m=n.runWebGLProgram(f,[a,p],s.dtype);return n.disposeIntermediateTensorInfo(p),m}const maxPool3DGradConfig={kernelName:MaxPool3DGrad,backendName:"webgl",kernelFunc:maxPool3DGrad};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function maxPoolGrad(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,input:i,output:s}=t,o=i;assertNotComplex([i,s],"maxPoolGrad");const{filterSize:l,strides:u,pad:c,dimRoundingMode:h}=r,d=computePool2DInfo(o.shape,l,u,1,c,h),p=new Pool2DProgram(d,"max",!0),f=n.runWebGLProgram(p,[o],o.dtype),m=new MaxPool2DBackpropProgram(d),g=n.runWebGLProgram(m,[a,f],o.dtype);return n.disposeIntermediateTensorInfo(f),g}const maxPoolGradConfig={kernelName:MaxPoolGrad,backendName:"webgl",kernelFunc:maxPoolGrad};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function maxPoolWithArgmaxImpl(e,t,n,r){let a=new Pool2DProgram(n,"max",!1);const i=r.runWebGLProgram(a,[e],"float32");a=new Pool2DProgram(n,"max",!0,!0,t);return[i,r.runWebGLProgram(a,[e],"float32")]}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const maxPoolWithArgmaxConfig={kernelName:MaxPoolWithArgmax,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{x:r}=e,{filterSize:a,strides:i,pad:s,includeBatchInIndex:o}=t,l=n;assert$1(4===r.shape.length,(()=>`Error in maxPool: input must be rank 4 but got rank ${r.shape.length}.`));const u=[1,1];assert$1(eitherStridesOrDilationsAreOne(i,u),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`));const c=computePool2DInfo(r.shape,a,i,u,s),[h,d]=maxPoolWithArgmaxImpl(r,o,c,l);return[h,d]}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function meanImpl(e,t,n,r){const a=sizeFromShape(t),i=reshape({inputs:{x:e},attrs:{shape:[sizeFromShape(e.shape)/a,a]},backend:r}),s=reduce$1(i,"float32","mean",r),o=reshape({inputs:{x:s},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(s),o}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const meanConfig={kernelName:Mean,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{x:r}=e,{keepDims:a,axis:i}=t,s=n,o=r.shape.length,l=parseAxisParam(i,r.shape);let u=l;const c=getAxesPermutation(u,o),h=null!=c,d=s.shouldExecuteOnCPU([r]),p=[];let f=r;if(h){if(d){const e=s.texData.get(f.dataId).values,t=new Array(o);for(let a=0;a<t.length;a++)t[a]=r.shape[c[a]];const n=transposeImplCPU(e,r.shape,r.dtype,c,t);f=s.makeTensorInfo(t,r.dtype);s.texData.get(f.dataId).values=n}else f=transposeImpl(r,c,s);p.push(f),u=getInnerMostAxes(u.length,o)}assertAxesAreInnerMostDims("sum",u,o);const[m,g]=computeOutAndReduceShapes(f.shape,u);let y=m;a&&(y=expandShapeToKeepDim(m,l));const v=meanImpl(f,g,y,s);for(const b of p)s.disposeIntermediateTensorInfo(b);return v}};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function min(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:s}=r,o=a.shape.length,l=parseAxisParam(i,a.shape);let u=l;const c=getAxesPermutation(u,o);let h=a;null!=c&&(h=transpose({inputs:{x:a},backend:n,attrs:{perm:c}}),u=getInnerMostAxes(u.length,a.shape.length)),assertAxesAreInnerMostDims("min",u,o);const[d,p]=computeOutAndReduceShapes(h.shape,u),f=reshape({inputs:{x:h},backend:n,attrs:{shape:[-1,sizeFromShape(p)]}}),m=reduce$1(f,f.dtype,"min",n);let g;if(s){g=reshape({inputs:{x:m},backend:n,attrs:{shape:expandShapeToKeepDim(d,l)}})}else g=reshape({inputs:{x:m},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),null!=c&&n.disposeIntermediateTensorInfo(h),g}const minConfig={kernelName:Min,backendName:"webgl",kernelFunc:min},MINIMUM=CHECK_NAN_SNIPPET+"\n  return min(a, b);\n",MINIMUM_PACKED="\n  vec4 result = vec4(min(a, b));\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+CHECK_NAN_SNIPPET_PACKED+"\n  return result;\n",minimum=binaryKernelFunc({opSnippet:MINIMUM,packedOpSnippet:MINIMUM_PACKED,cpuKernelImpl:minimumImplCPU}),minimumConfig={kernelName:Minimum$1,backendName:"webgl",kernelFunc:minimum};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
class MirrorPadProgram{constructor(e,t,n){this.variableNames=["x"],this.outputShape=t.map(((t,n)=>t[0]+e[n]+t[1]));const r=e.length,a=getCoordsDataType(r),i=t.map((e=>e[0])).join(","),s=t.map(((t,n)=>t[0]+e[n])).join(","),o=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),l="reflect"===n?0:1;this.userCode=1!==r?`\n      ${a} start = ${a}(${i});\n      ${a} end = ${a}(${s});\n\n      void main() {\n        ${a} outC = getOutputCoords();\n        for (int i = 0; i < ${r}; i++) {\n          if (outC[i] < start[i]) {\n            outC[i] = start[i] * 2 - outC[i] - ${l};\n          } else if(outC[i] >= end[i]) {\n            outC[i] = (end[i] - 1) * 2 - outC[i] + ${l};\n          }\n        }\n        ${a} coords = outC - start;\n        setOutput(getX(${o}));\n      }\n    `:`\n        int start = ${i};\n        int end = ${s};\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start) {\n            outC = start * 2 - outC - ${l};\n          } else if(outC >= end) {\n            outC = (end - 1) * 2 - outC + ${l};\n          }\n          setOutput(getX(outC - start));\n        }\n      `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class MirrorPadPackedProgram{constructor(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map(((t,n)=>t[0]+e[n]+t[1]));const r=e.length,a=getCoordsDataType(r),i=t.map((e=>e[0])).join(","),s=t.map(((t,n)=>t[0]+e[n])).join(","),o=getChannels("rc",r),l=getChannels("source",r),u=`${o[r-1]} < ${this.outputShape[r-1]}`,c=1===r?"source":`vec2(${l.slice(-2).join()})`,h="reflect"===n?0:1;let d="";if(1===r){const e=`\n        ${a} source = rc;\n        if (source < start) {\n          source = start * 2 - source - ${h};\n        } else if (source >= end) {\n          source = (end - 1) * 2 - source + ${h};\n        }\n        source -= start;\n      `;d=`\n        ${a} rc = outputLoc;\n        ${e}\n        result[0] = getChannel(getX(${l.join()}), ${c});\n        ${o[r-1]} += 1;\n        if(${u}) {\n          ${e}\n          result[1] = getChannel(getX(${l.join()}), ${c});\n        }\n      `}else{const e=`\n        ${a} source = rc;\n        ${a} lt = ${a}(lessThan(source, start));\n        ${a} gte = ${a}(greaterThanEqual(source, end));\n        ${a} orig = 1 - (lt + gte);\n        source = orig * source +\n                lt * (start * 2 - source - ${h}) +\n                gte * ((end - 1) * 2 - source + ${h});\n        source -= start;\n      `;d=`\n        ${a} rc = outputLoc;\n        ${e}\n        result[0] = getChannel(getX(${l.join()}), ${c});\n        ${o[r-1]} += 1;\n        if(${u}) {\n          ${e}\n          result[1] = getChannel(getX(${l.join()}), ${c});\n        }\n        rc = outputLoc;\n        ${o[r-2]} += 1;\n        if(${o[r-2]} < ${this.outputShape[r-2]}) {\n          ${e}\n          result[2] = getChannel(getX(${l.join()}), ${c});\n          ${o[r-1]} += 1;\n          if(${u}) {\n            ${e}\n            result[3] = getChannel(getX(${l.join()}), ${c});\n          }\n        }\n      `}this.userCode=`\n      const ${a} start = ${a}(${i});\n      const ${a} end = ${a}(${s});\n\n      void main() {\n        ${a} outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ${d}\n        setOutput(result);\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const mirrorPadKernelFunc=({inputs:e,backend:t,attrs:n})=>{const{x:r}=e,{paddings:a,mode:i}=n,s=env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new MirrorPadPackedProgram(r.shape,a,i):new MirrorPadProgram(r.shape,a,i);return t.runWebGLProgram(s,[r],r.dtype)},mirrorPadConfig={kernelName:MirrorPad,backendName:"webgl",kernelFunc:mirrorPadKernelFunc},MOD="if (b == 0.0) return NAN;\n  return mod(a, b);",MOD_PACKED="\n  vec4 result = mod(a, b);\n  bvec4 isNaN = equal(b, vec4(0.0));\n  "+CHECK_NAN_SNIPPET_PACKED+"\n  return result;\n",mod=binaryKernelFunc({opSnippet:MOD,packedOpSnippet:MOD_PACKED}),modConfig={kernelName:Mod,backendName:"webgl",kernelFunc:mod};
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
class MultinomialProgram{constructor(e,t,n){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,n],this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < ${t-1}; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float(${t-1}));\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const DIV="\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",DIV_PACKED="\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",realDiv=binaryKernelFunc({opSnippet:DIV,packedOpSnippet:DIV_PACKED,checkOutOfBounds:!0}),realDivConfig={kernelName:RealDiv,backendName:"webgl",kernelFunc:realDiv},SUB="return a - b;",sub=binaryKernelFunc({opSnippet:SUB,packedOpSnippet:SUB,supportsComplex:!0,cpuKernelImpl:subImplCPU}),subConfig={kernelName:Sub,backendName:"webgl",kernelFunc:sub};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function softmax(e){const{inputs:t,backend:n,attrs:r}=e,{logits:a}=t,{dim:i}=r,s=parseAxisParam([i],a.shape),o=max({inputs:{x:a},backend:n,attrs:{reductionIndices:s,keepDims:!1}}),l=expandShapeToKeepDim(o.shape,s),u=reshape({inputs:{x:o},backend:n,attrs:{shape:l}}),c=sub({inputs:{a:a,b:u},backend:n}),h=exp({inputs:{x:c},backend:n}),d=sum({inputs:{x:h},backend:n,attrs:{axis:s,keepDims:!1}}),p=reshape({inputs:{x:d},backend:n,attrs:{shape:l}}),f=realDiv({inputs:{a:h,b:p},backend:n});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),f}const softmaxConfig={kernelName:Softmax$2,backendName:"webgl",kernelFunc:softmax};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function multinomial(e){const{inputs:t,backend:n,attrs:r}=e,{logits:a}=t,{numSamples:i,seed:s,normalized:o}=r,l=o?a:softmax({inputs:{logits:a},backend:n,attrs:{dim:a.shape.length-1}}),u=l.shape[0],c=l.shape[1],h=new MultinomialProgram(u,c,i),d=[[s]],p=n.runWebGLProgram(h,[l],"int32",d);return o||n.disposeIntermediateTensorInfo(l),p}const multinomialConfig={kernelName:Multinomial,backendName:"webgl",kernelFunc:multinomial},NEG=CHECK_NAN_SNIPPET$1+"\n  return -x;\n",NEG_PACKED="\n  vec4 result = -x;\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n";
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function neg(e){const{inputs:t,backend:n}=e,{x:r}=t;if(n.shouldExecuteOnCPU([r])){const e=n.texData.get(r.dataId),[t,a]=negImplCPU(e.values,r.shape,r.dtype);return n.makeTensorInfo(a,r.dtype,t)}let a;return a=env().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new UnaryOpPackedProgram(r.shape,NEG_PACKED):new UnaryOpProgram(r.shape,NEG),n.runWebGLProgram(a,[r],r.dtype)}const negConfig={kernelName:Neg,backendName:"webgl",kernelFunc:neg},nonMaxSuppressionV3Impl=nonMaxSuppressionV3Impl$2;
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function nonMaxSuppressionV3(e){warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:i}=t,{maxOutputSize:s,iouThreshold:o,scoreThreshold:l}=r,u=n.readSync(a.dataId),c=n.readSync(i.dataId),{selectedIndices:h}=nonMaxSuppressionV3Impl(u,c,s,o,l);return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}const nonMaxSuppressionV3Config={kernelName:NonMaxSuppressionV3,backendName:"webgl",kernelFunc:nonMaxSuppressionV3},nonMaxSuppressionV4Impl=nonMaxSuppressionV4Impl$2;
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function nonMaxSuppressionV4(e){warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:i}=t,{maxOutputSize:s,iouThreshold:o,scoreThreshold:l,padToMaxOutputSize:u}=r,c=n.readSync(a.dataId),h=n.readSync(i.dataId),{selectedIndices:d,validOutputs:p}=nonMaxSuppressionV4Impl(c,h,s,o,l,u);return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([],"int32",new Int32Array([p]))]}const nonMaxSuppressionV4Config={kernelName:NonMaxSuppressionV4,backendName:"webgl",kernelFunc:nonMaxSuppressionV4},nonMaxSuppressionV5Impl=nonMaxSuppressionV5Impl$2;
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function nonMaxSuppressionV5(e){warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:i}=t,{maxOutputSize:s,iouThreshold:o,scoreThreshold:l,softNmsSigma:u}=r,c=n.readSync(a.dataId),h=n.readSync(i.dataId),d=s,p=o,f=l,m=u,{selectedIndices:g,selectedScores:y}=nonMaxSuppressionV5Impl(c,h,d,p,f,m);return[n.makeTensorInfo([g.length],"int32",new Int32Array(g)),n.makeTensorInfo([y.length],"float32",new Float32Array(y))]}const nonMaxSuppressionV5Config={kernelName:NonMaxSuppressionV5,backendName:"webgl",kernelFunc:nonMaxSuppressionV5};
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class OneHotProgram{constructor(e,t,n,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float(${r}), float(${n}),\n                      float(index == coords.y)));\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const oneHot=e=>{const{inputs:t,backend:n,attrs:r}=e,{indices:a}=t,{dtype:i,depth:s,onValue:o,offValue:l}=r,u=sizeFromShape(a.shape),c=new OneHotProgram(u,s,o,l),h=reshape({inputs:{x:a},backend:n,attrs:{shape:[u]}}),d=n.runWebGLProgram(c,[h],i);n.disposeIntermediateTensorInfo(h);const p=reshape({inputs:{x:d},backend:n,attrs:{shape:[...a.shape,s]}});return n.disposeIntermediateTensorInfo(d),p},oneHotConfig={kernelName:OneHot,backendName:"webgl",kernelFunc:oneHot};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function zerosLike(e){const{inputs:t,backend:n}=e,{x:r}=t;if("complex64"===r.dtype){const e=real({inputs:{input:r},backend:n}),t=zerosLike({inputs:{x:e},backend:n}),a=imag({inputs:{input:r},backend:n}),i=zerosLike({inputs:{x:a},backend:n}),s=complex({inputs:{real:t,imag:i},backend:n});return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(i),s}return fill({attrs:{shape:r.shape,dtype:r.dtype,value:"string"===r.dtype?"":0},backend:n})}const zerosLikeConfig={kernelName:ZerosLike,backendName:"webgl",kernelFunc:zerosLike};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function onesLike(e){const{inputs:t,backend:n}=e,{x:r}=t;if("string"===r.dtype)throw new Error("onesLike is not supported under string dtype");if("complex64"===r.dtype){const e=real({inputs:{input:r},backend:n}),t=onesLike({inputs:{x:e},backend:n}),a=imag({inputs:{input:r},backend:n}),i=zerosLike({inputs:{x:a},backend:n}),s=complex({inputs:{real:t,imag:i},backend:n});return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(i),s}return fill({attrs:{shape:r.shape,dtype:r.dtype,value:1},backend:n})}const onesLikeConfig={kernelName:OnesLike,backendName:"webgl",kernelFunc:onesLike};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function pack(e){const{inputs:t,backend:n,attrs:r}=e,{axis:a}=r;if(1===t.length)return expandDims({inputs:{input:t[0]},backend:n,attrs:{dim:a}});const i=t[0].shape,s=t[0].dtype;t.forEach((e=>{assertShapesMatch(i,e.shape,"All tensors passed to stack must have matching shapes"),assert$1(s===e.dtype,(()=>"All tensors passed to stack must have matching dtypes"))}));const o=[],l=t.map((e=>{const t=expandDims({inputs:{input:e},backend:n,attrs:{dim:a}});return o.push(t),t})),u=concat({inputs:l,backend:n,attrs:{axis:a}});return o.forEach((e=>n.disposeIntermediateTensorInfo(e))),u}const packConfig={kernelName:Pack,backendName:"webgl",kernelFunc:pack};
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class PadProgram{constructor(e,t,n){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map(((t,n)=>t[0]+e[n]+t[1]));const r=e.length,a=getCoordsDataType(r),i=t.map((e=>e[0])).join(","),s=t.map(((t,n)=>t[0]+e[n])).join(","),o=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?`\n      ${a} start = ${a}(${i});\n      ${a} end = ${a}(${s});\n\n      void main() {\n        ${a} outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(value);\n        } else {\n          ${a} coords = outC - start;\n          setOutput(getX(${o}));\n        }\n      }\n    `:`\n        int start = ${i};\n        int end = ${s};\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(value);\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      `}}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class PadPackedProgram{constructor(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map(((t,n)=>t[0]+e[n]+t[1]));const r=e.length,a=getCoordsDataType(r),i=t.map((e=>e[0])).join(","),s=t.map(((t,n)=>t[0]+e[n])).join(","),o=getChannels("rc",r),l=getChannels("source",r),u=`${o[r-1]} < ${this.outputShape[r-1]}`,c=1===r?"source":`vec2(${l.slice(-2).join()})`,h=[`${a} rc = outputLoc;`,`${o[r-1]} += 1;\n       if(${u}) {\n      `,1===r?"":`}\n       rc = outputLoc;\n       ${o[r-2]} += 1;\n       if(${o[r-2]} < ${this.outputShape[r-2]}) {`,1===r?"":`  ${o[r-1]} += 1;\n         if(${u}) {`],d=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let p="";for(let f=0,m=1===r?2:4;f<m;f++)p+=`\n        ${h[f]}\n        if (${d}) {\n          result[${f}] = float(value);\n        } else {\n          ${a} source = rc - start;\n          result[${f}] = getChannel(getX(${l.join()}), ${c});\n        }\n      `;p+=1===r?"} ":"}}",this.userCode=`\n      const ${a} start = ${a}(${i});\n      const ${a} end = ${a}(${s});\n\n      void main() {\n        ${a} outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ${p}\n        setOutput(result);\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const padV2=e=>{const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{paddings:i,constantValue:s}=r;if(0===sizeFromShape(a.shape)){return fill({backend:n,attrs:{shape:i.map(((e,t)=>e[0]+a.shape[t]+e[1])),value:s,dtype:a.dtype}})}const o=env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new PadPackedProgram(a.shape,i,s):new PadProgram(a.shape,i,s),l=[[s]];return n.runWebGLProgram(o,[a],a.dtype,l)},padV2Config={kernelName:PadV2,backendName:"webgl",kernelFunc:padV2},POW="\n  if(a < 0.0 && floor(b) < b){\n    return NAN;\n  }\n  if (b == 0.0) {\n    return 1.0;\n  }\n  return (round(mod(b, 2.0)) != 1) ?\n      pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",POW_PACKED="\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  bvec4 isNaN1 = lessThan(a, vec4(0.0));\n  bvec4 isNaN2 = lessThan(floor(b), b);\n  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);\n  "+CHECK_NAN_SNIPPET_PACKED+"\n  return result;\n",pow=binaryKernelFunc({opSnippet:POW,packedOpSnippet:POW_PACKED}),powConfig={kernelName:Pow,backendName:"webgl",kernelFunc:pow};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function prod(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:s}=r,o=a.shape.length,l=[],u=parseAxisParam(i,a.shape);let c=u;const h=getAxesPermutation(c,o);let d,p=a;if(null!=h&&(p=transpose({inputs:{x:a},backend:n,attrs:{perm:h}}),c=getInnerMostAxes(c.length,o),l.push(p)),assertAxesAreInnerMostDims("prod",c,o),n.shouldExecuteOnCPU([p])){const e=n.texData.get(p.dataId).values,{outVals:t,outShape:r,outDtype:a}=prodImplCPU(p.shape,p.dtype,e,c);d=n.makeTensorInfo(r,a,t)}else{const[e,t]=computeOutAndReduceShapes(p.shape,c),r=sizeFromShape(t),i=reshape({inputs:{x:p},backend:n,attrs:{shape:[-1,r]}}),s=reduce$1(i,sumOutType(a.dtype),"prod",n);d=reshape({inputs:{x:s},backend:n,attrs:{shape:e}}),l.push(i),l.push(s)}if(s){l.push(d);const e=expandShapeToKeepDim(d.shape,u);d=reshape({inputs:{x:d},backend:n,attrs:{shape:e}})}return l.forEach((e=>n.disposeIntermediateTensorInfo(e))),d}const prodConfig={kernelName:Prod,backendName:"webgl",kernelFunc:prod};
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function raggedGather(e){const{inputs:t,backend:n,attrs:r}=e,{paramsNestedSplits:a,paramsDenseValues:i,indices:s}=t,{outputRaggedRank:o}=r,l=a.map((e=>n.readSync(e.dataId))),u=a.map((e=>e.shape)),c=n.readSync(i.dataId),h=n.readSync(s.dataId),[d,p,f]=raggedGatherImplCPU(l,u,c,i.shape,i.dtype,h,s.shape,o),m=d.map((e=>n.makeTensorInfo([e.length],"int32",e))),g=n.makeTensorInfo(f,i.dtype,p);return m.concat([g])}const raggedGatherConfig={kernelName:RaggedGather,backendName:"webgl",kernelFunc:raggedGather};
/**
     * @license
     * Copyright 2022 Google LLC.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function raggedRange(e){const{inputs:t,backend:n}=e,{starts:r,limits:a,deltas:i}=t,s=n.readSync(r.dataId),o=n.readSync(a.dataId),l=n.readSync(i.dataId),[u,c]=raggedRangeImplCPU(s,r.shape,r.dtype,o,a.shape,l,i.shape);return[n.makeTensorInfo([u.length],"int32",u),n.makeTensorInfo([c.length],r.dtype,c)]}const raggedRangeConfig={kernelName:RaggedRange,backendName:"webgl",kernelFunc:raggedRange};
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function raggedTensorToTensor(e){const{inputs:t,backend:n,attrs:r}=e,{shape:a,values:i,defaultValue:s,rowPartitionTensors:o}=t,{rowPartitionTypes:l}=r,u=n.readSync(a.dataId),c=n.readSync(i.dataId),h=n.readSync(s.dataId),d=o.map((e=>n.readSync(e.dataId))),p=o.map((e=>e.shape)),[f,m]=raggedTensorToTensorImplCPU(u,a.shape,c,i.shape,i.dtype,h,s.shape,d,p,l);return n.makeTensorInfo(f,i.dtype,m)}const raggedTensorToTensorConfig={kernelName:RaggedTensorToTensor,backendName:"webgl",kernelFunc:raggedTensorToTensor},range$1=e=>{const{backend:t,attrs:n}=e,{start:r,stop:a,step:i,dtype:s}=n,o=rangeImplCPU(r,a,i,s);return t.makeTensorInfo([o.length],s,o)},rangeConfig={kernelName:Range,backendName:"webgl",kernelFunc:range$1},RECIPROCAL="return 1.0 / x;",reciprocal=unaryKernelFunc({opSnippet:RECIPROCAL}),reciprocalConfig={kernelName:Reciprocal,backendName:"webgl",kernelFunc:reciprocal},RELU=CHECK_NAN_SNIPPET$1+"\n  return (x < 0.0) ? 0.0 : x;\n",RELU_PACKED="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",relu=unaryKernelFunc({opSnippet:RELU,packedOpSnippet:RELU_PACKED}),reluConfig={kernelName:Relu$1,backendName:"webgl",kernelFunc:relu},RELU6=CHECK_NAN_SNIPPET$1+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",RELU6_PACKED="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",relu6=unaryKernelFunc({opSnippet:RELU6,packedOpSnippet:RELU6_PACKED}),relu6Config={kernelName:Relu6$1,backendName:"webgl",kernelFunc:relu6};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
class ResizeBilinearProgram{constructor(e,t,n,r,a){this.variableNames=["A"],this.outputShape=[];const[i,s,o,l]=e;this.outputShape=[i,t,n,l];const u=[r&&t>1?s-1:s,r&&n>1?o-1:o],c=[r&&t>1?t-1:t,r&&n>1?n-1:n];let h;h=a?"(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ${u[0]/c[0]},\n          ${u[1]/c[1]});\n      const vec2 inputShapeRC = vec2(${s}.0, ${o}.0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ${h};\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    `}}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class ResizeBilinearPackedProgram{constructor(e,t,n,r,a){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[i,s,o,l]=e;this.outputShape=[i,t,n,l];const u=[r&&t>1?s-1:s,r&&n>1?o-1:o],c=[r&&t>1?t-1:t,r&&n>1?n-1:n];let h;h=a?"(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ${u[0]/c[0]},\n          ${u[1]/c[1]},\n          ${u[1]/c[1]});\n      const vec3 inputShapeRC = vec3(${s}.0, ${o}.0,\n                                     ${o}.0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ${h};\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ${l-1};\n        bool hasNextRow = coords.z < ${n-1};\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function resizeBilinear(e){const{inputs:t,backend:n,attrs:r}=e,{images:a}=t,{alignCorners:i,halfPixelCenters:s,size:o}=r,[l,u]=o,c=env().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new ResizeBilinearPackedProgram(a.shape,l,u,i,s):new ResizeBilinearProgram(a.shape,l,u,i,s);return n.runWebGLProgram(c,[a],"float32")}const resizeBilinearConfig={kernelName:ResizeBilinear,backendName:"webgl",kernelFunc:resizeBilinear};
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class ResizeBilinearBackpropProgram{constructor(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,a]=t,[,i,s]=e,o=[n&&i>1?r-1:r,n&&s>1?a-1:a],l=[n&&i>1?i-1:i,n&&s>1?s-1:s],u=o[0]/l[0],c=o[1]/l[1],h=1/u,d=1/c,p=2*Math.ceil(h)+2,f=2*Math.ceil(d)+2;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(${u});\n        const float widthScale = float(${c});\n\n        const float invHeightScale = float(${h});\n        const float invWidthScale = float(${d});\n\n        const int winHeight = int(${p});\n        const int winWidth = int(${f});\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ${i}) {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ${s}) {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), ${a-1}.0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function resizeBilinearGrad(e){const{inputs:t,backend:n,attrs:r}=e,{images:a,dy:i}=t,{alignCorners:s}=r,o=new ResizeBilinearBackpropProgram(i.shape,a.shape,s);return n.runWebGLProgram(o,[i],i.dtype)}const resizeBilinearGradConfig={kernelName:ResizeBilinearGrad,backendName:"webgl",kernelFunc:resizeBilinearGrad};
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class ResizeNearestNeighborProgram{constructor(e,t,n,r,a){this.variableNames=["A"],this.outputShape=[];const[i,s,o,l]=e;this.outputShape=[i,t,n,l];const u=[r&&t>1?s-1:s,r&&n>1?o-1:o],c=[r&&t>1?t-1:t,r&&n>1?n-1:n],h=r?"0.5":"0.0";let d;d=a?"max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ${u[0]/c[0]},\n          ${u[1]/c[1]});\n      const vec2 inputShapeRC = vec2(${s}.0, ${o}.0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ${d};\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${h})));\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    `}}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class ResizeNearestNeighborPackedProgram{constructor(e,t,n,r,a){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[i,s,o,l]=e;this.outputShape=[i,t,n,l];const u=[r&&t>1?s-1:s,r&&n>1?o-1:o],c=[r&&t>1?t-1:t,r&&n>1?n-1:n],h=r?"0.5":"0.0";let d;d=a?"max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ${u[0]/c[0]},\n          ${u[1]/c[1]},\n          ${u[1]/c[1]});\n      const vec3 inputShapeRC = vec3(${s}.0, ${o}.0,\n                                     ${o}.0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ${d};\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec3 sourceNearestRC = ivec3(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${h})));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ${l-1};\n        bool hasNextRow = coords.z < ${n-1};\n\n        vec4 newValue = vec4(\n          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),\n          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);\n\n        setOutput(newValue);\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function resizeNearestNeighbor(e){const{inputs:t,backend:n,attrs:r}=e,{images:a}=t,{alignCorners:i,halfPixelCenters:s,size:o}=r,[l,u]=o,c=env().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new ResizeNearestNeighborPackedProgram(a.shape,l,u,i,s):new ResizeNearestNeighborProgram(a.shape,l,u,i,s);return n.runWebGLProgram(c,[a],a.dtype)}const resizeNearestNeighborConfig={kernelName:ResizeNearestNeighbor,backendName:"webgl",kernelFunc:resizeNearestNeighbor};
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class ResizeNearestNeigborBackpropProgram{constructor(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,a]=t,[,i,s]=e,o=[n&&i>1?r-1:r,n&&s>1?a-1:a],l=[n&&i>1?i-1:i,n&&s>1?s-1:s],u=o[0]/l[0],c=o[1]/l[1],h=1/u,d=1/c,p=2*Math.ceil(h)+2,f=2*Math.ceil(d)+2;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(${u});\n        const float widthScale = float(${c});\n\n        const float invHeightScale = float(${h});\n        const float invWidthScale = float(${d});\n\n        const int winHeight = int(${p});\n        const int winWidth = int(${f});\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ${i}) {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ${s}) {\n              continue;\n            }\n\n            float sourceFracRow =\n              float(${o[0]}) *\n                (float(dyR) / float(${l[0]}));\n\n            float sourceFracCol =\n                float(${o[1]}) *\n                  (float(dyC) / float(${l[1]}));\n\n            int sourceNearestRow = int(min(\n                float(int(${r}) - 1),\n                ${n} ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int(${a}) - 1),\n                ${n} ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function resizeNearestNeighborGrad(e){const{inputs:t,backend:n,attrs:r}=e,{images:a,dy:i}=t,{alignCorners:s}=r,o=new ResizeNearestNeigborBackpropProgram(i.shape,a.shape,s);return n.runWebGLProgram(o,[i],i.dtype)}const resizeNearestNeighborGradConfig={kernelName:ResizeNearestNeighborGrad,backendName:"webgl",kernelFunc:resizeNearestNeighborGrad};
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class ReverseProgram{constructor(e,t){this.variableNames=["x"];const n=e.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);if(this.outputShape=e,1===n)return void(this.userCode=`\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX(${e[0]} - coord - 1));\n        }\n      `);const r=e.map(((n,r)=>(n=>-1!==t.indexOf(n)&&1!==e[n]?`${e[n]} - coords[${n}] - 1`:`coords[${n}]`)(r))).join(","),a=getCoordsDataType(n);this.userCode=`\n      void main() {\n        ${a} coords = getOutputCoords();\n        setOutput(getX(${r}));\n      }\n    `}}
/**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class ReversePackedProgram{constructor(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const n=e.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);this.outputShape=e;const r=getChannels("rc",n),a=`${r[n-1]} + 1 < ${this.outputShape[n-1]}`,i=`${r[n-2]} + 1 < ${this.outputShape[n-2]}`,s=getCoordsDataType(n);var o;function l(n){const r=e.map(((r,a)=>function(n,r){return-1!==t.indexOf(n)&&1!==e[n]?`${e[n]} - ${r[n]} - 1`:`${r[n]}`}(a,n)));return`getChannel(getX(${r.join(",")}), vec2(${r.slice(-2).join(",")}))`}this.userCode=1===n?`\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX(${e[0]} - rc - 1),\n            ${e[0]} - rc - 1);\n          if(${a}){\n              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),\n                ${e[0]} - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      `:`\n        void main() {\n          ${s} rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = ${o=r.slice(),l(o)};\n          if(${a}){\n            result.g = ${function(e){return e[n-1]="("+e[n-1]+" + 1)",l(e)}(r.slice())};\n          }\n          if(${i}) {\n            result.b = ${function(e){return e[n-2]="("+e[n-2]+" + 1)",l(e)}(r.slice())};\n            if(${a}) {\n              result.a = ${function(e){return e[n-1]="("+e[n-1]+" + 1)",e[n-2]="("+e[n-2]+" + 1)",l(e)}(r.slice())};\n            }\n          }\n          setOutput(result);\n        }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function reverse(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{dims:i}=r,s=a.shape.length,o=parseAxisParam(i,a.shape);if(0===s)return identity({inputs:{x:a},backend:n});const l=env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new ReversePackedProgram(a.shape,o):new ReverseProgram(a.shape,o);return n.runWebGLProgram(l,[a],a.dtype)}const reverseConfig={kernelName:Reverse,backendName:"webgl",kernelFunc:reverse};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class RotateProgram{constructor(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const n=e[1],r=e[2];this.outputShape=e;let a="";a="number"==typeof t?`float outputValue = ${t.toFixed(2)};`:`\n        vec3 fill = vec3(${t.join(",")});\n        float outputValue = fill[coords[3]];`,this.userCode=`\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n          int y = coords[1];\n          float coordXFloat = (float(x) - params[0]) * params[3] -\n            (float(y) - params[1]) * params[2];\n          float coordYFloat = (float(x) - params[0]) * params[2] +\n            (float(y) - params[1]) * params[3];\n          int coordX = int(round(coordXFloat + params[0]));\n          int coordY = int(round(coordYFloat + params[1]));\n          ${a}\n          if(coordX >= 0 && coordX < ${r} && coordY >= 0 && coordY < ${n}) {\n            outputValue = getImage(coords[0], coordY, coordX, coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */const rotateWithOffsetConfig={kernelName:RotateWithOffset,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{image:r}=e,{radians:a,fillValue:i,center:s}=t,o=n,l=new RotateProgram(r.shape,i),[u,c]=getImageCenter(s,r.shape[1],r.shape[2]),h=[[u,c,Math.sin(a),Math.cos(a)]];return o.runWebGLProgram(l,[r],r.dtype,h)}},ROUND="\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n",round=unaryKernelFunc({opSnippet:ROUND}),roundConfig={kernelName:Round,backendName:"webgl",kernelFunc:round},RSQRT="return inversesqrt(x);",rsqrt=unaryKernelFunc({opSnippet:RSQRT,cpuKernelImpl:rsqrtImplCPU}),rsqrtConfig={kernelName:Rsqrt,backendName:"webgl",kernelFunc:rsqrt};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
class ScatterProgram{constructor(e,t,n,r,a,i,s=!0,o=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;const l=getCoordsDataType(a.length),u=getCoordsDataType(i.length);let c="";1===n?c="i":2===n&&(c="i, j");const h=`getIndices(${c})`;let d="";1===r?d="i":2===r&&(d="i, coords[1]");const p=`getUpdates(${d})`;let f="";o&&(f="coords[0], coords[1]");const m=`getDefaultValue(${f})`,g=t>1?"strides[j]":"strides";this.userCode=`\n        ${l} strides = ${l}(${a});\n\n        void main() {\n          ${u} coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < ${e}; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < ${t}; j++) {\n              int index = round(${h});\n              flattenedIndex += index * ${g};\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += ${p};\n              found = true;\n            }\n          }\n          setOutput(mix(${m}, sum, float(found)));\n        }\n      `}}
/**
     * @license
     * Copyright 2023 Google LLC.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class ScatterPackedProgram{constructor(e,t,n,r,a,i,s=!0,o=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=i;const l=getCoordsDataType(a.length),u=getCoordsDataType(i.length);let c="";1===n?c="i":2===n&&(c="i, j");const h=`getIndices(${c})`;let d="";1===r?d="i":2===r&&(d="i, coords[1]");const p=`getUpdates(${d})`;let f="";o&&(f="coords[0], coords[1]");const m=`getDefaultValue(${f})`,g=t>1?"strides[j]":"strides",y=t>1?"strides[j + 1]":"strides";this.userCode=`\n        ${l} strides = ${l}(${a});\n\n        void main() {\n          ${u} coords = getOutputCoords();\n          vec4 sum = vec4(0.);\n          vec4 found = vec4(0.);\n          for (int i = 0; i < ${e}; i+=2) {\n            ivec2 flattenedIndex = ivec2(0);\n            for (int j = 0; j < ${t}; j+=2) {\n              ivec4 index = round(${h});\n              flattenedIndex += index.xz * ${g};\n              if (j + 1 < ${t}) {\n                flattenedIndex += index.yw * ${y};\n              }\n            }\n            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||\n                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {\n              vec4 updVals = ${p};\n              if (flattenedIndex[0] == coords[0]) {\n                sum.xy += updVals.xy;\n                found.xy = vec2(1.);\n              } else if (flattenedIndex[0] == coords[0] + 1) {\n                sum.zw += updVals.xy;\n                found.zw = vec2(1.);\n              }\n              if (flattenedIndex[1] == coords[0]) {\n                sum.xy += updVals.zw;\n                found.xy = vec2(1.);\n              } else if (flattenedIndex[1] == coords[0] + 1) {\n                sum.zw += updVals.zw;\n                found.zw = vec2(1.);\n              }\n            }\n          }\n          setOutput(mix(${m}, sum, found));\n        }\n      `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function scatterNd(e){const{inputs:t,backend:n,attrs:r}=e,{indices:a,updates:i}=t,{shape:s}=r,{sliceRank:o,numUpdates:l,sliceSize:u,strides:c,outputSize:h}=calculateShapes(i,a,s),d=[h/u,u];if(0===h)return n.makeTensorInfo(s,a.dtype);const p=reshape({inputs:{x:a},backend:n,attrs:{shape:[l,o]}}),f=reshape({inputs:{x:i},backend:n,attrs:{shape:[l,u]}}),m=n.makeTensorInfo([],"float32",new Float32Array([0]));let g;g=env().getBool("WEBGL_PACK")?new ScatterPackedProgram(l,o,p.shape.length,f.shape.length,c,d):new ScatterProgram(l,o,p.shape.length,f.shape.length,c,d);const y=n.runWebGLProgram(g,[f,p,m],f.dtype),v=reshape({inputs:{x:y},backend:n,attrs:{shape:s}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(m),v}const scatterNdConfig={kernelName:ScatterNd,backendName:"webgl",kernelFunc:scatterNd};
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class SearchSortedProgram{constructor(e,t,n,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,n];const a=`for (int i = 0; i < ${Math.ceil(Math.log2(t+1))}; ++i) { if (left >= right) break;`,i=2===env().getNumber("WEBGL_VERSION")?"while (left < right) {":a,s="left"===r?"<":"<=";this.userCode=`\n       int findBound(int batch, float value) {\n         int left = 0;\n         int right = numInputs;\n         int mid;\n         ${i}\n           mid = (left + right) / 2;\n           if (getSortedSequence(batch, mid) ${s} value) {\n             left = mid + 1;\n           } else {\n             right = mid;\n           }\n         }\n         return right;\n       }\n\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int valueIndex = coords[1];\n\n         float value = getValues(batch, valueIndex);\n\n         setOutput(float(findBound(batch, value)));\n       }\n     `}}
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function searchSorted(e){const{inputs:t,backend:n,attrs:r}=e,{sortedSequence:a,values:i}=t,{side:s}=r,o=new SearchSortedProgram(a.shape[0],a.shape[1],i.shape[1],s),l=[[a.shape[1]]];return n.runWebGLProgram(o,[a,i],"int32",l)}const searchSortedConfig={kernelName:SearchSorted,backendName:"webgl",kernelFunc:searchSorted};
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class SelectProgram{constructor(e,t,n){let r,a;if(this.variableNames=["c","a","b"],this.outputShape=t,n>4)throw Error(`Where for rank ${n} is not yet supported`);if(1===n)a="resRC",r="resRC";else{const n=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[],s=[];for(let r=0;r<t.length;r++)s.push(`${n[r]}`),r<e&&i.push(`${n[r]}`);r=i.join(),a=s.join()}const i=getCoordsDataType(n);this.userCode=`\n      void main() {\n        ${i} resRC = getOutputCoords();\n        float cVal = getC(${r});\n        if (cVal >= 1.0) {\n          setOutput(getA(${a}));\n        } else {\n          setOutput(getB(${a}));\n        }\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function select(e){const{inputs:t,backend:n}=e,{condition:r,t:a,e:i}=t,s=new SelectProgram(r.shape.length,a.shape,a.shape.length);return n.runWebGLProgram(s,[r,a,i],upcastType(a.dtype,i.dtype))}const selectConfig={kernelName:Select,backendName:"webgl",kernelFunc:select},SELU=`\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = ${SELU_SCALEALPHA};\n  float scale = ${SELU_SCALE};\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n`,selu=unaryKernelFunc({opSnippet:SELU}),seluConfig={kernelName:Selu$1,backendName:"webgl",kernelFunc:selu},SIGMOID=CHECK_NAN_SNIPPET_UNARY+"\n  return 1.0 / (1.0 + exp(-1.0 * x));\n",SIGMOID_PACKED="\n  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",sigmoid=unaryKernelFunc({opSnippet:SIGMOID,packedOpSnippet:SIGMOID_PACKED,cpuKernelImpl:sigmoidImplCPU}),sigmoidConfig={kernelName:Sigmoid$1,backendName:"webgl",kernelFunc:sigmoid},SIGN="\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n",sign=unaryKernelFunc({opSnippet:SIGN}),signConfig={kernelName:Sign,backendName:"webgl",kernelFunc:sign},SIN=CHECK_NAN_SNIPPET_UNARY+"\n  return sin(x);\n",SIN_PACKED=`\n  vec4 result = sin(x);\n  bvec4 isNaN = isnan(x);\n  ${CHECK_NAN_SNIPPET_PACKED}\n  return result;\n`,sin=unaryKernelFunc({opSnippet:SIN,packedOpSnippet:SIN_PACKED}),sinConfig={kernelName:Sin,backendName:"webgl",kernelFunc:sin},SINH="\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n",sinh=unaryKernelFunc({opSnippet:SINH}),sinhConfig={kernelName:Sinh,backendName:"webgl",kernelFunc:sinh},SOFTPLUS="\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n",softplus=unaryKernelFunc({opSnippet:SOFTPLUS}),softplusConfig={kernelName:Softplus$1,backendName:"webgl",kernelFunc:softplus},spaceToBatchND=e=>{const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:i,paddings:s}=r;assert$1(a.shape.length<=4,(()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"));const o=i.reduce(((e,t)=>e*t)),l=[[0,0]];l.push(...s);for(let y=1+i.length;y<a.shape.length;++y)l.push([0,0]);const u=[],c=padV2({inputs:{x:a},backend:n,attrs:{paddings:l,constantValue:0}}),h=getReshaped(c.shape,i,o,!1),d=getPermuted(h.length,i.length,!1),p=getReshapedPermuted(c.shape,i,o,!1),f=reshape({inputs:{x:c},backend:n,attrs:{shape:h}}),m=transpose({inputs:{x:f},backend:n,attrs:{perm:d}}),g=reshape({inputs:{x:m},backend:n,attrs:{shape:p}});return u.push(c),u.push(f),u.push(m),u.forEach((e=>n.disposeIntermediateTensorInfo(e))),g},spaceToBatchNDConfig={kernelName:SpaceToBatchND,backendName:"webgl",kernelFunc:spaceToBatchND};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function sparseFillEmptyRows(e){const{inputs:t,backend:n}=e,{indices:r,values:a,denseShape:i,defaultValue:s}=t;if(1!==i.shape.length)throw new Error(`Dense shape must be a vector, saw:\n         ${i.shape}`);if(2!==r.shape.length)throw new Error(`Indices must be a matrix, saw:\n         ${r.shape}`);if(1!==a.shape.length)throw new Error(`Values must be a vector, saw:\n         ${a.shape}`);if(0!==s.shape.length)throw new Error(`Default value must be a scalar, saw:\n        ${s.shape}`);const o=n.readSync(r.dataId),l=n.readSync(a.dataId),u=n.readSync(i.dataId),c=n.readSync(s.dataId)[0],[h,d,p,f,m]=sparseFillEmptyRowsImplCPU(o,r.shape,r.dtype,l,a.dtype,u,c);return[n.makeTensorInfo(d,r.dtype,h),n.makeTensorInfo([d[0]],a.dtype,p),n.makeTensorInfo([f.length],"bool",new Uint8Array(f.map((e=>Number(e))))),n.makeTensorInfo([m.length],r.dtype,new Int32Array(m))]}const sparseFillEmptyRowsConfig={kernelName:SparseFillEmptyRows,backendName:"webgl",kernelFunc:sparseFillEmptyRows};
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function sparseReshape(e){const{inputs:t,backend:n}=e,{inputIndices:r,inputShape:a,newShape:i}=t;if(2!==r.shape.length)throw new Error(`Input indices should be a matrix but received shape ${r.shape}`);if(1!==a.shape.length)throw new Error(`Input shape should be a vector but received shape ${a.shape}`);if(1!==i.shape.length)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);const s=Array.from(n.readSync(a.dataId)),o=n.readSync(r.dataId),l=Array.from(n.readSync(i.dataId)),[u,c,h]=sparseReshapeImplCPU(o,r.shape,r.dtype,s,l);return[n.makeTensorInfo(c,r.dtype,u),n.makeTensorInfo([h.length],i.dtype,new Int32Array(h))]}const sparseReshapeConfig={kernelName:SparseReshape,backendName:"webgl",kernelFunc:sparseReshape};
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function sparseSegmentMean(e){const{inputs:t,backend:n}=e,{data:r,indices:a,segmentIds:i}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error(`Indices should be a vector but received shape\n              ${a.shape}`);if(1!==i.shape.length)throw new Error(`Segment ids should be a vector but received shape\n              ${i.shape}`);const s=n.readSync(r.dataId),o=n.readSync(a.dataId),l=n.readSync(i.dataId),[u,c]=sparseSegmentReductionImplCPU(s,r.shape,r.dtype,o,l,!0);return n.makeTensorInfo(c,r.dtype,u)}const sparseSegmentMeanConfig={kernelName:SparseSegmentMean,backendName:"webgl",kernelFunc:sparseSegmentMean};
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function sparseSegmentSum(e){const{inputs:t,backend:n}=e,{data:r,indices:a,segmentIds:i}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error(`Indices should be a vector but received shape\n             ${a.shape}`);if(1!==i.shape.length)throw new Error(`Segment ids should be a vector but received shape\n             ${i.shape}`);const s=n.readSync(r.dataId),o=n.readSync(a.dataId),l=n.readSync(i.dataId),[u,c]=sparseSegmentReductionImplCPU(s,r.shape,r.dtype,o,l);return n.makeTensorInfo(c,r.dtype,u)}const sparseSegmentSumConfig={kernelName:SparseSegmentSum,backendName:"webgl",kernelFunc:sparseSegmentSum};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function sparseToDense(e){const{inputs:t,backend:n,attrs:r}=e,{sparseIndices:a,sparseValues:i,defaultValue:s}=t,{outputShape:o}=r,{sliceRank:l,numUpdates:u,sliceSize:c,strides:h,outputSize:d}=calculateShapes(i,a,o);if("string"===i.dtype){const e=n.bufferSync(a),t=n.bufferSync(i),r=decodeString(n.readSync(s.dataId)[0]),p=scatterImplCPU(e,t,o,d,c,u,l,h,r,false);return n.makeTensorInfo(o,p.dtype,p.values)}const p=new ScatterProgram(u,l,a.shape.length,i.shape.length,h,[d,1],false),f=n.runWebGLProgram(p,[i,a,s],i.dtype),m=reshape({inputs:{x:f},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(f),m}const sparseToDenseConfig={kernelName:SparseToDense,backendName:"webgl",kernelFunc:sparseToDense};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function splitV(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{numOrSizeSplits:i,axis:s}=r,o=parseAxisParam(s,a.shape)[0],l=prepareSplitSize(a,i,o),u=a.shape.length,c=new Array(u).fill(0),h=a.shape.slice();return l.map((e=>{const t=[...h];t[o]=e;const r=slice({inputs:{x:a},backend:n,attrs:{begin:c,size:t}});return c[o]+=e,r}))}const splitVConfig={kernelName:SplitV,backendName:"webgl",kernelFunc:splitV},SQRT="return sqrt(x);",sqrt=unaryKernelFunc({opSnippet:SQRT,packedOpSnippet:SQRT,cpuKernelImpl:sqrtImplCPU}),sqrtConfig={kernelName:Sqrt,backendName:"webgl",kernelFunc:sqrt},SQUARE="return x * x;",square=unaryKernelFunc({opSnippet:SQUARE}),squareConfig={kernelName:Square,backendName:"webgl",kernelFunc:square},SQUARED_DIFFERENCE="return (a - b) * (a - b);",squaredDifference=binaryKernelFunc({opSnippet:SQUARED_DIFFERENCE,packedOpSnippet:SQUARED_DIFFERENCE}),squaredDifferenceConfig={kernelName:SquaredDifference,backendName:"webgl",kernelFunc:squaredDifference};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2023 Google LLC.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function staticRegexReplace(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t;if("string"!==a.dtype)throw new Error("Input must be of datatype string");const i=fromUint8ToStringArray(n.readSync(a.dataId)),s=staticRegexReplaceImplCPU(i,"string",r);return n.makeTensorInfo(a.shape,"string",s)}const staticRegexReplaceConfig={kernelName:StaticRegexReplace,backendName:"webgl",kernelFunc:staticRegexReplace};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function step({inputs:e,attrs:t,backend:n}){const{x:r}=e,a=CHECK_NAN_SNIPPET$1+`\n    return x > 0.0 ? 1.0 : float(${t.alpha});\n  `,i=new UnaryOpProgram(r.shape,a);return n.runWebGLProgram(i,[r],r.dtype)}const stepConfig={kernelName:Step,backendName:"webgl",kernelFunc:step};
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class StridedSliceProgram{constructor(e,t,n){this.variableNames=["x"],this.outputShape=n;const r=n.length,a=getCoordsDataType(n.length),i=getCoordsDataType(n.length);let s="";if(1===r)s="coords * strides + begin";else{let e=0;s=n.map(((t,r)=>(e++,1===n.length?`coords * strides[${r}] + begin[${r}]`:`coords[${e-1}] * strides[${r}] + begin[${r}]`))).join(",")}this.userCode=`\n      ${a} begin = ${a}(${e});\n      ${a} strides = ${a}(${t});\n\n      void main() {\n        ${i} coords = getOutputCoords();\n        setOutput(getX(${s}));\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function stridedSlice(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{begin:i,end:s,strides:o,beginMask:l,endMask:u,ellipsisMask:c,newAxisMask:h,shrinkAxisMask:d}=r,{finalShapeSparse:p,finalShape:f,isIdentity:m,sliceDim0:g,isSimpleSlice:y,begin:v,end:b,strides:x}=sliceInfo(a.shape,i,s,o,l,u,c,h,d);let T;if(m)T=reshape({inputs:{x:a},backend:n,attrs:{shape:f}});else if(g||y){assert$1(a.shape.length>=1,(()=>`Input must have rank at least 1, got: ${a.shape.length}`));const e=computeOutShape$2(v,b,x),t=slice({inputs:{x:a},backend:n,attrs:{begin:v,size:e}});T=reshape({inputs:{x:t},backend:n,attrs:{shape:f}}),n.disposeIntermediateTensorInfo(t)}else{if(n.shouldExecuteOnCPU([a])){const e=n.readSync(a.dataId),t=buffer(a.shape,a.dtype,e),r=stridedSliceImplCPU(p,t,x,v);T=n.makeTensorInfo(f,a.dtype,r.values)}else{const e=new StridedSliceProgram(v,x,p);T=n.runWebGLProgram(e,[a],a.dtype)}}const _=reshape({inputs:{x:T},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(T),_}const stridedSliceConfig={kernelName:StridedSlice,backendName:"webgl",kernelFunc:stridedSlice};
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function stringNGrams(e){const{inputs:t,backend:n,attrs:r}=e,{separator:a,nGramWidths:i,leftPad:s,rightPad:o,padWidth:l,preserveShortSequences:u}=r,{data:c,dataSplits:h}=t,d=n.readSync(c.dataId),p=n.readSync(h.dataId),[f,m]=stringNGramsImplCPU(d,p,a,i,s,o,l,u);return[n.makeTensorInfo([f.length],"string",f),n.makeTensorInfo(h.shape,"int32",m)]}const stringNGramsConfig={kernelName:StringNGrams,backendName:"webgl",kernelFunc:stringNGrams};
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function stringSplit(e){const{inputs:t,backend:n,attrs:r}=e,{skipEmpty:a}=r,{input:i,delimiter:s}=t;if("string"!==i.dtype)throw new Error("Input must be of datatype string");if(1!==i.shape.length)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(0!==s.shape.length)throw new Error(`Delimiter must be a scalar, got shape: ${s.shape}`);const o=n.readSync(i.dataId),l=n.readSync(s.dataId)[0],[u,c,h]=stringSplitImplCPU(o,l,a),d=c.length;return[n.makeTensorInfo([d,2],"int32",u),n.makeTensorInfo([d],"string",c),n.makeTensorInfo([2],"int32",new Int32Array(h))]}const stringSplitConfig={kernelName:StringSplit,backendName:"webgl",kernelFunc:stringSplit};
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function stringToHashBucketFast(e){const{inputs:t,backend:n,attrs:r}=e,{numBuckets:a}=r,{input:i}=t;if("string"!==i.dtype)throw new Error("Input must be of datatype string");if(a<=0)throw new Error("Number of buckets must be at least 1");const s=n.readSync(i.dataId),o=stringToHashBucketFastImplCPU(s,a);return n.makeTensorInfo(i.shape,"int32",o)}const stringToHashBucketFastConfig={kernelName:StringToHashBucketFast,backendName:"webgl",kernelFunc:stringToHashBucketFast},TAN="return tan(x);",tan=unaryKernelFunc({opSnippet:TAN}),tanConfig={kernelName:Tan,backendName:"webgl",kernelFunc:tan},TANH="\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n",tanh=unaryKernelFunc({opSnippet:TANH}),tanhConfig={kernelName:Tanh$1,backendName:"webgl",kernelFunc:tanh};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
/**
     * @license
     * Copyright 2022 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
function tensorScatterUpdate(e){const{inputs:t,backend:n,attrs:r}=e,{tensor:a,indices:i,updates:s}=t,{sliceRank:o,numUpdates:l,sliceSize:u,strides:c,outputSize:h}=calculateShapes(s,i,a.shape),d=[h/u,u];if(0===h)return n.makeTensorInfo(a.shape,i.dtype);const p=reshape({inputs:{x:i},backend:n,attrs:{shape:[l,o]}}),f=reshape({inputs:{x:s},backend:n,attrs:{shape:[l,u]}}),m=reshape({inputs:{x:a},backend:n,attrs:{shape:d}}),g=new ScatterProgram(l,o,p.shape.length,f.shape.length,c,d,!1,!0),y=n.runWebGLProgram(g,[f,p,m],m.dtype),v=reshape({inputs:{x:y},backend:n,attrs:{shape:a.shape}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(y),v}const tensorScatterUpdateConfig={kernelName:TensorScatterUpdate,backendName:"webgl",kernelFunc:tensorScatterUpdate};
/**
     * @license
     * Copyright 2017 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class TileProgram{constructor(e,t){this.variableNames=["A"];const n=new Array(e.length);for(let i=0;i<n.length;i++)n[i]=e[i]*t[i];this.outputShape=n,this.rank=n.length;const r=getCoordsDataType(this.rank),a=getSourceCoords(e);this.userCode=`\n      void main() {\n        ${r} resRC = getOutputCoords();\n        setOutput(getA(${a}));\n      }\n    `}}function getSourceCoords(e){const t=e.length;if(t>5)throw Error(`Tile for rank ${t} is not yet supported`);if(1===t)return`imod(resRC, ${e[0]})`;const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[];for(let a=0;a<e.length;a++)r.push(`imod(${n[a]}, ${e[a]})`);return r.join()}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function tile(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{reps:i}=r;if("string"===a.dtype||a.shape.length>5){const e=n.readSync(a.dataId),t="string"===a.dtype?e.map((e=>decodeString(e))):e,r=buffer(a.shape,a.dtype,t),s=tileImplCPU(r,i);return n.makeTensorInfo(s.shape,s.dtype,s.values)}const s=new TileProgram(a.shape,i);return n.runWebGLProgram(s,[a],a.dtype)}const tileConfig={kernelName:Tile,backendName:"webgl",kernelFunc:tile};class SwapProgram{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode="\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // We compare elements pair-wise within a group of size 2 * inc.\n         // The comparing rule for each group alternates between ascending\n         // and descending. Within each group, we compare each pair at\n         // positions i and i+inc. To decide whether an element at position i\n         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than\n         // inc, it is in the first half of the group, we denote it as x0,\n         // otherwise we denote it as x1.\n         // For example, as shown in the Bitonic top K paper referenced above,\n         // Figure5(a) shows that element[1] is in the\n         // second half of the group when group size is 2, but it is in the\n         // first half of the group when group size is 4.\n\n         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;\n         int i = isFirstInPair ? elemIdx : elemIdx - inc;\n\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));\n         float x0 = i0 < n ? getX(batch, i0) : negativeInf;\n         float x1 = i1 < n ? getX(batch, i1) : negativeInf;\n\n         // Denotes which direction indices are in (ascending or descending).\n         bool reverse = imod(elemIdx, 2 * dir) >= dir;\n         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);\n         if (reverse == isGreater) { // Elements in opposite order of direction\n           int iTemp = i0;\n           i0 = i1;\n           i1 = iTemp;\n         }\n         if (isFirstInPair) {\n            setOutput(float(i0));\n         } else {\n            setOutput(float(i1));\n         }\n       }\n     "}}class MergeProgram{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode="\n    void main() {\n         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // The output size is half of the previous size.\n         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),\n         // we only need to output the indices at positions |, the indices at\n         // positions _ can be thrown away, see Figure5(b) After Phase 2\n         // (Merge phase) in the Bitonic Top K paper referenced above.\n         // For example, the paper shows we only need to output the orange bars.\n         // The output sequence should look like this | | | | | | | |.\n         // Because the sequence is halved, to map the output index back\n         // to the previous sequence to find the corresponding value,\n         // we need to double the index. When we double the index,\n         // we basically interpolate a position, so 2i looks like\n         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position\n         // of each 2k positions by - elemIdx % k. E.g. for output at\n         // index 4,5,6,7, we want to get the corresponding element at\n         // original index 8,9,10,11, for output at index 8,9,10,11,\n         // we want to get the corresponding element at original index\n         // 16,17,18,19, so on and so forth.\n\n         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));\n\n         float x0 = getX(batch, i0);\n         float x1 = i1 < n ? getX(batch, i1) : x0;\n\n         setOutput(x0 >= x1 ? float(i0) : float(i1));\n       }\n     "}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function disposeIntermediateTensorInfoOrNull(e,t){null!==t&&e.disposeIntermediateTensorInfo(t)}function roundUpToPow2(e){let t=1;for(;t<e;)t*=2;return t}function topK(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{k:i,sorted:s}=r,o=env().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=env().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),u=a.shape,c=u[u.length-1];if(n.shouldExecuteOnCPU([a])||c<o||i>l){const e=n.readSync(a.dataId),[t,r]=topKImplCPU(e,u,a.dtype,i,s);return[n.makeTensorInfo(t.shape,t.dtype,t.values),n.makeTensorInfo(r.shape,r.dtype,r.values)]}if(0===i)return u[u.length-1]=0,[n.makeTensorInfo(u,a.dtype,[]),n.makeTensorInfo(u,"int32",[])];if(1===c)return[a,fill({attrs:{shape:u,dtype:"int32",value:0},backend:n})];const h=n.texData.get(a.dataId),d=null!==h&&h.isPacked,p=d?n.unpackTensor(a):a,f=sizeFromShape(u)/c,m=reshape({inputs:{x:p},attrs:{shape:[f,c]},backend:n});d&&disposeIntermediateTensorInfoOrNull(n,p);const g=roundUpToPow2(i),y=roundUpToPow2(c);let v=null;const b=()=>null===v?[m,m]:[m,v],x=(e,t,r)=>{const a=b(),i=new SwapProgram(r),s=[[c],[null===v?1:0],[Number.NEGATIVE_INFINITY],[e],[t]],o=v;v=n.runWebGLProgram(i,a,"int32",s),disposeIntermediateTensorInfoOrNull(n,o)};for(let C=1;C<g;C*=2){const e=2*C;for(let t=C;t>=1;t/=2)x(e,t,[f,y])}for(let C=y;C>g;C/=2){const e=b(),t=new MergeProgram([f,C/2]),r=[[c],[null===v?1:0],[g]],a=v;v=n.runWebGLProgram(t,e,"int32",r),disposeIntermediateTensorInfoOrNull(n,a);const i=g/2,s=2*i;for(let n=i;n>=1;n/=2)x(s,n,v.shape)}let T=v;v=slice({inputs:{x:v},backend:n,attrs:{begin:0,size:[f,i]}}),disposeIntermediateTensorInfoOrNull(n,T);let _=gatherV2({inputs:{x:m,indices:v},backend:n,attrs:{axis:1,batchDims:1}});disposeIntermediateTensorInfoOrNull(n,m);const w=u.slice(0,-1);w.push(i),T=v,v=reshape({inputs:{x:v},attrs:{shape:w},backend:n}),disposeIntermediateTensorInfoOrNull(n,T);const S=_;return _=reshape({inputs:{x:_},attrs:{shape:w},backend:n}),disposeIntermediateTensorInfoOrNull(n,S),[_,v]}const topKConfig={kernelName:TopK,backendName:"webgl",kernelFunc:topK};
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class TransformProgram{constructor(e,t,n,r,a,i){this.variableNames=["Image","Transforms"],this.outputShape=i;const s="nearest"===n?1:2;let o;switch(r){case"constant":default:o=1;break;case"reflect":o=2;break;case"wrap":o=3;break;case"nearest":o=4}this.userCode=`\n            float mapCoord(float outCoord, float len) {\n              float inCoord = outCoord;\n              if(${o} == 2) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    if (inCoord < sz2) {\n                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +\n                      inCoord;\n                    }\n                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    inCoord -= sz2 * float(int(float(inCoord / sz2)));\n                    if (inCoord >= len) {\n                      inCoord = sz2 - inCoord - 1.0;\n                    }\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (${o} == 3) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord -= len * float(int(float(inCoord / sz)));\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (${o} == 4) {\n                return clamp(outCoord, 0.0, len - 1.0);\n              } else {\n                return outCoord;\n              }\n            }\n\n            float readWithFillValue(int batch, int coordY, int coordX,\n              int channel) {\n              float outputValue;\n              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${t}) {\n                  outputValue = getImage(batch, coordY, coordX, channel);\n              } else {\n                outputValue = float(${a});\n              }\n              return outputValue;\n            }\n\n            void main() {\n              ivec4 coords = getOutputCoords();\n              float outputValue;\n              int batch = coords[0];\n              int x = coords[2];\n              int y = coords[1];\n              int channel = coords[3];\n              float xf = float(x);\n              float yf = float(y);\n              float a1 = getTransforms(batch, 0);\n              float a2 = getTransforms(batch, 1);\n              float a3 = getTransforms(batch, 2);\n              float b1 = getTransforms(batch, 3);\n              float b2 = getTransforms(batch, 4);\n              float b3 = getTransforms(batch, 5);\n              float c1 = getTransforms(batch, 6);\n              float c2 = getTransforms(batch, 7);\n              float projection = c1 * xf + c2 * yf + 1.0;\n              if (projection == 0.0) {\n                outputValue = float(${a});\n              } else {\n                float inX = (a1 * xf + a2 * yf + a3) / projection;\n                float inY = (b1 * xf + b2 * yf + b3) / projection;\n                float mapX = mapCoord(inX, float(${t}));\n                float mapY = mapCoord(inY, float(${e}));\n\n                if (${s} == 1) {\n                  int coordY = int(round(mapY));\n                  int coordX = int(round(mapX));\n                  outputValue = readWithFillValue(batch, coordY, coordX,\n                    channel);\n                } else {\n                  float yFloor = floor(mapY);\n                  float xFloor = floor(mapX);\n                  float yCeil = yFloor + 1.0;\n                  float xCeil = xFloor + 1.0;\n                  float valueYFloor = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);\n                  float valueYCeil = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);\n                  outputValue = (yCeil - mapY) * valueYFloor +\n                  (mapY - yFloor) * valueYCeil;\n                }\n              }\n              setOutput(outputValue);\n            }\n        `}}
/**
     * @license
     * Copyright 2021 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function transform$1(e){const{inputs:t,backend:n,attrs:r}=e,{image:a,transforms:i}=t,{interpolation:s,fillMode:o,fillValue:l,outputShape:u}=r,[c,h,d,p]=a.shape,[f,m]=null!=u?u:[h,d],g=new TransformProgram(h,d,s,o,l,[c,f,m,p]);return n.runWebGLProgram(g,[a,i],"float32")}const transformConfig={kernelName:Transform,backendName:"webgl",kernelFunc:transform$1};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the License);
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an AS IS BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function unique(e){const{inputs:t,attrs:n,backend:r}=e,{axis:a}=n,{x:i}=t;assertNotComplex(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const s=r.readSync(i.dataId),{outputValues:o,outputShape:l,indices:u}=uniqueImplCPU(s,a,i.shape,i.dtype);return[r.makeTensorInfo(l,i.dtype,o),r.makeTensorInfo([u.length],"int32",u)]}const uniqueConfig={kernelName:Unique,backendName:"webgl",kernelFunc:unique};
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function unpack(e){const{inputs:t,backend:n,attrs:r}=e,{value:a}=t;let{axis:i}=r;i<0&&(i+=a.shape.length);const s=a,o=s.shape.length,l=a.shape[i],u=new Array(o-1);let c=0;for(let m=0;m<o;m++)m!==i&&(u[c++]=s.shape[m]);const h=[],d=new Array(o).fill(0),p=s.shape.slice();p[i]=1;const f=new Array(l);for(let m=0;m<f.length;m++){d[i]=m;const e=slice({inputs:{x:s},backend:n,attrs:{begin:d,size:p}}),t=reshape({inputs:{x:e},backend:n,attrs:{shape:u}});f[m]=t,h.push(e)}return h.forEach((e=>n.disposeIntermediateTensorInfo(e))),f}const unpackConfig={kernelName:Unpack,backendName:"webgl",kernelFunc:unpack};
/**
     * @license
     * Copyright 2018 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */class SegmentOpProgram{constructor(e,t){this.variableNames=["x","segmentIds"];const n=e.windowSize,r=e.batchSize,a=e.inSize,i=e.numSegments,s=i*Math.ceil(a/n);this.outputShape=[r,s];const o=4*Math.floor(n/4),l=n%4,u="\n        sumValue += dot(values, segFilter);\n    ";let c="";a%n>0&&(c=`\n        if (inIdx < 0 || inIdx >= ${a}) {\n          return initializationValue;\n        }\n      `);let h="";a%n>0&&(h=`\n        if (inIdx < 0 || inIdx >= ${a}) {\n          return -1.0;\n        }\n      `),this.userCode=`\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        ${c}\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        ${h}\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          ${i})) * float(${n}));\n        int currentSeg = int(mod(float(outIdx), float(${i})));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ${o}; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          ${u}\n        }\n\n        int inIdx = inOffset + ${o};\n        if (${1===l}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          ${u}\n        } else if (${2===l}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          ${u}\n        } else if (${3===l}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          ${u}\n        }\n        setOutput(sumValue);\n      }\n    `}}
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */function unsortedSegmentSum(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,segmentIds:i}=t,{numSegments:s}=r,o=a.shape.length,l=[];let u=0;const c=getAxesPermutation([u],o);let h=a;null!=c&&(h=transpose({inputs:{x:a},backend:n,attrs:{perm:c}}),l.push(h),u=getInnerMostAxes(1,o)[0]);const d=computeOutShape(h.shape,u,s),p=sizeFromShape([h.shape[u]]),f=reshape({inputs:{x:h},backend:n,attrs:{shape:[-1,p]}});l.push(f);const m=sumOutType(a.dtype),g=(e,t,r,a,i)=>{const s=e.shape[0],o=e.shape[1],u=segOpComputeOptimalWindowSize(o,i),c=new SegmentOpProgram({windowSize:u,inSize:o,batchSize:s,numSegments:i},t),h=n.compileAndRun(c,[e,r],a);if(l.push(h),h.shape[1]===i)return h;const d=range$1({backend:n,attrs:{start:0,stop:i,step:1,dtype:"float32"}}),p=tile({inputs:{x:d},backend:n,attrs:{reps:[o/u]}});l.push(d),l.push(p);return g(h,t,p,a,i)},y=reshape({inputs:{x:g(f,"unsortedSegmentSum",i,m,s)},backend:n,attrs:{shape:d}});let v=y;if(null!=c){l.push(y);const e=getUndoAxesPermutation(c);v=transpose({inputs:{x:v},backend:n,attrs:{perm:e}})}return l.forEach((e=>n.disposeIntermediateTensorInfo(e))),v}const unsortedSegmentSumConfig={kernelName:UnsortedSegmentSum,backendName:"webgl",kernelFunc:unsortedSegmentSum},kernelConfigs=[_fusedMatMulConfig,absConfig,acosConfig,acoshConfig,addConfig,addNConfig,allConfig,anyConfig,argMaxConfig,argMinConfig,asinConfig,asinhConfig,atanConfig,atan2Config,atanhConfig,avgPoolConfig,avgPool3DConfig,avgPool3DGradConfig,avgPoolGradConfig,batchMatMulConfig,batchNormConfig,batchToSpaceNDConfig,bincountConfig,bitwiseAndConfig,broadcastArgsConfig,castConfig,ceilConfig,clipByValueConfig,complexConfig,complexAbsConfig,concatConfig,conv2DConfig,conv2DBackpropFilterConfig,conv2DBackpropInputConfig,conv3DConfig,conv3DBackpropFilterV2Config,conv3DBackpropInputConfig,cosConfig,coshConfig,cropAndResizeConfig,cumprodConfig,cumsumConfig,denseBincountConfig,depthToSpaceConfig,depthwiseConv2dNativeConfig,depthwiseConv2dNativeBackpropFilterConfig,depthwiseConv2dNativeBackpropInputConfig,diagConfig,dilation2DConfig,einsumConfig,eluConfig,eluGradConfig,equalConfig,erfConfig,expConfig,expandDimsConfig,expm1Config,fftConfig,fillConfig,flipLeftRightConfig,floorConfig,floorDivConfig,fromPixelsConfig,fusedConv2DConfig,fusedDepthwiseConv2DConfig,gatherNdConfig,gatherV2Config,greaterConfig,greaterEqualConfig,identityConfig,ifftConfig,imagConfig,isFiniteConfig,isInfConfig,isNaNConfig,leakyReluConfig,lessConfig,lessEqualConfig,linSpaceConfig,logConfig,log1pConfig,logicalAndConfig,logicalNotConfig,logicalOrConfig,LRNConfig,LRNGradConfig,maxConfig,maximumConfig,maxPoolConfig,maxPool3DConfig,maxPool3DGradConfig,maxPoolGradConfig,maxPoolWithArgmaxConfig,meanConfig,minConfig,minimumConfig,mirrorPadConfig,modConfig,multinomialConfig,multiplyConfig,negConfig,nonMaxSuppressionV3Config,nonMaxSuppressionV4Config,nonMaxSuppressionV5Config,notEqualConfig,oneHotConfig,onesLikeConfig,packConfig,padV2Config,powConfig,preluConfig,prodConfig,raggedGatherConfig,raggedRangeConfig,raggedTensorToTensorConfig,rangeConfig,realConfig,realDivConfig,reciprocalConfig,reluConfig,relu6Config,reshapeConfig,resizeBilinearConfig,resizeBilinearGradConfig,resizeNearestNeighborConfig,resizeNearestNeighborGradConfig,reverseConfig,rotateWithOffsetConfig,roundConfig,rsqrtConfig,scatterNdConfig,searchSortedConfig,selectConfig,seluConfig,sigmoidConfig,signConfig,sinConfig,sinhConfig,sliceConfig,softmaxConfig,softplusConfig,spaceToBatchNDConfig,sparseFillEmptyRowsConfig,sparseReshapeConfig,sparseSegmentMeanConfig,sparseSegmentSumConfig,sparseToDenseConfig,splitVConfig,sqrtConfig,squareConfig,squaredDifferenceConfig,staticRegexReplaceConfig,stepConfig,stridedSliceConfig,stringNGramsConfig,stringSplitConfig,stringToHashBucketFastConfig,subConfig,sumConfig,tanConfig,tanhConfig,tensorScatterUpdateConfig,tileConfig,topKConfig,transformConfig,transposeConfig,uniqueConfig,unpackConfig,unsortedSegmentSumConfig,zerosLikeConfig];
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */for(const m of kernelConfigs)registerKernel(m);function initSwitchAnimation(){const e=document.getElementById("fci-ocr-animation-switch-container");if(!e)return;setVisActionStep(!1);const t=lottie.loadAnimation({container:e,renderer:"svg",loop:!1,autoplay:!0,path:window.ekyc._assets_config.animation_switch_path});t.setSpeed(3),t.addEventListener("complete",(()=>{setVisActionStep(!0),onAnimationEnd()})),initSideLabel$1(),initTextLabel()}function onAnimationEnd(){const e=document.getElementById("fci-ocr-guide-container");e&&(e.innerHTML="",e.classList.add("fci-ocr-guide-container-hidden"),e.classList.remove("fci-ocr-guide-container-visible"))}function initSideLabel$1(){const e=document.getElementById("fci-ocr-animation-switch-sides");e&&(e.innerText=i18n("backside"))}function initTextLabel(){const e=document.getElementById("fci-ocr-animation-switch-text");e&&(e.innerText=i18n("pleaseKeepDocumentsInTheCaptureArea"))}function switchAnimationHtml(){return'\n        <div id="fci-ocr-animation-switch-background"></div>\n        <div id="fci-ocr-animation-switch-wrapper">\n            <div id="fci-ocr-animation-switch-container"></div>\n            <div id="fci-ocr-animation-switch-labels">\n                <div id="fci-ocr-animation-switch-sides"></div>\n                <span id="fci-ocr-animation-switch-text"></span>\n            </div>\n        </div>\n    '}function loadSwitchAnimation(e){Utils.load(e,switchAnimationHtml(),initSwitchAnimation)}const threshold=.6,idClasses=["cmnd_new_front","cmnd_new_back","cccd_chip_back","cccd_chip_front","cmnd_old_front","cmnd_old_back","passport_vn"],MAX_FILE_SIZE_IN_MB=5;let _uploaded_file;async function initWebcam(){var e;setBackend("webgl");const t=document.getElementById("fci-ocr-webcam");if(!t)return;if((await navigator.mediaDevices.enumerateDevices()).filter((e=>"videoinput"===e.kind&&!e.label.toLowerCase().includes("virtual"))).length<1)return alert("No camera detected"),void window.ekyc.dispose();navigator.mediaDevices&&(null==(e=navigator.mediaDevices)?void 0:e.getUserMedia)&&(setLayoutLoading(!0),navigator.mediaDevices.getUserMedia({video:{width:{ideal:720},height:{ideal:1280},aspectRatio:{exact:4/3,ideal:4/3},facingMode:{ideal:"environment"},frameRate:{ideal:30}},audio:!1}).then((async e=>{t.srcObject=e,Utils.onDisconnectDom(document.getElementById("fci-ocr-container"),(()=>{t.srcObject=null,Utils.handleStopStream(e)})),t.play(),t.addEventListener("loadedmetadata",(async()=>{handleCanvasSize(t),clearCanvas(),new ResizeObserver((()=>handleCanvasSize(t))).observe(t);const e=await loadModel();setLayoutLoading(!1),detectFrame(e,t)}))})))}async function loadModel(){const e=await loadGraphModel(window.ekyc._assets_config.ocr_model_path);return onRemoveCallback((()=>{e.dispose()})),e}function detectFrame(e,t){engine().startScope(),e.executeAsync(process_input(t)).then((n=>{renderPredictions(n),requestAnimationFrame((()=>{detectFrame(e,t)})),engine().endScope()})).catch((e=>{console.warn("Error executeAsync model.")}))}function process_input(e){const t=fromPixels$1(e).resizeNearestNeighbor([320,320]).transpose([0,1,2]).expandDims(),n=cast$3(t,"float32");return div$1(n,255)}function clearCanvas(){const e=document.getElementById("fci-ocr-canvas");if(!e)return;const t=e.getContext("2d");t&&t.clearRect(0,0,t.canvas.width,t.canvas.height)}function renderPredictions(e){const t=document.getElementById("fci-ocr-canvas");if(!t)return;const n=t.getContext("2d");if(!n)return;n.font="16px sans-serif",n.textBaseline="top";const r=e[0].arraySync(),a=buildDetectedObjects(e[1].arraySync(),r,e[2].dataSync());n.clearRect(0,0,parseInt(`${t.width}`),parseInt(`${t.height}`));const i=a.sort(((e,t)=>Number(e.score)<Number(t.score)?1:-1))[0];let s=!1;if(!i||Number(i.score)<=0)s=!1;else{const e=i.bbox[0],t=i.bbox[1],r=i.bbox[2],a=i.bbox[3];s=checkBoxesCollisionValid(n,e,t,r,a)}const o=document.querySelectorAll(".fci-capture-box-item");Array.from(o??[]).forEach((e=>{e.style.borderColor=s?"var(--fci-capture-box-valid-color)":"var(--fci-capture-box-invalid-color)"}))}function checkBoxesCollisionValid(e,t,n,r,a){const{width:i,height:s}=e.canvas,{px:o,py:l,pw:u,ph:c}={px:t/i*100,py:n/s*100,pw:r/i*100,ph:a/s*100},h=Math.abs(o-15),d=Math.abs(l-20),p=Math.abs(u-70),f=Math.abs(c-60);return h<=25&&d<=15&&p<=25&&f<=15}function buildDetectedObjects(e,t,n){const r=[],a=document.getElementById("fci-ocr-webcam");return a?(e[0].forEach(((e,i)=>{if(e>threshold){const s=[],o=t[0][i][0]*a.offsetWidth,l=t[0][i][1]*a.offsetHeight,u=t[0][i][2]*a.offsetWidth,c=t[0][i][3]*a.offsetHeight;s[0]=o,s[1]=l,s[2]=u-o,s[3]=c-l,r.push({class:n[i],label:idClasses[n[i]],score:e.toFixed(4),bbox:s})}})),r):[]}function handleCanvasSize(e){const t=document.getElementById("fci-ocr-canvas");if(!t)return;const n=e.getBoundingClientRect();t.style.width=`${n.width}px`,t.style.height=`${n.height}px`,t.setAttribute("width",`${n.width}`),t.setAttribute("height",""+n.width*e.videoHeight/e.videoWidth)}function initLayout$1(){const e=document.getElementById("fci-ocr-capture-btn");e&&(e.title=i18n("capture"),e.onclick=()=>{const e=document.getElementById("fci-ocr-webcam");if(!e)return;const t=document.createElement("canvas");t.height=e.videoHeight,t.width=e.videoWidth;const n=t.getContext("2d");if(!n)return;n.drawImage(e,0,0,t.width,t.height);const r=t.toDataURL("image/jpeg");fetch(r).then((e=>e.blob())).then((e=>{handleCaptureImage(new File([e],"image.jpeg",{type:"image/jpeg"}))}))})}function handleCaptureImage(e){"passport"!==window.ekyc.config.document_type?window.ekyc.resultStore.ocrFiles[0]?(window.ekyc.resultStore.ocrFiles[1]=e,loadPreviewImages$1()):(window.ekyc.resultStore.ocrFiles[0]=e,window.ekyc.config_setting.show_guide!==ShowGuideEnum.Ocr&&window.ekyc.config_setting.show_guide!==ShowGuideEnum.Both||loadSwitchIdAnimation()):(window.ekyc.resultStore.ocrFiles[0]=e,loadPreviewImages$1()),initSideLabel()}function loadPreviewImages$1(){window.ekyc.onChangeNextStep(),handleChangeLayout()}function loadSwitchIdAnimation(){const e=document.getElementById("fci-ocr-guide-container");e&&(e.classList.remove("fci-ocr-guide-container-hidden"),e.classList.add("fci-ocr-guide-container-visible"),loadSwitchAnimation(e))}function onRemoveCallback(e){const t=document.getElementById("fci-ocr-container");t&&Utils.onDisconnectDom(t,e)}function getDocumentTypeText(){switch(window.ekyc.config.document_type){case"idr":return window.ekyc.getText("id_result_title");case"passport":return window.ekyc.getText("passport_result_title");case"dlr":return window.ekyc.getText("driver_license_result_title")}}function changeSideText(e){const t=document.getElementById("fci-ocr-title-side");t&&(t.innerText=i18n(e))}function initSideLabel(){window.ekyc.resultStore.ocrFiles[0]?changeSideText("backside"):changeSideText("frontside")}function initTitleDetail(){const e=document.getElementById("fci-ocr-title-detail");e&&(e.innerText="capture"===window.ekyc.config.upload_type?i18n("pleaseKeepDocumentsInTheCaptureArea"):i18n("pleaseUploadDocuments"))}function initUploadPhoto(){const e=document.getElementById("fci-ocr-upload-input");if(!e)return;e.type="file",e.accept="image/png, image/jpeg",e.multiple=!1,e.onchange=()=>{const t=e.files;if(!(null==t?void 0:t.length))return;const n=t[0];if(n.size>1024*MAX_FILE_SIZE_IN_MB*1024)return void window.alert(`${i18n("fileSizeCannotBeExceeded")} ${MAX_FILE_SIZE_IN_MB}Mb`);const r=document.getElementById("fci-ocr-upload-img");r&&(r.src=URL.createObjectURL(n),_uploaded_file=n,e.value="")};const t=document.getElementById("fci-ocr-upload-area");t&&(t.onclick=()=>{e.click()})}function initUploadPhotoOrCapture(){"capture"===window.ekyc.config.upload_type?initWebcam():initUploadPhoto()}function initBtnAction(){const e=document.getElementById("fci-ocr-next-btn");e&&(e.onclick=()=>{if(!_uploaded_file)return;handleCaptureImage(_uploaded_file),_uploaded_file=void 0;const e=document.getElementById("fci-ocr-upload-img");e&&(e.removeAttribute("src"),setUploadIconVisible(!0))})}function setUploadIconVisible(e){const t=document.getElementById("fci-ocr-upload-icon");t&&(t.style.visibility=e?"visible":"hidden")}function initOcr(){initSideLabel(),initBtnAction(),initLayout$1(),initTitleDetail(),initUploadPhotoOrCapture()}function ocrHtml(){return`\n        <div id="fci-ocr-guide-container">\n        </div>\n        <div id="fci-ocr-container"\n            class="fci-ocr-container">\n            ${"capture"===window.ekyc.config.upload_type?'\n                <video id="fci-ocr-webcam"\n                    class="fci-ocr-webcam"\n                    muted\n                    playsinline\n                    controlsList="nodownload noplaybackrate"\n                    disablePictureInPicture\n                    autoplay></video>\n                <div id="fci-capture-box">\n                    <div id="fci-capture-box-layer"></div>\n                    <div id="fci-capture-box-tl"\n                        class="fci-capture-box-item"></div>\n                    <div id="fci-capture-box-tr"\n                        class="fci-capture-box-item"></div>\n                    <div id="fci-capture-box-br"\n                        class="fci-capture-box-item"></div>\n                    <div id="fci-capture-box-bl"\n                        class="fci-capture-box-item"></div>\n                </div>\n                <canvas id="fci-ocr-canvas"></canvas>\n                ':`\n                <div id="fci-ocr-upload-container">\n                    <div id="fci-ocr-upload-icon">\n                        <svg id="fci-ocr-upload-svg" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 16">\n                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"/>\n                        </svg>\n                        <span id="fci-ocr-upload-text">${i18n("clickHereToUpload")}</span>\n                    </div>\n                    <div id="fci-ocr-upload-area">\n                        <input\n                            id="fci-ocr-upload-input"/>\n                    </div>\n                    <div id="fci-ocr-upload-img-area">\n                       <img id="fci-ocr-upload-img" alt="" />\n                    </div>\n                </div>\n                `}\n        </div>\n        <div class="fci-ocr-title-container">\n            <div class="fci-ocr-title">\n                <span class="fci-ocr-title-label">${getDocumentTypeText()}</span>\n                <span class="fci-ocr-title-side" id="fci-ocr-title-side"></span>\n            </div>\n            <span id="fci-ocr-title-detail"></span>\n        </div>\n        <div class="fci-ocr-capture-container">\n            ${"capture"===window.ekyc.config.upload_type?'\n                <button id="fci-ocr-capture-btn">\n                    <svg width="24"\n                        height="24"\n                        viewBox="0 0 40 41"\n                        fill="none"\n                        xmlns="http://www.w3.org/2000/svg">\n                        <path\n                            d="M15 5.5H25L28.3333 8.83333H35C35.9205 8.83333 36.6667 9.57953 36.6667 10.5V33.8333C36.6667 34.7538 35.9205 35.5 35 35.5H5.00001C4.07954 35.5 3.33334 34.7538 3.33334 33.8333V10.5C3.33334 9.57953 4.07954 8.83333 5.00001 8.83333H11.6667L15 5.5ZM20 32.1667C25.5228 32.1667 30 27.6895 30 22.1667C30 16.6438 25.5228 12.1667 20 12.1667C14.4772 12.1667 10 16.6438 10 22.1667C10 27.6895 14.4772 32.1667 20 32.1667ZM20 28.8333C16.3181 28.8333 13.3333 25.8485 13.3333 22.1667C13.3333 18.4848 16.3181 15.5 20 15.5C23.6818 15.5 26.6667 18.4848 26.6667 22.1667C26.6667 25.8485 23.6818 28.8333 20 28.8333Z"\n                            fill="white" />\n                    </svg>\n                </button>\n                ':`\n                <button id="fci-ocr-next-btn" class="fci-btn fci-btn-primary fci-btn-rounded fci-btn-lg">\n                    ${i18n("next")}\n                </button>\n            `}\n            \n        </div>\n    `}function loadOcr(e){e.innerHTML=ocrHtml(),initOcr()}let tabIndex=0;function initImages(){const e=document.getElementById("fci-preview-images-container");if(!e)return;e.innerHTML="";window.ekyc.resultStore.ocrFiles.forEach(((t,n)=>{if(tabIndex!==n)return;const r=document.createElement("img");r.classList.add("fci-preview-images-image"),r.src=URL.createObjectURL(t),e.appendChild(r)}))}function initTabs(){const e=document.getElementById("fci-preview-images-tabs");if(!e)return;e.innerHTML="";const t=window.ekyc.resultStore.ocrFiles;if(t.length<2)return;const n=["frontside","backside"];t.map(((e,t)=>{const r=document.createElement("button");return r.classList.add("fci-btn","fci-btn-sm"),tabIndex===t?r.classList.add("fci-btn-primary"):r.classList.add("fci-btn-outlined"),r.innerText=i18n(n[t]||""),r})).forEach(((t,n,r)=>{t.onclick=()=>{tabIndex!==n&&(tabIndex=n,initImages(),r.forEach((e=>{Utils.jq(e).toggleClass("fci-btn-primary"),Utils.jq(e).toggleClass("fci-btn-outlined")})))},e.appendChild(t)}))}function initActionBtns(){const e=document.getElementById("fci-preview-images-action");if(!e)return;const t=document.createElement("button");t.classList.add("fci-btn","fci-btn-outlined","fci-btn-rounded","fci-btn-lg"),t.innerText=i18n("recapture"),t.onclick=()=>{tabIndex=0,window.ekyc.resultStore.ocrFiles=[],window.ekyc.moveToStep(2),handleChangeLayout()},e.appendChild(t);const n=document.createElement("button");n.classList.add("fci-btn","fci-btn-primary","fci-btn-rounded","fci-btn-lg"),n.innerText=i18n("next"),n.onclick=()=>{setLayoutLoading(!0),window.ekyc.ocr().then((e=>{setLayoutLoading(!1);const t=e.errorCode;if(isNaN(Number(t))||0!==Number(t))alert(e.errorMessage||i18n("thereWasError"));else{const t=e.data.reduce(((e,t)=>({...e,[t.name]:t.value})),{});window.ekyc.resultStore.ocrResult=t,window.ekyc.onChangeNextStep(3),handleChangeLayout()}})).catch((e=>{setLayoutLoading(!1),console.warn(e),window.ekyc.moveToStep(0),handleChangeLayout()}))},e.appendChild(n)}function initPreviewImages(){initImages(),initTabs(),initActionBtns()}function previewImagesHtml(){return'\n        <div id="fci-preview-images-wrapper">\n            <div class="fci-preview-images-box">\n                <div id="fci-preview-images-container"></div>\n                <div id="fci-preview-images-tabs"></div>\n            </div>\n            <div id="fci-preview-images-action"></div>\n        </div>\n    '}function loadPreviewImages(e){Utils.load(e,previewImagesHtml(),initPreviewImages)}var win;win="undefined"!=typeof window?window:void 0!==commonjsGlobal?commonjsGlobal:"undefined"!=typeof self?self:{};var window_1=win;const window$1$1=getDefaultExportFromCjs(window_1);var topLevel=void 0!==commonjsGlobal?commonjsGlobal:"undefined"!=typeof window?window:{},minDoc=require$$0,doccy;"undefined"!=typeof document?doccy=document:(doccy=topLevel["__GLOBAL_DOCUMENT_CACHE@4"],doccy||(doccy=topLevel["__GLOBAL_DOCUMENT_CACHE@4"]=minDoc));var document_1=doccy;const document$2=getDefaultExportFromCjs(document_1);var keycode$1={exports:{}};!function(e,t){function n(e){if(e&&"object"==typeof e){var t=e.which||e.keyCode||e.charCode;t&&(e=t)}if("number"==typeof e)return s[e];var n,i=String(e);return(n=r[i.toLowerCase()])?n:(n=a[i.toLowerCase()])||(1===i.length?i.charCodeAt(0):void 0)}n.isEventKey=function(e,t){if(e&&"object"==typeof e){var n=e.which||e.keyCode||e.charCode;if(null==n)return!1;if("string"==typeof t){var i;if(i=r[t.toLowerCase()])return i===n;if(i=a[t.toLowerCase()])return i===n}else if("number"==typeof t)return t===n;return!1}};var r=(t=e.exports=n).code=t.codes={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,"pause/break":19,"caps lock":20,esc:27,space:32,"page up":33,"page down":34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46,command:91,"left command":91,"right command":93,"numpad *":106,"numpad +":107,"numpad -":109,"numpad .":110,"numpad /":111,"num lock":144,"scroll lock":145,"my computer":182,"my calculator":183,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},a=t.aliases={windows:91,"⇧":16,"⌥":18,"⌃":17,"⌘":91,ctl:17,control:17,option:18,pause:19,break:19,caps:20,return:13,escape:27,spc:32,spacebar:32,pgup:33,pgdn:34,ins:45,del:46,cmd:91};
/*!
       * Programatically add the following
       */
for(i=97;i<123;i++)r[String.fromCharCode(i)]=i-32;for(var i=48;i<58;i++)r[i-48]=i;for(i=1;i<13;i++)r["f"+i]=i+111;for(i=0;i<10;i++)r["numpad "+i]=i+96;var s=t.names=t.title={};for(i in r)s[r[i]]=i;for(var o in a)r[o]=a[o]}(keycode$1,keycode$1.exports);var keycodeExports=keycode$1.exports;const keycode=getDefaultExportFromCjs(keycodeExports);var tuple=SafeParseTuple;function SafeParseTuple(e,t){var n,r=null;try{n=JSON.parse(e,t)}catch(err){r=err}return[r,n]}const safeParseTuple=getDefaultExportFromCjs(tuple);var lib={exports:{}};function _extends$2(){return _extends$2=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},_extends$2.apply(this,arguments)}const _extends$3=Object.freeze(Object.defineProperty({__proto__:null,default:_extends$2},Symbol.toStringTag,{value:"Module"})),require$$1=getAugmentedNamespace(_extends$3);var isFunction_1=isFunction$1,toString$1=Object.prototype.toString;function isFunction$1(e){if(!e)return!1;var t=toString$1.call(e);return"[object Function]"===t||"function"==typeof e&&"[object RegExp]"!==t||"undefined"!=typeof window&&(e===window.setTimeout||e===window.alert||e===window.confirm||e===window.prompt)}var window$3=window_1,httpResponseHandler=function(e,t){return void 0===t&&(t=!1),function(n,r,a){if(n)e(n);else if(r.statusCode>=400&&r.statusCode<=599){var i=a;if(t)if(window$3.TextDecoder){var s=getCharset(r.headers&&r.headers["content-type"]);try{i=new TextDecoder(s).decode(a)}catch(e2){}}else i=String.fromCharCode.apply(null,new Uint8Array(a));e({cause:i})}else e(null,a)}};function getCharset(e){return void 0===e&&(e=""),e.toLowerCase().split(";").reduce((function(e,t){var n=t.split("="),r=n[0],a=n[1];return"charset"===r.trim()?a.trim():e}),"utf-8")}var httpHandler=httpResponseHandler,window$2=window_1,_extends$1=require$$1,isFunction=isFunction_1;createXHR.httpHandler=httpHandler;
/**
     * @license
     * slighly modified parse-headers 2.0.2 <https://github.com/kesla/parse-headers/>
     * Copyright (c) 2014 David Björklund
     * Available under the MIT license
     * <https://github.com/kesla/parse-headers/blob/master/LICENCE>
     */
var parseHeaders=function(e){var t={};return e?(e.trim().split("\n").forEach((function(e){var n=e.indexOf(":"),r=e.slice(0,n).trim().toLowerCase(),a=e.slice(n+1).trim();void 0===t[r]?t[r]=a:Array.isArray(t[r])?t[r].push(a):t[r]=[t[r],a]})),t):t};function forEachArray(e,t){for(var n=0;n<e.length;n++)t(e[n])}function isEmpty(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function initParams(e,t,n){var r=e;return isFunction(t)?(n=t,"string"==typeof e&&(r={uri:e})):r=_extends$1({},t,{uri:e}),r.callback=n,r}function createXHR(e,t,n){return _createXHR(t=initParams(e,t,n))}function _createXHR(e){if(void 0===e.callback)throw new Error("callback argument missing");var t=!1,n=function(n,r,a){t||(t=!0,e.callback(n,r,a))};function r(){var e=void 0;if(e=l.response?l.response:l.responseText||getXml(l),m)try{e=JSON.parse(e)}catch(e2){}return e}function a(e){return clearTimeout(u),e instanceof Error||(e=new Error(""+(e||"Unknown XMLHttpRequest Error"))),e.statusCode=0,n(e,g)}function i(){if(!o){var t;clearTimeout(u),t=e.useXDR&&void 0===l.status?200:1223===l.status?204:l.status;var a=g,i=null;return 0!==t?(a={body:r(),statusCode:t,method:h,headers:{},url:c,rawRequest:l},l.getAllResponseHeaders&&(a.headers=parseHeaders(l.getAllResponseHeaders()))):i=new Error("Internal XMLHttpRequest Error"),n(i,a,a.body)}}var s,o,l=e.xhr||null;l||(l=e.cors||e.useXDR?new createXHR.XDomainRequest:new createXHR.XMLHttpRequest);var u,c=l.url=e.uri||e.url,h=l.method=e.method||"GET",d=e.body||e.data,p=l.headers=e.headers||{},f=!!e.sync,m=!1,g={body:void 0,headers:{},statusCode:0,method:h,url:c,rawRequest:l};if("json"in e&&!1!==e.json&&(m=!0,p.accept||p.Accept||(p.Accept="application/json"),"GET"!==h&&"HEAD"!==h&&(p["content-type"]||p["Content-Type"]||(p["Content-Type"]="application/json"),d=JSON.stringify(!0===e.json?d:e.json))),l.onreadystatechange=function(){4===l.readyState&&setTimeout(i,0)},l.onload=i,l.onerror=a,l.onprogress=function(){},l.onabort=function(){o=!0},l.ontimeout=a,l.open(h,c,!f,e.username,e.password),f||(l.withCredentials=!!e.withCredentials),!f&&e.timeout>0&&(u=setTimeout((function(){if(!o){o=!0,l.abort("timeout");var e=new Error("XMLHttpRequest timeout");e.code="ETIMEDOUT",a(e)}}),e.timeout)),l.setRequestHeader)for(s in p)p.hasOwnProperty(s)&&l.setRequestHeader(s,p[s]);else if(e.headers&&!isEmpty(e.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in e&&(l.responseType=e.responseType),"beforeSend"in e&&"function"==typeof e.beforeSend&&e.beforeSend(l),l.send(d||null),l}function getXml(e){try{if("document"===e.responseType)return e.responseXML;var t=e.responseXML&&"parsererror"===e.responseXML.documentElement.nodeName;if(""===e.responseType&&!t)return e.responseXML}catch(e2){}return null}function noop$1(){}lib.exports=createXHR,lib.exports.default=createXHR,createXHR.XMLHttpRequest=window$2.XMLHttpRequest||noop$1,createXHR.XDomainRequest="withCredentials"in new createXHR.XMLHttpRequest?createXHR.XMLHttpRequest:window$2.XDomainRequest,forEachArray(["get","put","post","patch","head","delete"],(function(e){createXHR["delete"===e?"del":e]=function(t,n,r){return(n=initParams(t,n,r)).method=e.toUpperCase(),_createXHR(n)}}));var libExports=lib.exports;const XHR=getDefaultExportFromCjs(libExports);var browserIndex={exports:{}},document$1=document_1,_objCreate=Object.create||function(){function e(){}return function(t){if(1!==arguments.length)throw new Error("Object.create shim only accepts one parameter.");return e.prototype=t,new e}}();function ParsingError(e,t){this.name="ParsingError",this.code=e.code,this.message=t||e.message}function parseTimeStamp(e){function t(e,t,n,r){return 3600*(0|e)+60*(0|t)+(0|n)+(0|r)/1e3}var n=e.match(/^(\d+):(\d{1,2})(:\d{1,2})?\.(\d{3})/);return n?n[3]?t(n[1],n[2],n[3].replace(":",""),n[4]):n[1]>59?t(n[1],n[2],0,n[4]):t(0,n[1],n[2],n[4]):null}function Settings(){this.values=_objCreate(null)}function parseOptions(e,t,n,r){var a=r?e.split(r):[e];for(var i in a)if("string"==typeof a[i]){var s=a[i].split(n);if(2===s.length)t(s[0].trim(),s[1].trim())}}function parseCue(e,t,n){var r=e;function a(){var t=parseTimeStamp(e);if(null===t)throw new ParsingError(ParsingError.Errors.BadTimeStamp,"Malformed timestamp: "+r);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function i(){e=e.replace(/^\s+/,"")}if(i(),t.startTime=a(),i(),"--\x3e"!==e.substr(0,3))throw new ParsingError(ParsingError.Errors.BadTimeStamp,"Malformed time stamp (time stamps must be separated by '--\x3e'): "+r);e=e.substr(3),i(),t.endTime=a(),i(),function(e,t){var r=new Settings;parseOptions(e,(function(e,t){switch(e){case"region":for(var a=n.length-1;a>=0;a--)if(n[a].id===t){r.set(e,n[a].region);break}break;case"vertical":r.alt(e,t,["rl","lr"]);break;case"line":var i=t.split(","),s=i[0];r.integer(e,s),r.percent(e,s)&&r.set("snapToLines",!1),r.alt(e,s,["auto"]),2===i.length&&r.alt("lineAlign",i[1],["start","center","end"]);break;case"position":i=t.split(","),r.percent(e,i[0]),2===i.length&&r.alt("positionAlign",i[1],["start","center","end"]);break;case"size":r.percent(e,t);break;case"align":r.alt(e,t,["start","center","end","left","right"])}}),/:/,/\s/),t.region=r.get("region",null),t.vertical=r.get("vertical","");try{t.line=r.get("line","auto")}catch(e2){}t.lineAlign=r.get("lineAlign","start"),t.snapToLines=r.get("snapToLines",!0),t.size=r.get("size",100);try{t.align=r.get("align","center")}catch(e2){t.align=r.get("align","middle")}try{t.position=r.get("position","auto")}catch(e2){t.position=r.get("position",{start:0,left:0,center:50,middle:50,end:100,right:100},t.align)}t.positionAlign=r.get("positionAlign",{start:"start",left:"start",center:"center",middle:"center",end:"end",right:"end"},t.align)}(e,t)}ParsingError.prototype=_objCreate(Error.prototype),ParsingError.prototype.constructor=ParsingError,ParsingError.Errors={BadSignature:{code:0,message:"Malformed WebVTT signature."},BadTimeStamp:{code:1,message:"Malformed time stamp."}},Settings.prototype={set:function(e,t){this.get(e)||""===t||(this.values[e]=t)},get:function(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t},has:function(e){return e in this.values},alt:function(e,t,n){for(var r=0;r<n.length;++r)if(t===n[r]){this.set(e,t);break}},integer:function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},percent:function(e,t){return!!(t.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(t=parseFloat(t))>=0&&t<=100)&&(this.set(e,t),!0)}};var TEXTAREA_ELEMENT=document$1.createElement&&document$1.createElement("textarea"),TAG_NAME={c:"span",i:"i",b:"b",u:"u",ruby:"ruby",rt:"rt",v:"span",lang:"span"},DEFAULT_COLOR_CLASS={white:"rgba(255,255,255,1)",lime:"rgba(0,255,0,1)",cyan:"rgba(0,255,255,1)",red:"rgba(255,0,0,1)",yellow:"rgba(255,255,0,1)",magenta:"rgba(255,0,255,1)",blue:"rgba(0,0,255,1)",black:"rgba(0,0,0,1)"},TAG_ANNOTATION={v:"title",lang:"lang"},NEEDS_PARENT={rt:"ruby"};function parseContent(e,t){function n(){if(!t)return null;var e,n=t.match(/^([^<]*)(<[^>]*>?)?/);return e=n[1]?n[1]:n[2],t=t.substr(e.length),e}function r(t,n){var r=TAG_NAME[t];if(!r)return null;var a=e.document.createElement(r),i=TAG_ANNOTATION[t];return i&&n&&(a[i]=n.trim()),a}for(var a,i,s,o,l=e.document.createElement("div"),u=l,c=[];null!==(a=n());)if("<"!==a[0])u.appendChild(e.document.createTextNode((i=a,TEXTAREA_ELEMENT.innerHTML=i,i=TEXTAREA_ELEMENT.textContent,TEXTAREA_ELEMENT.textContent="",i)));else{if("/"===a[1]){c.length&&c[c.length-1]===a.substr(2).replace(">","")&&(c.pop(),u=u.parentNode);continue}var h,d=parseTimeStamp(a.substr(1,a.length-2));if(d){h=e.document.createProcessingInstruction("timestamp",d),u.appendChild(h);continue}var p=a.match(/^<([^.\s/0-9>]+)(\.[^\s\\>]+)?([^>\\]+)?(\\?)>?$/);if(!p)continue;if(!(h=r(p[1],p[3])))continue;if(s=u,NEEDS_PARENT[(o=h).localName]&&NEEDS_PARENT[o.localName]!==s.localName)continue;if(p[2]){var f=p[2].split(".");f.forEach((function(e){var t=/^bg_/.test(e),n=t?e.slice(3):e;if(DEFAULT_COLOR_CLASS.hasOwnProperty(n)){var r=t?"background-color":"color",a=DEFAULT_COLOR_CLASS[n];h.style[r]=a}})),h.className=f.join(" ")}c.push(p[1]),u.appendChild(h),u=h}return l}var strongRTLRanges=[[1470,1470],[1472,1472],[1475,1475],[1478,1478],[1488,1514],[1520,1524],[1544,1544],[1547,1547],[1549,1549],[1563,1563],[1566,1610],[1645,1647],[1649,1749],[1765,1766],[1774,1775],[1786,1805],[1807,1808],[1810,1839],[1869,1957],[1969,1969],[1984,2026],[2036,2037],[2042,2042],[2048,2069],[2074,2074],[2084,2084],[2088,2088],[2096,2110],[2112,2136],[2142,2142],[2208,2208],[2210,2220],[8207,8207],[64285,64285],[64287,64296],[64298,64310],[64312,64316],[64318,64318],[64320,64321],[64323,64324],[64326,64449],[64467,64829],[64848,64911],[64914,64967],[65008,65020],[65136,65140],[65142,65276],[67584,67589],[67592,67592],[67594,67637],[67639,67640],[67644,67644],[67647,67669],[67671,67679],[67840,67867],[67872,67897],[67903,67903],[67968,68023],[68030,68031],[68096,68096],[68112,68115],[68117,68119],[68121,68147],[68160,68167],[68176,68184],[68192,68223],[68352,68405],[68416,68437],[68440,68466],[68472,68479],[68608,68680],[126464,126467],[126469,126495],[126497,126498],[126500,126500],[126503,126503],[126505,126514],[126516,126519],[126521,126521],[126523,126523],[126530,126530],[126535,126535],[126537,126537],[126539,126539],[126541,126543],[126545,126546],[126548,126548],[126551,126551],[126553,126553],[126555,126555],[126557,126557],[126559,126559],[126561,126562],[126564,126564],[126567,126570],[126572,126578],[126580,126583],[126585,126588],[126590,126590],[126592,126601],[126603,126619],[126625,126627],[126629,126633],[126635,126651],[1114109,1114109]];function isStrongRTLChar(e){for(var t=0;t<strongRTLRanges.length;t++){var n=strongRTLRanges[t];if(e>=n[0]&&e<=n[1])return!0}return!1}function determineBidi(e){var t=[],n="";if(!e||!e.childNodes)return"ltr";function r(e,t){for(var n=t.childNodes.length-1;n>=0;n--)e.push(t.childNodes[n])}function a(e){if(!e||!e.length)return null;var t=e.pop(),n=t.textContent||t.innerText;if(n){var i=n.match(/^.*(\n|\r)/);return i?(e.length=0,i[0]):n}return"ruby"===t.tagName?a(e):t.childNodes?(r(e,t),a(e)):void 0}for(r(t,e);n=a(t);)for(var i=0;i<n.length;i++)if(isStrongRTLChar(n.charCodeAt(i)))return"rtl";return"ltr"}function computeLinePos(e){if("number"==typeof e.line&&(e.snapToLines||e.line>=0&&e.line<=100))return e.line;if(!e.track||!e.track.textTrackList||!e.track.textTrackList.mediaElement)return-1;for(var t=e.track,n=t.textTrackList,r=0,a=0;a<n.length&&n[a]!==t;a++)"showing"===n[a].mode&&r++;return-1*++r}function StyleBox(){}function CueStyleBox(e,t,n){StyleBox.call(this),this.cue=t,this.cueDiv=parseContent(e,t.text);var r={color:"rgba(255, 255, 255, 1)",backgroundColor:"rgba(0, 0, 0, 0.8)",position:"relative",left:0,right:0,top:0,bottom:0,display:"inline",writingMode:""===t.vertical?"horizontal-tb":"lr"===t.vertical?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext"};this.applyStyles(r,this.cueDiv),this.div=e.document.createElement("div"),r={direction:determineBidi(this.cueDiv),writingMode:""===t.vertical?"horizontal-tb":"lr"===t.vertical?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext",textAlign:"middle"===t.align?"center":t.align,font:n.font,whiteSpace:"pre-line",position:"absolute"},this.applyStyles(r),this.div.appendChild(this.cueDiv);var a=0;switch(t.positionAlign){case"start":case"line-left":a=t.position;break;case"center":a=t.position-t.size/2;break;case"end":case"line-right":a=t.position-t.size}""===t.vertical?this.applyStyles({left:this.formatStyle(a,"%"),width:this.formatStyle(t.size,"%")}):this.applyStyles({top:this.formatStyle(a,"%"),height:this.formatStyle(t.size,"%")}),this.move=function(e){this.applyStyles({top:this.formatStyle(e.top,"px"),bottom:this.formatStyle(e.bottom,"px"),left:this.formatStyle(e.left,"px"),right:this.formatStyle(e.right,"px"),height:this.formatStyle(e.height,"px"),width:this.formatStyle(e.width,"px")})}}function BoxPosition(e){var t,n,r,a;if(e.div){n=e.div.offsetHeight,r=e.div.offsetWidth,a=e.div.offsetTop;var i=(i=e.div.childNodes)&&(i=i[0])&&i.getClientRects&&i.getClientRects();e=e.div.getBoundingClientRect(),t=i?Math.max(i[0]&&i[0].height||0,e.height/i.length):0}this.left=e.left,this.right=e.right,this.top=e.top||a,this.height=e.height||n,this.bottom=e.bottom||a+(e.height||n),this.width=e.width||r,this.lineHeight=void 0!==t?t:e.lineHeight}function moveBoxToLinePosition(e,t,n,r){var a=new BoxPosition(t),i=t.cue,s=computeLinePos(i),o=[];if(i.snapToLines){var l;switch(i.vertical){case"":o=["+y","-y"],l="height";break;case"rl":o=["+x","-x"],l="width";break;case"lr":o=["-x","+x"],l="width"}var u=a.lineHeight,c=u*Math.round(s),h=n[l]+u,d=o[0];Math.abs(c)>h&&(c=c<0?-1:1,c*=Math.ceil(h/u)*u),s<0&&(c+=""===i.vertical?n.height:n.width,o=o.reverse()),a.move(d,c)}else{var p=a.lineHeight/n.height*100;switch(i.lineAlign){case"center":s-=p/2;break;case"end":s-=p}switch(i.vertical){case"":t.applyStyles({top:t.formatStyle(s,"%")});break;case"rl":t.applyStyles({left:t.formatStyle(s,"%")});break;case"lr":t.applyStyles({right:t.formatStyle(s,"%")})}o=["+y","-x","+x","-y"],a=new BoxPosition(t)}var f=function(e,t){for(var a,i=new BoxPosition(e),s=1,o=0;o<t.length;o++){for(;e.overlapsOppositeAxis(n,t[o])||e.within(n)&&e.overlapsAny(r);)e.move(t[o]);if(e.within(n))return e;var l=e.intersectPercentage(n);s>l&&(a=new BoxPosition(e),s=l),e=new BoxPosition(i)}return a||i}(a,o);t.move(f.toCSSCompatValues(n))}function WebVTT$1(){}StyleBox.prototype.applyStyles=function(e,t){for(var n in t=t||this.div,e)e.hasOwnProperty(n)&&(t.style[n]=e[n])},StyleBox.prototype.formatStyle=function(e,t){return 0===e?0:e+t},CueStyleBox.prototype=_objCreate(StyleBox.prototype),CueStyleBox.prototype.constructor=CueStyleBox,BoxPosition.prototype.move=function(e,t){switch(t=void 0!==t?t:this.lineHeight,e){case"+x":this.left+=t,this.right+=t;break;case"-x":this.left-=t,this.right-=t;break;case"+y":this.top+=t,this.bottom+=t;break;case"-y":this.top-=t,this.bottom-=t}},BoxPosition.prototype.overlaps=function(e){return this.left<e.right&&this.right>e.left&&this.top<e.bottom&&this.bottom>e.top},BoxPosition.prototype.overlapsAny=function(e){for(var t=0;t<e.length;t++)if(this.overlaps(e[t]))return!0;return!1},BoxPosition.prototype.within=function(e){return this.top>=e.top&&this.bottom<=e.bottom&&this.left>=e.left&&this.right<=e.right},BoxPosition.prototype.overlapsOppositeAxis=function(e,t){switch(t){case"+x":return this.left<e.left;case"-x":return this.right>e.right;case"+y":return this.top<e.top;case"-y":return this.bottom>e.bottom}},BoxPosition.prototype.intersectPercentage=function(e){return Math.max(0,Math.min(this.right,e.right)-Math.max(this.left,e.left))*Math.max(0,Math.min(this.bottom,e.bottom)-Math.max(this.top,e.top))/(this.height*this.width)},BoxPosition.prototype.toCSSCompatValues=function(e){return{top:this.top-e.top,bottom:e.bottom-this.bottom,left:this.left-e.left,right:e.right-this.right,height:this.height,width:this.width}},BoxPosition.getSimpleBoxPosition=function(e){var t=e.div?e.div.offsetHeight:e.tagName?e.offsetHeight:0,n=e.div?e.div.offsetWidth:e.tagName?e.offsetWidth:0,r=e.div?e.div.offsetTop:e.tagName?e.offsetTop:0;return{left:(e=e.div?e.div.getBoundingClientRect():e.tagName?e.getBoundingClientRect():e).left,right:e.right,top:e.top||r,height:e.height||t,bottom:e.bottom||r+(e.height||t),width:e.width||n}},WebVTT$1.StringDecoder=function(){return{decode:function(e){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}},WebVTT$1.convertCueToDOMTree=function(e,t){return e&&t?parseContent(e,t):null};var FONT_SIZE_PERCENT=.05,FONT_STYLE="sans-serif",CUE_BACKGROUND_PADDING="1.5%";WebVTT$1.processCues=function(e,t,n){if(!e||!t||!n)return null;for(;n.firstChild;)n.removeChild(n.firstChild);var r=e.document.createElement("div");if(r.style.position="absolute",r.style.left="0",r.style.right="0",r.style.top="0",r.style.bottom="0",r.style.margin=CUE_BACKGROUND_PADDING,n.appendChild(r),function(e){for(var t=0;t<e.length;t++)if(e[t].hasBeenReset||!e[t].displayState)return!0;return!1}(t)){var a=[],i=BoxPosition.getSimpleBoxPosition(r),s={font:Math.round(i.height*FONT_SIZE_PERCENT*100)/100+"px "+FONT_STYLE};!function(){for(var n,o,l=0;l<t.length;l++)o=t[l],n=new CueStyleBox(e,o,s),r.appendChild(n.div),moveBoxToLinePosition(e,n,i,a),o.displayState=n.div,a.push(BoxPosition.getSimpleBoxPosition(n))}()}else for(var o=0;o<t.length;o++)r.appendChild(t[o].displayState)},WebVTT$1.Parser=function(e,t,n){n||(n=t,t={}),t||(t={}),this.window=e,this.vttjs=t,this.state="INITIAL",this.buffer="",this.decoder=n||new TextDecoder("utf8"),this.regionList=[]},WebVTT$1.Parser.prototype={reportOrThrowError:function(e){if(!(e instanceof ParsingError))throw e;this.onparsingerror&&this.onparsingerror(e)},parse:function(e){var t=this;function n(){for(var e=t.buffer,n=0;n<e.length&&"\r"!==e[n]&&"\n"!==e[n];)++n;var r=e.substr(0,n);return"\r"===e[n]&&++n,"\n"===e[n]&&++n,t.buffer=e.substr(n),r}function r(e){e.match(/X-TIMESTAMP-MAP/)?parseOptions(e,(function(e,n){if("X-TIMESTAMP-MAP"===e)!function(e){var n=new Settings;parseOptions(e,(function(e,t){switch(e){case"MPEGT":n.integer(e+"S",t);break;case"LOCA":n.set(e+"L",parseTimeStamp(t))}}),/[^\d]:/,/,/),t.ontimestampmap&&t.ontimestampmap({MPEGTS:n.get("MPEGTS"),LOCAL:n.get("LOCAL")})}(n)}),/=/):parseOptions(e,(function(e,n){if("Region"===e)!function(e){var n=new Settings;if(parseOptions(e,(function(e,t){switch(e){case"id":n.set(e,t);break;case"width":n.percent(e,t);break;case"lines":n.integer(e,t);break;case"regionanchor":case"viewportanchor":var r=t.split(",");if(2!==r.length)break;var a=new Settings;if(a.percent("x",r[0]),a.percent("y",r[1]),!a.has("x")||!a.has("y"))break;n.set(e+"X",a.get("x")),n.set(e+"Y",a.get("y"));break;case"scroll":n.alt(e,t,["up"])}}),/=/,/\s/),n.has("id")){var r=new(t.vttjs.VTTRegion||t.window.VTTRegion);r.width=n.get("width",100),r.lines=n.get("lines",3),r.regionAnchorX=n.get("regionanchorX",0),r.regionAnchorY=n.get("regionanchorY",100),r.viewportAnchorX=n.get("viewportanchorX",0),r.viewportAnchorY=n.get("viewportanchorY",100),r.scroll=n.get("scroll",""),t.onregion&&t.onregion(r),t.regionList.push({id:n.get("id"),region:r})}}(n)}),/:/)}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{var a;if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;var i=(a=n()).match(/^WEBVTT([ \t].*)?$/);if(!i||!i[0])throw new ParsingError(ParsingError.Errors.BadSignature);t.state="HEADER"}for(var s=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(s?s=!1:a=n(),t.state){case"HEADER":/:/.test(a)?r(a):a||(t.state="ID");continue;case"NOTE":a||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(a)){t.state="NOTE";break}if(!a)continue;t.cue=new(t.vttjs.VTTCue||t.window.VTTCue)(0,0,"");try{t.cue.align="center"}catch(e2){t.cue.align="middle"}if(t.state="CUE",-1===a.indexOf("--\x3e")){t.cue.id=a;continue}case"CUE":try{parseCue(a,t.cue,t.regionList)}catch(e2){t.reportOrThrowError(e2),t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var o=-1!==a.indexOf("--\x3e");if(!a||o&&(s=!0)){t.oncue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}t.cue.text&&(t.cue.text+="\n"),t.cue.text+=a.replace(/\u2028/g,"\n").replace(/u2029/g,"\n");continue;case"BADCUE":a||(t.state="ID");continue}}}catch(e2){t.reportOrThrowError(e2),"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){var e=this;try{if(e.buffer+=e.decoder.decode(),(e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state)throw new ParsingError(ParsingError.Errors.BadSignature)}catch(e2){e.reportOrThrowError(e2)}return e.onflush&&e.onflush(),this}};var vtt$1=WebVTT$1,autoKeyword="auto",directionSetting={"":1,lr:1,rl:1},alignSetting={start:1,center:1,end:1,left:1,right:1,auto:1,"line-left":1,"line-right":1};function findDirectionSetting(e){return"string"==typeof e&&(!!directionSetting[e.toLowerCase()]&&e.toLowerCase())}function findAlignSetting(e){return"string"==typeof e&&(!!alignSetting[e.toLowerCase()]&&e.toLowerCase())}function VTTCue(e,t,n){this.hasBeenReset=!1;var r="",a=!1,i=e,s=t,o=n,l=null,u="",c=!0,h="auto",d="start",p="auto",f="auto",m=100,g="center";Object.defineProperties(this,{id:{enumerable:!0,get:function(){return r},set:function(e){r=""+e}},pauseOnExit:{enumerable:!0,get:function(){return a},set:function(e){a=!!e}},startTime:{enumerable:!0,get:function(){return i},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");i=e,this.hasBeenReset=!0}},endTime:{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");s=e,this.hasBeenReset=!0}},text:{enumerable:!0,get:function(){return o},set:function(e){o=""+e,this.hasBeenReset=!0}},region:{enumerable:!0,get:function(){return l},set:function(e){l=e,this.hasBeenReset=!0}},vertical:{enumerable:!0,get:function(){return u},set:function(e){var t=findDirectionSetting(e);if(!1===t)throw new SyntaxError("Vertical: an invalid or illegal direction string was specified.");u=t,this.hasBeenReset=!0}},snapToLines:{enumerable:!0,get:function(){return c},set:function(e){c=!!e,this.hasBeenReset=!0}},line:{enumerable:!0,get:function(){return h},set:function(e){if("number"!=typeof e&&e!==autoKeyword)throw new SyntaxError("Line: an invalid number or illegal string was specified.");h=e,this.hasBeenReset=!0}},lineAlign:{enumerable:!0,get:function(){return d},set:function(e){var t=findAlignSetting(e);t?(d=t,this.hasBeenReset=!0):console.warn("lineAlign: an invalid or illegal string was specified.")}},position:{enumerable:!0,get:function(){return p},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");p=e,this.hasBeenReset=!0}},positionAlign:{enumerable:!0,get:function(){return f},set:function(e){var t=findAlignSetting(e);t?(f=t,this.hasBeenReset=!0):console.warn("positionAlign: an invalid or illegal string was specified.")}},size:{enumerable:!0,get:function(){return m},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");m=e,this.hasBeenReset=!0}},align:{enumerable:!0,get:function(){return g},set:function(e){var t=findAlignSetting(e);if(!t)throw new SyntaxError("align: an invalid or illegal alignment string was specified.");g=t,this.hasBeenReset=!0}}}),this.displayState=void 0}VTTCue.prototype.getCueAsHTML=function(){return WebVTT.convertCueToDOMTree(window,this.text)};var vttcue=VTTCue,scrollSetting={"":!0,up:!0};function findScrollSetting(e){return"string"==typeof e&&(!!scrollSetting[e.toLowerCase()]&&e.toLowerCase())}function isValidPercentValue(e){return"number"==typeof e&&e>=0&&e<=100}function VTTRegion(){var e=100,t=3,n=0,r=100,a=0,i=100,s="";Object.defineProperties(this,{width:{enumerable:!0,get:function(){return e},set:function(t){if(!isValidPercentValue(t))throw new Error("Width must be between 0 and 100.");e=t}},lines:{enumerable:!0,get:function(){return t},set:function(e){if("number"!=typeof e)throw new TypeError("Lines must be set to a number.");t=e}},regionAnchorY:{enumerable:!0,get:function(){return r},set:function(e){if(!isValidPercentValue(e))throw new Error("RegionAnchorX must be between 0 and 100.");r=e}},regionAnchorX:{enumerable:!0,get:function(){return n},set:function(e){if(!isValidPercentValue(e))throw new Error("RegionAnchorY must be between 0 and 100.");n=e}},viewportAnchorY:{enumerable:!0,get:function(){return i},set:function(e){if(!isValidPercentValue(e))throw new Error("ViewportAnchorY must be between 0 and 100.");i=e}},viewportAnchorX:{enumerable:!0,get:function(){return a},set:function(e){if(!isValidPercentValue(e))throw new Error("ViewportAnchorX must be between 0 and 100.");a=e}},scroll:{enumerable:!0,get:function(){return s},set:function(e){var t=findScrollSetting(e);!1===t?console.warn("Scroll: an invalid or illegal string was specified."):s=t}}})}var vttregion=VTTRegion,window$1=window_1,vttjs=browserIndex.exports={WebVTT:vtt$1,VTTCue:vttcue,VTTRegion:vttregion};window$1.vttjs=vttjs,window$1.WebVTT=vttjs.WebVTT;var cueShim=vttjs.VTTCue,regionShim=vttjs.VTTRegion,nativeVTTCue=window$1.VTTCue,nativeVTTRegion=window$1.VTTRegion;vttjs.shim=function(){window$1.VTTCue=cueShim,window$1.VTTRegion=regionShim},vttjs.restore=function(){window$1.VTTCue=nativeVTTCue,window$1.VTTRegion=nativeVTTRegion},window$1.VTTCue||vttjs.shim();var browserIndexExports=browserIndex.exports;const vtt=getDefaultExportFromCjs(browserIndexExports);var urlToolkit={exports:{}};!function(e,t){var n,r,a,i,s;n=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,r=/^(?=([^\/?#]*))\1([^]*)$/,a=/(?:\/|^)\.(?=\/)/g,i=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,s={buildAbsoluteURL:function(e,t,n){if(n=n||{},e=e.trim(),!(t=t.trim())){if(!n.alwaysNormalize)return e;var a=s.parseURL(e);if(!a)throw new Error("Error trying to parse base URL.");return a.path=s.normalizePath(a.path),s.buildURLFromParts(a)}var i=s.parseURL(t);if(!i)throw new Error("Error trying to parse relative URL.");if(i.scheme)return n.alwaysNormalize?(i.path=s.normalizePath(i.path),s.buildURLFromParts(i)):t;var o=s.parseURL(e);if(!o)throw new Error("Error trying to parse base URL.");if(!o.netLoc&&o.path&&"/"!==o.path[0]){var l=r.exec(o.path);o.netLoc=l[1],o.path=l[2]}o.netLoc&&!o.path&&(o.path="/");var u={scheme:o.scheme,netLoc:i.netLoc,path:null,params:i.params,query:i.query,fragment:i.fragment};if(!i.netLoc&&(u.netLoc=o.netLoc,"/"!==i.path[0]))if(i.path){var c=o.path,h=c.substring(0,c.lastIndexOf("/")+1)+i.path;u.path=s.normalizePath(h)}else u.path=o.path,i.params||(u.params=o.params,i.query||(u.query=o.query));return null===u.path&&(u.path=n.alwaysNormalize?s.normalizePath(i.path):i.path),s.buildURLFromParts(u)},parseURL:function(e){var t=n.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(a,"");e.length!==(e=e.replace(i,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}},e.exports=s}(urlToolkit);var urlToolkitExports=urlToolkit.exports;const URLToolkit=getDefaultExportFromCjs(urlToolkitExports);var DEFAULT_LOCATION="http://example.com",resolveUrl$1=function(e,t){if(/^[a-z]+:/i.test(t))return t;/^data:/.test(e)&&(e=window$1$1.location&&window$1$1.location.href||"");var n="function"==typeof window$1$1.URL,r=/^\/\//.test(e),a=!window$1$1.location&&!/\/\//i.test(e);if(n?e=new window$1$1.URL(e,window$1$1.location||DEFAULT_LOCATION):/\/\//i.test(e)||(e=URLToolkit.buildAbsoluteURL(window$1$1.location&&window$1$1.location.href||"",e)),n){var i=new URL(t,e);return a?i.href.slice(DEFAULT_LOCATION.length):r?i.href.slice(i.protocol.length):i.href}return URLToolkit.buildAbsoluteURL(e,t)},Stream=function(){function e(){this.listeners={}}var t=e.prototype;return t.on=function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)},t.off=function(e,t){if(!this.listeners[e])return!1;var n=this.listeners[e].indexOf(t);return this.listeners[e]=this.listeners[e].slice(0),this.listeners[e].splice(n,1),n>-1},t.trigger=function(e){var t=this.listeners[e];if(t)if(2===arguments.length)for(var n=t.length,r=0;r<n;++r)t[r].call(this,arguments[1]);else for(var a=Array.prototype.slice.call(arguments,1),i=t.length,s=0;s<i;++s)t[s].apply(this,a)},t.dispose=function(){this.listeners={}},t.pipe=function(e){this.on("data",(function(t){e.push(t)}))},e}(),atob$2=function(e){return window$1$1.atob?window$1$1.atob(e):Buffer.from(e,"base64").toString("binary")};function decodeB64ToUint8Array$1(e){for(var t=atob$2(e),n=new Uint8Array(t.length),r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n}
/*! @name m3u8-parser @version 7.1.0 @license Apache-2.0 */class LineStream extends Stream{constructor(){super(),this.buffer=""}push(e){let t;for(this.buffer+=e,t=this.buffer.indexOf("\n");t>-1;t=this.buffer.indexOf("\n"))this.trigger("data",this.buffer.substring(0,t)),this.buffer=this.buffer.substring(t+1)}}const TAB=String.fromCharCode(9),parseByterange=function(e){const t=/([0-9.]*)?@?([0-9.]*)?/.exec(e||""),n={};return t[1]&&(n.length=parseInt(t[1],10)),t[2]&&(n.offset=parseInt(t[2],10)),n},attributeSeparator=function(){return new RegExp('(?:^|,)((?:[^=]*)=(?:"[^"]*"|[^,]*))')},parseAttributes$1=function(e){const t={};if(!e)return t;const n=e.split(attributeSeparator());let r,a=n.length;for(;a--;)""!==n[a]&&(r=/([^=]*)=(.*)/.exec(n[a]).slice(1),r[0]=r[0].replace(/^\s+|\s+$/g,""),r[1]=r[1].replace(/^\s+|\s+$/g,""),r[1]=r[1].replace(/^['"](.*)['"]$/g,"$1"),t[r[0]]=r[1]);return t};class ParseStream extends Stream{constructor(){super(),this.customParsers=[],this.tagMappers=[]}push(e){let t,n;if(0===(e=e.trim()).length)return;if("#"!==e[0])return void this.trigger("data",{type:"uri",uri:e});this.tagMappers.reduce(((t,n)=>{const r=n(e);return r===e?t:t.concat([r])}),[e]).forEach((e=>{for(let t=0;t<this.customParsers.length;t++)if(this.customParsers[t].call(this,e))return;if(0===e.indexOf("#EXT"))if(e=e.replace("\r",""),t=/^#EXTM3U/.exec(e),t)this.trigger("data",{type:"tag",tagType:"m3u"});else{if(t=/^#EXTINF:([0-9\.]*)?,?(.*)?$/.exec(e),t)return n={type:"tag",tagType:"inf"},t[1]&&(n.duration=parseFloat(t[1])),t[2]&&(n.title=t[2]),void this.trigger("data",n);if(t=/^#EXT-X-TARGETDURATION:([0-9.]*)?/.exec(e),t)return n={type:"tag",tagType:"targetduration"},t[1]&&(n.duration=parseInt(t[1],10)),void this.trigger("data",n);if(t=/^#EXT-X-VERSION:([0-9.]*)?/.exec(e),t)return n={type:"tag",tagType:"version"},t[1]&&(n.version=parseInt(t[1],10)),void this.trigger("data",n);if(t=/^#EXT-X-MEDIA-SEQUENCE:(\-?[0-9.]*)?/.exec(e),t)return n={type:"tag",tagType:"media-sequence"},t[1]&&(n.number=parseInt(t[1],10)),void this.trigger("data",n);if(t=/^#EXT-X-DISCONTINUITY-SEQUENCE:(\-?[0-9.]*)?/.exec(e),t)return n={type:"tag",tagType:"discontinuity-sequence"},t[1]&&(n.number=parseInt(t[1],10)),void this.trigger("data",n);if(t=/^#EXT-X-PLAYLIST-TYPE:(.*)?$/.exec(e),t)return n={type:"tag",tagType:"playlist-type"},t[1]&&(n.playlistType=t[1]),void this.trigger("data",n);if(t=/^#EXT-X-BYTERANGE:(.*)?$/.exec(e),t)return n=_extends$2(parseByterange(t[1]),{type:"tag",tagType:"byterange"}),void this.trigger("data",n);if(t=/^#EXT-X-ALLOW-CACHE:(YES|NO)?/.exec(e),t)return n={type:"tag",tagType:"allow-cache"},t[1]&&(n.allowed=!/NO/.test(t[1])),void this.trigger("data",n);if(t=/^#EXT-X-MAP:(.*)$/.exec(e),t){if(n={type:"tag",tagType:"map"},t[1]){const e=parseAttributes$1(t[1]);e.URI&&(n.uri=e.URI),e.BYTERANGE&&(n.byterange=parseByterange(e.BYTERANGE))}this.trigger("data",n)}else if(t=/^#EXT-X-STREAM-INF:(.*)$/.exec(e),t){if(n={type:"tag",tagType:"stream-inf"},t[1]){if(n.attributes=parseAttributes$1(t[1]),n.attributes.RESOLUTION){const e=n.attributes.RESOLUTION.split("x"),t={};e[0]&&(t.width=parseInt(e[0],10)),e[1]&&(t.height=parseInt(e[1],10)),n.attributes.RESOLUTION=t}n.attributes.BANDWIDTH&&(n.attributes.BANDWIDTH=parseInt(n.attributes.BANDWIDTH,10)),n.attributes["FRAME-RATE"]&&(n.attributes["FRAME-RATE"]=parseFloat(n.attributes["FRAME-RATE"])),n.attributes["PROGRAM-ID"]&&(n.attributes["PROGRAM-ID"]=parseInt(n.attributes["PROGRAM-ID"],10))}this.trigger("data",n)}else{if(t=/^#EXT-X-MEDIA:(.*)$/.exec(e),t)return n={type:"tag",tagType:"media"},t[1]&&(n.attributes=parseAttributes$1(t[1])),void this.trigger("data",n);if(t=/^#EXT-X-ENDLIST/.exec(e),t)this.trigger("data",{type:"tag",tagType:"endlist"});else if(t=/^#EXT-X-DISCONTINUITY/.exec(e),t)this.trigger("data",{type:"tag",tagType:"discontinuity"});else{if(t=/^#EXT-X-PROGRAM-DATE-TIME:(.*)$/.exec(e),t)return n={type:"tag",tagType:"program-date-time"},t[1]&&(n.dateTimeString=t[1],n.dateTimeObject=new Date(t[1])),void this.trigger("data",n);if(t=/^#EXT-X-KEY:(.*)$/.exec(e),t)return n={type:"tag",tagType:"key"},t[1]&&(n.attributes=parseAttributes$1(t[1]),n.attributes.IV&&("0x"===n.attributes.IV.substring(0,2).toLowerCase()&&(n.attributes.IV=n.attributes.IV.substring(2)),n.attributes.IV=n.attributes.IV.match(/.{8}/g),n.attributes.IV[0]=parseInt(n.attributes.IV[0],16),n.attributes.IV[1]=parseInt(n.attributes.IV[1],16),n.attributes.IV[2]=parseInt(n.attributes.IV[2],16),n.attributes.IV[3]=parseInt(n.attributes.IV[3],16),n.attributes.IV=new Uint32Array(n.attributes.IV))),void this.trigger("data",n);if(t=/^#EXT-X-START:(.*)$/.exec(e),t)return n={type:"tag",tagType:"start"},t[1]&&(n.attributes=parseAttributes$1(t[1]),n.attributes["TIME-OFFSET"]=parseFloat(n.attributes["TIME-OFFSET"]),n.attributes.PRECISE=/YES/.test(n.attributes.PRECISE)),void this.trigger("data",n);if(t=/^#EXT-X-CUE-OUT-CONT:(.*)?$/.exec(e),t)return n={type:"tag",tagType:"cue-out-cont"},t[1]?n.data=t[1]:n.data="",void this.trigger("data",n);if(t=/^#EXT-X-CUE-OUT:(.*)?$/.exec(e),t)return n={type:"tag",tagType:"cue-out"},t[1]?n.data=t[1]:n.data="",void this.trigger("data",n);if(t=/^#EXT-X-CUE-IN:(.*)?$/.exec(e),t)return n={type:"tag",tagType:"cue-in"},t[1]?n.data=t[1]:n.data="",void this.trigger("data",n);if(t=/^#EXT-X-SKIP:(.*)$/.exec(e),t&&t[1])return n={type:"tag",tagType:"skip"},n.attributes=parseAttributes$1(t[1]),n.attributes.hasOwnProperty("SKIPPED-SEGMENTS")&&(n.attributes["SKIPPED-SEGMENTS"]=parseInt(n.attributes["SKIPPED-SEGMENTS"],10)),n.attributes.hasOwnProperty("RECENTLY-REMOVED-DATERANGES")&&(n.attributes["RECENTLY-REMOVED-DATERANGES"]=n.attributes["RECENTLY-REMOVED-DATERANGES"].split(TAB)),void this.trigger("data",n);if(t=/^#EXT-X-PART:(.*)$/.exec(e),t&&t[1])return n={type:"tag",tagType:"part"},n.attributes=parseAttributes$1(t[1]),["DURATION"].forEach((function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=parseFloat(n.attributes[e]))})),["INDEPENDENT","GAP"].forEach((function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=/YES/.test(n.attributes[e]))})),n.attributes.hasOwnProperty("BYTERANGE")&&(n.attributes.byterange=parseByterange(n.attributes.BYTERANGE)),void this.trigger("data",n);if(t=/^#EXT-X-SERVER-CONTROL:(.*)$/.exec(e),t&&t[1])return n={type:"tag",tagType:"server-control"},n.attributes=parseAttributes$1(t[1]),["CAN-SKIP-UNTIL","PART-HOLD-BACK","HOLD-BACK"].forEach((function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=parseFloat(n.attributes[e]))})),["CAN-SKIP-DATERANGES","CAN-BLOCK-RELOAD"].forEach((function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=/YES/.test(n.attributes[e]))})),void this.trigger("data",n);if(t=/^#EXT-X-PART-INF:(.*)$/.exec(e),t&&t[1])return n={type:"tag",tagType:"part-inf"},n.attributes=parseAttributes$1(t[1]),["PART-TARGET"].forEach((function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=parseFloat(n.attributes[e]))})),void this.trigger("data",n);if(t=/^#EXT-X-PRELOAD-HINT:(.*)$/.exec(e),t&&t[1])return n={type:"tag",tagType:"preload-hint"},n.attributes=parseAttributes$1(t[1]),["BYTERANGE-START","BYTERANGE-LENGTH"].forEach((function(e){if(n.attributes.hasOwnProperty(e)){n.attributes[e]=parseInt(n.attributes[e],10);const t="BYTERANGE-LENGTH"===e?"length":"offset";n.attributes.byterange=n.attributes.byterange||{},n.attributes.byterange[t]=n.attributes[e],delete n.attributes[e]}})),void this.trigger("data",n);if(t=/^#EXT-X-RENDITION-REPORT:(.*)$/.exec(e),t&&t[1])return n={type:"tag",tagType:"rendition-report"},n.attributes=parseAttributes$1(t[1]),["LAST-MSN","LAST-PART"].forEach((function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=parseInt(n.attributes[e],10))})),void this.trigger("data",n);if(t=/^#EXT-X-DATERANGE:(.*)$/.exec(e),t&&t[1]){n={type:"tag",tagType:"daterange"},n.attributes=parseAttributes$1(t[1]),["ID","CLASS"].forEach((function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=String(n.attributes[e]))})),["START-DATE","END-DATE"].forEach((function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=new Date(n.attributes[e]))})),["DURATION","PLANNED-DURATION"].forEach((function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=parseFloat(n.attributes[e]))})),["END-ON-NEXT"].forEach((function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=/YES/i.test(n.attributes[e]))})),["SCTE35-CMD"," SCTE35-OUT","SCTE35-IN"].forEach((function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=n.attributes[e].toString(16))}));const e=/^X-([A-Z]+-)+[A-Z]+$/;for(const t in n.attributes){if(!e.test(t))continue;const r=/[0-9A-Fa-f]{6}/g.test(n.attributes[t]),a=/^\d+(\.\d+)?$/.test(n.attributes[t]);n.attributes[t]=r?n.attributes[t].toString(16):a?parseFloat(n.attributes[t]):String(n.attributes[t])}this.trigger("data",n)}else if(t=/^#EXT-X-INDEPENDENT-SEGMENTS/.exec(e),t)this.trigger("data",{type:"tag",tagType:"independent-segments"});else{if(t=/^#EXT-X-CONTENT-STEERING:(.*)$/.exec(e),t)return n={type:"tag",tagType:"content-steering"},n.attributes=parseAttributes$1(t[1]),void this.trigger("data",n);this.trigger("data",{type:"tag",data:e.slice(4)})}}}}else this.trigger("data",{type:"comment",text:e.slice(1)})}))}addParser({expression:e,customType:t,dataParser:n,segment:r}){"function"!=typeof n&&(n=e=>e),this.customParsers.push((a=>{if(e.exec(a))return this.trigger("data",{type:"custom",data:n(a),customType:t,segment:r}),!0}))}addTagMapper({expression:e,map:t}){this.tagMappers.push((n=>e.test(n)?t(n):n))}}const camelCase=e=>e.toLowerCase().replace(/-(\w)/g,(e=>e[1].toUpperCase())),camelCaseKeys=function(e){const t={};return Object.keys(e).forEach((function(n){t[camelCase(n)]=e[n]})),t},setHoldBack=function(e){const{serverControl:t,targetDuration:n,partTargetDuration:r}=e;if(!t)return;const a="#EXT-X-SERVER-CONTROL",i="holdBack",s="partHoldBack",o=n&&3*n,l=r&&2*r;n&&!t.hasOwnProperty(i)&&(t[i]=o,this.trigger("info",{message:`${a} defaulting HOLD-BACK to targetDuration * 3 (${o}).`})),o&&t[i]<o&&(this.trigger("warn",{message:`${a} clamping HOLD-BACK (${t[i]}) to targetDuration * 3 (${o})`}),t[i]=o),r&&!t.hasOwnProperty(s)&&(t[s]=3*r,this.trigger("info",{message:`${a} defaulting PART-HOLD-BACK to partTargetDuration * 3 (${t[s]}).`})),r&&t[s]<l&&(this.trigger("warn",{message:`${a} clamping PART-HOLD-BACK (${t[s]}) to partTargetDuration * 2 (${l}).`}),t[s]=l)};class Parser extends Stream{constructor(){super(),this.lineStream=new LineStream,this.parseStream=new ParseStream,this.lineStream.pipe(this.parseStream),this.lastProgramDateTime=null;const e=this,t=[];let n,r,a={},i=!1;const s=function(){},o={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}};let l=0;this.manifest={allowCache:!0,discontinuityStarts:[],dateRanges:[],segments:[]};let u=0,c=0;const h={};this.on("end",(()=>{a.uri||!a.parts&&!a.preloadHints||(!a.map&&n&&(a.map=n),!a.key&&r&&(a.key=r),a.timeline||"number"!=typeof l||(a.timeline=l),this.manifest.preloadSegment=a)})),this.parseStream.on("data",(function(d){let p,f;({tag(){({version(){d.version&&(this.manifest.version=d.version)},"allow-cache"(){this.manifest.allowCache=d.allowed,"allowed"in d||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange(){const e={};"length"in d&&(a.byterange=e,e.length=d.length,"offset"in d||(d.offset=u)),"offset"in d&&(a.byterange=e,e.offset=d.offset),u=e.offset+e.length},endlist(){this.manifest.endList=!0},inf(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"})),d.title&&(a.title=d.title),d.duration>0&&(a.duration=d.duration),0===d.duration&&(a.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"})),this.manifest.segments=t},key(){if(d.attributes)if("NONE"!==d.attributes.METHOD)if(d.attributes.URI){if("com.apple.streamingkeydelivery"===d.attributes.KEYFORMAT)return this.manifest.contentProtection=this.manifest.contentProtection||{},void(this.manifest.contentProtection["com.apple.fps.1_0"]={attributes:d.attributes});if("com.microsoft.playready"===d.attributes.KEYFORMAT)return this.manifest.contentProtection=this.manifest.contentProtection||{},void(this.manifest.contentProtection["com.microsoft.playready"]={uri:d.attributes.URI});if("urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"===d.attributes.KEYFORMAT){return-1===["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"].indexOf(d.attributes.METHOD)?void this.trigger("warn",{message:"invalid key method provided for Widevine"}):("SAMPLE-AES-CENC"===d.attributes.METHOD&&this.trigger("warn",{message:"SAMPLE-AES-CENC is deprecated, please use SAMPLE-AES-CTR instead"}),"data:text/plain;base64,"!==d.attributes.URI.substring(0,23)?void this.trigger("warn",{message:"invalid key URI provided for Widevine"}):d.attributes.KEYID&&"0x"===d.attributes.KEYID.substring(0,2)?(this.manifest.contentProtection=this.manifest.contentProtection||{},void(this.manifest.contentProtection["com.widevine.alpha"]={attributes:{schemeIdUri:d.attributes.KEYFORMAT,keyId:d.attributes.KEYID.substring(2)},pssh:decodeB64ToUint8Array$1(d.attributes.URI.split(",")[1])})):void this.trigger("warn",{message:"invalid key ID provided for Widevine"}))}d.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),r={method:d.attributes.METHOD||"AES-128",uri:d.attributes.URI},void 0!==d.attributes.IV&&(r.iv=d.attributes.IV)}else this.trigger("warn",{message:"ignoring key declaration without URI"});else r=null;else this.trigger("warn",{message:"ignoring key declaration without attribute list"})},"media-sequence"(){isFinite(d.number)?this.manifest.mediaSequence=d.number:this.trigger("warn",{message:"ignoring invalid media sequence: "+d.number})},"discontinuity-sequence"(){isFinite(d.number)?(this.manifest.discontinuitySequence=d.number,l=d.number):this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+d.number})},"playlist-type"(){/VOD|EVENT/.test(d.playlistType)?this.manifest.playlistType=d.playlistType:this.trigger("warn",{message:"ignoring unknown playlist type: "+d.playlist})},map(){n={},d.uri&&(n.uri=d.uri),d.byterange&&(n.byterange=d.byterange),r&&(n.key=r)},"stream-inf"(){this.manifest.playlists=t,this.manifest.mediaGroups=this.manifest.mediaGroups||o,d.attributes?(a.attributes||(a.attributes={}),_extends$2(a.attributes,d.attributes)):this.trigger("warn",{message:"ignoring empty stream-inf attributes"})},media(){if(this.manifest.mediaGroups=this.manifest.mediaGroups||o,!(d.attributes&&d.attributes.TYPE&&d.attributes["GROUP-ID"]&&d.attributes.NAME))return void this.trigger("warn",{message:"ignoring incomplete or missing media group"});const e=this.manifest.mediaGroups[d.attributes.TYPE];e[d.attributes["GROUP-ID"]]=e[d.attributes["GROUP-ID"]]||{},p=e[d.attributes["GROUP-ID"]],f={default:/yes/i.test(d.attributes.DEFAULT)},f.default?f.autoselect=!0:f.autoselect=/yes/i.test(d.attributes.AUTOSELECT),d.attributes.LANGUAGE&&(f.language=d.attributes.LANGUAGE),d.attributes.URI&&(f.uri=d.attributes.URI),d.attributes["INSTREAM-ID"]&&(f.instreamId=d.attributes["INSTREAM-ID"]),d.attributes.CHARACTERISTICS&&(f.characteristics=d.attributes.CHARACTERISTICS),d.attributes.FORCED&&(f.forced=/yes/i.test(d.attributes.FORCED)),p[d.attributes.NAME]=f},discontinuity(){l+=1,a.discontinuity=!0,this.manifest.discontinuityStarts.push(t.length)},"program-date-time"(){void 0===this.manifest.dateTimeString&&(this.manifest.dateTimeString=d.dateTimeString,this.manifest.dateTimeObject=d.dateTimeObject),a.dateTimeString=d.dateTimeString,a.dateTimeObject=d.dateTimeObject;const{lastProgramDateTime:e}=this;this.lastProgramDateTime=new Date(d.dateTimeString).getTime(),null===e&&this.manifest.segments.reduceRight(((e,t)=>(t.programDateTime=e-1e3*t.duration,t.programDateTime)),this.lastProgramDateTime)},targetduration(){!isFinite(d.duration)||d.duration<0?this.trigger("warn",{message:"ignoring invalid target duration: "+d.duration}):(this.manifest.targetDuration=d.duration,setHoldBack.call(this,this.manifest))},start(){d.attributes&&!isNaN(d.attributes["TIME-OFFSET"])?this.manifest.start={timeOffset:d.attributes["TIME-OFFSET"],precise:d.attributes.PRECISE}:this.trigger("warn",{message:"ignoring start declaration without appropriate attribute list"})},"cue-out"(){a.cueOut=d.data},"cue-out-cont"(){a.cueOutCont=d.data},"cue-in"(){a.cueIn=d.data},skip(){this.manifest.skip=camelCaseKeys(d.attributes),this.warnOnMissingAttributes_("#EXT-X-SKIP",d.attributes,["SKIPPED-SEGMENTS"])},part(){i=!0;const e=this.manifest.segments.length,t=camelCaseKeys(d.attributes);a.parts=a.parts||[],a.parts.push(t),t.byterange&&(t.byterange.hasOwnProperty("offset")||(t.byterange.offset=c),c=t.byterange.offset+t.byterange.length);const n=a.parts.length-1;this.warnOnMissingAttributes_(`#EXT-X-PART #${n} for segment #${e}`,d.attributes,["URI","DURATION"]),this.manifest.renditionReports&&this.manifest.renditionReports.forEach(((e,t)=>{e.hasOwnProperty("lastPart")||this.trigger("warn",{message:`#EXT-X-RENDITION-REPORT #${t} lacks required attribute(s): LAST-PART`})}))},"server-control"(){const e=this.manifest.serverControl=camelCaseKeys(d.attributes);e.hasOwnProperty("canBlockReload")||(e.canBlockReload=!1,this.trigger("info",{message:"#EXT-X-SERVER-CONTROL defaulting CAN-BLOCK-RELOAD to false"})),setHoldBack.call(this,this.manifest),e.canSkipDateranges&&!e.hasOwnProperty("canSkipUntil")&&this.trigger("warn",{message:"#EXT-X-SERVER-CONTROL lacks required attribute CAN-SKIP-UNTIL which is required when CAN-SKIP-DATERANGES is set"})},"preload-hint"(){const e=this.manifest.segments.length,t=camelCaseKeys(d.attributes),n=t.type&&"PART"===t.type;a.preloadHints=a.preloadHints||[],a.preloadHints.push(t),t.byterange&&(t.byterange.hasOwnProperty("offset")||(t.byterange.offset=n?c:0,n&&(c=t.byterange.offset+t.byterange.length)));const r=a.preloadHints.length-1;if(this.warnOnMissingAttributes_(`#EXT-X-PRELOAD-HINT #${r} for segment #${e}`,d.attributes,["TYPE","URI"]),t.type)for(let i=0;i<a.preloadHints.length-1;i++){const n=a.preloadHints[i];n.type&&(n.type===t.type&&this.trigger("warn",{message:`#EXT-X-PRELOAD-HINT #${r} for segment #${e} has the same TYPE ${t.type} as preload hint #${i}`}))}},"rendition-report"(){const e=camelCaseKeys(d.attributes);this.manifest.renditionReports=this.manifest.renditionReports||[],this.manifest.renditionReports.push(e);const t=this.manifest.renditionReports.length-1,n=["LAST-MSN","URI"];i&&n.push("LAST-PART"),this.warnOnMissingAttributes_(`#EXT-X-RENDITION-REPORT #${t}`,d.attributes,n)},"part-inf"(){this.manifest.partInf=camelCaseKeys(d.attributes),this.warnOnMissingAttributes_("#EXT-X-PART-INF",d.attributes,["PART-TARGET"]),this.manifest.partInf.partTarget&&(this.manifest.partTargetDuration=this.manifest.partInf.partTarget),setHoldBack.call(this,this.manifest)},daterange(){this.manifest.dateRanges.push(camelCaseKeys(d.attributes));const e=this.manifest.dateRanges.length-1;this.warnOnMissingAttributes_(`#EXT-X-DATERANGE #${e}`,d.attributes,["ID","START-DATE"]);const t=this.manifest.dateRanges[e];t.endDate&&t.startDate&&new Date(t.endDate)<new Date(t.startDate)&&this.trigger("warn",{message:"EXT-X-DATERANGE END-DATE must be equal to or later than the value of the START-DATE"}),t.duration&&t.duration<0&&this.trigger("warn",{message:"EXT-X-DATERANGE DURATION must not be negative"}),t.plannedDuration&&t.plannedDuration<0&&this.trigger("warn",{message:"EXT-X-DATERANGE PLANNED-DURATION must not be negative"});const n=!!t.endOnNext;if(n&&!t.class&&this.trigger("warn",{message:"EXT-X-DATERANGE with an END-ON-NEXT=YES attribute must have a CLASS attribute"}),n&&(t.duration||t.endDate)&&this.trigger("warn",{message:"EXT-X-DATERANGE with an END-ON-NEXT=YES attribute must not contain DURATION or END-DATE attributes"}),t.duration&&t.endDate){const n=t.startDate.getTime()+1e3*t.duration;this.manifest.dateRanges[e].endDate=new Date(n)}if(h[t.id]){for(const n in h[t.id])if(t[n]&&JSON.stringify(h[t.id][n])!==JSON.stringify(t[n])){this.trigger("warn",{message:"EXT-X-DATERANGE tags with the same ID in a playlist must have the same attributes values"});break}const e=this.manifest.dateRanges.findIndex((e=>e.id===t.id));this.manifest.dateRanges[e]=_extends$2(this.manifest.dateRanges[e],t),h[t.id]=_extends$2(h[t.id],t),this.manifest.dateRanges.pop()}else h[t.id]=t},"independent-segments"(){this.manifest.independentSegments=!0},"content-steering"(){this.manifest.contentSteering=camelCaseKeys(d.attributes),this.warnOnMissingAttributes_("#EXT-X-CONTENT-STEERING",d.attributes,["SERVER-URI"])}}[d.tagType]||s).call(e)},uri(){a.uri=d.uri,t.push(a),this.manifest.targetDuration&&!("duration"in a)&&(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),a.duration=this.manifest.targetDuration),r&&(a.key=r),a.timeline=l,n&&(a.map=n),c=0,null!==this.lastProgramDateTime&&(a.programDateTime=this.lastProgramDateTime,this.lastProgramDateTime+=1e3*a.duration),a={}},comment(){},custom(){d.segment?(a.custom=a.custom||{},a.custom[d.customType]=d.data):(this.manifest.custom=this.manifest.custom||{},this.manifest.custom[d.customType]=d.data)}})[d.type].call(e)}))}warnOnMissingAttributes_(e,t,n){const r=[];n.forEach((function(e){t.hasOwnProperty(e)||r.push(e)})),r.length&&this.trigger("warn",{message:`${e} lacks required attribute(s): ${r.join(", ")}`})}push(e){this.lineStream.push(e)}end(){this.lineStream.push("\n"),this.manifest.dateRanges.length&&null===this.lastProgramDateTime&&this.trigger("warn",{message:"A playlist with EXT-X-DATERANGE tag must contain atleast one EXT-X-PROGRAM-DATE-TIME tag"}),this.lastProgramDateTime=null,this.trigger("end")}addParser(e){this.parseStream.addParser(e)}addTagMapper(e){this.parseStream.addTagMapper(e)}}var regexs={mp4:/^(av0?1|avc0?[1234]|vp0?9|flac|opus|mp3|mp4a|mp4v|stpp.ttml.im1t)/,webm:/^(vp0?[89]|av0?1|opus|vorbis)/,ogg:/^(vp0?[89]|theora|flac|opus|vorbis)/,video:/^(av0?1|avc0?[1234]|vp0?[89]|hvc1|hev1|theora|mp4v)/,audio:/^(mp4a|flac|vorbis|opus|ac-[34]|ec-3|alac|mp3|speex|aac)/,text:/^(stpp.ttml.im1t)/,muxerVideo:/^(avc0?1)/,muxerAudio:/^(mp4a)/,muxerText:/a^/},mediaTypes=["video","audio","text"],upperMediaTypes=["Video","Audio","Text"],translateLegacyCodec=function(e){return e?e.replace(/avc1\.(\d+)\.(\d+)/i,(function(e,t,n){return"avc1."+("00"+Number(t).toString(16)).slice(-2)+"00"+("00"+Number(n).toString(16)).slice(-2)})):e},parseCodecs=function(e){void 0===e&&(e="");var t=e.split(","),n=[];return t.forEach((function(e){var t;e=e.trim(),mediaTypes.forEach((function(r){var a=regexs[r].exec(e.toLowerCase());if(a&&!(a.length<=1)){t=r;var i=e.substring(0,a[1].length),s=e.replace(i,"");n.push({type:i,details:s,mediaType:r})}})),t||n.push({type:e,details:"",mediaType:"unknown"})})),n},codecsFromDefault=function(e,t){if(!e.mediaGroups.AUDIO||!t)return null;var n=e.mediaGroups.AUDIO[t];if(!n)return null;for(var r in n){var a=n[r];if(a.default&&a.playlists)return parseCodecs(a.playlists[0].attributes.CODECS)}return null},isAudioCodec=function(e){return void 0===e&&(e=""),regexs.audio.test(e.trim().toLowerCase())},isTextCodec=function(e){return void 0===e&&(e=""),regexs.text.test(e.trim().toLowerCase())},getMimeForCodec=function(e){if(e&&"string"==typeof e){var t=e.toLowerCase().split(",").map((function(e){return translateLegacyCodec(e.trim())})),n="video";1===t.length&&isAudioCodec(t[0])?n="audio":1===t.length&&isTextCodec(t[0])&&(n="application");var r="mp4";return t.every((function(e){return regexs.mp4.test(e)}))?r="mp4":t.every((function(e){return regexs.webm.test(e)}))?r="webm":t.every((function(e){return regexs.ogg.test(e)}))&&(r="ogg"),n+"/"+r+';codecs="'+e+'"'}},browserSupportsCodec=function(e){return void 0===e&&(e=""),window$1$1.MediaSource&&window$1$1.MediaSource.isTypeSupported&&window$1$1.MediaSource.isTypeSupported(getMimeForCodec(e))||!1},muxerSupportsCodec=function(e){return void 0===e&&(e=""),e.toLowerCase().split(",").every((function(e){e=e.trim();for(var t=0;t<upperMediaTypes.length;t++){var n=upperMediaTypes[t];if(regexs["muxer"+n].test(e))return!0}return!1}))},DEFAULT_AUDIO_CODEC="mp4a.40.2",DEFAULT_VIDEO_CODEC="avc1.4d400d",MPEGURL_REGEX=/^(audio|video|application)\/(x-|vnd\.apple\.)?mpegurl/i,DASH_REGEX=/^application\/dash\+xml/i,simpleTypeFromSourceType=function(e){return MPEGURL_REGEX.test(e)?"hls":DASH_REGEX.test(e)?"dash":"application/vnd.videojs.vhs+json"===e?"vhs-json":null},countBits=function(e){return e.toString(2).length},countBytes=function(e){return Math.ceil(countBits(e)/8)},isArrayBufferView=function(e){return"function"===ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer},isTypedArray=function(e){return isArrayBufferView(e)},toUint8=function(e){return e instanceof Uint8Array?e:(Array.isArray(e)||isTypedArray(e)||e instanceof ArrayBuffer||(e="number"!=typeof e||"number"==typeof e&&e!=e?0:[e]),new Uint8Array(e&&e.buffer||e,e&&e.byteOffset||0,e&&e.byteLength||0))},BigInt=window$1$1.BigInt||Number,BYTE_TABLE=[BigInt("0x1"),BigInt("0x100"),BigInt("0x10000"),BigInt("0x1000000"),BigInt("0x100000000"),BigInt("0x10000000000"),BigInt("0x1000000000000"),BigInt("0x100000000000000"),BigInt("0x10000000000000000")],a6,b2;a6=new Uint16Array([65484]),b2=new Uint8Array(a6.buffer,a6.byteOffset,a6.byteLength),255===b2[0]||b2[0];var bytesToNumber=function(e,t){var n=void 0===t?{}:t,r=n.signed,a=void 0!==r&&r,i=n.le,s=void 0!==i&&i;e=toUint8(e);var o=s?"reduce":"reduceRight",l=(e[o]?e[o]:Array.prototype[o]).call(e,(function(t,n,r){var a=s?r:Math.abs(r+1-e.length);return t+BigInt(n)*BYTE_TABLE[a]}),BigInt(0));if(a){var u=BYTE_TABLE[e.length]/BigInt(2)-BigInt(1);(l=BigInt(l))>u&&(l-=u,l-=u,l-=BigInt(2))}return Number(l)},numberToBytes=function(e,t){var n=(void 0===t?{}:t).le,r=void 0!==n&&n;("bigint"!=typeof e&&"number"!=typeof e||"number"==typeof e&&e!=e)&&(e=0),e=BigInt(e);for(var a=countBytes(e),i=new Uint8Array(new ArrayBuffer(a)),s=0;s<a;s++){var o=r?s:Math.abs(s+1-i.length);i[o]=Number(e/BYTE_TABLE[s]&BigInt(255)),e<0&&(i[o]=Math.abs(~i[o]),i[o]-=0===s?1:2)}return i},stringToBytes=function(e,t){if("string"!=typeof e&&e&&"function"==typeof e.toString&&(e=e.toString()),"string"!=typeof e)return new Uint8Array;t||(e=unescape(encodeURIComponent(e)));for(var n=new Uint8Array(e.length),r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n},concatTypedArrays=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(t=t.filter((function(e){return e&&(e.byteLength||e.length)&&"string"!=typeof e})),t.length<=1)return toUint8(t[0]);var r=t.reduce((function(e,t,n){return e+(t.byteLength||t.length)}),0),a=new Uint8Array(r),i=0;return t.forEach((function(e){e=toUint8(e),a.set(e,i),i+=e.byteLength})),a},bytesMatch=function(e,t,n){var r=void 0===n?{}:n,a=r.offset,i=void 0===a?0:a,s=r.mask,o=void 0===s?[]:s;e=toUint8(e);var l=(t=toUint8(t)).every?t.every:Array.prototype.every;return t.length&&e.length-i>=t.length&&l.call(t,(function(t,n){return t===(o[n]?o[n]&e[i+n]:e[i+n])}))},forEachMediaGroup$1=function(e,t,n){t.forEach((function(t){for(var r in e.mediaGroups[t])for(var a in e.mediaGroups[t][r]){var i=e.mediaGroups[t][r][a];n(i,t,r,a)}}))},atob$1=function(e){return window$1$1.atob?window$1$1.atob(e):Buffer.from(e,"base64").toString("binary")};function decodeB64ToUint8Array(e){for(var t=atob$1(e),n=new Uint8Array(t.length),r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n}var dom$1={},conventions$2={};function find$1(e,t,n){if(void 0===n&&(n=Array.prototype),e&&"function"==typeof n.find)return n.find.call(e,t);for(var r=0;r<e.length;r++)if(Object.prototype.hasOwnProperty.call(e,r)){var a=e[r];if(t.call(void 0,a,r,e))return a}}function freeze(e,t){return void 0===t&&(t=Object),t&&"function"==typeof t.freeze?t.freeze(e):e}function assign(e,t){if(null===e||"object"!=typeof e)throw new TypeError("target is not an object");for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}var MIME_TYPE=freeze({HTML:"text/html",isHTML:function(e){return e===MIME_TYPE.HTML},XML_APPLICATION:"application/xml",XML_TEXT:"text/xml",XML_XHTML_APPLICATION:"application/xhtml+xml",XML_SVG_IMAGE:"image/svg+xml"}),NAMESPACE$3=freeze({HTML:"http://www.w3.org/1999/xhtml",isHTML:function(e){return e===NAMESPACE$3.HTML},SVG:"http://www.w3.org/2000/svg",XML:"http://www.w3.org/XML/1998/namespace",XMLNS:"http://www.w3.org/2000/xmlns/"});conventions$2.assign=assign,conventions$2.find=find$1,conventions$2.freeze=freeze,conventions$2.MIME_TYPE=MIME_TYPE,conventions$2.NAMESPACE=NAMESPACE$3;var conventions$1=conventions$2,find=conventions$1.find,NAMESPACE$2=conventions$1.NAMESPACE;function notEmptyString(e){return""!==e}function splitOnASCIIWhitespace(e){return e?e.split(/[\t\n\f\r ]+/).filter(notEmptyString):[]}function orderedSetReducer(e,t){return e.hasOwnProperty(t)||(e[t]=!0),e}function toOrderedSet(e){if(!e)return[];var t=splitOnASCIIWhitespace(e);return Object.keys(t.reduce(orderedSetReducer,{}))}function arrayIncludes(e){return function(t){return e&&-1!==e.indexOf(t)}}function copy(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}function _extends(e,t){var n=e.prototype;if(!(n instanceof t)){let r=function(){};r.prototype=t.prototype,r=new r,copy(n,r),e.prototype=n=r}n.constructor!=e&&("function"!=typeof e&&console.error("unknown Class:"+e),n.constructor=e)}var NodeType={},ELEMENT_NODE=NodeType.ELEMENT_NODE=1,ATTRIBUTE_NODE=NodeType.ATTRIBUTE_NODE=2,TEXT_NODE=NodeType.TEXT_NODE=3,CDATA_SECTION_NODE=NodeType.CDATA_SECTION_NODE=4,ENTITY_REFERENCE_NODE=NodeType.ENTITY_REFERENCE_NODE=5,ENTITY_NODE=NodeType.ENTITY_NODE=6,PROCESSING_INSTRUCTION_NODE=NodeType.PROCESSING_INSTRUCTION_NODE=7,COMMENT_NODE=NodeType.COMMENT_NODE=8,DOCUMENT_NODE=NodeType.DOCUMENT_NODE=9,DOCUMENT_TYPE_NODE=NodeType.DOCUMENT_TYPE_NODE=10,DOCUMENT_FRAGMENT_NODE=NodeType.DOCUMENT_FRAGMENT_NODE=11,NOTATION_NODE=NodeType.NOTATION_NODE=12,ExceptionCode={},ExceptionMessage={};ExceptionCode.INDEX_SIZE_ERR=(ExceptionMessage[1]="Index size error",1),ExceptionCode.DOMSTRING_SIZE_ERR=(ExceptionMessage[2]="DOMString size error",2);var HIERARCHY_REQUEST_ERR=ExceptionCode.HIERARCHY_REQUEST_ERR=(ExceptionMessage[3]="Hierarchy request error",3);ExceptionCode.WRONG_DOCUMENT_ERR=(ExceptionMessage[4]="Wrong document",4),ExceptionCode.INVALID_CHARACTER_ERR=(ExceptionMessage[5]="Invalid character",5),ExceptionCode.NO_DATA_ALLOWED_ERR=(ExceptionMessage[6]="No data allowed",6),ExceptionCode.NO_MODIFICATION_ALLOWED_ERR=(ExceptionMessage[7]="No modification allowed",7);var NOT_FOUND_ERR=ExceptionCode.NOT_FOUND_ERR=(ExceptionMessage[8]="Not found",8);ExceptionCode.NOT_SUPPORTED_ERR=(ExceptionMessage[9]="Not supported",9);var INUSE_ATTRIBUTE_ERR=ExceptionCode.INUSE_ATTRIBUTE_ERR=(ExceptionMessage[10]="Attribute in use",10);function DOMException(e,t){if(t instanceof Error)var n=t;else n=this,Error.call(this,ExceptionMessage[e]),this.message=ExceptionMessage[e],Error.captureStackTrace&&Error.captureStackTrace(this,DOMException);return n.code=e,t&&(this.message=this.message+": "+t),n}function NodeList(){}function LiveNodeList(e,t){this._node=e,this._refresh=t,_updateLiveList(this)}function _updateLiveList(e){var t=e._node._inc||e._node.ownerDocument._inc;if(e._inc!==t){var n=e._refresh(e._node);if(__set__(e,"length",n.length),!e.$$length||n.length<e.$$length)for(var r=n.length;r in e;r++)Object.prototype.hasOwnProperty.call(e,r)&&delete e[r];copy(n,e),e._inc=t}}function NamedNodeMap(){}function _findNodeIndex(e,t){for(var n=e.length;n--;)if(e[n]===t)return n}function _addNamedNode(e,t,n,r){if(r?t[_findNodeIndex(t,r)]=n:t[t.length++]=n,e){n.ownerElement=e;var a=e.ownerDocument;a&&(r&&_onRemoveAttribute(a,e,r),_onAddAttribute(a,e,n))}}function _removeNamedNode(e,t,n){var r=_findNodeIndex(t,n);if(!(r>=0))throw new DOMException(NOT_FOUND_ERR,new Error(e.tagName+"@"+n));for(var a=t.length-1;r<a;)t[r]=t[++r];if(t.length=a,e){var i=e.ownerDocument;i&&(_onRemoveAttribute(i,e,n),n.ownerElement=null)}}function DOMImplementation$1(){}function Node(){}function _xmlEncoder(e){return("<"==e?"&lt;":">"==e&&"&gt;")||"&"==e&&"&amp;"||'"'==e&&"&quot;"||"&#"+e.charCodeAt()+";"}function _visitNode(e,t){if(t(e))return!0;if(e=e.firstChild)do{if(_visitNode(e,t))return!0}while(e=e.nextSibling)}function Document(){this.ownerDocument=this}function _onAddAttribute(e,t,n){e&&e._inc++,n.namespaceURI===NAMESPACE$2.XMLNS&&(t._nsMap[n.prefix?n.localName:""]=n.value)}function _onRemoveAttribute(e,t,n,r){e&&e._inc++,n.namespaceURI===NAMESPACE$2.XMLNS&&delete t._nsMap[n.prefix?n.localName:""]}function _onUpdateChild(e,t,n){if(e&&e._inc){e._inc++;var r=t.childNodes;if(n)r[r.length++]=n;else{for(var a=t.firstChild,i=0;a;)r[i++]=a,a=a.nextSibling;r.length=i,delete r[r.length]}}}function _removeChild(e,t){var n=t.previousSibling,r=t.nextSibling;return n?n.nextSibling=r:e.firstChild=r,r?r.previousSibling=n:e.lastChild=n,t.parentNode=null,t.previousSibling=null,t.nextSibling=null,_onUpdateChild(e.ownerDocument,e),t}function hasValidParentNodeType(e){return e&&(e.nodeType===Node.DOCUMENT_NODE||e.nodeType===Node.DOCUMENT_FRAGMENT_NODE||e.nodeType===Node.ELEMENT_NODE)}function hasInsertableNodeType(e){return e&&(isElementNode(e)||isTextNode$1(e)||isDocTypeNode(e)||e.nodeType===Node.DOCUMENT_FRAGMENT_NODE||e.nodeType===Node.COMMENT_NODE||e.nodeType===Node.PROCESSING_INSTRUCTION_NODE)}function isDocTypeNode(e){return e&&e.nodeType===Node.DOCUMENT_TYPE_NODE}function isElementNode(e){return e&&e.nodeType===Node.ELEMENT_NODE}function isTextNode$1(e){return e&&e.nodeType===Node.TEXT_NODE}function isElementInsertionPossible(e,t){var n=e.childNodes||[];if(find(n,isElementNode)||isDocTypeNode(t))return!1;var r=find(n,isDocTypeNode);return!(t&&r&&n.indexOf(r)>n.indexOf(t))}function isElementReplacementPossible(e,t){var n=e.childNodes||[];if(find(n,(function(e){return isElementNode(e)&&e!==t})))return!1;var r=find(n,isDocTypeNode);return!(t&&r&&n.indexOf(r)>n.indexOf(t))}function assertPreInsertionValidity1to5(e,t,n){if(!hasValidParentNodeType(e))throw new DOMException(HIERARCHY_REQUEST_ERR,"Unexpected parent node type "+e.nodeType);if(n&&n.parentNode!==e)throw new DOMException(NOT_FOUND_ERR,"child not in parent");if(!hasInsertableNodeType(t)||isDocTypeNode(t)&&e.nodeType!==Node.DOCUMENT_NODE)throw new DOMException(HIERARCHY_REQUEST_ERR,"Unexpected node type "+t.nodeType+" for parent node type "+e.nodeType)}function assertPreInsertionValidityInDocument(e,t,n){var r=e.childNodes||[],a=t.childNodes||[];if(t.nodeType===Node.DOCUMENT_FRAGMENT_NODE){var i=a.filter(isElementNode);if(i.length>1||find(a,isTextNode$1))throw new DOMException(HIERARCHY_REQUEST_ERR,"More than one element or text in fragment");if(1===i.length&&!isElementInsertionPossible(e,n))throw new DOMException(HIERARCHY_REQUEST_ERR,"Element in fragment can not be inserted before doctype")}if(isElementNode(t)&&!isElementInsertionPossible(e,n))throw new DOMException(HIERARCHY_REQUEST_ERR,"Only one element can be added and only after doctype");if(isDocTypeNode(t)){if(find(r,isDocTypeNode))throw new DOMException(HIERARCHY_REQUEST_ERR,"Only one doctype is allowed");var s=find(r,isElementNode);if(n&&r.indexOf(s)<r.indexOf(n))throw new DOMException(HIERARCHY_REQUEST_ERR,"Doctype can only be inserted before an element");if(!n&&s)throw new DOMException(HIERARCHY_REQUEST_ERR,"Doctype can not be appended since element is present")}}function assertPreReplacementValidityInDocument(e,t,n){var r=e.childNodes||[],a=t.childNodes||[];if(t.nodeType===Node.DOCUMENT_FRAGMENT_NODE){var i=a.filter(isElementNode);if(i.length>1||find(a,isTextNode$1))throw new DOMException(HIERARCHY_REQUEST_ERR,"More than one element or text in fragment");if(1===i.length&&!isElementReplacementPossible(e,n))throw new DOMException(HIERARCHY_REQUEST_ERR,"Element in fragment can not be inserted before doctype")}if(isElementNode(t)&&!isElementReplacementPossible(e,n))throw new DOMException(HIERARCHY_REQUEST_ERR,"Only one element can be added and only after doctype");if(isDocTypeNode(t)){let e=function(e){return isDocTypeNode(e)&&e!==n};if(find(r,e))throw new DOMException(HIERARCHY_REQUEST_ERR,"Only one doctype is allowed");var s=find(r,isElementNode);if(n&&r.indexOf(s)<r.indexOf(n))throw new DOMException(HIERARCHY_REQUEST_ERR,"Doctype can only be inserted before an element")}}function _insertBefore(e,t,n,r){assertPreInsertionValidity1to5(e,t,n),e.nodeType===Node.DOCUMENT_NODE&&(r||assertPreInsertionValidityInDocument)(e,t,n);var a=t.parentNode;if(a&&a.removeChild(t),t.nodeType===DOCUMENT_FRAGMENT_NODE){var i=t.firstChild;if(null==i)return t;var s=t.lastChild}else i=s=t;var o=n?n.previousSibling:e.lastChild;i.previousSibling=o,s.nextSibling=n,o?o.nextSibling=i:e.firstChild=i,null==n?e.lastChild=s:n.previousSibling=s;do{i.parentNode=e}while(i!==s&&(i=i.nextSibling));return _onUpdateChild(e.ownerDocument||e,e),t.nodeType==DOCUMENT_FRAGMENT_NODE&&(t.firstChild=t.lastChild=null),t}function _appendSingleChild(e,t){return t.parentNode&&t.parentNode.removeChild(t),t.parentNode=e,t.previousSibling=e.lastChild,t.nextSibling=null,t.previousSibling?t.previousSibling.nextSibling=t:e.firstChild=t,e.lastChild=t,_onUpdateChild(e.ownerDocument,e,t),t}function Element(){this._nsMap={}}function Attr(){}function CharacterData(){}function Text(){}function Comment(){}function CDATASection(){}function DocumentType(){}function Notation(){}function Entity(){}function EntityReference(){}function DocumentFragment(){}function ProcessingInstruction(){}function XMLSerializer(){}function nodeSerializeToString(e,t){var n=[],r=9==this.nodeType&&this.documentElement||this,a=r.prefix,i=r.namespaceURI;if(i&&null==a&&null==(a=r.lookupPrefix(i)))var s=[{namespace:i,prefix:null}];return serializeToString(this,n,e,t,s),n.join("")}function needNamespaceDefine(e,t,n){var r=e.prefix||"",a=e.namespaceURI;if(!a)return!1;if("xml"===r&&a===NAMESPACE$2.XML||a===NAMESPACE$2.XMLNS)return!1;for(var i=n.length;i--;){var s=n[i];if(s.prefix===r)return s.namespace!==a}return!0}function addSerializedAttribute(e,t,n){e.push(" ",t,'="',n.replace(/[<>&"\t\n\r]/g,_xmlEncoder),'"')}function serializeToString(e,t,n,r,a){if(a||(a=[]),r){if(!(e=r(e)))return;if("string"==typeof e)return void t.push(e)}switch(e.nodeType){case ELEMENT_NODE:var i=e.attributes,s=i.length,o=e.firstChild,l=e.tagName,u=l;if(!(n=NAMESPACE$2.isHTML(e.namespaceURI)||n)&&!e.prefix&&e.namespaceURI){for(var c,h=0;h<i.length;h++)if("xmlns"===i.item(h).name){c=i.item(h).value;break}if(!c)for(var d=a.length-1;d>=0;d--){if(""===(p=a[d]).prefix&&p.namespace===e.namespaceURI){c=p.namespace;break}}if(c!==e.namespaceURI)for(d=a.length-1;d>=0;d--){var p;if((p=a[d]).namespace===e.namespaceURI){p.prefix&&(u=p.prefix+":"+l);break}}}t.push("<",u);for(var f=0;f<s;f++){"xmlns"==(m=i.item(f)).prefix?a.push({prefix:m.localName,namespace:m.value}):"xmlns"==m.nodeName&&a.push({prefix:"",namespace:m.value})}for(f=0;f<s;f++){var m,g,y;if(needNamespaceDefine(m=i.item(f),n,a))addSerializedAttribute(t,(g=m.prefix||"")?"xmlns:"+g:"xmlns",y=m.namespaceURI),a.push({prefix:g,namespace:y});serializeToString(m,t,n,r,a)}if(l===u&&needNamespaceDefine(e,n,a))addSerializedAttribute(t,(g=e.prefix||"")?"xmlns:"+g:"xmlns",y=e.namespaceURI),a.push({prefix:g,namespace:y});if(o||n&&!/^(?:meta|link|img|br|hr|input)$/i.test(l)){if(t.push(">"),n&&/^script$/i.test(l))for(;o;)o.data?t.push(o.data):serializeToString(o,t,n,r,a.slice()),o=o.nextSibling;else for(;o;)serializeToString(o,t,n,r,a.slice()),o=o.nextSibling;t.push("</",u,">")}else t.push("/>");return;case DOCUMENT_NODE:case DOCUMENT_FRAGMENT_NODE:for(o=e.firstChild;o;)serializeToString(o,t,n,r,a.slice()),o=o.nextSibling;return;case ATTRIBUTE_NODE:return addSerializedAttribute(t,e.name,e.value);case TEXT_NODE:return t.push(e.data.replace(/[<&>]/g,_xmlEncoder));case CDATA_SECTION_NODE:return t.push("<![CDATA[",e.data,"]]>");case COMMENT_NODE:return t.push("\x3c!--",e.data,"--\x3e");case DOCUMENT_TYPE_NODE:var v=e.publicId,b=e.systemId;if(t.push("<!DOCTYPE ",e.name),v)t.push(" PUBLIC ",v),b&&"."!=b&&t.push(" ",b),t.push(">");else if(b&&"."!=b)t.push(" SYSTEM ",b,">");else{var x=e.internalSubset;x&&t.push(" [",x,"]"),t.push(">")}return;case PROCESSING_INSTRUCTION_NODE:return t.push("<?",e.target," ",e.data,"?>");case ENTITY_REFERENCE_NODE:return t.push("&",e.nodeName,";");default:t.push("??",e.nodeName)}}function importNode(e,t,n){var r;switch(t.nodeType){case ELEMENT_NODE:(r=t.cloneNode(!1)).ownerDocument=e;case DOCUMENT_FRAGMENT_NODE:break;case ATTRIBUTE_NODE:n=!0}if(r||(r=t.cloneNode(!1)),r.ownerDocument=e,r.parentNode=null,n)for(var a=t.firstChild;a;)r.appendChild(importNode(e,a,n)),a=a.nextSibling;return r}function cloneNode(e,t,n){var r=new t.constructor;for(var a in t)if(Object.prototype.hasOwnProperty.call(t,a)){var i=t[a];"object"!=typeof i&&i!=r[a]&&(r[a]=i)}switch(t.childNodes&&(r.childNodes=new NodeList),r.ownerDocument=e,r.nodeType){case ELEMENT_NODE:var s=t.attributes,o=r.attributes=new NamedNodeMap,l=s.length;o._ownerElement=r;for(var u=0;u<l;u++)r.setAttributeNode(cloneNode(e,s.item(u),!0));break;case ATTRIBUTE_NODE:n=!0}if(n)for(var c=t.firstChild;c;)r.appendChild(cloneNode(e,c,n)),c=c.nextSibling;return r}function __set__(e,t,n){e[t]=n}ExceptionCode.INVALID_STATE_ERR=(ExceptionMessage[11]="Invalid state",11),ExceptionCode.SYNTAX_ERR=(ExceptionMessage[12]="Syntax error",12),ExceptionCode.INVALID_MODIFICATION_ERR=(ExceptionMessage[13]="Invalid modification",13),ExceptionCode.NAMESPACE_ERR=(ExceptionMessage[14]="Invalid namespace",14),ExceptionCode.INVALID_ACCESS_ERR=(ExceptionMessage[15]="Invalid access",15),DOMException.prototype=Error.prototype,copy(ExceptionCode,DOMException),NodeList.prototype={length:0,item:function(e){return e>=0&&e<this.length?this[e]:null},toString:function(e,t){for(var n=[],r=0;r<this.length;r++)serializeToString(this[r],n,e,t);return n.join("")},filter:function(e){return Array.prototype.filter.call(this,e)},indexOf:function(e){return Array.prototype.indexOf.call(this,e)}},LiveNodeList.prototype.item=function(e){return _updateLiveList(this),this[e]||null},_extends(LiveNodeList,NodeList),NamedNodeMap.prototype={length:0,item:NodeList.prototype.item,getNamedItem:function(e){for(var t=this.length;t--;){var n=this[t];if(n.nodeName==e)return n}},setNamedItem:function(e){var t=e.ownerElement;if(t&&t!=this._ownerElement)throw new DOMException(INUSE_ATTRIBUTE_ERR);var n=this.getNamedItem(e.nodeName);return _addNamedNode(this._ownerElement,this,e,n),n},setNamedItemNS:function(e){var t,n=e.ownerElement;if(n&&n!=this._ownerElement)throw new DOMException(INUSE_ATTRIBUTE_ERR);return t=this.getNamedItemNS(e.namespaceURI,e.localName),_addNamedNode(this._ownerElement,this,e,t),t},removeNamedItem:function(e){var t=this.getNamedItem(e);return _removeNamedNode(this._ownerElement,this,t),t},removeNamedItemNS:function(e,t){var n=this.getNamedItemNS(e,t);return _removeNamedNode(this._ownerElement,this,n),n},getNamedItemNS:function(e,t){for(var n=this.length;n--;){var r=this[n];if(r.localName==t&&r.namespaceURI==e)return r}return null}},DOMImplementation$1.prototype={hasFeature:function(e,t){return!0},createDocument:function(e,t,n){var r=new Document;if(r.implementation=this,r.childNodes=new NodeList,r.doctype=n||null,n&&r.appendChild(n),t){var a=r.createElementNS(e,t);r.appendChild(a)}return r},createDocumentType:function(e,t,n){var r=new DocumentType;return r.name=e,r.nodeName=e,r.publicId=t||"",r.systemId=n||"",r}},Node.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(e,t){return _insertBefore(this,e,t)},replaceChild:function(e,t){_insertBefore(this,e,t,assertPreReplacementValidityInDocument),t&&this.removeChild(t)},removeChild:function(e){return _removeChild(this,e)},appendChild:function(e){return this.insertBefore(e,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(e){return cloneNode(this.ownerDocument||this,this,e)},normalize:function(){for(var e=this.firstChild;e;){var t=e.nextSibling;t&&t.nodeType==TEXT_NODE&&e.nodeType==TEXT_NODE?(this.removeChild(t),e.appendData(t.data)):(e.normalize(),e=t)}},isSupported:function(e,t){return this.ownerDocument.implementation.hasFeature(e,t)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(e){for(var t=this;t;){var n=t._nsMap;if(n)for(var r in n)if(Object.prototype.hasOwnProperty.call(n,r)&&n[r]===e)return r;t=t.nodeType==ATTRIBUTE_NODE?t.ownerDocument:t.parentNode}return null},lookupNamespaceURI:function(e){for(var t=this;t;){var n=t._nsMap;if(n&&Object.prototype.hasOwnProperty.call(n,e))return n[e];t=t.nodeType==ATTRIBUTE_NODE?t.ownerDocument:t.parentNode}return null},isDefaultNamespace:function(e){return null==this.lookupPrefix(e)}},copy(NodeType,Node),copy(NodeType,Node.prototype),Document.prototype={nodeName:"#document",nodeType:DOCUMENT_NODE,doctype:null,documentElement:null,_inc:1,insertBefore:function(e,t){if(e.nodeType==DOCUMENT_FRAGMENT_NODE){for(var n=e.firstChild;n;){var r=n.nextSibling;this.insertBefore(n,t),n=r}return e}return _insertBefore(this,e,t),e.ownerDocument=this,null===this.documentElement&&e.nodeType===ELEMENT_NODE&&(this.documentElement=e),e},removeChild:function(e){return this.documentElement==e&&(this.documentElement=null),_removeChild(this,e)},replaceChild:function(e,t){_insertBefore(this,e,t,assertPreReplacementValidityInDocument),e.ownerDocument=this,t&&this.removeChild(t),isElementNode(e)&&(this.documentElement=e)},importNode:function(e,t){return importNode(this,e,t)},getElementById:function(e){var t=null;return _visitNode(this.documentElement,(function(n){if(n.nodeType==ELEMENT_NODE&&n.getAttribute("id")==e)return t=n,!0})),t},getElementsByClassName:function(e){var t=toOrderedSet(e);return new LiveNodeList(this,(function(n){var r=[];return t.length>0&&_visitNode(n.documentElement,(function(a){if(a!==n&&a.nodeType===ELEMENT_NODE){var i=a.getAttribute("class");if(i){var s=e===i;if(!s){var o=toOrderedSet(i);s=t.every(arrayIncludes(o))}s&&r.push(a)}}})),r}))},createElement:function(e){var t=new Element;return t.ownerDocument=this,t.nodeName=e,t.tagName=e,t.localName=e,t.childNodes=new NodeList,(t.attributes=new NamedNodeMap)._ownerElement=t,t},createDocumentFragment:function(){var e=new DocumentFragment;return e.ownerDocument=this,e.childNodes=new NodeList,e},createTextNode:function(e){var t=new Text;return t.ownerDocument=this,t.appendData(e),t},createComment:function(e){var t=new Comment;return t.ownerDocument=this,t.appendData(e),t},createCDATASection:function(e){var t=new CDATASection;return t.ownerDocument=this,t.appendData(e),t},createProcessingInstruction:function(e,t){var n=new ProcessingInstruction;return n.ownerDocument=this,n.tagName=n.nodeName=n.target=e,n.nodeValue=n.data=t,n},createAttribute:function(e){var t=new Attr;return t.ownerDocument=this,t.name=e,t.nodeName=e,t.localName=e,t.specified=!0,t},createEntityReference:function(e){var t=new EntityReference;return t.ownerDocument=this,t.nodeName=e,t},createElementNS:function(e,t){var n=new Element,r=t.split(":"),a=n.attributes=new NamedNodeMap;return n.childNodes=new NodeList,n.ownerDocument=this,n.nodeName=t,n.tagName=t,n.namespaceURI=e,2==r.length?(n.prefix=r[0],n.localName=r[1]):n.localName=t,a._ownerElement=n,n},createAttributeNS:function(e,t){var n=new Attr,r=t.split(":");return n.ownerDocument=this,n.nodeName=t,n.name=t,n.namespaceURI=e,n.specified=!0,2==r.length?(n.prefix=r[0],n.localName=r[1]):n.localName=t,n}},_extends(Document,Node),Element.prototype={nodeType:ELEMENT_NODE,hasAttribute:function(e){return null!=this.getAttributeNode(e)},getAttribute:function(e){var t=this.getAttributeNode(e);return t&&t.value||""},getAttributeNode:function(e){return this.attributes.getNamedItem(e)},setAttribute:function(e,t){var n=this.ownerDocument.createAttribute(e);n.value=n.nodeValue=""+t,this.setAttributeNode(n)},removeAttribute:function(e){var t=this.getAttributeNode(e);t&&this.removeAttributeNode(t)},appendChild:function(e){return e.nodeType===DOCUMENT_FRAGMENT_NODE?this.insertBefore(e,null):_appendSingleChild(this,e)},setAttributeNode:function(e){return this.attributes.setNamedItem(e)},setAttributeNodeNS:function(e){return this.attributes.setNamedItemNS(e)},removeAttributeNode:function(e){return this.attributes.removeNamedItem(e.nodeName)},removeAttributeNS:function(e,t){var n=this.getAttributeNodeNS(e,t);n&&this.removeAttributeNode(n)},hasAttributeNS:function(e,t){return null!=this.getAttributeNodeNS(e,t)},getAttributeNS:function(e,t){var n=this.getAttributeNodeNS(e,t);return n&&n.value||""},setAttributeNS:function(e,t,n){var r=this.ownerDocument.createAttributeNS(e,t);r.value=r.nodeValue=""+n,this.setAttributeNode(r)},getAttributeNodeNS:function(e,t){return this.attributes.getNamedItemNS(e,t)},getElementsByTagName:function(e){return new LiveNodeList(this,(function(t){var n=[];return _visitNode(t,(function(r){r===t||r.nodeType!=ELEMENT_NODE||"*"!==e&&r.tagName!=e||n.push(r)})),n}))},getElementsByTagNameNS:function(e,t){return new LiveNodeList(this,(function(n){var r=[];return _visitNode(n,(function(a){a===n||a.nodeType!==ELEMENT_NODE||"*"!==e&&a.namespaceURI!==e||"*"!==t&&a.localName!=t||r.push(a)})),r}))}},Document.prototype.getElementsByTagName=Element.prototype.getElementsByTagName,Document.prototype.getElementsByTagNameNS=Element.prototype.getElementsByTagNameNS,_extends(Element,Node),Attr.prototype.nodeType=ATTRIBUTE_NODE,_extends(Attr,Node),CharacterData.prototype={data:"",substringData:function(e,t){return this.data.substring(e,e+t)},appendData:function(e){e=this.data+e,this.nodeValue=this.data=e,this.length=e.length},insertData:function(e,t){this.replaceData(e,0,t)},appendChild:function(e){throw new Error(ExceptionMessage[HIERARCHY_REQUEST_ERR])},deleteData:function(e,t){this.replaceData(e,t,"")},replaceData:function(e,t,n){n=this.data.substring(0,e)+n+this.data.substring(e+t),this.nodeValue=this.data=n,this.length=n.length}},_extends(CharacterData,Node),Text.prototype={nodeName:"#text",nodeType:TEXT_NODE,splitText:function(e){var t=this.data,n=t.substring(e);t=t.substring(0,e),this.data=this.nodeValue=t,this.length=t.length;var r=this.ownerDocument.createTextNode(n);return this.parentNode&&this.parentNode.insertBefore(r,this.nextSibling),r}},_extends(Text,CharacterData),Comment.prototype={nodeName:"#comment",nodeType:COMMENT_NODE},_extends(Comment,CharacterData),CDATASection.prototype={nodeName:"#cdata-section",nodeType:CDATA_SECTION_NODE},_extends(CDATASection,CharacterData),DocumentType.prototype.nodeType=DOCUMENT_TYPE_NODE,_extends(DocumentType,Node),Notation.prototype.nodeType=NOTATION_NODE,_extends(Notation,Node),Entity.prototype.nodeType=ENTITY_NODE,_extends(Entity,Node),EntityReference.prototype.nodeType=ENTITY_REFERENCE_NODE,_extends(EntityReference,Node),DocumentFragment.prototype.nodeName="#document-fragment",DocumentFragment.prototype.nodeType=DOCUMENT_FRAGMENT_NODE,_extends(DocumentFragment,Node),ProcessingInstruction.prototype.nodeType=PROCESSING_INSTRUCTION_NODE,_extends(ProcessingInstruction,Node),XMLSerializer.prototype.serializeToString=function(e,t,n){return nodeSerializeToString.call(e,t,n)},Node.prototype.toString=nodeSerializeToString;try{if(Object.defineProperty){let e=function(t){switch(t.nodeType){case ELEMENT_NODE:case DOCUMENT_FRAGMENT_NODE:var n=[];for(t=t.firstChild;t;)7!==t.nodeType&&8!==t.nodeType&&n.push(e(t)),t=t.nextSibling;return n.join("");default:return t.nodeValue}};var getTextContent=e;Object.defineProperty(LiveNodeList.prototype,"length",{get:function(){return _updateLiveList(this),this.$$length}}),Object.defineProperty(Node.prototype,"textContent",{get:function(){return e(this)},set:function(e){switch(this.nodeType){case ELEMENT_NODE:case DOCUMENT_FRAGMENT_NODE:for(;this.firstChild;)this.removeChild(this.firstChild);(e||String(e))&&this.appendChild(this.ownerDocument.createTextNode(e));break;default:this.data=e,this.value=e,this.nodeValue=e}}}),__set__=function(e,t,n){e["$$"+t]=n}}}catch(e2){}dom$1.DocumentType=DocumentType,dom$1.DOMException=DOMException,dom$1.DOMImplementation=DOMImplementation$1,dom$1.Element=Element,dom$1.Node=Node,dom$1.NodeList=NodeList,dom$1.XMLSerializer=XMLSerializer;var domParser={},entities$1={};!function(e){var t=conventions$2.freeze;e.XML_ENTITIES=t({amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}),e.HTML_ENTITIES=t({Aacute:"Á",aacute:"á",Abreve:"Ă",abreve:"ă",ac:"∾",acd:"∿",acE:"∾̳",Acirc:"Â",acirc:"â",acute:"´",Acy:"А",acy:"а",AElig:"Æ",aelig:"æ",af:"⁡",Afr:"𝔄",afr:"𝔞",Agrave:"À",agrave:"à",alefsym:"ℵ",aleph:"ℵ",Alpha:"Α",alpha:"α",Amacr:"Ā",amacr:"ā",amalg:"⨿",AMP:"&",amp:"&",And:"⩓",and:"∧",andand:"⩕",andd:"⩜",andslope:"⩘",andv:"⩚",ang:"∠",ange:"⦤",angle:"∠",angmsd:"∡",angmsdaa:"⦨",angmsdab:"⦩",angmsdac:"⦪",angmsdad:"⦫",angmsdae:"⦬",angmsdaf:"⦭",angmsdag:"⦮",angmsdah:"⦯",angrt:"∟",angrtvb:"⊾",angrtvbd:"⦝",angsph:"∢",angst:"Å",angzarr:"⍼",Aogon:"Ą",aogon:"ą",Aopf:"𝔸",aopf:"𝕒",ap:"≈",apacir:"⩯",apE:"⩰",ape:"≊",apid:"≋",apos:"'",ApplyFunction:"⁡",approx:"≈",approxeq:"≊",Aring:"Å",aring:"å",Ascr:"𝒜",ascr:"𝒶",Assign:"≔",ast:"*",asymp:"≈",asympeq:"≍",Atilde:"Ã",atilde:"ã",Auml:"Ä",auml:"ä",awconint:"∳",awint:"⨑",backcong:"≌",backepsilon:"϶",backprime:"‵",backsim:"∽",backsimeq:"⋍",Backslash:"∖",Barv:"⫧",barvee:"⊽",Barwed:"⌆",barwed:"⌅",barwedge:"⌅",bbrk:"⎵",bbrktbrk:"⎶",bcong:"≌",Bcy:"Б",bcy:"б",bdquo:"„",becaus:"∵",Because:"∵",because:"∵",bemptyv:"⦰",bepsi:"϶",bernou:"ℬ",Bernoullis:"ℬ",Beta:"Β",beta:"β",beth:"ℶ",between:"≬",Bfr:"𝔅",bfr:"𝔟",bigcap:"⋂",bigcirc:"◯",bigcup:"⋃",bigodot:"⨀",bigoplus:"⨁",bigotimes:"⨂",bigsqcup:"⨆",bigstar:"★",bigtriangledown:"▽",bigtriangleup:"△",biguplus:"⨄",bigvee:"⋁",bigwedge:"⋀",bkarow:"⤍",blacklozenge:"⧫",blacksquare:"▪",blacktriangle:"▴",blacktriangledown:"▾",blacktriangleleft:"◂",blacktriangleright:"▸",blank:"␣",blk12:"▒",blk14:"░",blk34:"▓",block:"█",bne:"=⃥",bnequiv:"≡⃥",bNot:"⫭",bnot:"⌐",Bopf:"𝔹",bopf:"𝕓",bot:"⊥",bottom:"⊥",bowtie:"⋈",boxbox:"⧉",boxDL:"╗",boxDl:"╖",boxdL:"╕",boxdl:"┐",boxDR:"╔",boxDr:"╓",boxdR:"╒",boxdr:"┌",boxH:"═",boxh:"─",boxHD:"╦",boxHd:"╤",boxhD:"╥",boxhd:"┬",boxHU:"╩",boxHu:"╧",boxhU:"╨",boxhu:"┴",boxminus:"⊟",boxplus:"⊞",boxtimes:"⊠",boxUL:"╝",boxUl:"╜",boxuL:"╛",boxul:"┘",boxUR:"╚",boxUr:"╙",boxuR:"╘",boxur:"└",boxV:"║",boxv:"│",boxVH:"╬",boxVh:"╫",boxvH:"╪",boxvh:"┼",boxVL:"╣",boxVl:"╢",boxvL:"╡",boxvl:"┤",boxVR:"╠",boxVr:"╟",boxvR:"╞",boxvr:"├",bprime:"‵",Breve:"˘",breve:"˘",brvbar:"¦",Bscr:"ℬ",bscr:"𝒷",bsemi:"⁏",bsim:"∽",bsime:"⋍",bsol:"\\",bsolb:"⧅",bsolhsub:"⟈",bull:"•",bullet:"•",bump:"≎",bumpE:"⪮",bumpe:"≏",Bumpeq:"≎",bumpeq:"≏",Cacute:"Ć",cacute:"ć",Cap:"⋒",cap:"∩",capand:"⩄",capbrcup:"⩉",capcap:"⩋",capcup:"⩇",capdot:"⩀",CapitalDifferentialD:"ⅅ",caps:"∩︀",caret:"⁁",caron:"ˇ",Cayleys:"ℭ",ccaps:"⩍",Ccaron:"Č",ccaron:"č",Ccedil:"Ç",ccedil:"ç",Ccirc:"Ĉ",ccirc:"ĉ",Cconint:"∰",ccups:"⩌",ccupssm:"⩐",Cdot:"Ċ",cdot:"ċ",cedil:"¸",Cedilla:"¸",cemptyv:"⦲",cent:"¢",CenterDot:"·",centerdot:"·",Cfr:"ℭ",cfr:"𝔠",CHcy:"Ч",chcy:"ч",check:"✓",checkmark:"✓",Chi:"Χ",chi:"χ",cir:"○",circ:"ˆ",circeq:"≗",circlearrowleft:"↺",circlearrowright:"↻",circledast:"⊛",circledcirc:"⊚",circleddash:"⊝",CircleDot:"⊙",circledR:"®",circledS:"Ⓢ",CircleMinus:"⊖",CirclePlus:"⊕",CircleTimes:"⊗",cirE:"⧃",cire:"≗",cirfnint:"⨐",cirmid:"⫯",cirscir:"⧂",ClockwiseContourIntegral:"∲",CloseCurlyDoubleQuote:"”",CloseCurlyQuote:"’",clubs:"♣",clubsuit:"♣",Colon:"∷",colon:":",Colone:"⩴",colone:"≔",coloneq:"≔",comma:",",commat:"@",comp:"∁",compfn:"∘",complement:"∁",complexes:"ℂ",cong:"≅",congdot:"⩭",Congruent:"≡",Conint:"∯",conint:"∮",ContourIntegral:"∮",Copf:"ℂ",copf:"𝕔",coprod:"∐",Coproduct:"∐",COPY:"©",copy:"©",copysr:"℗",CounterClockwiseContourIntegral:"∳",crarr:"↵",Cross:"⨯",cross:"✗",Cscr:"𝒞",cscr:"𝒸",csub:"⫏",csube:"⫑",csup:"⫐",csupe:"⫒",ctdot:"⋯",cudarrl:"⤸",cudarrr:"⤵",cuepr:"⋞",cuesc:"⋟",cularr:"↶",cularrp:"⤽",Cup:"⋓",cup:"∪",cupbrcap:"⩈",CupCap:"≍",cupcap:"⩆",cupcup:"⩊",cupdot:"⊍",cupor:"⩅",cups:"∪︀",curarr:"↷",curarrm:"⤼",curlyeqprec:"⋞",curlyeqsucc:"⋟",curlyvee:"⋎",curlywedge:"⋏",curren:"¤",curvearrowleft:"↶",curvearrowright:"↷",cuvee:"⋎",cuwed:"⋏",cwconint:"∲",cwint:"∱",cylcty:"⌭",Dagger:"‡",dagger:"†",daleth:"ℸ",Darr:"↡",dArr:"⇓",darr:"↓",dash:"‐",Dashv:"⫤",dashv:"⊣",dbkarow:"⤏",dblac:"˝",Dcaron:"Ď",dcaron:"ď",Dcy:"Д",dcy:"д",DD:"ⅅ",dd:"ⅆ",ddagger:"‡",ddarr:"⇊",DDotrahd:"⤑",ddotseq:"⩷",deg:"°",Del:"∇",Delta:"Δ",delta:"δ",demptyv:"⦱",dfisht:"⥿",Dfr:"𝔇",dfr:"𝔡",dHar:"⥥",dharl:"⇃",dharr:"⇂",DiacriticalAcute:"´",DiacriticalDot:"˙",DiacriticalDoubleAcute:"˝",DiacriticalGrave:"`",DiacriticalTilde:"˜",diam:"⋄",Diamond:"⋄",diamond:"⋄",diamondsuit:"♦",diams:"♦",die:"¨",DifferentialD:"ⅆ",digamma:"ϝ",disin:"⋲",div:"÷",divide:"÷",divideontimes:"⋇",divonx:"⋇",DJcy:"Ђ",djcy:"ђ",dlcorn:"⌞",dlcrop:"⌍",dollar:"$",Dopf:"𝔻",dopf:"𝕕",Dot:"¨",dot:"˙",DotDot:"⃜",doteq:"≐",doteqdot:"≑",DotEqual:"≐",dotminus:"∸",dotplus:"∔",dotsquare:"⊡",doublebarwedge:"⌆",DoubleContourIntegral:"∯",DoubleDot:"¨",DoubleDownArrow:"⇓",DoubleLeftArrow:"⇐",DoubleLeftRightArrow:"⇔",DoubleLeftTee:"⫤",DoubleLongLeftArrow:"⟸",DoubleLongLeftRightArrow:"⟺",DoubleLongRightArrow:"⟹",DoubleRightArrow:"⇒",DoubleRightTee:"⊨",DoubleUpArrow:"⇑",DoubleUpDownArrow:"⇕",DoubleVerticalBar:"∥",DownArrow:"↓",Downarrow:"⇓",downarrow:"↓",DownArrowBar:"⤓",DownArrowUpArrow:"⇵",DownBreve:"̑",downdownarrows:"⇊",downharpoonleft:"⇃",downharpoonright:"⇂",DownLeftRightVector:"⥐",DownLeftTeeVector:"⥞",DownLeftVector:"↽",DownLeftVectorBar:"⥖",DownRightTeeVector:"⥟",DownRightVector:"⇁",DownRightVectorBar:"⥗",DownTee:"⊤",DownTeeArrow:"↧",drbkarow:"⤐",drcorn:"⌟",drcrop:"⌌",Dscr:"𝒟",dscr:"𝒹",DScy:"Ѕ",dscy:"ѕ",dsol:"⧶",Dstrok:"Đ",dstrok:"đ",dtdot:"⋱",dtri:"▿",dtrif:"▾",duarr:"⇵",duhar:"⥯",dwangle:"⦦",DZcy:"Џ",dzcy:"џ",dzigrarr:"⟿",Eacute:"É",eacute:"é",easter:"⩮",Ecaron:"Ě",ecaron:"ě",ecir:"≖",Ecirc:"Ê",ecirc:"ê",ecolon:"≕",Ecy:"Э",ecy:"э",eDDot:"⩷",Edot:"Ė",eDot:"≑",edot:"ė",ee:"ⅇ",efDot:"≒",Efr:"𝔈",efr:"𝔢",eg:"⪚",Egrave:"È",egrave:"è",egs:"⪖",egsdot:"⪘",el:"⪙",Element:"∈",elinters:"⏧",ell:"ℓ",els:"⪕",elsdot:"⪗",Emacr:"Ē",emacr:"ē",empty:"∅",emptyset:"∅",EmptySmallSquare:"◻",emptyv:"∅",EmptyVerySmallSquare:"▫",emsp:" ",emsp13:" ",emsp14:" ",ENG:"Ŋ",eng:"ŋ",ensp:" ",Eogon:"Ę",eogon:"ę",Eopf:"𝔼",eopf:"𝕖",epar:"⋕",eparsl:"⧣",eplus:"⩱",epsi:"ε",Epsilon:"Ε",epsilon:"ε",epsiv:"ϵ",eqcirc:"≖",eqcolon:"≕",eqsim:"≂",eqslantgtr:"⪖",eqslantless:"⪕",Equal:"⩵",equals:"=",EqualTilde:"≂",equest:"≟",Equilibrium:"⇌",equiv:"≡",equivDD:"⩸",eqvparsl:"⧥",erarr:"⥱",erDot:"≓",Escr:"ℰ",escr:"ℯ",esdot:"≐",Esim:"⩳",esim:"≂",Eta:"Η",eta:"η",ETH:"Ð",eth:"ð",Euml:"Ë",euml:"ë",euro:"€",excl:"!",exist:"∃",Exists:"∃",expectation:"ℰ",ExponentialE:"ⅇ",exponentiale:"ⅇ",fallingdotseq:"≒",Fcy:"Ф",fcy:"ф",female:"♀",ffilig:"ﬃ",fflig:"ﬀ",ffllig:"ﬄ",Ffr:"𝔉",ffr:"𝔣",filig:"ﬁ",FilledSmallSquare:"◼",FilledVerySmallSquare:"▪",fjlig:"fj",flat:"♭",fllig:"ﬂ",fltns:"▱",fnof:"ƒ",Fopf:"𝔽",fopf:"𝕗",ForAll:"∀",forall:"∀",fork:"⋔",forkv:"⫙",Fouriertrf:"ℱ",fpartint:"⨍",frac12:"½",frac13:"⅓",frac14:"¼",frac15:"⅕",frac16:"⅙",frac18:"⅛",frac23:"⅔",frac25:"⅖",frac34:"¾",frac35:"⅗",frac38:"⅜",frac45:"⅘",frac56:"⅚",frac58:"⅝",frac78:"⅞",frasl:"⁄",frown:"⌢",Fscr:"ℱ",fscr:"𝒻",gacute:"ǵ",Gamma:"Γ",gamma:"γ",Gammad:"Ϝ",gammad:"ϝ",gap:"⪆",Gbreve:"Ğ",gbreve:"ğ",Gcedil:"Ģ",Gcirc:"Ĝ",gcirc:"ĝ",Gcy:"Г",gcy:"г",Gdot:"Ġ",gdot:"ġ",gE:"≧",ge:"≥",gEl:"⪌",gel:"⋛",geq:"≥",geqq:"≧",geqslant:"⩾",ges:"⩾",gescc:"⪩",gesdot:"⪀",gesdoto:"⪂",gesdotol:"⪄",gesl:"⋛︀",gesles:"⪔",Gfr:"𝔊",gfr:"𝔤",Gg:"⋙",gg:"≫",ggg:"⋙",gimel:"ℷ",GJcy:"Ѓ",gjcy:"ѓ",gl:"≷",gla:"⪥",glE:"⪒",glj:"⪤",gnap:"⪊",gnapprox:"⪊",gnE:"≩",gne:"⪈",gneq:"⪈",gneqq:"≩",gnsim:"⋧",Gopf:"𝔾",gopf:"𝕘",grave:"`",GreaterEqual:"≥",GreaterEqualLess:"⋛",GreaterFullEqual:"≧",GreaterGreater:"⪢",GreaterLess:"≷",GreaterSlantEqual:"⩾",GreaterTilde:"≳",Gscr:"𝒢",gscr:"ℊ",gsim:"≳",gsime:"⪎",gsiml:"⪐",Gt:"≫",GT:">",gt:">",gtcc:"⪧",gtcir:"⩺",gtdot:"⋗",gtlPar:"⦕",gtquest:"⩼",gtrapprox:"⪆",gtrarr:"⥸",gtrdot:"⋗",gtreqless:"⋛",gtreqqless:"⪌",gtrless:"≷",gtrsim:"≳",gvertneqq:"≩︀",gvnE:"≩︀",Hacek:"ˇ",hairsp:" ",half:"½",hamilt:"ℋ",HARDcy:"Ъ",hardcy:"ъ",hArr:"⇔",harr:"↔",harrcir:"⥈",harrw:"↭",Hat:"^",hbar:"ℏ",Hcirc:"Ĥ",hcirc:"ĥ",hearts:"♥",heartsuit:"♥",hellip:"…",hercon:"⊹",Hfr:"ℌ",hfr:"𝔥",HilbertSpace:"ℋ",hksearow:"⤥",hkswarow:"⤦",hoarr:"⇿",homtht:"∻",hookleftarrow:"↩",hookrightarrow:"↪",Hopf:"ℍ",hopf:"𝕙",horbar:"―",HorizontalLine:"─",Hscr:"ℋ",hscr:"𝒽",hslash:"ℏ",Hstrok:"Ħ",hstrok:"ħ",HumpDownHump:"≎",HumpEqual:"≏",hybull:"⁃",hyphen:"‐",Iacute:"Í",iacute:"í",ic:"⁣",Icirc:"Î",icirc:"î",Icy:"И",icy:"и",Idot:"İ",IEcy:"Е",iecy:"е",iexcl:"¡",iff:"⇔",Ifr:"ℑ",ifr:"𝔦",Igrave:"Ì",igrave:"ì",ii:"ⅈ",iiiint:"⨌",iiint:"∭",iinfin:"⧜",iiota:"℩",IJlig:"Ĳ",ijlig:"ĳ",Im:"ℑ",Imacr:"Ī",imacr:"ī",image:"ℑ",ImaginaryI:"ⅈ",imagline:"ℐ",imagpart:"ℑ",imath:"ı",imof:"⊷",imped:"Ƶ",Implies:"⇒",in:"∈",incare:"℅",infin:"∞",infintie:"⧝",inodot:"ı",Int:"∬",int:"∫",intcal:"⊺",integers:"ℤ",Integral:"∫",intercal:"⊺",Intersection:"⋂",intlarhk:"⨗",intprod:"⨼",InvisibleComma:"⁣",InvisibleTimes:"⁢",IOcy:"Ё",iocy:"ё",Iogon:"Į",iogon:"į",Iopf:"𝕀",iopf:"𝕚",Iota:"Ι",iota:"ι",iprod:"⨼",iquest:"¿",Iscr:"ℐ",iscr:"𝒾",isin:"∈",isindot:"⋵",isinE:"⋹",isins:"⋴",isinsv:"⋳",isinv:"∈",it:"⁢",Itilde:"Ĩ",itilde:"ĩ",Iukcy:"І",iukcy:"і",Iuml:"Ï",iuml:"ï",Jcirc:"Ĵ",jcirc:"ĵ",Jcy:"Й",jcy:"й",Jfr:"𝔍",jfr:"𝔧",jmath:"ȷ",Jopf:"𝕁",jopf:"𝕛",Jscr:"𝒥",jscr:"𝒿",Jsercy:"Ј",jsercy:"ј",Jukcy:"Є",jukcy:"є",Kappa:"Κ",kappa:"κ",kappav:"ϰ",Kcedil:"Ķ",kcedil:"ķ",Kcy:"К",kcy:"к",Kfr:"𝔎",kfr:"𝔨",kgreen:"ĸ",KHcy:"Х",khcy:"х",KJcy:"Ќ",kjcy:"ќ",Kopf:"𝕂",kopf:"𝕜",Kscr:"𝒦",kscr:"𝓀",lAarr:"⇚",Lacute:"Ĺ",lacute:"ĺ",laemptyv:"⦴",lagran:"ℒ",Lambda:"Λ",lambda:"λ",Lang:"⟪",lang:"⟨",langd:"⦑",langle:"⟨",lap:"⪅",Laplacetrf:"ℒ",laquo:"«",Larr:"↞",lArr:"⇐",larr:"←",larrb:"⇤",larrbfs:"⤟",larrfs:"⤝",larrhk:"↩",larrlp:"↫",larrpl:"⤹",larrsim:"⥳",larrtl:"↢",lat:"⪫",lAtail:"⤛",latail:"⤙",late:"⪭",lates:"⪭︀",lBarr:"⤎",lbarr:"⤌",lbbrk:"❲",lbrace:"{",lbrack:"[",lbrke:"⦋",lbrksld:"⦏",lbrkslu:"⦍",Lcaron:"Ľ",lcaron:"ľ",Lcedil:"Ļ",lcedil:"ļ",lceil:"⌈",lcub:"{",Lcy:"Л",lcy:"л",ldca:"⤶",ldquo:"“",ldquor:"„",ldrdhar:"⥧",ldrushar:"⥋",ldsh:"↲",lE:"≦",le:"≤",LeftAngleBracket:"⟨",LeftArrow:"←",Leftarrow:"⇐",leftarrow:"←",LeftArrowBar:"⇤",LeftArrowRightArrow:"⇆",leftarrowtail:"↢",LeftCeiling:"⌈",LeftDoubleBracket:"⟦",LeftDownTeeVector:"⥡",LeftDownVector:"⇃",LeftDownVectorBar:"⥙",LeftFloor:"⌊",leftharpoondown:"↽",leftharpoonup:"↼",leftleftarrows:"⇇",LeftRightArrow:"↔",Leftrightarrow:"⇔",leftrightarrow:"↔",leftrightarrows:"⇆",leftrightharpoons:"⇋",leftrightsquigarrow:"↭",LeftRightVector:"⥎",LeftTee:"⊣",LeftTeeArrow:"↤",LeftTeeVector:"⥚",leftthreetimes:"⋋",LeftTriangle:"⊲",LeftTriangleBar:"⧏",LeftTriangleEqual:"⊴",LeftUpDownVector:"⥑",LeftUpTeeVector:"⥠",LeftUpVector:"↿",LeftUpVectorBar:"⥘",LeftVector:"↼",LeftVectorBar:"⥒",lEg:"⪋",leg:"⋚",leq:"≤",leqq:"≦",leqslant:"⩽",les:"⩽",lescc:"⪨",lesdot:"⩿",lesdoto:"⪁",lesdotor:"⪃",lesg:"⋚︀",lesges:"⪓",lessapprox:"⪅",lessdot:"⋖",lesseqgtr:"⋚",lesseqqgtr:"⪋",LessEqualGreater:"⋚",LessFullEqual:"≦",LessGreater:"≶",lessgtr:"≶",LessLess:"⪡",lesssim:"≲",LessSlantEqual:"⩽",LessTilde:"≲",lfisht:"⥼",lfloor:"⌊",Lfr:"𝔏",lfr:"𝔩",lg:"≶",lgE:"⪑",lHar:"⥢",lhard:"↽",lharu:"↼",lharul:"⥪",lhblk:"▄",LJcy:"Љ",ljcy:"љ",Ll:"⋘",ll:"≪",llarr:"⇇",llcorner:"⌞",Lleftarrow:"⇚",llhard:"⥫",lltri:"◺",Lmidot:"Ŀ",lmidot:"ŀ",lmoust:"⎰",lmoustache:"⎰",lnap:"⪉",lnapprox:"⪉",lnE:"≨",lne:"⪇",lneq:"⪇",lneqq:"≨",lnsim:"⋦",loang:"⟬",loarr:"⇽",lobrk:"⟦",LongLeftArrow:"⟵",Longleftarrow:"⟸",longleftarrow:"⟵",LongLeftRightArrow:"⟷",Longleftrightarrow:"⟺",longleftrightarrow:"⟷",longmapsto:"⟼",LongRightArrow:"⟶",Longrightarrow:"⟹",longrightarrow:"⟶",looparrowleft:"↫",looparrowright:"↬",lopar:"⦅",Lopf:"𝕃",lopf:"𝕝",loplus:"⨭",lotimes:"⨴",lowast:"∗",lowbar:"_",LowerLeftArrow:"↙",LowerRightArrow:"↘",loz:"◊",lozenge:"◊",lozf:"⧫",lpar:"(",lparlt:"⦓",lrarr:"⇆",lrcorner:"⌟",lrhar:"⇋",lrhard:"⥭",lrm:"‎",lrtri:"⊿",lsaquo:"‹",Lscr:"ℒ",lscr:"𝓁",Lsh:"↰",lsh:"↰",lsim:"≲",lsime:"⪍",lsimg:"⪏",lsqb:"[",lsquo:"‘",lsquor:"‚",Lstrok:"Ł",lstrok:"ł",Lt:"≪",LT:"<",lt:"<",ltcc:"⪦",ltcir:"⩹",ltdot:"⋖",lthree:"⋋",ltimes:"⋉",ltlarr:"⥶",ltquest:"⩻",ltri:"◃",ltrie:"⊴",ltrif:"◂",ltrPar:"⦖",lurdshar:"⥊",luruhar:"⥦",lvertneqq:"≨︀",lvnE:"≨︀",macr:"¯",male:"♂",malt:"✠",maltese:"✠",Map:"⤅",map:"↦",mapsto:"↦",mapstodown:"↧",mapstoleft:"↤",mapstoup:"↥",marker:"▮",mcomma:"⨩",Mcy:"М",mcy:"м",mdash:"—",mDDot:"∺",measuredangle:"∡",MediumSpace:" ",Mellintrf:"ℳ",Mfr:"𝔐",mfr:"𝔪",mho:"℧",micro:"µ",mid:"∣",midast:"*",midcir:"⫰",middot:"·",minus:"−",minusb:"⊟",minusd:"∸",minusdu:"⨪",MinusPlus:"∓",mlcp:"⫛",mldr:"…",mnplus:"∓",models:"⊧",Mopf:"𝕄",mopf:"𝕞",mp:"∓",Mscr:"ℳ",mscr:"𝓂",mstpos:"∾",Mu:"Μ",mu:"μ",multimap:"⊸",mumap:"⊸",nabla:"∇",Nacute:"Ń",nacute:"ń",nang:"∠⃒",nap:"≉",napE:"⩰̸",napid:"≋̸",napos:"ŉ",napprox:"≉",natur:"♮",natural:"♮",naturals:"ℕ",nbsp:" ",nbump:"≎̸",nbumpe:"≏̸",ncap:"⩃",Ncaron:"Ň",ncaron:"ň",Ncedil:"Ņ",ncedil:"ņ",ncong:"≇",ncongdot:"⩭̸",ncup:"⩂",Ncy:"Н",ncy:"н",ndash:"–",ne:"≠",nearhk:"⤤",neArr:"⇗",nearr:"↗",nearrow:"↗",nedot:"≐̸",NegativeMediumSpace:"​",NegativeThickSpace:"​",NegativeThinSpace:"​",NegativeVeryThinSpace:"​",nequiv:"≢",nesear:"⤨",nesim:"≂̸",NestedGreaterGreater:"≫",NestedLessLess:"≪",NewLine:"\n",nexist:"∄",nexists:"∄",Nfr:"𝔑",nfr:"𝔫",ngE:"≧̸",nge:"≱",ngeq:"≱",ngeqq:"≧̸",ngeqslant:"⩾̸",nges:"⩾̸",nGg:"⋙̸",ngsim:"≵",nGt:"≫⃒",ngt:"≯",ngtr:"≯",nGtv:"≫̸",nhArr:"⇎",nharr:"↮",nhpar:"⫲",ni:"∋",nis:"⋼",nisd:"⋺",niv:"∋",NJcy:"Њ",njcy:"њ",nlArr:"⇍",nlarr:"↚",nldr:"‥",nlE:"≦̸",nle:"≰",nLeftarrow:"⇍",nleftarrow:"↚",nLeftrightarrow:"⇎",nleftrightarrow:"↮",nleq:"≰",nleqq:"≦̸",nleqslant:"⩽̸",nles:"⩽̸",nless:"≮",nLl:"⋘̸",nlsim:"≴",nLt:"≪⃒",nlt:"≮",nltri:"⋪",nltrie:"⋬",nLtv:"≪̸",nmid:"∤",NoBreak:"⁠",NonBreakingSpace:" ",Nopf:"ℕ",nopf:"𝕟",Not:"⫬",not:"¬",NotCongruent:"≢",NotCupCap:"≭",NotDoubleVerticalBar:"∦",NotElement:"∉",NotEqual:"≠",NotEqualTilde:"≂̸",NotExists:"∄",NotGreater:"≯",NotGreaterEqual:"≱",NotGreaterFullEqual:"≧̸",NotGreaterGreater:"≫̸",NotGreaterLess:"≹",NotGreaterSlantEqual:"⩾̸",NotGreaterTilde:"≵",NotHumpDownHump:"≎̸",NotHumpEqual:"≏̸",notin:"∉",notindot:"⋵̸",notinE:"⋹̸",notinva:"∉",notinvb:"⋷",notinvc:"⋶",NotLeftTriangle:"⋪",NotLeftTriangleBar:"⧏̸",NotLeftTriangleEqual:"⋬",NotLess:"≮",NotLessEqual:"≰",NotLessGreater:"≸",NotLessLess:"≪̸",NotLessSlantEqual:"⩽̸",NotLessTilde:"≴",NotNestedGreaterGreater:"⪢̸",NotNestedLessLess:"⪡̸",notni:"∌",notniva:"∌",notnivb:"⋾",notnivc:"⋽",NotPrecedes:"⊀",NotPrecedesEqual:"⪯̸",NotPrecedesSlantEqual:"⋠",NotReverseElement:"∌",NotRightTriangle:"⋫",NotRightTriangleBar:"⧐̸",NotRightTriangleEqual:"⋭",NotSquareSubset:"⊏̸",NotSquareSubsetEqual:"⋢",NotSquareSuperset:"⊐̸",NotSquareSupersetEqual:"⋣",NotSubset:"⊂⃒",NotSubsetEqual:"⊈",NotSucceeds:"⊁",NotSucceedsEqual:"⪰̸",NotSucceedsSlantEqual:"⋡",NotSucceedsTilde:"≿̸",NotSuperset:"⊃⃒",NotSupersetEqual:"⊉",NotTilde:"≁",NotTildeEqual:"≄",NotTildeFullEqual:"≇",NotTildeTilde:"≉",NotVerticalBar:"∤",npar:"∦",nparallel:"∦",nparsl:"⫽⃥",npart:"∂̸",npolint:"⨔",npr:"⊀",nprcue:"⋠",npre:"⪯̸",nprec:"⊀",npreceq:"⪯̸",nrArr:"⇏",nrarr:"↛",nrarrc:"⤳̸",nrarrw:"↝̸",nRightarrow:"⇏",nrightarrow:"↛",nrtri:"⋫",nrtrie:"⋭",nsc:"⊁",nsccue:"⋡",nsce:"⪰̸",Nscr:"𝒩",nscr:"𝓃",nshortmid:"∤",nshortparallel:"∦",nsim:"≁",nsime:"≄",nsimeq:"≄",nsmid:"∤",nspar:"∦",nsqsube:"⋢",nsqsupe:"⋣",nsub:"⊄",nsubE:"⫅̸",nsube:"⊈",nsubset:"⊂⃒",nsubseteq:"⊈",nsubseteqq:"⫅̸",nsucc:"⊁",nsucceq:"⪰̸",nsup:"⊅",nsupE:"⫆̸",nsupe:"⊉",nsupset:"⊃⃒",nsupseteq:"⊉",nsupseteqq:"⫆̸",ntgl:"≹",Ntilde:"Ñ",ntilde:"ñ",ntlg:"≸",ntriangleleft:"⋪",ntrianglelefteq:"⋬",ntriangleright:"⋫",ntrianglerighteq:"⋭",Nu:"Ν",nu:"ν",num:"#",numero:"№",numsp:" ",nvap:"≍⃒",nVDash:"⊯",nVdash:"⊮",nvDash:"⊭",nvdash:"⊬",nvge:"≥⃒",nvgt:">⃒",nvHarr:"⤄",nvinfin:"⧞",nvlArr:"⤂",nvle:"≤⃒",nvlt:"<⃒",nvltrie:"⊴⃒",nvrArr:"⤃",nvrtrie:"⊵⃒",nvsim:"∼⃒",nwarhk:"⤣",nwArr:"⇖",nwarr:"↖",nwarrow:"↖",nwnear:"⤧",Oacute:"Ó",oacute:"ó",oast:"⊛",ocir:"⊚",Ocirc:"Ô",ocirc:"ô",Ocy:"О",ocy:"о",odash:"⊝",Odblac:"Ő",odblac:"ő",odiv:"⨸",odot:"⊙",odsold:"⦼",OElig:"Œ",oelig:"œ",ofcir:"⦿",Ofr:"𝔒",ofr:"𝔬",ogon:"˛",Ograve:"Ò",ograve:"ò",ogt:"⧁",ohbar:"⦵",ohm:"Ω",oint:"∮",olarr:"↺",olcir:"⦾",olcross:"⦻",oline:"‾",olt:"⧀",Omacr:"Ō",omacr:"ō",Omega:"Ω",omega:"ω",Omicron:"Ο",omicron:"ο",omid:"⦶",ominus:"⊖",Oopf:"𝕆",oopf:"𝕠",opar:"⦷",OpenCurlyDoubleQuote:"“",OpenCurlyQuote:"‘",operp:"⦹",oplus:"⊕",Or:"⩔",or:"∨",orarr:"↻",ord:"⩝",order:"ℴ",orderof:"ℴ",ordf:"ª",ordm:"º",origof:"⊶",oror:"⩖",orslope:"⩗",orv:"⩛",oS:"Ⓢ",Oscr:"𝒪",oscr:"ℴ",Oslash:"Ø",oslash:"ø",osol:"⊘",Otilde:"Õ",otilde:"õ",Otimes:"⨷",otimes:"⊗",otimesas:"⨶",Ouml:"Ö",ouml:"ö",ovbar:"⌽",OverBar:"‾",OverBrace:"⏞",OverBracket:"⎴",OverParenthesis:"⏜",par:"∥",para:"¶",parallel:"∥",parsim:"⫳",parsl:"⫽",part:"∂",PartialD:"∂",Pcy:"П",pcy:"п",percnt:"%",period:".",permil:"‰",perp:"⊥",pertenk:"‱",Pfr:"𝔓",pfr:"𝔭",Phi:"Φ",phi:"φ",phiv:"ϕ",phmmat:"ℳ",phone:"☎",Pi:"Π",pi:"π",pitchfork:"⋔",piv:"ϖ",planck:"ℏ",planckh:"ℎ",plankv:"ℏ",plus:"+",plusacir:"⨣",plusb:"⊞",pluscir:"⨢",plusdo:"∔",plusdu:"⨥",pluse:"⩲",PlusMinus:"±",plusmn:"±",plussim:"⨦",plustwo:"⨧",pm:"±",Poincareplane:"ℌ",pointint:"⨕",Popf:"ℙ",popf:"𝕡",pound:"£",Pr:"⪻",pr:"≺",prap:"⪷",prcue:"≼",prE:"⪳",pre:"⪯",prec:"≺",precapprox:"⪷",preccurlyeq:"≼",Precedes:"≺",PrecedesEqual:"⪯",PrecedesSlantEqual:"≼",PrecedesTilde:"≾",preceq:"⪯",precnapprox:"⪹",precneqq:"⪵",precnsim:"⋨",precsim:"≾",Prime:"″",prime:"′",primes:"ℙ",prnap:"⪹",prnE:"⪵",prnsim:"⋨",prod:"∏",Product:"∏",profalar:"⌮",profline:"⌒",profsurf:"⌓",prop:"∝",Proportion:"∷",Proportional:"∝",propto:"∝",prsim:"≾",prurel:"⊰",Pscr:"𝒫",pscr:"𝓅",Psi:"Ψ",psi:"ψ",puncsp:" ",Qfr:"𝔔",qfr:"𝔮",qint:"⨌",Qopf:"ℚ",qopf:"𝕢",qprime:"⁗",Qscr:"𝒬",qscr:"𝓆",quaternions:"ℍ",quatint:"⨖",quest:"?",questeq:"≟",QUOT:'"',quot:'"',rAarr:"⇛",race:"∽̱",Racute:"Ŕ",racute:"ŕ",radic:"√",raemptyv:"⦳",Rang:"⟫",rang:"⟩",rangd:"⦒",range:"⦥",rangle:"⟩",raquo:"»",Rarr:"↠",rArr:"⇒",rarr:"→",rarrap:"⥵",rarrb:"⇥",rarrbfs:"⤠",rarrc:"⤳",rarrfs:"⤞",rarrhk:"↪",rarrlp:"↬",rarrpl:"⥅",rarrsim:"⥴",Rarrtl:"⤖",rarrtl:"↣",rarrw:"↝",rAtail:"⤜",ratail:"⤚",ratio:"∶",rationals:"ℚ",RBarr:"⤐",rBarr:"⤏",rbarr:"⤍",rbbrk:"❳",rbrace:"}",rbrack:"]",rbrke:"⦌",rbrksld:"⦎",rbrkslu:"⦐",Rcaron:"Ř",rcaron:"ř",Rcedil:"Ŗ",rcedil:"ŗ",rceil:"⌉",rcub:"}",Rcy:"Р",rcy:"р",rdca:"⤷",rdldhar:"⥩",rdquo:"”",rdquor:"”",rdsh:"↳",Re:"ℜ",real:"ℜ",realine:"ℛ",realpart:"ℜ",reals:"ℝ",rect:"▭",REG:"®",reg:"®",ReverseElement:"∋",ReverseEquilibrium:"⇋",ReverseUpEquilibrium:"⥯",rfisht:"⥽",rfloor:"⌋",Rfr:"ℜ",rfr:"𝔯",rHar:"⥤",rhard:"⇁",rharu:"⇀",rharul:"⥬",Rho:"Ρ",rho:"ρ",rhov:"ϱ",RightAngleBracket:"⟩",RightArrow:"→",Rightarrow:"⇒",rightarrow:"→",RightArrowBar:"⇥",RightArrowLeftArrow:"⇄",rightarrowtail:"↣",RightCeiling:"⌉",RightDoubleBracket:"⟧",RightDownTeeVector:"⥝",RightDownVector:"⇂",RightDownVectorBar:"⥕",RightFloor:"⌋",rightharpoondown:"⇁",rightharpoonup:"⇀",rightleftarrows:"⇄",rightleftharpoons:"⇌",rightrightarrows:"⇉",rightsquigarrow:"↝",RightTee:"⊢",RightTeeArrow:"↦",RightTeeVector:"⥛",rightthreetimes:"⋌",RightTriangle:"⊳",RightTriangleBar:"⧐",RightTriangleEqual:"⊵",RightUpDownVector:"⥏",RightUpTeeVector:"⥜",RightUpVector:"↾",RightUpVectorBar:"⥔",RightVector:"⇀",RightVectorBar:"⥓",ring:"˚",risingdotseq:"≓",rlarr:"⇄",rlhar:"⇌",rlm:"‏",rmoust:"⎱",rmoustache:"⎱",rnmid:"⫮",roang:"⟭",roarr:"⇾",robrk:"⟧",ropar:"⦆",Ropf:"ℝ",ropf:"𝕣",roplus:"⨮",rotimes:"⨵",RoundImplies:"⥰",rpar:")",rpargt:"⦔",rppolint:"⨒",rrarr:"⇉",Rrightarrow:"⇛",rsaquo:"›",Rscr:"ℛ",rscr:"𝓇",Rsh:"↱",rsh:"↱",rsqb:"]",rsquo:"’",rsquor:"’",rthree:"⋌",rtimes:"⋊",rtri:"▹",rtrie:"⊵",rtrif:"▸",rtriltri:"⧎",RuleDelayed:"⧴",ruluhar:"⥨",rx:"℞",Sacute:"Ś",sacute:"ś",sbquo:"‚",Sc:"⪼",sc:"≻",scap:"⪸",Scaron:"Š",scaron:"š",sccue:"≽",scE:"⪴",sce:"⪰",Scedil:"Ş",scedil:"ş",Scirc:"Ŝ",scirc:"ŝ",scnap:"⪺",scnE:"⪶",scnsim:"⋩",scpolint:"⨓",scsim:"≿",Scy:"С",scy:"с",sdot:"⋅",sdotb:"⊡",sdote:"⩦",searhk:"⤥",seArr:"⇘",searr:"↘",searrow:"↘",sect:"§",semi:";",seswar:"⤩",setminus:"∖",setmn:"∖",sext:"✶",Sfr:"𝔖",sfr:"𝔰",sfrown:"⌢",sharp:"♯",SHCHcy:"Щ",shchcy:"щ",SHcy:"Ш",shcy:"ш",ShortDownArrow:"↓",ShortLeftArrow:"←",shortmid:"∣",shortparallel:"∥",ShortRightArrow:"→",ShortUpArrow:"↑",shy:"­",Sigma:"Σ",sigma:"σ",sigmaf:"ς",sigmav:"ς",sim:"∼",simdot:"⩪",sime:"≃",simeq:"≃",simg:"⪞",simgE:"⪠",siml:"⪝",simlE:"⪟",simne:"≆",simplus:"⨤",simrarr:"⥲",slarr:"←",SmallCircle:"∘",smallsetminus:"∖",smashp:"⨳",smeparsl:"⧤",smid:"∣",smile:"⌣",smt:"⪪",smte:"⪬",smtes:"⪬︀",SOFTcy:"Ь",softcy:"ь",sol:"/",solb:"⧄",solbar:"⌿",Sopf:"𝕊",sopf:"𝕤",spades:"♠",spadesuit:"♠",spar:"∥",sqcap:"⊓",sqcaps:"⊓︀",sqcup:"⊔",sqcups:"⊔︀",Sqrt:"√",sqsub:"⊏",sqsube:"⊑",sqsubset:"⊏",sqsubseteq:"⊑",sqsup:"⊐",sqsupe:"⊒",sqsupset:"⊐",sqsupseteq:"⊒",squ:"□",Square:"□",square:"□",SquareIntersection:"⊓",SquareSubset:"⊏",SquareSubsetEqual:"⊑",SquareSuperset:"⊐",SquareSupersetEqual:"⊒",SquareUnion:"⊔",squarf:"▪",squf:"▪",srarr:"→",Sscr:"𝒮",sscr:"𝓈",ssetmn:"∖",ssmile:"⌣",sstarf:"⋆",Star:"⋆",star:"☆",starf:"★",straightepsilon:"ϵ",straightphi:"ϕ",strns:"¯",Sub:"⋐",sub:"⊂",subdot:"⪽",subE:"⫅",sube:"⊆",subedot:"⫃",submult:"⫁",subnE:"⫋",subne:"⊊",subplus:"⪿",subrarr:"⥹",Subset:"⋐",subset:"⊂",subseteq:"⊆",subseteqq:"⫅",SubsetEqual:"⊆",subsetneq:"⊊",subsetneqq:"⫋",subsim:"⫇",subsub:"⫕",subsup:"⫓",succ:"≻",succapprox:"⪸",succcurlyeq:"≽",Succeeds:"≻",SucceedsEqual:"⪰",SucceedsSlantEqual:"≽",SucceedsTilde:"≿",succeq:"⪰",succnapprox:"⪺",succneqq:"⪶",succnsim:"⋩",succsim:"≿",SuchThat:"∋",Sum:"∑",sum:"∑",sung:"♪",Sup:"⋑",sup:"⊃",sup1:"¹",sup2:"²",sup3:"³",supdot:"⪾",supdsub:"⫘",supE:"⫆",supe:"⊇",supedot:"⫄",Superset:"⊃",SupersetEqual:"⊇",suphsol:"⟉",suphsub:"⫗",suplarr:"⥻",supmult:"⫂",supnE:"⫌",supne:"⊋",supplus:"⫀",Supset:"⋑",supset:"⊃",supseteq:"⊇",supseteqq:"⫆",supsetneq:"⊋",supsetneqq:"⫌",supsim:"⫈",supsub:"⫔",supsup:"⫖",swarhk:"⤦",swArr:"⇙",swarr:"↙",swarrow:"↙",swnwar:"⤪",szlig:"ß",Tab:"\t",target:"⌖",Tau:"Τ",tau:"τ",tbrk:"⎴",Tcaron:"Ť",tcaron:"ť",Tcedil:"Ţ",tcedil:"ţ",Tcy:"Т",tcy:"т",tdot:"⃛",telrec:"⌕",Tfr:"𝔗",tfr:"𝔱",there4:"∴",Therefore:"∴",therefore:"∴",Theta:"Θ",theta:"θ",thetasym:"ϑ",thetav:"ϑ",thickapprox:"≈",thicksim:"∼",ThickSpace:"  ",thinsp:" ",ThinSpace:" ",thkap:"≈",thksim:"∼",THORN:"Þ",thorn:"þ",Tilde:"∼",tilde:"˜",TildeEqual:"≃",TildeFullEqual:"≅",TildeTilde:"≈",times:"×",timesb:"⊠",timesbar:"⨱",timesd:"⨰",tint:"∭",toea:"⤨",top:"⊤",topbot:"⌶",topcir:"⫱",Topf:"𝕋",topf:"𝕥",topfork:"⫚",tosa:"⤩",tprime:"‴",TRADE:"™",trade:"™",triangle:"▵",triangledown:"▿",triangleleft:"◃",trianglelefteq:"⊴",triangleq:"≜",triangleright:"▹",trianglerighteq:"⊵",tridot:"◬",trie:"≜",triminus:"⨺",TripleDot:"⃛",triplus:"⨹",trisb:"⧍",tritime:"⨻",trpezium:"⏢",Tscr:"𝒯",tscr:"𝓉",TScy:"Ц",tscy:"ц",TSHcy:"Ћ",tshcy:"ћ",Tstrok:"Ŧ",tstrok:"ŧ",twixt:"≬",twoheadleftarrow:"↞",twoheadrightarrow:"↠",Uacute:"Ú",uacute:"ú",Uarr:"↟",uArr:"⇑",uarr:"↑",Uarrocir:"⥉",Ubrcy:"Ў",ubrcy:"ў",Ubreve:"Ŭ",ubreve:"ŭ",Ucirc:"Û",ucirc:"û",Ucy:"У",ucy:"у",udarr:"⇅",Udblac:"Ű",udblac:"ű",udhar:"⥮",ufisht:"⥾",Ufr:"𝔘",ufr:"𝔲",Ugrave:"Ù",ugrave:"ù",uHar:"⥣",uharl:"↿",uharr:"↾",uhblk:"▀",ulcorn:"⌜",ulcorner:"⌜",ulcrop:"⌏",ultri:"◸",Umacr:"Ū",umacr:"ū",uml:"¨",UnderBar:"_",UnderBrace:"⏟",UnderBracket:"⎵",UnderParenthesis:"⏝",Union:"⋃",UnionPlus:"⊎",Uogon:"Ų",uogon:"ų",Uopf:"𝕌",uopf:"𝕦",UpArrow:"↑",Uparrow:"⇑",uparrow:"↑",UpArrowBar:"⤒",UpArrowDownArrow:"⇅",UpDownArrow:"↕",Updownarrow:"⇕",updownarrow:"↕",UpEquilibrium:"⥮",upharpoonleft:"↿",upharpoonright:"↾",uplus:"⊎",UpperLeftArrow:"↖",UpperRightArrow:"↗",Upsi:"ϒ",upsi:"υ",upsih:"ϒ",Upsilon:"Υ",upsilon:"υ",UpTee:"⊥",UpTeeArrow:"↥",upuparrows:"⇈",urcorn:"⌝",urcorner:"⌝",urcrop:"⌎",Uring:"Ů",uring:"ů",urtri:"◹",Uscr:"𝒰",uscr:"𝓊",utdot:"⋰",Utilde:"Ũ",utilde:"ũ",utri:"▵",utrif:"▴",uuarr:"⇈",Uuml:"Ü",uuml:"ü",uwangle:"⦧",vangrt:"⦜",varepsilon:"ϵ",varkappa:"ϰ",varnothing:"∅",varphi:"ϕ",varpi:"ϖ",varpropto:"∝",vArr:"⇕",varr:"↕",varrho:"ϱ",varsigma:"ς",varsubsetneq:"⊊︀",varsubsetneqq:"⫋︀",varsupsetneq:"⊋︀",varsupsetneqq:"⫌︀",vartheta:"ϑ",vartriangleleft:"⊲",vartriangleright:"⊳",Vbar:"⫫",vBar:"⫨",vBarv:"⫩",Vcy:"В",vcy:"в",VDash:"⊫",Vdash:"⊩",vDash:"⊨",vdash:"⊢",Vdashl:"⫦",Vee:"⋁",vee:"∨",veebar:"⊻",veeeq:"≚",vellip:"⋮",Verbar:"‖",verbar:"|",Vert:"‖",vert:"|",VerticalBar:"∣",VerticalLine:"|",VerticalSeparator:"❘",VerticalTilde:"≀",VeryThinSpace:" ",Vfr:"𝔙",vfr:"𝔳",vltri:"⊲",vnsub:"⊂⃒",vnsup:"⊃⃒",Vopf:"𝕍",vopf:"𝕧",vprop:"∝",vrtri:"⊳",Vscr:"𝒱",vscr:"𝓋",vsubnE:"⫋︀",vsubne:"⊊︀",vsupnE:"⫌︀",vsupne:"⊋︀",Vvdash:"⊪",vzigzag:"⦚",Wcirc:"Ŵ",wcirc:"ŵ",wedbar:"⩟",Wedge:"⋀",wedge:"∧",wedgeq:"≙",weierp:"℘",Wfr:"𝔚",wfr:"𝔴",Wopf:"𝕎",wopf:"𝕨",wp:"℘",wr:"≀",wreath:"≀",Wscr:"𝒲",wscr:"𝓌",xcap:"⋂",xcirc:"◯",xcup:"⋃",xdtri:"▽",Xfr:"𝔛",xfr:"𝔵",xhArr:"⟺",xharr:"⟷",Xi:"Ξ",xi:"ξ",xlArr:"⟸",xlarr:"⟵",xmap:"⟼",xnis:"⋻",xodot:"⨀",Xopf:"𝕏",xopf:"𝕩",xoplus:"⨁",xotime:"⨂",xrArr:"⟹",xrarr:"⟶",Xscr:"𝒳",xscr:"𝓍",xsqcup:"⨆",xuplus:"⨄",xutri:"△",xvee:"⋁",xwedge:"⋀",Yacute:"Ý",yacute:"ý",YAcy:"Я",yacy:"я",Ycirc:"Ŷ",ycirc:"ŷ",Ycy:"Ы",ycy:"ы",yen:"¥",Yfr:"𝔜",yfr:"𝔶",YIcy:"Ї",yicy:"ї",Yopf:"𝕐",yopf:"𝕪",Yscr:"𝒴",yscr:"𝓎",YUcy:"Ю",yucy:"ю",Yuml:"Ÿ",yuml:"ÿ",Zacute:"Ź",zacute:"ź",Zcaron:"Ž",zcaron:"ž",Zcy:"З",zcy:"з",Zdot:"Ż",zdot:"ż",zeetrf:"ℨ",ZeroWidthSpace:"​",Zeta:"Ζ",zeta:"ζ",Zfr:"ℨ",zfr:"𝔷",ZHcy:"Ж",zhcy:"ж",zigrarr:"⇝",Zopf:"ℤ",zopf:"𝕫",Zscr:"𝒵",zscr:"𝓏",zwj:"‍",zwnj:"‌"}),e.entityMap=e.HTML_ENTITIES}(entities$1);var sax$1={},NAMESPACE$1=conventions$2.NAMESPACE,nameStartChar=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,nameChar=new RegExp("[\\-\\.0-9"+nameStartChar.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),tagNamePattern=new RegExp("^"+nameStartChar.source+nameChar.source+"*(?::"+nameStartChar.source+nameChar.source+"*)?$"),S_TAG=0,S_ATTR=1,S_ATTR_SPACE=2,S_EQ=3,S_ATTR_NOQUOT_VALUE=4,S_ATTR_END=5,S_TAG_SPACE=6,S_TAG_CLOSE=7;function ParseError$1(e,t){this.message=e,this.locator=t,Error.captureStackTrace&&Error.captureStackTrace(this,ParseError$1)}function XMLReader$1(){}function parse$1(e,t,n,r,a){function i(e){var t=e.slice(1,-1);return Object.hasOwnProperty.call(n,t)?n[t]:"#"===t.charAt(0)?function(e){if(e>65535){var t=55296+((e-=65536)>>10),n=56320+(1023&e);return String.fromCharCode(t,n)}return String.fromCharCode(e)}(parseInt(t.substr(1).replace("x","0x"))):(a.error("entity not found:"+e),e)}function s(t){if(t>f){var n=e.substring(f,t).replace(/&#?\w+;/g,i);h&&o(f),r.characters(n,0,t-f),f=t}}function o(t,n){for(;t>=u&&(n=c.exec(e));)l=n.index,u=l+n[0].length,h.lineNumber++;h.columnNumber=t-l+1}for(var l=0,u=0,c=/.*(?:\r\n?|\n)|.*$/g,h=r.locator,d=[{currentNSMap:t}],p={},f=0;;){try{var m=e.indexOf("<",f);if(m<0){if(!e.substr(f).match(/^\s*$/)){var g=r.doc,y=g.createTextNode(e.substr(f));g.appendChild(y),r.currentElement=y}return}switch(m>f&&s(m),e.charAt(m+1)){case"/":var v=e.indexOf(">",m+3),b=e.substring(m+2,v).replace(/[ \t\n\r]+$/g,""),x=d.pop();v<0?(b=e.substring(m+2).replace(/[\s<].*/,""),a.error("end tag name: "+b+" is not complete:"+x.tagName),v=m+1+b.length):b.match(/\s</)&&(b=b.replace(/[\s<].*/,""),a.error("end tag name: "+b+" maybe not complete"),v=m+1+b.length);var T=x.localNSMap,_=x.tagName==b;if(_||x.tagName&&x.tagName.toLowerCase()==b.toLowerCase()){if(r.endElement(x.uri,x.localName,b),T)for(var w in T)Object.prototype.hasOwnProperty.call(T,w)&&r.endPrefixMapping(w);_||a.fatalError("end tag name: "+b+" is not match the current start tagName:"+x.tagName)}else d.push(x);v++;break;case"?":h&&o(m),v=parseInstruction(e,m,r);break;case"!":h&&o(m),v=parseDCC(e,m,r,a);break;default:h&&o(m);var S=new ElementAttributes,C=d[d.length-1].currentNSMap,E=(v=parseElementStartPart(e,m,S,C,i,a),S.length);if(!S.closed&&fixSelfClosed(e,v,S.tagName,p)&&(S.closed=!0,n.nbsp||a.warning("unclosed xml attribute")),h&&E){for(var k=copyLocator(h,{}),I=0;I<E;I++){var A=S[I];o(A.offset),A.locator=copyLocator(h,{})}r.locator=k,appendElement$1(S,r,C)&&d.push(S),r.locator=h}else appendElement$1(S,r,C)&&d.push(S);NAMESPACE$1.isHTML(S.uri)&&!S.closed?v=parseHtmlSpecialContent(e,v,S.tagName,i,r):v++}}catch(e2){if(e2 instanceof ParseError$1)throw e2;a.error("element parse error: "+e2),v=-1}v>f?f=v:s(Math.max(m,f)+1)}}function copyLocator(e,t){return t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber,t}function parseElementStartPart(e,t,n,r,a,i){function s(e,t,r){n.attributeNames.hasOwnProperty(e)&&i.fatalError("Attribute "+e+" redefined"),n.addValue(e,t.replace(/[\t\n\r]/g," ").replace(/&#?\w+;/g,a),r)}for(var o,l=++t,u=S_TAG;;){var c=e.charAt(l);switch(c){case"=":if(u===S_ATTR)o=e.slice(t,l),u=S_EQ;else{if(u!==S_ATTR_SPACE)throw new Error("attribute equal must after attrName");u=S_EQ}break;case"'":case'"':if(u===S_EQ||u===S_ATTR){if(u===S_ATTR&&(i.warning('attribute value must after "="'),o=e.slice(t,l)),t=l+1,!((l=e.indexOf(c,t))>0))throw new Error("attribute value no end '"+c+"' match");s(o,h=e.slice(t,l),t-1),u=S_ATTR_END}else{if(u!=S_ATTR_NOQUOT_VALUE)throw new Error('attribute value must after "="');s(o,h=e.slice(t,l),t),i.warning('attribute "'+o+'" missed start quot('+c+")!!"),t=l+1,u=S_ATTR_END}break;case"/":switch(u){case S_TAG:n.setTagName(e.slice(t,l));case S_ATTR_END:case S_TAG_SPACE:case S_TAG_CLOSE:u=S_TAG_CLOSE,n.closed=!0;case S_ATTR_NOQUOT_VALUE:case S_ATTR:break;case S_ATTR_SPACE:n.closed=!0;break;default:throw new Error("attribute invalid close char('/')")}break;case"":return i.error("unexpected end of input"),u==S_TAG&&n.setTagName(e.slice(t,l)),l;case">":switch(u){case S_TAG:n.setTagName(e.slice(t,l));case S_ATTR_END:case S_TAG_SPACE:case S_TAG_CLOSE:break;case S_ATTR_NOQUOT_VALUE:case S_ATTR:"/"===(h=e.slice(t,l)).slice(-1)&&(n.closed=!0,h=h.slice(0,-1));case S_ATTR_SPACE:u===S_ATTR_SPACE&&(h=o),u==S_ATTR_NOQUOT_VALUE?(i.warning('attribute "'+h+'" missed quot(")!'),s(o,h,t)):(NAMESPACE$1.isHTML(r[""])&&h.match(/^(?:disabled|checked|selected)$/i)||i.warning('attribute "'+h+'" missed value!! "'+h+'" instead!!'),s(h,h,t));break;case S_EQ:throw new Error("attribute value missed!!")}return l;case"":c=" ";default:if(c<=" ")switch(u){case S_TAG:n.setTagName(e.slice(t,l)),u=S_TAG_SPACE;break;case S_ATTR:o=e.slice(t,l),u=S_ATTR_SPACE;break;case S_ATTR_NOQUOT_VALUE:var h=e.slice(t,l);i.warning('attribute "'+h+'" missed quot(")!!'),s(o,h,t);case S_ATTR_END:u=S_TAG_SPACE}else switch(u){case S_ATTR_SPACE:n.tagName,NAMESPACE$1.isHTML(r[""])&&o.match(/^(?:disabled|checked|selected)$/i)||i.warning('attribute "'+o+'" missed value!! "'+o+'" instead2!!'),s(o,o,t),t=l,u=S_ATTR;break;case S_ATTR_END:i.warning('attribute space is required"'+o+'"!!');case S_TAG_SPACE:u=S_ATTR,t=l;break;case S_EQ:u=S_ATTR_NOQUOT_VALUE,t=l;break;case S_TAG_CLOSE:throw new Error("elements closed character '/' and '>' must be connected to")}}l++}}function appendElement$1(e,t,n){for(var r=e.tagName,a=null,i=e.length;i--;){var s=e[i],o=s.qName,l=s.value;if((d=o.indexOf(":"))>0)var u=s.prefix=o.slice(0,d),c=o.slice(d+1),h="xmlns"===u&&c;else c=o,u=null,h="xmlns"===o&&"";s.localName=c,!1!==h&&(null==a&&(a={},_copy(n,n={})),n[h]=a[h]=l,s.uri=NAMESPACE$1.XMLNS,t.startPrefixMapping(h,l))}for(i=e.length;i--;){(u=(s=e[i]).prefix)&&("xml"===u&&(s.uri=NAMESPACE$1.XML),"xmlns"!==u&&(s.uri=n[u||""]))}var d;(d=r.indexOf(":"))>0?(u=e.prefix=r.slice(0,d),c=e.localName=r.slice(d+1)):(u=null,c=e.localName=r);var p=e.uri=n[u||""];if(t.startElement(p,c,r,e),!e.closed)return e.currentNSMap=n,e.localNSMap=a,!0;if(t.endElement(p,c,r),a)for(u in a)Object.prototype.hasOwnProperty.call(a,u)&&t.endPrefixMapping(u)}function parseHtmlSpecialContent(e,t,n,r,a){if(/^(?:script|textarea)$/i.test(n)){var i=e.indexOf("</"+n+">",t),s=e.substring(t+1,i);if(/[&<]/.test(s))return/^script$/i.test(n)?(a.characters(s,0,s.length),i):(s=s.replace(/&#?\w+;/g,r),a.characters(s,0,s.length),i)}return t+1}function fixSelfClosed(e,t,n,r){var a=r[n];return null==a&&((a=e.lastIndexOf("</"+n+">"))<t&&(a=e.lastIndexOf("</"+n)),r[n]=a),a<t}function _copy(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}function parseDCC(e,t,n,r){if("-"===e.charAt(t+2))return"-"===e.charAt(t+3)?(a=e.indexOf("--\x3e",t+4))>t?(n.comment(e,t+4,a-t-4),a+3):(r.error("Unclosed comment"),-1):-1;if("CDATA["==e.substr(t+3,6)){var a=e.indexOf("]]>",t+9);return n.startCDATA(),n.characters(e,t+9,a-t-9),n.endCDATA(),a+3}var i=split(e,t),s=i.length;if(s>1&&/!doctype/i.test(i[0][0])){var o=i[1][0],l=!1,u=!1;s>3&&(/^public$/i.test(i[2][0])?(l=i[3][0],u=s>4&&i[4][0]):/^system$/i.test(i[2][0])&&(u=i[3][0]));var c=i[s-1];return n.startDTD(o,l,u),n.endDTD(),c.index+c[0].length}return-1}function parseInstruction(e,t,n){var r=e.indexOf("?>",t);if(r){var a=e.substring(t,r).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);return a?(a[0].length,n.processingInstruction(a[1],a[2]),r+2):-1}return-1}function ElementAttributes(){this.attributeNames={}}function split(e,t){var n,r=[],a=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(a.lastIndex=t,a.exec(e);n=a.exec(e);)if(r.push(n),n[1])return r}ParseError$1.prototype=new Error,ParseError$1.prototype.name=ParseError$1.name,XMLReader$1.prototype={parse:function(e,t,n){var r=this.domBuilder;r.startDocument(),_copy(t,t={}),parse$1(e,t,n,r,this.errorHandler),r.endDocument()}},ElementAttributes.prototype={setTagName:function(e){if(!tagNamePattern.test(e))throw new Error("invalid tagName:"+e);this.tagName=e},addValue:function(e,t,n){if(!tagNamePattern.test(e))throw new Error("invalid attribute:"+e);this.attributeNames[e]=this.length,this[this.length++]={qName:e,value:t,offset:n}},length:0,getLocalName:function(e){return this[e].localName},getLocator:function(e){return this[e].locator},getQName:function(e){return this[e].qName},getURI:function(e){return this[e].uri},getValue:function(e){return this[e].value}},sax$1.XMLReader=XMLReader$1,sax$1.ParseError=ParseError$1;var conventions=conventions$2,dom=dom$1,entities=entities$1,sax=sax$1,DOMImplementation=dom.DOMImplementation,NAMESPACE=conventions.NAMESPACE,ParseError=sax.ParseError,XMLReader=sax.XMLReader;function normalizeLineEndings(e){return e.replace(/\r[\n\u0085]/g,"\n").replace(/[\r\u0085\u2028]/g,"\n")}function DOMParser$1(e){this.options=e||{locator:{}}}function buildErrorHandler(e,t,n){if(!e){if(t instanceof DOMHandler)return t;e=t}var r={},a=e instanceof Function;function i(t){var i=e[t];!i&&a&&(i=2==e.length?function(n){e(t,n)}:e),r[t]=i&&function(e){i("[xmldom "+t+"]\t"+e+_locator(n))}||function(){}}return n=n||{},i("warning"),i("error"),i("fatalError"),r}function DOMHandler(){this.cdata=!1}function position(e,t){t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber}function _locator(e){if(e)return"\n@"+(e.systemId||"")+"#[line:"+e.lineNumber+",col:"+e.columnNumber+"]"}function _toString(e,t,n){return"string"==typeof e?e.substr(t,n):e.length>=t+n||t?new java.lang.String(e,t,n)+"":e}function appendElement(e,t){e.currentElement?e.currentElement.appendChild(t):e.doc.appendChild(t)}DOMParser$1.prototype.parseFromString=function(e,t){var n=this.options,r=new XMLReader,a=n.domBuilder||new DOMHandler,i=n.errorHandler,s=n.locator,o=n.xmlns||{},l=/\/x?html?$/.test(t),u=l?entities.HTML_ENTITIES:entities.XML_ENTITIES;s&&a.setDocumentLocator(s),r.errorHandler=buildErrorHandler(i,a,s),r.domBuilder=n.domBuilder||a,l&&(o[""]=NAMESPACE.HTML),o.xml=o.xml||NAMESPACE.XML;var c=n.normalizeLineEndings||normalizeLineEndings;return e&&"string"==typeof e?r.parse(c(e),o,u):r.errorHandler.error("invalid doc source"),a.doc},DOMHandler.prototype={startDocument:function(){this.doc=(new DOMImplementation).createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(e,t,n,r){var a=this.doc,i=a.createElementNS(e,n||t),s=r.length;appendElement(this,i),this.currentElement=i,this.locator&&position(this.locator,i);for(var o=0;o<s;o++){e=r.getURI(o);var l=r.getValue(o),u=(n=r.getQName(o),a.createAttributeNS(e,n));this.locator&&position(r.getLocator(o),u),u.value=u.nodeValue=l,i.setAttributeNode(u)}},endElement:function(e,t,n){var r=this.currentElement;r.tagName,this.currentElement=r.parentNode},startPrefixMapping:function(e,t){},endPrefixMapping:function(e){},processingInstruction:function(e,t){var n=this.doc.createProcessingInstruction(e,t);this.locator&&position(this.locator,n),appendElement(this,n)},ignorableWhitespace:function(e,t,n){},characters:function(e,t,n){if(e=_toString.apply(this,arguments)){if(this.cdata)var r=this.doc.createCDATASection(e);else r=this.doc.createTextNode(e);this.currentElement?this.currentElement.appendChild(r):/^\s*$/.test(e)&&this.doc.appendChild(r),this.locator&&position(this.locator,r)}},skippedEntity:function(e){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(e){(this.locator=e)&&(e.lineNumber=0)},comment:function(e,t,n){e=_toString.apply(this,arguments);var r=this.doc.createComment(e);this.locator&&position(this.locator,r),appendElement(this,r)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(e,t,n){var r=this.doc.implementation;if(r&&r.createDocumentType){var a=r.createDocumentType(e,t,n);this.locator&&position(this.locator,a),appendElement(this,a),this.doc.doctype=a}},warning:function(e){console.warn("[xmldom warning]\t"+e,_locator(this.locator))},error:function(e){console.error("[xmldom error]\t"+e,_locator(this.locator))},fatalError:function(e){throw new ParseError(e,this.locator)}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,(function(e){DOMHandler.prototype[e]=function(){return null}})),domParser.__DOMHandler=DOMHandler,domParser.normalizeLineEndings=normalizeLineEndings,domParser.DOMParser=DOMParser$1;var DOMParser=domParser.DOMParser;
/*! @name mpd-parser @version 1.3.0 @license Apache-2.0 */const isObject$1=e=>!!e&&"object"==typeof e,merge$2=(...e)=>e.reduce(((e,t)=>("object"!=typeof t||Object.keys(t).forEach((n=>{Array.isArray(e[n])&&Array.isArray(t[n])?e[n]=e[n].concat(t[n]):isObject$1(e[n])&&isObject$1(t[n])?e[n]=merge$2(e[n],t[n]):e[n]=t[n]})),e)),{}),values$1=e=>Object.keys(e).map((t=>e[t])),range=(e,t)=>{const n=[];for(let r=e;r<t;r++)n.push(r);return n},flatten=e=>e.reduce(((e,t)=>e.concat(t)),[]),from=e=>{if(!e.length)return[];const t=[];for(let n=0;n<e.length;n++)t.push(e[n]);return t},findIndexes=(e,t)=>e.reduce(((e,n,r)=>(n[t]&&e.push(r),e)),[]),union=(e,t)=>values$1(e.reduce(((e,n)=>(n.forEach((n=>{e[t(n)]=n})),e)),{}));var errors={INVALID_NUMBER_OF_PERIOD:"INVALID_NUMBER_OF_PERIOD",INVALID_NUMBER_OF_CONTENT_STEERING:"INVALID_NUMBER_OF_CONTENT_STEERING",DASH_EMPTY_MANIFEST:"DASH_EMPTY_MANIFEST",DASH_INVALID_XML:"DASH_INVALID_XML",NO_BASE_URL:"NO_BASE_URL",MISSING_SEGMENT_INFORMATION:"MISSING_SEGMENT_INFORMATION",SEGMENT_TIME_UNSPECIFIED:"SEGMENT_TIME_UNSPECIFIED",UNSUPPORTED_UTC_TIMING_SCHEME:"UNSUPPORTED_UTC_TIMING_SCHEME"};const urlTypeToSegment=({baseUrl:e="",source:t="",range:n="",indexRange:r=""})=>{const a={uri:t,resolvedUri:resolveUrl$1(e||"",t)};if(n||r){const e=(n||r).split("-");let t,i=window$1$1.BigInt?window$1$1.BigInt(e[0]):parseInt(e[0],10),s=window$1$1.BigInt?window$1$1.BigInt(e[1]):parseInt(e[1],10);i<Number.MAX_SAFE_INTEGER&&"bigint"==typeof i&&(i=Number(i)),s<Number.MAX_SAFE_INTEGER&&"bigint"==typeof s&&(s=Number(s)),t="bigint"==typeof s||"bigint"==typeof i?window$1$1.BigInt(s)-window$1$1.BigInt(i)+window$1$1.BigInt(1):s-i+1,"bigint"==typeof t&&t<Number.MAX_SAFE_INTEGER&&(t=Number(t)),a.byterange={length:t,offset:i}}return a},byteRangeToString=e=>{let t;return t="bigint"==typeof e.offset||"bigint"==typeof e.length?window$1$1.BigInt(e.offset)+window$1$1.BigInt(e.length)-window$1$1.BigInt(1):e.offset+e.length-1,`${e.offset}-${t}`},parseEndNumber=e=>(e&&"number"!=typeof e&&(e=parseInt(e,10)),isNaN(e)?null:e),segmentRange={static(e){const{duration:t,timescale:n=1,sourceDuration:r,periodDuration:a}=e,i=parseEndNumber(e.endNumber),s=t/n;return"number"==typeof i?{start:0,end:i}:"number"==typeof a?{start:0,end:a/s}:{start:0,end:r/s}},dynamic(e){const{NOW:t,clientOffset:n,availabilityStartTime:r,timescale:a=1,duration:i,periodStart:s=0,minimumUpdatePeriod:o=0,timeShiftBufferDepth:l=1/0}=e,u=parseEndNumber(e.endNumber),c=(t+n)/1e3,h=r+s,d=c+o-h,p=Math.ceil(d*a/i),f=Math.floor((c-h-l)*a/i),m=Math.floor((c-h)*a/i);return{start:Math.max(0,f),end:"number"==typeof u?u:Math.min(p,m)}}},toSegments=e=>t=>{const{duration:n,timescale:r=1,periodStart:a,startNumber:i=1}=e;return{number:i+t,duration:n/r,timeline:a,time:t*n}},parseByDuration=e=>{const{type:t,duration:n,timescale:r=1,periodDuration:a,sourceDuration:i}=e,{start:s,end:o}=segmentRange[t](e),l=range(s,o).map(toSegments(e));if("static"===t){const e=l.length-1,t="number"==typeof a?a:i;l[e].duration=t-n/r*e}return l},segmentsFromBase=e=>{const{baseUrl:t,initialization:n={},sourceDuration:r,indexRange:a="",periodStart:i,presentationTime:s,number:o=0,duration:l}=e;if(!t)throw new Error(errors.NO_BASE_URL);const u=urlTypeToSegment({baseUrl:t,source:n.sourceURL,range:n.range}),c=urlTypeToSegment({baseUrl:t,source:t,indexRange:a});if(c.map=u,l){const t=parseByDuration(e);t.length&&(c.duration=t[0].duration,c.timeline=t[0].timeline)}else r&&(c.duration=r,c.timeline=i);return c.presentationTime=s||i,c.number=o,[c]},addSidxSegmentsToPlaylist$1=(e,t,n)=>{const r=e.sidx.map?e.sidx.map:null,a=e.sidx.duration,i=e.timeline||0,s=e.sidx.byterange,o=s.offset+s.length,l=t.timescale,u=t.references.filter((e=>1!==e.referenceType)),c=[],h=e.endList?"static":"dynamic",d=e.sidx.timeline;let p,f=d,m=e.mediaSequence||0;p="bigint"==typeof t.firstOffset?window$1$1.BigInt(o)+t.firstOffset:o+t.firstOffset;for(let g=0;g<u.length;g++){const e=t.references[g],s=e.referencedSize,o=e.subsegmentDuration;let u;u="bigint"==typeof p?p+window$1$1.BigInt(s)-window$1$1.BigInt(1):p+s-1;const y=segmentsFromBase({baseUrl:n,timescale:l,timeline:i,periodStart:d,presentationTime:f,number:m,duration:o,sourceDuration:a,indexRange:`${p}-${u}`,type:h})[0];r&&(y.map=r),c.push(y),p+="bigint"==typeof p?window$1$1.BigInt(s):s,f+=o/l,m++}return e.segments=c,e},SUPPORTED_MEDIA_TYPES=["AUDIO","SUBTITLES"],TIME_FUDGE=1/60,getUniqueTimelineStarts=e=>union(e,(({timeline:e})=>e)).sort(((e,t)=>e.timeline>t.timeline?1:-1)),findPlaylistWithName=(e,t)=>{for(let n=0;n<e.length;n++)if(e[n].attributes.NAME===t)return e[n];return null},getMediaGroupPlaylists=e=>{let t=[];return forEachMediaGroup$1(e,SUPPORTED_MEDIA_TYPES,((e,n,r,a)=>{t=t.concat(e.playlists||[])})),t},updateMediaSequenceForPlaylist=({playlist:e,mediaSequence:t})=>{e.mediaSequence=t,e.segments.forEach(((t,n)=>{t.number=e.mediaSequence+n}))},updateSequenceNumbers=({oldPlaylists:e,newPlaylists:t,timelineStarts:n})=>{t.forEach((t=>{t.discontinuitySequence=n.findIndex((function({timeline:e}){return e===t.timeline}));const r=findPlaylistWithName(e,t.attributes.NAME);if(!r)return;if(t.sidx)return;const a=t.segments[0],i=r.segments.findIndex((function(e){return Math.abs(e.presentationTime-a.presentationTime)<TIME_FUDGE}));if(-1===i)return updateMediaSequenceForPlaylist({playlist:t,mediaSequence:r.mediaSequence+r.segments.length}),t.segments[0].discontinuity=!0,t.discontinuityStarts.unshift(0),void((!r.segments.length&&t.timeline>r.timeline||r.segments.length&&t.timeline>r.segments[r.segments.length-1].timeline)&&t.discontinuitySequence--);r.segments[i].discontinuity&&!a.discontinuity&&(a.discontinuity=!0,t.discontinuityStarts.unshift(0),t.discontinuitySequence--),updateMediaSequenceForPlaylist({playlist:t,mediaSequence:r.segments[i].number})}))},positionManifestOnTimeline=({oldManifest:e,newManifest:t})=>{const n=e.playlists.concat(getMediaGroupPlaylists(e)),r=t.playlists.concat(getMediaGroupPlaylists(t));return t.timelineStarts=getUniqueTimelineStarts([e.timelineStarts,t.timelineStarts]),updateSequenceNumbers({oldPlaylists:n,newPlaylists:r,timelineStarts:t.timelineStarts}),t},generateSidxKey=e=>e&&e.uri+"-"+byteRangeToString(e.byterange),mergeDiscontiguousPlaylists=e=>{const t=e.reduce((function(e,t){return e[t.attributes.baseUrl]||(e[t.attributes.baseUrl]=[]),e[t.attributes.baseUrl].push(t),e}),{});let n=[];return Object.values(t).forEach((e=>{const t=values$1(e.reduce(((e,t)=>{const n=t.attributes.id+(t.attributes.lang||"");return e[n]?(t.segments&&(t.segments[0]&&(t.segments[0].discontinuity=!0),e[n].segments.push(...t.segments)),t.attributes.contentProtection&&(e[n].attributes.contentProtection=t.attributes.contentProtection)):(e[n]=t,e[n].attributes.timelineStarts=[]),e[n].attributes.timelineStarts.push({start:t.attributes.periodStart,timeline:t.attributes.periodStart}),e}),{}));n=n.concat(t)})),n.map((e=>(e.discontinuityStarts=findIndexes(e.segments||[],"discontinuity"),e)))},addSidxSegmentsToPlaylist=(e,t)=>{const n=generateSidxKey(e.sidx),r=n&&t[n]&&t[n].sidx;return r&&addSidxSegmentsToPlaylist$1(e,r,e.sidx.resolvedUri),e},addSidxSegmentsToPlaylists=(e,t={})=>{if(!Object.keys(t).length)return e;for(const n in e)e[n]=addSidxSegmentsToPlaylist(e[n],t);return e},formatAudioPlaylist=({attributes:e,segments:t,sidx:n,mediaSequence:r,discontinuitySequence:a,discontinuityStarts:i},s)=>{const o={attributes:{NAME:e.id,BANDWIDTH:e.bandwidth,CODECS:e.codecs,"PROGRAM-ID":1},uri:"",endList:"static"===e.type,timeline:e.periodStart,resolvedUri:e.baseUrl||"",targetDuration:e.duration,discontinuitySequence:a,discontinuityStarts:i,timelineStarts:e.timelineStarts,mediaSequence:r,segments:t};return e.contentProtection&&(o.contentProtection=e.contentProtection),e.serviceLocation&&(o.attributes.serviceLocation=e.serviceLocation),n&&(o.sidx=n),s&&(o.attributes.AUDIO="audio",o.attributes.SUBTITLES="subs"),o},formatVttPlaylist=({attributes:e,segments:t,mediaSequence:n,discontinuityStarts:r,discontinuitySequence:a})=>{void 0===t&&(t=[{uri:e.baseUrl,timeline:e.periodStart,resolvedUri:e.baseUrl||"",duration:e.sourceDuration,number:0}],e.duration=e.sourceDuration);const i={NAME:e.id,BANDWIDTH:e.bandwidth,"PROGRAM-ID":1};e.codecs&&(i.CODECS=e.codecs);const s={attributes:i,uri:"",endList:"static"===e.type,timeline:e.periodStart,resolvedUri:e.baseUrl||"",targetDuration:e.duration,timelineStarts:e.timelineStarts,discontinuityStarts:r,discontinuitySequence:a,mediaSequence:n,segments:t};return e.serviceLocation&&(s.attributes.serviceLocation=e.serviceLocation),s},organizeAudioPlaylists=(e,t={},n=!1)=>{let r;const a=e.reduce(((e,a)=>{const i=a.attributes.role&&a.attributes.role.value||"",s=a.attributes.lang||"";let o=a.attributes.label||"main";if(s&&!a.attributes.label){const e=i?` (${i})`:"";o=`${a.attributes.lang}${e}`}e[o]||(e[o]={language:s,autoselect:!0,default:"main"===i,playlists:[],uri:""});const l=addSidxSegmentsToPlaylist(formatAudioPlaylist(a,n),t);return e[o].playlists.push(l),void 0===r&&"main"===i&&(r=a,r.default=!0),e}),{});if(!r){a[Object.keys(a)[0]].default=!0}return a},organizeVttPlaylists=(e,t={})=>e.reduce(((e,n)=>{const r=n.attributes.label||n.attributes.lang||"text";return e[r]||(e[r]={language:r,default:!1,autoselect:!1,playlists:[],uri:""}),e[r].playlists.push(addSidxSegmentsToPlaylist(formatVttPlaylist(n),t)),e}),{}),organizeCaptionServices=e=>e.reduce(((e,t)=>t?(t.forEach((t=>{const{channel:n,language:r}=t;e[r]={autoselect:!1,default:!1,instreamId:n,language:r},t.hasOwnProperty("aspectRatio")&&(e[r].aspectRatio=t.aspectRatio),t.hasOwnProperty("easyReader")&&(e[r].easyReader=t.easyReader),t.hasOwnProperty("3D")&&(e[r]["3D"]=t["3D"])})),e):e),{}),formatVideoPlaylist=({attributes:e,segments:t,sidx:n,discontinuityStarts:r})=>{const a={attributes:{NAME:e.id,AUDIO:"audio",SUBTITLES:"subs",RESOLUTION:{width:e.width,height:e.height},CODECS:e.codecs,BANDWIDTH:e.bandwidth,"PROGRAM-ID":1},uri:"",endList:"static"===e.type,timeline:e.periodStart,resolvedUri:e.baseUrl||"",targetDuration:e.duration,discontinuityStarts:r,timelineStarts:e.timelineStarts,segments:t};return e.frameRate&&(a.attributes["FRAME-RATE"]=e.frameRate),e.contentProtection&&(a.contentProtection=e.contentProtection),e.serviceLocation&&(a.attributes.serviceLocation=e.serviceLocation),n&&(a.sidx=n),a},videoOnly=({attributes:e})=>"video/mp4"===e.mimeType||"video/webm"===e.mimeType||"video"===e.contentType,audioOnly=({attributes:e})=>"audio/mp4"===e.mimeType||"audio/webm"===e.mimeType||"audio"===e.contentType,vttOnly=({attributes:e})=>"text/vtt"===e.mimeType||"text"===e.contentType,addMediaSequenceValues=(e,t)=>{e.forEach((e=>{e.mediaSequence=0,e.discontinuitySequence=t.findIndex((function({timeline:t}){return t===e.timeline})),e.segments&&e.segments.forEach(((e,t)=>{e.number=t}))}))},flattenMediaGroupPlaylists=e=>e?Object.keys(e).reduce(((t,n)=>{const r=e[n];return t.concat(r.playlists)}),[]):[],toM3u8=({dashPlaylists:e,locations:t,contentSteering:n,sidxMapping:r={},previousManifest:a,eventStream:i})=>{if(!e.length)return{};const{sourceDuration:s,type:o,suggestedPresentationDelay:l,minimumUpdatePeriod:u}=e[0].attributes,c=mergeDiscontiguousPlaylists(e.filter(videoOnly)).map(formatVideoPlaylist),h=mergeDiscontiguousPlaylists(e.filter(audioOnly)),d=mergeDiscontiguousPlaylists(e.filter(vttOnly)),p=e.map((e=>e.attributes.captionServices)).filter(Boolean),f={allowCache:!0,discontinuityStarts:[],segments:[],endList:!0,mediaGroups:{AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},uri:"",duration:s,playlists:addSidxSegmentsToPlaylists(c,r)};u>=0&&(f.minimumUpdatePeriod=1e3*u),t&&(f.locations=t),n&&(f.contentSteering=n),"dynamic"===o&&(f.suggestedPresentationDelay=l),i&&i.length>0&&(f.eventStream=i);const m=0===f.playlists.length,g=h.length?organizeAudioPlaylists(h,r,m):null,y=d.length?organizeVttPlaylists(d,r):null,v=c.concat(flattenMediaGroupPlaylists(g),flattenMediaGroupPlaylists(y)),b=v.map((({timelineStarts:e})=>e));return f.timelineStarts=getUniqueTimelineStarts(b),addMediaSequenceValues(v,f.timelineStarts),g&&(f.mediaGroups.AUDIO.audio=g),y&&(f.mediaGroups.SUBTITLES.subs=y),p.length&&(f.mediaGroups["CLOSED-CAPTIONS"].cc=organizeCaptionServices(p)),a?positionManifestOnTimeline({oldManifest:a,newManifest:f}):f},getLiveRValue=(e,t,n)=>{const{NOW:r,clientOffset:a,availabilityStartTime:i,timescale:s=1,periodStart:o=0,minimumUpdatePeriod:l=0}=e,u=(r+a)/1e3+l-(i+o);return Math.ceil((u*s-t)/n)},parseByTimeline=(e,t)=>{const{type:n,minimumUpdatePeriod:r=0,media:a="",sourceDuration:i,timescale:s=1,startNumber:o=1,periodStart:l}=e,u=[];let c=-1;for(let h=0;h<t.length;h++){const d=t[h],p=d.d,f=d.r||0,m=d.t||0;let g;if(c<0&&(c=m),m&&m>c&&(c=m),f<0){const o=h+1;g=o===t.length?"dynamic"===n&&r>0&&a.indexOf("$Number$")>0?getLiveRValue(e,c,p):(i*s-c)/p:(t[o].t-c)/p}else g=f+1;const y=o+u.length+g;let v=o+u.length;for(;v<y;)u.push({number:v,duration:p/s,time:c,timeline:l}),c+=p,v++}return u},identifierPattern=/\$([A-z]*)(?:(%0)([0-9]+)d)?\$/g,identifierReplacement=e=>(t,n,r,a)=>{if("$$"===t)return"$";if(void 0===e[n])return t;const i=""+e[n];return"RepresentationID"===n?i:(a=r?parseInt(a,10):1,i.length>=a?i:`${new Array(a-i.length+1).join("0")}${i}`)},constructTemplateUrl=(e,t)=>e.replace(identifierPattern,identifierReplacement(t)),parseTemplateInfo=(e,t)=>e.duration||t?e.duration?parseByDuration(e):parseByTimeline(e,t):[{number:e.startNumber||1,duration:e.sourceDuration,time:0,timeline:e.periodStart}],segmentsFromTemplate=(e,t)=>{const n={RepresentationID:e.id,Bandwidth:e.bandwidth||0},{initialization:r={sourceURL:"",range:""}}=e,a=urlTypeToSegment({baseUrl:e.baseUrl,source:constructTemplateUrl(r.sourceURL,n),range:r.range});return parseTemplateInfo(e,t).map((t=>{n.Number=t.number,n.Time=t.time;const r=constructTemplateUrl(e.media||"",n),i=e.timescale||1,s=e.presentationTimeOffset||0,o=e.periodStart+(t.time-s)/i;return{uri:r,timeline:t.timeline,duration:t.duration,resolvedUri:resolveUrl$1(e.baseUrl||"",r),map:a,number:t.number,presentationTime:o}}))},SegmentURLToSegmentObject=(e,t)=>{const{baseUrl:n,initialization:r={}}=e,a=urlTypeToSegment({baseUrl:n,source:r.sourceURL,range:r.range}),i=urlTypeToSegment({baseUrl:n,source:t.media,range:t.mediaRange});return i.map=a,i},segmentsFromList=(e,t)=>{const{duration:n,segmentUrls:r=[],periodStart:a}=e;if(!n&&!t||n&&t)throw new Error(errors.SEGMENT_TIME_UNSPECIFIED);const i=r.map((t=>SegmentURLToSegmentObject(e,t)));let s;n&&(s=parseByDuration(e)),t&&(s=parseByTimeline(e,t));return s.map(((t,n)=>{if(i[n]){const r=i[n],s=e.timescale||1,o=e.presentationTimeOffset||0;return r.timeline=t.timeline,r.duration=t.duration,r.number=t.number,r.presentationTime=a+(t.time-o)/s,r}})).filter((e=>e))},generateSegments=({attributes:e,segmentInfo:t})=>{let n,r;t.template?(r=segmentsFromTemplate,n=merge$2(e,t.template)):t.base?(r=segmentsFromBase,n=merge$2(e,t.base)):t.list&&(r=segmentsFromList,n=merge$2(e,t.list));const a={attributes:e};if(!r)return a;const i=r(n,t.segmentTimeline);if(n.duration){const{duration:e,timescale:t=1}=n;n.duration=e/t}else i.length?n.duration=i.reduce(((e,t)=>Math.max(e,Math.ceil(t.duration))),0):n.duration=0;return a.attributes=n,a.segments=i,t.base&&n.indexRange&&(a.sidx=i[0],a.segments=[]),a},toPlaylists=e=>e.map(generateSegments),findChildren=(e,t)=>from(e.childNodes).filter((({tagName:e})=>e===t)),getContent=e=>e.textContent.trim(),parseDivisionValue=e=>parseFloat(e.split("/").reduce(((e,t)=>e/t))),parseDuration=e=>{const t=/P(?:(\d*)Y)?(?:(\d*)M)?(?:(\d*)D)?(?:T(?:(\d*)H)?(?:(\d*)M)?(?:([\d.]*)S)?)?/.exec(e);if(!t)return 0;const[n,r,a,i,s,o]=t.slice(1);return 31536e3*parseFloat(n||0)+2592e3*parseFloat(r||0)+86400*parseFloat(a||0)+3600*parseFloat(i||0)+60*parseFloat(s||0)+parseFloat(o||0)},parseDate=e=>(/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test(e)&&(e+="Z"),Date.parse(e)),parsers={mediaPresentationDuration:e=>parseDuration(e),availabilityStartTime:e=>parseDate(e)/1e3,minimumUpdatePeriod:e=>parseDuration(e),suggestedPresentationDelay:e=>parseDuration(e),type:e=>e,timeShiftBufferDepth:e=>parseDuration(e),start:e=>parseDuration(e),width:e=>parseInt(e,10),height:e=>parseInt(e,10),bandwidth:e=>parseInt(e,10),frameRate:e=>parseDivisionValue(e),startNumber:e=>parseInt(e,10),timescale:e=>parseInt(e,10),presentationTimeOffset:e=>parseInt(e,10),duration(e){const t=parseInt(e,10);return isNaN(t)?parseDuration(e):t},d:e=>parseInt(e,10),t:e=>parseInt(e,10),r:e=>parseInt(e,10),presentationTime:e=>parseInt(e,10),DEFAULT:e=>e},parseAttributes=e=>e&&e.attributes?from(e.attributes).reduce(((e,t)=>{const n=parsers[t.name]||parsers.DEFAULT;return e[t.name]=n(t.value),e}),{}):{},keySystemsMap={"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b":"org.w3.clearkey","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":"com.widevine.alpha","urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95":"com.microsoft.playready","urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb":"com.adobe.primetime","urn:mpeg:dash:mp4protection:2011":"mp4protection"},buildBaseUrls=(e,t)=>t.length?flatten(e.map((function(e){return t.map((function(t){const n=getContent(t),r=resolveUrl$1(e.baseUrl,n),a=merge$2(parseAttributes(t),{baseUrl:r});return r!==n&&!a.serviceLocation&&e.serviceLocation&&(a.serviceLocation=e.serviceLocation),a}))}))):e,getSegmentInformation=e=>{const t=findChildren(e,"SegmentTemplate")[0],n=findChildren(e,"SegmentList")[0],r=n&&findChildren(n,"SegmentURL").map((e=>merge$2({tag:"SegmentURL"},parseAttributes(e)))),a=findChildren(e,"SegmentBase")[0],i=n||t,s=i&&findChildren(i,"SegmentTimeline")[0],o=n||a||t,l=o&&findChildren(o,"Initialization")[0],u=t&&parseAttributes(t);u&&l?u.initialization=l&&parseAttributes(l):u&&u.initialization&&(u.initialization={sourceURL:u.initialization});const c={template:u,segmentTimeline:s&&findChildren(s,"S").map((e=>parseAttributes(e))),list:n&&merge$2(parseAttributes(n),{segmentUrls:r,initialization:parseAttributes(l)}),base:a&&merge$2(parseAttributes(a),{initialization:parseAttributes(l)})};return Object.keys(c).forEach((e=>{c[e]||delete c[e]})),c},inheritBaseUrls=(e,t,n)=>r=>{const a=findChildren(r,"BaseURL"),i=buildBaseUrls(t,a),s=merge$2(e,parseAttributes(r)),o=getSegmentInformation(r);return i.map((e=>({segmentInfo:merge$2(n,o),attributes:merge$2(s,e)})))},generateKeySystemInformation=e=>e.reduce(((e,t)=>{const n=parseAttributes(t);n.schemeIdUri&&(n.schemeIdUri=n.schemeIdUri.toLowerCase());const r=keySystemsMap[n.schemeIdUri];if(r){e[r]={attributes:n};const a=findChildren(t,"cenc:pssh")[0];if(a){const t=getContent(a);e[r].pssh=t&&decodeB64ToUint8Array(t)}}return e}),{}),parseCaptionServiceMetadata=e=>{if("urn:scte:dash:cc:cea-608:2015"===e.schemeIdUri){return("string"!=typeof e.value?[]:e.value.split(";")).map((e=>{let t,n;return n=e,/^CC\d=/.test(e)?[t,n]=e.split("="):/^CC\d$/.test(e)&&(t=e),{channel:t,language:n}}))}if("urn:scte:dash:cc:cea-708:2015"===e.schemeIdUri){return("string"!=typeof e.value?[]:e.value.split(";")).map((e=>{const t={channel:void 0,language:void 0,aspectRatio:1,easyReader:0,"3D":0};if(/=/.test(e)){const[n,r=""]=e.split("=");t.channel=n,t.language=e,r.split(",").forEach((e=>{const[n,r]=e.split(":");"lang"===n?t.language=r:"er"===n?t.easyReader=Number(r):"war"===n?t.aspectRatio=Number(r):"3D"===n&&(t["3D"]=Number(r))}))}else t.language=e;return t.channel&&(t.channel="SERVICE"+t.channel),t}))}},toEventStream=e=>flatten(findChildren(e.node,"EventStream").map((t=>{const n=parseAttributes(t),r=n.schemeIdUri;return findChildren(t,"Event").map((t=>{const a=parseAttributes(t),i=a.presentationTime||0,s=n.timescale||1,o=a.duration||0,l=i/s+e.attributes.start;return{schemeIdUri:r,value:n.value,id:a.id,start:l,end:l+o/s,messageData:getContent(t)||a.messageData,contentEncoding:n.contentEncoding,presentationTimeOffset:n.presentationTimeOffset||0}}))}))),toRepresentations=(e,t,n)=>r=>{const a=parseAttributes(r),i=buildBaseUrls(t,findChildren(r,"BaseURL")),s=findChildren(r,"Role")[0],o={role:parseAttributes(s)};let l=merge$2(e,a,o);const u=findChildren(r,"Accessibility")[0],c=parseCaptionServiceMetadata(parseAttributes(u));c&&(l=merge$2(l,{captionServices:c}));const h=findChildren(r,"Label")[0];if(h&&h.childNodes.length){const e=h.childNodes[0].nodeValue.trim();l=merge$2(l,{label:e})}const d=generateKeySystemInformation(findChildren(r,"ContentProtection"));Object.keys(d).length&&(l=merge$2(l,{contentProtection:d}));const p=getSegmentInformation(r),f=findChildren(r,"Representation"),m=merge$2(n,p);return flatten(f.map(inheritBaseUrls(l,i,m)))},toAdaptationSets=(e,t)=>(n,r)=>{const a=buildBaseUrls(t,findChildren(n.node,"BaseURL")),i=merge$2(e,{periodStart:n.attributes.start});"number"==typeof n.attributes.duration&&(i.periodDuration=n.attributes.duration);const s=findChildren(n.node,"AdaptationSet"),o=getSegmentInformation(n.node);return flatten(s.map(toRepresentations(i,a,o)))},generateContentSteeringInformation=(e,t)=>{if(e.length>1&&t({type:"warn",message:"The MPD manifest should contain no more than one ContentSteering tag"}),!e.length)return null;const n=merge$2({serverURL:getContent(e[0])},parseAttributes(e[0]));return n.queryBeforeStart="true"===n.queryBeforeStart,n},getPeriodStart=({attributes:e,priorPeriodAttributes:t,mpdType:n})=>"number"==typeof e.start?e.start:t&&"number"==typeof t.start&&"number"==typeof t.duration?t.start+t.duration:t||"static"!==n?null:0,inheritAttributes=(e,t={})=>{const{manifestUri:n="",NOW:r=Date.now(),clientOffset:a=0,eventHandler:i=function(){}}=t,s=findChildren(e,"Period");if(!s.length)throw new Error(errors.INVALID_NUMBER_OF_PERIOD);const o=findChildren(e,"Location"),l=parseAttributes(e),u=buildBaseUrls([{baseUrl:n}],findChildren(e,"BaseURL")),c=findChildren(e,"ContentSteering");l.type=l.type||"static",l.sourceDuration=l.mediaPresentationDuration||0,l.NOW=r,l.clientOffset=a,o.length&&(l.locations=o.map(getContent));const h=[];return s.forEach(((e,t)=>{const n=parseAttributes(e),r=h[t-1];n.start=getPeriodStart({attributes:n,priorPeriodAttributes:r?r.attributes:null,mpdType:l.type}),h.push({node:e,attributes:n})})),{locations:l.locations,contentSteeringInfo:generateContentSteeringInformation(c,i),representationInfo:flatten(h.map(toAdaptationSets(l,u))),eventStream:flatten(h.map(toEventStream))}},stringToMpdXml=e=>{if(""===e)throw new Error(errors.DASH_EMPTY_MANIFEST);const t=new DOMParser;let n,r;try{n=t.parseFromString(e,"application/xml"),r=n&&"MPD"===n.documentElement.tagName?n.documentElement:null}catch(e2){}if(!r||r&&r.getElementsByTagName("parsererror").length>0)throw new Error(errors.DASH_INVALID_XML);return r},parseUTCTimingScheme=e=>{const t=findChildren(e,"UTCTiming")[0];if(!t)return null;const n=parseAttributes(t);switch(n.schemeIdUri){case"urn:mpeg:dash:utc:http-head:2014":case"urn:mpeg:dash:utc:http-head:2012":n.method="HEAD";break;case"urn:mpeg:dash:utc:http-xsdate:2014":case"urn:mpeg:dash:utc:http-iso:2014":case"urn:mpeg:dash:utc:http-xsdate:2012":case"urn:mpeg:dash:utc:http-iso:2012":n.method="GET";break;case"urn:mpeg:dash:utc:direct:2014":case"urn:mpeg:dash:utc:direct:2012":n.method="DIRECT",n.value=Date.parse(n.value);break;default:throw new Error(errors.UNSUPPORTED_UTC_TIMING_SCHEME)}return n},parse=(e,t={})=>{const n=inheritAttributes(stringToMpdXml(e),t),r=toPlaylists(n.representationInfo);return toM3u8({dashPlaylists:r,locations:n.locations,contentSteering:n.contentSteeringInfo,sidxMapping:t.sidxMapping,previousManifest:t.previousManifest,eventStream:n.eventStream})},parseUTCTiming=e=>parseUTCTimingScheme(stringToMpdXml(e));var MAX_UINT32=Math.pow(2,32),getUint64$1=function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength);return n.getBigUint64?(t=n.getBigUint64(0))<Number.MAX_SAFE_INTEGER?Number(t):t:n.getUint32(0)*MAX_UINT32+n.getUint32(4)},numbers={getUint64:getUint64$1,MAX_UINT32:MAX_UINT32},getUint64=numbers.getUint64,parseSidx=function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),n={version:e[0],flags:new Uint8Array(e.subarray(1,4)),references:[],referenceId:t.getUint32(4),timescale:t.getUint32(8)},r=12;0===n.version?(n.earliestPresentationTime=t.getUint32(r),n.firstOffset=t.getUint32(r+4),r+=8):(n.earliestPresentationTime=getUint64(e.subarray(r)),n.firstOffset=getUint64(e.subarray(r+8)),r+=16),r+=2;var a=t.getUint16(r);for(r+=2;a>0;r+=12,a--)n.references.push({referenceType:(128&e[r])>>>7,referencedSize:2147483647&t.getUint32(r),subsegmentDuration:t.getUint32(r+4),startsWithSap:!!(128&e[r+8]),sapType:(112&e[r+8])>>>4,sapDeltaTime:268435455&t.getUint32(r+8)});return n},parseSidx_1=parseSidx;const parseSidx$1=getDefaultExportFromCjs(parseSidx_1);var ID3=toUint8([73,68,51]),getId3Size=function(e,t){void 0===t&&(t=0);var n=(e=toUint8(e))[t+5],r=e[t+6]<<21|e[t+7]<<14|e[t+8]<<7|e[t+9];return(16&n)>>4?r+20:r+10},getId3Offset=function e(t,n){return void 0===n&&(n=0),(t=toUint8(t)).length-n<10||!bytesMatch(t,ID3,{offset:n})?n:e(t,n+=getId3Size(t,n))},normalizePath$1=function(e){return"string"==typeof e?stringToBytes(e):e},normalizePaths$1=function(e){return Array.isArray(e)?e.map((function(e){return normalizePath$1(e)})):[normalizePath$1(e)]},findBox=function e(t,n,r){void 0===r&&(r=!1),n=normalizePaths$1(n),t=toUint8(t);var a=[];if(!n.length)return a;for(var i=0;i<t.length;){var s=(t[i]<<24|t[i+1]<<16|t[i+2]<<8|t[i+3])>>>0,o=t.subarray(i+4,i+8);if(0===s)break;var l=i+s;if(l>t.length){if(r)break;l=t.length}var u=t.subarray(i+8,l);bytesMatch(o,n[0])&&(1===n.length?a.push(u):a.push.apply(a,e(u,n.slice(1),r))),i=l}return a},EBML_TAGS={EBML:toUint8([26,69,223,163]),DocType:toUint8([66,130]),Segment:toUint8([24,83,128,103]),SegmentInfo:toUint8([21,73,169,102]),Tracks:toUint8([22,84,174,107]),Track:toUint8([174]),TrackNumber:toUint8([215]),DefaultDuration:toUint8([35,227,131]),TrackEntry:toUint8([174]),TrackType:toUint8([131]),FlagDefault:toUint8([136]),CodecID:toUint8([134]),CodecPrivate:toUint8([99,162]),VideoTrack:toUint8([224]),AudioTrack:toUint8([225]),Cluster:toUint8([31,67,182,117]),Timestamp:toUint8([231]),TimestampScale:toUint8([42,215,177]),BlockGroup:toUint8([160]),BlockDuration:toUint8([155]),Block:toUint8([161]),SimpleBlock:toUint8([163])},LENGTH_TABLE=[128,64,32,16,8,4,2,1],getLength=function(e){for(var t=1,n=0;n<LENGTH_TABLE.length&&!(e&LENGTH_TABLE[n]);n++)t++;return t},getvint=function(e,t,n,r){void 0===n&&(n=!0),void 0===r&&(r=!1);var a=getLength(e[t]),i=e.subarray(t,t+a);return n&&((i=Array.prototype.slice.call(e,t,t+a))[0]^=LENGTH_TABLE[a-1]),{length:a,value:bytesToNumber(i,{signed:r}),bytes:i}},normalizePath=function e(t){return"string"==typeof t?t.match(/.{1,2}/g).map((function(t){return e(t)})):"number"==typeof t?numberToBytes(t):t},normalizePaths=function(e){return Array.isArray(e)?e.map((function(e){return normalizePath(e)})):[normalizePath(e)]},getInfinityDataSize=function e(t,n,r){if(r>=n.length)return n.length;var a=getvint(n,r,!1);if(bytesMatch(t.bytes,a.bytes))return r;var i=getvint(n,r+a.length);return e(t,n,r+i.length+i.value+a.length)},findEbml=function e(t,n){n=normalizePaths(n),t=toUint8(t);var r=[];if(!n.length)return r;for(var a=0;a<t.length;){var i=getvint(t,a,!1),s=getvint(t,a+i.length),o=a+i.length+s.length;127===s.value&&(s.value=getInfinityDataSize(i,t,o),s.value!==t.length&&(s.value-=o));var l=o+s.value>t.length?t.length:o+s.value,u=t.subarray(o,l);bytesMatch(n[0],i.bytes)&&(1===n.length?r.push(u):r=r.concat(e(u,n.slice(1)))),a+=i.length+s.length+u.length}return r},NAL_TYPE_ONE=toUint8([0,0,0,1]),NAL_TYPE_TWO=toUint8([0,0,1]),EMULATION_PREVENTION=toUint8([0,0,3]),discardEmulationPreventionBytes=function(e){for(var t=[],n=1;n<e.length-2;)bytesMatch(e.subarray(n,n+3),EMULATION_PREVENTION)&&(t.push(n+2),n++),n++;if(0===t.length)return e;var r=e.length-t.length,a=new Uint8Array(r),i=0;for(n=0;n<r;i++,n++)i===t[0]&&(i++,t.shift()),a[n]=e[i];return a},findNal=function(e,t,n,r){void 0===r&&(r=1/0),e=toUint8(e),n=[].concat(n);for(var a,i=0,s=0;i<e.length&&(s<r||a);){var o=void 0;if(bytesMatch(e.subarray(i),NAL_TYPE_ONE)?o=4:bytesMatch(e.subarray(i),NAL_TYPE_TWO)&&(o=3),o){if(s++,a)return discardEmulationPreventionBytes(e.subarray(a,i));var l=void 0;"h264"===t?l=31&e[i+o]:"h265"===t&&(l=e[i+o]>>1&63),-1!==n.indexOf(l)&&(a=i+o),i+=o+("h264"===t?1:2)}else i++}return e.subarray(0,0)},findH264Nal=function(e,t,n){return findNal(e,"h264",t,n)},findH265Nal=function(e,t,n){return findNal(e,"h265",t,n)},CONSTANTS={webm:toUint8([119,101,98,109]),matroska:toUint8([109,97,116,114,111,115,107,97]),flac:toUint8([102,76,97,67]),ogg:toUint8([79,103,103,83]),ac3:toUint8([11,119]),riff:toUint8([82,73,70,70]),avi:toUint8([65,86,73]),wav:toUint8([87,65,86,69]),"3gp":toUint8([102,116,121,112,51,103]),mp4:toUint8([102,116,121,112]),fmp4:toUint8([115,116,121,112]),mov:toUint8([102,116,121,112,113,116]),moov:toUint8([109,111,111,118]),moof:toUint8([109,111,111,102])},_isLikely={aac:function(e){var t=getId3Offset(e);return bytesMatch(e,[255,16],{offset:t,mask:[255,22]})},mp3:function(e){var t=getId3Offset(e);return bytesMatch(e,[255,2],{offset:t,mask:[255,6]})},webm:function(e){var t=findEbml(e,[EBML_TAGS.EBML,EBML_TAGS.DocType])[0];return bytesMatch(t,CONSTANTS.webm)},mkv:function(e){var t=findEbml(e,[EBML_TAGS.EBML,EBML_TAGS.DocType])[0];return bytesMatch(t,CONSTANTS.matroska)},mp4:function(e){return!_isLikely["3gp"](e)&&!_isLikely.mov(e)&&(!(!bytesMatch(e,CONSTANTS.mp4,{offset:4})&&!bytesMatch(e,CONSTANTS.fmp4,{offset:4}))||(!(!bytesMatch(e,CONSTANTS.moof,{offset:4})&&!bytesMatch(e,CONSTANTS.moov,{offset:4}))||void 0))},mov:function(e){return bytesMatch(e,CONSTANTS.mov,{offset:4})},"3gp":function(e){return bytesMatch(e,CONSTANTS["3gp"],{offset:4})},ac3:function(e){var t=getId3Offset(e);return bytesMatch(e,CONSTANTS.ac3,{offset:t})},ts:function(e){if(e.length<189&&e.length>=1)return 71===e[0];for(var t=0;t+188<e.length&&t<188;){if(71===e[t]&&71===e[t+188])return!0;t+=1}return!1},flac:function(e){var t=getId3Offset(e);return bytesMatch(e,CONSTANTS.flac,{offset:t})},ogg:function(e){return bytesMatch(e,CONSTANTS.ogg)},avi:function(e){return bytesMatch(e,CONSTANTS.riff)&&bytesMatch(e,CONSTANTS.avi,{offset:8})},wav:function(e){return bytesMatch(e,CONSTANTS.riff)&&bytesMatch(e,CONSTANTS.wav,{offset:8})},h264:function(e){return findH264Nal(e,7,3).length},h265:function(e){return findH265Nal(e,[32,33],3).length}},isLikelyTypes=Object.keys(_isLikely).filter((function(e){return"ts"!==e&&"h264"!==e&&"h265"!==e})).concat(["ts","h264","h265"]);isLikelyTypes.forEach((function(e){var t=_isLikely[e];_isLikely[e]=function(e){return t(toUint8(e))}}));var isLikely=_isLikely,detectContainerForBytes=function(e){e=toUint8(e);for(var t=0;t<isLikelyTypes.length;t++){var n=isLikelyTypes[t];if(isLikely[n](e))return n}return""},isLikelyFmp4MediaSegment=function(e){return findBox(e,["moof"]).length>0},ONE_SECOND_IN_TS=9e4,secondsToVideoTs,secondsToAudioTs,videoTsToSeconds,audioTsToSeconds,audioTsToVideoTs,videoTsToAudioTs,metadataTsToSeconds;secondsToVideoTs=function(e){return e*ONE_SECOND_IN_TS},secondsToAudioTs=function(e,t){return e*t},videoTsToSeconds=function(e){return e/ONE_SECOND_IN_TS},audioTsToSeconds=function(e,t){return e/t},audioTsToVideoTs=function(e,t){return secondsToVideoTs(audioTsToSeconds(e,t))},videoTsToAudioTs=function(e,t){return secondsToAudioTs(videoTsToSeconds(e),t)},metadataTsToSeconds=function(e,t,n){return videoTsToSeconds(n?e:e-t)};var clock={ONE_SECOND_IN_TS:ONE_SECOND_IN_TS,secondsToVideoTs:secondsToVideoTs,secondsToAudioTs:secondsToAudioTs,videoTsToSeconds:videoTsToSeconds,audioTsToSeconds:audioTsToSeconds,audioTsToVideoTs:audioTsToVideoTs,videoTsToAudioTs:videoTsToAudioTs,metadataTsToSeconds:metadataTsToSeconds},version$6="8.10.0";
/**
     * @license
     * Video.js 8.10.0 <http://videojs.com/>
     * Copyright Brightcove, Inc. <https://www.brightcove.com/>
     * Available under Apache License Version 2.0
     * <https://github.com/videojs/video.js/blob/main/LICENSE>
     *
     * Includes vtt.js <https://github.com/mozilla/vtt.js>
     * Available under Apache License Version 2.0
     * <https://github.com/mozilla/vtt.js/blob/main/LICENSE>
     */const hooks_={},hooks=function(e,t){return hooks_[e]=hooks_[e]||[],t&&(hooks_[e]=hooks_[e].concat(t)),hooks_[e]},hook=function(e,t){hooks(e,t)},removeHook=function(e,t){const n=hooks(e).indexOf(t);return!(n<=-1)&&(hooks_[e]=hooks_[e].slice(),hooks_[e].splice(n,1),!0)},hookOnce=function(e,t){hooks(e,[].concat(t).map((t=>{const n=(...r)=>(removeHook(e,n),t(...r));return n})))},FullscreenApi={prefixed:!0},apiMap=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror","fullscreen"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror","-webkit-full-screen"]],specApi=apiMap[0];let browserApi;for(let m=0;m<apiMap.length;m++)if(apiMap[m][1]in document$2){browserApi=apiMap[m];break}if(browserApi){for(let e=0;e<browserApi.length;e++)FullscreenApi[specApi[e]]=browserApi[e];FullscreenApi.prefixed=browserApi[0]!==specApi[0]}let history=[];const LogByTypeFactory=(e,t,n)=>(r,a,i)=>{const s=t.levels[a],o=new RegExp(`^(${s})$`);let l=e;if("log"!==r&&i.unshift(r.toUpperCase()+":"),n&&(l=`%c${e}`,i.unshift(n)),i.unshift(l+":"),history){history.push([].concat(i));const e=history.length-1e3;history.splice(0,e>0?e:0)}if(!window$1$1.console)return;let u=window$1$1.console[r];u||"debug"!==r||(u=window$1$1.console.info||window$1$1.console.log),u&&s&&o.test(r)&&u[Array.isArray(i)?"apply":"call"](window$1$1.console,i)};function createLogger$1(e,t=":",n=""){let r,a="info";const i=function(...e){r("log",a,e)};return r=LogByTypeFactory(e,i,n),i.createLogger=(r,a,i)=>{const s=void 0!==a?a:t;return createLogger$1(`${e} ${s} ${r}`,s,void 0!==i?i:n)},i.createNewLogger=(e,t,n)=>createLogger$1(e,t,n),i.levels={all:"debug|log|warn|error",off:"",debug:"debug|log|warn|error",info:"log|warn|error",warn:"warn|error",error:"error",DEFAULT:a},i.level=e=>{if("string"==typeof e){if(!i.levels.hasOwnProperty(e))throw new Error(`"${e}" in not a valid log level`);a=e}return a},(i.history=()=>history?[].concat(history):[]).filter=e=>(history||[]).filter((t=>new RegExp(`.*${e}.*`).test(t[0]))),i.history.clear=()=>{history&&(history.length=0)},i.history.disable=()=>{null!==history&&(history.length=0,history=null)},i.history.enable=()=>{null===history&&(history=[])},i.error=(...e)=>r("error",a,e),i.warn=(...e)=>r("warn",a,e),i.debug=(...e)=>r("debug",a,e),i}const log$1=createLogger$1("VIDEOJS"),createLogger=log$1.createLogger,toString=Object.prototype.toString,keys=function(e){return isObject(e)?Object.keys(e):[]};function each(e,t){keys(e).forEach((n=>t(e[n],n)))}function reduce(e,t,n=0){return keys(e).reduce(((n,r)=>t(n,e[r],r)),n)}function isObject(e){return!!e&&"object"==typeof e}function isPlain(e){return isObject(e)&&"[object Object]"===toString.call(e)&&e.constructor===Object}function merge$1(...e){const t={};return e.forEach((e=>{e&&each(e,((e,n)=>{isPlain(e)?(isPlain(t[n])||(t[n]={}),t[n]=merge$1(t[n],e)):t[n]=e}))})),t}function values(e={}){const t=[];for(const n in e)if(e.hasOwnProperty(n)){const r=e[n];t.push(r)}return t}function defineLazyProperty(e,t,n,r=!0){const a=n=>Object.defineProperty(e,t,{value:n,enumerable:!0,writable:!0}),i={configurable:!0,enumerable:!0,get(){const e=n();return a(e),e}};return r&&(i.set=a),Object.defineProperty(e,t,i)}var Obj=Object.freeze({__proto__:null,each:each,reduce:reduce,isObject:isObject,isPlain:isPlain,merge:merge$1,values:values,defineLazyProperty:defineLazyProperty});let IS_IPOD=!1,IOS_VERSION=null,IS_ANDROID=!1,ANDROID_VERSION,IS_FIREFOX=!1,IS_EDGE=!1,IS_CHROMIUM=!1,IS_CHROME=!1,CHROMIUM_VERSION=null,CHROME_VERSION=null,IE_VERSION=null,IS_SAFARI=!1,IS_WINDOWS=!1,IS_IPAD=!1,IS_IPHONE=!1;const TOUCH_ENABLED=Boolean(isReal()&&("ontouchstart"in window$1$1||window$1$1.navigator.maxTouchPoints||window$1$1.DocumentTouch&&window$1$1.document instanceof window$1$1.DocumentTouch)),UAD=window$1$1.navigator&&window$1$1.navigator.userAgentData;if(UAD&&UAD.platform&&UAD.brands&&(IS_ANDROID="Android"===UAD.platform,IS_EDGE=Boolean(UAD.brands.find((e=>"Microsoft Edge"===e.brand))),IS_CHROMIUM=Boolean(UAD.brands.find((e=>"Chromium"===e.brand))),IS_CHROME=!IS_EDGE&&IS_CHROMIUM,CHROMIUM_VERSION=CHROME_VERSION=(UAD.brands.find((e=>"Chromium"===e.brand))||{}).version||null,IS_WINDOWS="Windows"===UAD.platform),!IS_CHROMIUM){const e=window$1$1.navigator&&window$1$1.navigator.userAgent||"";IS_IPOD=/iPod/i.test(e),IOS_VERSION=function(){const t=e.match(/OS (\d+)_/i);return t&&t[1]?t[1]:null}(),IS_ANDROID=/Android/i.test(e),ANDROID_VERSION=function(){const t=e.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!t)return null;const n=t[1]&&parseFloat(t[1]),r=t[2]&&parseFloat(t[2]);return n&&r?parseFloat(t[1]+"."+t[2]):n||null}(),IS_FIREFOX=/Firefox/i.test(e),IS_EDGE=/Edg/i.test(e),IS_CHROMIUM=/Chrome/i.test(e)||/CriOS/i.test(e),IS_CHROME=!IS_EDGE&&IS_CHROMIUM,CHROMIUM_VERSION=CHROME_VERSION=function(){const t=e.match(/(Chrome|CriOS)\/(\d+)/);return t&&t[2]?parseFloat(t[2]):null}(),IE_VERSION=function(){const t=/MSIE\s(\d+)\.\d/.exec(e);let n=t&&parseFloat(t[1]);return!n&&/Trident\/7.0/i.test(e)&&/rv:11.0/.test(e)&&(n=11),n}(),IS_SAFARI=/Safari/i.test(e)&&!IS_CHROME&&!IS_ANDROID&&!IS_EDGE,IS_WINDOWS=/Windows/i.test(e),IS_IPAD=/iPad/i.test(e)||IS_SAFARI&&TOUCH_ENABLED&&!/iPhone/i.test(e),IS_IPHONE=/iPhone/i.test(e)&&!IS_IPAD}const IS_IOS=IS_IPHONE||IS_IPAD||IS_IPOD,IS_ANY_SAFARI=(IS_SAFARI||IS_IOS)&&!IS_CHROME;var browser=Object.freeze({__proto__:null,get IS_IPOD(){return IS_IPOD},get IOS_VERSION(){return IOS_VERSION},get IS_ANDROID(){return IS_ANDROID},get ANDROID_VERSION(){return ANDROID_VERSION},get IS_FIREFOX(){return IS_FIREFOX},get IS_EDGE(){return IS_EDGE},get IS_CHROMIUM(){return IS_CHROMIUM},get IS_CHROME(){return IS_CHROME},get CHROMIUM_VERSION(){return CHROMIUM_VERSION},get CHROME_VERSION(){return CHROME_VERSION},get IE_VERSION(){return IE_VERSION},get IS_SAFARI(){return IS_SAFARI},get IS_WINDOWS(){return IS_WINDOWS},get IS_IPAD(){return IS_IPAD},get IS_IPHONE(){return IS_IPHONE},TOUCH_ENABLED:TOUCH_ENABLED,IS_IOS:IS_IOS,IS_ANY_SAFARI:IS_ANY_SAFARI});function isNonBlankString(e){return"string"==typeof e&&Boolean(e.trim())}function throwIfWhitespace(e){if(e.indexOf(" ")>=0)throw new Error("class has illegal whitespace characters")}function isReal(){return document$2===window$1$1.document}function isEl(e){return isObject(e)&&1===e.nodeType}function isInFrame(){try{return window$1$1.parent!==window$1$1.self}catch(e){return!0}}function createQuerier(e){return function(t,n){if(!isNonBlankString(t))return document$2[e](null);isNonBlankString(n)&&(n=document$2.querySelector(n));const r=isEl(n)?n:document$2;return r[e]&&r[e](t)}}function createEl(e="div",t={},n={},r){const a=document$2.createElement(e);return Object.getOwnPropertyNames(t).forEach((function(e){const n=t[e];"textContent"===e?textContent(a,n):a[e]===n&&"tabIndex"!==e||(a[e]=n)})),Object.getOwnPropertyNames(n).forEach((function(e){a.setAttribute(e,n[e])})),r&&appendContent(a,r),a}function textContent(e,t){return void 0===e.textContent?e.innerText=t:e.textContent=t,e}function prependTo(e,t){t.firstChild?t.insertBefore(e,t.firstChild):t.appendChild(e)}function hasClass(e,t){return throwIfWhitespace(t),e.classList.contains(t)}function addClass(e,...t){return e.classList.add(...t.reduce(((e,t)=>e.concat(t.split(/\s+/))),[])),e}function removeClass(e,...t){return e?(e.classList.remove(...t.reduce(((e,t)=>e.concat(t.split(/\s+/))),[])),e):(log$1.warn("removeClass was called with an element that doesn't exist"),null)}function toggleClass(e,t,n){return"function"==typeof n&&(n=n(e,t)),"boolean"!=typeof n&&(n=void 0),t.split(/\s+/).forEach((t=>e.classList.toggle(t,n))),e}function setAttributes(e,t){Object.getOwnPropertyNames(t).forEach((function(n){const r=t[n];null==r||!1===r?e.removeAttribute(n):e.setAttribute(n,!0===r?"":r)}))}function getAttributes(e){const t={},n=["autoplay","controls","playsinline","loop","muted","default","defaultMuted"];if(e&&e.attributes&&e.attributes.length>0){const r=e.attributes;for(let e=r.length-1;e>=0;e--){const a=r[e].name;let i=r[e].value;n.includes(a)&&(i=null!==i),t[a]=i}}return t}function getAttribute(e,t){return e.getAttribute(t)}function setAttribute(e,t,n){e.setAttribute(t,n)}function removeAttribute(e,t){e.removeAttribute(t)}function blockTextSelection(){document$2.body.focus(),document$2.onselectstart=function(){return!1}}function unblockTextSelection(){document$2.onselectstart=function(){return!0}}function getBoundingClientRect(e){if(e&&e.getBoundingClientRect&&e.parentNode){const t=e.getBoundingClientRect(),n={};return["bottom","height","left","right","top","width"].forEach((e=>{void 0!==t[e]&&(n[e]=t[e])})),n.height||(n.height=parseFloat(computedStyle(e,"height"))),n.width||(n.width=parseFloat(computedStyle(e,"width"))),n}}function findPosition(e){if(!e||e&&!e.offsetParent)return{left:0,top:0,width:0,height:0};const t=e.offsetWidth,n=e.offsetHeight;let r=0,a=0;for(;e.offsetParent&&e!==document$2[FullscreenApi.fullscreenElement];)r+=e.offsetLeft,a+=e.offsetTop,e=e.offsetParent;return{left:r,top:a,width:t,height:n}}function getPointerPosition(e,t){const n={x:0,y:0};if(IS_IOS){let t=e;for(;t&&"html"!==t.nodeName.toLowerCase();){const e=computedStyle(t,"transform");if(/^matrix/.test(e)){const t=e.slice(7,-1).split(/,\s/).map(Number);n.x+=t[4],n.y+=t[5]}else if(/^matrix3d/.test(e)){const t=e.slice(9,-1).split(/,\s/).map(Number);n.x+=t[12],n.y+=t[13]}t=t.parentNode}}const r={},a=findPosition(t.target),i=findPosition(e),s=i.width,o=i.height;let l=t.offsetY-(i.top-a.top),u=t.offsetX-(i.left-a.left);return t.changedTouches&&(u=t.changedTouches[0].pageX-i.left,l=t.changedTouches[0].pageY+i.top,IS_IOS&&(u-=n.x,l-=n.y)),r.y=1-Math.max(0,Math.min(1,l/o)),r.x=Math.max(0,Math.min(1,u/s)),r}function isTextNode(e){return isObject(e)&&3===e.nodeType}function emptyEl(e){for(;e.firstChild;)e.removeChild(e.firstChild);return e}function normalizeContent(e){return"function"==typeof e&&(e=e()),(Array.isArray(e)?e:[e]).map((e=>("function"==typeof e&&(e=e()),isEl(e)||isTextNode(e)?e:"string"==typeof e&&/\S/.test(e)?document$2.createTextNode(e):void 0))).filter((e=>e))}function appendContent(e,t){return normalizeContent(t).forEach((t=>e.appendChild(t))),e}function insertContent(e,t){return appendContent(emptyEl(e),t)}function isSingleLeftClick(e){return void 0===e.button&&void 0===e.buttons||(0===e.button&&void 0===e.buttons||("mouseup"===e.type&&0===e.button&&0===e.buttons||0===e.button&&1===e.buttons))}const $=createQuerier("querySelector"),$$=createQuerier("querySelectorAll");function computedStyle(e,t){if(!e||!t)return"";if("function"==typeof window$1$1.getComputedStyle){let n;try{n=window$1$1.getComputedStyle(e)}catch(e2){return""}return n?n.getPropertyValue(t)||n[t]:""}return""}function copyStyleSheetsToWindow(e){[...document$2.styleSheets].forEach((t=>{try{const n=[...t.cssRules].map((e=>e.cssText)).join(""),r=document$2.createElement("style");r.textContent=n,e.document.head.appendChild(r)}catch(e2){const r=document$2.createElement("link");r.rel="stylesheet",r.type=t.type,r.media=t.media.mediaText,r.href=t.href,e.document.head.appendChild(r)}}))}var Dom=Object.freeze({__proto__:null,isReal:isReal,isEl:isEl,isInFrame:isInFrame,createEl:createEl,textContent:textContent,prependTo:prependTo,hasClass:hasClass,addClass:addClass,removeClass:removeClass,toggleClass:toggleClass,setAttributes:setAttributes,getAttributes:getAttributes,getAttribute:getAttribute,setAttribute:setAttribute,removeAttribute:removeAttribute,blockTextSelection:blockTextSelection,unblockTextSelection:unblockTextSelection,getBoundingClientRect:getBoundingClientRect,findPosition:findPosition,getPointerPosition:getPointerPosition,isTextNode:isTextNode,emptyEl:emptyEl,normalizeContent:normalizeContent,appendContent:appendContent,insertContent:insertContent,isSingleLeftClick:isSingleLeftClick,$:$,$$:$$,computedStyle:computedStyle,copyStyleSheetsToWindow:copyStyleSheetsToWindow});let _windowLoaded=!1,videojs$1;const autoSetup=function(){if(!1===videojs$1.options.autoSetup)return;const e=Array.prototype.slice.call(document$2.getElementsByTagName("video")),t=Array.prototype.slice.call(document$2.getElementsByTagName("audio")),n=Array.prototype.slice.call(document$2.getElementsByTagName("video-js")),r=e.concat(t,n);if(r&&r.length>0)for(let a=0,i=r.length;a<i;a++){const e=r[a];if(!e||!e.getAttribute){autoSetupTimeout(1);break}if(void 0===e.player){null!==e.getAttribute("data-setup")&&videojs$1(e)}}else _windowLoaded||autoSetupTimeout(1)};function autoSetupTimeout(e,t){isReal()&&(t&&(videojs$1=t),window$1$1.setTimeout(autoSetup,e))}function setWindowLoaded(){_windowLoaded=!0,window$1$1.removeEventListener("load",setWindowLoaded)}isReal()&&("complete"===document$2.readyState?setWindowLoaded():window$1$1.addEventListener("load",setWindowLoaded));const createStyleElement=function(e){const t=document$2.createElement("style");return t.className=e,t},setTextContent=function(e,t){e.styleSheet?e.styleSheet.cssText=t:e.textContent=t};var DomData=new WeakMap;const _initialGuid=3;let _guid=_initialGuid,_supportsPassive;function newGUID(){return _guid++}function _cleanUpEvents(e,t){if(!DomData.has(e))return;const n=DomData.get(e);0===n.handlers[t].length&&(delete n.handlers[t],e.removeEventListener?e.removeEventListener(t,n.dispatcher,!1):e.detachEvent&&e.detachEvent("on"+t,n.dispatcher)),Object.getOwnPropertyNames(n.handlers).length<=0&&(delete n.handlers,delete n.dispatcher,delete n.disabled),0===Object.getOwnPropertyNames(n).length&&DomData.delete(e)}function _handleMultipleEvents(e,t,n,r){n.forEach((function(n){e(t,n,r)}))}function fixEvent(e){if(e.fixed_)return e;function t(){return!0}function n(){return!1}if(!e||!e.isPropagationStopped||!e.isImmediatePropagationStopped){const r=e||window$1$1.event;e={};for(const t in r)"layerX"!==t&&"layerY"!==t&&"keyLocation"!==t&&"webkitMovementX"!==t&&"webkitMovementY"!==t&&"path"!==t&&("returnValue"===t&&r.preventDefault||(e[t]=r[t]));if(e.target||(e.target=e.srcElement||document$2),e.relatedTarget||(e.relatedTarget=e.fromElement===e.target?e.toElement:e.fromElement),e.preventDefault=function(){r.preventDefault&&r.preventDefault(),e.returnValue=!1,r.returnValue=!1,e.defaultPrevented=!0},e.defaultPrevented=!1,e.stopPropagation=function(){r.stopPropagation&&r.stopPropagation(),e.cancelBubble=!0,r.cancelBubble=!0,e.isPropagationStopped=t},e.isPropagationStopped=n,e.stopImmediatePropagation=function(){r.stopImmediatePropagation&&r.stopImmediatePropagation(),e.isImmediatePropagationStopped=t,e.stopPropagation()},e.isImmediatePropagationStopped=n,null!==e.clientX&&void 0!==e.clientX){const t=document$2.documentElement,n=document$2.body;e.pageX=e.clientX+(t&&t.scrollLeft||n&&n.scrollLeft||0)-(t&&t.clientLeft||n&&n.clientLeft||0),e.pageY=e.clientY+(t&&t.scrollTop||n&&n.scrollTop||0)-(t&&t.clientTop||n&&n.clientTop||0)}e.which=e.charCode||e.keyCode,null!==e.button&&void 0!==e.button&&(e.button=1&e.button?0:4&e.button?1:2&e.button?2:0)}return e.fixed_=!0,e}const supportsPassive=function(){if("boolean"!=typeof _supportsPassive){_supportsPassive=!1;try{const e=Object.defineProperty({},"passive",{get(){_supportsPassive=!0}});window$1$1.addEventListener("test",null,e),window$1$1.removeEventListener("test",null,e)}catch(e2){}}return _supportsPassive},passiveEvents=["touchstart","touchmove"];function on(e,t,n){if(Array.isArray(t))return _handleMultipleEvents(on,e,t,n);DomData.has(e)||DomData.set(e,{});const r=DomData.get(e);if(r.handlers||(r.handlers={}),r.handlers[t]||(r.handlers[t]=[]),n.guid||(n.guid=newGUID()),r.handlers[t].push(n),r.dispatcher||(r.disabled=!1,r.dispatcher=function(t,n){if(r.disabled)return;t=fixEvent(t);const a=r.handlers[t.type];if(a){const r=a.slice(0);for(let a=0,i=r.length;a<i&&!t.isImmediatePropagationStopped();a++)try{r[a].call(e,t,n)}catch(e2){log$1.error(e2)}}}),1===r.handlers[t].length)if(e.addEventListener){let n=!1;supportsPassive()&&passiveEvents.indexOf(t)>-1&&(n={passive:!0}),e.addEventListener(t,r.dispatcher,n)}else e.attachEvent&&e.attachEvent("on"+t,r.dispatcher)}function off(e,t,n){if(!DomData.has(e))return;const r=DomData.get(e);if(!r.handlers)return;if(Array.isArray(t))return _handleMultipleEvents(off,e,t,n);const a=function(e,t){r.handlers[t]=[],_cleanUpEvents(e,t)};if(void 0===t){for(const t in r.handlers)Object.prototype.hasOwnProperty.call(r.handlers||{},t)&&a(e,t);return}const i=r.handlers[t];if(i)if(n){if(n.guid)for(let e=0;e<i.length;e++)i[e].guid===n.guid&&i.splice(e--,1);_cleanUpEvents(e,t)}else a(e,t)}function trigger(e,t,n){const r=DomData.has(e)?DomData.get(e):{},a=e.parentNode||e.ownerDocument;if("string"==typeof t?t={type:t,target:e}:t.target||(t.target=e),t=fixEvent(t),r.dispatcher&&r.dispatcher.call(e,t,n),a&&!t.isPropagationStopped()&&!0===t.bubbles)trigger.call(null,a,t,n);else if(!a&&!t.defaultPrevented&&t.target&&t.target[t.type]){DomData.has(t.target)||DomData.set(t.target,{});const e=DomData.get(t.target);t.target[t.type]&&(e.disabled=!0,"function"==typeof t.target[t.type]&&t.target[t.type](),e.disabled=!1)}return!t.defaultPrevented}function one(e,t,n){if(Array.isArray(t))return _handleMultipleEvents(one,e,t,n);const r=function(){off(e,t,r),n.apply(this,arguments)};r.guid=n.guid=n.guid||newGUID(),on(e,t,r)}function any(e,t,n){const r=function(){off(e,t,r),n.apply(this,arguments)};r.guid=n.guid=n.guid||newGUID(),on(e,t,r)}var Events=Object.freeze({__proto__:null,fixEvent:fixEvent,on:on,off:off,trigger:trigger,one:one,any:any});const UPDATE_REFRESH_INTERVAL=30,bind_=function(e,t,n){t.guid||(t.guid=newGUID());const r=t.bind(e);return r.guid=n?n+"_"+t.guid:t.guid,r},throttle=function(e,t){let n=window$1$1.performance.now();return function(...r){const a=window$1$1.performance.now();a-n>=t&&(e(...r),n=a)}},debounce=function(e,t,n,r=window$1$1){let a;const i=function(){const i=this,s=arguments;let o=function(){a=null,o=null,n||e.apply(i,s)};!a&&n&&e.apply(i,s),r.clearTimeout(a),a=r.setTimeout(o,t)};return i.cancel=()=>{r.clearTimeout(a),a=null},i};var Fn=Object.freeze({__proto__:null,UPDATE_REFRESH_INTERVAL:UPDATE_REFRESH_INTERVAL,bind_:bind_,throttle:throttle,debounce:debounce});let EVENT_MAP;class EventTarget$2{on(e,t){const n=this.addEventListener;this.addEventListener=()=>{},on(this,e,t),this.addEventListener=n}off(e,t){off(this,e,t)}one(e,t){const n=this.addEventListener;this.addEventListener=()=>{},one(this,e,t),this.addEventListener=n}any(e,t){const n=this.addEventListener;this.addEventListener=()=>{},any(this,e,t),this.addEventListener=n}trigger(e){const t=e.type||e;"string"==typeof e&&(e={type:t}),e=fixEvent(e),this.allowedEvents_[t]&&this["on"+t]&&this["on"+t](e),trigger(this,e)}queueTrigger(e){EVENT_MAP||(EVENT_MAP=new Map);const t=e.type||e;let n=EVENT_MAP.get(this);n||(n=new Map,EVENT_MAP.set(this,n));const r=n.get(t);n.delete(t),window$1$1.clearTimeout(r);const a=window$1$1.setTimeout((()=>{n.delete(t),0===n.size&&(n=null,EVENT_MAP.delete(this)),this.trigger(e)}),0);n.set(t,a)}}EventTarget$2.prototype.allowedEvents_={},EventTarget$2.prototype.addEventListener=EventTarget$2.prototype.on,EventTarget$2.prototype.removeEventListener=EventTarget$2.prototype.off,EventTarget$2.prototype.dispatchEvent=EventTarget$2.prototype.trigger;const objName=e=>"function"==typeof e.name?e.name():"string"==typeof e.name?e.name:e.name_?e.name_:e.constructor&&e.constructor.name?e.constructor.name:typeof e,isEvented=e=>e instanceof EventTarget$2||!!e.eventBusEl_&&["on","one","off","trigger"].every((t=>"function"==typeof e[t])),addEventedCallback=(e,t)=>{isEvented(e)?t():(e.eventedCallbacks||(e.eventedCallbacks=[]),e.eventedCallbacks.push(t))},isValidEventType=e=>"string"==typeof e&&/\S/.test(e)||Array.isArray(e)&&!!e.length,validateTarget=(e,t,n)=>{if(!e||!e.nodeName&&!isEvented(e))throw new Error(`Invalid target for ${objName(t)}#${n}; must be a DOM node or evented object.`)},validateEventType=(e,t,n)=>{if(!isValidEventType(e))throw new Error(`Invalid event type for ${objName(t)}#${n}; must be a non-empty string or array.`)},validateListener=(e,t,n)=>{if("function"!=typeof e)throw new Error(`Invalid listener for ${objName(t)}#${n}; must be a function.`)},normalizeListenArgs=(e,t,n)=>{const r=t.length<3||t[0]===e||t[0]===e.eventBusEl_;let a,i,s;return r?(a=e.eventBusEl_,t.length>=3&&t.shift(),[i,s]=t):[a,i,s]=t,validateTarget(a,e,n),validateEventType(i,e,n),validateListener(s,e,n),s=bind_(e,s),{isTargetingSelf:r,target:a,type:i,listener:s}},listen=(e,t,n,r)=>{validateTarget(e,e,t),e.nodeName?Events[t](e,n,r):e[t](n,r)},EventedMixin={on(...e){const{isTargetingSelf:t,target:n,type:r,listener:a}=normalizeListenArgs(this,e,"on");if(listen(n,"on",r,a),!t){const e=()=>this.off(n,r,a);e.guid=a.guid;const t=()=>this.off("dispose",e);t.guid=a.guid,listen(this,"on","dispose",e),listen(n,"on","dispose",t)}},one(...e){const{isTargetingSelf:t,target:n,type:r,listener:a}=normalizeListenArgs(this,e,"one");if(t)listen(n,"one",r,a);else{const e=(...t)=>{this.off(n,r,e),a.apply(null,t)};e.guid=a.guid,listen(n,"one",r,e)}},any(...e){const{isTargetingSelf:t,target:n,type:r,listener:a}=normalizeListenArgs(this,e,"any");if(t)listen(n,"any",r,a);else{const e=(...t)=>{this.off(n,r,e),a.apply(null,t)};e.guid=a.guid,listen(n,"any",r,e)}},off(e,t,n){if(!e||isValidEventType(e))off(this.eventBusEl_,e,t);else{const r=e,a=t;validateTarget(r,this,"off"),validateEventType(a,this,"off"),validateListener(n,this,"off"),n=bind_(this,n),this.off("dispose",n),r.nodeName?(off(r,a,n),off(r,"dispose",n)):isEvented(r)&&(r.off(a,n),r.off("dispose",n))}},trigger(e,t){validateTarget(this.eventBusEl_,this,"trigger");const n=e&&"string"!=typeof e?e.type:e;if(!isValidEventType(n))throw new Error(`Invalid event type for ${objName(this)}#trigger; must be a non-empty string or object with a type key that has a non-empty value.`);return trigger(this.eventBusEl_,e,t)}};function evented(e,t={}){const{eventBusKey:n}=t;if(n){if(!e[n].nodeName)throw new Error(`The eventBusKey "${n}" does not refer to an element.`);e.eventBusEl_=e[n]}else e.eventBusEl_=createEl("span",{className:"vjs-event-bus"});return Object.assign(e,EventedMixin),e.eventedCallbacks&&e.eventedCallbacks.forEach((e=>{e()})),e.on("dispose",(()=>{e.off(),[e,e.el_,e.eventBusEl_].forEach((function(e){e&&DomData.has(e)&&DomData.delete(e)})),window$1$1.setTimeout((()=>{e.eventBusEl_=null}),0)})),e}const StatefulMixin={state:{},setState(e){let t;return"function"==typeof e&&(e=e()),each(e,((e,n)=>{this.state[n]!==e&&(t=t||{},t[n]={from:this.state[n],to:e}),this.state[n]=e})),t&&isEvented(this)&&this.trigger({changes:t,type:"statechanged"}),t}};function stateful(e,t){return Object.assign(e,StatefulMixin),e.state=Object.assign({},e.state,t),"function"==typeof e.handleStateChanged&&isEvented(e)&&e.on("statechanged",e.handleStateChanged),e}const toLowerCase=function(e){return"string"!=typeof e?e:e.replace(/./,(e=>e.toLowerCase()))},toTitleCase$1=function(e){return"string"!=typeof e?e:e.replace(/./,(e=>e.toUpperCase()))},titleCaseEquals=function(e,t){return toTitleCase$1(e)===toTitleCase$1(t)};var Str=Object.freeze({__proto__:null,toLowerCase:toLowerCase,toTitleCase:toTitleCase$1,titleCaseEquals:titleCaseEquals});class Component$1{constructor(e,t,n){if(!e&&this.play?this.player_=e=this:this.player_=e,this.isDisposed_=!1,this.parentComponent_=null,this.options_=merge$1({},this.options_),t=this.options_=merge$1(this.options_,t),this.id_=t.id||t.el&&t.el.id,!this.id_){const t=e&&e.id&&e.id()||"no_player";this.id_=`${t}_component_${newGUID()}`}this.name_=t.name||null,t.el?this.el_=t.el:!1!==t.createEl&&(this.el_=this.createEl()),t.className&&this.el_&&t.className.split(" ").forEach((e=>this.addClass(e))),["on","off","one","any","trigger"].forEach((e=>{this[e]=void 0})),!1!==t.evented&&(evented(this,{eventBusKey:this.el_?"el_":null}),this.handleLanguagechange=this.handleLanguagechange.bind(this),this.on(this.player_,"languagechange",this.handleLanguagechange)),stateful(this,this.constructor.defaultState),this.children_=[],this.childIndex_={},this.childNameIndex_={},this.setTimeoutIds_=new Set,this.setIntervalIds_=new Set,this.rafIds_=new Set,this.namedRafs_=new Map,this.clearingTimersOnDispose_=!1,!1!==t.initChildren&&this.initChildren(),this.ready(n),!1!==t.reportTouchActivity&&this.enableTouchActivity()}on(e,t){}off(e,t){}one(e,t){}any(e,t){}trigger(e,t){}dispose(e={}){if(!this.isDisposed_){if(this.readyQueue_&&(this.readyQueue_.length=0),this.trigger({type:"dispose",bubbles:!1}),this.isDisposed_=!0,this.children_)for(let e=this.children_.length-1;e>=0;e--)this.children_[e].dispose&&this.children_[e].dispose();this.children_=null,this.childIndex_=null,this.childNameIndex_=null,this.parentComponent_=null,this.el_&&(this.el_.parentNode&&(e.restoreEl?this.el_.parentNode.replaceChild(e.restoreEl,this.el_):this.el_.parentNode.removeChild(this.el_)),this.el_=null),this.player_=null}}isDisposed(){return Boolean(this.isDisposed_)}player(){return this.player_}options(e){return e?(this.options_=merge$1(this.options_,e),this.options_):this.options_}el(){return this.el_}createEl(e,t,n){return createEl(e,t,n)}localize(e,t,n=e){const r=this.player_.language&&this.player_.language(),a=this.player_.languages&&this.player_.languages(),i=a&&a[r],s=r&&r.split("-")[0],o=a&&a[s];let l=n;return i&&i[e]?l=i[e]:o&&o[e]&&(l=o[e]),t&&(l=l.replace(/\{(\d+)\}/g,(function(e,n){const r=t[n-1];let a=r;return void 0===r&&(a=e),a}))),l}handleLanguagechange(){}contentEl(){return this.contentEl_||this.el_}id(){return this.id_}name(){return this.name_}children(){return this.children_}getChildById(e){return this.childIndex_[e]}getChild(e){if(e)return this.childNameIndex_[e]}getDescendant(...e){e=e.reduce(((e,t)=>e.concat(t)),[]);let t=this;for(let n=0;n<e.length;n++)if(t=t.getChild(e[n]),!t||!t.getChild)return;return t}setIcon(e,t=this.el()){if(!this.player_.options_.experimentalSvgIcons)return;const n="http://www.w3.org/2000/svg",r=createEl("span",{className:"vjs-icon-placeholder vjs-svg-icon"},{"aria-hidden":"true"}),a=document$2.createElementNS(n,"svg");a.setAttributeNS(null,"viewBox","0 0 512 512");const i=document$2.createElementNS(n,"use");return a.appendChild(i),i.setAttributeNS(null,"href",`#vjs-icon-${e}`),r.appendChild(a),this.iconIsSet_?t.replaceChild(r,t.querySelector(".vjs-icon-placeholder")):t.appendChild(r),this.iconIsSet_=!0,r}addChild(e,t={},n=this.children_.length){let r,a;if("string"==typeof e){a=toTitleCase$1(e);const n=t.componentClass||a;t.name=a;const i=Component$1.getComponent(n);if(!i)throw new Error(`Component ${n} does not exist`);if("function"!=typeof i)return null;r=new i(this.player_||this,t)}else r=e;if(r.parentComponent_&&r.parentComponent_.removeChild(r),this.children_.splice(n,0,r),r.parentComponent_=this,"function"==typeof r.id&&(this.childIndex_[r.id()]=r),a=a||r.name&&toTitleCase$1(r.name()),a&&(this.childNameIndex_[a]=r,this.childNameIndex_[toLowerCase(a)]=r),"function"==typeof r.el&&r.el()){let e=null;this.children_[n+1]&&(this.children_[n+1].el_?e=this.children_[n+1].el_:isEl(this.children_[n+1])&&(e=this.children_[n+1])),this.contentEl().insertBefore(r.el(),e)}return r}removeChild(e){if("string"==typeof e&&(e=this.getChild(e)),!e||!this.children_)return;let t=!1;for(let r=this.children_.length-1;r>=0;r--)if(this.children_[r]===e){t=!0,this.children_.splice(r,1);break}if(!t)return;e.parentComponent_=null,this.childIndex_[e.id()]=null,this.childNameIndex_[toTitleCase$1(e.name())]=null,this.childNameIndex_[toLowerCase(e.name())]=null;const n=e.el();n&&n.parentNode===this.contentEl()&&this.contentEl().removeChild(e.el())}initChildren(){const e=this.options_.children;if(e){const t=this.options_,n=e=>{const n=e.name;let r=e.opts;if(void 0!==t[n]&&(r=t[n]),!1===r)return;!0===r&&(r={}),r.playerOptions=this.options_.playerOptions;const a=this.addChild(n,r);a&&(this[n]=a)};let r;const a=Component$1.getComponent("Tech");r=Array.isArray(e)?e:Object.keys(e),r.concat(Object.keys(this.options_).filter((function(e){return!r.some((function(t){return"string"==typeof t?e===t:e===t.name}))}))).map((t=>{let n,r;return"string"==typeof t?(n=t,r=e[n]||this.options_[n]||{}):(n=t.name,r=t),{name:n,opts:r}})).filter((e=>{const t=Component$1.getComponent(e.opts.componentClass||toTitleCase$1(e.name));return t&&!a.isTech(t)})).forEach(n)}}buildCSSClass(){return""}ready(e,t=!1){if(e)return this.isReady_?void(t?e.call(this):this.setTimeout(e,1)):(this.readyQueue_=this.readyQueue_||[],void this.readyQueue_.push(e))}triggerReady(){this.isReady_=!0,this.setTimeout((function(){const e=this.readyQueue_;this.readyQueue_=[],e&&e.length>0&&e.forEach((function(e){e.call(this)}),this),this.trigger("ready")}),1)}$(e,t){return $(e,t||this.contentEl())}$$(e,t){return $$(e,t||this.contentEl())}hasClass(e){return hasClass(this.el_,e)}addClass(...e){addClass(this.el_,...e)}removeClass(...e){removeClass(this.el_,...e)}toggleClass(e,t){toggleClass(this.el_,e,t)}show(){this.removeClass("vjs-hidden")}hide(){this.addClass("vjs-hidden")}lockShowing(){this.addClass("vjs-lock-showing")}unlockShowing(){this.removeClass("vjs-lock-showing")}getAttribute(e){return getAttribute(this.el_,e)}setAttribute(e,t){setAttribute(this.el_,e,t)}removeAttribute(e){removeAttribute(this.el_,e)}width(e,t){return this.dimension("width",e,t)}height(e,t){return this.dimension("height",e,t)}dimensions(e,t){this.width(e,!0),this.height(t)}dimension(e,t,n){if(void 0!==t)return null!==t&&t==t||(t=0),-1!==(""+t).indexOf("%")||-1!==(""+t).indexOf("px")?this.el_.style[e]=t:this.el_.style[e]="auto"===t?"":t+"px",void(n||this.trigger("componentresize"));if(!this.el_)return 0;const r=this.el_.style[e],a=r.indexOf("px");return-1!==a?parseInt(r.slice(0,a),10):parseInt(this.el_["offset"+toTitleCase$1(e)],10)}currentDimension(e){let t=0;if("width"!==e&&"height"!==e)throw new Error("currentDimension only accepts width or height value");if(t=computedStyle(this.el_,e),t=parseFloat(t),0===t||isNaN(t)){const n=`offset${toTitleCase$1(e)}`;t=this.el_[n]}return t}currentDimensions(){return{width:this.currentDimension("width"),height:this.currentDimension("height")}}currentWidth(){return this.currentDimension("width")}currentHeight(){return this.currentDimension("height")}focus(){this.el_.focus()}blur(){this.el_.blur()}handleKeyDown(e){this.player_&&(keycode.isEventKey(e,"Tab")||e.stopPropagation(),this.player_.handleKeyDown(e))}handleKeyPress(e){this.handleKeyDown(e)}emitTapEvents(){let e=0,t=null;let n;this.on("touchstart",(function(r){1===r.touches.length&&(t={pageX:r.touches[0].pageX,pageY:r.touches[0].pageY},e=window$1$1.performance.now(),n=!0)})),this.on("touchmove",(function(e){if(e.touches.length>1)n=!1;else if(t){const r=e.touches[0].pageX-t.pageX,a=e.touches[0].pageY-t.pageY;Math.sqrt(r*r+a*a)>10&&(n=!1)}}));const r=function(){n=!1};this.on("touchleave",r),this.on("touchcancel",r),this.on("touchend",(function(r){if(t=null,!0===n){window$1$1.performance.now()-e<200&&(r.preventDefault(),this.trigger("tap"))}}))}enableTouchActivity(){if(!this.player()||!this.player().reportUserActivity)return;const e=bind_(this.player(),this.player().reportUserActivity);let t;this.on("touchstart",(function(){e(),this.clearInterval(t),t=this.setInterval(e,250)}));const n=function(n){e(),this.clearInterval(t)};this.on("touchmove",e),this.on("touchend",n),this.on("touchcancel",n)}setTimeout(e,t){var n;return e=bind_(this,e),this.clearTimersOnDispose_(),n=window$1$1.setTimeout((()=>{this.setTimeoutIds_.has(n)&&this.setTimeoutIds_.delete(n),e()}),t),this.setTimeoutIds_.add(n),n}clearTimeout(e){return this.setTimeoutIds_.has(e)&&(this.setTimeoutIds_.delete(e),window$1$1.clearTimeout(e)),e}setInterval(e,t){e=bind_(this,e),this.clearTimersOnDispose_();const n=window$1$1.setInterval(e,t);return this.setIntervalIds_.add(n),n}clearInterval(e){return this.setIntervalIds_.has(e)&&(this.setIntervalIds_.delete(e),window$1$1.clearInterval(e)),e}requestAnimationFrame(e){var t;return this.clearTimersOnDispose_(),e=bind_(this,e),t=window$1$1.requestAnimationFrame((()=>{this.rafIds_.has(t)&&this.rafIds_.delete(t),e()})),this.rafIds_.add(t),t}requestNamedAnimationFrame(e,t){if(this.namedRafs_.has(e))return;this.clearTimersOnDispose_(),t=bind_(this,t);const n=this.requestAnimationFrame((()=>{t(),this.namedRafs_.has(e)&&this.namedRafs_.delete(e)}));return this.namedRafs_.set(e,n),e}cancelNamedAnimationFrame(e){this.namedRafs_.has(e)&&(this.cancelAnimationFrame(this.namedRafs_.get(e)),this.namedRafs_.delete(e))}cancelAnimationFrame(e){return this.rafIds_.has(e)&&(this.rafIds_.delete(e),window$1$1.cancelAnimationFrame(e)),e}clearTimersOnDispose_(){this.clearingTimersOnDispose_||(this.clearingTimersOnDispose_=!0,this.one("dispose",(()=>{[["namedRafs_","cancelNamedAnimationFrame"],["rafIds_","cancelAnimationFrame"],["setTimeoutIds_","clearTimeout"],["setIntervalIds_","clearInterval"]].forEach((([e,t])=>{this[e].forEach(((e,n)=>this[t](n)))})),this.clearingTimersOnDispose_=!1})))}static registerComponent(e,t){if("string"!=typeof e||!e)throw new Error(`Illegal component name, "${e}"; must be a non-empty string.`);const n=Component$1.getComponent("Tech"),r=n&&n.isTech(t),a=Component$1===t||Component$1.prototype.isPrototypeOf(t.prototype);if(r||!a){let t;throw t=r?"techs must be registered using Tech.registerTech()":"must be a Component subclass",new Error(`Illegal component, "${e}"; ${t}.`)}e=toTitleCase$1(e),Component$1.components_||(Component$1.components_={});const i=Component$1.getComponent("Player");if("Player"===e&&i&&i.players){const e=i.players,t=Object.keys(e);if(e&&t.length>0&&t.map((t=>e[t])).every(Boolean))throw new Error("Can not register Player component after player has been created.")}return Component$1.components_[e]=t,Component$1.components_[toLowerCase(e)]=t,t}static getComponent(e){if(e&&Component$1.components_)return Component$1.components_[e]}}function rangeCheck(e,t,n){if("number"!=typeof t||t<0||t>n)throw new Error(`Failed to execute '${e}' on 'TimeRanges': The index provided (${t}) is non-numeric or out of bounds (0-${n}).`)}function getRange(e,t,n,r){return rangeCheck(e,r,n.length-1),n[r][t]}function createTimeRangesObj(e){let t;return t=void 0===e||0===e.length?{length:0,start(){throw new Error("This TimeRanges object is empty")},end(){throw new Error("This TimeRanges object is empty")}}:{length:e.length,start:getRange.bind(null,"start",0,e),end:getRange.bind(null,"end",1,e)},window$1$1.Symbol&&window$1$1.Symbol.iterator&&(t[window$1$1.Symbol.iterator]=()=>(e||[]).values()),t}function createTimeRanges$1(e,t){return Array.isArray(e)?createTimeRangesObj(e):void 0===e||void 0===t?createTimeRangesObj():createTimeRangesObj([[e,t]])}Component$1.registerComponent("Component",Component$1);const defaultImplementation=function(e,t){e=e<0?0:e;let n=Math.floor(e%60),r=Math.floor(e/60%60),a=Math.floor(e/3600);const i=Math.floor(t/60%60),s=Math.floor(t/3600);return(isNaN(e)||e===1/0)&&(a=r=n="-"),a=a>0||s>0?a+":":"",r=((a||i>=10)&&r<10?"0"+r:r)+":",n=n<10?"0"+n:n,a+r+n};let implementation=defaultImplementation;function setFormatTime(e){implementation=e}function resetFormatTime(){implementation=defaultImplementation}function formatTime(e,t=e){return implementation(e,t)}var Time=Object.freeze({__proto__:null,createTimeRanges:createTimeRanges$1,createTimeRange:createTimeRanges$1,setFormatTime:setFormatTime,resetFormatTime:resetFormatTime,formatTime:formatTime});function bufferedPercent(e,t){let n,r,a=0;if(!t)return 0;e&&e.length||(e=createTimeRanges$1(0,0));for(let i=0;i<e.length;i++)n=e.start(i),r=e.end(i),r>t&&(r=t),a+=r-n;return a/t}function MediaError(e){if(e instanceof MediaError)return e;"number"==typeof e?this.code=e:"string"==typeof e?this.message=e:isObject(e)&&("number"==typeof e.code&&(this.code=e.code),Object.assign(this,e)),this.message||(this.message=MediaError.defaultMessages[this.code]||"")}MediaError.prototype.code=0,MediaError.prototype.message="",MediaError.prototype.status=null,MediaError.errorTypes=["MEDIA_ERR_CUSTOM","MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED","MEDIA_ERR_ENCRYPTED"],MediaError.defaultMessages={1:"You aborted the media playback",2:"A network error caused the media download to fail part-way.",3:"The media playback was aborted due to a corruption problem or because the media used features your browser did not support.",4:"The media could not be loaded, either because the server or network failed or because the format is not supported.",5:"The media is encrypted and we do not have the keys to decrypt it."};for(let m=0;m<MediaError.errorTypes.length;m++)MediaError[MediaError.errorTypes[m]]=m,MediaError.prototype[MediaError.errorTypes[m]]=m;function isPromise(e){return null!=e&&"function"==typeof e.then}function silencePromise(e){isPromise(e)&&e.then(null,(e=>{}))}const trackToJson_=function(e){return["kind","label","language","id","inBandMetadataTrackDispatchType","mode","src"].reduce(((t,n,r)=>(e[n]&&(t[n]=e[n]),t)),{cues:e.cues&&Array.prototype.map.call(e.cues,(function(e){return{startTime:e.startTime,endTime:e.endTime,text:e.text,id:e.id}}))})},textTracksToJson=function(e){const t=e.$$("track"),n=Array.prototype.map.call(t,(e=>e.track));return Array.prototype.map.call(t,(function(e){const t=trackToJson_(e.track);return e.src&&(t.src=e.src),t})).concat(Array.prototype.filter.call(e.textTracks(),(function(e){return-1===n.indexOf(e)})).map(trackToJson_))},jsonToTextTracks=function(e,t){return e.forEach((function(e){const n=t.addRemoteTextTrack(e).track;!e.src&&e.cues&&e.cues.forEach((e=>n.addCue(e)))})),t.textTracks()};var textTrackConverter={textTracksToJson:textTracksToJson,jsonToTextTracks:jsonToTextTracks,trackToJson_:trackToJson_};const MODAL_CLASS_NAME="vjs-modal-dialog";class ModalDialog extends Component$1{constructor(e,t){super(e,t),this.handleKeyDown_=e=>this.handleKeyDown(e),this.close_=e=>this.close(e),this.opened_=this.hasBeenOpened_=this.hasBeenFilled_=!1,this.closeable(!this.options_.uncloseable),this.content(this.options_.content),this.contentEl_=createEl("div",{className:`${MODAL_CLASS_NAME}-content`},{role:"document"}),this.descEl_=createEl("p",{className:`${MODAL_CLASS_NAME}-description vjs-control-text`,id:this.el().getAttribute("aria-describedby")}),textContent(this.descEl_,this.description()),this.el_.appendChild(this.descEl_),this.el_.appendChild(this.contentEl_)}createEl(){return super.createEl("div",{className:this.buildCSSClass(),tabIndex:-1},{"aria-describedby":`${this.id()}_description`,"aria-hidden":"true","aria-label":this.label(),role:"dialog"})}dispose(){this.contentEl_=null,this.descEl_=null,this.previouslyActiveEl_=null,super.dispose()}buildCSSClass(){return`${MODAL_CLASS_NAME} vjs-hidden ${super.buildCSSClass()}`}label(){return this.localize(this.options_.label||"Modal Window")}description(){let e=this.options_.description||this.localize("This is a modal window.");return this.closeable()&&(e+=" "+this.localize("This modal can be closed by pressing the Escape key or activating the close button.")),e}open(){if(!this.opened_){const e=this.player();this.trigger("beforemodalopen"),this.opened_=!0,(this.options_.fillAlways||!this.hasBeenOpened_&&!this.hasBeenFilled_)&&this.fill(),this.wasPlaying_=!e.paused(),this.options_.pauseOnOpen&&this.wasPlaying_&&e.pause(),this.on("keydown",this.handleKeyDown_),this.hadControls_=e.controls(),e.controls(!1),this.show(),this.conditionalFocus_(),this.el().setAttribute("aria-hidden","false"),this.trigger("modalopen"),this.hasBeenOpened_=!0}}opened(e){return"boolean"==typeof e&&this[e?"open":"close"](),this.opened_}close(){if(!this.opened_)return;const e=this.player();this.trigger("beforemodalclose"),this.opened_=!1,this.wasPlaying_&&this.options_.pauseOnOpen&&e.play(),this.off("keydown",this.handleKeyDown_),this.hadControls_&&e.controls(!0),this.hide(),this.el().setAttribute("aria-hidden","true"),this.trigger("modalclose"),this.conditionalBlur_(),this.options_.temporary&&this.dispose()}closeable(e){if("boolean"==typeof e){const t=this.closeable_=!!e;let n=this.getChild("closeButton");if(t&&!n){const e=this.contentEl_;this.contentEl_=this.el_,n=this.addChild("closeButton",{controlText:"Close Modal Dialog"}),this.contentEl_=e,this.on(n,"close",this.close_)}!t&&n&&(this.off(n,"close",this.close_),this.removeChild(n),n.dispose())}return this.closeable_}fill(){this.fillWith(this.content())}fillWith(e){const t=this.contentEl(),n=t.parentNode,r=t.nextSibling;this.trigger("beforemodalfill"),this.hasBeenFilled_=!0,n.removeChild(t),this.empty(),insertContent(t,e),this.trigger("modalfill"),r?n.insertBefore(t,r):n.appendChild(t);const a=this.getChild("closeButton");a&&n.appendChild(a.el_)}empty(){this.trigger("beforemodalempty"),emptyEl(this.contentEl()),this.trigger("modalempty")}content(e){return void 0!==e&&(this.content_=e),this.content_}conditionalFocus_(){const e=document$2.activeElement,t=this.player_.el_;this.previouslyActiveEl_=null,(t.contains(e)||t===e)&&(this.previouslyActiveEl_=e,this.focus())}conditionalBlur_(){this.previouslyActiveEl_&&(this.previouslyActiveEl_.focus(),this.previouslyActiveEl_=null)}handleKeyDown(e){if(e.stopPropagation(),keycode.isEventKey(e,"Escape")&&this.closeable())return e.preventDefault(),void this.close();if(!keycode.isEventKey(e,"Tab"))return;const t=this.focusableEls_(),n=this.el_.querySelector(":focus");let r;for(let a=0;a<t.length;a++)if(n===t[a]){r=a;break}document$2.activeElement===this.el_&&(r=0),e.shiftKey&&0===r?(t[t.length-1].focus(),e.preventDefault()):e.shiftKey||r!==t.length-1||(t[0].focus(),e.preventDefault())}focusableEls_(){const e=this.el_.querySelectorAll("*");return Array.prototype.filter.call(e,(e=>(e instanceof window$1$1.HTMLAnchorElement||e instanceof window$1$1.HTMLAreaElement)&&e.hasAttribute("href")||(e instanceof window$1$1.HTMLInputElement||e instanceof window$1$1.HTMLSelectElement||e instanceof window$1$1.HTMLTextAreaElement||e instanceof window$1$1.HTMLButtonElement)&&!e.hasAttribute("disabled")||e instanceof window$1$1.HTMLIFrameElement||e instanceof window$1$1.HTMLObjectElement||e instanceof window$1$1.HTMLEmbedElement||e.hasAttribute("tabindex")&&-1!==e.getAttribute("tabindex")||e.hasAttribute("contenteditable")))}}ModalDialog.prototype.options_={pauseOnOpen:!0,temporary:!0},Component$1.registerComponent("ModalDialog",ModalDialog);class TrackList extends EventTarget$2{constructor(e=[]){super(),this.tracks_=[],Object.defineProperty(this,"length",{get(){return this.tracks_.length}});for(let t=0;t<e.length;t++)this.addTrack(e[t])}addTrack(e){const t=this.tracks_.length;""+t in this||Object.defineProperty(this,t,{get(){return this.tracks_[t]}}),-1===this.tracks_.indexOf(e)&&(this.tracks_.push(e),this.trigger({track:e,type:"addtrack",target:this})),e.labelchange_=()=>{this.trigger({track:e,type:"labelchange",target:this})},isEvented(e)&&e.addEventListener("labelchange",e.labelchange_)}removeTrack(e){let t;for(let n=0,r=this.length;n<r;n++)if(this[n]===e){t=this[n],t.off&&t.off(),this.tracks_.splice(n,1);break}t&&this.trigger({track:t,type:"removetrack",target:this})}getTrackById(e){let t=null;for(let n=0,r=this.length;n<r;n++){const r=this[n];if(r.id===e){t=r;break}}return t}}TrackList.prototype.allowedEvents_={change:"change",addtrack:"addtrack",removetrack:"removetrack",labelchange:"labelchange"};for(const m in TrackList.prototype.allowedEvents_)TrackList.prototype["on"+m]=null;const disableOthers$1=function(e,t){for(let n=0;n<e.length;n++)Object.keys(e[n]).length&&t.id!==e[n].id&&(e[n].enabled=!1)};class AudioTrackList extends TrackList{constructor(e=[]){for(let t=e.length-1;t>=0;t--)if(e[t].enabled){disableOthers$1(e,e[t]);break}super(e),this.changing_=!1}addTrack(e){e.enabled&&disableOthers$1(this,e),super.addTrack(e),e.addEventListener&&(e.enabledChange_=()=>{this.changing_||(this.changing_=!0,disableOthers$1(this,e),this.changing_=!1,this.trigger("change"))},e.addEventListener("enabledchange",e.enabledChange_))}removeTrack(e){super.removeTrack(e),e.removeEventListener&&e.enabledChange_&&(e.removeEventListener("enabledchange",e.enabledChange_),e.enabledChange_=null)}}const disableOthers=function(e,t){for(let n=0;n<e.length;n++)Object.keys(e[n]).length&&t.id!==e[n].id&&(e[n].selected=!1)};class VideoTrackList extends TrackList{constructor(e=[]){for(let t=e.length-1;t>=0;t--)if(e[t].selected){disableOthers(e,e[t]);break}super(e),this.changing_=!1,Object.defineProperty(this,"selectedIndex",{get(){for(let e=0;e<this.length;e++)if(this[e].selected)return e;return-1},set(){}})}addTrack(e){e.selected&&disableOthers(this,e),super.addTrack(e),e.addEventListener&&(e.selectedChange_=()=>{this.changing_||(this.changing_=!0,disableOthers(this,e),this.changing_=!1,this.trigger("change"))},e.addEventListener("selectedchange",e.selectedChange_))}removeTrack(e){super.removeTrack(e),e.removeEventListener&&e.selectedChange_&&(e.removeEventListener("selectedchange",e.selectedChange_),e.selectedChange_=null)}}class TextTrackList extends TrackList{addTrack(e){super.addTrack(e),this.queueChange_||(this.queueChange_=()=>this.queueTrigger("change")),this.triggerSelectedlanguagechange||(this.triggerSelectedlanguagechange_=()=>this.trigger("selectedlanguagechange")),e.addEventListener("modechange",this.queueChange_);-1===["metadata","chapters"].indexOf(e.kind)&&e.addEventListener("modechange",this.triggerSelectedlanguagechange_)}removeTrack(e){super.removeTrack(e),e.removeEventListener&&(this.queueChange_&&e.removeEventListener("modechange",this.queueChange_),this.selectedlanguagechange_&&e.removeEventListener("modechange",this.triggerSelectedlanguagechange_))}}class HtmlTrackElementList{constructor(e=[]){this.trackElements_=[],Object.defineProperty(this,"length",{get(){return this.trackElements_.length}});for(let t=0,n=e.length;t<n;t++)this.addTrackElement_(e[t])}addTrackElement_(e){const t=this.trackElements_.length;""+t in this||Object.defineProperty(this,t,{get(){return this.trackElements_[t]}}),-1===this.trackElements_.indexOf(e)&&this.trackElements_.push(e)}getTrackElementByTrack_(e){let t;for(let n=0,r=this.trackElements_.length;n<r;n++)if(e===this.trackElements_[n].track){t=this.trackElements_[n];break}return t}removeTrackElement_(e){for(let t=0,n=this.trackElements_.length;t<n;t++)if(e===this.trackElements_[t]){this.trackElements_[t].track&&"function"==typeof this.trackElements_[t].track.off&&this.trackElements_[t].track.off(),"function"==typeof this.trackElements_[t].off&&this.trackElements_[t].off(),this.trackElements_.splice(t,1);break}}}class TextTrackCueList{constructor(e){TextTrackCueList.prototype.setCues_.call(this,e),Object.defineProperty(this,"length",{get(){return this.length_}})}setCues_(e){const t=this.length||0;let n=0;const r=e.length;this.cues_=e,this.length_=e.length;const a=function(e){""+e in this||Object.defineProperty(this,""+e,{get(){return this.cues_[e]}})};if(t<r)for(n=t;n<r;n++)a.call(this,n)}getCueById(e){let t=null;for(let n=0,r=this.length;n<r;n++){const r=this[n];if(r.id===e){t=r;break}}return t}}const VideoTrackKind={alternative:"alternative",captions:"captions",main:"main",sign:"sign",subtitles:"subtitles",commentary:"commentary"},AudioTrackKind={alternative:"alternative",descriptions:"descriptions",main:"main","main-desc":"main-desc",translation:"translation",commentary:"commentary"},TextTrackKind={subtitles:"subtitles",captions:"captions",descriptions:"descriptions",chapters:"chapters",metadata:"metadata"},TextTrackMode={disabled:"disabled",hidden:"hidden",showing:"showing"};class Track extends EventTarget$2{constructor(e={}){super();const t={id:e.id||"vjs_track_"+newGUID(),kind:e.kind||"",language:e.language||""};let n=e.label||"";for(const r in t)Object.defineProperty(this,r,{get:()=>t[r],set(){}});Object.defineProperty(this,"label",{get:()=>n,set(e){e!==n&&(n=e,this.trigger("labelchange"))}})}}const parseUrl=function(e){const t=["protocol","hostname","port","pathname","search","hash","host"],n=document$2.createElement("a");n.href=e;const r={};for(let a=0;a<t.length;a++)r[t[a]]=n[t[a]];return"http:"===r.protocol&&(r.host=r.host.replace(/:80$/,"")),"https:"===r.protocol&&(r.host=r.host.replace(/:443$/,"")),r.protocol||(r.protocol=window$1$1.location.protocol),r.host||(r.host=window$1$1.location.host),r},getAbsoluteURL=function(e){if(!e.match(/^https?:\/\//)){const t=document$2.createElement("a");t.href=e,e=t.href}return e},getFileExtension=function(e){if("string"==typeof e){const t=/^(\/?)([\s\S]*?)((?:\.{1,2}|[^\/]+?)(\.([^\.\/\?]+)))(?:[\/]*|[\?].*)$/.exec(e);if(t)return t.pop().toLowerCase()}return""},isCrossOrigin=function(e,t=window$1$1.location){const n=parseUrl(e);return(":"===n.protocol?t.protocol:n.protocol)+n.host!==t.protocol+t.host};var Url=Object.freeze({__proto__:null,parseUrl:parseUrl,getAbsoluteURL:getAbsoluteURL,getFileExtension:getFileExtension,isCrossOrigin:isCrossOrigin});const parseCues=function(e,t){const n=new window$1$1.WebVTT.Parser(window$1$1,window$1$1.vttjs,window$1$1.WebVTT.StringDecoder()),r=[];n.oncue=function(e){t.addCue(e)},n.onparsingerror=function(e){r.push(e)},n.onflush=function(){t.trigger({type:"loadeddata",target:t})},n.parse(e),r.length>0&&(window$1$1.console&&window$1$1.console.groupCollapsed&&window$1$1.console.groupCollapsed(`Text Track parsing errors for ${t.src}`),r.forEach((e=>log$1.error(e))),window$1$1.console&&window$1$1.console.groupEnd&&window$1$1.console.groupEnd()),n.flush()},loadTrack=function(e,t){const n={uri:e},r=isCrossOrigin(e);r&&(n.cors=r);const a="use-credentials"===t.tech_.crossOrigin();a&&(n.withCredentials=a),XHR(n,bind_(this,(function(e,n,r){if(e)return log$1.error(e,n);t.loaded_=!0,"function"!=typeof window$1$1.WebVTT?t.tech_&&t.tech_.any(["vttjsloaded","vttjserror"],(e=>{if("vttjserror"!==e.type)return parseCues(r,t);log$1.error(`vttjs failed to load, stopping trying to process ${t.src}`)})):parseCues(r,t)})))};class TextTrack extends Track{constructor(e={}){if(!e.tech)throw new Error("A tech was not provided.");const t=merge$1(e,{kind:TextTrackKind[e.kind]||"subtitles",language:e.language||e.srclang||""});let n=TextTrackMode[t.mode]||"disabled";const r=t.default;"metadata"!==t.kind&&"chapters"!==t.kind||(n="hidden"),super(t),this.tech_=t.tech,this.cues_=[],this.activeCues_=[],this.preload_=!1!==this.tech_.preloadTextTracks;const a=new TextTrackCueList(this.cues_),i=new TextTrackCueList(this.activeCues_);let s=!1;this.timeupdateHandler=bind_(this,(function(e={}){this.tech_.isDisposed()||(this.tech_.isReady_?(this.activeCues=this.activeCues,s&&(this.trigger("cuechange"),s=!1),"timeupdate"!==e.type&&(this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler))):"timeupdate"!==e.type&&(this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler)))}));this.tech_.one("dispose",(()=>{this.stopTracking()})),"disabled"!==n&&this.startTracking(),Object.defineProperties(this,{default:{get:()=>r,set(){}},mode:{get:()=>n,set(e){TextTrackMode[e]&&n!==e&&(n=e,this.preload_||"disabled"===n||0!==this.cues.length||loadTrack(this.src,this),this.stopTracking(),"disabled"!==n&&this.startTracking(),this.trigger("modechange"))}},cues:{get(){return this.loaded_?a:null},set(){}},activeCues:{get(){if(!this.loaded_)return null;if(0===this.cues.length)return i;const e=this.tech_.currentTime(),t=[];for(let n=0,r=this.cues.length;n<r;n++){const r=this.cues[n];r.startTime<=e&&r.endTime>=e&&t.push(r)}if(s=!1,t.length!==this.activeCues_.length)s=!0;else for(let n=0;n<t.length;n++)-1===this.activeCues_.indexOf(t[n])&&(s=!0);return this.activeCues_=t,i.setCues_(this.activeCues_),i},set(){}}}),t.src?(this.src=t.src,this.preload_||(this.loaded_=!0),(this.preload_||"subtitles"!==t.kind&&"captions"!==t.kind)&&loadTrack(this.src,this)):this.loaded_=!0}startTracking(){this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler),this.tech_.on("timeupdate",this.timeupdateHandler)}stopTracking(){this.rvf_&&(this.tech_.cancelVideoFrameCallback(this.rvf_),this.rvf_=void 0),this.tech_.off("timeupdate",this.timeupdateHandler)}addCue(e){let t=e;if(!("getCueAsHTML"in t)){t=new window$1$1.vttjs.VTTCue(e.startTime,e.endTime,e.text);for(const n in e)n in t||(t[n]=e[n]);t.id=e.id,t.originalCue_=e}const n=this.tech_.textTracks();for(let r=0;r<n.length;r++)n[r]!==this&&n[r].removeCue(t);this.cues_.push(t),this.cues.setCues_(this.cues_)}removeCue(e){let t=this.cues_.length;for(;t--;){const n=this.cues_[t];if(n===e||n.originalCue_&&n.originalCue_===e){this.cues_.splice(t,1),this.cues.setCues_(this.cues_);break}}}}TextTrack.prototype.allowedEvents_={cuechange:"cuechange"};class AudioTrack extends Track{constructor(e={}){const t=merge$1(e,{kind:AudioTrackKind[e.kind]||""});super(t);let n=!1;Object.defineProperty(this,"enabled",{get:()=>n,set(e){"boolean"==typeof e&&e!==n&&(n=e,this.trigger("enabledchange"))}}),t.enabled&&(this.enabled=t.enabled),this.loaded_=!0}}class VideoTrack extends Track{constructor(e={}){const t=merge$1(e,{kind:VideoTrackKind[e.kind]||""});super(t);let n=!1;Object.defineProperty(this,"selected",{get:()=>n,set(e){"boolean"==typeof e&&e!==n&&(n=e,this.trigger("selectedchange"))}}),t.selected&&(this.selected=t.selected)}}class HTMLTrackElement extends EventTarget$2{constructor(e={}){let t;super();const n=new TextTrack(e);this.kind=n.kind,this.src=n.src,this.srclang=n.language,this.label=n.label,this.default=n.default,Object.defineProperties(this,{readyState:{get:()=>t},track:{get:()=>n}}),t=HTMLTrackElement.NONE,n.addEventListener("loadeddata",(()=>{t=HTMLTrackElement.LOADED,this.trigger({type:"load",target:this})}))}}HTMLTrackElement.prototype.allowedEvents_={load:"load"},HTMLTrackElement.NONE=0,HTMLTrackElement.LOADING=1,HTMLTrackElement.LOADED=2,HTMLTrackElement.ERROR=3;const NORMAL={audio:{ListClass:AudioTrackList,TrackClass:AudioTrack,capitalName:"Audio"},video:{ListClass:VideoTrackList,TrackClass:VideoTrack,capitalName:"Video"},text:{ListClass:TextTrackList,TrackClass:TextTrack,capitalName:"Text"}};Object.keys(NORMAL).forEach((function(e){NORMAL[e].getterName=`${e}Tracks`,NORMAL[e].privateName=`${e}Tracks_`}));const REMOTE={remoteText:{ListClass:TextTrackList,TrackClass:TextTrack,capitalName:"RemoteText",getterName:"remoteTextTracks",privateName:"remoteTextTracks_"},remoteTextEl:{ListClass:HtmlTrackElementList,TrackClass:HTMLTrackElement,capitalName:"RemoteTextTrackEls",getterName:"remoteTextTrackEls",privateName:"remoteTextTrackEls_"}},ALL=Object.assign({},NORMAL,REMOTE);function createTrackHelper(e,t,n,r,a={}){const i=e.textTracks();a.kind=t,n&&(a.label=n),r&&(a.language=r),a.tech=e;const s=new ALL.text.TrackClass(a);return i.addTrack(s),s}REMOTE.names=Object.keys(REMOTE),NORMAL.names=Object.keys(NORMAL),ALL.names=[].concat(REMOTE.names).concat(NORMAL.names);class Tech extends Component$1{constructor(e={},t=function(){}){e.reportTouchActivity=!1,super(null,e,t),this.onDurationChange_=e=>this.onDurationChange(e),this.trackProgress_=e=>this.trackProgress(e),this.trackCurrentTime_=e=>this.trackCurrentTime(e),this.stopTrackingCurrentTime_=e=>this.stopTrackingCurrentTime(e),this.disposeSourceHandler_=e=>this.disposeSourceHandler(e),this.queuedHanders_=new Set,this.hasStarted_=!1,this.on("playing",(function(){this.hasStarted_=!0})),this.on("loadstart",(function(){this.hasStarted_=!1})),ALL.names.forEach((t=>{const n=ALL[t];e&&e[n.getterName]&&(this[n.privateName]=e[n.getterName])})),this.featuresProgressEvents||this.manualProgressOn(),this.featuresTimeupdateEvents||this.manualTimeUpdatesOn(),["Text","Audio","Video"].forEach((t=>{!1===e[`native${t}Tracks`]&&(this[`featuresNative${t}Tracks`]=!1)})),!1===e.nativeCaptions||!1===e.nativeTextTracks?this.featuresNativeTextTracks=!1:!0!==e.nativeCaptions&&!0!==e.nativeTextTracks||(this.featuresNativeTextTracks=!0),this.featuresNativeTextTracks||this.emulateTextTracks(),this.preloadTextTracks=!1!==e.preloadTextTracks,this.autoRemoteTextTracks_=new ALL.text.ListClass,this.initTrackListeners(),e.nativeControlsForTouch||this.emitTapEvents(),this.constructor&&(this.name_=this.constructor.name||"Unknown Tech")}triggerSourceset(e){this.isReady_||this.one("ready",(()=>this.setTimeout((()=>this.triggerSourceset(e)),1))),this.trigger({src:e,type:"sourceset"})}manualProgressOn(){this.on("durationchange",this.onDurationChange_),this.manualProgress=!0,this.one("ready",this.trackProgress_)}manualProgressOff(){this.manualProgress=!1,this.stopTrackingProgress(),this.off("durationchange",this.onDurationChange_)}trackProgress(e){this.stopTrackingProgress(),this.progressInterval=this.setInterval(bind_(this,(function(){const e=this.bufferedPercent();this.bufferedPercent_!==e&&this.trigger("progress"),this.bufferedPercent_=e,1===e&&this.stopTrackingProgress()})),500)}onDurationChange(e){this.duration_=this.duration()}buffered(){return createTimeRanges$1(0,0)}bufferedPercent(){return bufferedPercent(this.buffered(),this.duration_)}stopTrackingProgress(){this.clearInterval(this.progressInterval)}manualTimeUpdatesOn(){this.manualTimeUpdates=!0,this.on("play",this.trackCurrentTime_),this.on("pause",this.stopTrackingCurrentTime_)}manualTimeUpdatesOff(){this.manualTimeUpdates=!1,this.stopTrackingCurrentTime(),this.off("play",this.trackCurrentTime_),this.off("pause",this.stopTrackingCurrentTime_)}trackCurrentTime(){this.currentTimeInterval&&this.stopTrackingCurrentTime(),this.currentTimeInterval=this.setInterval((function(){this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})}),250)}stopTrackingCurrentTime(){this.clearInterval(this.currentTimeInterval),this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})}dispose(){this.clearTracks(NORMAL.names),this.manualProgress&&this.manualProgressOff(),this.manualTimeUpdates&&this.manualTimeUpdatesOff(),super.dispose()}clearTracks(e){(e=[].concat(e)).forEach((e=>{const t=this[`${e}Tracks`]()||[];let n=t.length;for(;n--;){const r=t[n];"text"===e&&this.removeRemoteTextTrack(r),t.removeTrack(r)}}))}cleanupAutoTextTracks(){const e=this.autoRemoteTextTracks_||[];let t=e.length;for(;t--;){const n=e[t];this.removeRemoteTextTrack(n)}}reset(){}crossOrigin(){}setCrossOrigin(){}error(e){return void 0!==e&&(this.error_=new MediaError(e),this.trigger("error")),this.error_}played(){return this.hasStarted_?createTimeRanges$1(0,0):createTimeRanges$1()}play(){}setScrubbing(e){}scrubbing(){}setCurrentTime(e){this.manualTimeUpdates&&this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})}initTrackListeners(){NORMAL.names.forEach((e=>{const t=NORMAL[e],n=()=>{this.trigger(`${e}trackchange`)},r=this[t.getterName]();r.addEventListener("removetrack",n),r.addEventListener("addtrack",n),this.on("dispose",(()=>{r.removeEventListener("removetrack",n),r.removeEventListener("addtrack",n)}))}))}addWebVttScript_(){if(!window$1$1.WebVTT)if(document$2.body.contains(this.el())){if(!this.options_["vtt.js"]&&isPlain(vtt)&&Object.keys(vtt).length>0)return void this.trigger("vttjsloaded");const e=document$2.createElement("script");e.src=this.options_["vtt.js"]||"https://vjs.zencdn.net/vttjs/0.14.1/vtt.min.js",e.onload=()=>{this.trigger("vttjsloaded")},e.onerror=()=>{this.trigger("vttjserror")},this.on("dispose",(()=>{e.onload=null,e.onerror=null})),window$1$1.WebVTT=!0,this.el().parentNode.appendChild(e)}else this.ready(this.addWebVttScript_)}emulateTextTracks(){const e=this.textTracks(),t=this.remoteTextTracks(),n=t=>e.addTrack(t.track),r=t=>e.removeTrack(t.track);t.on("addtrack",n),t.on("removetrack",r),this.addWebVttScript_();const a=()=>this.trigger("texttrackchange"),i=()=>{a();for(let t=0;t<e.length;t++){const n=e[t];n.removeEventListener("cuechange",a),"showing"===n.mode&&n.addEventListener("cuechange",a)}};i(),e.addEventListener("change",i),e.addEventListener("addtrack",i),e.addEventListener("removetrack",i),this.on("dispose",(function(){t.off("addtrack",n),t.off("removetrack",r),e.removeEventListener("change",i),e.removeEventListener("addtrack",i),e.removeEventListener("removetrack",i);for(let t=0;t<e.length;t++){e[t].removeEventListener("cuechange",a)}}))}addTextTrack(e,t,n){if(!e)throw new Error("TextTrack kind is required but was not provided");return createTrackHelper(this,e,t,n)}createRemoteTextTrack(e){const t=merge$1(e,{tech:this});return new REMOTE.remoteTextEl.TrackClass(t)}addRemoteTextTrack(e={},t){const n=this.createRemoteTextTrack(e);return"boolean"!=typeof t&&(t=!1),this.remoteTextTrackEls().addTrackElement_(n),this.remoteTextTracks().addTrack(n.track),!1===t&&this.ready((()=>this.autoRemoteTextTracks_.addTrack(n.track))),n}removeRemoteTextTrack(e){const t=this.remoteTextTrackEls().getTrackElementByTrack_(e);this.remoteTextTrackEls().removeTrackElement_(t),this.remoteTextTracks().removeTrack(e),this.autoRemoteTextTracks_.removeTrack(e)}getVideoPlaybackQuality(){return{}}requestPictureInPicture(){return Promise.reject()}disablePictureInPicture(){return!0}setDisablePictureInPicture(){}requestVideoFrameCallback(e){const t=newGUID();return!this.isReady_||this.paused()?(this.queuedHanders_.add(t),this.one("playing",(()=>{this.queuedHanders_.has(t)&&(this.queuedHanders_.delete(t),e())}))):this.requestNamedAnimationFrame(t,e),t}cancelVideoFrameCallback(e){this.queuedHanders_.has(e)?this.queuedHanders_.delete(e):this.cancelNamedAnimationFrame(e)}setPoster(){}playsinline(){}setPlaysinline(){}overrideNativeAudioTracks(e){}overrideNativeVideoTracks(e){}canPlayType(e){return""}static canPlayType(e){return""}static canPlaySource(e,t){return Tech.canPlayType(e.type)}static isTech(e){return e.prototype instanceof Tech||e instanceof Tech||e===Tech}static registerTech(e,t){if(Tech.techs_||(Tech.techs_={}),!Tech.isTech(t))throw new Error(`Tech ${e} must be a Tech`);if(!Tech.canPlayType)throw new Error("Techs must have a static canPlayType method on them");if(!Tech.canPlaySource)throw new Error("Techs must have a static canPlaySource method on them");return e=toTitleCase$1(e),Tech.techs_[e]=t,Tech.techs_[toLowerCase(e)]=t,"Tech"!==e&&Tech.defaultTechOrder_.push(e),t}static getTech(e){if(e)return Tech.techs_&&Tech.techs_[e]?Tech.techs_[e]:(e=toTitleCase$1(e),window$1$1&&window$1$1.videojs&&window$1$1.videojs[e]?(log$1.warn(`The ${e} tech was added to the videojs object when it should be registered using videojs.registerTech(name, tech)`),window$1$1.videojs[e]):void 0)}}ALL.names.forEach((function(e){const t=ALL[e];Tech.prototype[t.getterName]=function(){return this[t.privateName]=this[t.privateName]||new t.ListClass,this[t.privateName]}})),Tech.prototype.featuresVolumeControl=!0,Tech.prototype.featuresMuteControl=!0,Tech.prototype.featuresFullscreenResize=!1,Tech.prototype.featuresPlaybackRate=!1,Tech.prototype.featuresProgressEvents=!1,Tech.prototype.featuresSourceset=!1,Tech.prototype.featuresTimeupdateEvents=!1,Tech.prototype.featuresNativeTextTracks=!1,Tech.prototype.featuresVideoFrameCallback=!1,Tech.withSourceHandlers=function(e){e.registerSourceHandler=function(t,n){let r=e.sourceHandlers;r||(r=e.sourceHandlers=[]),void 0===n&&(n=r.length),r.splice(n,0,t)},e.canPlayType=function(t){const n=e.sourceHandlers||[];let r;for(let e=0;e<n.length;e++)if(r=n[e].canPlayType(t),r)return r;return""},e.selectSourceHandler=function(t,n){const r=e.sourceHandlers||[];let a;for(let e=0;e<r.length;e++)if(a=r[e].canHandleSource(t,n),a)return r[e];return null},e.canPlaySource=function(t,n){const r=e.selectSourceHandler(t,n);return r?r.canHandleSource(t,n):""};["seekable","seeking","duration"].forEach((function(e){const t=this[e];"function"==typeof t&&(this[e]=function(){return this.sourceHandler_&&this.sourceHandler_[e]?this.sourceHandler_[e].apply(this.sourceHandler_,arguments):t.apply(this,arguments)})}),e.prototype),e.prototype.setSource=function(t){let n=e.selectSourceHandler(t,this.options_);n||(e.nativeSourceHandler?n=e.nativeSourceHandler:log$1.error("No source handler found for the current source.")),this.disposeSourceHandler(),this.off("dispose",this.disposeSourceHandler_),n!==e.nativeSourceHandler&&(this.currentSource_=t),this.sourceHandler_=n.handleSource(t,this,this.options_),this.one("dispose",this.disposeSourceHandler_)},e.prototype.disposeSourceHandler=function(){this.currentSource_&&(this.clearTracks(["audio","video"]),this.currentSource_=null),this.cleanupAutoTextTracks(),this.sourceHandler_&&(this.sourceHandler_.dispose&&this.sourceHandler_.dispose(),this.sourceHandler_=null)}},Component$1.registerComponent("Tech",Tech),Tech.registerTech("Tech",Tech),Tech.defaultTechOrder_=[];const middlewares={},middlewareInstances={},TERMINATOR={};function use(e,t){middlewares[e]=middlewares[e]||[],middlewares[e].push(t)}function setSource(e,t,n){e.setTimeout((()=>setSourceHelper(t,middlewares[t.type],n,e)),1)}function setTech(e,t){e.forEach((e=>e.setTech&&e.setTech(t)))}function get(e,t,n){return e.reduceRight(middlewareIterator(n),t[n]())}function set(e,t,n,r){return t[n](e.reduce(middlewareIterator(n),r))}function mediate(e,t,n,r=null){const a="call"+toTitleCase$1(n),i=e.reduce(middlewareIterator(a),r),s=i===TERMINATOR,o=s?null:t[n](i);return executeRight(e,n,o,s),o}const allowedGetters={buffered:1,currentTime:1,duration:1,muted:1,played:1,paused:1,seekable:1,volume:1,ended:1},allowedSetters={setCurrentTime:1,setMuted:1,setVolume:1},allowedMediators={play:1,pause:1};function middlewareIterator(e){return(t,n)=>t===TERMINATOR?TERMINATOR:n[e]?n[e](t):t}function executeRight(e,t,n,r){for(let a=e.length-1;a>=0;a--){const i=e[a];i[t]&&i[t](r,n)}}function clearCacheForPlayer(e){middlewareInstances[e.id()]=null}function getOrCreateFactory(e,t){const n=middlewareInstances[e.id()];let r=null;if(null==n)return r=t(e),middlewareInstances[e.id()]=[[t,r]],r;for(let a=0;a<n.length;a++){const[e,i]=n[a];e===t&&(r=i)}return null===r&&(r=t(e),n.push([t,r])),r}function setSourceHelper(e={},t=[],n,r,a=[],i=!1){const[s,...o]=t;if("string"==typeof s)setSourceHelper(e,middlewares[s],n,r,a,i);else if(s){const t=getOrCreateFactory(r,s);if(!t.setSource)return a.push(t),setSourceHelper(e,o,n,r,a,i);t.setSource(Object.assign({},e),(function(s,l){if(s)return setSourceHelper(e,o,n,r,a,i);a.push(t),setSourceHelper(l,e.type===l.type?o:middlewares[l.type],n,r,a,i)}))}else o.length?setSourceHelper(e,o,n,r,a,i):i?n(e,a):setSourceHelper(e,middlewares["*"],n,r,a,!0)}const MimetypesKind={opus:"video/ogg",ogv:"video/ogg",mp4:"video/mp4",mov:"video/mp4",m4v:"video/mp4",mkv:"video/x-matroska",m4a:"audio/mp4",mp3:"audio/mpeg",aac:"audio/aac",caf:"audio/x-caf",flac:"audio/flac",oga:"audio/ogg",wav:"audio/wav",m3u8:"application/x-mpegURL",mpd:"application/dash+xml",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",png:"image/png",svg:"image/svg+xml",webp:"image/webp"},getMimetype=function(e=""){const t=getFileExtension(e);return MimetypesKind[t.toLowerCase()]||""},findMimetype=(e,t)=>{if(!t)return"";if(e.cache_.source.src===t&&e.cache_.source.type)return e.cache_.source.type;const n=e.cache_.sources.filter((e=>e.src===t));if(n.length)return n[0].type;const r=e.$$("source");for(let a=0;a<r.length;a++){const e=r[a];if(e.type&&e.src&&e.src===t)return e.type}return getMimetype(t)},filterSource=function(e){if(Array.isArray(e)){let t=[];e.forEach((function(e){e=filterSource(e),Array.isArray(e)?t=t.concat(e):isObject(e)&&t.push(e)})),e=t}else e="string"==typeof e&&e.trim()?[fixSource({src:e})]:isObject(e)&&"string"==typeof e.src&&e.src&&e.src.trim()?[fixSource(e)]:[];return e};function fixSource(e){if(!e.type){const t=getMimetype(e.src);t&&(e.type=t)}return e}var icons='<svg xmlns="http://www.w3.org/2000/svg">\n  <defs>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-play">\n      <path d="M16 10v28l22-14z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-pause">\n      <path d="M12 38h8V10h-8v28zm16-28v28h8V10h-8z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-audio">\n      <path d="M24 2C14.06 2 6 10.06 6 20v14c0 3.31 2.69 6 6 6h6V24h-8v-4c0-7.73 6.27-14 14-14s14 6.27 14 14v4h-8v16h6c3.31 0 6-2.69 6-6V20c0-9.94-8.06-18-18-18z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-captions">\n      <path d="M38 8H10c-2.21 0-4 1.79-4 4v24c0 2.21 1.79 4 4 4h28c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4zM22 22h-3v-1h-4v6h4v-1h3v2a2 2 0 0 1-2 2h-6a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v2zm14 0h-3v-1h-4v6h4v-1h3v2a2 2 0 0 1-2 2h-6a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v2z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-subtitles">\n      <path d="M40 8H8c-2.21 0-4 1.79-4 4v24c0 2.21 1.79 4 4 4h32c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4zM8 24h8v4H8v-4zm20 12H8v-4h20v4zm12 0h-8v-4h8v4zm0-8H20v-4h20v4z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-fullscreen-enter">\n      <path d="M14 28h-4v10h10v-4h-6v-6zm-4-8h4v-6h6v-4H10v10zm24 14h-6v4h10V28h-4v6zm-6-24v4h6v6h4V10H28z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-fullscreen-exit">\n      <path d="M10 32h6v6h4V28H10v4zm6-16h-6v4h10V10h-4v6zm12 22h4v-6h6v-4H28v10zm4-22v-6h-4v10h10v-4h-6z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-play-circle">\n      <path d="M20 33l12-9-12-9v18zm4-29C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm0 36c-8.82 0-16-7.18-16-16S15.18 8 24 8s16 7.18 16 16-7.18 16-16 16z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-volume-mute">\n      <path d="M33 24c0-3.53-2.04-6.58-5-8.05v4.42l4.91 4.91c.06-.42.09-.85.09-1.28zm5 0c0 1.88-.41 3.65-1.08 5.28l3.03 3.03C41.25 29.82 42 27 42 24c0-8.56-5.99-15.72-14-17.54v4.13c5.78 1.72 10 7.07 10 13.41zM8.55 6L6 8.55 15.45 18H6v12h8l10 10V26.55l8.51 8.51c-1.34 1.03-2.85 1.86-4.51 2.36v4.13a17.94 17.94 0 0 0 7.37-3.62L39.45 42 42 39.45l-18-18L8.55 6zM24 8l-4.18 4.18L24 16.36V8z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-volume-low">\n      <path d="M14 18v12h8l10 10V8L22 18h-8z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-volume-medium">\n      <path d="M37 24c0-3.53-2.04-6.58-5-8.05v16.11c2.96-1.48 5-4.53 5-8.06zm-27-6v12h8l10 10V8L18 18h-8z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-volume-high">\n      <path d="M6 18v12h8l10 10V8L14 18H6zm27 6c0-3.53-2.04-6.58-5-8.05v16.11c2.96-1.48 5-4.53 5-8.06zM28 6.46v4.13c5.78 1.72 10 7.07 10 13.41s-4.22 11.69-10 13.41v4.13c8.01-1.82 14-8.97 14-17.54S36.01 8.28 28 6.46z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-spinner">\n      <path d="M18.8 21l9.53-16.51C26.94 4.18 25.49 4 24 4c-4.8 0-9.19 1.69-12.64 4.51l7.33 12.69.11-.2zm24.28-3c-1.84-5.85-6.3-10.52-11.99-12.68L23.77 18h19.31zm.52 2H28.62l.58 1 9.53 16.5C41.99 33.94 44 29.21 44 24c0-1.37-.14-2.71-.4-4zm-26.53 4l-7.8-13.5C6.01 14.06 4 18.79 4 24c0 1.37.14 2.71.4 4h14.98l-2.31-4zM4.92 30c1.84 5.85 6.3 10.52 11.99 12.68L24.23 30H4.92zm22.54 0l-7.8 13.51c1.4.31 2.85.49 4.34.49 4.8 0 9.19-1.69 12.64-4.51L29.31 26.8 27.46 30z"></path>\n    </symbol>\n    <symbol viewBox="0 0 24 24" id="vjs-icon-hd">\n      <path d="M19 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-8 12H9.5v-2h-2v2H6V9h1.5v2.5h2V9H11v6zm2-6h4c.55 0 1 .45 1 1v4c0 .55-.45 1-1 1h-4V9zm1.5 4.5h2v-3h-2v3z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-chapters">\n      <path d="M6 26h4v-4H6v4zm0 8h4v-4H6v4zm0-16h4v-4H6v4zm8 8h28v-4H14v4zm0 8h28v-4H14v4zm0-20v4h28v-4H14z"></path>\n    </symbol>\n    <symbol viewBox="0 0 40 40" id="vjs-icon-downloading">\n      <path d="M18.208 36.875q-3.208-.292-5.979-1.729-2.771-1.438-4.812-3.729-2.042-2.292-3.188-5.229-1.146-2.938-1.146-6.23 0-6.583 4.334-11.416 4.333-4.834 10.833-5.5v3.166q-5.167.75-8.583 4.646Q6.25 14.75 6.25 19.958q0 5.209 3.396 9.104 3.396 3.896 8.562 4.646zM20 28.417L11.542 20l2.083-2.083 4.917 4.916v-11.25h2.916v11.25l4.875-4.916L28.417 20zm1.792 8.458v-3.167q1.833-.25 3.541-.958 1.709-.708 3.167-1.875l2.333 2.292q-1.958 1.583-4.25 2.541-2.291.959-4.791 1.167zm6.791-27.792q-1.541-1.125-3.25-1.854-1.708-.729-3.541-1.021V3.042q2.5.25 4.77 1.208 2.271.958 4.271 2.5zm4.584 21.584l-2.25-2.25q1.166-1.5 1.854-3.209.687-1.708.937-3.541h3.209q-.292 2.5-1.229 4.791-.938 2.292-2.521 4.209zm.541-12.417q-.291-1.833-.958-3.562-.667-1.73-1.833-3.188l2.375-2.208q1.541 1.916 2.458 4.208.917 2.292 1.167 4.75z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-file-download">\n      <path d="M10.8 40.55q-1.35 0-2.375-1T7.4 37.15v-7.7h3.4v7.7h26.35v-7.7h3.4v7.7q0 1.4-1 2.4t-2.4 1zM24 32.1L13.9 22.05l2.45-2.45 5.95 5.95V7.15h3.4v18.4l5.95-5.95 2.45 2.45z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-file-download-done">\n      <path d="M9.8 40.5v-3.45h28.4v3.45zm9.2-9.05L7.4 19.85l2.45-2.35L19 26.65l19.2-19.2 2.4 2.4z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-file-download-off">\n      <path d="M4.9 4.75L43.25 43.1 41 45.3l-4.75-4.75q-.05.05-.075.025-.025-.025-.075-.025H10.8q-1.35 0-2.375-1T7.4 37.15v-7.7h3.4v7.7h22.05l-7-7-1.85 1.8L13.9 21.9l1.85-1.85L2.7 7zm26.75 14.7l2.45 2.45-3.75 3.8-2.45-2.5zM25.7 7.15V21.1l-3.4-3.45V7.15z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-share">\n      <path d="M36 32.17c-1.52 0-2.89.59-3.93 1.54L17.82 25.4c.11-.45.18-.92.18-1.4s-.07-.95-.18-1.4l14.1-8.23c1.07 1 2.5 1.62 4.08 1.62 3.31 0 6-2.69 6-6s-2.69-6-6-6-6 2.69-6 6c0 .48.07.95.18 1.4l-14.1 8.23c-1.07-1-2.5-1.62-4.08-1.62-3.31 0-6 2.69-6 6s2.69 6 6 6c1.58 0 3.01-.62 4.08-1.62l14.25 8.31c-.1.42-.16.86-.16 1.31A5.83 5.83 0 1 0 36 32.17z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-cog">\n      <path d="M38.86 25.95c.08-.64.14-1.29.14-1.95s-.06-1.31-.14-1.95l4.23-3.31c.38-.3.49-.84.24-1.28l-4-6.93c-.25-.43-.77-.61-1.22-.43l-4.98 2.01c-1.03-.79-2.16-1.46-3.38-1.97L29 4.84c-.09-.47-.5-.84-1-.84h-8c-.5 0-.91.37-.99.84l-.75 5.3a14.8 14.8 0 0 0-3.38 1.97L9.9 10.1a1 1 0 0 0-1.22.43l-4 6.93c-.25.43-.14.97.24 1.28l4.22 3.31C9.06 22.69 9 23.34 9 24s.06 1.31.14 1.95l-4.22 3.31c-.38.3-.49.84-.24 1.28l4 6.93c.25.43.77.61 1.22.43l4.98-2.01c1.03.79 2.16 1.46 3.38 1.97l.75 5.3c.08.47.49.84.99.84h8c.5 0 .91-.37.99-.84l.75-5.3a14.8 14.8 0 0 0 3.38-1.97l4.98 2.01a1 1 0 0 0 1.22-.43l4-6.93c.25-.43.14-.97-.24-1.28l-4.22-3.31zM24 31c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-square">\n      <path d="M36 8H12c-2.21 0-4 1.79-4 4v24c0 2.21 1.79 4 4 4h24c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4zm0 28H12V12h24v24z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-circle">\n      <circle cx="24" cy="24" r="20"></circle>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-circle-outline">\n      <path d="M24 4C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm0 36c-8.82 0-16-7.18-16-16S15.18 8 24 8s16 7.18 16 16-7.18 16-16 16z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-circle-inner-circle">\n      <path d="M24 4C12.97 4 4 12.97 4 24s8.97 20 20 20 20-8.97 20-20S35.03 4 24 4zm0 36c-8.82 0-16-7.18-16-16S15.18 8 24 8s16 7.18 16 16-7.18 16-16 16zm6-16c0 3.31-2.69 6-6 6s-6-2.69-6-6 2.69-6 6-6 6 2.69 6 6z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-cancel">\n      <path d="M24 4C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm10 27.17L31.17 34 24 26.83 16.83 34 14 31.17 21.17 24 14 16.83 16.83 14 24 21.17 31.17 14 34 16.83 26.83 24 34 31.17z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-replay">\n      <path d="M24 10V2L14 12l10 10v-8c6.63 0 12 5.37 12 12s-5.37 12-12 12-12-5.37-12-12H8c0 8.84 7.16 16 16 16s16-7.16 16-16-7.16-16-16-16z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-repeat">\n      <path d="M14 14h20v6l8-8-8-8v6H10v12h4v-8zm20 20H14v-6l-8 8 8 8v-6h24V26h-4v8z"></path>\n    </symbol>\n    <symbol viewBox="0 96 48 48" id="vjs-icon-replay-5">\n      <path d="M17.689 98l-8.697 8.696 8.697 8.697 2.486-2.485-4.32-4.319h1.302c4.93 0 9.071 1.722 12.424 5.165 3.352 3.443 5.029 7.638 5.029 12.584h3.55c0-2.958-.553-5.73-1.658-8.313-1.104-2.583-2.622-4.841-4.555-6.774-1.932-1.932-4.19-3.45-6.773-4.555-2.584-1.104-5.355-1.657-8.313-1.657H15.5l4.615-4.615zm-8.08 21.659v13.861h11.357v5.008H9.609V143h12.7c.834 0 1.55-.298 2.146-.894.596-.597.895-1.31.895-2.145v-7.781c0-.835-.299-1.55-.895-2.147a2.929 2.929 0 0 0-2.147-.894h-8.227v-5.096H25.35v-4.384z"></path>\n    </symbol>\n    <symbol viewBox="0 96 48 48" id="vjs-icon-replay-10">\n      <path d="M42.315 125.63c0-4.997-1.694-9.235-5.08-12.713-3.388-3.479-7.571-5.218-12.552-5.218h-1.315l4.363 4.363-2.51 2.51-8.787-8.786L25.221 97l2.45 2.45-4.662 4.663h1.375c2.988 0 5.788.557 8.397 1.673 2.61 1.116 4.892 2.65 6.844 4.602 1.953 1.953 3.487 4.234 4.602 6.844 1.116 2.61 1.674 5.41 1.674 8.398zM8.183 142v-19.657H3.176V117.8h9.643V142zm13.63 0c-1.156 0-2.127-.393-2.912-1.178-.778-.778-1.168-1.746-1.168-2.902v-16.04c0-1.156.393-2.127 1.178-2.912.779-.779 1.746-1.168 2.902-1.168h7.696c1.156 0 2.126.392 2.911 1.177.779.78 1.168 1.747 1.168 2.903v16.04c0 1.156-.392 2.127-1.177 2.912-.779.779-1.746 1.168-2.902 1.168zm.556-4.636h6.583v-15.02H22.37z"></path>\n    </symbol>\n    <symbol viewBox="0 96 48 48" id="vjs-icon-replay-30">\n      <path d="M26.047 97l-8.733 8.732 8.733 8.733 2.496-2.494-4.336-4.338h1.307c4.95 0 9.108 1.73 12.474 5.187 3.367 3.458 5.051 7.668 5.051 12.635h3.565c0-2.97-.556-5.751-1.665-8.346-1.109-2.594-2.633-4.862-4.574-6.802-1.94-1.941-4.208-3.466-6.803-4.575-2.594-1.109-5.375-1.664-8.345-1.664H23.85l4.634-4.634zM2.555 117.531v4.688h10.297v5.25H5.873v4.687h6.979v5.156H2.555V142H13.36c1.061 0 1.95-.395 2.668-1.186.718-.79 1.076-1.772 1.076-2.94v-16.218c0-1.168-.358-2.149-1.076-2.94-.717-.79-1.607-1.185-2.668-1.185zm22.482.14c-1.149 0-2.11.39-2.885 1.165-.78.78-1.172 1.744-1.172 2.893v15.943c0 1.149.388 2.11 1.163 2.885.78.78 1.745 1.172 2.894 1.172h7.649c1.148 0 2.11-.388 2.884-1.163.78-.78 1.17-1.745 1.17-2.894v-15.943c0-1.15-.386-2.111-1.16-2.885-.78-.78-1.746-1.172-2.894-1.172zm.553 4.518h6.545v14.93H25.59z"></path>\n    </symbol>\n    <symbol viewBox="0 96 48 48" id="vjs-icon-forward-5">\n      <path d="M29.508 97l-2.431 2.43 4.625 4.625h-1.364c-2.965 0-5.742.554-8.332 1.66-2.589 1.107-4.851 2.629-6.788 4.566-1.937 1.937-3.458 4.2-4.565 6.788-1.107 2.59-1.66 5.367-1.66 8.331h3.557c0-4.957 1.68-9.16 5.04-12.611 3.36-3.45 7.51-5.177 12.451-5.177h1.304l-4.326 4.33 2.49 2.49 8.715-8.716zm-9.783 21.61v13.89h11.382v5.018H19.725V142h12.727a2.93 2.93 0 0 0 2.15-.896 2.93 2.93 0 0 0 .896-2.15v-7.798c0-.837-.299-1.554-.896-2.152a2.93 2.93 0 0 0-2.15-.896h-8.245V123h11.29v-4.392z"></path>\n    </symbol>\n    <symbol viewBox="0 96 48 48" id="vjs-icon-forward-10">\n      <path d="M23.119 97l-2.386 2.383 4.538 4.538h-1.339c-2.908 0-5.633.543-8.173 1.63-2.54 1.085-4.76 2.577-6.66 4.478-1.9 1.9-3.392 4.12-4.478 6.66-1.085 2.54-1.629 5.264-1.629 8.172h3.49c0-4.863 1.648-8.986 4.944-12.372 3.297-3.385 7.368-5.078 12.216-5.078h1.279l-4.245 4.247 2.443 2.442 8.55-8.55zm-9.52 21.45v4.42h4.871V142h4.513v-23.55zm18.136 0c-1.125 0-2.066.377-2.824 1.135-.764.764-1.148 1.709-1.148 2.834v15.612c0 1.124.38 2.066 1.139 2.824.764.764 1.708 1.145 2.833 1.145h7.489c1.125 0 2.066-.378 2.824-1.136.764-.764 1.145-1.709 1.145-2.833v-15.612c0-1.125-.378-2.067-1.136-2.825-.764-.764-1.708-1.145-2.833-1.145zm.54 4.42h6.408v14.617h-6.407z"></path>\n    </symbol>\n    <symbol viewBox="0 96 48 48" id="vjs-icon-forward-30">\n      <path d="M25.549 97l-2.437 2.434 4.634 4.635H26.38c-2.97 0-5.753.555-8.347 1.664-2.594 1.109-4.861 2.633-6.802 4.574-1.94 1.94-3.465 4.207-4.574 6.802-1.109 2.594-1.664 5.377-1.664 8.347h3.565c0-4.967 1.683-9.178 5.05-12.636 3.366-3.458 7.525-5.187 12.475-5.187h1.307l-4.335 4.338 2.495 2.494 8.732-8.732zm-11.553 20.53v4.689h10.297v5.249h-6.978v4.688h6.978v5.156H13.996V142h10.808c1.06 0 1.948-.395 2.666-1.186.718-.79 1.077-1.771 1.077-2.94v-16.217c0-1.169-.36-2.15-1.077-2.94-.718-.79-1.605-1.186-2.666-1.186zm21.174.168c-1.149 0-2.11.389-2.884 1.163-.78.78-1.172 1.745-1.172 2.894v15.942c0 1.15.388 2.11 1.162 2.885.78.78 1.745 1.17 2.894 1.17h7.649c1.149 0 2.11-.386 2.885-1.16.78-.78 1.17-1.746 1.17-2.895v-15.942c0-1.15-.387-2.11-1.161-2.885-.78-.78-1.745-1.172-2.894-1.172zm.552 4.516h6.542v14.931h-6.542z"></path>\n    </symbol>\n    <symbol viewBox="0 0 512 512" id="vjs-icon-audio-description">\n      <g fill-rule="evenodd"><path d="M227.29 381.351V162.993c50.38-1.017 89.108-3.028 117.631 17.126 27.374 19.342 48.734 56.965 44.89 105.325-4.067 51.155-41.335 94.139-89.776 98.475-24.085 2.155-71.972 0-71.972 0s-.84-1.352-.773-2.568m48.755-54.804c31.43 1.26 53.208-16.633 56.495-45.386 4.403-38.51-21.188-63.552-58.041-60.796v103.612c-.036 1.466.575 2.22 1.546 2.57"></path><path d="M383.78 381.328c13.336 3.71 17.387-11.06 23.215-21.408 12.722-22.571 22.294-51.594 22.445-84.774.221-47.594-18.343-82.517-35.6-106.182h-8.51c-.587 3.874 2.226 7.315 3.865 10.276 13.166 23.762 25.367 56.553 25.54 94.194.2 43.176-14.162 79.278-30.955 107.894"></path><path d="M425.154 381.328c13.336 3.71 17.384-11.061 23.215-21.408 12.721-22.571 22.291-51.594 22.445-84.774.221-47.594-18.343-82.517-35.6-106.182h-8.511c-.586 3.874 2.226 7.315 3.866 10.276 13.166 23.762 25.367 56.553 25.54 94.194.2 43.176-14.162 79.278-30.955 107.894"></path><path d="M466.26 381.328c13.337 3.71 17.385-11.061 23.216-21.408 12.722-22.571 22.292-51.594 22.445-84.774.221-47.594-18.343-82.517-35.6-106.182h-8.51c-.587 3.874 2.225 7.315 3.865 10.276 13.166 23.762 25.367 56.553 25.54 94.194.2 43.176-14.162 79.278-30.955 107.894M4.477 383.005H72.58l18.573-28.484 64.169-.135s.065 19.413.065 28.62h48.756V160.307h-58.816c-5.653 9.537-140.85 222.697-140.85 222.697zm152.667-145.282v71.158l-40.453-.27 40.453-70.888z"></path></g>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-next-item">\n      <path d="M12 36l17-12-17-12v24zm20-24v24h4V12h-4z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-previous-item">\n      <path d="M12 12h4v24h-4zm7 12l17 12V12z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-shuffle">\n      <path d="M21.17 18.34L10.83 8 8 10.83l10.34 10.34 2.83-2.83zM29 8l4.09 4.09L8 37.17 10.83 40l25.09-25.09L40 19V8H29zm.66 18.83l-2.83 2.83 6.26 6.26L29 40h11V29l-4.09 4.09-6.25-6.26z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-cast">\n      <path d="M42 6H6c-2.21 0-4 1.79-4 4v6h4v-6h36v28H28v4h14c2.21 0 4-1.79 4-4V10c0-2.21-1.79-4-4-4zM2 36v6h6c0-3.31-2.69-6-6-6zm0-8v4c5.52 0 10 4.48 10 10h4c0-7.73-6.27-14-14-14zm0-8v4c9.94 0 18 8.06 18 18h4c0-12.15-9.85-22-22-22z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-picture-in-picture-enter">\n      <path d="M38 22H22v11.99h16V22zm8 16V9.96C46 7.76 44.2 6 42 6H6C3.8 6 2 7.76 2 9.96V38c0 2.2 1.8 4 4 4h36c2.2 0 4-1.8 4-4zm-4 .04H6V9.94h36v28.1z"></path>\n    </symbol>\n    <symbol viewBox="0 0 22 18" id="vjs-icon-picture-in-picture-exit">\n      <path d="M18 4H4v10h14V4zm4 12V1.98C22 .88 21.1 0 20 0H2C.9 0 0 .88 0 1.98V16c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2zm-2 .02H2V1.97h18v14.05z"></path>\n      <path fill="none" d="M-1-3h24v24H-1z"></path>\n    </symbol>\n    <symbol viewBox="0 0 1792 1792" id="vjs-icon-facebook">\n      <path d="M1343 12v264h-157q-86 0-116 36t-30 108v189h293l-39 296h-254v759H734V905H479V609h255V391q0-186 104-288.5T1115 0q147 0 228 12z"></path>\n    </symbol>\n    <symbol viewBox="0 0 1792 1792" id="vjs-icon-linkedin">\n      <path d="M477 625v991H147V625h330zm21-306q1 73-50.5 122T312 490h-2q-82 0-132-49t-50-122q0-74 51.5-122.5T314 148t133 48.5T498 319zm1166 729v568h-329v-530q0-105-40.5-164.5T1168 862q-63 0-105.5 34.5T999 982q-11 30-11 81v553H659q2-399 2-647t-1-296l-1-48h329v144h-2q20-32 41-56t56.5-52 87-43.5T1285 602q171 0 275 113.5t104 332.5z"></path>\n    </symbol>\n    <symbol viewBox="0 0 1792 1792" id="vjs-icon-twitter">\n      <path d="M1684 408q-67 98-162 167 1 14 1 42 0 130-38 259.5T1369.5 1125 1185 1335.5t-258 146-323 54.5q-271 0-496-145 35 4 78 4 225 0 401-138-105-2-188-64.5T285 1033q33 5 61 5 43 0 85-11-112-23-185.5-111.5T172 710v-4q68 38 146 41-66-44-105-115t-39-154q0-88 44-163 121 149 294.5 238.5T884 653q-8-38-8-74 0-134 94.5-228.5T1199 256q140 0 236 102 109-21 205-78-37 115-142 178 93-10 186-50z"></path>\n    </symbol>\n    <symbol viewBox="0 0 1792 1792" id="vjs-icon-tumblr">\n      <path d="M1328 1329l80 237q-23 35-111 66t-177 32q-104 2-190.5-26T787 1564t-95-106-55.5-120-16.5-118V676H452V461q72-26 129-69.5t91-90 58-102 34-99T779 12q1-5 4.5-8.5T791 0h244v424h333v252h-334v518q0 30 6.5 56t22.5 52.5 49.5 41.5 81.5 14q78-2 134-29z"></path>\n    </symbol>\n    <symbol viewBox="0 0 1792 1792" id="vjs-icon-pinterest">\n      <path d="M1664 896q0 209-103 385.5T1281.5 1561 896 1664q-111 0-218-32 59-93 78-164 9-34 54-211 20 39 73 67.5t114 28.5q121 0 216-68.5t147-188.5 52-270q0-114-59.5-214T1180 449t-255-63q-105 0-196 29t-154.5 77-109 110.5-67 129.5T377 866q0 104 40 183t117 111q30 12 38-20 2-7 8-31t8-30q6-23-11-43-51-61-51-151 0-151 104.5-259.5T904 517q151 0 235.5 82t84.5 213q0 170-68.5 289T980 1220q-61 0-98-43.5T859 1072q8-35 26.5-93.5t30-103T927 800q0-50-27-83t-77-33q-62 0-105 57t-43 142q0 73 25 122l-99 418q-17 70-13 177-206-91-333-281T128 896q0-209 103-385.5T510.5 231 896 128t385.5 103T1561 510.5 1664 896z"></path>\n    </symbol>\n  </defs>\n</svg>';class MediaLoader extends Component$1{constructor(e,t,n){if(super(e,merge$1({createEl:!1},t),n),t.playerOptions.sources&&0!==t.playerOptions.sources.length)e.src(t.playerOptions.sources);else for(let r=0,a=t.playerOptions.techOrder;r<a.length;r++){const t=toTitleCase$1(a[r]);let n=Tech.getTech(t);if(t||(n=Component$1.getComponent(t)),n&&n.isSupported()){e.loadTech_(t);break}}}}Component$1.registerComponent("MediaLoader",MediaLoader);class ClickableComponent extends Component$1{constructor(e,t){super(e,t),this.options_.controlText&&this.controlText(this.options_.controlText),this.handleMouseOver_=e=>this.handleMouseOver(e),this.handleMouseOut_=e=>this.handleMouseOut(e),this.handleClick_=e=>this.handleClick(e),this.handleKeyDown_=e=>this.handleKeyDown(e),this.emitTapEvents(),this.enable()}createEl(e="div",t={},n={}){t=Object.assign({className:this.buildCSSClass(),tabIndex:0},t),"button"===e&&log$1.error(`Creating a ClickableComponent with an HTML element of ${e} is not supported; use a Button instead.`),n=Object.assign({role:"button"},n),this.tabIndex_=t.tabIndex;const r=createEl(e,t,n);return this.player_.options_.experimentalSvgIcons||r.appendChild(createEl("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),this.createControlTextEl(r),r}dispose(){this.controlTextEl_=null,super.dispose()}createControlTextEl(e){return this.controlTextEl_=createEl("span",{className:"vjs-control-text"},{"aria-live":"polite"}),e&&e.appendChild(this.controlTextEl_),this.controlText(this.controlText_,e),this.controlTextEl_}controlText(e,t=this.el()){if(void 0===e)return this.controlText_||"Need Text";const n=this.localize(e);this.controlText_=e,textContent(this.controlTextEl_,n),this.nonIconControl||this.player_.options_.noUITitleAttributes||t.setAttribute("title",n)}buildCSSClass(){return`vjs-control vjs-button ${super.buildCSSClass()}`}enable(){this.enabled_||(this.enabled_=!0,this.removeClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","false"),void 0!==this.tabIndex_&&this.el_.setAttribute("tabIndex",this.tabIndex_),this.on(["tap","click"],this.handleClick_),this.on("keydown",this.handleKeyDown_))}disable(){this.enabled_=!1,this.addClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","true"),void 0!==this.tabIndex_&&this.el_.removeAttribute("tabIndex"),this.off("mouseover",this.handleMouseOver_),this.off("mouseout",this.handleMouseOut_),this.off(["tap","click"],this.handleClick_),this.off("keydown",this.handleKeyDown_)}handleLanguagechange(){this.controlText(this.controlText_)}handleClick(e){this.options_.clickHandler&&this.options_.clickHandler.call(this,arguments)}handleKeyDown(e){keycode.isEventKey(e,"Space")||keycode.isEventKey(e,"Enter")?(e.preventDefault(),e.stopPropagation(),this.trigger("click")):super.handleKeyDown(e)}}Component$1.registerComponent("ClickableComponent",ClickableComponent);class PosterImage extends ClickableComponent{constructor(e,t){super(e,t),this.update(),this.update_=e=>this.update(e),e.on("posterchange",this.update_)}dispose(){this.player().off("posterchange",this.update_),super.dispose()}createEl(){return createEl("div",{className:"vjs-poster"})}crossOrigin(e){if(void 0===e)return this.$("img")?this.$("img").crossOrigin:this.player_.tech_&&this.player_.tech_.isReady_?this.player_.crossOrigin():this.player_.options_.crossOrigin||this.player_.options_.crossorigin||null;null===e||"anonymous"===e||"use-credentials"===e?this.$("img")&&(this.$("img").crossOrigin=e):this.player_.log.warn(`crossOrigin must be null,  "anonymous" or "use-credentials", given "${e}"`)}update(e){const t=this.player().poster();this.setSrc(t),t?this.show():this.hide()}setSrc(e){e?(this.$("img")||this.el_.appendChild(createEl("picture",{className:"vjs-poster",tabIndex:-1},{},createEl("img",{loading:"lazy",crossOrigin:this.crossOrigin()},{alt:""}))),this.$("img").src=e):this.el_.textContent=""}handleClick(e){this.player_.controls()&&(this.player_.tech(!0)&&this.player_.tech(!0).focus(),this.player_.paused()?silencePromise(this.player_.play()):this.player_.pause())}}PosterImage.prototype.crossorigin=PosterImage.prototype.crossOrigin,Component$1.registerComponent("PosterImage",PosterImage);const darkGray="#222",lightGray="#ccc",fontMap={monospace:"monospace",sansSerif:"sans-serif",serif:"serif",monospaceSansSerif:'"Andale Mono", "Lucida Console", monospace',monospaceSerif:'"Courier New", monospace',proportionalSansSerif:"sans-serif",proportionalSerif:"serif",casual:'"Comic Sans MS", Impact, fantasy',script:'"Monotype Corsiva", cursive',smallcaps:'"Andale Mono", "Lucida Console", monospace, sans-serif'};function constructColor(e,t){let n;if(4===e.length)n=e[1]+e[1]+e[2]+e[2]+e[3]+e[3];else{if(7!==e.length)throw new Error("Invalid color code provided, "+e+"; must be formatted as e.g. #f0e or #f604e2.");n=e.slice(1)}return"rgba("+parseInt(n.slice(0,2),16)+","+parseInt(n.slice(2,4),16)+","+parseInt(n.slice(4,6),16)+","+t+")"}function tryUpdateStyle(e,t,n){try{e.style[t]=n}catch(e2){return}}function getCSSPositionValue(e){return e?`${e}px`:""}class TextTrackDisplay extends Component$1{constructor(e,t,n){super(e,t,n);const r=e=>{this.updateDisplayOverlay(),this.updateDisplay(e)};e.on("loadstart",(e=>this.toggleDisplay(e))),e.on("texttrackchange",(e=>this.updateDisplay(e))),e.on("loadedmetadata",(e=>{this.updateDisplayOverlay(),this.preselectTrack(e)})),e.ready(bind_(this,(function(){if(e.tech_&&e.tech_.featuresNativeTextTracks)return void this.hide();e.on("fullscreenchange",r),e.on("playerresize",r);const t=window$1$1.screen.orientation||window$1$1,n=window$1$1.screen.orientation?"change":"orientationchange";t.addEventListener(n,r),e.on("dispose",(()=>t.removeEventListener(n,r)));const a=this.options_.playerOptions.tracks||[];for(let e=0;e<a.length;e++)this.player_.addRemoteTextTrack(a[e],!0);this.preselectTrack()})))}preselectTrack(){const e={captions:1,subtitles:1},t=this.player_.textTracks(),n=this.player_.cache_.selectedLanguage;let r,a,i;for(let s=0;s<t.length;s++){const o=t[s];n&&n.enabled&&n.language&&n.language===o.language&&o.kind in e?o.kind===n.kind?i=o:i||(i=o):n&&!n.enabled?(i=null,r=null,a=null):o.default&&("descriptions"!==o.kind||r?o.kind in e&&!a&&(a=o):r=o)}i?i.mode="showing":a?a.mode="showing":r&&(r.mode="showing")}toggleDisplay(){this.player_.tech_&&this.player_.tech_.featuresNativeTextTracks?this.hide():this.show()}createEl(){return super.createEl("div",{className:"vjs-text-track-display"},{translate:"yes","aria-live":"off","aria-atomic":"true"})}clearDisplay(){"function"==typeof window$1$1.WebVTT&&window$1$1.WebVTT.processCues(window$1$1,[],this.el_)}updateDisplay(){const e=this.player_.textTracks(),t=this.options_.allowMultipleShowingTracks;if(this.clearDisplay(),t){const t=[];for(let n=0;n<e.length;++n){const r=e[n];"showing"===r.mode&&t.push(r)}return void this.updateForTrack(t)}let n=null,r=null,a=e.length;for(;a--;){const t=e[a];"showing"===t.mode&&("descriptions"===t.kind?n=t:r=t)}r?("off"!==this.getAttribute("aria-live")&&this.setAttribute("aria-live","off"),this.updateForTrack(r)):n&&("assertive"!==this.getAttribute("aria-live")&&this.setAttribute("aria-live","assertive"),this.updateForTrack(n))}updateDisplayOverlay(){if(!this.player_.videoHeight()||!window$1$1.CSS.supports("inset-inline: 10px"))return;const e=this.player_.currentWidth(),t=this.player_.currentHeight(),n=e/t,r=this.player_.videoWidth()/this.player_.videoHeight();let a=0,i=0;Math.abs(n-r)>.1&&(n>r?a=Math.round((e-t*r)/2):i=Math.round((t-e/r)/2)),tryUpdateStyle(this.el_,"insetInline",getCSSPositionValue(a)),tryUpdateStyle(this.el_,"insetBlock",getCSSPositionValue(i))}updateDisplayState(e){const t=this.player_.textTrackSettings.getValues(),n=e.activeCues;let r=n.length;for(;r--;){const e=n[r];if(!e)continue;const a=e.displayState;if(t.color&&(a.firstChild.style.color=t.color),t.textOpacity&&tryUpdateStyle(a.firstChild,"color",constructColor(t.color||"#fff",t.textOpacity)),t.backgroundColor&&(a.firstChild.style.backgroundColor=t.backgroundColor),t.backgroundOpacity&&tryUpdateStyle(a.firstChild,"backgroundColor",constructColor(t.backgroundColor||"#000",t.backgroundOpacity)),t.windowColor&&(t.windowOpacity?tryUpdateStyle(a,"backgroundColor",constructColor(t.windowColor,t.windowOpacity)):a.style.backgroundColor=t.windowColor),t.edgeStyle&&("dropshadow"===t.edgeStyle?a.firstChild.style.textShadow=`2px 2px 3px ${darkGray}, 2px 2px 4px ${darkGray}, 2px 2px 5px ${darkGray}`:"raised"===t.edgeStyle?a.firstChild.style.textShadow=`1px 1px ${darkGray}, 2px 2px ${darkGray}, 3px 3px ${darkGray}`:"depressed"===t.edgeStyle?a.firstChild.style.textShadow=`1px 1px ${lightGray}, 0 1px ${lightGray}, -1px -1px ${darkGray}, 0 -1px ${darkGray}`:"uniform"===t.edgeStyle&&(a.firstChild.style.textShadow=`0 0 4px ${darkGray}, 0 0 4px ${darkGray}, 0 0 4px ${darkGray}, 0 0 4px ${darkGray}`)),t.fontPercent&&1!==t.fontPercent){const e=window$1$1.parseFloat(a.style.fontSize);a.style.fontSize=e*t.fontPercent+"px",a.style.height="auto",a.style.top="auto"}t.fontFamily&&"default"!==t.fontFamily&&("small-caps"===t.fontFamily?a.firstChild.style.fontVariant="small-caps":a.firstChild.style.fontFamily=fontMap[t.fontFamily])}}updateForTrack(e){if(Array.isArray(e)||(e=[e]),"function"!=typeof window$1$1.WebVTT||e.every((e=>!e.activeCues)))return;const t=[];for(let n=0;n<e.length;++n){const r=e[n];for(let e=0;e<r.activeCues.length;++e)t.push(r.activeCues[e])}window$1$1.WebVTT.processCues(window$1$1,t,this.el_);for(let n=0;n<e.length;++n){const t=e[n];for(let e=0;e<t.activeCues.length;++e){const r=t.activeCues[e].displayState;addClass(r,"vjs-text-track-cue","vjs-text-track-cue-"+(t.language?t.language:n)),t.language&&setAttribute(r,"lang",t.language)}this.player_.textTrackSettings&&this.updateDisplayState(t)}}}Component$1.registerComponent("TextTrackDisplay",TextTrackDisplay);class LoadingSpinner extends Component$1{createEl(){const e=this.player_.isAudio(),t=this.localize(e?"Audio Player":"Video Player"),n=createEl("span",{className:"vjs-control-text",textContent:this.localize("{1} is loading.",[t])}),r=super.createEl("div",{className:"vjs-loading-spinner",dir:"ltr"});return r.appendChild(n),r}handleLanguagechange(){this.$(".vjs-control-text").textContent=this.localize("{1} is loading.",[this.player_.isAudio()?"Audio Player":"Video Player"])}}Component$1.registerComponent("LoadingSpinner",LoadingSpinner);class Button extends ClickableComponent{createEl(e,t={},n={}){const r=createEl("button",t=Object.assign({className:this.buildCSSClass()},t),n=Object.assign({type:"button"},n));return this.player_.options_.experimentalSvgIcons||r.appendChild(createEl("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),this.createControlTextEl(r),r}addChild(e,t={}){const n=this.constructor.name;return log$1.warn(`Adding an actionable (user controllable) child to a Button (${n}) is not supported; use a ClickableComponent instead.`),Component$1.prototype.addChild.call(this,e,t)}enable(){super.enable(),this.el_.removeAttribute("disabled")}disable(){super.disable(),this.el_.setAttribute("disabled","disabled")}handleKeyDown(e){keycode.isEventKey(e,"Space")||keycode.isEventKey(e,"Enter")?e.stopPropagation():super.handleKeyDown(e)}}Component$1.registerComponent("Button",Button);class BigPlayButton extends Button{constructor(e,t){super(e,t),this.mouseused_=!1,this.setIcon("play"),this.on("mousedown",(e=>this.handleMouseDown(e)))}buildCSSClass(){return"vjs-big-play-button"}handleClick(e){const t=this.player_.play();if(this.mouseused_&&"clientX"in e&&"clientY"in e)return silencePromise(t),void(this.player_.tech(!0)&&this.player_.tech(!0).focus());const n=this.player_.getChild("controlBar"),r=n&&n.getChild("playToggle");if(!r)return void this.player_.tech(!0).focus();const a=()=>r.focus();isPromise(t)?t.then(a,(()=>{})):this.setTimeout(a,1)}handleKeyDown(e){this.mouseused_=!1,super.handleKeyDown(e)}handleMouseDown(e){this.mouseused_=!0}}BigPlayButton.prototype.controlText_="Play Video",Component$1.registerComponent("BigPlayButton",BigPlayButton);class CloseButton extends Button{constructor(e,t){super(e,t),this.setIcon("cancel"),this.controlText(t&&t.controlText||this.localize("Close"))}buildCSSClass(){return`vjs-close-button ${super.buildCSSClass()}`}handleClick(e){this.trigger({type:"close",bubbles:!1})}handleKeyDown(e){keycode.isEventKey(e,"Esc")?(e.preventDefault(),e.stopPropagation(),this.trigger("click")):super.handleKeyDown(e)}}Component$1.registerComponent("CloseButton",CloseButton);class PlayToggle extends Button{constructor(e,t={}){super(e,t),t.replay=void 0===t.replay||t.replay,this.setIcon("play"),this.on(e,"play",(e=>this.handlePlay(e))),this.on(e,"pause",(e=>this.handlePause(e))),t.replay&&this.on(e,"ended",(e=>this.handleEnded(e)))}buildCSSClass(){return`vjs-play-control ${super.buildCSSClass()}`}handleClick(e){this.player_.paused()?silencePromise(this.player_.play()):this.player_.pause()}handleSeeked(e){this.removeClass("vjs-ended"),this.player_.paused()?this.handlePause(e):this.handlePlay(e)}handlePlay(e){this.removeClass("vjs-ended","vjs-paused"),this.addClass("vjs-playing"),this.setIcon("pause"),this.controlText("Pause")}handlePause(e){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.setIcon("play"),this.controlText("Play")}handleEnded(e){this.removeClass("vjs-playing"),this.addClass("vjs-ended"),this.setIcon("replay"),this.controlText("Replay"),this.one(this.player_,"seeked",(e=>this.handleSeeked(e)))}}PlayToggle.prototype.controlText_="Play",Component$1.registerComponent("PlayToggle",PlayToggle);class TimeDisplay extends Component$1{constructor(e,t){super(e,t),this.on(e,["timeupdate","ended","seeking"],(e=>this.update(e))),this.updateTextNode_()}createEl(){const e=this.buildCSSClass(),t=super.createEl("div",{className:`${e} vjs-time-control vjs-control`}),n=createEl("span",{className:"vjs-control-text",textContent:`${this.localize(this.labelText_)} `},{role:"presentation"});return t.appendChild(n),this.contentEl_=createEl("span",{className:`${e}-display`},{role:"presentation"}),t.appendChild(this.contentEl_),t}dispose(){this.contentEl_=null,this.textNode_=null,super.dispose()}update(e){(this.player_.options_.enableSmoothSeeking||"seeking"!==e.type)&&this.updateContent(e)}updateTextNode_(e=0){e=formatTime(e),this.formattedTime_!==e&&(this.formattedTime_=e,this.requestNamedAnimationFrame("TimeDisplay#updateTextNode_",(()=>{if(!this.contentEl_)return;let e=this.textNode_;e&&this.contentEl_.firstChild!==e&&(e=null,log$1.warn("TimeDisplay#updateTextnode_: Prevented replacement of text node element since it was no longer a child of this node. Appending a new node instead.")),this.textNode_=document$2.createTextNode(this.formattedTime_),this.textNode_&&(e?this.contentEl_.replaceChild(this.textNode_,e):this.contentEl_.appendChild(this.textNode_))})))}updateContent(e){}}TimeDisplay.prototype.labelText_="Time",TimeDisplay.prototype.controlText_="Time",Component$1.registerComponent("TimeDisplay",TimeDisplay);class CurrentTimeDisplay extends TimeDisplay{buildCSSClass(){return"vjs-current-time"}updateContent(e){let t;t=this.player_.ended()?this.player_.duration():this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime(),this.updateTextNode_(t)}}CurrentTimeDisplay.prototype.labelText_="Current Time",CurrentTimeDisplay.prototype.controlText_="Current Time",Component$1.registerComponent("CurrentTimeDisplay",CurrentTimeDisplay);class DurationDisplay extends TimeDisplay{constructor(e,t){super(e,t);const n=e=>this.updateContent(e);this.on(e,"durationchange",n),this.on(e,"loadstart",n),this.on(e,"loadedmetadata",n)}buildCSSClass(){return"vjs-duration"}updateContent(e){const t=this.player_.duration();this.updateTextNode_(t)}}DurationDisplay.prototype.labelText_="Duration",DurationDisplay.prototype.controlText_="Duration",Component$1.registerComponent("DurationDisplay",DurationDisplay);class TimeDivider extends Component$1{createEl(){const e=super.createEl("div",{className:"vjs-time-control vjs-time-divider"},{"aria-hidden":!0}),t=super.createEl("div"),n=super.createEl("span",{textContent:"/"});return t.appendChild(n),e.appendChild(t),e}}Component$1.registerComponent("TimeDivider",TimeDivider);class RemainingTimeDisplay extends TimeDisplay{constructor(e,t){super(e,t),this.on(e,"durationchange",(e=>this.updateContent(e)))}buildCSSClass(){return"vjs-remaining-time"}createEl(){const e=super.createEl();return!1!==this.options_.displayNegative&&e.insertBefore(createEl("span",{},{"aria-hidden":!0},"-"),this.contentEl_),e}updateContent(e){if("number"!=typeof this.player_.duration())return;let t;t=this.player_.ended()?0:this.player_.remainingTimeDisplay?this.player_.remainingTimeDisplay():this.player_.remainingTime(),this.updateTextNode_(t)}}RemainingTimeDisplay.prototype.labelText_="Remaining Time",RemainingTimeDisplay.prototype.controlText_="Remaining Time",Component$1.registerComponent("RemainingTimeDisplay",RemainingTimeDisplay);class LiveDisplay extends Component$1{constructor(e,t){super(e,t),this.updateShowing(),this.on(this.player(),"durationchange",(e=>this.updateShowing(e)))}createEl(){const e=super.createEl("div",{className:"vjs-live-control vjs-control"});return this.contentEl_=createEl("div",{className:"vjs-live-display"},{"aria-live":"off"}),this.contentEl_.appendChild(createEl("span",{className:"vjs-control-text",textContent:`${this.localize("Stream Type")} `})),this.contentEl_.appendChild(document$2.createTextNode(this.localize("LIVE"))),e.appendChild(this.contentEl_),e}dispose(){this.contentEl_=null,super.dispose()}updateShowing(e){this.player().duration()===1/0?this.show():this.hide()}}Component$1.registerComponent("LiveDisplay",LiveDisplay);class SeekToLive extends Button{constructor(e,t){super(e,t),this.updateLiveEdgeStatus(),this.player_.liveTracker&&(this.updateLiveEdgeStatusHandler_=e=>this.updateLiveEdgeStatus(e),this.on(this.player_.liveTracker,"liveedgechange",this.updateLiveEdgeStatusHandler_))}createEl(){const e=super.createEl("button",{className:"vjs-seek-to-live-control vjs-control"});return this.setIcon("circle",e),this.textEl_=createEl("span",{className:"vjs-seek-to-live-text",textContent:this.localize("LIVE")},{"aria-hidden":"true"}),e.appendChild(this.textEl_),e}updateLiveEdgeStatus(){!this.player_.liveTracker||this.player_.liveTracker.atLiveEdge()?(this.setAttribute("aria-disabled",!0),this.addClass("vjs-at-live-edge"),this.controlText("Seek to live, currently playing live")):(this.setAttribute("aria-disabled",!1),this.removeClass("vjs-at-live-edge"),this.controlText("Seek to live, currently behind live"))}handleClick(){this.player_.liveTracker.seekToLiveEdge()}dispose(){this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.updateLiveEdgeStatusHandler_),this.textEl_=null,super.dispose()}}function clamp(e,t,n){return e=Number(e),Math.min(n,Math.max(t,isNaN(e)?t:e))}SeekToLive.prototype.controlText_="Seek to live, currently playing live",Component$1.registerComponent("SeekToLive",SeekToLive);var Num=Object.freeze({__proto__:null,clamp:clamp});class Slider extends Component$1{constructor(e,t){super(e,t),this.handleMouseDown_=e=>this.handleMouseDown(e),this.handleMouseUp_=e=>this.handleMouseUp(e),this.handleKeyDown_=e=>this.handleKeyDown(e),this.handleClick_=e=>this.handleClick(e),this.handleMouseMove_=e=>this.handleMouseMove(e),this.update_=e=>this.update(e),this.bar=this.getChild(this.options_.barName),this.vertical(!!this.options_.vertical),this.enable()}enabled(){return this.enabled_}enable(){this.enabled()||(this.on("mousedown",this.handleMouseDown_),this.on("touchstart",this.handleMouseDown_),this.on("keydown",this.handleKeyDown_),this.on("click",this.handleClick_),this.on(this.player_,"controlsvisible",this.update),this.playerEvent&&this.on(this.player_,this.playerEvent,this.update),this.removeClass("disabled"),this.setAttribute("tabindex",0),this.enabled_=!0)}disable(){if(!this.enabled())return;const e=this.bar.el_.ownerDocument;this.off("mousedown",this.handleMouseDown_),this.off("touchstart",this.handleMouseDown_),this.off("keydown",this.handleKeyDown_),this.off("click",this.handleClick_),this.off(this.player_,"controlsvisible",this.update_),this.off(e,"mousemove",this.handleMouseMove_),this.off(e,"mouseup",this.handleMouseUp_),this.off(e,"touchmove",this.handleMouseMove_),this.off(e,"touchend",this.handleMouseUp_),this.removeAttribute("tabindex"),this.addClass("disabled"),this.playerEvent&&this.off(this.player_,this.playerEvent,this.update),this.enabled_=!1}createEl(e,t={},n={}){return t.className=t.className+" vjs-slider",t=Object.assign({tabIndex:0},t),n=Object.assign({role:"slider","aria-valuenow":0,"aria-valuemin":0,"aria-valuemax":100},n),super.createEl(e,t,n)}handleMouseDown(e){const t=this.bar.el_.ownerDocument;"mousedown"===e.type&&e.preventDefault(),"touchstart"!==e.type||IS_CHROME||e.preventDefault(),blockTextSelection(),this.addClass("vjs-sliding"),this.trigger("slideractive"),this.on(t,"mousemove",this.handleMouseMove_),this.on(t,"mouseup",this.handleMouseUp_),this.on(t,"touchmove",this.handleMouseMove_),this.on(t,"touchend",this.handleMouseUp_),this.handleMouseMove(e,!0)}handleMouseMove(e){}handleMouseUp(e){const t=this.bar.el_.ownerDocument;unblockTextSelection(),this.removeClass("vjs-sliding"),this.trigger("sliderinactive"),this.off(t,"mousemove",this.handleMouseMove_),this.off(t,"mouseup",this.handleMouseUp_),this.off(t,"touchmove",this.handleMouseMove_),this.off(t,"touchend",this.handleMouseUp_),this.update()}update(){if(!this.el_||!this.bar)return;const e=this.getProgress();return e===this.progress_||(this.progress_=e,this.requestNamedAnimationFrame("Slider#update",(()=>{const t=this.vertical()?"height":"width";this.bar.el().style[t]=(100*e).toFixed(2)+"%"}))),e}getProgress(){return Number(clamp(this.getPercent(),0,1).toFixed(4))}calculateDistance(e){const t=getPointerPosition(this.el_,e);return this.vertical()?t.y:t.x}handleKeyDown(e){keycode.isEventKey(e,"Left")||keycode.isEventKey(e,"Down")?(e.preventDefault(),e.stopPropagation(),this.stepBack()):keycode.isEventKey(e,"Right")||keycode.isEventKey(e,"Up")?(e.preventDefault(),e.stopPropagation(),this.stepForward()):super.handleKeyDown(e)}handleClick(e){e.stopPropagation(),e.preventDefault()}vertical(e){if(void 0===e)return this.vertical_||!1;this.vertical_=!!e,this.vertical_?this.addClass("vjs-slider-vertical"):this.addClass("vjs-slider-horizontal")}}Component$1.registerComponent("Slider",Slider);const percentify=(e,t)=>clamp(e/t*100,0,100).toFixed(2)+"%";class LoadProgressBar extends Component$1{constructor(e,t){super(e,t),this.partEls_=[],this.on(e,"progress",(e=>this.update(e)))}createEl(){const e=super.createEl("div",{className:"vjs-load-progress"}),t=createEl("span",{className:"vjs-control-text"}),n=createEl("span",{textContent:this.localize("Loaded")}),r=document$2.createTextNode(": ");return this.percentageEl_=createEl("span",{className:"vjs-control-text-loaded-percentage",textContent:"0%"}),e.appendChild(t),t.appendChild(n),t.appendChild(r),t.appendChild(this.percentageEl_),e}dispose(){this.partEls_=null,this.percentageEl_=null,super.dispose()}update(e){this.requestNamedAnimationFrame("LoadProgressBar#update",(()=>{const e=this.player_.liveTracker,t=this.player_.buffered(),n=e&&e.isLive()?e.seekableEnd():this.player_.duration(),r=this.player_.bufferedEnd(),a=this.partEls_,i=percentify(r,n);this.percent_!==i&&(this.el_.style.width=i,textContent(this.percentageEl_,i),this.percent_=i);for(let s=0;s<t.length;s++){const e=t.start(s),n=t.end(s);let i=a[s];i||(i=this.el_.appendChild(createEl()),a[s]=i),i.dataset.start===e&&i.dataset.end===n||(i.dataset.start=e,i.dataset.end=n,i.style.left=percentify(e,r),i.style.width=percentify(n-e,r))}for(let s=a.length;s>t.length;s--)this.el_.removeChild(a[s-1]);a.length=t.length}))}}Component$1.registerComponent("LoadProgressBar",LoadProgressBar);class TimeTooltip extends Component$1{constructor(e,t){super(e,t),this.update=throttle(bind_(this,this.update),UPDATE_REFRESH_INTERVAL)}createEl(){return super.createEl("div",{className:"vjs-time-tooltip"},{"aria-hidden":"true"})}update(e,t,n){const r=findPosition(this.el_),a=getBoundingClientRect(this.player_.el()),i=e.width*t;if(!a||!r)return;const s=e.left-a.left+i,o=e.width-i+(a.right-e.right);let l=r.width/2;s<l?l+=l-s:o<l&&(l=o),l<0?l=0:l>r.width&&(l=r.width),l=Math.round(l),this.el_.style.right=`-${l}px`,this.write(n)}write(e){textContent(this.el_,e)}updateTime(e,t,n,r){this.requestNamedAnimationFrame("TimeTooltip#updateTime",(()=>{let a;const i=this.player_.duration();if(this.player_.liveTracker&&this.player_.liveTracker.isLive()){const e=this.player_.liveTracker.liveWindow(),n=e-t*e;a=(n<1?"":"-")+formatTime(n,e)}else a=formatTime(n,i);this.update(e,t,a),r&&r()}))}}Component$1.registerComponent("TimeTooltip",TimeTooltip);class PlayProgressBar extends Component$1{constructor(e,t){super(e,t),this.setIcon("circle"),this.update=throttle(bind_(this,this.update),UPDATE_REFRESH_INTERVAL)}createEl(){return super.createEl("div",{className:"vjs-play-progress vjs-slider-bar"},{"aria-hidden":"true"})}update(e,t){const n=this.getChild("timeTooltip");if(!n)return;const r=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime();n.updateTime(e,t,r)}}PlayProgressBar.prototype.options_={children:[]},IS_IOS||IS_ANDROID||PlayProgressBar.prototype.options_.children.push("timeTooltip"),Component$1.registerComponent("PlayProgressBar",PlayProgressBar);class MouseTimeDisplay extends Component$1{constructor(e,t){super(e,t),this.update=throttle(bind_(this,this.update),UPDATE_REFRESH_INTERVAL)}createEl(){return super.createEl("div",{className:"vjs-mouse-display"})}update(e,t){const n=t*this.player_.duration();this.getChild("timeTooltip").updateTime(e,t,n,(()=>{this.el_.style.left=e.width*t+"px"}))}}MouseTimeDisplay.prototype.options_={children:["timeTooltip"]},Component$1.registerComponent("MouseTimeDisplay",MouseTimeDisplay);const STEP_SECONDS=5,PAGE_KEY_MULTIPLIER=12;class SeekBar extends Slider{constructor(e,t){super(e,t),this.setEventHandlers_()}setEventHandlers_(){this.update_=bind_(this,this.update),this.update=throttle(this.update_,UPDATE_REFRESH_INTERVAL),this.on(this.player_,["ended","durationchange","timeupdate"],this.update),this.player_.liveTracker&&this.on(this.player_.liveTracker,"liveedgechange",this.update),this.updateInterval=null,this.enableIntervalHandler_=e=>this.enableInterval_(e),this.disableIntervalHandler_=e=>this.disableInterval_(e),this.on(this.player_,["playing"],this.enableIntervalHandler_),this.on(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in document$2&&"visibilityState"in document$2&&this.on(document$2,"visibilitychange",this.toggleVisibility_)}toggleVisibility_(e){"hidden"===document$2.visibilityState?(this.cancelNamedAnimationFrame("SeekBar#update"),this.cancelNamedAnimationFrame("Slider#update"),this.disableInterval_(e)):(this.player_.ended()||this.player_.paused()||this.enableInterval_(),this.update())}enableInterval_(){this.updateInterval||(this.updateInterval=this.setInterval(this.update,UPDATE_REFRESH_INTERVAL))}disableInterval_(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&e&&"ended"!==e.type||this.updateInterval&&(this.clearInterval(this.updateInterval),this.updateInterval=null)}createEl(){return super.createEl("div",{className:"vjs-progress-holder"},{"aria-label":this.localize("Progress Bar")})}update(e){if("hidden"===document$2.visibilityState)return;const t=super.update();return this.requestNamedAnimationFrame("SeekBar#update",(()=>{const e=this.player_.ended()?this.player_.duration():this.getCurrentTime_(),n=this.player_.liveTracker;let r=this.player_.duration();n&&n.isLive()&&(r=this.player_.liveTracker.liveCurrentTime()),this.percent_!==t&&(this.el_.setAttribute("aria-valuenow",(100*t).toFixed(2)),this.percent_=t),this.currentTime_===e&&this.duration_===r||(this.el_.setAttribute("aria-valuetext",this.localize("progress bar timing: currentTime={1} duration={2}",[formatTime(e,r),formatTime(r,r)],"{1} of {2}")),this.currentTime_=e,this.duration_=r),this.bar&&this.bar.update(getBoundingClientRect(this.el()),this.getProgress())})),t}userSeek_(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&this.player_.liveTracker.nextSeekedFromUser(),this.player_.currentTime(e)}getCurrentTime_(){return this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime()}getPercent(){const e=this.getCurrentTime_();let t;const n=this.player_.liveTracker;return n&&n.isLive()?(t=(e-n.seekableStart())/n.liveWindow(),n.atLiveEdge()&&(t=1)):t=e/this.player_.duration(),t}handleMouseDown(e){isSingleLeftClick(e)&&(e.stopPropagation(),this.videoWasPlaying=!this.player_.paused(),this.player_.pause(),super.handleMouseDown(e))}handleMouseMove(e,t=!1){if(!isSingleLeftClick(e)||isNaN(this.player_.duration()))return;let n;t||this.player_.scrubbing()||this.player_.scrubbing(!0);const r=this.calculateDistance(e),a=this.player_.liveTracker;if(a&&a.isLive()){if(r>=.99)return void a.seekToLiveEdge();const e=a.seekableStart(),t=a.liveCurrentTime();if(n=e+r*a.liveWindow(),n>=t&&(n=t),n<=e&&(n=e+.1),n===1/0)return}else n=r*this.player_.duration(),n===this.player_.duration()&&(n-=.1);this.userSeek_(n),this.player_.options_.enableSmoothSeeking&&this.update()}enable(){super.enable();const e=this.getChild("mouseTimeDisplay");e&&e.show()}disable(){super.disable();const e=this.getChild("mouseTimeDisplay");e&&e.hide()}handleMouseUp(e){super.handleMouseUp(e),e&&e.stopPropagation(),this.player_.scrubbing(!1),this.player_.trigger({type:"timeupdate",target:this,manuallyTriggered:!0}),this.videoWasPlaying?silencePromise(this.player_.play()):this.update_()}stepForward(){this.userSeek_(this.player_.currentTime()+STEP_SECONDS)}stepBack(){this.userSeek_(this.player_.currentTime()-STEP_SECONDS)}handleAction(e){this.player_.paused()?this.player_.play():this.player_.pause()}handleKeyDown(e){const t=this.player_.liveTracker;if(keycode.isEventKey(e,"Space")||keycode.isEventKey(e,"Enter"))e.preventDefault(),e.stopPropagation(),this.handleAction(e);else if(keycode.isEventKey(e,"Home"))e.preventDefault(),e.stopPropagation(),this.userSeek_(0);else if(keycode.isEventKey(e,"End"))e.preventDefault(),e.stopPropagation(),t&&t.isLive()?this.userSeek_(t.liveCurrentTime()):this.userSeek_(this.player_.duration());else if(/^[0-9]$/.test(keycode(e))){e.preventDefault(),e.stopPropagation();const n=10*(keycode.codes[keycode(e)]-keycode.codes[0])/100;t&&t.isLive()?this.userSeek_(t.seekableStart()+t.liveWindow()*n):this.userSeek_(this.player_.duration()*n)}else keycode.isEventKey(e,"PgDn")?(e.preventDefault(),e.stopPropagation(),this.userSeek_(this.player_.currentTime()-STEP_SECONDS*PAGE_KEY_MULTIPLIER)):keycode.isEventKey(e,"PgUp")?(e.preventDefault(),e.stopPropagation(),this.userSeek_(this.player_.currentTime()+STEP_SECONDS*PAGE_KEY_MULTIPLIER)):super.handleKeyDown(e)}dispose(){this.disableInterval_(),this.off(this.player_,["ended","durationchange","timeupdate"],this.update),this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.update),this.off(this.player_,["playing"],this.enableIntervalHandler_),this.off(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in document$2&&"visibilityState"in document$2&&this.off(document$2,"visibilitychange",this.toggleVisibility_),super.dispose()}}SeekBar.prototype.options_={children:["loadProgressBar","playProgressBar"],barName:"playProgressBar"},IS_IOS||IS_ANDROID||SeekBar.prototype.options_.children.splice(1,0,"mouseTimeDisplay"),Component$1.registerComponent("SeekBar",SeekBar);class ProgressControl extends Component$1{constructor(e,t){super(e,t),this.handleMouseMove=throttle(bind_(this,this.handleMouseMove),UPDATE_REFRESH_INTERVAL),this.throttledHandleMouseSeek=throttle(bind_(this,this.handleMouseSeek),UPDATE_REFRESH_INTERVAL),this.handleMouseUpHandler_=e=>this.handleMouseUp(e),this.handleMouseDownHandler_=e=>this.handleMouseDown(e),this.enable()}createEl(){return super.createEl("div",{className:"vjs-progress-control vjs-control"})}handleMouseMove(e){const t=this.getChild("seekBar");if(!t)return;const n=t.getChild("playProgressBar"),r=t.getChild("mouseTimeDisplay");if(!n&&!r)return;const a=t.el(),i=findPosition(a);let s=getPointerPosition(a,e).x;s=clamp(s,0,1),r&&r.update(i,s),n&&n.update(i,t.getProgress())}handleMouseSeek(e){const t=this.getChild("seekBar");t&&t.handleMouseMove(e)}enabled(){return this.enabled_}disable(){if(this.children().forEach((e=>e.disable&&e.disable())),this.enabled()&&(this.off(["mousedown","touchstart"],this.handleMouseDownHandler_),this.off(this.el_,"mousemove",this.handleMouseMove),this.removeListenersAddedOnMousedownAndTouchstart(),this.addClass("disabled"),this.enabled_=!1,this.player_.scrubbing())){const e=this.getChild("seekBar");this.player_.scrubbing(!1),e.videoWasPlaying&&silencePromise(this.player_.play())}}enable(){this.children().forEach((e=>e.enable&&e.enable())),this.enabled()||(this.on(["mousedown","touchstart"],this.handleMouseDownHandler_),this.on(this.el_,"mousemove",this.handleMouseMove),this.removeClass("disabled"),this.enabled_=!0)}removeListenersAddedOnMousedownAndTouchstart(){const e=this.el_.ownerDocument;this.off(e,"mousemove",this.throttledHandleMouseSeek),this.off(e,"touchmove",this.throttledHandleMouseSeek),this.off(e,"mouseup",this.handleMouseUpHandler_),this.off(e,"touchend",this.handleMouseUpHandler_)}handleMouseDown(e){const t=this.el_.ownerDocument,n=this.getChild("seekBar");n&&n.handleMouseDown(e),this.on(t,"mousemove",this.throttledHandleMouseSeek),this.on(t,"touchmove",this.throttledHandleMouseSeek),this.on(t,"mouseup",this.handleMouseUpHandler_),this.on(t,"touchend",this.handleMouseUpHandler_)}handleMouseUp(e){const t=this.getChild("seekBar");t&&t.handleMouseUp(e),this.removeListenersAddedOnMousedownAndTouchstart()}}ProgressControl.prototype.options_={children:["seekBar"]},Component$1.registerComponent("ProgressControl",ProgressControl);class PictureInPictureToggle extends Button{constructor(e,t){super(e,t),this.setIcon("picture-in-picture-enter"),this.on(e,["enterpictureinpicture","leavepictureinpicture"],(e=>this.handlePictureInPictureChange(e))),this.on(e,["disablepictureinpicturechanged","loadedmetadata"],(e=>this.handlePictureInPictureEnabledChange(e))),this.on(e,["loadedmetadata","audioonlymodechange","audiopostermodechange"],(()=>this.handlePictureInPictureAudioModeChange())),this.disable()}buildCSSClass(){return`vjs-picture-in-picture-control vjs-hidden ${super.buildCSSClass()}`}handlePictureInPictureAudioModeChange(){"audio"===this.player_.currentType().substring(0,5)||this.player_.audioPosterMode()||this.player_.audioOnlyMode()?(this.player_.isInPictureInPicture()&&this.player_.exitPictureInPicture(),this.hide()):this.show()}handlePictureInPictureEnabledChange(){document$2.pictureInPictureEnabled&&!1===this.player_.disablePictureInPicture()||this.player_.options_.enableDocumentPictureInPicture&&"documentPictureInPicture"in window$1$1?this.enable():this.disable()}handlePictureInPictureChange(e){this.player_.isInPictureInPicture()?(this.setIcon("picture-in-picture-exit"),this.controlText("Exit Picture-in-Picture")):(this.setIcon("picture-in-picture-enter"),this.controlText("Picture-in-Picture")),this.handlePictureInPictureEnabledChange()}handleClick(e){this.player_.isInPictureInPicture()?this.player_.exitPictureInPicture():this.player_.requestPictureInPicture()}show(){"function"==typeof document$2.exitPictureInPicture&&super.show()}}PictureInPictureToggle.prototype.controlText_="Picture-in-Picture",Component$1.registerComponent("PictureInPictureToggle",PictureInPictureToggle);class FullscreenToggle extends Button{constructor(e,t){super(e,t),this.setIcon("fullscreen-enter"),this.on(e,"fullscreenchange",(e=>this.handleFullscreenChange(e))),!1===document$2[e.fsApi_.fullscreenEnabled]&&this.disable()}buildCSSClass(){return`vjs-fullscreen-control ${super.buildCSSClass()}`}handleFullscreenChange(e){this.player_.isFullscreen()?(this.controlText("Exit Fullscreen"),this.setIcon("fullscreen-exit")):(this.controlText("Fullscreen"),this.setIcon("fullscreen-enter"))}handleClick(e){this.player_.isFullscreen()?this.player_.exitFullscreen():this.player_.requestFullscreen()}}FullscreenToggle.prototype.controlText_="Fullscreen",Component$1.registerComponent("FullscreenToggle",FullscreenToggle);const checkVolumeSupport=function(e,t){t.tech_&&!t.tech_.featuresVolumeControl&&e.addClass("vjs-hidden"),e.on(t,"loadstart",(function(){t.tech_.featuresVolumeControl?e.removeClass("vjs-hidden"):e.addClass("vjs-hidden")}))};class VolumeLevel extends Component$1{createEl(){const e=super.createEl("div",{className:"vjs-volume-level"});return this.setIcon("circle",e),e.appendChild(super.createEl("span",{className:"vjs-control-text"})),e}}Component$1.registerComponent("VolumeLevel",VolumeLevel);class VolumeLevelTooltip extends Component$1{constructor(e,t){super(e,t),this.update=throttle(bind_(this,this.update),UPDATE_REFRESH_INTERVAL)}createEl(){return super.createEl("div",{className:"vjs-volume-tooltip"},{"aria-hidden":"true"})}update(e,t,n,r){if(!n){const n=getBoundingClientRect(this.el_),r=getBoundingClientRect(this.player_.el()),a=e.width*t;if(!r||!n)return;const i=e.left-r.left+a,s=e.width-a+(r.right-e.right);let o=n.width/2;i<o?o+=o-i:s<o&&(o=s),o<0?o=0:o>n.width&&(o=n.width),this.el_.style.right=`-${o}px`}this.write(`${r}%`)}write(e){textContent(this.el_,e)}updateVolume(e,t,n,r,a){this.requestNamedAnimationFrame("VolumeLevelTooltip#updateVolume",(()=>{this.update(e,t,n,r.toFixed(0)),a&&a()}))}}Component$1.registerComponent("VolumeLevelTooltip",VolumeLevelTooltip);class MouseVolumeLevelDisplay extends Component$1{constructor(e,t){super(e,t),this.update=throttle(bind_(this,this.update),UPDATE_REFRESH_INTERVAL)}createEl(){return super.createEl("div",{className:"vjs-mouse-display"})}update(e,t,n){const r=100*t;this.getChild("volumeLevelTooltip").updateVolume(e,t,n,r,(()=>{n?this.el_.style.bottom=e.height*t+"px":this.el_.style.left=e.width*t+"px"}))}}MouseVolumeLevelDisplay.prototype.options_={children:["volumeLevelTooltip"]},Component$1.registerComponent("MouseVolumeLevelDisplay",MouseVolumeLevelDisplay);class VolumeBar extends Slider{constructor(e,t){super(e,t),this.on("slideractive",(e=>this.updateLastVolume_(e))),this.on(e,"volumechange",(e=>this.updateARIAAttributes(e))),e.ready((()=>this.updateARIAAttributes()))}createEl(){return super.createEl("div",{className:"vjs-volume-bar vjs-slider-bar"},{"aria-label":this.localize("Volume Level"),"aria-live":"polite"})}handleMouseDown(e){isSingleLeftClick(e)&&super.handleMouseDown(e)}handleMouseMove(e){const t=this.getChild("mouseVolumeLevelDisplay");if(t){const n=this.el(),r=getBoundingClientRect(n),a=this.vertical();let i=getPointerPosition(n,e);i=a?i.y:i.x,i=clamp(i,0,1),t.update(r,i,a)}isSingleLeftClick(e)&&(this.checkMuted(),this.player_.volume(this.calculateDistance(e)))}checkMuted(){this.player_.muted()&&this.player_.muted(!1)}getPercent(){return this.player_.muted()?0:this.player_.volume()}stepForward(){this.checkMuted(),this.player_.volume(this.player_.volume()+.1)}stepBack(){this.checkMuted(),this.player_.volume(this.player_.volume()-.1)}updateARIAAttributes(e){const t=this.player_.muted()?0:this.volumeAsPercentage_();this.el_.setAttribute("aria-valuenow",t),this.el_.setAttribute("aria-valuetext",t+"%")}volumeAsPercentage_(){return Math.round(100*this.player_.volume())}updateLastVolume_(){const e=this.player_.volume();this.one("sliderinactive",(()=>{0===this.player_.volume()&&this.player_.lastVolume_(e)}))}}VolumeBar.prototype.options_={children:["volumeLevel"],barName:"volumeLevel"},IS_IOS||IS_ANDROID||VolumeBar.prototype.options_.children.splice(0,0,"mouseVolumeLevelDisplay"),VolumeBar.prototype.playerEvent="volumechange",Component$1.registerComponent("VolumeBar",VolumeBar);class VolumeControl extends Component$1{constructor(e,t={}){t.vertical=t.vertical||!1,(void 0===t.volumeBar||isPlain(t.volumeBar))&&(t.volumeBar=t.volumeBar||{},t.volumeBar.vertical=t.vertical),super(e,t),checkVolumeSupport(this,e),this.throttledHandleMouseMove=throttle(bind_(this,this.handleMouseMove),UPDATE_REFRESH_INTERVAL),this.handleMouseUpHandler_=e=>this.handleMouseUp(e),this.on("mousedown",(e=>this.handleMouseDown(e))),this.on("touchstart",(e=>this.handleMouseDown(e))),this.on("mousemove",(e=>this.handleMouseMove(e))),this.on(this.volumeBar,["focus","slideractive"],(()=>{this.volumeBar.addClass("vjs-slider-active"),this.addClass("vjs-slider-active"),this.trigger("slideractive")})),this.on(this.volumeBar,["blur","sliderinactive"],(()=>{this.volumeBar.removeClass("vjs-slider-active"),this.removeClass("vjs-slider-active"),this.trigger("sliderinactive")}))}createEl(){let e="vjs-volume-horizontal";return this.options_.vertical&&(e="vjs-volume-vertical"),super.createEl("div",{className:`vjs-volume-control vjs-control ${e}`})}handleMouseDown(e){const t=this.el_.ownerDocument;this.on(t,"mousemove",this.throttledHandleMouseMove),this.on(t,"touchmove",this.throttledHandleMouseMove),this.on(t,"mouseup",this.handleMouseUpHandler_),this.on(t,"touchend",this.handleMouseUpHandler_)}handleMouseUp(e){const t=this.el_.ownerDocument;this.off(t,"mousemove",this.throttledHandleMouseMove),this.off(t,"touchmove",this.throttledHandleMouseMove),this.off(t,"mouseup",this.handleMouseUpHandler_),this.off(t,"touchend",this.handleMouseUpHandler_)}handleMouseMove(e){this.volumeBar.handleMouseMove(e)}}VolumeControl.prototype.options_={children:["volumeBar"]},Component$1.registerComponent("VolumeControl",VolumeControl);const checkMuteSupport=function(e,t){t.tech_&&!t.tech_.featuresMuteControl&&e.addClass("vjs-hidden"),e.on(t,"loadstart",(function(){t.tech_.featuresMuteControl?e.removeClass("vjs-hidden"):e.addClass("vjs-hidden")}))};class MuteToggle extends Button{constructor(e,t){super(e,t),checkMuteSupport(this,e),this.on(e,["loadstart","volumechange"],(e=>this.update(e)))}buildCSSClass(){return`vjs-mute-control ${super.buildCSSClass()}`}handleClick(e){const t=this.player_.volume(),n=this.player_.lastVolume_();if(0===t){const e=n<.1?.1:n;this.player_.volume(e),this.player_.muted(!1)}else this.player_.muted(!this.player_.muted())}update(e){this.updateIcon_(),this.updateControlText_()}updateIcon_(){const e=this.player_.volume();let t=3;this.setIcon("volume-high"),IS_IOS&&this.player_.tech_&&this.player_.tech_.el_&&this.player_.muted(this.player_.tech_.el_.muted),0===e||this.player_.muted()?(this.setIcon("volume-mute"),t=0):e<.33?(this.setIcon("volume-low"),t=1):e<.67&&(this.setIcon("volume-medium"),t=2),removeClass(this.el_,[0,1,2,3].reduce(((e,t)=>e+`${t?" ":""}vjs-vol-${t}`),"")),addClass(this.el_,`vjs-vol-${t}`)}updateControlText_(){const e=this.player_.muted()||0===this.player_.volume()?"Unmute":"Mute";this.controlText()!==e&&this.controlText(e)}}MuteToggle.prototype.controlText_="Mute",Component$1.registerComponent("MuteToggle",MuteToggle);class VolumePanel extends Component$1{constructor(e,t={}){void 0!==t.inline?t.inline=t.inline:t.inline=!0,(void 0===t.volumeControl||isPlain(t.volumeControl))&&(t.volumeControl=t.volumeControl||{},t.volumeControl.vertical=!t.inline),super(e,t),this.handleKeyPressHandler_=e=>this.handleKeyPress(e),this.on(e,["loadstart"],(e=>this.volumePanelState_(e))),this.on(this.muteToggle,"keyup",(e=>this.handleKeyPress(e))),this.on(this.volumeControl,"keyup",(e=>this.handleVolumeControlKeyUp(e))),this.on("keydown",(e=>this.handleKeyPress(e))),this.on("mouseover",(e=>this.handleMouseOver(e))),this.on("mouseout",(e=>this.handleMouseOut(e))),this.on(this.volumeControl,["slideractive"],this.sliderActive_),this.on(this.volumeControl,["sliderinactive"],this.sliderInactive_)}sliderActive_(){this.addClass("vjs-slider-active")}sliderInactive_(){this.removeClass("vjs-slider-active")}volumePanelState_(){this.volumeControl.hasClass("vjs-hidden")&&this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-hidden"),this.volumeControl.hasClass("vjs-hidden")&&!this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-mute-toggle-only")}createEl(){let e="vjs-volume-panel-horizontal";return this.options_.inline||(e="vjs-volume-panel-vertical"),super.createEl("div",{className:`vjs-volume-panel vjs-control ${e}`})}dispose(){this.handleMouseOut(),super.dispose()}handleVolumeControlKeyUp(e){keycode.isEventKey(e,"Esc")&&this.muteToggle.focus()}handleMouseOver(e){this.addClass("vjs-hover"),on(document$2,"keyup",this.handleKeyPressHandler_)}handleMouseOut(e){this.removeClass("vjs-hover"),off(document$2,"keyup",this.handleKeyPressHandler_)}handleKeyPress(e){keycode.isEventKey(e,"Esc")&&this.handleMouseOut()}}VolumePanel.prototype.options_={children:["muteToggle","volumeControl"]},Component$1.registerComponent("VolumePanel",VolumePanel);class SkipForward extends Button{constructor(e,t){super(e,t),this.validOptions=[5,10,30],this.skipTime=this.getSkipForwardTime(),this.skipTime&&this.validOptions.includes(this.skipTime)?(this.setIcon(`forward-${this.skipTime}`),this.controlText(this.localize("Skip forward {1} seconds",[this.skipTime])),this.show()):this.hide()}getSkipForwardTime(){const e=this.options_.playerOptions;return e.controlBar&&e.controlBar.skipButtons&&e.controlBar.skipButtons.forward}buildCSSClass(){return`vjs-skip-forward-${this.getSkipForwardTime()} ${super.buildCSSClass()}`}handleClick(e){if(isNaN(this.player_.duration()))return;const t=this.player_.currentTime(),n=this.player_.liveTracker,r=n&&n.isLive()?n.seekableEnd():this.player_.duration();let a;a=t+this.skipTime<=r?t+this.skipTime:r,this.player_.currentTime(a)}handleLanguagechange(){this.controlText(this.localize("Skip forward {1} seconds",[this.skipTime]))}}SkipForward.prototype.controlText_="Skip Forward",Component$1.registerComponent("SkipForward",SkipForward);class SkipBackward extends Button{constructor(e,t){super(e,t),this.validOptions=[5,10,30],this.skipTime=this.getSkipBackwardTime(),this.skipTime&&this.validOptions.includes(this.skipTime)?(this.setIcon(`replay-${this.skipTime}`),this.controlText(this.localize("Skip backward {1} seconds",[this.skipTime])),this.show()):this.hide()}getSkipBackwardTime(){const e=this.options_.playerOptions;return e.controlBar&&e.controlBar.skipButtons&&e.controlBar.skipButtons.backward}buildCSSClass(){return`vjs-skip-backward-${this.getSkipBackwardTime()} ${super.buildCSSClass()}`}handleClick(e){const t=this.player_.currentTime(),n=this.player_.liveTracker,r=n&&n.isLive()&&n.seekableStart();let a;a=r&&t-this.skipTime<=r?r:t>=this.skipTime?t-this.skipTime:0,this.player_.currentTime(a)}handleLanguagechange(){this.controlText(this.localize("Skip backward {1} seconds",[this.skipTime]))}}SkipBackward.prototype.controlText_="Skip Backward",Component$1.registerComponent("SkipBackward",SkipBackward);class Menu extends Component$1{constructor(e,t){super(e,t),t&&(this.menuButton_=t.menuButton),this.focusedChild_=-1,this.on("keydown",(e=>this.handleKeyDown(e))),this.boundHandleBlur_=e=>this.handleBlur(e),this.boundHandleTapClick_=e=>this.handleTapClick(e)}addEventListenerForItem(e){e instanceof Component$1&&(this.on(e,"blur",this.boundHandleBlur_),this.on(e,["tap","click"],this.boundHandleTapClick_))}removeEventListenerForItem(e){e instanceof Component$1&&(this.off(e,"blur",this.boundHandleBlur_),this.off(e,["tap","click"],this.boundHandleTapClick_))}removeChild(e){"string"==typeof e&&(e=this.getChild(e)),this.removeEventListenerForItem(e),super.removeChild(e)}addItem(e){const t=this.addChild(e);t&&this.addEventListenerForItem(t)}createEl(){const e=this.options_.contentElType||"ul";this.contentEl_=createEl(e,{className:"vjs-menu-content"}),this.contentEl_.setAttribute("role","menu");const t=super.createEl("div",{append:this.contentEl_,className:"vjs-menu"});return t.appendChild(this.contentEl_),on(t,"click",(function(e){e.preventDefault(),e.stopImmediatePropagation()})),t}dispose(){this.contentEl_=null,this.boundHandleBlur_=null,this.boundHandleTapClick_=null,super.dispose()}handleBlur(e){const t=e.relatedTarget||document$2.activeElement;if(!this.children().some((e=>e.el()===t))){const e=this.menuButton_;e&&e.buttonPressed_&&t!==e.el().firstChild&&e.unpressButton()}}handleTapClick(e){if(this.menuButton_){this.menuButton_.unpressButton();const t=this.children();if(!Array.isArray(t))return;const n=t.filter((t=>t.el()===e.target))[0];if(!n)return;"CaptionSettingsMenuItem"!==n.name()&&this.menuButton_.focus()}}handleKeyDown(e){keycode.isEventKey(e,"Left")||keycode.isEventKey(e,"Down")?(e.preventDefault(),e.stopPropagation(),this.stepForward()):(keycode.isEventKey(e,"Right")||keycode.isEventKey(e,"Up"))&&(e.preventDefault(),e.stopPropagation(),this.stepBack())}stepForward(){let e=0;void 0!==this.focusedChild_&&(e=this.focusedChild_+1),this.focus(e)}stepBack(){let e=0;void 0!==this.focusedChild_&&(e=this.focusedChild_-1),this.focus(e)}focus(e=0){const t=this.children().slice();t.length&&t[0].hasClass("vjs-menu-title")&&t.shift(),t.length>0&&(e<0?e=0:e>=t.length&&(e=t.length-1),this.focusedChild_=e,t[e].el_.focus())}}Component$1.registerComponent("Menu",Menu);class MenuButton extends Component$1{constructor(e,t={}){super(e,t),this.menuButton_=new Button(e,t),this.menuButton_.controlText(this.controlText_),this.menuButton_.el_.setAttribute("aria-haspopup","true");const n=Button.prototype.buildCSSClass();this.menuButton_.el_.className=this.buildCSSClass()+" "+n,this.menuButton_.removeClass("vjs-control"),this.addChild(this.menuButton_),this.update(),this.enabled_=!0;const r=e=>this.handleClick(e);this.handleMenuKeyUp_=e=>this.handleMenuKeyUp(e),this.on(this.menuButton_,"tap",r),this.on(this.menuButton_,"click",r),this.on(this.menuButton_,"keydown",(e=>this.handleKeyDown(e))),this.on(this.menuButton_,"mouseenter",(()=>{this.addClass("vjs-hover"),this.menu.show(),on(document$2,"keyup",this.handleMenuKeyUp_)})),this.on("mouseleave",(e=>this.handleMouseLeave(e))),this.on("keydown",(e=>this.handleSubmenuKeyDown(e)))}update(){const e=this.createMenu();this.menu&&(this.menu.dispose(),this.removeChild(this.menu)),this.menu=e,this.addChild(e),this.buttonPressed_=!1,this.menuButton_.el_.setAttribute("aria-expanded","false"),this.items&&this.items.length<=this.hideThreshold_?(this.hide(),this.menu.contentEl_.removeAttribute("role")):(this.show(),this.menu.contentEl_.setAttribute("role","menu"))}createMenu(){const e=new Menu(this.player_,{menuButton:this});if(this.hideThreshold_=0,this.options_.title){const t=createEl("li",{className:"vjs-menu-title",textContent:toTitleCase$1(this.options_.title),tabIndex:-1}),n=new Component$1(this.player_,{el:t});e.addItem(n)}if(this.items=this.createItems(),this.items)for(let t=0;t<this.items.length;t++)e.addItem(this.items[t]);return e}createItems(){}createEl(){return super.createEl("div",{className:this.buildWrapperCSSClass()},{})}setIcon(e){super.setIcon(e,this.menuButton_.el_)}buildWrapperCSSClass(){let e="vjs-menu-button";!0===this.options_.inline?e+="-inline":e+="-popup";return`vjs-menu-button ${e} ${Button.prototype.buildCSSClass()} ${super.buildCSSClass()}`}buildCSSClass(){let e="vjs-menu-button";return!0===this.options_.inline?e+="-inline":e+="-popup",`vjs-menu-button ${e} ${super.buildCSSClass()}`}controlText(e,t=this.menuButton_.el()){return this.menuButton_.controlText(e,t)}dispose(){this.handleMouseLeave(),super.dispose()}handleClick(e){this.buttonPressed_?this.unpressButton():this.pressButton()}handleMouseLeave(e){this.removeClass("vjs-hover"),off(document$2,"keyup",this.handleMenuKeyUp_)}focus(){this.menuButton_.focus()}blur(){this.menuButton_.blur()}handleKeyDown(e){keycode.isEventKey(e,"Esc")||keycode.isEventKey(e,"Tab")?(this.buttonPressed_&&this.unpressButton(),keycode.isEventKey(e,"Tab")||(e.preventDefault(),this.menuButton_.focus())):(keycode.isEventKey(e,"Up")||keycode.isEventKey(e,"Down"))&&(this.buttonPressed_||(e.preventDefault(),this.pressButton()))}handleMenuKeyUp(e){(keycode.isEventKey(e,"Esc")||keycode.isEventKey(e,"Tab"))&&this.removeClass("vjs-hover")}handleSubmenuKeyPress(e){this.handleSubmenuKeyDown(e)}handleSubmenuKeyDown(e){(keycode.isEventKey(e,"Esc")||keycode.isEventKey(e,"Tab"))&&(this.buttonPressed_&&this.unpressButton(),keycode.isEventKey(e,"Tab")||(e.preventDefault(),this.menuButton_.focus()))}pressButton(){if(this.enabled_){if(this.buttonPressed_=!0,this.menu.show(),this.menu.lockShowing(),this.menuButton_.el_.setAttribute("aria-expanded","true"),IS_IOS&&isInFrame())return;this.menu.focus()}}unpressButton(){this.enabled_&&(this.buttonPressed_=!1,this.menu.unlockShowing(),this.menu.hide(),this.menuButton_.el_.setAttribute("aria-expanded","false"))}disable(){this.unpressButton(),this.enabled_=!1,this.addClass("vjs-disabled"),this.menuButton_.disable()}enable(){this.enabled_=!0,this.removeClass("vjs-disabled"),this.menuButton_.enable()}}Component$1.registerComponent("MenuButton",MenuButton);class TrackButton extends MenuButton{constructor(e,t){const n=t.tracks;if(super(e,t),this.items.length<=1&&this.hide(),!n)return;const r=bind_(this,this.update);n.addEventListener("removetrack",r),n.addEventListener("addtrack",r),n.addEventListener("labelchange",r),this.player_.on("ready",r),this.player_.on("dispose",(function(){n.removeEventListener("removetrack",r),n.removeEventListener("addtrack",r),n.removeEventListener("labelchange",r)}))}}Component$1.registerComponent("TrackButton",TrackButton);const MenuKeys=["Tab","Esc","Up","Down","Right","Left"];class MenuItem extends ClickableComponent{constructor(e,t){super(e,t),this.selectable=t.selectable,this.isSelected_=t.selected||!1,this.multiSelectable=t.multiSelectable,this.selected(this.isSelected_),this.selectable?this.multiSelectable?this.el_.setAttribute("role","menuitemcheckbox"):this.el_.setAttribute("role","menuitemradio"):this.el_.setAttribute("role","menuitem")}createEl(e,t,n){this.nonIconControl=!0;const r=super.createEl("li",Object.assign({className:"vjs-menu-item",tabIndex:-1},t),n),a=createEl("span",{className:"vjs-menu-item-text",textContent:this.localize(this.options_.label)});return this.player_.options_.experimentalSvgIcons?r.appendChild(a):r.replaceChild(a,r.querySelector(".vjs-icon-placeholder")),r}handleKeyDown(e){MenuKeys.some((t=>keycode.isEventKey(e,t)))||super.handleKeyDown(e)}handleClick(e){this.selected(!0)}selected(e){this.selectable&&(e?(this.addClass("vjs-selected"),this.el_.setAttribute("aria-checked","true"),this.controlText(", selected"),this.isSelected_=!0):(this.removeClass("vjs-selected"),this.el_.setAttribute("aria-checked","false"),this.controlText(""),this.isSelected_=!1))}}Component$1.registerComponent("MenuItem",MenuItem);class TextTrackMenuItem extends MenuItem{constructor(e,t){const n=t.track,r=e.textTracks();t.label=n.label||n.language||"Unknown",t.selected="showing"===n.mode,super(e,t),this.track=n,this.kinds=(t.kinds||[t.kind||this.track.kind]).filter(Boolean);const a=(...e)=>{this.handleTracksChange.apply(this,e)},i=(...e)=>{this.handleSelectedLanguageChange.apply(this,e)};if(e.on(["loadstart","texttrackchange"],a),r.addEventListener("change",a),r.addEventListener("selectedlanguagechange",i),this.on("dispose",(function(){e.off(["loadstart","texttrackchange"],a),r.removeEventListener("change",a),r.removeEventListener("selectedlanguagechange",i)})),void 0===r.onchange){let e;this.on(["tap","click"],(function(){if("object"!=typeof window$1$1.Event)try{e=new window$1$1.Event("change")}catch(err){}e||(e=document$2.createEvent("Event"),e.initEvent("change",!0,!0)),r.dispatchEvent(e)}))}this.handleTracksChange()}handleClick(e){const t=this.track,n=this.player_.textTracks();if(super.handleClick(e),n)for(let r=0;r<n.length;r++){const e=n[r];-1!==this.kinds.indexOf(e.kind)&&(e===t?"showing"!==e.mode&&(e.mode="showing"):"disabled"!==e.mode&&(e.mode="disabled"))}}handleTracksChange(e){const t="showing"===this.track.mode;t!==this.isSelected_&&this.selected(t)}handleSelectedLanguageChange(e){if("showing"===this.track.mode){const e=this.player_.cache_.selectedLanguage;if(e&&e.enabled&&e.language===this.track.language&&e.kind!==this.track.kind)return;this.player_.cache_.selectedLanguage={enabled:!0,language:this.track.language,kind:this.track.kind}}}dispose(){this.track=null,super.dispose()}}Component$1.registerComponent("TextTrackMenuItem",TextTrackMenuItem);class OffTextTrackMenuItem extends TextTrackMenuItem{constructor(e,t){t.track={player:e,kind:t.kind,kinds:t.kinds,default:!1,mode:"disabled"},t.kinds||(t.kinds=[t.kind]),t.label?t.track.label=t.label:t.track.label=t.kinds.join(" and ")+" off",t.selectable=!0,t.multiSelectable=!1,super(e,t)}handleTracksChange(e){const t=this.player().textTracks();let n=!0;for(let r=0,a=t.length;r<a;r++){const e=t[r];if(this.options_.kinds.indexOf(e.kind)>-1&&"showing"===e.mode){n=!1;break}}n!==this.isSelected_&&this.selected(n)}handleSelectedLanguageChange(e){const t=this.player().textTracks();let n=!0;for(let r=0,a=t.length;r<a;r++){const e=t[r];if(["captions","descriptions","subtitles"].indexOf(e.kind)>-1&&"showing"===e.mode){n=!1;break}}n&&(this.player_.cache_.selectedLanguage={enabled:!1})}handleLanguagechange(){this.$(".vjs-menu-item-text").textContent=this.player_.localize(this.options_.label),super.handleLanguagechange()}}Component$1.registerComponent("OffTextTrackMenuItem",OffTextTrackMenuItem);class TextTrackButton extends TrackButton{constructor(e,t={}){t.tracks=e.textTracks(),super(e,t)}createItems(e=[],t=TextTrackMenuItem){let n;this.label_&&(n=`${this.label_} off`),e.push(new OffTextTrackMenuItem(this.player_,{kinds:this.kinds_,kind:this.kind_,label:n})),this.hideThreshold_+=1;const r=this.player_.textTracks();Array.isArray(this.kinds_)||(this.kinds_=[this.kind_]);for(let a=0;a<r.length;a++){const n=r[a];if(this.kinds_.indexOf(n.kind)>-1){const r=new t(this.player_,{track:n,kinds:this.kinds_,kind:this.kind_,selectable:!0,multiSelectable:!1});r.addClass(`vjs-${n.kind}-menu-item`),e.push(r)}}return e}}Component$1.registerComponent("TextTrackButton",TextTrackButton);class ChaptersTrackMenuItem extends MenuItem{constructor(e,t){const n=t.track,r=t.cue,a=e.currentTime();t.selectable=!0,t.multiSelectable=!1,t.label=r.text,t.selected=r.startTime<=a&&a<r.endTime,super(e,t),this.track=n,this.cue=r}handleClick(e){super.handleClick(),this.player_.currentTime(this.cue.startTime)}}Component$1.registerComponent("ChaptersTrackMenuItem",ChaptersTrackMenuItem);class ChaptersButton extends TextTrackButton{constructor(e,t,n){super(e,t,n),this.setIcon("chapters"),this.selectCurrentItem_=()=>{this.items.forEach((e=>{e.selected(this.track_.activeCues[0]===e.cue)}))}}buildCSSClass(){return`vjs-chapters-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-chapters-button ${super.buildWrapperCSSClass()}`}update(e){if(e&&e.track&&"chapters"!==e.track.kind)return;const t=this.findChaptersTrack();t!==this.track_?(this.setTrack(t),super.update()):(!this.items||t&&t.cues&&t.cues.length!==this.items.length)&&super.update()}setTrack(e){if(this.track_!==e){if(this.updateHandler_||(this.updateHandler_=this.update.bind(this)),this.track_){const e=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);e&&e.removeEventListener("load",this.updateHandler_),this.track_.removeEventListener("cuechange",this.selectCurrentItem_),this.track_=null}if(this.track_=e,this.track_){this.track_.mode="hidden";const e=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);e&&e.addEventListener("load",this.updateHandler_),this.track_.addEventListener("cuechange",this.selectCurrentItem_)}}}findChaptersTrack(){const e=this.player_.textTracks()||[];for(let t=e.length-1;t>=0;t--){const n=e[t];if(n.kind===this.kind_)return n}}getMenuCaption(){return this.track_&&this.track_.label?this.track_.label:this.localize(toTitleCase$1(this.kind_))}createMenu(){return this.options_.title=this.getMenuCaption(),super.createMenu()}createItems(){const e=[];if(!this.track_)return e;const t=this.track_.cues;if(!t)return e;for(let n=0,r=t.length;n<r;n++){const r=t[n],a=new ChaptersTrackMenuItem(this.player_,{track:this.track_,cue:r});e.push(a)}return e}}ChaptersButton.prototype.kind_="chapters",ChaptersButton.prototype.controlText_="Chapters",Component$1.registerComponent("ChaptersButton",ChaptersButton);class DescriptionsButton extends TextTrackButton{constructor(e,t,n){super(e,t,n),this.setIcon("audio-description");const r=e.textTracks(),a=bind_(this,this.handleTracksChange);r.addEventListener("change",a),this.on("dispose",(function(){r.removeEventListener("change",a)}))}handleTracksChange(e){const t=this.player().textTracks();let n=!1;for(let r=0,a=t.length;r<a;r++){const e=t[r];if(e.kind!==this.kind_&&"showing"===e.mode){n=!0;break}}n?this.disable():this.enable()}buildCSSClass(){return`vjs-descriptions-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-descriptions-button ${super.buildWrapperCSSClass()}`}}DescriptionsButton.prototype.kind_="descriptions",DescriptionsButton.prototype.controlText_="Descriptions",Component$1.registerComponent("DescriptionsButton",DescriptionsButton);class SubtitlesButton extends TextTrackButton{constructor(e,t,n){super(e,t,n),this.setIcon("subtitles")}buildCSSClass(){return`vjs-subtitles-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-subtitles-button ${super.buildWrapperCSSClass()}`}}SubtitlesButton.prototype.kind_="subtitles",SubtitlesButton.prototype.controlText_="Subtitles",Component$1.registerComponent("SubtitlesButton",SubtitlesButton);class CaptionSettingsMenuItem extends TextTrackMenuItem{constructor(e,t){t.track={player:e,kind:t.kind,label:t.kind+" settings",selectable:!1,default:!1,mode:"disabled"},t.selectable=!1,t.name="CaptionSettingsMenuItem",super(e,t),this.addClass("vjs-texttrack-settings"),this.controlText(", opens "+t.kind+" settings dialog")}handleClick(e){this.player().getChild("textTrackSettings").open()}handleLanguagechange(){this.$(".vjs-menu-item-text").textContent=this.player_.localize(this.options_.kind+" settings"),super.handleLanguagechange()}}Component$1.registerComponent("CaptionSettingsMenuItem",CaptionSettingsMenuItem);class CaptionsButton extends TextTrackButton{constructor(e,t,n){super(e,t,n),this.setIcon("captions")}buildCSSClass(){return`vjs-captions-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-captions-button ${super.buildWrapperCSSClass()}`}createItems(){const e=[];return this.player().tech_&&this.player().tech_.featuresNativeTextTracks||!this.player().getChild("textTrackSettings")||(e.push(new CaptionSettingsMenuItem(this.player_,{kind:this.kind_})),this.hideThreshold_+=1),super.createItems(e)}}CaptionsButton.prototype.kind_="captions",CaptionsButton.prototype.controlText_="Captions",Component$1.registerComponent("CaptionsButton",CaptionsButton);class SubsCapsMenuItem extends TextTrackMenuItem{createEl(e,t,n){const r=super.createEl(e,t,n),a=r.querySelector(".vjs-menu-item-text");return"captions"===this.options_.track.kind&&(this.player_.options_.experimentalSvgIcons?this.setIcon("captions",r):a.appendChild(createEl("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),a.appendChild(createEl("span",{className:"vjs-control-text",textContent:` ${this.localize("Captions")}`}))),r}}Component$1.registerComponent("SubsCapsMenuItem",SubsCapsMenuItem);class SubsCapsButton extends TextTrackButton{constructor(e,t={}){super(e,t),this.label_="subtitles",this.setIcon("subtitles"),["en","en-us","en-ca","fr-ca"].indexOf(this.player_.language_)>-1&&(this.label_="captions",this.setIcon("captions")),this.menuButton_.controlText(toTitleCase$1(this.label_))}buildCSSClass(){return`vjs-subs-caps-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-subs-caps-button ${super.buildWrapperCSSClass()}`}createItems(){let e=[];return this.player().tech_&&this.player().tech_.featuresNativeTextTracks||!this.player().getChild("textTrackSettings")||(e.push(new CaptionSettingsMenuItem(this.player_,{kind:this.label_})),this.hideThreshold_+=1),e=super.createItems(e,SubsCapsMenuItem),e}}SubsCapsButton.prototype.kinds_=["captions","subtitles"],SubsCapsButton.prototype.controlText_="Subtitles",Component$1.registerComponent("SubsCapsButton",SubsCapsButton);class AudioTrackMenuItem extends MenuItem{constructor(e,t){const n=t.track,r=e.audioTracks();t.label=n.label||n.language||"Unknown",t.selected=n.enabled,super(e,t),this.track=n,this.addClass(`vjs-${n.kind}-menu-item`);const a=(...e)=>{this.handleTracksChange.apply(this,e)};r.addEventListener("change",a),this.on("dispose",(()=>{r.removeEventListener("change",a)}))}createEl(e,t,n){const r=super.createEl(e,t,n),a=r.querySelector(".vjs-menu-item-text");return["main-desc","description"].indexOf(this.options_.track.kind)>=0&&(a.appendChild(createEl("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),a.appendChild(createEl("span",{className:"vjs-control-text",textContent:" "+this.localize("Descriptions")}))),r}handleClick(e){if(super.handleClick(e),this.track.enabled=!0,this.player_.tech_.featuresNativeAudioTracks){const e=this.player_.audioTracks();for(let t=0;t<e.length;t++){const n=e[t];n!==this.track&&(n.enabled=n===this.track)}}}handleTracksChange(e){this.selected(this.track.enabled)}}Component$1.registerComponent("AudioTrackMenuItem",AudioTrackMenuItem);class AudioTrackButton extends TrackButton{constructor(e,t={}){t.tracks=e.audioTracks(),super(e,t),this.setIcon("audio")}buildCSSClass(){return`vjs-audio-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-audio-button ${super.buildWrapperCSSClass()}`}createItems(e=[]){this.hideThreshold_=1;const t=this.player_.audioTracks();for(let n=0;n<t.length;n++){const r=t[n];e.push(new AudioTrackMenuItem(this.player_,{track:r,selectable:!0,multiSelectable:!1}))}return e}}AudioTrackButton.prototype.controlText_="Audio Track",Component$1.registerComponent("AudioTrackButton",AudioTrackButton);class PlaybackRateMenuItem extends MenuItem{constructor(e,t){const n=t.rate,r=parseFloat(n,10);t.label=n,t.selected=r===e.playbackRate(),t.selectable=!0,t.multiSelectable=!1,super(e,t),this.label=n,this.rate=r,this.on(e,"ratechange",(e=>this.update(e)))}handleClick(e){super.handleClick(),this.player().playbackRate(this.rate)}update(e){this.selected(this.player().playbackRate()===this.rate)}}PlaybackRateMenuItem.prototype.contentElType="button",Component$1.registerComponent("PlaybackRateMenuItem",PlaybackRateMenuItem);class PlaybackRateMenuButton extends MenuButton{constructor(e,t){super(e,t),this.menuButton_.el_.setAttribute("aria-describedby",this.labelElId_),this.updateVisibility(),this.updateLabel(),this.on(e,"loadstart",(e=>this.updateVisibility(e))),this.on(e,"ratechange",(e=>this.updateLabel(e))),this.on(e,"playbackrateschange",(e=>this.handlePlaybackRateschange(e)))}createEl(){const e=super.createEl();return this.labelElId_="vjs-playback-rate-value-label-"+this.id_,this.labelEl_=createEl("div",{className:"vjs-playback-rate-value",id:this.labelElId_,textContent:"1x"}),e.appendChild(this.labelEl_),e}dispose(){this.labelEl_=null,super.dispose()}buildCSSClass(){return`vjs-playback-rate ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-playback-rate ${super.buildWrapperCSSClass()}`}createItems(){const e=this.playbackRates(),t=[];for(let n=e.length-1;n>=0;n--)t.push(new PlaybackRateMenuItem(this.player(),{rate:e[n]+"x"}));return t}handlePlaybackRateschange(e){this.update()}playbackRates(){const e=this.player();return e.playbackRates&&e.playbackRates()||[]}playbackRateSupported(){return this.player().tech_&&this.player().tech_.featuresPlaybackRate&&this.playbackRates()&&this.playbackRates().length>0}updateVisibility(e){this.playbackRateSupported()?this.removeClass("vjs-hidden"):this.addClass("vjs-hidden")}updateLabel(e){this.playbackRateSupported()&&(this.labelEl_.textContent=this.player().playbackRate()+"x")}}PlaybackRateMenuButton.prototype.controlText_="Playback Rate",Component$1.registerComponent("PlaybackRateMenuButton",PlaybackRateMenuButton);class Spacer extends Component$1{buildCSSClass(){return`vjs-spacer ${super.buildCSSClass()}`}createEl(e="div",t={},n={}){return t.className||(t.className=this.buildCSSClass()),super.createEl(e,t,n)}}Component$1.registerComponent("Spacer",Spacer);class CustomControlSpacer extends Spacer{buildCSSClass(){return`vjs-custom-control-spacer ${super.buildCSSClass()}`}createEl(){return super.createEl("div",{className:this.buildCSSClass(),textContent:" "})}}Component$1.registerComponent("CustomControlSpacer",CustomControlSpacer);class ControlBar extends Component$1{createEl(){return super.createEl("div",{className:"vjs-control-bar",dir:"ltr"})}}ControlBar.prototype.options_={children:["playToggle","skipBackward","skipForward","volumePanel","currentTimeDisplay","timeDivider","durationDisplay","progressControl","liveDisplay","seekToLive","remainingTimeDisplay","customControlSpacer","playbackRateMenuButton","chaptersButton","descriptionsButton","subsCapsButton","audioTrackButton","pictureInPictureToggle","fullscreenToggle"]},Component$1.registerComponent("ControlBar",ControlBar);class ErrorDisplay extends ModalDialog{constructor(e,t){super(e,t),this.on(e,"error",(e=>{this.close(),this.open(e)}))}buildCSSClass(){return`vjs-error-display ${super.buildCSSClass()}`}content(){const e=this.player().error();return e?this.localize(e.message):""}}ErrorDisplay.prototype.options_=Object.assign({},ModalDialog.prototype.options_,{pauseOnOpen:!1,fillAlways:!0,temporary:!1,uncloseable:!0}),Component$1.registerComponent("ErrorDisplay",ErrorDisplay);const LOCAL_STORAGE_KEY$1="vjs-text-track-settings",COLOR_BLACK=["#000","Black"],COLOR_BLUE=["#00F","Blue"],COLOR_CYAN=["#0FF","Cyan"],COLOR_GREEN=["#0F0","Green"],COLOR_MAGENTA=["#F0F","Magenta"],COLOR_RED=["#F00","Red"],COLOR_WHITE=["#FFF","White"],COLOR_YELLOW=["#FF0","Yellow"],OPACITY_OPAQUE=["1","Opaque"],OPACITY_SEMI=["0.5","Semi-Transparent"],OPACITY_TRANS=["0","Transparent"],selectConfigs={backgroundColor:{selector:".vjs-bg-color > select",id:"captions-background-color-%s",label:"Color",options:[COLOR_BLACK,COLOR_WHITE,COLOR_RED,COLOR_GREEN,COLOR_BLUE,COLOR_YELLOW,COLOR_MAGENTA,COLOR_CYAN]},backgroundOpacity:{selector:".vjs-bg-opacity > select",id:"captions-background-opacity-%s",label:"Opacity",options:[OPACITY_OPAQUE,OPACITY_SEMI,OPACITY_TRANS]},color:{selector:".vjs-text-color > select",id:"captions-foreground-color-%s",label:"Color",options:[COLOR_WHITE,COLOR_BLACK,COLOR_RED,COLOR_GREEN,COLOR_BLUE,COLOR_YELLOW,COLOR_MAGENTA,COLOR_CYAN]},edgeStyle:{selector:".vjs-edge-style > select",id:"%s",label:"Text Edge Style",options:[["none","None"],["raised","Raised"],["depressed","Depressed"],["uniform","Uniform"],["dropshadow","Drop shadow"]]},fontFamily:{selector:".vjs-font-family > select",id:"captions-font-family-%s",label:"Font Family",options:[["proportionalSansSerif","Proportional Sans-Serif"],["monospaceSansSerif","Monospace Sans-Serif"],["proportionalSerif","Proportional Serif"],["monospaceSerif","Monospace Serif"],["casual","Casual"],["script","Script"],["small-caps","Small Caps"]]},fontPercent:{selector:".vjs-font-percent > select",id:"captions-font-size-%s",label:"Font Size",options:[["0.50","50%"],["0.75","75%"],["1.00","100%"],["1.25","125%"],["1.50","150%"],["1.75","175%"],["2.00","200%"],["3.00","300%"],["4.00","400%"]],default:2,parser:e=>"1.00"===e?null:Number(e)},textOpacity:{selector:".vjs-text-opacity > select",id:"captions-foreground-opacity-%s",label:"Opacity",options:[OPACITY_OPAQUE,OPACITY_SEMI]},windowColor:{selector:".vjs-window-color > select",id:"captions-window-color-%s",label:"Color"},windowOpacity:{selector:".vjs-window-opacity > select",id:"captions-window-opacity-%s",label:"Opacity",options:[OPACITY_TRANS,OPACITY_SEMI,OPACITY_OPAQUE]}};function parseOptionValue(e,t){if(t&&(e=t(e)),e&&"none"!==e)return e}function getSelectedOptionValue(e,t){return parseOptionValue(e.options[e.options.selectedIndex].value,t)}function setSelectedOption(e,t,n){if(t)for(let r=0;r<e.options.length;r++)if(parseOptionValue(e.options[r].value,n)===t){e.selectedIndex=r;break}}selectConfigs.windowColor.options=selectConfigs.backgroundColor.options;class TextTrackSettings extends ModalDialog{constructor(e,t){t.temporary=!1,super(e,t),this.updateDisplay=this.updateDisplay.bind(this),this.fill(),this.hasBeenOpened_=this.hasBeenFilled_=!0,this.endDialog=createEl("p",{className:"vjs-control-text",textContent:this.localize("End of dialog window.")}),this.el().appendChild(this.endDialog),this.setDefaults(),void 0===t.persistTextTrackSettings&&(this.options_.persistTextTrackSettings=this.options_.playerOptions.persistTextTrackSettings),this.on(this.$(".vjs-done-button"),"click",(()=>{this.saveSettings(),this.close()})),this.on(this.$(".vjs-default-button"),"click",(()=>{this.setDefaults(),this.updateDisplay()})),each(selectConfigs,(e=>{this.on(this.$(e.selector),"change",this.updateDisplay)})),this.options_.persistTextTrackSettings&&this.restoreSettings()}dispose(){this.endDialog=null,super.dispose()}createElSelect_(e,t="",n="label"){const r=selectConfigs[e],a=r.id.replace("%s",this.id_),i=[t,a].join(" ").trim(),s=`vjs_select_${newGUID()}`;return[`<${n} id="${a}"${"label"===n?` for="${s}" class="vjs-label"`:""}>`,this.localize(r.label),`</${n}>`,`<select aria-labelledby="${i}" id="${s}">`].concat(r.options.map((e=>{const t=a+"-"+e[1].replace(/\W+/g,"");return[`<option id="${t}" value="${e[0]}" `,`aria-labelledby="${i} ${t}">`,this.localize(e[1]),"</option>"].join("")}))).concat("</select>").join("")}createElFgColor_(){const e=`captions-text-legend-${this.id_}`;return['<fieldset class="vjs-fg vjs-track-setting">',`<legend id="${e}">`,this.localize("Text"),"</legend>",'<span class="vjs-text-color">',this.createElSelect_("color",e),"</span>",'<span class="vjs-text-opacity vjs-opacity">',this.createElSelect_("textOpacity",e),"</span>","</fieldset>"].join("")}createElBgColor_(){const e=`captions-background-${this.id_}`;return['<fieldset class="vjs-bg vjs-track-setting">',`<legend id="${e}">`,this.localize("Text Background"),"</legend>",'<span class="vjs-bg-color">',this.createElSelect_("backgroundColor",e),"</span>",'<span class="vjs-bg-opacity vjs-opacity">',this.createElSelect_("backgroundOpacity",e),"</span>","</fieldset>"].join("")}createElWinColor_(){const e=`captions-window-${this.id_}`;return['<fieldset class="vjs-window vjs-track-setting">',`<legend id="${e}">`,this.localize("Caption Area Background"),"</legend>",'<span class="vjs-window-color">',this.createElSelect_("windowColor",e),"</span>",'<span class="vjs-window-opacity vjs-opacity">',this.createElSelect_("windowOpacity",e),"</span>","</fieldset>"].join("")}createElColors_(){return createEl("div",{className:"vjs-track-settings-colors",innerHTML:[this.createElFgColor_(),this.createElBgColor_(),this.createElWinColor_()].join("")})}createElFont_(){return createEl("div",{className:"vjs-track-settings-font",innerHTML:['<fieldset class="vjs-font-percent vjs-track-setting">',this.createElSelect_("fontPercent","","legend"),"</fieldset>",'<fieldset class="vjs-edge-style vjs-track-setting">',this.createElSelect_("edgeStyle","","legend"),"</fieldset>",'<fieldset class="vjs-font-family vjs-track-setting">',this.createElSelect_("fontFamily","","legend"),"</fieldset>"].join("")})}createElControls_(){const e=this.localize("restore all settings to the default values");return createEl("div",{className:"vjs-track-settings-controls",innerHTML:[`<button type="button" class="vjs-default-button" title="${e}">`,this.localize("Reset"),`<span class="vjs-control-text"> ${e}</span>`,"</button>",`<button type="button" class="vjs-done-button">${this.localize("Done")}</button>`].join("")})}content(){return[this.createElColors_(),this.createElFont_(),this.createElControls_()]}label(){return this.localize("Caption Settings Dialog")}description(){return this.localize("Beginning of dialog window. Escape will cancel and close the window.")}buildCSSClass(){return super.buildCSSClass()+" vjs-text-track-settings"}getValues(){return reduce(selectConfigs,((e,t,n)=>{const r=getSelectedOptionValue(this.$(t.selector),t.parser);return void 0!==r&&(e[n]=r),e}),{})}setValues(e){each(selectConfigs,((t,n)=>{setSelectedOption(this.$(t.selector),e[n],t.parser)}))}setDefaults(){each(selectConfigs,(e=>{const t=e.hasOwnProperty("default")?e.default:0;this.$(e.selector).selectedIndex=t}))}restoreSettings(){let e;try{e=JSON.parse(window$1$1.localStorage.getItem(LOCAL_STORAGE_KEY$1))}catch(err){log$1.warn(err)}e&&this.setValues(e)}saveSettings(){if(!this.options_.persistTextTrackSettings)return;const e=this.getValues();try{Object.keys(e).length?window$1$1.localStorage.setItem(LOCAL_STORAGE_KEY$1,JSON.stringify(e)):window$1$1.localStorage.removeItem(LOCAL_STORAGE_KEY$1)}catch(err){log$1.warn(err)}}updateDisplay(){const e=this.player_.getChild("textTrackDisplay");e&&e.updateDisplay()}conditionalBlur_(){this.previouslyActiveEl_=null;const e=this.player_.controlBar,t=e&&e.subsCapsButton,n=e&&e.captionsButton;t?t.focus():n&&n.focus()}handleLanguagechange(){this.fill()}}Component$1.registerComponent("TextTrackSettings",TextTrackSettings);class ResizeManager extends Component$1{constructor(e,t){let n=t.ResizeObserver||window$1$1.ResizeObserver;null===t.ResizeObserver&&(n=!1);super(e,merge$1({createEl:!n,reportTouchActivity:!1},t)),this.ResizeObserver=t.ResizeObserver||window$1$1.ResizeObserver,this.loadListener_=null,this.resizeObserver_=null,this.debouncedHandler_=debounce((()=>{this.resizeHandler()}),100,!1,this),n?(this.resizeObserver_=new this.ResizeObserver(this.debouncedHandler_),this.resizeObserver_.observe(e.el())):(this.loadListener_=()=>{if(!this.el_||!this.el_.contentWindow)return;const e=this.debouncedHandler_;let t=this.unloadListener_=function(){off(this,"resize",e),off(this,"unload",t),t=null};on(this.el_.contentWindow,"unload",t),on(this.el_.contentWindow,"resize",e)},this.one("load",this.loadListener_))}createEl(){return super.createEl("iframe",{className:"vjs-resize-manager",tabIndex:-1,title:this.localize("No content")},{"aria-hidden":"true"})}resizeHandler(){this.player_&&this.player_.trigger&&this.player_.trigger("playerresize")}dispose(){this.debouncedHandler_&&this.debouncedHandler_.cancel(),this.resizeObserver_&&(this.player_.el()&&this.resizeObserver_.unobserve(this.player_.el()),this.resizeObserver_.disconnect()),this.loadListener_&&this.off("load",this.loadListener_),this.el_&&this.el_.contentWindow&&this.unloadListener_&&this.unloadListener_.call(this.el_.contentWindow),this.ResizeObserver=null,this.resizeObserver=null,this.debouncedHandler_=null,this.loadListener_=null,super.dispose()}}Component$1.registerComponent("ResizeManager",ResizeManager);const defaults={trackingThreshold:20,liveTolerance:15};class LiveTracker extends Component$1{constructor(e,t){super(e,merge$1(defaults,t,{createEl:!1})),this.trackLiveHandler_=()=>this.trackLive_(),this.handlePlay_=e=>this.handlePlay(e),this.handleFirstTimeupdate_=e=>this.handleFirstTimeupdate(e),this.handleSeeked_=e=>this.handleSeeked(e),this.seekToLiveEdge_=e=>this.seekToLiveEdge(e),this.reset_(),this.on(this.player_,"durationchange",(e=>this.handleDurationchange(e))),this.on(this.player_,"canplay",(()=>this.toggleTracking()))}trackLive_(){const e=this.player_.seekable();if(!e||!e.length)return;const t=Number(window$1$1.performance.now().toFixed(4)),n=-1===this.lastTime_?0:(t-this.lastTime_)/1e3;this.lastTime_=t,this.pastSeekEnd_=this.pastSeekEnd()+n;const r=this.liveCurrentTime(),a=this.player_.currentTime();let i=this.player_.paused()||this.seekedBehindLive_||Math.abs(r-a)>this.options_.liveTolerance;this.timeupdateSeen_&&r!==1/0||(i=!1),i!==this.behindLiveEdge_&&(this.behindLiveEdge_=i,this.trigger("liveedgechange"))}handleDurationchange(){this.toggleTracking()}toggleTracking(){this.player_.duration()===1/0&&this.liveWindow()>=this.options_.trackingThreshold?(this.player_.options_.liveui&&this.player_.addClass("vjs-liveui"),this.startTracking()):(this.player_.removeClass("vjs-liveui"),this.stopTracking())}startTracking(){this.isTracking()||(this.timeupdateSeen_||(this.timeupdateSeen_=this.player_.hasStarted()),this.trackingInterval_=this.setInterval(this.trackLiveHandler_,UPDATE_REFRESH_INTERVAL),this.trackLive_(),this.on(this.player_,["play","pause"],this.trackLiveHandler_),this.timeupdateSeen_?this.on(this.player_,"seeked",this.handleSeeked_):(this.one(this.player_,"play",this.handlePlay_),this.one(this.player_,"timeupdate",this.handleFirstTimeupdate_)))}handleFirstTimeupdate(){this.timeupdateSeen_=!0,this.on(this.player_,"seeked",this.handleSeeked_)}handleSeeked(){const e=Math.abs(this.liveCurrentTime()-this.player_.currentTime());this.seekedBehindLive_=this.nextSeekedFromUser_&&e>2,this.nextSeekedFromUser_=!1,this.trackLive_()}handlePlay(){this.one(this.player_,"timeupdate",this.seekToLiveEdge_)}reset_(){this.lastTime_=-1,this.pastSeekEnd_=0,this.lastSeekEnd_=-1,this.behindLiveEdge_=!0,this.timeupdateSeen_=!1,this.seekedBehindLive_=!1,this.nextSeekedFromUser_=!1,this.clearInterval(this.trackingInterval_),this.trackingInterval_=null,this.off(this.player_,["play","pause"],this.trackLiveHandler_),this.off(this.player_,"seeked",this.handleSeeked_),this.off(this.player_,"play",this.handlePlay_),this.off(this.player_,"timeupdate",this.handleFirstTimeupdate_),this.off(this.player_,"timeupdate",this.seekToLiveEdge_)}nextSeekedFromUser(){this.nextSeekedFromUser_=!0}stopTracking(){this.isTracking()&&(this.reset_(),this.trigger("liveedgechange"))}seekableEnd(){const e=this.player_.seekable(),t=[];let n=e?e.length:0;for(;n--;)t.push(e.end(n));return t.length?t.sort()[t.length-1]:1/0}seekableStart(){const e=this.player_.seekable(),t=[];let n=e?e.length:0;for(;n--;)t.push(e.start(n));return t.length?t.sort()[0]:0}liveWindow(){const e=this.liveCurrentTime();return e===1/0?0:e-this.seekableStart()}isLive(){return this.isTracking()}atLiveEdge(){return!this.behindLiveEdge()}liveCurrentTime(){return this.pastSeekEnd()+this.seekableEnd()}pastSeekEnd(){const e=this.seekableEnd();return-1!==this.lastSeekEnd_&&e!==this.lastSeekEnd_&&(this.pastSeekEnd_=0),this.lastSeekEnd_=e,this.pastSeekEnd_}behindLiveEdge(){return this.behindLiveEdge_}isTracking(){return"number"==typeof this.trackingInterval_}seekToLiveEdge(){this.seekedBehindLive_=!1,this.atLiveEdge()||(this.nextSeekedFromUser_=!1,this.player_.currentTime(this.liveCurrentTime()))}dispose(){this.stopTracking(),super.dispose()}}Component$1.registerComponent("LiveTracker",LiveTracker);class TitleBar extends Component$1{constructor(e,t){super(e,t),this.on("statechanged",(e=>this.updateDom_())),this.updateDom_()}createEl(){return this.els={title:createEl("div",{className:"vjs-title-bar-title",id:`vjs-title-bar-title-${newGUID()}`}),description:createEl("div",{className:"vjs-title-bar-description",id:`vjs-title-bar-description-${newGUID()}`})},createEl("div",{className:"vjs-title-bar"},{},values(this.els))}updateDom_(){const e=this.player_.tech_,t=e&&e.el_,n={title:"aria-labelledby",description:"aria-describedby"};["title","description"].forEach((e=>{const r=this.state[e],a=this.els[e],i=n[e];emptyEl(a),r&&textContent(a,r),t&&(t.removeAttribute(i),r&&t.setAttribute(i,a.id))})),this.state.title||this.state.description?this.show():this.hide()}update(e){this.setState(e)}dispose(){const e=this.player_.tech_,t=e&&e.el_;t&&(t.removeAttribute("aria-labelledby"),t.removeAttribute("aria-describedby")),super.dispose(),this.els=null}}Component$1.registerComponent("TitleBar",TitleBar);const sourcesetLoad=e=>{const t=e.el();if(t.hasAttribute("src"))return e.triggerSourceset(t.src),!0;const n=e.$$("source"),r=[];let a="";if(!n.length)return!1;for(let i=0;i<n.length;i++){const e=n[i].src;e&&-1===r.indexOf(e)&&r.push(e)}return!!r.length&&(1===r.length&&(a=r[0]),e.triggerSourceset(a),!0)},innerHTMLDescriptorPolyfill=Object.defineProperty({},"innerHTML",{get(){return this.cloneNode(!0).innerHTML},set(e){const t=document$2.createElement(this.nodeName.toLowerCase());t.innerHTML=e;const n=document$2.createDocumentFragment();for(;t.childNodes.length;)n.appendChild(t.childNodes[0]);return this.innerText="",window$1$1.Element.prototype.appendChild.call(this,n),this.innerHTML}}),getDescriptor=(e,t)=>{let n={};for(let r=0;r<e.length&&(n=Object.getOwnPropertyDescriptor(e[r],t),!(n&&n.set&&n.get));r++);return n.enumerable=!0,n.configurable=!0,n},getInnerHTMLDescriptor=e=>getDescriptor([e.el(),window$1$1.HTMLMediaElement.prototype,window$1$1.Element.prototype,innerHTMLDescriptorPolyfill],"innerHTML"),firstSourceWatch=function(e){const t=e.el();if(t.resetSourceWatch_)return;const n={},r=getInnerHTMLDescriptor(e),a=n=>(...r)=>{const a=n.apply(t,r);return sourcesetLoad(e),a};["append","appendChild","insertAdjacentHTML"].forEach((e=>{t[e]&&(n[e]=t[e],t[e]=a(n[e]))})),Object.defineProperty(t,"innerHTML",merge$1(r,{set:a(r.set)})),t.resetSourceWatch_=()=>{t.resetSourceWatch_=null,Object.keys(n).forEach((e=>{t[e]=n[e]})),Object.defineProperty(t,"innerHTML",r)},e.one("sourceset",t.resetSourceWatch_)},srcDescriptorPolyfill=Object.defineProperty({},"src",{get(){return this.hasAttribute("src")?getAbsoluteURL(window$1$1.Element.prototype.getAttribute.call(this,"src")):""},set(e){return window$1$1.Element.prototype.setAttribute.call(this,"src",e),e}}),getSrcDescriptor=e=>getDescriptor([e.el(),window$1$1.HTMLMediaElement.prototype,srcDescriptorPolyfill],"src"),setupSourceset=function(e){if(!e.featuresSourceset)return;const t=e.el();if(t.resetSourceset_)return;const n=getSrcDescriptor(e),r=t.setAttribute,a=t.load;Object.defineProperty(t,"src",merge$1(n,{set:r=>{const a=n.set.call(t,r);return e.triggerSourceset(t.src),a}})),t.setAttribute=(n,a)=>{const i=r.call(t,n,a);return/src/i.test(n)&&e.triggerSourceset(t.src),i},t.load=()=>{const n=a.call(t);return sourcesetLoad(e)||(e.triggerSourceset(""),firstSourceWatch(e)),n},t.currentSrc?e.triggerSourceset(t.currentSrc):sourcesetLoad(e)||firstSourceWatch(e),t.resetSourceset_=()=>{t.resetSourceset_=null,t.load=a,t.setAttribute=r,Object.defineProperty(t,"src",n),t.resetSourceWatch_&&t.resetSourceWatch_()}};class Html5 extends Tech{constructor(e,t){super(e,t);const n=e.source;let r=!1;if(this.featuresVideoFrameCallback=this.featuresVideoFrameCallback&&"VIDEO"===this.el_.tagName,n&&(this.el_.currentSrc!==n.src||e.tag&&3===e.tag.initNetworkState_)?this.setSource(n):this.handleLateInit_(this.el_),e.enableSourceset&&this.setupSourcesetHandling_(),this.isScrubbing_=!1,this.el_.hasChildNodes()){const e=this.el_.childNodes;let t=e.length;const n=[];for(;t--;){const a=e[t];"track"===a.nodeName.toLowerCase()&&(this.featuresNativeTextTracks?(this.remoteTextTrackEls().addTrackElement_(a),this.remoteTextTracks().addTrack(a.track),this.textTracks().addTrack(a.track),r||this.el_.hasAttribute("crossorigin")||!isCrossOrigin(a.src)||(r=!0)):n.push(a))}for(let r=0;r<n.length;r++)this.el_.removeChild(n[r])}this.proxyNativeTracks_(),this.featuresNativeTextTracks&&r&&log$1.warn("Text Tracks are being loaded from another origin but the crossorigin attribute isn't used.\nThis may prevent text tracks from loading."),this.restoreMetadataTracksInIOSNativePlayer_(),(TOUCH_ENABLED||IS_IPHONE)&&!0===e.nativeControlsForTouch&&this.setControls(!0),this.proxyWebkitFullscreen_(),this.triggerReady()}dispose(){this.el_&&this.el_.resetSourceset_&&this.el_.resetSourceset_(),Html5.disposeMediaElement(this.el_),this.options_=null,super.dispose()}setupSourcesetHandling_(){setupSourceset(this)}restoreMetadataTracksInIOSNativePlayer_(){const e=this.textTracks();let t;const n=()=>{t=[];for(let n=0;n<e.length;n++){const r=e[n];"metadata"===r.kind&&t.push({track:r,storedMode:r.mode})}};n(),e.addEventListener("change",n),this.on("dispose",(()=>e.removeEventListener("change",n)));const r=()=>{for(let e=0;e<t.length;e++){const n=t[e];"disabled"===n.track.mode&&n.track.mode!==n.storedMode&&(n.track.mode=n.storedMode)}e.removeEventListener("change",r)};this.on("webkitbeginfullscreen",(()=>{e.removeEventListener("change",n),e.removeEventListener("change",r),e.addEventListener("change",r)})),this.on("webkitendfullscreen",(()=>{e.removeEventListener("change",n),e.addEventListener("change",n),e.removeEventListener("change",r)}))}overrideNative_(e,t){if(t!==this[`featuresNative${e}Tracks`])return;const n=e.toLowerCase();this[`${n}TracksListeners_`]&&Object.keys(this[`${n}TracksListeners_`]).forEach((e=>{this.el()[`${n}Tracks`].removeEventListener(e,this[`${n}TracksListeners_`][e])})),this[`featuresNative${e}Tracks`]=!t,this[`${n}TracksListeners_`]=null,this.proxyNativeTracksForType_(n)}overrideNativeAudioTracks(e){this.overrideNative_("Audio",e)}overrideNativeVideoTracks(e){this.overrideNative_("Video",e)}proxyNativeTracksForType_(e){const t=NORMAL[e],n=this.el()[t.getterName],r=this[t.getterName]();if(!this[`featuresNative${t.capitalName}Tracks`]||!n||!n.addEventListener)return;const a={change:t=>{const n={type:"change",target:r,currentTarget:r,srcElement:r};r.trigger(n),"text"===e&&this[REMOTE.remoteText.getterName]().trigger(n)},addtrack(e){r.addTrack(e.track)},removetrack(e){r.removeTrack(e.track)}},i=function(){const e=[];for(let t=0;t<r.length;t++){let a=!1;for(let e=0;e<n.length;e++)if(n[e]===r[t]){a=!0;break}a||e.push(r[t])}for(;e.length;)r.removeTrack(e.shift())};this[t.getterName+"Listeners_"]=a,Object.keys(a).forEach((e=>{const t=a[e];n.addEventListener(e,t),this.on("dispose",(r=>n.removeEventListener(e,t)))})),this.on("loadstart",i),this.on("dispose",(e=>this.off("loadstart",i)))}proxyNativeTracks_(){NORMAL.names.forEach((e=>{this.proxyNativeTracksForType_(e)}))}createEl(){let e=this.options_.tag;if(!e||!this.options_.playerElIngest&&!this.movingMediaElementInDOM){if(e){const t=e.cloneNode(!0);e.parentNode&&e.parentNode.insertBefore(t,e),Html5.disposeMediaElement(e),e=t}else{e=document$2.createElement("video");const t=merge$1({},this.options_.tag&&getAttributes(this.options_.tag));TOUCH_ENABLED&&!0===this.options_.nativeControlsForTouch||delete t.controls,setAttributes(e,Object.assign(t,{id:this.options_.techId,class:"vjs-tech"}))}e.playerId=this.options_.playerId}void 0!==this.options_.preload&&setAttribute(e,"preload",this.options_.preload),void 0!==this.options_.disablePictureInPicture&&(e.disablePictureInPicture=this.options_.disablePictureInPicture);const t=["loop","muted","playsinline","autoplay"];for(let n=0;n<t.length;n++){const r=t[n],a=this.options_[r];void 0!==a&&(a?setAttribute(e,r,r):removeAttribute(e,r),e[r]=a)}return e}handleLateInit_(e){if(0===e.networkState||3===e.networkState)return;if(0===e.readyState){let e=!1;const t=function(){e=!0};this.on("loadstart",t);const n=function(){e||this.trigger("loadstart")};return this.on("loadedmetadata",n),void this.ready((function(){this.off("loadstart",t),this.off("loadedmetadata",n),e||this.trigger("loadstart")}))}const t=["loadstart"];t.push("loadedmetadata"),e.readyState>=2&&t.push("loadeddata"),e.readyState>=3&&t.push("canplay"),e.readyState>=4&&t.push("canplaythrough"),this.ready((function(){t.forEach((function(e){this.trigger(e)}),this)}))}setScrubbing(e){this.isScrubbing_=e}scrubbing(){return this.isScrubbing_}setCurrentTime(e){try{this.isScrubbing_&&this.el_.fastSeek&&IS_ANY_SAFARI?this.el_.fastSeek(e):this.el_.currentTime=e}catch(e2){log$1(e2,"Video is not ready. (Video.js)")}}duration(){if(this.el_.duration===1/0&&IS_ANDROID&&IS_CHROME&&0===this.el_.currentTime){const e=()=>{this.el_.currentTime>0&&(this.el_.duration===1/0&&this.trigger("durationchange"),this.off("timeupdate",e))};return this.on("timeupdate",e),NaN}return this.el_.duration||NaN}width(){return this.el_.offsetWidth}height(){return this.el_.offsetHeight}proxyWebkitFullscreen_(){if(!("webkitDisplayingFullscreen"in this.el_))return;const e=function(){this.trigger("fullscreenchange",{isFullscreen:!1}),this.el_.controls&&!this.options_.nativeControlsForTouch&&this.controls()&&(this.el_.controls=!1)},t=function(){"webkitPresentationMode"in this.el_&&"picture-in-picture"!==this.el_.webkitPresentationMode&&(this.one("webkitendfullscreen",e),this.trigger("fullscreenchange",{isFullscreen:!0,nativeIOSFullscreen:!0}))};this.on("webkitbeginfullscreen",t),this.on("dispose",(()=>{this.off("webkitbeginfullscreen",t),this.off("webkitendfullscreen",e)}))}supportsFullScreen(){return"function"==typeof this.el_.webkitEnterFullScreen}enterFullScreen(){const e=this.el_;if(e.paused&&e.networkState<=e.HAVE_METADATA)silencePromise(this.el_.play()),this.setTimeout((function(){e.pause();try{e.webkitEnterFullScreen()}catch(e2){this.trigger("fullscreenerror",e2)}}),0);else try{e.webkitEnterFullScreen()}catch(e2){this.trigger("fullscreenerror",e2)}}exitFullScreen(){this.el_.webkitDisplayingFullscreen?this.el_.webkitExitFullScreen():this.trigger("fullscreenerror",new Error("The video is not fullscreen"))}requestPictureInPicture(){return this.el_.requestPictureInPicture()}requestVideoFrameCallback(e){return this.featuresVideoFrameCallback&&!this.el_.webkitKeys?this.el_.requestVideoFrameCallback(e):super.requestVideoFrameCallback(e)}cancelVideoFrameCallback(e){this.featuresVideoFrameCallback&&!this.el_.webkitKeys?this.el_.cancelVideoFrameCallback(e):super.cancelVideoFrameCallback(e)}src(e){if(void 0===e)return this.el_.src;this.setSrc(e)}reset(){Html5.resetMediaElement(this.el_)}currentSrc(){return this.currentSource_?this.currentSource_.src:this.el_.currentSrc}setControls(e){this.el_.controls=!!e}addTextTrack(e,t,n){return this.featuresNativeTextTracks?this.el_.addTextTrack(e,t,n):super.addTextTrack(e,t,n)}createRemoteTextTrack(e){if(!this.featuresNativeTextTracks)return super.createRemoteTextTrack(e);const t=document$2.createElement("track");return e.kind&&(t.kind=e.kind),e.label&&(t.label=e.label),(e.language||e.srclang)&&(t.srclang=e.language||e.srclang),e.default&&(t.default=e.default),e.id&&(t.id=e.id),e.src&&(t.src=e.src),t}addRemoteTextTrack(e,t){const n=super.addRemoteTextTrack(e,t);return this.featuresNativeTextTracks&&this.el().appendChild(n),n}removeRemoteTextTrack(e){if(super.removeRemoteTextTrack(e),this.featuresNativeTextTracks){const t=this.$$("track");let n=t.length;for(;n--;)e!==t[n]&&e!==t[n].track||this.el().removeChild(t[n])}}getVideoPlaybackQuality(){if("function"==typeof this.el().getVideoPlaybackQuality)return this.el().getVideoPlaybackQuality();const e={};return void 0!==this.el().webkitDroppedFrameCount&&void 0!==this.el().webkitDecodedFrameCount&&(e.droppedVideoFrames=this.el().webkitDroppedFrameCount,e.totalVideoFrames=this.el().webkitDecodedFrameCount),window$1$1.performance&&(e.creationTime=window$1$1.performance.now()),e}}defineLazyProperty(Html5,"TEST_VID",(function(){if(!isReal())return;const e=document$2.createElement("video"),t=document$2.createElement("track");return t.kind="captions",t.srclang="en",t.label="English",e.appendChild(t),e})),Html5.isSupported=function(){try{Html5.TEST_VID.volume=.5}catch(e2){return!1}return!(!Html5.TEST_VID||!Html5.TEST_VID.canPlayType)},Html5.canPlayType=function(e){return Html5.TEST_VID.canPlayType(e)},Html5.canPlaySource=function(e,t){return Html5.canPlayType(e.type)},Html5.canControlVolume=function(){try{const e=Html5.TEST_VID.volume;Html5.TEST_VID.volume=e/2+.1;const t=e!==Html5.TEST_VID.volume;return t&&IS_IOS?(window$1$1.setTimeout((()=>{Html5&&Html5.prototype&&(Html5.prototype.featuresVolumeControl=e!==Html5.TEST_VID.volume)})),!1):t}catch(e2){return!1}},Html5.canMuteVolume=function(){try{const e=Html5.TEST_VID.muted;return Html5.TEST_VID.muted=!e,Html5.TEST_VID.muted?setAttribute(Html5.TEST_VID,"muted","muted"):removeAttribute(Html5.TEST_VID,"muted","muted"),e!==Html5.TEST_VID.muted}catch(e2){return!1}},Html5.canControlPlaybackRate=function(){if(IS_ANDROID&&IS_CHROME&&CHROME_VERSION<58)return!1;try{const e=Html5.TEST_VID.playbackRate;return Html5.TEST_VID.playbackRate=e/2+.1,e!==Html5.TEST_VID.playbackRate}catch(e2){return!1}},Html5.canOverrideAttributes=function(){try{const e=()=>{};Object.defineProperty(document$2.createElement("video"),"src",{get:e,set:e}),Object.defineProperty(document$2.createElement("audio"),"src",{get:e,set:e}),Object.defineProperty(document$2.createElement("video"),"innerHTML",{get:e,set:e}),Object.defineProperty(document$2.createElement("audio"),"innerHTML",{get:e,set:e})}catch(e2){return!1}return!0},Html5.supportsNativeTextTracks=function(){return IS_ANY_SAFARI||IS_IOS&&IS_CHROME},Html5.supportsNativeVideoTracks=function(){return!(!Html5.TEST_VID||!Html5.TEST_VID.videoTracks)},Html5.supportsNativeAudioTracks=function(){return!(!Html5.TEST_VID||!Html5.TEST_VID.audioTracks)},Html5.Events=["loadstart","suspend","abort","error","emptied","stalled","loadedmetadata","loadeddata","canplay","canplaythrough","playing","waiting","seeking","seeked","ended","durationchange","timeupdate","progress","play","pause","ratechange","resize","volumechange"],[["featuresMuteControl","canMuteVolume"],["featuresPlaybackRate","canControlPlaybackRate"],["featuresSourceset","canOverrideAttributes"],["featuresNativeTextTracks","supportsNativeTextTracks"],["featuresNativeVideoTracks","supportsNativeVideoTracks"],["featuresNativeAudioTracks","supportsNativeAudioTracks"]].forEach((function([e,t]){defineLazyProperty(Html5.prototype,e,(()=>Html5[t]()),!0)})),Html5.prototype.featuresVolumeControl=Html5.canControlVolume(),Html5.prototype.movingMediaElementInDOM=!IS_IOS,Html5.prototype.featuresFullscreenResize=!0,Html5.prototype.featuresProgressEvents=!0,Html5.prototype.featuresTimeupdateEvents=!0,Html5.prototype.featuresVideoFrameCallback=!(!Html5.TEST_VID||!Html5.TEST_VID.requestVideoFrameCallback),Html5.disposeMediaElement=function(e){if(e){for(e.parentNode&&e.parentNode.removeChild(e);e.hasChildNodes();)e.removeChild(e.firstChild);e.removeAttribute("src"),"function"==typeof e.load&&function(){try{e.load()}catch(e2){}}()}},Html5.resetMediaElement=function(e){if(!e)return;const t=e.querySelectorAll("source");let n=t.length;for(;n--;)e.removeChild(t[n]);e.removeAttribute("src"),"function"==typeof e.load&&function(){try{e.load()}catch(e2){}}()},["muted","defaultMuted","autoplay","controls","loop","playsinline"].forEach((function(e){Html5.prototype[e]=function(){return this.el_[e]||this.el_.hasAttribute(e)}})),["muted","defaultMuted","autoplay","loop","playsinline"].forEach((function(e){Html5.prototype["set"+toTitleCase$1(e)]=function(t){this.el_[e]=t,t?this.el_.setAttribute(e,e):this.el_.removeAttribute(e)}})),["paused","currentTime","buffered","volume","poster","preload","error","seeking","seekable","ended","playbackRate","defaultPlaybackRate","disablePictureInPicture","played","networkState","readyState","videoWidth","videoHeight","crossOrigin"].forEach((function(e){Html5.prototype[e]=function(){return this.el_[e]}})),["volume","src","poster","preload","playbackRate","defaultPlaybackRate","disablePictureInPicture","crossOrigin"].forEach((function(e){Html5.prototype["set"+toTitleCase$1(e)]=function(t){this.el_[e]=t}})),["pause","load","play"].forEach((function(e){Html5.prototype[e]=function(){return this.el_[e]()}})),Tech.withSourceHandlers(Html5),Html5.nativeSourceHandler={},Html5.nativeSourceHandler.canPlayType=function(e){try{return Html5.TEST_VID.canPlayType(e)}catch(e2){return""}},Html5.nativeSourceHandler.canHandleSource=function(e,t){if(e.type)return Html5.nativeSourceHandler.canPlayType(e.type);if(e.src){const t=getFileExtension(e.src);return Html5.nativeSourceHandler.canPlayType(`video/${t}`)}return""},Html5.nativeSourceHandler.handleSource=function(e,t,n){t.setSrc(e.src)},Html5.nativeSourceHandler.dispose=function(){},Html5.registerSourceHandler(Html5.nativeSourceHandler),Tech.registerTech("Html5",Html5);const TECH_EVENTS_RETRIGGER=["progress","abort","suspend","emptied","stalled","loadedmetadata","loadeddata","timeupdate","resize","volumechange","texttrackchange"],TECH_EVENTS_QUEUE={canplay:"CanPlay",canplaythrough:"CanPlayThrough",playing:"Playing",seeked:"Seeked"},BREAKPOINT_ORDER=["tiny","xsmall","small","medium","large","xlarge","huge"],BREAKPOINT_CLASSES={};BREAKPOINT_ORDER.forEach((e=>{const t="x"===e.charAt(0)?`x-${e.substring(1)}`:e;BREAKPOINT_CLASSES[e]=`vjs-layout-${t}`}));const DEFAULT_BREAKPOINTS={tiny:210,xsmall:320,small:425,medium:768,large:1440,xlarge:2560,huge:1/0};class Player extends Component$1{constructor(e,t,n){if(e.id=e.id||t.id||`vjs_video_${newGUID()}`,(t=Object.assign(Player.getTagSettings(e),t)).initChildren=!1,t.createEl=!1,t.evented=!1,t.reportTouchActivity=!1,!t.language){const n=e.closest("[lang]");n&&(t.language=n.getAttribute("lang"))}if(super(null,t,n),this.boundDocumentFullscreenChange_=e=>this.documentFullscreenChange_(e),this.boundFullWindowOnEscKey_=e=>this.fullWindowOnEscKey(e),this.boundUpdateStyleEl_=e=>this.updateStyleEl_(e),this.boundApplyInitTime_=e=>this.applyInitTime_(e),this.boundUpdateCurrentBreakpoint_=e=>this.updateCurrentBreakpoint_(e),this.boundHandleTechClick_=e=>this.handleTechClick_(e),this.boundHandleTechDoubleClick_=e=>this.handleTechDoubleClick_(e),this.boundHandleTechTouchStart_=e=>this.handleTechTouchStart_(e),this.boundHandleTechTouchMove_=e=>this.handleTechTouchMove_(e),this.boundHandleTechTouchEnd_=e=>this.handleTechTouchEnd_(e),this.boundHandleTechTap_=e=>this.handleTechTap_(e),this.isFullscreen_=!1,this.log=createLogger(this.id_),this.fsApi_=FullscreenApi,this.isPosterFromTech_=!1,this.queuedCallbacks_=[],this.isReady_=!1,this.hasStarted_=!1,this.userActive_=!1,this.debugEnabled_=!1,this.audioOnlyMode_=!1,this.audioPosterMode_=!1,this.audioOnlyCache_={playerHeight:null,hiddenChildren:[]},!this.options_||!this.options_.techOrder||!this.options_.techOrder.length)throw new Error("No techOrder specified. Did you overwrite videojs.options instead of just changing the properties you want to override?");if(this.tag=e,this.tagAttributes=e&&getAttributes(e),this.language(this.options_.language),t.languages){const e={};Object.getOwnPropertyNames(t.languages).forEach((function(n){e[n.toLowerCase()]=t.languages[n]})),this.languages_=e}else this.languages_=Player.prototype.options_.languages;this.resetCache_(),this.poster_=t.poster||"",this.controls_=!!t.controls,e.controls=!1,e.removeAttribute("controls"),this.changingSrc_=!1,this.playCallbacks_=[],this.playTerminatedQueue_=[],e.hasAttribute("autoplay")?this.autoplay(!0):this.autoplay(this.options_.autoplay),t.plugins&&Object.keys(t.plugins).forEach((e=>{if("function"!=typeof this[e])throw new Error(`plugin "${e}" does not exist`)})),this.scrubbing_=!1,this.el_=this.createEl(),evented(this,{eventBusKey:"el_"}),this.fsApi_.requestFullscreen&&(on(document$2,this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_),this.on(this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_)),this.fluid_&&this.on(["playerreset","resize"],this.boundUpdateStyleEl_);const r=merge$1(this.options_);if(t.plugins&&Object.keys(t.plugins).forEach((e=>{this[e](t.plugins[e])})),t.debug&&this.debug(!0),this.options_.playerOptions=r,this.middleware_=[],this.playbackRates(t.playbackRates),t.experimentalSvgIcons){const e=(new window$1$1.DOMParser).parseFromString(icons,"image/svg+xml");if(e.querySelector("parsererror"))log$1.warn("Failed to load SVG Icons. Falling back to Font Icons."),this.options_.experimentalSvgIcons=null;else{const t=e.documentElement;t.style.display="none",this.el_.appendChild(t),this.addClass("vjs-svg-icons-enabled")}}this.initChildren(),this.isAudio("audio"===e.nodeName.toLowerCase()),this.controls()?this.addClass("vjs-controls-enabled"):this.addClass("vjs-controls-disabled"),this.el_.setAttribute("role","region"),this.isAudio()?this.el_.setAttribute("aria-label",this.localize("Audio Player")):this.el_.setAttribute("aria-label",this.localize("Video Player")),this.isAudio()&&this.addClass("vjs-audio"),TOUCH_ENABLED&&this.addClass("vjs-touch-enabled"),IS_IOS||this.addClass("vjs-workinghover"),Player.players[this.id_]=this;const a=version$6.split(".")[0];this.addClass(`vjs-v${a}`),this.userActive(!0),this.reportUserActivity(),this.one("play",(e=>this.listenForUserActivity_(e))),this.on("keydown",(e=>this.handleKeyDown(e))),this.on("languagechange",(e=>this.handleLanguagechange(e))),this.breakpoints(this.options_.breakpoints),this.responsive(this.options_.responsive),this.on("ready",(()=>{this.audioPosterMode(this.options_.audioPosterMode),this.audioOnlyMode(this.options_.audioOnlyMode)}))}dispose(){this.trigger("dispose"),this.off("dispose"),off(document$2,this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_),off(document$2,"keydown",this.boundFullWindowOnEscKey_),this.styleEl_&&this.styleEl_.parentNode&&(this.styleEl_.parentNode.removeChild(this.styleEl_),this.styleEl_=null),Player.players[this.id_]=null,this.tag&&this.tag.player&&(this.tag.player=null),this.el_&&this.el_.player&&(this.el_.player=null),this.tech_&&(this.tech_.dispose(),this.isPosterFromTech_=!1,this.poster_=""),this.playerElIngest_&&(this.playerElIngest_=null),this.tag&&(this.tag=null),clearCacheForPlayer(this),ALL.names.forEach((e=>{const t=this[ALL[e].getterName]();t&&t.off&&t.off()})),super.dispose({restoreEl:this.options_.restoreEl})}createEl(){let e,t=this.tag,n=this.playerElIngest_=t.parentNode&&t.parentNode.hasAttribute&&t.parentNode.hasAttribute("data-vjs-player");const r="video-js"===this.tag.tagName.toLowerCase();n?e=this.el_=t.parentNode:r||(e=this.el_=super.createEl("div"));const a=getAttributes(t);if(r){for(e=this.el_=t,t=this.tag=document$2.createElement("video");e.children.length;)t.appendChild(e.firstChild);hasClass(e,"video-js")||addClass(e,"video-js"),e.appendChild(t),n=this.playerElIngest_=e,Object.keys(e).forEach((n=>{try{t[n]=e[n]}catch(e2){}}))}if(t.setAttribute("tabindex","-1"),a.tabindex="-1",IS_CHROME&&IS_WINDOWS&&(t.setAttribute("role","application"),a.role="application"),t.removeAttribute("width"),t.removeAttribute("height"),"width"in a&&delete a.width,"height"in a&&delete a.height,Object.getOwnPropertyNames(a).forEach((function(n){r&&"class"===n||e.setAttribute(n,a[n]),r&&t.setAttribute(n,a[n])})),t.playerId=t.id,t.id+="_html5_api",t.className="vjs-tech",t.player=e.player=this,this.addClass("vjs-paused"),!0!==window$1$1.VIDEOJS_NO_DYNAMIC_STYLE){this.styleEl_=createStyleElement("vjs-styles-dimensions");const e=$(".vjs-styles-defaults"),t=$("head");t.insertBefore(this.styleEl_,e?e.nextSibling:t.firstChild)}this.fill_=!1,this.fluid_=!1,this.width(this.options_.width),this.height(this.options_.height),this.fill(this.options_.fill),this.fluid(this.options_.fluid),this.aspectRatio(this.options_.aspectRatio),this.crossOrigin(this.options_.crossOrigin||this.options_.crossorigin);const i=t.getElementsByTagName("a");for(let s=0;s<i.length;s++){const e=i.item(s);addClass(e,"vjs-hidden"),e.setAttribute("hidden","hidden")}return t.initNetworkState_=t.networkState,t.parentNode&&!n&&t.parentNode.insertBefore(e,t),prependTo(t,e),this.children_.unshift(t),this.el_.setAttribute("lang",this.language_),this.el_.setAttribute("translate","no"),this.el_=e,e}crossOrigin(e){if(void 0===e)return this.techGet_("crossOrigin");null===e||"anonymous"===e||"use-credentials"===e?(this.techCall_("setCrossOrigin",e),this.posterImage&&this.posterImage.crossOrigin(e)):log$1.warn(`crossOrigin must be null,  "anonymous" or "use-credentials", given "${e}"`)}width(e){return this.dimension("width",e)}height(e){return this.dimension("height",e)}dimension(e,t){const n=e+"_";if(void 0===t)return this[n]||0;if(""===t||"auto"===t)return this[n]=void 0,void this.updateStyleEl_();const r=parseFloat(t);isNaN(r)?log$1.error(`Improper value "${t}" supplied for for ${e}`):(this[n]=r,this.updateStyleEl_())}fluid(e){if(void 0===e)return!!this.fluid_;this.fluid_=!!e,isEvented(this)&&this.off(["playerreset","resize"],this.boundUpdateStyleEl_),e?(this.addClass("vjs-fluid"),this.fill(!1),addEventedCallback(this,(()=>{this.on(["playerreset","resize"],this.boundUpdateStyleEl_)}))):this.removeClass("vjs-fluid"),this.updateStyleEl_()}fill(e){if(void 0===e)return!!this.fill_;this.fill_=!!e,e?(this.addClass("vjs-fill"),this.fluid(!1)):this.removeClass("vjs-fill")}aspectRatio(e){if(void 0===e)return this.aspectRatio_;if(!/^\d+\:\d+$/.test(e))throw new Error("Improper value supplied for aspect ratio. The format should be width:height, for example 16:9.");this.aspectRatio_=e,this.fluid(!0),this.updateStyleEl_()}updateStyleEl_(){if(!0===window$1$1.VIDEOJS_NO_DYNAMIC_STYLE){const e="number"==typeof this.width_?this.width_:this.options_.width,t="number"==typeof this.height_?this.height_:this.options_.height,n=this.tech_&&this.tech_.el();return void(n&&(e>=0&&(n.width=e),t>=0&&(n.height=t)))}let e,t,n,r;n=void 0!==this.aspectRatio_&&"auto"!==this.aspectRatio_?this.aspectRatio_:this.videoWidth()>0?this.videoWidth()+":"+this.videoHeight():"16:9";const a=n.split(":"),i=a[1]/a[0];e=void 0!==this.width_?this.width_:void 0!==this.height_?this.height_/i:this.videoWidth()||300,t=void 0!==this.height_?this.height_:e*i,r=/^[^a-zA-Z]/.test(this.id())?"dimensions-"+this.id():this.id()+"-dimensions",this.addClass(r),setTextContent(this.styleEl_,`\n      .${r} {\n        width: ${e}px;\n        height: ${t}px;\n      }\n\n      .${r}.vjs-fluid:not(.vjs-audio-only-mode) {\n        padding-top: ${100*i}%;\n      }\n    `)}loadTech_(e,t){this.tech_&&this.unloadTech_();const n=toTitleCase$1(e),r=e.charAt(0).toLowerCase()+e.slice(1);"Html5"!==n&&this.tag&&(Tech.getTech("Html5").disposeMediaElement(this.tag),this.tag.player=null,this.tag=null),this.techName_=n,this.isReady_=!1;let a=this.autoplay();("string"==typeof this.autoplay()||!0===this.autoplay()&&this.options_.normalizeAutoplay)&&(a=!1);const i={source:t,autoplay:a,nativeControlsForTouch:this.options_.nativeControlsForTouch,playerId:this.id(),techId:`${this.id()}_${r}_api`,playsinline:this.options_.playsinline,preload:this.options_.preload,loop:this.options_.loop,disablePictureInPicture:this.options_.disablePictureInPicture,muted:this.options_.muted,poster:this.poster(),language:this.language(),playerElIngest:this.playerElIngest_||!1,"vtt.js":this.options_["vtt.js"],canOverridePoster:!!this.options_.techCanOverridePoster,enableSourceset:this.options_.enableSourceset};ALL.names.forEach((e=>{const t=ALL[e];i[t.getterName]=this[t.privateName]})),Object.assign(i,this.options_[n]),Object.assign(i,this.options_[r]),Object.assign(i,this.options_[e.toLowerCase()]),this.tag&&(i.tag=this.tag),t&&t.src===this.cache_.src&&this.cache_.currentTime>0&&(i.startTime=this.cache_.currentTime);const s=Tech.getTech(e);if(!s)throw new Error(`No Tech named '${n}' exists! '${n}' should be registered using videojs.registerTech()'`);this.tech_=new s(i),this.tech_.ready(bind_(this,this.handleTechReady_),!0),textTrackConverter.jsonToTextTracks(this.textTracksJson_||[],this.tech_),TECH_EVENTS_RETRIGGER.forEach((e=>{this.on(this.tech_,e,(t=>this[`handleTech${toTitleCase$1(e)}_`](t)))})),Object.keys(TECH_EVENTS_QUEUE).forEach((e=>{this.on(this.tech_,e,(t=>{0===this.tech_.playbackRate()&&this.tech_.seeking()?this.queuedCallbacks_.push({callback:this[`handleTech${TECH_EVENTS_QUEUE[e]}_`].bind(this),event:t}):this[`handleTech${TECH_EVENTS_QUEUE[e]}_`](t)}))})),this.on(this.tech_,"loadstart",(e=>this.handleTechLoadStart_(e))),this.on(this.tech_,"sourceset",(e=>this.handleTechSourceset_(e))),this.on(this.tech_,"waiting",(e=>this.handleTechWaiting_(e))),this.on(this.tech_,"ended",(e=>this.handleTechEnded_(e))),this.on(this.tech_,"seeking",(e=>this.handleTechSeeking_(e))),this.on(this.tech_,"play",(e=>this.handleTechPlay_(e))),this.on(this.tech_,"pause",(e=>this.handleTechPause_(e))),this.on(this.tech_,"durationchange",(e=>this.handleTechDurationChange_(e))),this.on(this.tech_,"fullscreenchange",((e,t)=>this.handleTechFullscreenChange_(e,t))),this.on(this.tech_,"fullscreenerror",((e,t)=>this.handleTechFullscreenError_(e,t))),this.on(this.tech_,"enterpictureinpicture",(e=>this.handleTechEnterPictureInPicture_(e))),this.on(this.tech_,"leavepictureinpicture",(e=>this.handleTechLeavePictureInPicture_(e))),this.on(this.tech_,"error",(e=>this.handleTechError_(e))),this.on(this.tech_,"posterchange",(e=>this.handleTechPosterChange_(e))),this.on(this.tech_,"textdata",(e=>this.handleTechTextData_(e))),this.on(this.tech_,"ratechange",(e=>this.handleTechRateChange_(e))),this.on(this.tech_,"loadedmetadata",this.boundUpdateStyleEl_),this.usingNativeControls(this.techGet_("controls")),this.controls()&&!this.usingNativeControls()&&this.addTechControlsListeners_(),this.tech_.el().parentNode===this.el()||"Html5"===n&&this.tag||prependTo(this.tech_.el(),this.el()),this.tag&&(this.tag.player=null,this.tag=null)}unloadTech_(){ALL.names.forEach((e=>{const t=ALL[e];this[t.privateName]=this[t.getterName]()})),this.textTracksJson_=textTrackConverter.textTracksToJson(this.tech_),this.isReady_=!1,this.tech_.dispose(),this.tech_=!1,this.isPosterFromTech_&&(this.poster_="",this.trigger("posterchange")),this.isPosterFromTech_=!1}tech(e){return void 0===e&&log$1.warn("Using the tech directly can be dangerous. I hope you know what you're doing.\nSee https://github.com/videojs/video.js/issues/2617 for more info.\n"),this.tech_}version(){return{"video.js":version$6}}addTechControlsListeners_(){this.removeTechControlsListeners_(),this.on(this.tech_,"click",this.boundHandleTechClick_),this.on(this.tech_,"dblclick",this.boundHandleTechDoubleClick_),this.on(this.tech_,"touchstart",this.boundHandleTechTouchStart_),this.on(this.tech_,"touchmove",this.boundHandleTechTouchMove_),this.on(this.tech_,"touchend",this.boundHandleTechTouchEnd_),this.on(this.tech_,"tap",this.boundHandleTechTap_)}removeTechControlsListeners_(){this.off(this.tech_,"tap",this.boundHandleTechTap_),this.off(this.tech_,"touchstart",this.boundHandleTechTouchStart_),this.off(this.tech_,"touchmove",this.boundHandleTechTouchMove_),this.off(this.tech_,"touchend",this.boundHandleTechTouchEnd_),this.off(this.tech_,"click",this.boundHandleTechClick_),this.off(this.tech_,"dblclick",this.boundHandleTechDoubleClick_)}handleTechReady_(){this.triggerReady(),this.cache_.volume&&this.techCall_("setVolume",this.cache_.volume),this.handleTechPosterChange_(),this.handleTechDurationChange_()}handleTechLoadStart_(){this.removeClass("vjs-ended","vjs-seeking"),this.error(null),this.handleTechDurationChange_(),this.paused()?(this.hasStarted(!1),this.trigger("loadstart")):this.trigger("loadstart"),this.manualAutoplay_(!0===this.autoplay()&&this.options_.normalizeAutoplay?"play":this.autoplay())}manualAutoplay_(e){if(!this.tech_||"string"!=typeof e)return;const t=()=>{const e=this.muted();this.muted(!0);const t=()=>{this.muted(e)};this.playTerminatedQueue_.push(t);const n=this.play();if(isPromise(n))return n.catch((e=>{throw t(),new Error(`Rejection at manualAutoplay. Restoring muted value. ${e||""}`)}))};let n;return"any"!==e||this.muted()?n="muted"!==e||this.muted()?this.play():t():(n=this.play(),isPromise(n)&&(n=n.catch(t))),isPromise(n)?n.then((()=>{this.trigger({type:"autoplay-success",autoplay:e})})).catch((()=>{this.trigger({type:"autoplay-failure",autoplay:e})})):void 0}updateSourceCaches_(e=""){let t=e,n="";"string"!=typeof t&&(t=e.src,n=e.type),this.cache_.source=this.cache_.source||{},this.cache_.sources=this.cache_.sources||[],t&&!n&&(n=findMimetype(this,t)),this.cache_.source=merge$1({},e,{src:t,type:n});const r=this.cache_.sources.filter((e=>e.src&&e.src===t)),a=[],i=this.$$("source"),s=[];for(let o=0;o<i.length;o++){const e=getAttributes(i[o]);a.push(e),e.src&&e.src===t&&s.push(e.src)}s.length&&!r.length?this.cache_.sources=a:r.length||(this.cache_.sources=[this.cache_.source]),this.cache_.src=t}handleTechSourceset_(e){if(!this.changingSrc_){let t=e=>this.updateSourceCaches_(e);const n=this.currentSource().src,r=e.src;n&&!/^blob:/.test(n)&&/^blob:/.test(r)&&(!this.lastSource_||this.lastSource_.tech!==r&&this.lastSource_.player!==n)&&(t=()=>{}),t(r),e.src||this.tech_.any(["sourceset","loadstart"],(e=>{if("sourceset"===e.type)return;const t=this.techGet_("currentSrc");this.lastSource_.tech=t,this.updateSourceCaches_(t)}))}this.lastSource_={player:this.currentSource().src,tech:e.src},this.trigger({src:e.src,type:"sourceset"})}hasStarted(e){if(void 0===e)return this.hasStarted_;e!==this.hasStarted_&&(this.hasStarted_=e,this.hasStarted_?this.addClass("vjs-has-started"):this.removeClass("vjs-has-started"))}handleTechPlay_(){this.removeClass("vjs-ended","vjs-paused"),this.addClass("vjs-playing"),this.hasStarted(!0),this.trigger("play")}handleTechRateChange_(){this.tech_.playbackRate()>0&&0===this.cache_.lastPlaybackRate&&(this.queuedCallbacks_.forEach((e=>e.callback(e.event))),this.queuedCallbacks_=[]),this.cache_.lastPlaybackRate=this.tech_.playbackRate(),this.trigger("ratechange")}handleTechWaiting_(){this.addClass("vjs-waiting"),this.trigger("waiting");const e=this.currentTime(),t=()=>{e!==this.currentTime()&&(this.removeClass("vjs-waiting"),this.off("timeupdate",t))};this.on("timeupdate",t)}handleTechCanPlay_(){this.removeClass("vjs-waiting"),this.trigger("canplay")}handleTechCanPlayThrough_(){this.removeClass("vjs-waiting"),this.trigger("canplaythrough")}handleTechPlaying_(){this.removeClass("vjs-waiting"),this.trigger("playing")}handleTechSeeking_(){this.addClass("vjs-seeking"),this.trigger("seeking")}handleTechSeeked_(){this.removeClass("vjs-seeking","vjs-ended"),this.trigger("seeked")}handleTechPause_(){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.trigger("pause")}handleTechEnded_(){this.addClass("vjs-ended"),this.removeClass("vjs-waiting"),this.options_.loop?(this.currentTime(0),this.play()):this.paused()||this.pause(),this.trigger("ended")}handleTechDurationChange_(){this.duration(this.techGet_("duration"))}handleTechClick_(e){this.controls_&&(void 0!==this.options_&&void 0!==this.options_.userActions&&void 0!==this.options_.userActions.click&&!1===this.options_.userActions.click||(void 0!==this.options_&&void 0!==this.options_.userActions&&"function"==typeof this.options_.userActions.click?this.options_.userActions.click.call(this,e):this.paused()?silencePromise(this.play()):this.pause()))}handleTechDoubleClick_(e){if(!this.controls_)return;Array.prototype.some.call(this.$$(".vjs-control-bar, .vjs-modal-dialog"),(t=>t.contains(e.target)))||void 0!==this.options_&&void 0!==this.options_.userActions&&void 0!==this.options_.userActions.doubleClick&&!1===this.options_.userActions.doubleClick||(void 0!==this.options_&&void 0!==this.options_.userActions&&"function"==typeof this.options_.userActions.doubleClick?this.options_.userActions.doubleClick.call(this,e):this.isFullscreen()?this.exitFullscreen():this.requestFullscreen())}handleTechTap_(){this.userActive(!this.userActive())}handleTechTouchStart_(){this.userWasActive=this.userActive()}handleTechTouchMove_(){this.userWasActive&&this.reportUserActivity()}handleTechTouchEnd_(e){e.cancelable&&e.preventDefault()}toggleFullscreenClass_(){this.isFullscreen()?this.addClass("vjs-fullscreen"):this.removeClass("vjs-fullscreen")}documentFullscreenChange_(e){const t=e.target.player;if(t&&t!==this)return;const n=this.el();let r=document$2[this.fsApi_.fullscreenElement]===n;!r&&n.matches&&(r=n.matches(":"+this.fsApi_.fullscreen)),this.isFullscreen(r)}handleTechFullscreenChange_(e,t){t&&(t.nativeIOSFullscreen&&(this.addClass("vjs-ios-native-fs"),this.tech_.one("webkitendfullscreen",(()=>{this.removeClass("vjs-ios-native-fs")}))),this.isFullscreen(t.isFullscreen))}handleTechFullscreenError_(e,t){this.trigger("fullscreenerror",t)}togglePictureInPictureClass_(){this.isInPictureInPicture()?this.addClass("vjs-picture-in-picture"):this.removeClass("vjs-picture-in-picture")}handleTechEnterPictureInPicture_(e){this.isInPictureInPicture(!0)}handleTechLeavePictureInPicture_(e){this.isInPictureInPicture(!1)}handleTechError_(){const e=this.tech_.error();e&&this.error(e)}handleTechTextData_(){let e=null;arguments.length>1&&(e=arguments[1]),this.trigger("textdata",e)}getCache(){return this.cache_}resetCache_(){this.cache_={currentTime:0,initTime:0,inactivityTimeout:this.options_.inactivityTimeout,duration:NaN,lastVolume:1,lastPlaybackRate:this.defaultPlaybackRate(),media:null,src:"",source:{},sources:[],playbackRates:[],volume:1}}techCall_(e,t){this.ready((function(){if(e in allowedSetters)return set(this.middleware_,this.tech_,e,t);if(e in allowedMediators)return mediate(this.middleware_,this.tech_,e,t);try{this.tech_&&this.tech_[e](t)}catch(e2){throw log$1(e2),e2}}),!0)}techGet_(e){if(this.tech_&&this.tech_.isReady_){if(e in allowedGetters)return get(this.middleware_,this.tech_,e);if(e in allowedMediators)return mediate(this.middleware_,this.tech_,e);try{return this.tech_[e]()}catch(e2){if(void 0===this.tech_[e])throw log$1(`Video.js: ${e} method not defined for ${this.techName_} playback technology.`,e2),e2;if("TypeError"===e2.name)throw log$1(`Video.js: ${e} unavailable on ${this.techName_} playback technology element.`,e2),this.tech_.isReady_=!1,e2;throw log$1(e2),e2}}}play(){return new Promise((e=>{this.play_(e)}))}play_(e=silencePromise){this.playCallbacks_.push(e);const t=Boolean(!this.changingSrc_&&(this.src()||this.currentSrc())),n=Boolean(IS_ANY_SAFARI||IS_IOS);if(this.waitToPlay_&&(this.off(["ready","loadstart"],this.waitToPlay_),this.waitToPlay_=null),!this.isReady_||!t)return this.waitToPlay_=e=>{this.play_()},this.one(["ready","loadstart"],this.waitToPlay_),void(!t&&n&&this.load());const r=this.techGet_("play");n&&this.hasClass("vjs-ended")&&this.resetProgressBar_(),null===r?this.runPlayTerminatedQueue_():this.runPlayCallbacks_(r)}runPlayTerminatedQueue_(){const e=this.playTerminatedQueue_.slice(0);this.playTerminatedQueue_=[],e.forEach((function(e){e()}))}runPlayCallbacks_(e){const t=this.playCallbacks_.slice(0);this.playCallbacks_=[],this.playTerminatedQueue_=[],t.forEach((function(t){t(e)}))}pause(){this.techCall_("pause")}paused(){return!1!==this.techGet_("paused")}played(){return this.techGet_("played")||createTimeRanges$1(0,0)}scrubbing(e){if(void 0===e)return this.scrubbing_;this.scrubbing_=!!e,this.techCall_("setScrubbing",this.scrubbing_),e?this.addClass("vjs-scrubbing"):this.removeClass("vjs-scrubbing")}currentTime(e){return void 0===e?(this.cache_.currentTime=this.techGet_("currentTime")||0,this.cache_.currentTime):(e<0&&(e=0),this.isReady_&&!this.changingSrc_&&this.tech_&&this.tech_.isReady_?(this.techCall_("setCurrentTime",e),this.cache_.initTime=0,void(isFinite(e)&&(this.cache_.currentTime=Number(e)))):(this.cache_.initTime=e,this.off("canplay",this.boundApplyInitTime_),void this.one("canplay",this.boundApplyInitTime_)))}applyInitTime_(){this.currentTime(this.cache_.initTime)}duration(e){if(void 0===e)return void 0!==this.cache_.duration?this.cache_.duration:NaN;(e=parseFloat(e))<0&&(e=1/0),e!==this.cache_.duration&&(this.cache_.duration=e,e===1/0?this.addClass("vjs-live"):this.removeClass("vjs-live"),isNaN(e)||this.trigger("durationchange"))}remainingTime(){return this.duration()-this.currentTime()}remainingTimeDisplay(){return Math.floor(this.duration())-Math.floor(this.currentTime())}buffered(){let e=this.techGet_("buffered");return e&&e.length||(e=createTimeRanges$1(0,0)),e}seekable(){let e=this.techGet_("seekable");return e&&e.length||(e=createTimeRanges$1(0,0)),e}seeking(){return this.techGet_("seeking")}ended(){return this.techGet_("ended")}networkState(){return this.techGet_("networkState")}readyState(){return this.techGet_("readyState")}bufferedPercent(){return bufferedPercent(this.buffered(),this.duration())}bufferedEnd(){const e=this.buffered(),t=this.duration();let n=e.end(e.length-1);return n>t&&(n=t),n}volume(e){let t;return void 0!==e?(t=Math.max(0,Math.min(1,e)),this.cache_.volume=t,this.techCall_("setVolume",t),void(t>0&&this.lastVolume_(t))):(t=parseFloat(this.techGet_("volume")),isNaN(t)?1:t)}muted(e){if(void 0===e)return this.techGet_("muted")||!1;this.techCall_("setMuted",e)}defaultMuted(e){return void 0!==e&&this.techCall_("setDefaultMuted",e),this.techGet_("defaultMuted")||!1}lastVolume_(e){if(void 0===e||0===e)return this.cache_.lastVolume;this.cache_.lastVolume=e}supportsFullScreen(){return this.techGet_("supportsFullScreen")||!1}isFullscreen(e){if(void 0!==e){const t=this.isFullscreen_;return this.isFullscreen_=Boolean(e),this.isFullscreen_!==t&&this.fsApi_.prefixed&&this.trigger("fullscreenchange"),void this.toggleFullscreenClass_()}return this.isFullscreen_}requestFullscreen(e){this.isInPictureInPicture()&&this.exitPictureInPicture();const t=this;return new Promise(((n,r)=>{function a(){t.off("fullscreenerror",s),t.off("fullscreenchange",i)}function i(){a(),n()}function s(e,t){a(),r(t)}t.one("fullscreenchange",i),t.one("fullscreenerror",s);const o=t.requestFullscreenHelper_(e);o&&(o.then(a,a),o.then(n,r))}))}requestFullscreenHelper_(e){let t;if(this.fsApi_.prefixed||(t=this.options_.fullscreen&&this.options_.fullscreen.options||{},void 0!==e&&(t=e)),this.fsApi_.requestFullscreen){const e=this.el_[this.fsApi_.requestFullscreen](t);return e&&e.then((()=>this.isFullscreen(!0)),(()=>this.isFullscreen(!1))),e}this.tech_.supportsFullScreen()&&!0==!this.options_.preferFullWindow?this.techCall_("enterFullScreen"):this.enterFullWindow()}exitFullscreen(){const e=this;return new Promise(((t,n)=>{function r(){e.off("fullscreenerror",i),e.off("fullscreenchange",a)}function a(){r(),t()}function i(e,t){r(),n(t)}e.one("fullscreenchange",a),e.one("fullscreenerror",i);const s=e.exitFullscreenHelper_();s&&(s.then(r,r),s.then(t,n))}))}exitFullscreenHelper_(){if(this.fsApi_.requestFullscreen){const e=document$2[this.fsApi_.exitFullscreen]();return e&&silencePromise(e.then((()=>this.isFullscreen(!1)))),e}this.tech_.supportsFullScreen()&&!0==!this.options_.preferFullWindow?this.techCall_("exitFullScreen"):this.exitFullWindow()}enterFullWindow(){this.isFullscreen(!0),this.isFullWindow=!0,this.docOrigOverflow=document$2.documentElement.style.overflow,on(document$2,"keydown",this.boundFullWindowOnEscKey_),document$2.documentElement.style.overflow="hidden",addClass(document$2.body,"vjs-full-window"),this.trigger("enterFullWindow")}fullWindowOnEscKey(e){keycode.isEventKey(e,"Esc")&&!0===this.isFullscreen()&&(this.isFullWindow?this.exitFullWindow():this.exitFullscreen())}exitFullWindow(){this.isFullscreen(!1),this.isFullWindow=!1,off(document$2,"keydown",this.boundFullWindowOnEscKey_),document$2.documentElement.style.overflow=this.docOrigOverflow,removeClass(document$2.body,"vjs-full-window"),this.trigger("exitFullWindow")}disablePictureInPicture(e){if(void 0===e)return this.techGet_("disablePictureInPicture");this.techCall_("setDisablePictureInPicture",e),this.options_.disablePictureInPicture=e,this.trigger("disablepictureinpicturechanged")}isInPictureInPicture(e){return void 0!==e?(this.isInPictureInPicture_=!!e,void this.togglePictureInPictureClass_()):!!this.isInPictureInPicture_}requestPictureInPicture(){if(this.options_.enableDocumentPictureInPicture&&window$1$1.documentPictureInPicture){const e=document$2.createElement(this.el().tagName);return e.classList=this.el().classList,e.classList.add("vjs-pip-container"),this.posterImage&&e.appendChild(this.posterImage.el().cloneNode(!0)),this.titleBar&&e.appendChild(this.titleBar.el().cloneNode(!0)),e.appendChild(createEl("p",{className:"vjs-pip-text"},{},this.localize("Playing in picture-in-picture"))),window$1$1.documentPictureInPicture.requestWindow({width:this.videoWidth(),height:this.videoHeight()}).then((t=>(copyStyleSheetsToWindow(t),this.el_.parentNode.insertBefore(e,this.el_),t.document.body.appendChild(this.el_),t.document.body.classList.add("vjs-pip-window"),this.player_.isInPictureInPicture(!0),this.player_.trigger("enterpictureinpicture"),t.addEventListener("pagehide",(t=>{const n=t.target.querySelector(".video-js");e.parentNode.replaceChild(n,e),this.player_.isInPictureInPicture(!1),this.player_.trigger("leavepictureinpicture")})),t)))}return"pictureInPictureEnabled"in document$2&&!1===this.disablePictureInPicture()?this.techGet_("requestPictureInPicture"):Promise.reject("No PiP mode is available")}exitPictureInPicture(){return window$1$1.documentPictureInPicture&&window$1$1.documentPictureInPicture.window?(window$1$1.documentPictureInPicture.window.close(),Promise.resolve()):"pictureInPictureEnabled"in document$2?document$2.exitPictureInPicture():void 0}handleKeyDown(e){const{userActions:t}=this.options_;if(!t||!t.hotkeys)return;(e=>{const t=e.tagName.toLowerCase();if(e.isContentEditable)return!0;if("input"===t)return-1===["button","checkbox","hidden","radio","reset","submit"].indexOf(e.type);return-1!==["textarea"].indexOf(t)})(this.el_.ownerDocument.activeElement)||("function"==typeof t.hotkeys?t.hotkeys.call(this,e):this.handleHotkeys(e))}handleHotkeys(e){const t=this.options_.userActions?this.options_.userActions.hotkeys:{},{fullscreenKey:n=(e=>keycode.isEventKey(e,"f")),muteKey:r=(e=>keycode.isEventKey(e,"m")),playPauseKey:a=(e=>keycode.isEventKey(e,"k")||keycode.isEventKey(e,"Space"))}=t;if(n.call(this,e)){e.preventDefault(),e.stopPropagation();const t=Component$1.getComponent("FullscreenToggle");!1!==document$2[this.fsApi_.fullscreenEnabled]&&t.prototype.handleClick.call(this,e)}else if(r.call(this,e)){e.preventDefault(),e.stopPropagation();Component$1.getComponent("MuteToggle").prototype.handleClick.call(this,e)}else if(a.call(this,e)){e.preventDefault(),e.stopPropagation();Component$1.getComponent("PlayToggle").prototype.handleClick.call(this,e)}}canPlayType(e){let t;for(let n=0,r=this.options_.techOrder;n<r.length;n++){const a=r[n];let i=Tech.getTech(a);if(i||(i=Component$1.getComponent(a)),i){if(i.isSupported()&&(t=i.canPlayType(e),t))return t}else log$1.error(`The "${a}" tech is undefined. Skipped browser support check for that tech.`)}return""}selectSource(e){const t=this.options_.techOrder.map((e=>[e,Tech.getTech(e)])).filter((([e,t])=>t?t.isSupported():(log$1.error(`The "${e}" tech is undefined. Skipped browser support check for that tech.`),!1))),n=function(e,t,n){let r;return e.some((e=>t.some((t=>{if(r=n(e,t),r)return!0})))),r};let r;const a=([e,t],n)=>{if(t.canPlaySource(n,this.options_[e.toLowerCase()]))return{source:n,tech:e}};var i;return r=this.options_.sourceOrder?n(e,t,(i=a,(e,t)=>i(t,e))):n(t,e,a),r||!1}handleSrc_(e,t){if(void 0===e)return this.cache_.src||"";this.resetRetryOnError_&&this.resetRetryOnError_();const n=filterSource(e);if(n.length){if(this.changingSrc_=!0,t||(this.cache_.sources=n),this.updateSourceCaches_(n[0]),setSource(this,n[0],((e,r)=>{this.middleware_=r,t||(this.cache_.sources=n),this.updateSourceCaches_(e);if(this.src_(e))return n.length>1?this.handleSrc_(n.slice(1)):(this.changingSrc_=!1,this.setTimeout((function(){this.error({code:4,message:this.options_.notSupportedMessage})}),0),void this.triggerReady());setTech(r,this.tech_)})),n.length>1){const e=()=>{this.error(null),this.handleSrc_(n.slice(1),!0)},t=()=>{this.off("error",e)};this.one("error",e),this.one("playing",t),this.resetRetryOnError_=()=>{this.off("error",e),this.off("playing",t)}}}else this.setTimeout((function(){this.error({code:4,message:this.options_.notSupportedMessage})}),0)}src(e){return this.handleSrc_(e,!1)}src_(e){const t=this.selectSource([e]);return!t||(titleCaseEquals(t.tech,this.techName_)?(this.ready((function(){this.tech_.constructor.prototype.hasOwnProperty("setSource")?this.techCall_("setSource",e):this.techCall_("src",e.src),this.changingSrc_=!1}),!0),!1):(this.changingSrc_=!0,this.loadTech_(t.tech,t.source),this.tech_.ready((()=>{this.changingSrc_=!1})),!1))}load(){this.tech_&&this.tech_.vhs?this.src(this.currentSource()):this.techCall_("load")}reset(){if(this.paused())this.doReset_();else{silencePromise(this.play().then((()=>this.doReset_())))}}doReset_(){this.tech_&&this.tech_.clearTracks("text"),this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.resetCache_(),this.poster(""),this.loadTech_(this.options_.techOrder[0],null),this.techCall_("reset"),this.resetControlBarUI_(),this.error(null),this.titleBar&&this.titleBar.update({title:void 0,description:void 0}),isEvented(this)&&this.trigger("playerreset")}resetControlBarUI_(){this.resetProgressBar_(),this.resetPlaybackRate_(),this.resetVolumeBar_()}resetProgressBar_(){this.currentTime(0);const{currentTimeDisplay:e,durationDisplay:t,progressControl:n,remainingTimeDisplay:r}=this.controlBar||{},{seekBar:a}=n||{};e&&e.updateContent(),t&&t.updateContent(),r&&r.updateContent(),a&&(a.update(),a.loadProgressBar&&a.loadProgressBar.update())}resetPlaybackRate_(){this.playbackRate(this.defaultPlaybackRate()),this.handleTechRateChange_()}resetVolumeBar_(){this.volume(1),this.trigger("volumechange")}currentSources(){const e=this.currentSource(),t=[];return 0!==Object.keys(e).length&&t.push(e),this.cache_.sources||t}currentSource(){return this.cache_.source||{}}currentSrc(){return this.currentSource()&&this.currentSource().src||""}currentType(){return this.currentSource()&&this.currentSource().type||""}preload(e){return void 0!==e?(this.techCall_("setPreload",e),void(this.options_.preload=e)):this.techGet_("preload")}autoplay(e){if(void 0===e)return this.options_.autoplay||!1;let t;"string"==typeof e&&/(any|play|muted)/.test(e)||!0===e&&this.options_.normalizeAutoplay?(this.options_.autoplay=e,this.manualAutoplay_("string"==typeof e?e:"play"),t=!1):this.options_.autoplay=!!e,t=void 0===t?this.options_.autoplay:t,this.tech_&&this.techCall_("setAutoplay",t)}playsinline(e){return void 0!==e&&(this.techCall_("setPlaysinline",e),this.options_.playsinline=e),this.techGet_("playsinline")}loop(e){return void 0!==e?(this.techCall_("setLoop",e),void(this.options_.loop=e)):this.techGet_("loop")}poster(e){if(void 0===e)return this.poster_;e||(e=""),e!==this.poster_&&(this.poster_=e,this.techCall_("setPoster",e),this.isPosterFromTech_=!1,this.trigger("posterchange"))}handleTechPosterChange_(){if((!this.poster_||this.options_.techCanOverridePoster)&&this.tech_&&this.tech_.poster){const e=this.tech_.poster()||"";e!==this.poster_&&(this.poster_=e,this.isPosterFromTech_=!0,this.trigger("posterchange"))}}controls(e){if(void 0===e)return!!this.controls_;e=!!e,this.controls_!==e&&(this.controls_=e,this.usingNativeControls()&&this.techCall_("setControls",e),this.controls_?(this.removeClass("vjs-controls-disabled"),this.addClass("vjs-controls-enabled"),this.trigger("controlsenabled"),this.usingNativeControls()||this.addTechControlsListeners_()):(this.removeClass("vjs-controls-enabled"),this.addClass("vjs-controls-disabled"),this.trigger("controlsdisabled"),this.usingNativeControls()||this.removeTechControlsListeners_()))}usingNativeControls(e){if(void 0===e)return!!this.usingNativeControls_;e=!!e,this.usingNativeControls_!==e&&(this.usingNativeControls_=e,this.usingNativeControls_?(this.addClass("vjs-using-native-controls"),this.trigger("usingnativecontrols")):(this.removeClass("vjs-using-native-controls"),this.trigger("usingcustomcontrols")))}error(e){if(void 0===e)return this.error_||null;if(hooks("beforeerror").forEach((t=>{const n=t(this,e);isObject(n)&&!Array.isArray(n)||"string"==typeof n||"number"==typeof n||null===n?e=n:this.log.error("please return a value that MediaError expects in beforeerror hooks")})),this.options_.suppressNotSupportedError&&e&&4===e.code){const t=function(){this.error(e)};return this.options_.suppressNotSupportedError=!1,this.any(["click","touchstart"],t),void this.one("loadstart",(function(){this.off(["click","touchstart"],t)}))}if(null===e)return this.error_=null,this.removeClass("vjs-error"),void(this.errorDisplay&&this.errorDisplay.close());this.error_=new MediaError(e),this.addClass("vjs-error"),log$1.error(`(CODE:${this.error_.code} ${MediaError.errorTypes[this.error_.code]})`,this.error_.message,this.error_),this.trigger("error"),hooks("error").forEach((e=>e(this,this.error_)))}reportUserActivity(e){this.userActivity_=!0}userActive(e){if(void 0===e)return this.userActive_;if((e=!!e)!==this.userActive_){if(this.userActive_=e,this.userActive_)return this.userActivity_=!0,this.removeClass("vjs-user-inactive"),this.addClass("vjs-user-active"),void this.trigger("useractive");this.tech_&&this.tech_.one("mousemove",(function(e){e.stopPropagation(),e.preventDefault()})),this.userActivity_=!1,this.removeClass("vjs-user-active"),this.addClass("vjs-user-inactive"),this.trigger("userinactive")}}listenForUserActivity_(){let e,t,n;const r=bind_(this,this.reportUserActivity),a=function(t){r(),this.clearInterval(e)};this.on("mousedown",(function(){r(),this.clearInterval(e),e=this.setInterval(r,250)})),this.on("mousemove",(function(e){e.screenX===t&&e.screenY===n||(t=e.screenX,n=e.screenY,r())})),this.on("mouseup",a),this.on("mouseleave",a);const i=this.getChild("controlBar");let s;!i||IS_IOS||IS_ANDROID||(i.on("mouseenter",(function(e){0!==this.player().options_.inactivityTimeout&&(this.player().cache_.inactivityTimeout=this.player().options_.inactivityTimeout),this.player().options_.inactivityTimeout=0})),i.on("mouseleave",(function(e){this.player().options_.inactivityTimeout=this.player().cache_.inactivityTimeout}))),this.on("keydown",r),this.on("keyup",r);this.setInterval((function(){if(!this.userActivity_)return;this.userActivity_=!1,this.userActive(!0),this.clearTimeout(s);const e=this.options_.inactivityTimeout;e<=0||(s=this.setTimeout((function(){this.userActivity_||this.userActive(!1)}),e))}),250)}playbackRate(e){if(void 0===e)return this.tech_&&this.tech_.featuresPlaybackRate?this.cache_.lastPlaybackRate||this.techGet_("playbackRate"):1;this.techCall_("setPlaybackRate",e)}defaultPlaybackRate(e){return void 0!==e?this.techCall_("setDefaultPlaybackRate",e):this.tech_&&this.tech_.featuresPlaybackRate?this.techGet_("defaultPlaybackRate"):1}isAudio(e){if(void 0===e)return!!this.isAudio_;this.isAudio_=!!e}enableAudioOnlyUI_(){this.addClass("vjs-audio-only-mode");const e=this.children(),t=this.getChild("ControlBar"),n=t&&t.currentHeight();e.forEach((e=>{e!==t&&e.el_&&!e.hasClass("vjs-hidden")&&(e.hide(),this.audioOnlyCache_.hiddenChildren.push(e))})),this.audioOnlyCache_.playerHeight=this.currentHeight(),this.height(n),this.trigger("audioonlymodechange")}disableAudioOnlyUI_(){this.removeClass("vjs-audio-only-mode"),this.audioOnlyCache_.hiddenChildren.forEach((e=>e.show())),this.height(this.audioOnlyCache_.playerHeight),this.trigger("audioonlymodechange")}audioOnlyMode(e){if("boolean"!=typeof e||e===this.audioOnlyMode_)return this.audioOnlyMode_;if(this.audioOnlyMode_=e,e){const e=[];return this.isInPictureInPicture()&&e.push(this.exitPictureInPicture()),this.isFullscreen()&&e.push(this.exitFullscreen()),this.audioPosterMode()&&e.push(this.audioPosterMode(!1)),Promise.all(e).then((()=>this.enableAudioOnlyUI_()))}return Promise.resolve().then((()=>this.disableAudioOnlyUI_()))}enablePosterModeUI_(){(this.tech_&&this.tech_).hide(),this.addClass("vjs-audio-poster-mode"),this.trigger("audiopostermodechange")}disablePosterModeUI_(){(this.tech_&&this.tech_).show(),this.removeClass("vjs-audio-poster-mode"),this.trigger("audiopostermodechange")}audioPosterMode(e){if("boolean"!=typeof e||e===this.audioPosterMode_)return this.audioPosterMode_;if(this.audioPosterMode_=e,e){if(this.audioOnlyMode()){return this.audioOnlyMode(!1).then((()=>{this.enablePosterModeUI_()}))}return Promise.resolve().then((()=>{this.enablePosterModeUI_()}))}return Promise.resolve().then((()=>{this.disablePosterModeUI_()}))}addTextTrack(e,t,n){if(this.tech_)return this.tech_.addTextTrack(e,t,n)}addRemoteTextTrack(e,t){if(this.tech_)return this.tech_.addRemoteTextTrack(e,t)}removeRemoteTextTrack(e={}){let{track:t}=e;if(t||(t=e),this.tech_)return this.tech_.removeRemoteTextTrack(t)}getVideoPlaybackQuality(){return this.techGet_("getVideoPlaybackQuality")}videoWidth(){return this.tech_&&this.tech_.videoWidth&&this.tech_.videoWidth()||0}videoHeight(){return this.tech_&&this.tech_.videoHeight&&this.tech_.videoHeight()||0}language(e){if(void 0===e)return this.language_;this.language_!==String(e).toLowerCase()&&(this.language_=String(e).toLowerCase(),isEvented(this)&&this.trigger("languagechange"))}languages(){return merge$1(Player.prototype.options_.languages,this.languages_)}toJSON(){const e=merge$1(this.options_),t=e.tracks;e.tracks=[];for(let n=0;n<t.length;n++){let r=t[n];r=merge$1(r),r.player=void 0,e.tracks[n]=r}return e}createModal(e,t){(t=t||{}).content=e||"";const n=new ModalDialog(this,t);return this.addChild(n),n.on("dispose",(()=>{this.removeChild(n)})),n.open(),n}updateCurrentBreakpoint_(){if(!this.responsive())return;const e=this.currentBreakpoint(),t=this.currentWidth();for(let n=0;n<BREAKPOINT_ORDER.length;n++){const r=BREAKPOINT_ORDER[n];if(t<=this.breakpoints_[r]){if(e===r)return;e&&this.removeClass(BREAKPOINT_CLASSES[e]),this.addClass(BREAKPOINT_CLASSES[r]),this.breakpoint_=r;break}}}removeCurrentBreakpoint_(){const e=this.currentBreakpointClass();this.breakpoint_="",e&&this.removeClass(e)}breakpoints(e){return void 0===e||(this.breakpoint_="",this.breakpoints_=Object.assign({},DEFAULT_BREAKPOINTS,e),this.updateCurrentBreakpoint_()),Object.assign(this.breakpoints_)}responsive(e){if(void 0===e)return this.responsive_;return(e=Boolean(e))!==this.responsive_?(this.responsive_=e,e?(this.on("playerresize",this.boundUpdateCurrentBreakpoint_),this.updateCurrentBreakpoint_()):(this.off("playerresize",this.boundUpdateCurrentBreakpoint_),this.removeCurrentBreakpoint_()),e):void 0}currentBreakpoint(){return this.breakpoint_}currentBreakpointClass(){return BREAKPOINT_CLASSES[this.breakpoint_]||""}loadMedia(e,t){if(!e||"object"!=typeof e)return;const n=this.crossOrigin();this.reset(),this.cache_.media=merge$1(e);const{artist:r,artwork:a,description:i,poster:s,src:o,textTracks:l,title:u}=this.cache_.media;!a&&s&&(this.cache_.media.artwork=[{src:s,type:getMimetype(s)}]),n&&this.crossOrigin(n),o&&this.src(o),s&&this.poster(s),Array.isArray(l)&&l.forEach((e=>this.addRemoteTextTrack(e,!1))),this.titleBar&&this.titleBar.update({title:u,description:i||r||""}),this.ready(t)}getMedia(){if(!this.cache_.media){const e=this.poster(),t={src:this.currentSources(),textTracks:Array.prototype.map.call(this.remoteTextTracks(),(e=>({kind:e.kind,label:e.label,language:e.language,src:e.src})))};return e&&(t.poster=e,t.artwork=[{src:t.poster,type:getMimetype(t.poster)}]),t}return merge$1(this.cache_.media)}static getTagSettings(e){const t={sources:[],tracks:[]},n=getAttributes(e),r=n["data-setup"];if(hasClass(e,"vjs-fill")&&(n.fill=!0),hasClass(e,"vjs-fluid")&&(n.fluid=!0),null!==r){const[e,t]=safeParseTuple(r||"{}");e&&log$1.error(e),Object.assign(n,t)}if(Object.assign(t,n),e.hasChildNodes()){const n=e.childNodes;for(let e=0,r=n.length;e<r;e++){const r=n[e],a=r.nodeName.toLowerCase();"source"===a?t.sources.push(getAttributes(r)):"track"===a&&t.tracks.push(getAttributes(r))}}return t}debug(e){if(void 0===e)return this.debugEnabled_;e?(this.trigger("debugon"),this.previousLogLevel_=this.log.level,this.log.level("debug"),this.debugEnabled_=!0):(this.trigger("debugoff"),this.log.level(this.previousLogLevel_),this.previousLogLevel_=void 0,this.debugEnabled_=!1)}playbackRates(e){if(void 0===e)return this.cache_.playbackRates;Array.isArray(e)&&e.every((e=>"number"==typeof e))&&(this.cache_.playbackRates=e,this.trigger("playbackrateschange"))}}ALL.names.forEach((function(e){const t=ALL[e];Player.prototype[t.getterName]=function(){return this.tech_?this.tech_[t.getterName]():(this[t.privateName]=this[t.privateName]||new t.ListClass,this[t.privateName])}})),Player.prototype.crossorigin=Player.prototype.crossOrigin,Player.players={};const navigator$1=window$1$1.navigator;Player.prototype.options_={techOrder:Tech.defaultTechOrder_,html5:{},enableSourceset:!0,inactivityTimeout:2e3,playbackRates:[],liveui:!1,children:["mediaLoader","posterImage","titleBar","textTrackDisplay","loadingSpinner","bigPlayButton","liveTracker","controlBar","errorDisplay","textTrackSettings","resizeManager"],language:navigator$1&&(navigator$1.languages&&navigator$1.languages[0]||navigator$1.userLanguage||navigator$1.language)||"en",languages:{},notSupportedMessage:"No compatible source was found for this media.",normalizeAutoplay:!1,fullscreen:{options:{navigationUI:"hide"}},breakpoints:{},responsive:!1,audioOnlyMode:!1,audioPosterMode:!1,enableSmoothSeeking:!1},TECH_EVENTS_RETRIGGER.forEach((function(e){Player.prototype[`handleTech${toTitleCase$1(e)}_`]=function(){return this.trigger(e)}})),Component$1.registerComponent("Player",Player);const BASE_PLUGIN_NAME="plugin",PLUGIN_CACHE_KEY="activePlugins_",pluginStorage={},pluginExists=e=>pluginStorage.hasOwnProperty(e),getPlugin=e=>pluginExists(e)?pluginStorage[e]:void 0,markPluginAsActive=(e,t)=>{e[PLUGIN_CACHE_KEY]=e[PLUGIN_CACHE_KEY]||{},e[PLUGIN_CACHE_KEY][t]=!0},triggerSetupEvent=(e,t,n)=>{const r=(n?"before":"")+"pluginsetup";e.trigger(r,t),e.trigger(r+":"+t.name,t)},createBasicPlugin=function(e,t){const n=function(){triggerSetupEvent(this,{name:e,plugin:t,instance:null},!0);const n=t.apply(this,arguments);return markPluginAsActive(this,e),triggerSetupEvent(this,{name:e,plugin:t,instance:n}),n};return Object.keys(t).forEach((function(e){n[e]=t[e]})),n},createPluginFactory=(e,t)=>(t.prototype.name=e,function(...n){triggerSetupEvent(this,{name:e,plugin:t,instance:null},!0);const r=new t(...[this,...n]);return this[e]=()=>r,triggerSetupEvent(this,r.getEventHash()),r});class Plugin{constructor(e){if(this.constructor===Plugin)throw new Error("Plugin must be sub-classed; not directly instantiated.");this.player=e,this.log||(this.log=this.player.log.createLogger(this.name)),evented(this),delete this.trigger,stateful(this,this.constructor.defaultState),markPluginAsActive(e,this.name),this.dispose=this.dispose.bind(this),e.on("dispose",this.dispose)}version(){return this.constructor.VERSION}getEventHash(e={}){return e.name=this.name,e.plugin=this.constructor,e.instance=this,e}trigger(e,t={}){return trigger(this.eventBusEl_,e,this.getEventHash(t))}handleStateChanged(e){}dispose(){const{name:e,player:t}=this;this.trigger("dispose"),this.off(),t.off("dispose",this.dispose),t[PLUGIN_CACHE_KEY][e]=!1,this.player=this.state=null,t[e]=createPluginFactory(e,pluginStorage[e])}static isBasic(e){const t="string"==typeof e?getPlugin(e):e;return"function"==typeof t&&!Plugin.prototype.isPrototypeOf(t.prototype)}static registerPlugin(e,t){if("string"!=typeof e)throw new Error(`Illegal plugin name, "${e}", must be a string, was ${typeof e}.`);if(pluginExists(e))log$1.warn(`A plugin named "${e}" already exists. You may want to avoid re-registering plugins!`);else if(Player.prototype.hasOwnProperty(e))throw new Error(`Illegal plugin name, "${e}", cannot share a name with an existing player method!`);if("function"!=typeof t)throw new Error(`Illegal plugin for "${e}", must be a function, was ${typeof t}.`);return pluginStorage[e]=t,e!==BASE_PLUGIN_NAME&&(Plugin.isBasic(t)?Player.prototype[e]=createBasicPlugin(e,t):Player.prototype[e]=createPluginFactory(e,t)),t}static deregisterPlugin(e){if(e===BASE_PLUGIN_NAME)throw new Error("Cannot de-register base plugin.");pluginExists(e)&&(delete pluginStorage[e],delete Player.prototype[e])}static getPlugins(e=Object.keys(pluginStorage)){let t;return e.forEach((e=>{const n=getPlugin(e);n&&(t=t||{},t[e]=n)})),t}static getPluginVersion(e){const t=getPlugin(e);return t&&t.VERSION||""}}function deprecate(e,t){let n=!1;return function(...r){return n||log$1.warn(e),n=!0,t.apply(this,r)}}function deprecateForMajor(e,t,n,r){return deprecate(`${t} is deprecated and will be removed in ${e}.0; please use ${n} instead.`,r)}Plugin.getPlugin=getPlugin,Plugin.BASE_PLUGIN_NAME=BASE_PLUGIN_NAME,Plugin.registerPlugin(BASE_PLUGIN_NAME,Plugin),Player.prototype.usingPlugin=function(e){return!!this[PLUGIN_CACHE_KEY]&&!0===this[PLUGIN_CACHE_KEY][e]},Player.prototype.hasPlugin=function(e){return!!pluginExists(e)};const normalizeId=e=>0===e.indexOf("#")?e.slice(1):e;function videojs(e,t,n){let r=videojs.getPlayer(e);if(r)return t&&log$1.warn(`Player "${e}" is already initialised. Options will not be applied.`),n&&r.ready(n),r;const a="string"==typeof e?$("#"+normalizeId(e)):e;if(!isEl(a))throw new TypeError("The element or ID supplied is not valid. (videojs)");const i="getRootNode"in a&&a.getRootNode()instanceof window$1$1.ShadowRoot?a.getRootNode():a.ownerDocument.body;a.ownerDocument.defaultView&&i.contains(a)||log$1.warn("The element supplied is not included in the DOM"),!0===(t=t||{}).restoreEl&&(t.restoreEl=(a.parentNode&&a.parentNode.hasAttribute("data-vjs-player")?a.parentNode:a).cloneNode(!0)),hooks("beforesetup").forEach((e=>{const n=e(a,merge$1(t));isObject(n)&&!Array.isArray(n)?t=merge$1(t,n):log$1.error("please return an object in beforesetup hooks")}));const s=Component$1.getComponent("Player");return r=new s(a,t,n),hooks("setup").forEach((e=>e(r))),r}if(videojs.hooks_=hooks_,videojs.hooks=hooks,videojs.hook=hook,videojs.hookOnce=hookOnce,videojs.removeHook=removeHook,!0!==window$1$1.VIDEOJS_NO_DYNAMIC_STYLE&&isReal()){let e=$(".vjs-styles-defaults");if(!e){e=createStyleElement("vjs-styles-defaults");const t=$("head");t&&t.insertBefore(e,t.firstChild),setTextContent(e,"\n      .video-js {\n        width: 300px;\n        height: 150px;\n      }\n\n      .vjs-fluid:not(.vjs-audio-only-mode) {\n        padding-top: 56.25%\n      }\n    ")}}autoSetupTimeout(1,videojs),videojs.VERSION=version$6,videojs.options=Player.prototype.options_,videojs.getPlayers=()=>Player.players,videojs.getPlayer=e=>{const t=Player.players;let n;if("string"==typeof e){const r=normalizeId(e),a=t[r];if(a)return a;n=$("#"+r)}else n=e;if(isEl(n)){const{player:e,playerId:r}=n;if(e||t[r])return e||t[r]}},videojs.getAllPlayers=()=>Object.keys(Player.players).map((e=>Player.players[e])).filter(Boolean),videojs.players=Player.players,videojs.getComponent=Component$1.getComponent,videojs.registerComponent=(e,t)=>(Tech.isTech(t)&&log$1.warn(`The ${e} tech was registered as a component. It should instead be registered using videojs.registerTech(name, tech)`),Component$1.registerComponent.call(Component$1,e,t)),videojs.getTech=Tech.getTech,videojs.registerTech=Tech.registerTech,videojs.use=use,Object.defineProperty(videojs,"middleware",{value:{},writeable:!1,enumerable:!0}),Object.defineProperty(videojs.middleware,"TERMINATOR",{value:TERMINATOR,writeable:!1,enumerable:!0}),videojs.browser=browser,videojs.obj=Obj,videojs.mergeOptions=deprecateForMajor(9,"videojs.mergeOptions","videojs.obj.merge",merge$1),videojs.defineLazyProperty=deprecateForMajor(9,"videojs.defineLazyProperty","videojs.obj.defineLazyProperty",defineLazyProperty),videojs.bind=deprecateForMajor(9,"videojs.bind","native Function.prototype.bind",bind_),videojs.registerPlugin=Plugin.registerPlugin,videojs.deregisterPlugin=Plugin.deregisterPlugin,videojs.plugin=(e,t)=>(log$1.warn("videojs.plugin() is deprecated; use videojs.registerPlugin() instead"),Plugin.registerPlugin(e,t)),videojs.getPlugins=Plugin.getPlugins,videojs.getPlugin=Plugin.getPlugin,videojs.getPluginVersion=Plugin.getPluginVersion,videojs.addLanguage=function(e,t){return e=(""+e).toLowerCase(),videojs.options.languages=merge$1(videojs.options.languages,{[e]:t}),videojs.options.languages[e]},videojs.log=log$1,videojs.createLogger=createLogger,videojs.time=Time,videojs.createTimeRange=deprecateForMajor(9,"videojs.createTimeRange","videojs.time.createTimeRanges",createTimeRanges$1),videojs.createTimeRanges=deprecateForMajor(9,"videojs.createTimeRanges","videojs.time.createTimeRanges",createTimeRanges$1),videojs.formatTime=deprecateForMajor(9,"videojs.formatTime","videojs.time.formatTime",formatTime),videojs.setFormatTime=deprecateForMajor(9,"videojs.setFormatTime","videojs.time.setFormatTime",setFormatTime),videojs.resetFormatTime=deprecateForMajor(9,"videojs.resetFormatTime","videojs.time.resetFormatTime",resetFormatTime),videojs.parseUrl=deprecateForMajor(9,"videojs.parseUrl","videojs.url.parseUrl",parseUrl),videojs.isCrossOrigin=deprecateForMajor(9,"videojs.isCrossOrigin","videojs.url.isCrossOrigin",isCrossOrigin),videojs.EventTarget=EventTarget$2,videojs.any=any,videojs.on=on,videojs.one=one,videojs.off=off,videojs.trigger=trigger,videojs.xhr=XHR,videojs.TextTrack=TextTrack,videojs.AudioTrack=AudioTrack,videojs.VideoTrack=VideoTrack,["isEl","isTextNode","createEl","hasClass","addClass","removeClass","toggleClass","setAttributes","getAttributes","emptyEl","appendContent","insertContent"].forEach((e=>{videojs[e]=function(){return log$1.warn(`videojs.${e}() is deprecated; use videojs.dom.${e}() instead`),Dom[e].apply(null,arguments)}})),videojs.computedStyle=deprecateForMajor(9,"videojs.computedStyle","videojs.dom.computedStyle",computedStyle),videojs.dom=Dom,videojs.fn=Fn,videojs.num=Num,videojs.str=Str,videojs.url=Url;
/*! @name videojs-contrib-quality-levels @version 4.0.0 @license Apache-2.0 */
class QualityLevel{constructor(e){let t=this;return t.id=e.id,t.label=t.id,t.width=e.width,t.height=e.height,t.bitrate=e.bandwidth,t.frameRate=e.frameRate,t.enabled_=e.enabled,Object.defineProperty(t,"enabled",{get:()=>t.enabled_(),set(e){t.enabled_(e)}}),t}}class QualityLevelList extends videojs.EventTarget{constructor(){super();let e=this;return e.levels_=[],e.selectedIndex_=-1,Object.defineProperty(e,"selectedIndex",{get:()=>e.selectedIndex_}),Object.defineProperty(e,"length",{get:()=>e.levels_.length}),e[Symbol.iterator]=()=>e.levels_.values(),e}addQualityLevel(e){let t=this.getQualityLevelById(e.id);if(t)return t;const n=this.levels_.length;return t=new QualityLevel(e),""+n in this||Object.defineProperty(this,n,{get(){return this.levels_[n]}}),this.levels_.push(t),this.trigger({qualityLevel:t,type:"addqualitylevel"}),t}removeQualityLevel(e){let t=null;for(let n=0,r=this.length;n<r;n++)if(this[n]===e){t=this.levels_.splice(n,1)[0],this.selectedIndex_===n?this.selectedIndex_=-1:this.selectedIndex_>n&&this.selectedIndex_--;break}return t&&this.trigger({qualityLevel:e,type:"removequalitylevel"}),t}getQualityLevelById(e){for(let t=0,n=this.length;t<n;t++){const n=this[t];if(n.id===e)return n}return null}dispose(){this.selectedIndex_=-1,this.levels_.length=0}}QualityLevelList.prototype.allowedEvents_={change:"change",addqualitylevel:"addqualitylevel",removequalitylevel:"removequalitylevel"};for(const m in QualityLevelList.prototype.allowedEvents_)QualityLevelList.prototype["on"+m]=null;var version$5="4.0.0";const initPlugin$1=function(e,t){const n=e.qualityLevels,r=new QualityLevelList,a=function(){r.dispose(),e.qualityLevels=n,e.off("dispose",a)};return e.on("dispose",a),e.qualityLevels=()=>r,e.qualityLevels.VERSION=version$5,r},qualityLevels=function(e){return initPlugin$1(this,videojs.obj.merge({},e))};videojs.registerPlugin("qualityLevels",qualityLevels),qualityLevels.VERSION=version$5;
/*! @name @videojs/http-streaming @version 3.10.0 @license Apache-2.0 */
const resolveUrl=resolveUrl$1,resolveManifestRedirect=(e,t)=>t&&t.responseURL&&e!==t.responseURL?t.responseURL:e,logger=e=>videojs.log.debug?videojs.log.debug.bind(videojs,"VHS:",`${e} >`):function(){};function merge(...e){const t=videojs.obj||videojs;return(t.merge||t.mergeOptions).apply(t,e)}function createTimeRanges(...e){const t=videojs.time||videojs;return(t.createTimeRanges||t.createTimeRanges).apply(t,e)}const TIME_FUDGE_FACTOR=1/30,SAFE_TIME_DELTA=3*TIME_FUDGE_FACTOR,filterRanges=function(e,t){const n=[];let r;if(e&&e.length)for(r=0;r<e.length;r++)t(e.start(r),e.end(r))&&n.push([e.start(r),e.end(r)]);return createTimeRanges(n)},findRange=function(e,t){return filterRanges(e,(function(e,n){return e-SAFE_TIME_DELTA<=t&&n+SAFE_TIME_DELTA>=t}))},findNextRange=function(e,t){return filterRanges(e,(function(e){return e-TIME_FUDGE_FACTOR>=t}))},findGaps=function(e){if(e.length<2)return createTimeRanges();const t=[];for(let n=1;n<e.length;n++){const r=e.end(n-1),a=e.start(n);t.push([r,a])}return createTimeRanges(t)},bufferIntersection=function(e,t){let n=null,r=null,a=0;const i=[],s=[];if(!(e&&e.length&&t&&t.length))return createTimeRanges();let o=e.length;for(;o--;)i.push({time:e.start(o),type:"start"}),i.push({time:e.end(o),type:"end"});for(o=t.length;o--;)i.push({time:t.start(o),type:"start"}),i.push({time:t.end(o),type:"end"});for(i.sort((function(e,t){return e.time-t.time})),o=0;o<i.length;o++)"start"===i[o].type?(a++,2===a&&(n=i[o].time)):"end"===i[o].type&&(a--,1===a&&(r=i[o].time)),null!==n&&null!==r&&(s.push([n,r]),n=null,r=null);return createTimeRanges(s)},printableRange=e=>{const t=[];if(!e||!e.length)return"";for(let n=0;n<e.length;n++)t.push(e.start(n)+" => "+e.end(n));return t.join(", ")},timeUntilRebuffer=function(e,t,n=1){return((e.length?e.end(e.length-1):0)-t)/n},timeRangesToArray=e=>{const t=[];for(let n=0;n<e.length;n++)t.push({start:e.start(n),end:e.end(n)});return t},isRangeDifferent=function(e,t){if(e===t)return!1;if(!e&&t||!t&&e)return!0;if(e.length!==t.length)return!0;for(let n=0;n<e.length;n++)if(e.start(n)!==t.start(n)||e.end(n)!==t.end(n))return!0;return!1},lastBufferedEnd=function(e){if(e&&e.length&&e.end)return e.end(e.length-1)},timeAheadOf=function(e,t){let n=0;if(!e||!e.length)return n;for(let r=0;r<e.length;r++){const a=e.start(r),i=e.end(r);t>i||(n+=t>a&&t<=i?i-t:i-a)}return n},segmentDurationWithParts=(e,t)=>{if(!t.preload)return t.duration;let n=0;return(t.parts||[]).forEach((function(e){n+=e.duration})),(t.preloadHints||[]).forEach((function(t){"PART"===t.type&&(n+=e.partTargetDuration)})),n},getPartsAndSegments=e=>(e.segments||[]).reduce(((e,t,n)=>(t.parts?t.parts.forEach((function(r,a){e.push({duration:r.duration,segmentIndex:n,partIndex:a,part:r,segment:t})})):e.push({duration:t.duration,segmentIndex:n,partIndex:null,segment:t,part:null}),e)),[]),getLastParts=e=>{const t=e.segments&&e.segments.length&&e.segments[e.segments.length-1];return t&&t.parts||[]},getKnownPartCount=({preloadSegment:e})=>{if(!e)return;const{parts:t,preloadHints:n}=e;let r=(n||[]).reduce(((e,t)=>e+("PART"===t.type?1:0)),0);return r+=t&&t.length?t.length:0,r},liveEdgeDelay=(e,t)=>{if(t.endList)return 0;if(e&&e.suggestedPresentationDelay)return e.suggestedPresentationDelay;const n=getLastParts(t).length>0;return n&&t.serverControl&&t.serverControl.partHoldBack?t.serverControl.partHoldBack:n&&t.partTargetDuration?3*t.partTargetDuration:t.serverControl&&t.serverControl.holdBack?t.serverControl.holdBack:t.targetDuration?3*t.targetDuration:0},backwardDuration=function(e,t){let n=0,r=t-e.mediaSequence,a=e.segments[r];if(a){if(void 0!==a.start)return{result:a.start,precise:!0};if(void 0!==a.end)return{result:a.end-a.duration,precise:!0}}for(;r--;){if(a=e.segments[r],void 0!==a.end)return{result:n+a.end,precise:!0};if(n+=segmentDurationWithParts(e,a),void 0!==a.start)return{result:n+a.start,precise:!0}}return{result:n,precise:!1}},forwardDuration=function(e,t){let n,r=0,a=t-e.mediaSequence;for(;a<e.segments.length;a++){if(n=e.segments[a],void 0!==n.start)return{result:n.start-r,precise:!0};if(r+=segmentDurationWithParts(e,n),void 0!==n.end)return{result:n.end-r,precise:!0}}return{result:-1,precise:!1}},intervalDuration=function(e,t,n){if(void 0===t&&(t=e.mediaSequence+e.segments.length),t<e.mediaSequence)return 0;const r=backwardDuration(e,t);if(r.precise)return r.result;const a=forwardDuration(e,t);return a.precise?a.result:r.result+n},duration=function(e,t,n){if(!e)return 0;if("number"!=typeof n&&(n=0),void 0===t){if(e.totalDuration)return e.totalDuration;if(!e.endList)return window$1$1.Infinity}return intervalDuration(e,t,n)},sumDurations=function({defaultDuration:e,durationList:t,startIndex:n,endIndex:r}){let a=0;if(n>r&&([n,r]=[r,n]),n<0){for(let t=n;t<Math.min(0,r);t++)a+=e;n=0}for(let i=n;i<r;i++)a+=t[i].duration;return a},playlistEnd=function(e,t,n,r){if(!e||!e.segments)return null;if(e.endList)return duration(e);if(null===t)return null;t=t||0;let a=intervalDuration(e,e.mediaSequence+e.segments.length,t);return n&&(a-=r="number"==typeof r?r:liveEdgeDelay(null,e)),Math.max(0,a)},seekable=function(e,t,n){const r=t||0;let a=playlistEnd(e,t,!0,n);return null===a?createTimeRanges():(a<r&&(a=r),createTimeRanges(r,a))},getMediaInfoForTime=function({playlist:e,currentTime:t,startingSegmentIndex:n,startingPartIndex:r,startTime:a,exactManifestTimings:i}){let s=t-a;const o=getPartsAndSegments(e);let l=0;for(let u=0;u<o.length;u++){const e=o[u];if(n===e.segmentIndex&&("number"!=typeof r||"number"!=typeof e.partIndex||r===e.partIndex)){l=u;break}}if(s<0){if(l>0)for(let t=l-1;t>=0;t--){const n=o[t];if(s+=n.duration,i){if(s<0)continue}else if(s+TIME_FUDGE_FACTOR<=0)continue;return{partIndex:n.partIndex,segmentIndex:n.segmentIndex,startTime:a-sumDurations({defaultDuration:e.targetDuration,durationList:o,startIndex:l,endIndex:t})}}return{partIndex:o[0]&&o[0].partIndex||null,segmentIndex:o[0]&&o[0].segmentIndex||0,startTime:t}}if(l<0){for(let n=l;n<0;n++)if(s-=e.targetDuration,s<0)return{partIndex:o[0]&&o[0].partIndex||null,segmentIndex:o[0]&&o[0].segmentIndex||0,startTime:t};l=0}for(let u=l;u<o.length;u++){const t=o[u];s-=t.duration;const n=t.duration>TIME_FUDGE_FACTOR;if(!(0===s)&&!(n&&s+TIME_FUDGE_FACTOR>=0)||u===o.length-1){if(i){if(s>0)continue}else if(s-TIME_FUDGE_FACTOR>=0)continue;return{partIndex:t.partIndex,segmentIndex:t.segmentIndex,startTime:a+sumDurations({defaultDuration:e.targetDuration,durationList:o,startIndex:l,endIndex:u})}}}return{segmentIndex:o[o.length-1].segmentIndex,partIndex:o[o.length-1].partIndex,startTime:t}},isExcluded=function(e){return e.excludeUntil&&e.excludeUntil>Date.now()},isIncompatible=function(e){return e.excludeUntil&&e.excludeUntil===1/0},isEnabled=function(e){const t=isExcluded(e);return!e.disabled&&!t},isDisabled=function(e){return e.disabled},isAes=function(e){for(let t=0;t<e.segments.length;t++)if(e.segments[t].key)return!0;return!1},hasAttribute=function(e,t){return t.attributes&&t.attributes[e]},estimateSegmentRequestTime=function(e,t,n,r=0){if(!hasAttribute("BANDWIDTH",n))return NaN;return(e*n.attributes.BANDWIDTH-8*r)/t},isLowestEnabledRendition=(e,t)=>{if(1===e.playlists.length)return!0;const n=t.attributes.BANDWIDTH||Number.MAX_VALUE;return 0===e.playlists.filter((e=>!!isEnabled(e)&&(e.attributes.BANDWIDTH||0)<n)).length},playlistMatch=(e,t)=>!(!e&&!t||!e&&t||e&&!t)&&(e===t||(!(!e.id||!t.id||e.id!==t.id)||(!(!e.resolvedUri||!t.resolvedUri||e.resolvedUri!==t.resolvedUri)||!(!e.uri||!t.uri||e.uri!==t.uri)))),someAudioVariant=function(e,t){const n=e&&e.mediaGroups&&e.mediaGroups.AUDIO||{};let r=!1;for(const a in n){for(const e in n[a])if(r=t(n[a][e]),r)break;if(r)break}return!!r},isAudioOnly=e=>{if(!e||!e.playlists||!e.playlists.length){return someAudioVariant(e,(e=>e.playlists&&e.playlists.length||e.uri))}for(let t=0;t<e.playlists.length;t++){const n=e.playlists[t],r=n.attributes&&n.attributes.CODECS;if(r&&r.split(",").every((e=>isAudioCodec(e))))continue;if(!someAudioVariant(e,(e=>playlistMatch(n,e))))return!1}return!0};var Playlist={liveEdgeDelay:liveEdgeDelay,duration:duration,seekable:seekable,getMediaInfoForTime:getMediaInfoForTime,isEnabled:isEnabled,isDisabled:isDisabled,isExcluded:isExcluded,isIncompatible:isIncompatible,playlistEnd:playlistEnd,isAes:isAes,hasAttribute:hasAttribute,estimateSegmentRequestTime:estimateSegmentRequestTime,isLowestEnabledRendition:isLowestEnabledRendition,isAudioOnly:isAudioOnly,playlistMatch:playlistMatch,segmentDurationWithParts:segmentDurationWithParts};const{log:log}=videojs,createPlaylistID=(e,t)=>`${e}-${t}`,groupID=(e,t,n)=>`placeholder-uri-${e}-${t}-${n}`,parseManifest=({onwarn:e,oninfo:t,manifestString:n,customTagParsers:r=[],customTagMappers:a=[],llhls:i})=>{const s=new Parser;e&&s.on("warn",e),t&&s.on("info",t),r.forEach((e=>s.addParser(e))),a.forEach((e=>s.addTagMapper(e))),s.push(n),s.end();const o=s.manifest;if(i||(["preloadSegment","skip","serverControl","renditionReports","partInf","partTargetDuration"].forEach((function(e){o.hasOwnProperty(e)&&delete o[e]})),o.segments&&o.segments.forEach((function(e){["parts","preloadHints"].forEach((function(t){e.hasOwnProperty(t)&&delete e[t]}))}))),!o.targetDuration){let t=10;o.segments&&o.segments.length&&(t=o.segments.reduce(((e,t)=>Math.max(e,t.duration)),0)),e&&e({message:`manifest has no targetDuration defaulting to ${t}`}),o.targetDuration=t}const l=getLastParts(o);if(l.length&&!o.partTargetDuration){const t=l.reduce(((e,t)=>Math.max(e,t.duration)),0);e&&(e({message:`manifest has no partTargetDuration defaulting to ${t}`}),log.error("LL-HLS manifest has parts but lacks required #EXT-X-PART-INF:PART-TARGET value. See https://datatracker.ietf.org/doc/html/draft-pantos-hls-rfc8216bis-09#section-4.4.3.7. Playback is not guaranteed.")),o.partTargetDuration=t}return o},forEachMediaGroup=(e,t)=>{e.mediaGroups&&["AUDIO","SUBTITLES"].forEach((n=>{if(e.mediaGroups[n])for(const r in e.mediaGroups[n])for(const a in e.mediaGroups[n][r]){const i=e.mediaGroups[n][r][a];t(i,n,r,a)}}))},setupMediaPlaylist=({playlist:e,uri:t,id:n})=>{e.id=n,e.playlistErrors_=0,t&&(e.uri=t),e.attributes=e.attributes||{}},setupMediaPlaylists=e=>{let t=e.playlists.length;for(;t--;){const n=e.playlists[t];setupMediaPlaylist({playlist:n,id:createPlaylistID(t,n.uri)}),n.resolvedUri=resolveUrl(e.uri,n.uri),e.playlists[n.id]=n,e.playlists[n.uri]=n,n.attributes.BANDWIDTH||log.warn("Invalid playlist STREAM-INF detected. Missing BANDWIDTH attribute.")}},resolveMediaGroupUris=e=>{forEachMediaGroup(e,(t=>{t.uri&&(t.resolvedUri=resolveUrl(e.uri,t.uri))}))},mainForMedia=(e,t)=>{const n=createPlaylistID(0,t),r={mediaGroups:{AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},uri:window$1$1.location.href,resolvedUri:window$1$1.location.href,playlists:[{uri:t,id:n,resolvedUri:t,attributes:{}}]};return r.playlists[n]=r.playlists[0],r.playlists[t]=r.playlists[0],r},addPropertiesToMain=(e,t,n=groupID)=>{e.uri=t;for(let a=0;a<e.playlists.length;a++)if(!e.playlists[a].uri){const t=`placeholder-uri-${a}`;e.playlists[a].uri=t}const r=isAudioOnly(e);forEachMediaGroup(e,((t,a,i,s)=>{if(!t.playlists||!t.playlists.length){if(r&&"AUDIO"===a&&!t.uri)for(let t=0;t<e.playlists.length;t++){const n=e.playlists[t];if(n.attributes&&n.attributes.AUDIO&&n.attributes.AUDIO===i)return}t.playlists=[_extends$2({},t)]}t.playlists.forEach((function(t,r){const o=n(a,i,s,t),l=createPlaylistID(r,o);t.uri?t.resolvedUri=t.resolvedUri||resolveUrl(e.uri,t.uri):(t.uri=0===r?o:l,t.resolvedUri=t.uri),t.id=t.id||l,t.attributes=t.attributes||{},e.playlists[t.id]=t,e.playlists[t.uri]=t}))})),setupMediaPlaylists(e),resolveMediaGroupUris(e)};class DateRangesStorage{constructor(){this.offset_=null,this.pendingDateRanges_=new Map,this.processedDateRanges_=new Map}setOffset(e=[]){if(null!==this.offset_)return;if(!e.length)return;const[t]=e;void 0!==t.programDateTime&&(this.offset_=t.programDateTime/1e3)}setPendingDateRanges(e=[]){if(!e.length)return;const[t]=e,n=t.startDate.getTime();this.trimProcessedDateRanges_(n),this.pendingDateRanges_=e.reduce(((e,t)=>(e.set(t.id,t),e)),new Map)}processDateRange(e){this.pendingDateRanges_.delete(e.id),this.processedDateRanges_.set(e.id,e)}getDateRangesToProcess(){if(null===this.offset_)return[];const e={},t=[];this.pendingDateRanges_.forEach(((n,r)=>{if(!this.processedDateRanges_.has(r)&&(n.startTime=n.startDate.getTime()/1e3-this.offset_,n.processDateRange=()=>this.processDateRange(n),t.push(n),n.class))if(e[n.class]){const t=e[n.class].push(n);n.classListIndex=t-1}else e[n.class]=[n],n.classListIndex=0}));for(const n of t){const t=e[n.class]||[];n.endDate?n.endTime=n.endDate.getTime()/1e3-this.offset_:n.endOnNext&&t[n.classListIndex+1]?n.endTime=t[n.classListIndex+1].startTime:n.duration?n.endTime=n.startTime+n.duration:n.plannedDuration?n.endTime=n.startTime+n.plannedDuration:n.endTime=n.startTime}return t}trimProcessedDateRanges_(e){new Map(this.processedDateRanges_).forEach(((t,n)=>{t.startDate.getTime()<e&&this.processedDateRanges_.delete(n)}))}}const{EventTarget:EventTarget$1}=videojs,addLLHLSQueryDirectives=(e,t)=>{if(t.endList||!t.serverControl)return e;const n={};if(t.serverControl.canBlockReload){const{preloadSegment:e}=t;let r=t.mediaSequence+t.segments.length;if(e){const a=e.parts||[],i=getKnownPartCount(t)-1;i>-1&&i!==a.length-1&&(n._HLS_part=i),(i>-1||a.length)&&r--}n._HLS_msn=r}if(t.serverControl&&t.serverControl.canSkipUntil&&(n._HLS_skip=t.serverControl.canSkipDateranges?"v2":"YES"),Object.keys(n).length){const t=new window$1$1.URL(e);["_HLS_skip","_HLS_msn","_HLS_part"].forEach((function(e){n.hasOwnProperty(e)&&t.searchParams.set(e,n[e])})),e=t.toString()}return e},updateSegment=(e,t)=>{if(!e)return t;const n=merge(e,t);if(e.preloadHints&&!t.preloadHints&&delete n.preloadHints,e.parts&&!t.parts)delete n.parts;else if(e.parts&&t.parts)for(let r=0;r<t.parts.length;r++)e.parts&&e.parts[r]&&(n.parts[r]=merge(e.parts[r],t.parts[r]));return!e.skipped&&t.skipped&&(n.skipped=!1),e.preload&&!t.preload&&(n.preload=!1),n},updateSegments=(e,t,n)=>{const r=e.slice(),a=t.slice();n=n||0;const i=[];let s;for(let o=0;o<a.length;o++){const e=r[o+n],t=a[o];e?(s=e.map||s,i.push(updateSegment(e,t))):(s&&!t.map&&(t.map=s),i.push(t))}return i},resolveSegmentUris=(e,t)=>{!e.resolvedUri&&e.uri&&(e.resolvedUri=resolveUrl(t,e.uri)),e.key&&!e.key.resolvedUri&&(e.key.resolvedUri=resolveUrl(t,e.key.uri)),e.map&&!e.map.resolvedUri&&(e.map.resolvedUri=resolveUrl(t,e.map.uri)),e.map&&e.map.key&&!e.map.key.resolvedUri&&(e.map.key.resolvedUri=resolveUrl(t,e.map.key.uri)),e.parts&&e.parts.length&&e.parts.forEach((e=>{e.resolvedUri||(e.resolvedUri=resolveUrl(t,e.uri))})),e.preloadHints&&e.preloadHints.length&&e.preloadHints.forEach((e=>{e.resolvedUri||(e.resolvedUri=resolveUrl(t,e.uri))}))},getAllSegments=function(e){const t=e.segments||[],n=e.preloadSegment;if(n&&n.parts&&n.parts.length){if(n.preloadHints)for(let e=0;e<n.preloadHints.length;e++)if("MAP"===n.preloadHints[e].type)return t;n.duration=e.targetDuration,n.preload=!0,t.push(n)}return t},isPlaylistUnchanged=(e,t)=>e===t||e.segments&&t.segments&&e.segments.length===t.segments.length&&e.endList===t.endList&&e.mediaSequence===t.mediaSequence&&e.preloadSegment===t.preloadSegment,updateMain$1=(e,t,n=isPlaylistUnchanged)=>{const r=merge(e,{}),a=r.playlists[t.id];if(!a)return null;if(n(a,t))return null;t.segments=getAllSegments(t);const i=merge(a,t);if(i.preloadSegment&&!t.preloadSegment&&delete i.preloadSegment,a.segments){if(t.skip){t.segments=t.segments||[];for(let e=0;e<t.skip.skippedSegments;e++)t.segments.unshift({skipped:!0})}i.segments=updateSegments(a.segments,t.segments,t.mediaSequence-a.mediaSequence)}i.segments.forEach((e=>{resolveSegmentUris(e,i.resolvedUri)}));for(let s=0;s<r.playlists.length;s++)r.playlists[s].id===t.id&&(r.playlists[s]=i);return r.playlists[t.id]=i,r.playlists[t.uri]=i,forEachMediaGroup(e,((e,n,r,a)=>{if(e.playlists)for(let s=0;s<e.playlists.length;s++)t.id===e.playlists[s].id&&(e.playlists[s]=i)})),r},refreshDelay=(e,t)=>{const n=e.segments||[],r=n[n.length-1],a=r&&r.parts&&r.parts[r.parts.length-1],i=a&&a.duration||r&&r.duration;return t&&i?1e3*i:500*(e.partTargetDuration||e.targetDuration||10)};class PlaylistLoader extends EventTarget$1{constructor(e,t,n={}){if(super(),!e)throw new Error("A non-empty playlist URL or object is required");this.logger_=logger("PlaylistLoader");const{withCredentials:r=!1}=n;this.src=e,this.vhs_=t,this.withCredentials=r,this.addDateRangesToTextTrack_=n.addDateRangesToTextTrack;const a=t.options_;this.customTagParsers=a&&a.customTagParsers||[],this.customTagMappers=a&&a.customTagMappers||[],this.llhls=a&&a.llhls,this.dateRangesStorage_=new DateRangesStorage,this.state="HAVE_NOTHING",this.handleMediaupdatetimeout_=this.handleMediaupdatetimeout_.bind(this),this.on("mediaupdatetimeout",this.handleMediaupdatetimeout_),this.on("loadedplaylist",this.handleLoadedPlaylist_.bind(this))}handleLoadedPlaylist_(){const e=this.media();if(!e)return;this.dateRangesStorage_.setOffset(e.segments),this.dateRangesStorage_.setPendingDateRanges(e.dateRanges);const t=this.dateRangesStorage_.getDateRangesToProcess();t.length&&this.addDateRangesToTextTrack_&&this.addDateRangesToTextTrack_(t)}handleMediaupdatetimeout_(){if("HAVE_METADATA"!==this.state)return;const e=this.media();let t=resolveUrl(this.main.uri,e.uri);this.llhls&&(t=addLLHLSQueryDirectives(t,e)),this.state="HAVE_CURRENT_METADATA",this.request=this.vhs_.xhr({uri:t,withCredentials:this.withCredentials},((e,t)=>{if(this.request)return e?this.playlistRequestError(this.request,this.media(),"HAVE_METADATA"):void this.haveMetadata({playlistString:this.request.responseText,url:this.media().uri,id:this.media().id})}))}playlistRequestError(e,t,n){const{uri:r,id:a}=t;this.request=null,n&&(this.state=n),this.error={playlist:this.main.playlists[a],status:e.status,message:`HLS playlist request error at URL: ${r}.`,responseText:e.responseText,code:e.status>=500?4:2},this.trigger("error")}parseManifest_({url:e,manifestString:t}){return parseManifest({onwarn:({message:t})=>this.logger_(`m3u8-parser warn for ${e}: ${t}`),oninfo:({message:t})=>this.logger_(`m3u8-parser info for ${e}: ${t}`),manifestString:t,customTagParsers:this.customTagParsers,customTagMappers:this.customTagMappers,llhls:this.llhls})}haveMetadata({playlistString:e,playlistObject:t,url:n,id:r}){this.request=null,this.state="HAVE_METADATA";const a=t||this.parseManifest_({url:n,manifestString:e});a.lastRequest=Date.now(),setupMediaPlaylist({playlist:a,uri:n,id:r});const i=updateMain$1(this.main,a);this.targetDuration=a.partTargetDuration||a.targetDuration,this.pendingMedia_=null,i?(this.main=i,this.media_=this.main.playlists[r]):this.trigger("playlistunchanged"),this.updateMediaUpdateTimeout_(refreshDelay(this.media(),!!i)),this.trigger("loadedplaylist")}dispose(){this.trigger("dispose"),this.stopRequest(),window$1$1.clearTimeout(this.mediaUpdateTimeout),window$1$1.clearTimeout(this.finalRenditionTimeout),this.dateRangesStorage_=new DateRangesStorage,this.off()}stopRequest(){if(this.request){const e=this.request;this.request=null,e.onreadystatechange=null,e.abort()}}media(e,t){if(!e)return this.media_;if("HAVE_NOTHING"===this.state)throw new Error("Cannot switch media playlist from "+this.state);if("string"==typeof e){if(!this.main.playlists[e])throw new Error("Unknown playlist URI: "+e);e=this.main.playlists[e]}if(window$1$1.clearTimeout(this.finalRenditionTimeout),t){const t=(e.partTargetDuration||e.targetDuration)/2*1e3||5e3;return void(this.finalRenditionTimeout=window$1$1.setTimeout(this.media.bind(this,e,!1),t))}const n=this.state,r=!this.media_||e.id!==this.media_.id,a=this.main.playlists[e.id];if(a&&a.endList||e.endList&&e.segments.length)return this.request&&(this.request.onreadystatechange=null,this.request.abort(),this.request=null),this.state="HAVE_METADATA",this.media_=e,void(r&&(this.trigger("mediachanging"),"HAVE_MAIN_MANIFEST"===n?this.trigger("loadedmetadata"):this.trigger("mediachange")));if(this.updateMediaUpdateTimeout_(refreshDelay(e,!0)),r){if(this.state="SWITCHING_MEDIA",this.request){if(e.resolvedUri===this.request.url)return;this.request.onreadystatechange=null,this.request.abort(),this.request=null}this.media_&&this.trigger("mediachanging"),this.pendingMedia_=e,this.request=this.vhs_.xhr({uri:e.resolvedUri,withCredentials:this.withCredentials},((t,r)=>{if(this.request){if(e.lastRequest=Date.now(),e.resolvedUri=resolveManifestRedirect(e.resolvedUri,r),t)return this.playlistRequestError(this.request,e,n);this.haveMetadata({playlistString:r.responseText,url:e.uri,id:e.id}),"HAVE_MAIN_MANIFEST"===n?this.trigger("loadedmetadata"):this.trigger("mediachange")}}))}}pause(){this.mediaUpdateTimeout&&(window$1$1.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null),this.stopRequest(),"HAVE_NOTHING"===this.state&&(this.started=!1),"SWITCHING_MEDIA"===this.state?this.media_?this.state="HAVE_METADATA":this.state="HAVE_MAIN_MANIFEST":"HAVE_CURRENT_METADATA"===this.state&&(this.state="HAVE_METADATA")}load(e){this.mediaUpdateTimeout&&(window$1$1.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null);const t=this.media();if(e){const e=t?(t.partTargetDuration||t.targetDuration)/2*1e3:5e3;this.mediaUpdateTimeout=window$1$1.setTimeout((()=>{this.mediaUpdateTimeout=null,this.load()}),e)}else this.started?t&&!t.endList?this.trigger("mediaupdatetimeout"):this.trigger("loadedplaylist"):this.start()}updateMediaUpdateTimeout_(e){this.mediaUpdateTimeout&&(window$1$1.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null),this.media()&&!this.media().endList&&(this.mediaUpdateTimeout=window$1$1.setTimeout((()=>{this.mediaUpdateTimeout=null,this.trigger("mediaupdatetimeout"),this.updateMediaUpdateTimeout_(e)}),e))}start(){if(this.started=!0,"object"==typeof this.src)return this.src.uri||(this.src.uri=window$1$1.location.href),this.src.resolvedUri=this.src.uri,void setTimeout((()=>{this.setupInitialPlaylist(this.src)}),0);this.request=this.vhs_.xhr({uri:this.src,withCredentials:this.withCredentials},((e,t)=>{if(!this.request)return;if(this.request=null,e)return this.error={status:t.status,message:`HLS playlist request error at URL: ${this.src}.`,responseText:t.responseText,code:2},"HAVE_NOTHING"===this.state&&(this.started=!1),this.trigger("error");this.src=resolveManifestRedirect(this.src,t);const n=this.parseManifest_({manifestString:t.responseText,url:this.src});this.setupInitialPlaylist(n)}))}srcUri(){return"string"==typeof this.src?this.src:this.src.uri}setupInitialPlaylist(e){if(this.state="HAVE_MAIN_MANIFEST",e.playlists)return this.main=e,addPropertiesToMain(this.main,this.srcUri()),e.playlists.forEach((e=>{e.segments=getAllSegments(e),e.segments.forEach((t=>{resolveSegmentUris(t,e.resolvedUri)}))})),this.trigger("loadedplaylist"),void(this.request||this.media(this.main.playlists[0]));const t=this.srcUri()||window$1$1.location.href;this.main=mainForMedia(e,t),this.haveMetadata({playlistObject:e,url:t,id:this.main.playlists[0].id}),this.trigger("loadedmetadata")}updateOrDeleteClone(e,t){const n=this.main,r=e.ID;let a=n.playlists.length;for(;a--;){const i=n.playlists[a];if(i.attributes["PATHWAY-ID"]===r){const s=i.resolvedUri,o=i.id;if(t){const t=this.createCloneURI_(i.resolvedUri,e),s=createPlaylistID(r,t),o=this.createCloneAttributes_(r,i.attributes),l=this.createClonePlaylist_(i,s,e,o);n.playlists[a]=l,n.playlists[s]=l,n.playlists[t]=l}else n.playlists.splice(a,1);delete n.playlists[o],delete n.playlists[s]}}this.updateOrDeleteCloneMedia(e,t)}updateOrDeleteCloneMedia(e,t){const n=this.main,r=e.ID;["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach((e=>{if(n.mediaGroups[e]&&n.mediaGroups[e][r])for(const t in n.mediaGroups[e])if(t===r){for(const r in n.mediaGroups[e][t]){n.mediaGroups[e][t][r].playlists.forEach(((e,t)=>{const r=n.playlists[e.id],a=r.id,i=r.resolvedUri;delete n.playlists[a],delete n.playlists[i]}))}delete n.mediaGroups[e][t]}})),t&&this.createClonedMediaGroups_(e)}addClonePathway(e,t={}){const n=this.main,r=n.playlists.length,a=this.createCloneURI_(t.resolvedUri,e),i=createPlaylistID(e.ID,a),s=this.createCloneAttributes_(e.ID,t.attributes),o=this.createClonePlaylist_(t,i,e,s);n.playlists[r]=o,n.playlists[i]=o,n.playlists[a]=o,this.createClonedMediaGroups_(e)}createClonedMediaGroups_(e){const t=e.ID,n=e["BASE-ID"],r=this.main;["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach((a=>{if(r.mediaGroups[a]&&!r.mediaGroups[a][t])for(const i in r.mediaGroups[a])if(i===n){r.mediaGroups[a][t]={};for(const n in r.mediaGroups[a][i]){const s=r.mediaGroups[a][i][n];r.mediaGroups[a][t][n]=_extends$2({},s);const o=r.mediaGroups[a][t][n],l=this.createCloneURI_(s.resolvedUri,e);o.resolvedUri=l,o.uri=l,o.playlists=[],s.playlists.forEach(((i,s)=>{const l=r.playlists[i.id],u=groupID(a,t,n),c=createPlaylistID(t,u);if(l&&!r.playlists[c]){const t=this.createClonePlaylist_(l,c,e),n=t.resolvedUri;r.playlists[c]=t,r.playlists[n]=t}o.playlists[s]=this.createClonePlaylist_(i,c,e)}))}}}))}createClonePlaylist_(e,t,n,r){const a=this.createCloneURI_(e.resolvedUri,n),i={resolvedUri:a,uri:a,id:t};return e.segments&&(i.segments=[]),r&&(i.attributes=r),merge(e,i)}createCloneURI_(e,t){const n=new URL(e);n.hostname=t["URI-REPLACEMENT"].HOST;const r=t["URI-REPLACEMENT"].PARAMS;for(const a of Object.keys(r))n.searchParams.set(a,r[a]);return n.href}createCloneAttributes_(e,t){const n={"PATHWAY-ID":e};return["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach((r=>{t[r]&&(n[r]=e)})),n}getKeyIdSet(e){if(e.contentProtection){const t=new Set;for(const n in e.contentProtection){const r=e.contentProtection[n].attributes.keyId;r&&t.add(r.toLowerCase())}return t}}}const{xhr:videojsXHR}=videojs,callbackWrapper=function(e,t,n,r){const a="arraybuffer"===e.responseType?e.response:e.responseText;!t&&a&&(e.responseTime=Date.now(),e.roundTripTime=e.responseTime-e.requestTime,e.bytesReceived=a.byteLength||a.length,e.bandwidth||(e.bandwidth=Math.floor(e.bytesReceived/e.roundTripTime*8*1e3))),n.headers&&(e.responseHeaders=n.headers),t&&"ETIMEDOUT"===t.code&&(e.timedout=!0),t||e.aborted||200===n.statusCode||206===n.statusCode||0===n.statusCode||(t=new Error("XHR Failed with a response of: "+(e&&(a||e.responseText)))),r(t,e)},callAllRequestHooks=(e,t)=>{if(!e||!e.size)return;let n=t;return e.forEach((e=>{n=e(n)})),n},callAllResponseHooks=(e,t,n,r)=>{e&&e.size&&e.forEach((e=>{e(t,n,r)}))},xhrFactory=function(){const e=function e(t,n){t=merge({timeout:45e3},t);const r=e.beforeRequest||videojs.Vhs.xhr.beforeRequest,a=e._requestCallbackSet||videojs.Vhs.xhr._requestCallbackSet||new Set,i=e._responseCallbackSet||videojs.Vhs.xhr._responseCallbackSet;r&&"function"==typeof r&&(videojs.log.warn("beforeRequest is deprecated, use onRequest instead."),a.add(r));const s=!0===videojs.Vhs.xhr.original?videojsXHR:videojs.Vhs.xhr,o=callAllRequestHooks(a,t);a.delete(r);const l=s(o||t,(function(e,t){return callAllResponseHooks(i,l,e,t),callbackWrapper(l,e,t,n)})),u=l.abort;return l.abort=function(){return l.aborted=!0,u.apply(l,arguments)},l.uri=t.uri,l.requestTime=Date.now(),l};return e.original=!0,e},byterangeStr=function(e){let t;const n=e.offset;return t="bigint"==typeof e.offset||"bigint"==typeof e.length?window$1$1.BigInt(e.offset)+window$1$1.BigInt(e.length)-window$1$1.BigInt(1):e.offset+e.length-1,"bytes="+n+"-"+t},segmentXhrHeaders=function(e){const t={};return e.byterange&&(t.Range=byterangeStr(e.byterange)),t},textRange=function(e,t){return e.start(t)+"-"+e.end(t)},formatHexString=function(e,t){const n=e.toString(16);return"00".substring(0,2-n.length)+n+(t%2?" ":"")},formatAsciiString=function(e){return e>=32&&e<126?String.fromCharCode(e):"."},createTransferableMessage=function(e){const t={};return Object.keys(e).forEach((n=>{const r=e[n];isArrayBufferView(r)?t[n]={bytes:r.buffer,byteOffset:r.byteOffset,byteLength:r.byteLength}:t[n]=r})),t},initSegmentId=function(e){const t=e.byterange||{length:1/0,offset:0};return[t.length,t.offset,e.resolvedUri].join(",")},segmentKeyId=function(e){return e.resolvedUri},hexDump=e=>{const t=Array.prototype.slice.call(e),n=16;let r,a,i="";for(let s=0;s<t.length/n;s++)r=t.slice(s*n,s*n+n).map(formatHexString).join(""),a=t.slice(s*n,s*n+n).map(formatAsciiString).join(""),i+=r+" "+a+"\n";return i},tagDump=({bytes:e})=>hexDump(e),textRanges=e=>{let t,n="";for(t=0;t<e.length;t++)n+=textRange(e,t)+" ";return n};var utils=Object.freeze({__proto__:null,createTransferableMessage:createTransferableMessage,initSegmentId:initSegmentId,segmentKeyId:segmentKeyId,hexDump:hexDump,tagDump:tagDump,textRanges:textRanges});const SEGMENT_END_FUDGE_PERCENT=.25,playerTimeToProgramTime=(e,t)=>{if(!t.dateTimeObject)return null;const n=t.videoTimingInfo.transmuxerPrependedSeconds,r=e-(t.videoTimingInfo.transmuxedPresentationStart+n);return new Date(t.dateTimeObject.getTime()+1e3*r)},originalSegmentVideoDuration=e=>e.transmuxedPresentationEnd-e.transmuxedPresentationStart-e.transmuxerPrependedSeconds,findSegmentForProgramTime=(e,t)=>{let n;try{n=new Date(e)}catch(e2){return null}if(!t||!t.segments||0===t.segments.length)return null;let r=t.segments[0];if(n<new Date(r.dateTimeObject))return null;for(let o=0;o<t.segments.length-1;o++){r=t.segments[o];if(n<new Date(t.segments[o+1].dateTimeObject))break}const a=t.segments[t.segments.length-1],i=a.dateTimeObject,s=a.videoTimingInfo?originalSegmentVideoDuration(a.videoTimingInfo):a.duration+a.duration*SEGMENT_END_FUDGE_PERCENT;return n>new Date(i.getTime()+1e3*s)?null:(n>new Date(i)&&(r=a),{segment:r,estimatedStart:r.videoTimingInfo?r.videoTimingInfo.transmuxedPresentationStart:Playlist.duration(t,t.mediaSequence+t.segments.indexOf(r)),type:r.videoTimingInfo?"accurate":"estimate"})},findSegmentForPlayerTime=(e,t)=>{if(!t||!t.segments||0===t.segments.length)return null;let n,r=0;for(let i=0;i<t.segments.length&&(n=t.segments[i],r=n.videoTimingInfo?n.videoTimingInfo.transmuxedPresentationEnd:r+n.duration,!(e<=r));i++);const a=t.segments[t.segments.length-1];if(a.videoTimingInfo&&a.videoTimingInfo.transmuxedPresentationEnd<e)return null;if(e>r){if(e>r+a.duration*SEGMENT_END_FUDGE_PERCENT)return null;n=a}return{segment:n,estimatedStart:n.videoTimingInfo?n.videoTimingInfo.transmuxedPresentationStart:r-n.duration,type:n.videoTimingInfo?"accurate":"estimate"}},getOffsetFromTimestamp=(e,t)=>{let n,r;try{n=new Date(e),r=new Date(t)}catch(e2){}const a=n.getTime();return(r.getTime()-a)/1e3},verifyProgramDateTimeTags=e=>{if(!e.segments||0===e.segments.length)return!1;for(let t=0;t<e.segments.length;t++){if(!e.segments[t].dateTimeObject)return!1}return!0},getProgramTime=({playlist:e,time:t,callback:n})=>{if(!n)throw new Error("getProgramTime: callback must be provided");if(!e||void 0===t)return n({message:"getProgramTime: playlist and time must be provided"});const r=findSegmentForPlayerTime(t,e);if(!r)return n({message:"valid programTime was not found"});if("estimate"===r.type)return n({message:"Accurate programTime could not be determined. Please seek to e.seekTime and try again",seekTime:r.estimatedStart});const a={mediaSeconds:t},i=playerTimeToProgramTime(t,r.segment);return i&&(a.programDateTime=i.toISOString()),n(null,a)},seekToProgramTime=({programTime:e,playlist:t,retryCount:n=2,seekTo:r,pauseAfterSeek:a=!0,tech:i,callback:s})=>{if(!s)throw new Error("seekToProgramTime: callback must be provided");if(void 0===e||!t||!r)return s({message:"seekToProgramTime: programTime, seekTo and playlist must be provided"});if(!t.endList&&!i.hasStarted_)return s({message:"player must be playing a live stream to start buffering"});if(!verifyProgramDateTimeTags(t))return s({message:"programDateTime tags must be provided in the manifest "+t.resolvedUri});const o=findSegmentForProgramTime(e,t);if(!o)return s({message:`${e} was not found in the stream`});const l=o.segment,u=getOffsetFromTimestamp(l.dateTimeObject,e);if("estimate"===o.type)return 0===n?s({message:`${e} is not buffered yet. Try again`}):(r(o.estimatedStart+u),void i.one("seeked",(()=>{seekToProgramTime({programTime:e,playlist:t,retryCount:n-1,seekTo:r,pauseAfterSeek:a,tech:i,callback:s})})));const c=l.start+u;i.one("seeked",(()=>s(null,i.currentTime()))),a&&i.pause(),r(c)},callbackOnCompleted=(e,t)=>{if(4===e.readyState)return t()},containerRequest=(e,t,n)=>{let r,a=[],i=!1;const s=function(e,t,r,a){return t.abort(),i=!0,n(e,t,r,a)},o=function(e,t){if(i)return;if(e)return s(e,t,"",a);const n=t.responseText.substring(a&&a.byteLength||0,t.responseText.length);if(a=concatTypedArrays(a,stringToBytes(n,!0)),r=r||getId3Offset(a),a.length<10||r&&a.length<r+2)return callbackOnCompleted(t,(()=>s(e,t,"",a)));const o=detectContainerForBytes(a);return"ts"===o&&a.length<188||!o&&a.length<376?callbackOnCompleted(t,(()=>s(e,t,"",a))):s(null,t,o,a)},l=t({uri:e,beforeSend(e){e.overrideMimeType("text/plain; charset=x-user-defined"),e.addEventListener("progress",(function({total:t,loaded:n}){return callbackWrapper(e,null,{statusCode:e.status},o)}))}},(function(e,t){return callbackWrapper(l,e,t,o)}));return l},{EventTarget:EventTarget}=videojs,dashPlaylistUnchanged=function(e,t){if(!isPlaylistUnchanged(e,t))return!1;if(e.sidx&&t.sidx&&(e.sidx.offset!==t.sidx.offset||e.sidx.length!==t.sidx.length))return!1;if(!e.sidx&&t.sidx||e.sidx&&!t.sidx)return!1;if(e.segments&&!t.segments||!e.segments&&t.segments)return!1;if(!e.segments&&!t.segments)return!0;for(let n=0;n<e.segments.length;n++){const r=e.segments[n],a=t.segments[n];if(r.uri!==a.uri)return!1;if(!r.byterange&&!a.byterange)continue;const i=r.byterange,s=a.byterange;if(i&&!s||!i&&s)return!1;if(i.offset!==s.offset||i.length!==s.length)return!1}return!0},dashGroupId=(e,t,n,r)=>`placeholder-uri-${e}-${t}-${r.attributes.NAME||n}`,parseMainXml=({mainXml:e,srcUrl:t,clientOffset:n,sidxMapping:r,previousManifest:a})=>{const i=parse(e,{manifestUri:t,clientOffset:n,sidxMapping:r,previousManifest:a});return addPropertiesToMain(i,t,dashGroupId),i},removeOldMediaGroupLabels=(e,t)=>{forEachMediaGroup(e,((n,r,a,i)=>{i in t.mediaGroups[r][a]||delete e.mediaGroups[r][a][i]}))},updateMain=(e,t,n)=>{let r=!0,a=merge(e,{duration:t.duration,minimumUpdatePeriod:t.minimumUpdatePeriod,timelineStarts:t.timelineStarts});for(let i=0;i<t.playlists.length;i++){const e=t.playlists[i];if(e.sidx){const t=generateSidxKey(e.sidx);n&&n[t]&&n[t].sidx&&addSidxSegmentsToPlaylist$1(e,n[t].sidx,e.sidx.resolvedUri)}const s=updateMain$1(a,e,dashPlaylistUnchanged);s&&(a=s,r=!1)}return forEachMediaGroup(t,((e,t,n,i)=>{if(e.playlists&&e.playlists.length){const s=e.playlists[0].id,o=updateMain$1(a,e.playlists[0],dashPlaylistUnchanged);o&&(a=o,i in a.mediaGroups[t][n]||(a.mediaGroups[t][n][i]=e),a.mediaGroups[t][n][i].playlists[0]=a.playlists[s],r=!1)}})),removeOldMediaGroupLabels(a,t),t.minimumUpdatePeriod!==e.minimumUpdatePeriod&&(r=!1),r?null:a},equivalentSidx=(e,t)=>(Boolean(!e.map&&!t.map)||Boolean(e.map&&t.map&&e.map.byterange.offset===t.map.byterange.offset&&e.map.byterange.length===t.map.byterange.length))&&e.uri===t.uri&&e.byterange.offset===t.byterange.offset&&e.byterange.length===t.byterange.length,compareSidxEntry=(e,t)=>{const n={};for(const r in e){const a=e[r].sidx;if(a){const e=generateSidxKey(a);if(!t[e])break;const r=t[e].sidxInfo;equivalentSidx(r,a)&&(n[e]=t[e])}}return n},filterChangedSidxMappings=(e,t)=>{let n=compareSidxEntry(e.playlists,t);return forEachMediaGroup(e,((e,r,a,i)=>{if(e.playlists&&e.playlists.length){const r=e.playlists;n=merge(n,compareSidxEntry(r,t))}})),n};class DashPlaylistLoader extends EventTarget{constructor(e,t,n={},r){super(),this.mainPlaylistLoader_=r||this,r||(this.isMain_=!0);const{withCredentials:a=!1}=n;if(this.vhs_=t,this.withCredentials=a,this.addMetadataToTextTrack=n.addMetadataToTextTrack,!e)throw new Error("A non-empty playlist URL or object is required");this.on("minimumUpdatePeriod",(()=>{this.refreshXml_()})),this.on("mediaupdatetimeout",(()=>{this.refreshMedia_(this.media().id)})),this.state="HAVE_NOTHING",this.loadedPlaylists_={},this.logger_=logger("DashPlaylistLoader"),this.isMain_?(this.mainPlaylistLoader_.srcUrl=e,this.mainPlaylistLoader_.sidxMapping_={}):this.childPlaylist_=e}requestErrored_(e,t,n){return!this.request||(this.request=null,e?(this.error="object"!=typeof e||e instanceof Error?{status:t.status,message:"DASH request error at URL: "+t.uri,response:t.response,code:2}:e,n&&(this.state=n),this.trigger("error"),!0):void 0)}addSidxSegments_(e,t,n){const r=e.sidx&&generateSidxKey(e.sidx);if(!e.sidx||!r||this.mainPlaylistLoader_.sidxMapping_[r])return void(this.mediaRequest_=window$1$1.setTimeout((()=>n(!1)),0));const a=resolveManifestRedirect(e.sidx.resolvedUri),i=(a,i)=>{if(this.requestErrored_(a,i,t))return;const s=this.mainPlaylistLoader_.sidxMapping_;let o;try{o=parseSidx$1(toUint8(i.response).subarray(8))}catch(e2){return void this.requestErrored_(e2,i,t)}return s[r]={sidxInfo:e.sidx,sidx:o},addSidxSegmentsToPlaylist$1(e,o,e.sidx.resolvedUri),n(!0)};this.request=containerRequest(a,this.vhs_.xhr,((t,n,r,s)=>{if(t)return i(t,n);if(!r||"mp4"!==r)return i({status:n.status,message:`Unsupported ${r||"unknown"} container type for sidx segment at URL: ${a}`,response:"",playlist:e,internal:!0,playlistExclusionDuration:1/0,code:2},n);const{offset:o,length:l}=e.sidx.byterange;if(s.length>=l+o)return i(t,{response:s.subarray(o,o+l),status:n.status,uri:n.uri});this.request=this.vhs_.xhr({uri:a,responseType:"arraybuffer",headers:segmentXhrHeaders({byterange:e.sidx.byterange})},i)}))}dispose(){this.trigger("dispose"),this.stopRequest(),this.loadedPlaylists_={},window$1$1.clearTimeout(this.minimumUpdatePeriodTimeout_),window$1$1.clearTimeout(this.mediaRequest_),window$1$1.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null,this.mediaRequest_=null,this.minimumUpdatePeriodTimeout_=null,this.mainPlaylistLoader_.createMupOnMedia_&&(this.off("loadedmetadata",this.mainPlaylistLoader_.createMupOnMedia_),this.mainPlaylistLoader_.createMupOnMedia_=null),this.off()}hasPendingRequest(){return this.request||this.mediaRequest_}stopRequest(){if(this.request){const e=this.request;this.request=null,e.onreadystatechange=null,e.abort()}}media(e){if(!e)return this.media_;if("HAVE_NOTHING"===this.state)throw new Error("Cannot switch media playlist from "+this.state);const t=this.state;if("string"==typeof e){if(!this.mainPlaylistLoader_.main.playlists[e])throw new Error("Unknown playlist URI: "+e);e=this.mainPlaylistLoader_.main.playlists[e]}const n=!this.media_||e.id!==this.media_.id;if(n&&this.loadedPlaylists_[e.id]&&this.loadedPlaylists_[e.id].endList)return this.state="HAVE_METADATA",this.media_=e,void(n&&(this.trigger("mediachanging"),this.trigger("mediachange")));n&&(this.media_&&this.trigger("mediachanging"),this.addSidxSegments_(e,t,(n=>{this.haveMetadata({startingState:t,playlist:e})})))}haveMetadata({startingState:e,playlist:t}){this.state="HAVE_METADATA",this.loadedPlaylists_[t.id]=t,this.mediaRequest_=null,this.refreshMedia_(t.id),"HAVE_MAIN_MANIFEST"===e?this.trigger("loadedmetadata"):this.trigger("mediachange")}pause(){this.mainPlaylistLoader_.createMupOnMedia_&&(this.off("loadedmetadata",this.mainPlaylistLoader_.createMupOnMedia_),this.mainPlaylistLoader_.createMupOnMedia_=null),this.stopRequest(),window$1$1.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null,this.isMain_&&(window$1$1.clearTimeout(this.mainPlaylistLoader_.minimumUpdatePeriodTimeout_),this.mainPlaylistLoader_.minimumUpdatePeriodTimeout_=null),"HAVE_NOTHING"===this.state&&(this.started=!1)}load(e){window$1$1.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null;const t=this.media();if(e){const e=t?t.targetDuration/2*1e3:5e3;this.mediaUpdateTimeout=window$1$1.setTimeout((()=>this.load()),e)}else this.started?t&&!t.endList?(this.isMain_&&!this.minimumUpdatePeriodTimeout_&&(this.trigger("minimumUpdatePeriod"),this.updateMinimumUpdatePeriodTimeout_()),this.trigger("mediaupdatetimeout")):this.trigger("loadedplaylist"):this.start()}start(){this.started=!0,this.isMain_?this.requestMain_(((e,t)=>{this.haveMain_(),this.hasPendingRequest()||this.media_||this.media(this.mainPlaylistLoader_.main.playlists[0])})):this.mediaRequest_=window$1$1.setTimeout((()=>this.haveMain_()),0)}requestMain_(e){this.request=this.vhs_.xhr({uri:this.mainPlaylistLoader_.srcUrl,withCredentials:this.withCredentials},((t,n)=>{if(this.requestErrored_(t,n))return void("HAVE_NOTHING"===this.state&&(this.started=!1));const r=n.responseText!==this.mainPlaylistLoader_.mainXml_;return this.mainPlaylistLoader_.mainXml_=n.responseText,n.responseHeaders&&n.responseHeaders.date?this.mainLoaded_=Date.parse(n.responseHeaders.date):this.mainLoaded_=Date.now(),this.mainPlaylistLoader_.srcUrl=resolveManifestRedirect(this.mainPlaylistLoader_.srcUrl,n),r?(this.handleMain_(),void this.syncClientServerClock_((()=>e(n,r)))):e(n,r)}))}syncClientServerClock_(e){const t=parseUTCTiming(this.mainPlaylistLoader_.mainXml_);return null===t?(this.mainPlaylistLoader_.clientOffset_=this.mainLoaded_-Date.now(),e()):"DIRECT"===t.method?(this.mainPlaylistLoader_.clientOffset_=t.value-Date.now(),e()):void(this.request=this.vhs_.xhr({uri:resolveUrl(this.mainPlaylistLoader_.srcUrl,t.value),method:t.method,withCredentials:this.withCredentials},((n,r)=>{if(!this.request)return;if(n)return this.mainPlaylistLoader_.clientOffset_=this.mainLoaded_-Date.now(),e();let a;a="HEAD"===t.method?r.responseHeaders&&r.responseHeaders.date?Date.parse(r.responseHeaders.date):this.mainLoaded_:Date.parse(r.responseText),this.mainPlaylistLoader_.clientOffset_=a-Date.now(),e()})))}haveMain_(){this.state="HAVE_MAIN_MANIFEST",this.isMain_?this.trigger("loadedplaylist"):this.media_||this.media(this.childPlaylist_)}handleMain_(){this.mediaRequest_=null;const e=this.mainPlaylistLoader_.main;let t=parseMainXml({mainXml:this.mainPlaylistLoader_.mainXml_,srcUrl:this.mainPlaylistLoader_.srcUrl,clientOffset:this.mainPlaylistLoader_.clientOffset_,sidxMapping:this.mainPlaylistLoader_.sidxMapping_,previousManifest:e});e&&(t=updateMain(e,t,this.mainPlaylistLoader_.sidxMapping_)),this.mainPlaylistLoader_.main=t||e;const n=this.mainPlaylistLoader_.main.locations&&this.mainPlaylistLoader_.main.locations[0];return n&&n!==this.mainPlaylistLoader_.srcUrl&&(this.mainPlaylistLoader_.srcUrl=n),(!e||t&&t.minimumUpdatePeriod!==e.minimumUpdatePeriod)&&this.updateMinimumUpdatePeriodTimeout_(),this.addEventStreamToMetadataTrack_(t),Boolean(t)}updateMinimumUpdatePeriodTimeout_(){const e=this.mainPlaylistLoader_;e.createMupOnMedia_&&(e.off("loadedmetadata",e.createMupOnMedia_),e.createMupOnMedia_=null),e.minimumUpdatePeriodTimeout_&&(window$1$1.clearTimeout(e.minimumUpdatePeriodTimeout_),e.minimumUpdatePeriodTimeout_=null);let t=e.main&&e.main.minimumUpdatePeriod;0===t&&(e.media()?t=1e3*e.media().targetDuration:(e.createMupOnMedia_=e.updateMinimumUpdatePeriodTimeout_,e.one("loadedmetadata",e.createMupOnMedia_))),"number"!=typeof t||t<=0?t<0&&this.logger_(`found invalid minimumUpdatePeriod of ${t}, not setting a timeout`):this.createMUPTimeout_(t)}createMUPTimeout_(e){const t=this.mainPlaylistLoader_;t.minimumUpdatePeriodTimeout_=window$1$1.setTimeout((()=>{t.minimumUpdatePeriodTimeout_=null,t.trigger("minimumUpdatePeriod"),t.createMUPTimeout_(e)}),e)}refreshXml_(){this.requestMain_(((e,t)=>{t&&(this.media_&&(this.media_=this.mainPlaylistLoader_.main.playlists[this.media_.id]),this.mainPlaylistLoader_.sidxMapping_=filterChangedSidxMappings(this.mainPlaylistLoader_.main,this.mainPlaylistLoader_.sidxMapping_),this.addSidxSegments_(this.media(),this.state,(e=>{this.refreshMedia_(this.media().id)})))}))}refreshMedia_(e){if(!e)throw new Error("refreshMedia_ must take a media id");this.media_&&this.isMain_&&this.handleMain_();const t=this.mainPlaylistLoader_.main.playlists,n=!this.media_||this.media_!==t[e];if(n?this.media_=t[e]:this.trigger("playlistunchanged"),!this.mediaUpdateTimeout){const e=()=>{this.media().endList||(this.mediaUpdateTimeout=window$1$1.setTimeout((()=>{this.trigger("mediaupdatetimeout"),e()}),refreshDelay(this.media(),Boolean(n))))};e()}this.trigger("loadedplaylist")}addEventStreamToMetadataTrack_(e){if(e&&this.mainPlaylistLoader_.main.eventStream){const e=this.mainPlaylistLoader_.main.eventStream.map((e=>({cueTime:e.start,frames:[{data:e.messageData}]})));this.addMetadataToTextTrack("EventStream",e,this.mainPlaylistLoader_.main.duration)}}getKeyIdSet(e){if(e.contentProtection){const t=new Set;for(const n in e.contentProtection){const r=e.contentProtection[n].attributes["cenc:default_KID"];r&&t.add(r.replace(/-/g,"").toLowerCase())}return t}}}var Config={GOAL_BUFFER_LENGTH:30,MAX_GOAL_BUFFER_LENGTH:60,BACK_BUFFER_LENGTH:30,GOAL_BUFFER_LENGTH_RATE:1,INITIAL_BANDWIDTH:4194304,BANDWIDTH_VARIANCE:1.2,BUFFER_LOW_WATER_LINE:0,MAX_BUFFER_LOW_WATER_LINE:30,EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE:16,BUFFER_LOW_WATER_LINE_RATE:1,BUFFER_HIGH_WATER_LINE:30};const stringToArrayBuffer=e=>{const t=new Uint8Array(new ArrayBuffer(e.length));for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t.buffer},browserWorkerPolyFill=function(e){return e.on=e.addEventListener,e.off=e.removeEventListener,e},createObjectURL=function(e){try{return URL.createObjectURL(new Blob([e],{type:"application/javascript"}))}catch(e2){const n=new BlobBuilder;return n.append(e),URL.createObjectURL(n.getBlob())}},factory=function(e){return function(){const t=createObjectURL(e),n=browserWorkerPolyFill(new Worker(t));n.objURL=t;const r=n.terminate;return n.on=n.addEventListener,n.off=n.removeEventListener,n.terminate=function(){return URL.revokeObjectURL(t),r.call(this)},n}},transform=function(e){return`var browserWorkerPolyFill = ${browserWorkerPolyFill.toString()};\nbrowserWorkerPolyFill(self);\n`+e},getWorkerString=function(e){return e.toString().replace(/^function.+?{/,"").slice(0,-1)},workerCode$1=transform(getWorkerString((function(){var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=function(){this.init=function(){var e={};this.on=function(t,n){e[t]||(e[t]=[]),e[t]=e[t].concat(n)},this.off=function(t,n){var r;return!!e[t]&&(r=e[t].indexOf(n),e[t]=e[t].slice(),e[t].splice(r,1),r>-1)},this.trigger=function(t){var n,r,a,i;if(n=e[t])if(2===arguments.length)for(a=n.length,r=0;r<a;++r)n[r].call(this,arguments[1]);else{for(i=[],r=arguments.length,r=1;r<arguments.length;++r)i.push(arguments[r]);for(a=n.length,r=0;r<a;++r)n[r].apply(this,i)}},this.dispose=function(){e={}}}};t.prototype.pipe=function(e){return this.on("data",(function(t){e.push(t)})),this.on("done",(function(t){e.flush(t)})),this.on("partialdone",(function(t){e.partialFlush(t)})),this.on("endedtimeline",(function(t){e.endTimeline(t)})),this.on("reset",(function(t){e.reset(t)})),e},t.prototype.push=function(e){this.trigger("data",e)},t.prototype.flush=function(e){this.trigger("done",e)},t.prototype.partialFlush=function(e){this.trigger("partialdone",e)},t.prototype.endTimeline=function(e){this.trigger("endedtimeline",e)},t.prototype.reset=function(e){this.trigger("reset",e)};var n,r,a,i,s,o,l,u,c,h,d,p,f,m,g,y,v,b,x,T,_,w,S,C,E,k,I,A,N,$,D,P,R,M,O,F,L,B,V,U,z=t,G=Math.pow(2,32),W={getUint64:function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength);return n.getBigUint64?(t=n.getBigUint64(0))<Number.MAX_SAFE_INTEGER?Number(t):t:n.getUint32(0)*G+n.getUint32(4)},MAX_UINT32:G},H=W.MAX_UINT32;!function(){var e;if(w={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],pasp:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]},"undefined"!=typeof Uint8Array){for(e in w)w.hasOwnProperty(e)&&(w[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);S=new Uint8Array(["i".charCodeAt(0),"s".charCodeAt(0),"o".charCodeAt(0),"m".charCodeAt(0)]),E=new Uint8Array(["a".charCodeAt(0),"v".charCodeAt(0),"c".charCodeAt(0),"1".charCodeAt(0)]),C=new Uint8Array([0,0,0,1]),k=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),I=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),A={video:k,audio:I},D=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),$=new Uint8Array([0,0,0,0,0,0,0,0]),P=new Uint8Array([0,0,0,0,0,0,0,0]),R=P,M=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),O=P,N=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}}(),n=function(e){var t,n,r=[],a=0;for(t=1;t<arguments.length;t++)r.push(arguments[t]);for(t=r.length;t--;)a+=r[t].byteLength;for(n=new Uint8Array(a+8),new DataView(n.buffer,n.byteOffset,n.byteLength).setUint32(0,n.byteLength),n.set(e,4),t=0,a=8;t<r.length;t++)n.set(r[t],a),a+=r[t].byteLength;return n},r=function(){return n(w.dinf,n(w.dref,D))},a=function(e){return n(w.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,e.audioobjecttype<<3|e.samplingfrequencyindex>>>1,e.samplingfrequencyindex<<7|e.channelcount<<3,6,1,2]))},g=function(e){return n(w.hdlr,A[e])},m=function(e){var t=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,e.duration>>>24&255,e.duration>>>16&255,e.duration>>>8&255,255&e.duration,85,196,0,0]);return e.samplerate&&(t[12]=e.samplerate>>>24&255,t[13]=e.samplerate>>>16&255,t[14]=e.samplerate>>>8&255,t[15]=255&e.samplerate),n(w.mdhd,t)},f=function(e){return n(w.mdia,m(e),g(e.type),o(e))},s=function(e){return n(w.mfhd,new Uint8Array([0,0,0,0,(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e]))},o=function(e){return n(w.minf,"video"===e.type?n(w.vmhd,N):n(w.smhd,$),r(),v(e))},l=function(e,t){for(var r=[],a=t.length;a--;)r[a]=x(t[a]);return n.apply(null,[w.moof,s(e)].concat(r))},u=function(e){for(var t=e.length,r=[];t--;)r[t]=d(e[t]);return n.apply(null,[w.moov,h(4294967295)].concat(r).concat(c(e)))},c=function(e){for(var t=e.length,r=[];t--;)r[t]=T(e[t]);return n.apply(null,[w.mvex].concat(r))},h=function(e){var t=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return n(w.mvhd,t)},y=function(e){var t,r,a=e.samples||[],i=new Uint8Array(4+a.length);for(r=0;r<a.length;r++)t=a[r].flags,i[r+4]=t.dependsOn<<4|t.isDependedOn<<2|t.hasRedundancy;return n(w.sdtp,i)},v=function(e){return n(w.stbl,b(e),n(w.stts,O),n(w.stsc,R),n(w.stsz,M),n(w.stco,P))},b=function(e){return n(w.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),"video"===e.type?F(e):L(e))},F=function(e){var t,r,a=e.sps||[],i=e.pps||[],s=[],o=[];for(t=0;t<a.length;t++)s.push((65280&a[t].byteLength)>>>8),s.push(255&a[t].byteLength),s=s.concat(Array.prototype.slice.call(a[t]));for(t=0;t<i.length;t++)o.push((65280&i[t].byteLength)>>>8),o.push(255&i[t].byteLength),o=o.concat(Array.prototype.slice.call(i[t]));if(r=[w.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(65280&e.width)>>8,255&e.width,(65280&e.height)>>8,255&e.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),n(w.avcC,new Uint8Array([1,e.profileIdc,e.profileCompatibility,e.levelIdc,255].concat([a.length],s,[i.length],o))),n(w.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]))],e.sarRatio){var l=e.sarRatio[0],u=e.sarRatio[1];r.push(n(w.pasp,new Uint8Array([(4278190080&l)>>24,(16711680&l)>>16,(65280&l)>>8,255&l,(4278190080&u)>>24,(16711680&u)>>16,(65280&u)>>8,255&u])))}return n.apply(null,r)},L=function(e){return n(w.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(65280&e.channelcount)>>8,255&e.channelcount,(65280&e.samplesize)>>8,255&e.samplesize,0,0,0,0,(65280&e.samplerate)>>8,255&e.samplerate,0,0]),a(e))},p=function(e){var t=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(4278190080&e.id)>>24,(16711680&e.id)>>16,(65280&e.id)>>8,255&e.id,0,0,0,0,(4278190080&e.duration)>>24,(16711680&e.duration)>>16,(65280&e.duration)>>8,255&e.duration,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(65280&e.width)>>8,255&e.width,0,0,(65280&e.height)>>8,255&e.height,0,0]);return n(w.tkhd,t)},x=function(e){var t,r,a,i,s,o;return t=n(w.tfhd,new Uint8Array([0,0,0,58,(4278190080&e.id)>>24,(16711680&e.id)>>16,(65280&e.id)>>8,255&e.id,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),s=Math.floor(e.baseMediaDecodeTime/H),o=Math.floor(e.baseMediaDecodeTime%H),r=n(w.tfdt,new Uint8Array([1,0,0,0,s>>>24&255,s>>>16&255,s>>>8&255,255&s,o>>>24&255,o>>>16&255,o>>>8&255,255&o])),92,"audio"===e.type?(a=_(e,92),n(w.traf,t,r,a)):(i=y(e),a=_(e,i.length+92),n(w.traf,t,r,a,i))},d=function(e){return e.duration=e.duration||4294967295,n(w.trak,p(e),f(e))},T=function(e){var t=new Uint8Array([0,0,0,0,(4278190080&e.id)>>24,(16711680&e.id)>>16,(65280&e.id)>>8,255&e.id,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return"video"!==e.type&&(t[t.length-1]=0),n(w.trex,t)},U=function(e,t){var n=0,r=0,a=0,i=0;return e.length&&(void 0!==e[0].duration&&(n=1),void 0!==e[0].size&&(r=2),void 0!==e[0].flags&&(a=4),void 0!==e[0].compositionTimeOffset&&(i=8)),[0,0,n|r|a|i,1,(4278190080&e.length)>>>24,(16711680&e.length)>>>16,(65280&e.length)>>>8,255&e.length,(4278190080&t)>>>24,(16711680&t)>>>16,(65280&t)>>>8,255&t]},V=function(e,t){var r,a,i,s,o,l;for(t+=20+16*(s=e.samples||[]).length,i=U(s,t),(a=new Uint8Array(i.length+16*s.length)).set(i),r=i.length,l=0;l<s.length;l++)o=s[l],a[r++]=(4278190080&o.duration)>>>24,a[r++]=(16711680&o.duration)>>>16,a[r++]=(65280&o.duration)>>>8,a[r++]=255&o.duration,a[r++]=(4278190080&o.size)>>>24,a[r++]=(16711680&o.size)>>>16,a[r++]=(65280&o.size)>>>8,a[r++]=255&o.size,a[r++]=o.flags.isLeading<<2|o.flags.dependsOn,a[r++]=o.flags.isDependedOn<<6|o.flags.hasRedundancy<<4|o.flags.paddingValue<<1|o.flags.isNonSyncSample,a[r++]=61440&o.flags.degradationPriority,a[r++]=15&o.flags.degradationPriority,a[r++]=(4278190080&o.compositionTimeOffset)>>>24,a[r++]=(16711680&o.compositionTimeOffset)>>>16,a[r++]=(65280&o.compositionTimeOffset)>>>8,a[r++]=255&o.compositionTimeOffset;return n(w.trun,a)},B=function(e,t){var r,a,i,s,o,l;for(t+=20+8*(s=e.samples||[]).length,i=U(s,t),(r=new Uint8Array(i.length+8*s.length)).set(i),a=i.length,l=0;l<s.length;l++)o=s[l],r[a++]=(4278190080&o.duration)>>>24,r[a++]=(16711680&o.duration)>>>16,r[a++]=(65280&o.duration)>>>8,r[a++]=255&o.duration,r[a++]=(4278190080&o.size)>>>24,r[a++]=(16711680&o.size)>>>16,r[a++]=(65280&o.size)>>>8,r[a++]=255&o.size;return n(w.trun,r)},_=function(e,t){return"audio"===e.type?B(e,t):V(e,t)};var j,q,K,X,Y,Z,J,Q,ee={ftyp:i=function(){return n(w.ftyp,S,C,S,E)},mdat:function(e){return n(w.mdat,e)},moof:l,moov:u,initSegment:function(e){var t,n=i(),r=u(e);return(t=new Uint8Array(n.byteLength+r.byteLength)).set(n),t.set(r,n.byteLength),t}},te=function(e,t){var n={size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0,isNonSyncSample:1}};return n.dataOffset=t,n.compositionTimeOffset=e.pts-e.dts,n.duration=e.duration,n.size=4*e.length,n.size+=e.byteLength,e.keyFrame&&(n.flags.dependsOn=2,n.flags.isNonSyncSample=0),n},ne={groupNalsIntoFrames:function(e){var t,n,r=[],a=[];for(a.byteLength=0,a.nalCount=0,a.duration=0,r.byteLength=0,t=0;t<e.length;t++)"access_unit_delimiter_rbsp"===(n=e[t]).nalUnitType?(r.length&&(r.duration=n.dts-r.dts,a.byteLength+=r.byteLength,a.nalCount+=r.length,a.duration+=r.duration,a.push(r)),(r=[n]).byteLength=n.data.byteLength,r.pts=n.pts,r.dts=n.dts):("slice_layer_without_partitioning_rbsp_idr"===n.nalUnitType&&(r.keyFrame=!0),r.duration=n.dts-r.dts,r.byteLength+=n.data.byteLength,r.push(n));return a.length&&(!r.duration||r.duration<=0)&&(r.duration=a[a.length-1].duration),a.byteLength+=r.byteLength,a.nalCount+=r.length,a.duration+=r.duration,a.push(r),a},groupFramesIntoGops:function(e){var t,n,r=[],a=[];for(r.byteLength=0,r.nalCount=0,r.duration=0,r.pts=e[0].pts,r.dts=e[0].dts,a.byteLength=0,a.nalCount=0,a.duration=0,a.pts=e[0].pts,a.dts=e[0].dts,t=0;t<e.length;t++)(n=e[t]).keyFrame?(r.length&&(a.push(r),a.byteLength+=r.byteLength,a.nalCount+=r.nalCount,a.duration+=r.duration),(r=[n]).nalCount=n.length,r.byteLength=n.byteLength,r.pts=n.pts,r.dts=n.dts,r.duration=n.duration):(r.duration+=n.duration,r.nalCount+=n.length,r.byteLength+=n.byteLength,r.push(n));return a.length&&r.duration<=0&&(r.duration=a[a.length-1].duration),a.byteLength+=r.byteLength,a.nalCount+=r.nalCount,a.duration+=r.duration,a.push(r),a},extendFirstKeyFrame:function(e){var t;return!e[0][0].keyFrame&&e.length>1&&(t=e.shift(),e.byteLength-=t.byteLength,e.nalCount-=t.nalCount,e[0][0].dts=t.dts,e[0][0].pts=t.pts,e[0][0].duration+=t.duration),e},generateSampleTable:function(e,t){var n,r,a,i,s,o=t||0,l=[];for(n=0;n<e.length;n++)for(i=e[n],r=0;r<i.length;r++)s=i[r],o+=(a=te(s,o)).size,l.push(a);return l},concatenateNalData:function(e){var t,n,r,a,i,s,o=0,l=e.byteLength,u=e.nalCount,c=new Uint8Array(l+4*u),h=new DataView(c.buffer);for(t=0;t<e.length;t++)for(a=e[t],n=0;n<a.length;n++)for(i=a[n],r=0;r<i.length;r++)s=i[r],h.setUint32(o,s.data.byteLength),o+=4,c.set(s.data,o),o+=s.data.byteLength;return c},generateSampleTableForFrame:function(e,t){var n,r=[];return n=te(e,t||0),r.push(n),r},concatenateNalDataForFrame:function(e){var t,n,r=0,a=e.byteLength,i=e.length,s=new Uint8Array(a+4*i),o=new DataView(s.buffer);for(t=0;t<e.length;t++)n=e[t],o.setUint32(r,n.data.byteLength),r+=4,s.set(n.data,r),r+=n.data.byteLength;return s}},re=[33,16,5,32,164,27],ae=[33,65,108,84,1,2,4,8,168,2,4,8,17,191,252],ie=function(e){for(var t=[];e--;)t.push(0);return t},se=9e4;Z=function(e,t){return q(Y(e,t))},J=function(e,t){return K(X(e),t)},Q=function(e,t,n){return X(n?e:e-t)};var oe={ONE_SECOND_IN_TS:se,secondsToVideoTs:q=function(e){return e*se},secondsToAudioTs:K=function(e,t){return e*t},videoTsToSeconds:X=function(e){return e/se},audioTsToSeconds:Y=function(e,t){return e/t},audioTsToVideoTs:Z,videoTsToAudioTs:J,metadataTsToSeconds:Q},le=function(){if(!j){var e={96e3:[re,[227,64],ie(154),[56]],88200:[re,[231],ie(170),[56]],64e3:[re,[248,192],ie(240),[56]],48e3:[re,[255,192],ie(268),[55,148,128],ie(54),[112]],44100:[re,[255,192],ie(268),[55,163,128],ie(84),[112]],32e3:[re,[255,192],ie(268),[55,234],ie(226),[112]],24e3:[re,[255,192],ie(268),[55,255,128],ie(268),[111,112],ie(126),[224]],16e3:[re,[255,192],ie(268),[55,255,128],ie(268),[111,255],ie(269),[223,108],ie(195),[1,192]],12e3:[ae,ie(268),[3,127,248],ie(268),[6,255,240],ie(268),[13,255,224],ie(268),[27,253,128],ie(259),[56]],11025:[ae,ie(268),[3,127,248],ie(268),[6,255,240],ie(268),[13,255,224],ie(268),[27,255,192],ie(268),[55,175,128],ie(108),[112]],8e3:[ae,ie(268),[3,121,16],ie(47),[7]]};t=e,j=Object.keys(t).reduce((function(e,n){return e[n]=new Uint8Array(t[n].reduce((function(e,t){return e.concat(t)}),[])),e}),{})}var t;return j},ue=oe,ce={prefixWithSilence:function(e,t,n,r){var a,i,s,o,l,u=0,c=0,h=0;if(t.length&&(a=ue.audioTsToVideoTs(e.baseMediaDecodeTime,e.samplerate),i=Math.ceil(ue.ONE_SECOND_IN_TS/(e.samplerate/1024)),n&&r&&(u=a-Math.max(n,r),h=(c=Math.floor(u/i))*i),!(c<1||h>ue.ONE_SECOND_IN_TS/2))){for((s=le()[e.samplerate])||(s=t[0].data),o=0;o<c;o++)l=t[0],t.splice(0,0,{data:s,dts:l.dts-i,pts:l.pts-i});return e.baseMediaDecodeTime-=Math.floor(ue.videoTsToAudioTs(h,e.samplerate)),h}},trimAdtsFramesByEarliestDts:function(e,t,n){return t.minSegmentDts>=n?e:(t.minSegmentDts=1/0,e.filter((function(e){return e.dts>=n&&(t.minSegmentDts=Math.min(t.minSegmentDts,e.dts),t.minSegmentPts=t.minSegmentDts,!0)})))},generateSampleTable:function(e){var t,n,r=[];for(t=0;t<e.length;t++)n=e[t],r.push({size:n.data.byteLength,duration:1024});return r},concatenateFrameData:function(e){var t,n,r=0,a=new Uint8Array(function(e){var t,n=0;for(t=0;t<e.length;t++)n+=e[t].data.byteLength;return n}(e));for(t=0;t<e.length;t++)n=e[t],a.set(n.data,r),r+=n.data.byteLength;return a}},he=oe.ONE_SECOND_IN_TS,de={clearDtsInfo:function(e){delete e.minSegmentDts,delete e.maxSegmentDts,delete e.minSegmentPts,delete e.maxSegmentPts},calculateTrackBaseMediaDecodeTime:function(e,t){var n,r=e.minSegmentDts;return t||(r-=e.timelineStartInfo.dts),n=e.timelineStartInfo.baseMediaDecodeTime,n+=r,n=Math.max(0,n),"audio"===e.type&&(n*=e.samplerate/he,n=Math.floor(n)),n},collectDtsInfo:function(e,t){"number"==typeof t.pts&&(void 0===e.timelineStartInfo.pts&&(e.timelineStartInfo.pts=t.pts),void 0===e.minSegmentPts?e.minSegmentPts=t.pts:e.minSegmentPts=Math.min(e.minSegmentPts,t.pts),void 0===e.maxSegmentPts?e.maxSegmentPts=t.pts:e.maxSegmentPts=Math.max(e.maxSegmentPts,t.pts)),"number"==typeof t.dts&&(void 0===e.timelineStartInfo.dts&&(e.timelineStartInfo.dts=t.dts),void 0===e.minSegmentDts?e.minSegmentDts=t.dts:e.minSegmentDts=Math.min(e.minSegmentDts,t.dts),void 0===e.maxSegmentDts?e.maxSegmentDts=t.dts:e.maxSegmentDts=Math.max(e.maxSegmentDts,t.dts))}},pe={parseSei:function(e){for(var t=0,n={payloadType:-1,payloadSize:0},r=0,a=0;t<e.byteLength&&128!==e[t];){for(;255===e[t];)r+=255,t++;for(r+=e[t++];255===e[t];)a+=255,t++;if(a+=e[t++],!n.payload&&4===r){if("GA94"===String.fromCharCode(e[t+3],e[t+4],e[t+5],e[t+6])){n.payloadType=r,n.payloadSize=a,n.payload=e.subarray(t,t+a);break}n.payload=void 0}t+=a,r=0,a=0}return n},parseUserData:function(e){return 181!==e.payload[0]||49!=(e.payload[1]<<8|e.payload[2])||"GA94"!==String.fromCharCode(e.payload[3],e.payload[4],e.payload[5],e.payload[6])||3!==e.payload[7]?null:e.payload.subarray(8,e.payload.length-1)},parseCaptionPackets:function(e,t){var n,r,a,i,s=[];if(!(64&t[0]))return s;for(r=31&t[0],n=0;n<r;n++)i={type:3&t[(a=3*n)+2],pts:e},4&t[a+2]&&(i.ccData=t[a+3]<<8|t[a+4],s.push(i));return s},discardEmulationPreventionBytes:function(e){for(var t,n,r=e.byteLength,a=[],i=1;i<r-2;)0===e[i]&&0===e[i+1]&&3===e[i+2]?(a.push(i+2),i+=2):i++;if(0===a.length)return e;t=r-a.length,n=new Uint8Array(t);var s=0;for(i=0;i<t;s++,i++)s===a[0]&&(s++,a.shift()),n[i]=e[s];return n},USER_DATA_REGISTERED_ITU_T_T35:4},fe=z,me=pe,ge=function(e){e=e||{},ge.prototype.init.call(this),this.parse708captions_="boolean"!=typeof e.parse708captions||e.parse708captions,this.captionPackets_=[],this.ccStreams_=[new Ee(0,0),new Ee(0,1),new Ee(1,0),new Ee(1,1)],this.parse708captions_&&(this.cc708Stream_=new Te({captionServices:e.captionServices})),this.reset(),this.ccStreams_.forEach((function(e){e.on("data",this.trigger.bind(this,"data")),e.on("partialdone",this.trigger.bind(this,"partialdone")),e.on("done",this.trigger.bind(this,"done"))}),this),this.parse708captions_&&(this.cc708Stream_.on("data",this.trigger.bind(this,"data")),this.cc708Stream_.on("partialdone",this.trigger.bind(this,"partialdone")),this.cc708Stream_.on("done",this.trigger.bind(this,"done")))};ge.prototype=new fe,ge.prototype.push=function(e){var t,n,r;if("sei_rbsp"===e.nalUnitType&&(t=me.parseSei(e.escapedRBSP)).payload&&t.payloadType===me.USER_DATA_REGISTERED_ITU_T_T35&&(n=me.parseUserData(t)))if(e.dts<this.latestDts_)this.ignoreNextEqualDts_=!0;else{if(e.dts===this.latestDts_&&this.ignoreNextEqualDts_)return this.numSameDts_--,void(this.numSameDts_||(this.ignoreNextEqualDts_=!1));r=me.parseCaptionPackets(e.pts,n),this.captionPackets_=this.captionPackets_.concat(r),this.latestDts_!==e.dts&&(this.numSameDts_=0),this.numSameDts_++,this.latestDts_=e.dts}},ge.prototype.flushCCStreams=function(e){this.ccStreams_.forEach((function(t){return"flush"===e?t.flush():t.partialFlush()}),this)},ge.prototype.flushStream=function(e){this.captionPackets_.length?(this.captionPackets_.forEach((function(e,t){e.presortIndex=t})),this.captionPackets_.sort((function(e,t){return e.pts===t.pts?e.presortIndex-t.presortIndex:e.pts-t.pts})),this.captionPackets_.forEach((function(e){e.type<2?this.dispatchCea608Packet(e):this.dispatchCea708Packet(e)}),this),this.captionPackets_.length=0,this.flushCCStreams(e)):this.flushCCStreams(e)},ge.prototype.flush=function(){return this.flushStream("flush")},ge.prototype.partialFlush=function(){return this.flushStream("partialFlush")},ge.prototype.reset=function(){this.latestDts_=null,this.ignoreNextEqualDts_=!1,this.numSameDts_=0,this.activeCea608Channel_=[null,null],this.ccStreams_.forEach((function(e){e.reset()}))},ge.prototype.dispatchCea608Packet=function(e){this.setsTextOrXDSActive(e)?this.activeCea608Channel_[e.type]=null:this.setsChannel1Active(e)?this.activeCea608Channel_[e.type]=0:this.setsChannel2Active(e)&&(this.activeCea608Channel_[e.type]=1),null!==this.activeCea608Channel_[e.type]&&this.ccStreams_[(e.type<<1)+this.activeCea608Channel_[e.type]].push(e)},ge.prototype.setsChannel1Active=function(e){return 4096==(30720&e.ccData)},ge.prototype.setsChannel2Active=function(e){return 6144==(30720&e.ccData)},ge.prototype.setsTextOrXDSActive=function(e){return 256==(28928&e.ccData)||4138==(30974&e.ccData)||6186==(30974&e.ccData)},ge.prototype.dispatchCea708Packet=function(e){this.parse708captions_&&this.cc708Stream_.push(e)};var ye={127:9834,4128:32,4129:160,4133:8230,4138:352,4140:338,4144:9608,4145:8216,4146:8217,4147:8220,4148:8221,4149:8226,4153:8482,4154:353,4156:339,4157:8480,4159:376,4214:8539,4215:8540,4216:8541,4217:8542,4218:9168,4219:9124,4220:9123,4221:9135,4222:9126,4223:9121,4256:12600},ve=function(e){return 32<=e&&e<=127||160<=e&&e<=255},be=function(e){this.windowNum=e,this.reset()};be.prototype.reset=function(){this.clearText(),this.pendingNewLine=!1,this.winAttr={},this.penAttr={},this.penLoc={},this.penColor={},this.visible=0,this.rowLock=0,this.columnLock=0,this.priority=0,this.relativePositioning=0,this.anchorVertical=0,this.anchorHorizontal=0,this.anchorPoint=0,this.rowCount=1,this.virtualRowCount=this.rowCount+1,this.columnCount=41,this.windowStyle=0,this.penStyle=0},be.prototype.getText=function(){return this.rows.join("\n")},be.prototype.clearText=function(){this.rows=[""],this.rowIdx=0},be.prototype.newLine=function(e){for(this.rows.length>=this.virtualRowCount&&"function"==typeof this.beforeRowOverflow&&this.beforeRowOverflow(e),this.rows.length>0&&(this.rows.push(""),this.rowIdx++);this.rows.length>this.virtualRowCount;)this.rows.shift(),this.rowIdx--},be.prototype.isEmpty=function(){return 0===this.rows.length||1===this.rows.length&&""===this.rows[0]},be.prototype.addText=function(e){this.rows[this.rowIdx]+=e},be.prototype.backspace=function(){if(!this.isEmpty()){var e=this.rows[this.rowIdx];this.rows[this.rowIdx]=e.substr(0,e.length-1)}};var xe=function(e,t,n){this.serviceNum=e,this.text="",this.currentWindow=new be(-1),this.windows=[],this.stream=n,"string"==typeof t&&this.createTextDecoder(t)};xe.prototype.init=function(e,t){this.startPts=e;for(var n=0;n<8;n++)this.windows[n]=new be(n),"function"==typeof t&&(this.windows[n].beforeRowOverflow=t)},xe.prototype.setCurrentWindow=function(e){this.currentWindow=this.windows[e]},xe.prototype.createTextDecoder=function(e){if("undefined"==typeof TextDecoder)this.stream.trigger("log",{level:"warn",message:"The `encoding` option is unsupported without TextDecoder support"});else try{this.textDecoder_=new TextDecoder(e)}catch(t){this.stream.trigger("log",{level:"warn",message:"TextDecoder could not be created with "+e+" encoding. "+t})}};var Te=function(e){e=e||{},Te.prototype.init.call(this);var t,n=this,r=e.captionServices||{},a={};Object.keys(r).forEach((e=>{t=r[e],/^SERVICE/.test(e)&&(a[e]=t.encoding)})),this.serviceEncodings=a,this.current708Packet=null,this.services={},this.push=function(e){3===e.type?(n.new708Packet(),n.add708Bytes(e)):(null===n.current708Packet&&n.new708Packet(),n.add708Bytes(e))}};Te.prototype=new fe,Te.prototype.new708Packet=function(){null!==this.current708Packet&&this.push708Packet(),this.current708Packet={data:[],ptsVals:[]}},Te.prototype.add708Bytes=function(e){var t=e.ccData,n=t>>>8,r=255&t;this.current708Packet.ptsVals.push(e.pts),this.current708Packet.data.push(n),this.current708Packet.data.push(r)},Te.prototype.push708Packet=function(){var e=this.current708Packet,t=e.data,n=null,r=null,a=0,i=t[a++];for(e.seq=i>>6,e.sizeCode=63&i;a<t.length;a++)r=31&(i=t[a++]),7===(n=i>>5)&&r>0&&(n=i=t[a++]),this.pushServiceBlock(n,a,r),r>0&&(a+=r-1)},Te.prototype.pushServiceBlock=function(e,t,n){var r,a=t,i=this.current708Packet.data,s=this.services[e];for(s||(s=this.initService(e,a));a<t+n&&a<i.length;a++)r=i[a],ve(r)?a=this.handleText(a,s):24===r?a=this.multiByteCharacter(a,s):16===r?a=this.extendedCommands(a,s):128<=r&&r<=135?a=this.setCurrentWindow(a,s):152<=r&&r<=159?a=this.defineWindow(a,s):136===r?a=this.clearWindows(a,s):140===r?a=this.deleteWindows(a,s):137===r?a=this.displayWindows(a,s):138===r?a=this.hideWindows(a,s):139===r?a=this.toggleWindows(a,s):151===r?a=this.setWindowAttributes(a,s):144===r?a=this.setPenAttributes(a,s):145===r?a=this.setPenColor(a,s):146===r?a=this.setPenLocation(a,s):143===r?s=this.reset(a,s):8===r?s.currentWindow.backspace():12===r?s.currentWindow.clearText():13===r?s.currentWindow.pendingNewLine=!0:14===r?s.currentWindow.clearText():141===r&&a++},Te.prototype.extendedCommands=function(e,t){var n=this.current708Packet.data[++e];return ve(n)&&(e=this.handleText(e,t,{isExtended:!0})),e},Te.prototype.getPts=function(e){return this.current708Packet.ptsVals[Math.floor(e/2)]},Te.prototype.initService=function(e,t){var n,r,a=this;return(n="SERVICE"+e)in this.serviceEncodings&&(r=this.serviceEncodings[n]),this.services[e]=new xe(e,r,a),this.services[e].init(this.getPts(t),(function(t){a.flushDisplayed(t,a.services[e])})),this.services[e]},Te.prototype.handleText=function(e,t,n){var r,a,i,s,o=n&&n.isExtended,l=n&&n.isMultiByte,u=this.current708Packet.data,c=o?4096:0,h=u[e],d=u[e+1],p=t.currentWindow;if(l?(a=[h,d],e++):a=[h],t.textDecoder_&&!o)r=t.textDecoder_.decode(new Uint8Array(a));else if(l){const e=a.map((e=>("0"+(255&e).toString(16)).slice(-2))).join("");r=String.fromCharCode(parseInt(e,16))}else s=ye[i=c|h]||i,r=4096&i&&i===s?"":String.fromCharCode(s);return p.pendingNewLine&&!p.isEmpty()&&p.newLine(this.getPts(e)),p.pendingNewLine=!1,p.addText(r),e},Te.prototype.multiByteCharacter=function(e,t){var n=this.current708Packet.data,r=n[e+1],a=n[e+2];return ve(r)&&ve(a)&&(e=this.handleText(++e,t,{isMultiByte:!0})),e},Te.prototype.setCurrentWindow=function(e,t){var n=7&this.current708Packet.data[e];return t.setCurrentWindow(n),e},Te.prototype.defineWindow=function(e,t){var n=this.current708Packet.data,r=n[e],a=7&r;t.setCurrentWindow(a);var i=t.currentWindow;return r=n[++e],i.visible=(32&r)>>5,i.rowLock=(16&r)>>4,i.columnLock=(8&r)>>3,i.priority=7&r,r=n[++e],i.relativePositioning=(128&r)>>7,i.anchorVertical=127&r,r=n[++e],i.anchorHorizontal=r,r=n[++e],i.anchorPoint=(240&r)>>4,i.rowCount=15&r,r=n[++e],i.columnCount=63&r,r=n[++e],i.windowStyle=(56&r)>>3,i.penStyle=7&r,i.virtualRowCount=i.rowCount+1,e},Te.prototype.setWindowAttributes=function(e,t){var n=this.current708Packet.data,r=n[e],a=t.currentWindow.winAttr;return r=n[++e],a.fillOpacity=(192&r)>>6,a.fillRed=(48&r)>>4,a.fillGreen=(12&r)>>2,a.fillBlue=3&r,r=n[++e],a.borderType=(192&r)>>6,a.borderRed=(48&r)>>4,a.borderGreen=(12&r)>>2,a.borderBlue=3&r,r=n[++e],a.borderType+=(128&r)>>5,a.wordWrap=(64&r)>>6,a.printDirection=(48&r)>>4,a.scrollDirection=(12&r)>>2,a.justify=3&r,r=n[++e],a.effectSpeed=(240&r)>>4,a.effectDirection=(12&r)>>2,a.displayEffect=3&r,e},Te.prototype.flushDisplayed=function(e,t){for(var n=[],r=0;r<8;r++)t.windows[r].visible&&!t.windows[r].isEmpty()&&n.push(t.windows[r].getText());t.endPts=e,t.text=n.join("\n\n"),this.pushCaption(t),t.startPts=e},Te.prototype.pushCaption=function(e){""!==e.text&&(this.trigger("data",{startPts:e.startPts,endPts:e.endPts,text:e.text,stream:"cc708_"+e.serviceNum}),e.text="",e.startPts=e.endPts)},Te.prototype.displayWindows=function(e,t){var n=this.current708Packet.data[++e],r=this.getPts(e);this.flushDisplayed(r,t);for(var a=0;a<8;a++)n&1<<a&&(t.windows[a].visible=1);return e},Te.prototype.hideWindows=function(e,t){var n=this.current708Packet.data[++e],r=this.getPts(e);this.flushDisplayed(r,t);for(var a=0;a<8;a++)n&1<<a&&(t.windows[a].visible=0);return e},Te.prototype.toggleWindows=function(e,t){var n=this.current708Packet.data[++e],r=this.getPts(e);this.flushDisplayed(r,t);for(var a=0;a<8;a++)n&1<<a&&(t.windows[a].visible^=1);return e},Te.prototype.clearWindows=function(e,t){var n=this.current708Packet.data[++e],r=this.getPts(e);this.flushDisplayed(r,t);for(var a=0;a<8;a++)n&1<<a&&t.windows[a].clearText();return e},Te.prototype.deleteWindows=function(e,t){var n=this.current708Packet.data[++e],r=this.getPts(e);this.flushDisplayed(r,t);for(var a=0;a<8;a++)n&1<<a&&t.windows[a].reset();return e},Te.prototype.setPenAttributes=function(e,t){var n=this.current708Packet.data,r=n[e],a=t.currentWindow.penAttr;return r=n[++e],a.textTag=(240&r)>>4,a.offset=(12&r)>>2,a.penSize=3&r,r=n[++e],a.italics=(128&r)>>7,a.underline=(64&r)>>6,a.edgeType=(56&r)>>3,a.fontStyle=7&r,e},Te.prototype.setPenColor=function(e,t){var n=this.current708Packet.data,r=n[e],a=t.currentWindow.penColor;return r=n[++e],a.fgOpacity=(192&r)>>6,a.fgRed=(48&r)>>4,a.fgGreen=(12&r)>>2,a.fgBlue=3&r,r=n[++e],a.bgOpacity=(192&r)>>6,a.bgRed=(48&r)>>4,a.bgGreen=(12&r)>>2,a.bgBlue=3&r,r=n[++e],a.edgeRed=(48&r)>>4,a.edgeGreen=(12&r)>>2,a.edgeBlue=3&r,e},Te.prototype.setPenLocation=function(e,t){var n=this.current708Packet.data,r=n[e],a=t.currentWindow.penLoc;return t.currentWindow.pendingNewLine=!0,r=n[++e],a.row=15&r,r=n[++e],a.column=63&r,e},Te.prototype.reset=function(e,t){var n=this.getPts(e);return this.flushDisplayed(n,t),this.initService(t.serviceNum,e)};var _e={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,304:174,305:176,306:189,307:191,308:8482,309:162,310:163,311:9834,312:224,313:160,314:232,315:226,316:234,317:238,318:244,319:251,544:193,545:201,546:211,547:218,548:220,549:252,550:8216,551:161,552:42,553:39,554:8212,555:169,556:8480,557:8226,558:8220,559:8221,560:192,561:194,562:199,563:200,564:202,565:203,566:235,567:206,568:207,569:239,570:212,571:217,572:249,573:219,574:171,575:187,800:195,801:227,802:205,803:204,804:236,805:210,806:242,807:213,808:245,809:123,810:125,811:92,812:94,813:95,814:124,815:126,816:196,817:228,818:214,819:246,820:223,821:165,822:164,823:9474,824:197,825:229,826:216,827:248,828:9484,829:9488,830:9492,831:9496},we=function(e){return null===e?"":(e=_e[e]||e,String.fromCharCode(e))},Se=[4352,4384,4608,4640,5376,5408,5632,5664,5888,5920,4096,4864,4896,5120,5152],Ce=function(){for(var e=[],t=15;t--;)e.push({text:"",indent:0,offset:0});return e},Ee=function(e,t){Ee.prototype.init.call(this),this.field_=e||0,this.dataChannel_=t||0,this.name_="CC"+(1+(this.field_<<1|this.dataChannel_)),this.setConstants(),this.reset(),this.push=function(e){var t,n,r,a,i;if((t=32639&e.ccData)!==this.lastControlCode_){if(4096==(61440&t)?this.lastControlCode_=t:t!==this.PADDING_&&(this.lastControlCode_=null),r=t>>>8,a=255&t,t!==this.PADDING_)if(t===this.RESUME_CAPTION_LOADING_)this.mode_="popOn";else if(t===this.END_OF_CAPTION_)this.mode_="popOn",this.clearFormatting(e.pts),this.flushDisplayed(e.pts),n=this.displayed_,this.displayed_=this.nonDisplayed_,this.nonDisplayed_=n,this.startPts_=e.pts;else if(t===this.ROLL_UP_2_ROWS_)this.rollUpRows_=2,this.setRollUp(e.pts);else if(t===this.ROLL_UP_3_ROWS_)this.rollUpRows_=3,this.setRollUp(e.pts);else if(t===this.ROLL_UP_4_ROWS_)this.rollUpRows_=4,this.setRollUp(e.pts);else if(t===this.CARRIAGE_RETURN_)this.clearFormatting(e.pts),this.flushDisplayed(e.pts),this.shiftRowsUp_(),this.startPts_=e.pts;else if(t===this.BACKSPACE_)"popOn"===this.mode_?this.nonDisplayed_[this.row_].text=this.nonDisplayed_[this.row_].text.slice(0,-1):this.displayed_[this.row_].text=this.displayed_[this.row_].text.slice(0,-1);else if(t===this.ERASE_DISPLAYED_MEMORY_)this.flushDisplayed(e.pts),this.displayed_=Ce();else if(t===this.ERASE_NON_DISPLAYED_MEMORY_)this.nonDisplayed_=Ce();else if(t===this.RESUME_DIRECT_CAPTIONING_)"paintOn"!==this.mode_&&(this.flushDisplayed(e.pts),this.displayed_=Ce()),this.mode_="paintOn",this.startPts_=e.pts;else if(this.isSpecialCharacter(r,a))i=we((r=(3&r)<<8)|a),this[this.mode_](e.pts,i),this.column_++;else if(this.isExtCharacter(r,a))"popOn"===this.mode_?this.nonDisplayed_[this.row_].text=this.nonDisplayed_[this.row_].text.slice(0,-1):this.displayed_[this.row_].text=this.displayed_[this.row_].text.slice(0,-1),i=we((r=(3&r)<<8)|a),this[this.mode_](e.pts,i),this.column_++;else if(this.isMidRowCode(r,a))this.clearFormatting(e.pts),this[this.mode_](e.pts," "),this.column_++,14==(14&a)&&this.addFormatting(e.pts,["i"]),1==(1&a)&&this.addFormatting(e.pts,["u"]);else if(this.isOffsetControlCode(r,a)){const e=3&a;this.nonDisplayed_[this.row_].offset=e,this.column_+=e}else if(this.isPAC(r,a)){var s=Se.indexOf(7968&t);if("rollUp"===this.mode_&&(s-this.rollUpRows_+1<0&&(s=this.rollUpRows_-1),this.setRollUp(e.pts,s)),s!==this.row_&&(this.clearFormatting(e.pts),this.row_=s),1&a&&-1===this.formatting_.indexOf("u")&&this.addFormatting(e.pts,["u"]),16==(16&t)){const e=(14&t)>>1;this.column_=4*e,this.nonDisplayed_[this.row_].indent+=e}this.isColorPAC(a)&&14==(14&a)&&this.addFormatting(e.pts,["i"])}else this.isNormalChar(r)&&(0===a&&(a=null),i=we(r),i+=we(a),this[this.mode_](e.pts,i),this.column_+=i.length)}else this.lastControlCode_=null}};Ee.prototype=new fe,Ee.prototype.flushDisplayed=function(e){const t=e=>{this.trigger("log",{level:"warn",message:"Skipping a malformed 608 caption at index "+e+"."})},n=[];this.displayed_.forEach(((e,r)=>{if(e&&e.text&&e.text.length){try{e.text=e.text.trim()}catch(e2){t(r)}e.text.length&&n.push({text:e.text,line:r+1,position:10+Math.min(70,10*e.indent)+2.5*e.offset})}else null==e&&t(r)})),n.length&&this.trigger("data",{startPts:this.startPts_,endPts:e,content:n,stream:this.name_})},Ee.prototype.reset=function(){this.mode_="popOn",this.topRow_=0,this.startPts_=0,this.displayed_=Ce(),this.nonDisplayed_=Ce(),this.lastControlCode_=null,this.column_=0,this.row_=14,this.rollUpRows_=2,this.formatting_=[]},Ee.prototype.setConstants=function(){0===this.dataChannel_?(this.BASE_=16,this.EXT_=17,this.CONTROL_=(20|this.field_)<<8,this.OFFSET_=23):1===this.dataChannel_&&(this.BASE_=24,this.EXT_=25,this.CONTROL_=(28|this.field_)<<8,this.OFFSET_=31),this.PADDING_=0,this.RESUME_CAPTION_LOADING_=32|this.CONTROL_,this.END_OF_CAPTION_=47|this.CONTROL_,this.ROLL_UP_2_ROWS_=37|this.CONTROL_,this.ROLL_UP_3_ROWS_=38|this.CONTROL_,this.ROLL_UP_4_ROWS_=39|this.CONTROL_,this.CARRIAGE_RETURN_=45|this.CONTROL_,this.RESUME_DIRECT_CAPTIONING_=41|this.CONTROL_,this.BACKSPACE_=33|this.CONTROL_,this.ERASE_DISPLAYED_MEMORY_=44|this.CONTROL_,this.ERASE_NON_DISPLAYED_MEMORY_=46|this.CONTROL_},Ee.prototype.isSpecialCharacter=function(e,t){return e===this.EXT_&&t>=48&&t<=63},Ee.prototype.isExtCharacter=function(e,t){return(e===this.EXT_+1||e===this.EXT_+2)&&t>=32&&t<=63},Ee.prototype.isMidRowCode=function(e,t){return e===this.EXT_&&t>=32&&t<=47},Ee.prototype.isOffsetControlCode=function(e,t){return e===this.OFFSET_&&t>=33&&t<=35},Ee.prototype.isPAC=function(e,t){return e>=this.BASE_&&e<this.BASE_+8&&t>=64&&t<=127},Ee.prototype.isColorPAC=function(e){return e>=64&&e<=79||e>=96&&e<=127},Ee.prototype.isNormalChar=function(e){return e>=32&&e<=127},Ee.prototype.setRollUp=function(e,t){if("rollUp"!==this.mode_&&(this.row_=14,this.mode_="rollUp",this.flushDisplayed(e),this.nonDisplayed_=Ce(),this.displayed_=Ce()),void 0!==t&&t!==this.row_)for(var n=0;n<this.rollUpRows_;n++)this.displayed_[t-n]=this.displayed_[this.row_-n],this.displayed_[this.row_-n]={text:"",indent:0,offset:0};void 0===t&&(t=this.row_),this.topRow_=t-this.rollUpRows_+1},Ee.prototype.addFormatting=function(e,t){this.formatting_=this.formatting_.concat(t);var n=t.reduce((function(e,t){return e+"<"+t+">"}),"");this[this.mode_](e,n)},Ee.prototype.clearFormatting=function(e){if(this.formatting_.length){var t=this.formatting_.reverse().reduce((function(e,t){return e+"</"+t+">"}),"");this.formatting_=[],this[this.mode_](e,t)}},Ee.prototype.popOn=function(e,t){var n=this.nonDisplayed_[this.row_].text;n+=t,this.nonDisplayed_[this.row_].text=n},Ee.prototype.rollUp=function(e,t){var n=this.displayed_[this.row_].text;n+=t,this.displayed_[this.row_].text=n},Ee.prototype.shiftRowsUp_=function(){var e;for(e=0;e<this.topRow_;e++)this.displayed_[e]={text:"",indent:0,offset:0};for(e=this.row_+1;e<15;e++)this.displayed_[e]={text:"",indent:0,offset:0};for(e=this.topRow_;e<this.row_;e++)this.displayed_[e]=this.displayed_[e+1];this.displayed_[this.row_]={text:"",indent:0,offset:0}},Ee.prototype.paintOn=function(e,t){var n=this.displayed_[this.row_].text;n+=t,this.displayed_[this.row_].text=n};var ke={CaptionStream:ge,Cea608Stream:Ee,Cea708Stream:Te},Ie={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21},Ae=z,Ne="shared",$e=function(e,t){var n=1;for(e>t&&(n=-1);Math.abs(t-e)>4294967296;)e+=8589934592*n;return e},De=function(e){var t,n;De.prototype.init.call(this),this.type_=e||Ne,this.push=function(e){"metadata"!==e.type?this.type_!==Ne&&e.type!==this.type_||(void 0===n&&(n=e.dts),e.dts=$e(e.dts,n),e.pts=$e(e.pts,n),t=e.dts,this.trigger("data",e)):this.trigger("data",e)},this.flush=function(){n=t,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.discontinuity=function(){n=void 0,t=void 0},this.reset=function(){this.discontinuity(),this.trigger("reset")}};De.prototype=new Ae;var Pe,Re={TimestampRolloverStream:De,handleRollover:$e},Me=(e,t,n)=>{if(!e)return-1;for(var r=n;r<e.length;r++)if(e[r]===t)return r;return-1},Oe=3,Fe=function(e,t,n){var r,a="";for(r=t;r<n;r++)a+="%"+("00"+e[r].toString(16)).slice(-2);return a},Le=function(e,t,n){return decodeURIComponent(Fe(e,t,n))},Be=function(e,t,n){return unescape(Fe(e,t,n))},Ve=function(e){return e[0]<<21|e[1]<<14|e[2]<<7|e[3]},Ue={APIC:function(e){var t,n,r=1;e.data[0]===Oe&&((t=Me(e.data,0,r))<0||(e.mimeType=Be(e.data,r,t),r=t+1,e.pictureType=e.data[r],r++,(n=Me(e.data,0,r))<0||(e.description=Le(e.data,r,n),r=n+1,"--\x3e"===e.mimeType?e.url=Be(e.data,r,e.data.length):e.pictureData=e.data.subarray(r,e.data.length))))},"T*":function(e){e.data[0]===Oe&&(e.value=Le(e.data,1,e.data.length).replace(/\0*$/,""),e.values=e.value.split("\0"))},TXXX:function(e){var t;e.data[0]===Oe&&-1!==(t=Me(e.data,0,1))&&(e.description=Le(e.data,1,t),e.value=Le(e.data,t+1,e.data.length).replace(/\0*$/,""),e.data=e.value)},"W*":function(e){e.url=Be(e.data,0,e.data.length).replace(/\0.*$/,"")},WXXX:function(e){var t;e.data[0]===Oe&&-1!==(t=Me(e.data,0,1))&&(e.description=Le(e.data,1,t),e.url=Be(e.data,t+1,e.data.length).replace(/\0.*$/,""))},PRIV:function(e){var t;for(t=0;t<e.data.length;t++)if(0===e.data[t]){e.owner=Be(e.data,0,t);break}e.privateData=e.data.subarray(t+1),e.data=e.privateData}},ze={parseId3Frames:function(e){var t,n=10,r=0,a=[];if(!(e.length<10||e[0]!=="I".charCodeAt(0)||e[1]!=="D".charCodeAt(0)||e[2]!=="3".charCodeAt(0))){r=Ve(e.subarray(6,10)),r+=10,64&e[5]&&(n+=4,n+=Ve(e.subarray(10,14)),r-=Ve(e.subarray(16,20)));do{if((t=Ve(e.subarray(n+4,n+8)))<1)break;var i={id:String.fromCharCode(e[n],e[n+1],e[n+2],e[n+3]),data:e.subarray(n+10,n+t+10)};i.key=i.id,Ue[i.id]?Ue[i.id](i):"T"===i.id[0]?Ue["T*"](i):"W"===i.id[0]&&Ue["W*"](i),a.push(i),n+=10,n+=t}while(n<r);return a}},parseSyncSafeInteger:Ve,frameParsers:Ue},Ge=Ie,We=ze;(Pe=function(e){var t,n={descriptor:e&&e.descriptor},r=0,a=[],i=0;if(Pe.prototype.init.call(this),this.dispatchType=Ge.METADATA_STREAM_TYPE.toString(16),n.descriptor)for(t=0;t<n.descriptor.length;t++)this.dispatchType+=("00"+n.descriptor[t].toString(16)).slice(-2);this.push=function(e){var t,n,s,o,l;if("timed-metadata"===e.type)if(e.dataAlignmentIndicator&&(i=0,a.length=0),0===a.length&&(e.data.length<10||e.data[0]!=="I".charCodeAt(0)||e.data[1]!=="D".charCodeAt(0)||e.data[2]!=="3".charCodeAt(0)))this.trigger("log",{level:"warn",message:"Skipping unrecognized metadata packet"});else if(a.push(e),i+=e.data.byteLength,1===a.length&&(r=We.parseSyncSafeInteger(e.data.subarray(6,10)),r+=10),!(i<r)){for(t={data:new Uint8Array(r),frames:[],pts:a[0].pts,dts:a[0].dts},l=0;l<r;)t.data.set(a[0].data.subarray(0,r-l),l),l+=a[0].data.byteLength,i-=a[0].data.byteLength,a.shift();n=10,64&t.data[5]&&(n+=4,n+=We.parseSyncSafeInteger(t.data.subarray(10,14)),r-=We.parseSyncSafeInteger(t.data.subarray(16,20)));do{if((s=We.parseSyncSafeInteger(t.data.subarray(n+4,n+8)))<1){this.trigger("log",{level:"warn",message:"Malformed ID3 frame encountered. Skipping remaining metadata parsing."});break}if((o={id:String.fromCharCode(t.data[n],t.data[n+1],t.data[n+2],t.data[n+3]),data:t.data.subarray(n+10,n+s+10)}).key=o.id,We.frameParsers[o.id]?We.frameParsers[o.id](o):"T"===o.id[0]?We.frameParsers["T*"](o):"W"===o.id[0]&&We.frameParsers["W*"](o),"com.apple.streaming.transportStreamTimestamp"===o.owner){var u=o.data,c=(1&u[3])<<30|u[4]<<22|u[5]<<14|u[6]<<6|u[7]>>>2;c*=4,c+=3&u[7],o.timeStamp=c,void 0===t.pts&&void 0===t.dts&&(t.pts=o.timeStamp,t.dts=o.timeStamp),this.trigger("timestamp",o)}t.frames.push(o),n+=10,n+=s}while(n<r);this.trigger("data",t)}}}).prototype=new z;var He,je,qe,Ke=Pe,Xe=z,Ye=ke,Ze=Ie,Je=Re.TimestampRolloverStream,Qe=188;(He=function(){var e=new Uint8Array(Qe),t=0;He.prototype.init.call(this),this.push=function(n){var r,a=0,i=Qe;for(t?((r=new Uint8Array(n.byteLength+t)).set(e.subarray(0,t)),r.set(n,t),t=0):r=n;i<r.byteLength;)71!==r[a]||71!==r[i]?(a++,i++):(this.trigger("data",r.subarray(a,i)),a+=Qe,i+=Qe);a<r.byteLength&&(e.set(r.subarray(a),0),t=r.byteLength-a)},this.flush=function(){t===Qe&&71===e[0]&&(this.trigger("data",e),t=0),this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.reset=function(){t=0,this.trigger("reset")}}).prototype=new Xe,(je=function(){var e,t,n,r;je.prototype.init.call(this),r=this,this.packetsWaitingForPmt=[],this.programMapTable=void 0,e=function(e,r){var a=0;r.payloadUnitStartIndicator&&(a+=e[a]+1),"pat"===r.type?t(e.subarray(a),r):n(e.subarray(a),r)},t=function(e,t){t.section_number=e[7],t.last_section_number=e[8],r.pmtPid=(31&e[10])<<8|e[11],t.pmtPid=r.pmtPid},n=function(e,t){var n,a;if(1&e[5]){for(r.programMapTable={video:null,audio:null,"timed-metadata":{}},n=3+((15&e[1])<<8|e[2])-4,a=12+((15&e[10])<<8|e[11]);a<n;){var i=e[a],s=(31&e[a+1])<<8|e[a+2];i===Ze.H264_STREAM_TYPE&&null===r.programMapTable.video?r.programMapTable.video=s:i===Ze.ADTS_STREAM_TYPE&&null===r.programMapTable.audio?r.programMapTable.audio=s:i===Ze.METADATA_STREAM_TYPE&&(r.programMapTable["timed-metadata"][s]=i),a+=5+((15&e[a+3])<<8|e[a+4])}t.programMapTable=r.programMapTable}},this.push=function(t){var n={},r=4;if(n.payloadUnitStartIndicator=!!(64&t[1]),n.pid=31&t[1],n.pid<<=8,n.pid|=t[2],(48&t[3])>>>4>1&&(r+=t[r]+1),0===n.pid)n.type="pat",e(t.subarray(r),n),this.trigger("data",n);else if(n.pid===this.pmtPid)for(n.type="pmt",e(t.subarray(r),n),this.trigger("data",n);this.packetsWaitingForPmt.length;)this.processPes_.apply(this,this.packetsWaitingForPmt.shift());else void 0===this.programMapTable?this.packetsWaitingForPmt.push([t,r,n]):this.processPes_(t,r,n)},this.processPes_=function(e,t,n){n.pid===this.programMapTable.video?n.streamType=Ze.H264_STREAM_TYPE:n.pid===this.programMapTable.audio?n.streamType=Ze.ADTS_STREAM_TYPE:n.streamType=this.programMapTable["timed-metadata"][n.pid],n.type="pes",n.data=e.subarray(t),this.trigger("data",n)}}).prototype=new Xe,je.STREAM_TYPES={h264:27,adts:15},(qe=function(){var e,t=this,n=!1,r={data:[],size:0},a={data:[],size:0},i={data:[],size:0},s=function(e,n,r){var a,i,s=new Uint8Array(e.size),o={type:n},l=0,u=0;if(e.data.length&&!(e.size<9)){for(o.trackId=e.data[0].pid,l=0;l<e.data.length;l++)i=e.data[l],s.set(i.data,u),u+=i.data.byteLength;!function(e,t){var n;const r=e[0]<<16|e[1]<<8|e[2];t.data=new Uint8Array,1===r&&(t.packetLength=6+(e[4]<<8|e[5]),t.dataAlignmentIndicator=0!=(4&e[6]),192&(n=e[7])&&(t.pts=(14&e[9])<<27|(255&e[10])<<20|(254&e[11])<<12|(255&e[12])<<5|(254&e[13])>>>3,t.pts*=4,t.pts+=(6&e[13])>>>1,t.dts=t.pts,64&n&&(t.dts=(14&e[14])<<27|(255&e[15])<<20|(254&e[16])<<12|(255&e[17])<<5|(254&e[18])>>>3,t.dts*=4,t.dts+=(6&e[18])>>>1)),t.data=e.subarray(9+e[8]))}(s,o),a="video"===n||o.packetLength<=e.size,(r||a)&&(e.size=0,e.data.length=0),a&&t.trigger("data",o)}};qe.prototype.init.call(this),this.push=function(o){({pat:function(){},pes:function(){var e,t;switch(o.streamType){case Ze.H264_STREAM_TYPE:e=r,t="video";break;case Ze.ADTS_STREAM_TYPE:e=a,t="audio";break;case Ze.METADATA_STREAM_TYPE:e=i,t="timed-metadata";break;default:return}o.payloadUnitStartIndicator&&s(e,t,!0),e.data.push(o),e.size+=o.data.byteLength},pmt:function(){var r={type:"metadata",tracks:[]};null!==(e=o.programMapTable).video&&r.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+e.video,codec:"avc",type:"video"}),null!==e.audio&&r.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+e.audio,codec:"adts",type:"audio"}),n=!0,t.trigger("data",r)}})[o.type]()},this.reset=function(){r.size=0,r.data.length=0,a.size=0,a.data.length=0,this.trigger("reset")},this.flushStreams_=function(){s(r,"video"),s(a,"audio"),s(i,"timed-metadata")},this.flush=function(){if(!n&&e){var r={type:"metadata",tracks:[]};null!==e.video&&r.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+e.video,codec:"avc",type:"video"}),null!==e.audio&&r.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+e.audio,codec:"adts",type:"audio"}),t.trigger("data",r)}n=!1,this.flushStreams_(),this.trigger("done")}}).prototype=new Xe;var et={PAT_PID:0,MP2T_PACKET_LENGTH:Qe,TransportPacketStream:He,TransportParseStream:je,ElementaryStream:qe,TimestampRolloverStream:Je,CaptionStream:Ye.CaptionStream,Cea608Stream:Ye.Cea608Stream,Cea708Stream:Ye.Cea708Stream,MetadataStream:Ke};for(var tt in Ze)Ze.hasOwnProperty(tt)&&(et[tt]=Ze[tt]);var nt,rt=et,at=oe.ONE_SECOND_IN_TS,it=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];(nt=function(e){var t,n=0;nt.prototype.init.call(this),this.skipWarn_=function(e,t){this.trigger("log",{level:"warn",message:`adts skiping bytes ${e} to ${t} in frame ${n} outside syncword`})},this.push=function(r){var a,i,s,o,l,u=0;if(e||(n=0),"audio"===r.type){var c;for(t&&t.length?(s=t,(t=new Uint8Array(s.byteLength+r.data.byteLength)).set(s),t.set(r.data,s.byteLength)):t=r.data;u+7<t.length;)if(255===t[u]&&240==(246&t[u+1])){if("number"==typeof c&&(this.skipWarn_(c,u),c=null),i=2*(1&~t[u+1]),a=(3&t[u+3])<<11|t[u+4]<<3|(224&t[u+5])>>5,l=(o=1024*(1+(3&t[u+6])))*at/it[(60&t[u+2])>>>2],t.byteLength-u<a)break;this.trigger("data",{pts:r.pts+n*l,dts:r.dts+n*l,sampleCount:o,audioobjecttype:1+(t[u+2]>>>6&3),channelcount:(1&t[u+2])<<2|(192&t[u+3])>>>6,samplerate:it[(60&t[u+2])>>>2],samplingfrequencyindex:(60&t[u+2])>>>2,samplesize:16,data:t.subarray(u+7+i,u+a)}),n++,u+=a}else"number"!=typeof c&&(c=u),u++;"number"==typeof c&&(this.skipWarn_(c,u),c=null),t=t.subarray(u)}},this.flush=function(){n=0,this.trigger("done")},this.reset=function(){t=void 0,this.trigger("reset")},this.endTimeline=function(){t=void 0,this.trigger("endedtimeline")}}).prototype=new z;var st,ot,lt,ut=nt,ct=z,ht=function(e){var t=e.byteLength,n=0,r=0;this.length=function(){return 8*t},this.bitsAvailable=function(){return 8*t+r},this.loadWord=function(){var a=e.byteLength-t,i=new Uint8Array(4),s=Math.min(4,t);if(0===s)throw new Error("no bytes available");i.set(e.subarray(a,a+s)),n=new DataView(i.buffer).getUint32(0),r=8*s,t-=s},this.skipBits=function(e){var a;r>e?(n<<=e,r-=e):(e-=r,e-=8*(a=Math.floor(e/8)),t-=a,this.loadWord(),n<<=e,r-=e)},this.readBits=function(e){var a=Math.min(r,e),i=n>>>32-a;return(r-=a)>0?n<<=a:t>0&&this.loadWord(),(a=e-a)>0?i<<a|this.readBits(a):i},this.skipLeadingZeros=function(){var e;for(e=0;e<r;++e)if(0!=(n&2147483648>>>e))return n<<=e,r-=e,e;return this.loadWord(),e+this.skipLeadingZeros()},this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.readUnsignedExpGolomb=function(){var e=this.skipLeadingZeros();return this.readBits(e+1)-1},this.readExpGolomb=function(){var e=this.readUnsignedExpGolomb();return 1&e?1+e>>>1:-1*(e>>>1)},this.readBoolean=function(){return 1===this.readBits(1)},this.readUnsignedByte=function(){return this.readBits(8)},this.loadWord()};(ot=function(){var e,t,n=0;ot.prototype.init.call(this),this.push=function(r){var a;t?((a=new Uint8Array(t.byteLength+r.data.byteLength)).set(t),a.set(r.data,t.byteLength),t=a):t=r.data;for(var i=t.byteLength;n<i-3;n++)if(1===t[n+2]){e=n+5;break}for(;e<i;)switch(t[e]){case 0:if(0!==t[e-1]){e+=2;break}if(0!==t[e-2]){e++;break}n+3!==e-2&&this.trigger("data",t.subarray(n+3,e-2));do{e++}while(1!==t[e]&&e<i);n=e-2,e+=3;break;case 1:if(0!==t[e-1]||0!==t[e-2]){e+=3;break}this.trigger("data",t.subarray(n+3,e-2)),n=e-2,e+=3;break;default:e+=3}t=t.subarray(n),e-=n,n=0},this.reset=function(){t=null,n=0,this.trigger("reset")},this.flush=function(){t&&t.byteLength>3&&this.trigger("data",t.subarray(n+3)),t=null,n=0,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")}}).prototype=new ct,lt={100:!0,110:!0,122:!0,244:!0,44:!0,83:!0,86:!0,118:!0,128:!0,138:!0,139:!0,134:!0},(st=function(){var e,t,n,r,a,i,s,o=new ot;st.prototype.init.call(this),e=this,this.push=function(e){"video"===e.type&&(t=e.trackId,n=e.pts,r=e.dts,o.push(e))},o.on("data",(function(s){var o={trackId:t,pts:n,dts:r,data:s,nalUnitTypeCode:31&s[0]};switch(o.nalUnitTypeCode){case 5:o.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:o.nalUnitType="sei_rbsp",o.escapedRBSP=a(s.subarray(1));break;case 7:o.nalUnitType="seq_parameter_set_rbsp",o.escapedRBSP=a(s.subarray(1)),o.config=i(o.escapedRBSP);break;case 8:o.nalUnitType="pic_parameter_set_rbsp";break;case 9:o.nalUnitType="access_unit_delimiter_rbsp"}e.trigger("data",o)})),o.on("done",(function(){e.trigger("done")})),o.on("partialdone",(function(){e.trigger("partialdone")})),o.on("reset",(function(){e.trigger("reset")})),o.on("endedtimeline",(function(){e.trigger("endedtimeline")})),this.flush=function(){o.flush()},this.partialFlush=function(){o.partialFlush()},this.reset=function(){o.reset()},this.endTimeline=function(){o.endTimeline()},s=function(e,t){var n,r=8,a=8;for(n=0;n<e;n++)0!==a&&(a=(r+t.readExpGolomb()+256)%256),r=0===a?r:a},a=function(e){for(var t,n,r=e.byteLength,a=[],i=1;i<r-2;)0===e[i]&&0===e[i+1]&&3===e[i+2]?(a.push(i+2),i+=2):i++;if(0===a.length)return e;t=r-a.length,n=new Uint8Array(t);var s=0;for(i=0;i<t;s++,i++)s===a[0]&&(s++,a.shift()),n[i]=e[s];return n},i=function(e){var t,n,r,a,i,o,l,u,c,h,d,p,f=0,m=0,g=0,y=0,v=[1,1];if(n=(t=new ht(e)).readUnsignedByte(),a=t.readUnsignedByte(),r=t.readUnsignedByte(),t.skipUnsignedExpGolomb(),lt[n]&&(3===(i=t.readUnsignedExpGolomb())&&t.skipBits(1),t.skipUnsignedExpGolomb(),t.skipUnsignedExpGolomb(),t.skipBits(1),t.readBoolean()))for(d=3!==i?8:12,p=0;p<d;p++)t.readBoolean()&&s(p<6?16:64,t);if(t.skipUnsignedExpGolomb(),0===(o=t.readUnsignedExpGolomb()))t.readUnsignedExpGolomb();else if(1===o)for(t.skipBits(1),t.skipExpGolomb(),t.skipExpGolomb(),l=t.readUnsignedExpGolomb(),p=0;p<l;p++)t.skipExpGolomb();if(t.skipUnsignedExpGolomb(),t.skipBits(1),u=t.readUnsignedExpGolomb(),c=t.readUnsignedExpGolomb(),0===(h=t.readBits(1))&&t.skipBits(1),t.skipBits(1),t.readBoolean()&&(f=t.readUnsignedExpGolomb(),m=t.readUnsignedExpGolomb(),g=t.readUnsignedExpGolomb(),y=t.readUnsignedExpGolomb()),t.readBoolean()&&t.readBoolean()){switch(t.readUnsignedByte()){case 1:v=[1,1];break;case 2:v=[12,11];break;case 3:v=[10,11];break;case 4:v=[16,11];break;case 5:v=[40,33];break;case 6:v=[24,11];break;case 7:v=[20,11];break;case 8:v=[32,11];break;case 9:v=[80,33];break;case 10:v=[18,11];break;case 11:v=[15,11];break;case 12:v=[64,33];break;case 13:v=[160,99];break;case 14:v=[4,3];break;case 15:v=[3,2];break;case 16:v=[2,1];break;case 255:v=[t.readUnsignedByte()<<8|t.readUnsignedByte(),t.readUnsignedByte()<<8|t.readUnsignedByte()]}v&&(v[0],v[1])}return{profileIdc:n,levelIdc:r,profileCompatibility:a,width:16*(u+1)-2*f-2*m,height:(2-h)*(c+1)*16-2*g-2*y,sarRatio:v}}}).prototype=new ct;var dt,pt={H264Stream:st,NalByteStream:ot},ft=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],mt=function(e,t){var n=e[t+6]<<21|e[t+7]<<14|e[t+8]<<7|e[t+9];return n=n>=0?n:0,(16&e[t+5])>>4?n+20:n+10},gt=function(e,t){return e.length-t<10||e[t]!=="I".charCodeAt(0)||e[t+1]!=="D".charCodeAt(0)||e[t+2]!=="3".charCodeAt(0)?t:(t+=mt(e,t),gt(e,t))},yt=function(e){return e[0]<<21|e[1]<<14|e[2]<<7|e[3]},vt={isLikelyAacData:function(e){var t=gt(e,0);return e.length>=t+2&&255==(255&e[t])&&240==(240&e[t+1])&&16==(22&e[t+1])},parseId3TagSize:mt,parseAdtsSize:function(e,t){var n=(224&e[t+5])>>5,r=e[t+4]<<3;return 6144&e[t+3]|r|n},parseType:function(e,t){return e[t]==="I".charCodeAt(0)&&e[t+1]==="D".charCodeAt(0)&&e[t+2]==="3".charCodeAt(0)?"timed-metadata":!0&e[t]&&240==(240&e[t+1])?"audio":null},parseSampleRate:function(e){for(var t=0;t+5<e.length;){if(255===e[t]&&240==(246&e[t+1]))return ft[(60&e[t+2])>>>2];t++}return null},parseAacTimestamp:function(e){var t,n,r;t=10,64&e[5]&&(t+=4,t+=yt(e.subarray(10,14)));do{if((n=yt(e.subarray(t+4,t+8)))<1)return null;if("PRIV"===String.fromCharCode(e[t],e[t+1],e[t+2],e[t+3])){r=e.subarray(t+10,t+n+10);for(var a=0;a<r.byteLength;a++)if(0===r[a]){var i=unescape(function(e,t,n){var r,a="";for(r=t;r<n;r++)a+="%"+("00"+e[r].toString(16)).slice(-2);return a}(r,0,a));if("com.apple.streaming.transportStreamTimestamp"===i){var s=r.subarray(a+1),o=(1&s[3])<<30|s[4]<<22|s[5]<<14|s[6]<<6|s[7]>>>2;return o*=4,o+=3&s[7]}break}}t+=10,t+=n}while(t<e.byteLength);return null}},bt=vt;(dt=function(){var e=new Uint8Array,t=0;dt.prototype.init.call(this),this.setTimestamp=function(e){t=e},this.push=function(n){var r,a,i,s,o=0,l=0;for(e.length?(s=e.length,(e=new Uint8Array(n.byteLength+s)).set(e.subarray(0,s)),e.set(n,s)):e=n;e.length-l>=3;)if(e[l]!=="I".charCodeAt(0)||e[l+1]!=="D".charCodeAt(0)||e[l+2]!=="3".charCodeAt(0))if(255!=(255&e[l])||240!=(240&e[l+1]))l++;else{if(e.length-l<7)break;if(l+(o=bt.parseAdtsSize(e,l))>e.length)break;i={type:"audio",data:e.subarray(l,l+o),pts:t,dts:t},this.trigger("data",i),l+=o}else{if(e.length-l<10)break;if(l+(o=bt.parseId3TagSize(e,l))>e.length)break;a={type:"timed-metadata",data:e.subarray(l,l+o)},this.trigger("data",a),l+=o}r=e.length-l,e=r>0?e.subarray(l):new Uint8Array},this.reset=function(){e=new Uint8Array,this.trigger("reset")},this.endTimeline=function(){e=new Uint8Array,this.trigger("endedtimeline")}}).prototype=new z;var xt,Tt,_t,wt,St=z,Ct=ee,Et=ne,kt=ce,It=de,At=rt,Nt=oe,$t=ut,Dt=pt.H264Stream,Pt=dt,Rt=vt.isLikelyAacData,Mt=oe.ONE_SECOND_IN_TS,Ot=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize"],Ft=["width","height","profileIdc","levelIdc","profileCompatibility","sarRatio"],Lt=function(e,t){t.stream=e,this.trigger("log",t)},Bt=function(e,t){for(var n=Object.keys(t),r=0;r<n.length;r++){var a=n[r];"headOfPipeline"!==a&&t[a].on&&t[a].on("log",Lt.bind(e,a))}},Vt=function(e,t){var n;if(e.length!==t.length)return!1;for(n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0},Ut=function(e,t,n,r,a,i){return{start:{dts:e,pts:e+(n-t)},end:{dts:e+(r-t),pts:e+(a-n)},prependedContentDuration:i,baseMediaDecodeTime:e}};(Tt=function(e,t){var n,r=[],a=0,i=0,s=1/0;n=(t=t||{}).firstSequenceNumber||0,Tt.prototype.init.call(this),this.push=function(t){It.collectDtsInfo(e,t),e&&Ot.forEach((function(n){e[n]=t[n]})),r.push(t)},this.setEarliestDts=function(e){a=e},this.setVideoBaseMediaDecodeTime=function(e){s=e},this.setAudioAppendStart=function(e){i=e},this.flush=function(){var o,l,u,c,h,d,p;0!==r.length?(o=kt.trimAdtsFramesByEarliestDts(r,e,a),e.baseMediaDecodeTime=It.calculateTrackBaseMediaDecodeTime(e,t.keepOriginalTimestamps),p=kt.prefixWithSilence(e,o,i,s),e.samples=kt.generateSampleTable(o),u=Ct.mdat(kt.concatenateFrameData(o)),r=[],l=Ct.moof(n,[e]),c=new Uint8Array(l.byteLength+u.byteLength),n++,c.set(l),c.set(u,l.byteLength),It.clearDtsInfo(e),h=Math.ceil(1024*Mt/e.samplerate),o.length&&(d=o.length*h,this.trigger("segmentTimingInfo",Ut(Nt.audioTsToVideoTs(e.baseMediaDecodeTime,e.samplerate),o[0].dts,o[0].pts,o[0].dts+d,o[0].pts+d,p||0)),this.trigger("timingInfo",{start:o[0].pts,end:o[0].pts+d})),this.trigger("data",{track:e,boxes:c}),this.trigger("done","AudioSegmentStream")):this.trigger("done","AudioSegmentStream")},this.reset=function(){It.clearDtsInfo(e),r=[],this.trigger("reset")}}).prototype=new St,(xt=function(e,t){var n,r,a,i=[],s=[];n=(t=t||{}).firstSequenceNumber||0,xt.prototype.init.call(this),delete e.minPTS,this.gopCache_=[],this.push=function(t){It.collectDtsInfo(e,t),"seq_parameter_set_rbsp"!==t.nalUnitType||r||(r=t.config,e.sps=[t.data],Ft.forEach((function(t){e[t]=r[t]}),this)),"pic_parameter_set_rbsp"!==t.nalUnitType||a||(a=t.data,e.pps=[t.data]),i.push(t)},this.flush=function(){for(var r,a,o,l,u,c,h,d,p=0;i.length&&"access_unit_delimiter_rbsp"!==i[0].nalUnitType;)i.shift();if(0===i.length)return this.resetStream_(),void this.trigger("done","VideoSegmentStream");if(r=Et.groupNalsIntoFrames(i),(o=Et.groupFramesIntoGops(r))[0][0].keyFrame||((a=this.getGopForFusion_(i[0],e))?(p=a.duration,o.unshift(a),o.byteLength+=a.byteLength,o.nalCount+=a.nalCount,o.pts=a.pts,o.dts=a.dts,o.duration+=a.duration):o=Et.extendFirstKeyFrame(o)),s.length){var f;if(!(f=t.alignGopsAtEnd?this.alignGopsAtEnd_(o):this.alignGopsAtStart_(o)))return this.gopCache_.unshift({gop:o.pop(),pps:e.pps,sps:e.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),i=[],this.resetStream_(),void this.trigger("done","VideoSegmentStream");It.clearDtsInfo(e),o=f}It.collectDtsInfo(e,o),e.samples=Et.generateSampleTable(o),u=Ct.mdat(Et.concatenateNalData(o)),e.baseMediaDecodeTime=It.calculateTrackBaseMediaDecodeTime(e,t.keepOriginalTimestamps),this.trigger("processedGopsInfo",o.map((function(e){return{pts:e.pts,dts:e.dts,byteLength:e.byteLength}}))),h=o[0],d=o[o.length-1],this.trigger("segmentTimingInfo",Ut(e.baseMediaDecodeTime,h.dts,h.pts,d.dts+d.duration,d.pts+d.duration,p)),this.trigger("timingInfo",{start:o[0].pts,end:o[o.length-1].pts+o[o.length-1].duration}),this.gopCache_.unshift({gop:o.pop(),pps:e.pps,sps:e.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),i=[],this.trigger("baseMediaDecodeTime",e.baseMediaDecodeTime),this.trigger("timelineStartInfo",e.timelineStartInfo),l=Ct.moof(n,[e]),c=new Uint8Array(l.byteLength+u.byteLength),n++,c.set(l),c.set(u,l.byteLength),this.trigger("data",{track:e,boxes:c}),this.resetStream_(),this.trigger("done","VideoSegmentStream")},this.reset=function(){this.resetStream_(),i=[],this.gopCache_.length=0,s.length=0,this.trigger("reset")},this.resetStream_=function(){It.clearDtsInfo(e),r=void 0,a=void 0},this.getGopForFusion_=function(t){var n,r,a,i,s,o=1/0;for(s=0;s<this.gopCache_.length;s++)a=(i=this.gopCache_[s]).gop,e.pps&&Vt(e.pps[0],i.pps[0])&&e.sps&&Vt(e.sps[0],i.sps[0])&&(a.dts<e.timelineStartInfo.dts||(n=t.dts-a.dts-a.duration)>=-1e4&&n<=45e3&&(!r||o>n)&&(r=i,o=n));return r?r.gop:null},this.alignGopsAtStart_=function(e){var t,n,r,a,i,o,l,u;for(i=e.byteLength,o=e.nalCount,l=e.duration,t=n=0;t<s.length&&n<e.length&&(r=s[t],a=e[n],r.pts!==a.pts);)a.pts>r.pts?t++:(n++,i-=a.byteLength,o-=a.nalCount,l-=a.duration);return 0===n?e:n===e.length?null:((u=e.slice(n)).byteLength=i,u.duration=l,u.nalCount=o,u.pts=u[0].pts,u.dts=u[0].dts,u)},this.alignGopsAtEnd_=function(e){var t,n,r,a,i,o,l;for(t=s.length-1,n=e.length-1,i=null,o=!1;t>=0&&n>=0;){if(r=s[t],a=e[n],r.pts===a.pts){o=!0;break}r.pts>a.pts?t--:(t===s.length-1&&(i=n),n--)}if(!o&&null===i)return null;if(0===(l=o?n:i))return e;var u=e.slice(l),c=u.reduce((function(e,t){return e.byteLength+=t.byteLength,e.duration+=t.duration,e.nalCount+=t.nalCount,e}),{byteLength:0,duration:0,nalCount:0});return u.byteLength=c.byteLength,u.duration=c.duration,u.nalCount=c.nalCount,u.pts=u[0].pts,u.dts=u[0].dts,u},this.alignGopsWith=function(e){s=e}}).prototype=new St,(wt=function(e,t){this.numberOfTracks=0,this.metadataStream=t,void 0!==(e=e||{}).remux?this.remuxTracks=!!e.remux:this.remuxTracks=!0,"boolean"==typeof e.keepOriginalTimestamps?this.keepOriginalTimestamps=e.keepOriginalTimestamps:this.keepOriginalTimestamps=!1,this.pendingTracks=[],this.videoTrack=null,this.pendingBoxes=[],this.pendingCaptions=[],this.pendingMetadata=[],this.pendingBytes=0,this.emittedTracks=0,wt.prototype.init.call(this),this.push=function(e){return e.content||e.text?this.pendingCaptions.push(e):e.frames?this.pendingMetadata.push(e):(this.pendingTracks.push(e.track),this.pendingBytes+=e.boxes.byteLength,"video"===e.track.type&&(this.videoTrack=e.track,this.pendingBoxes.push(e.boxes)),void("audio"===e.track.type&&(this.audioTrack=e.track,this.pendingBoxes.unshift(e.boxes))))}}).prototype=new St,wt.prototype.flush=function(e){var t,n,r,a,i=0,s={captions:[],captionStreams:{},metadata:[],info:{}},o=0;if(this.pendingTracks.length<this.numberOfTracks){if("VideoSegmentStream"!==e&&"AudioSegmentStream"!==e)return;if(this.remuxTracks)return;if(0===this.pendingTracks.length)return this.emittedTracks++,void(this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0))}if(this.videoTrack?(o=this.videoTrack.timelineStartInfo.pts,Ft.forEach((function(e){s.info[e]=this.videoTrack[e]}),this)):this.audioTrack&&(o=this.audioTrack.timelineStartInfo.pts,Ot.forEach((function(e){s.info[e]=this.audioTrack[e]}),this)),this.videoTrack||this.audioTrack){for(1===this.pendingTracks.length?s.type=this.pendingTracks[0].type:s.type="combined",this.emittedTracks+=this.pendingTracks.length,r=Ct.initSegment(this.pendingTracks),s.initSegment=new Uint8Array(r.byteLength),s.initSegment.set(r),s.data=new Uint8Array(this.pendingBytes),a=0;a<this.pendingBoxes.length;a++)s.data.set(this.pendingBoxes[a],i),i+=this.pendingBoxes[a].byteLength;for(a=0;a<this.pendingCaptions.length;a++)(t=this.pendingCaptions[a]).startTime=Nt.metadataTsToSeconds(t.startPts,o,this.keepOriginalTimestamps),t.endTime=Nt.metadataTsToSeconds(t.endPts,o,this.keepOriginalTimestamps),s.captionStreams[t.stream]=!0,s.captions.push(t);for(a=0;a<this.pendingMetadata.length;a++)(n=this.pendingMetadata[a]).cueTime=Nt.metadataTsToSeconds(n.pts,o,this.keepOriginalTimestamps),s.metadata.push(n);for(s.metadata.dispatchType=this.metadataStream.dispatchType,this.pendingTracks.length=0,this.videoTrack=null,this.pendingBoxes.length=0,this.pendingCaptions.length=0,this.pendingBytes=0,this.pendingMetadata.length=0,this.trigger("data",s),a=0;a<s.captions.length;a++)t=s.captions[a],this.trigger("caption",t);for(a=0;a<s.metadata.length;a++)n=s.metadata[a],this.trigger("id3Frame",n)}this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0)},wt.prototype.setRemux=function(e){this.remuxTracks=e},(_t=function(e){var t,n,r=this,a=!0;_t.prototype.init.call(this),e=e||{},this.baseMediaDecodeTime=e.baseMediaDecodeTime||0,this.transmuxPipeline_={},this.setupAacPipeline=function(){var a={};this.transmuxPipeline_=a,a.type="aac",a.metadataStream=new At.MetadataStream,a.aacStream=new Pt,a.audioTimestampRolloverStream=new At.TimestampRolloverStream("audio"),a.timedMetadataTimestampRolloverStream=new At.TimestampRolloverStream("timed-metadata"),a.adtsStream=new $t,a.coalesceStream=new wt(e,a.metadataStream),a.headOfPipeline=a.aacStream,a.aacStream.pipe(a.audioTimestampRolloverStream).pipe(a.adtsStream),a.aacStream.pipe(a.timedMetadataTimestampRolloverStream).pipe(a.metadataStream).pipe(a.coalesceStream),a.metadataStream.on("timestamp",(function(e){a.aacStream.setTimestamp(e.timeStamp)})),a.aacStream.on("data",(function(i){"timed-metadata"!==i.type&&"audio"!==i.type||a.audioSegmentStream||(n=n||{timelineStartInfo:{baseMediaDecodeTime:r.baseMediaDecodeTime},codec:"adts",type:"audio"},a.coalesceStream.numberOfTracks++,a.audioSegmentStream=new Tt(n,e),a.audioSegmentStream.on("log",r.getLogTrigger_("audioSegmentStream")),a.audioSegmentStream.on("timingInfo",r.trigger.bind(r,"audioTimingInfo")),a.adtsStream.pipe(a.audioSegmentStream).pipe(a.coalesceStream),r.trigger("trackinfo",{hasAudio:!!n,hasVideo:!!t}))})),a.coalesceStream.on("data",this.trigger.bind(this,"data")),a.coalesceStream.on("done",this.trigger.bind(this,"done")),Bt(this,a)},this.setupTsPipeline=function(){var a={};this.transmuxPipeline_=a,a.type="ts",a.metadataStream=new At.MetadataStream,a.packetStream=new At.TransportPacketStream,a.parseStream=new At.TransportParseStream,a.elementaryStream=new At.ElementaryStream,a.timestampRolloverStream=new At.TimestampRolloverStream,a.adtsStream=new $t,a.h264Stream=new Dt,a.captionStream=new At.CaptionStream(e),a.coalesceStream=new wt(e,a.metadataStream),a.headOfPipeline=a.packetStream,a.packetStream.pipe(a.parseStream).pipe(a.elementaryStream).pipe(a.timestampRolloverStream),a.timestampRolloverStream.pipe(a.h264Stream),a.timestampRolloverStream.pipe(a.adtsStream),a.timestampRolloverStream.pipe(a.metadataStream).pipe(a.coalesceStream),a.h264Stream.pipe(a.captionStream).pipe(a.coalesceStream),a.elementaryStream.on("data",(function(i){var s;if("metadata"===i.type){for(s=i.tracks.length;s--;)t||"video"!==i.tracks[s].type?n||"audio"!==i.tracks[s].type||((n=i.tracks[s]).timelineStartInfo.baseMediaDecodeTime=r.baseMediaDecodeTime):(t=i.tracks[s]).timelineStartInfo.baseMediaDecodeTime=r.baseMediaDecodeTime;t&&!a.videoSegmentStream&&(a.coalesceStream.numberOfTracks++,a.videoSegmentStream=new xt(t,e),a.videoSegmentStream.on("log",r.getLogTrigger_("videoSegmentStream")),a.videoSegmentStream.on("timelineStartInfo",(function(t){n&&!e.keepOriginalTimestamps&&(n.timelineStartInfo=t,a.audioSegmentStream.setEarliestDts(t.dts-r.baseMediaDecodeTime))})),a.videoSegmentStream.on("processedGopsInfo",r.trigger.bind(r,"gopInfo")),a.videoSegmentStream.on("segmentTimingInfo",r.trigger.bind(r,"videoSegmentTimingInfo")),a.videoSegmentStream.on("baseMediaDecodeTime",(function(e){n&&a.audioSegmentStream.setVideoBaseMediaDecodeTime(e)})),a.videoSegmentStream.on("timingInfo",r.trigger.bind(r,"videoTimingInfo")),a.h264Stream.pipe(a.videoSegmentStream).pipe(a.coalesceStream)),n&&!a.audioSegmentStream&&(a.coalesceStream.numberOfTracks++,a.audioSegmentStream=new Tt(n,e),a.audioSegmentStream.on("log",r.getLogTrigger_("audioSegmentStream")),a.audioSegmentStream.on("timingInfo",r.trigger.bind(r,"audioTimingInfo")),a.audioSegmentStream.on("segmentTimingInfo",r.trigger.bind(r,"audioSegmentTimingInfo")),a.adtsStream.pipe(a.audioSegmentStream).pipe(a.coalesceStream)),r.trigger("trackinfo",{hasAudio:!!n,hasVideo:!!t})}})),a.coalesceStream.on("data",this.trigger.bind(this,"data")),a.coalesceStream.on("id3Frame",(function(e){e.dispatchType=a.metadataStream.dispatchType,r.trigger("id3Frame",e)})),a.coalesceStream.on("caption",this.trigger.bind(this,"caption")),a.coalesceStream.on("done",this.trigger.bind(this,"done")),Bt(this,a)},this.setBaseMediaDecodeTime=function(r){var a=this.transmuxPipeline_;e.keepOriginalTimestamps||(this.baseMediaDecodeTime=r),n&&(n.timelineStartInfo.dts=void 0,n.timelineStartInfo.pts=void 0,It.clearDtsInfo(n),a.audioTimestampRolloverStream&&a.audioTimestampRolloverStream.discontinuity()),t&&(a.videoSegmentStream&&(a.videoSegmentStream.gopCache_=[]),t.timelineStartInfo.dts=void 0,t.timelineStartInfo.pts=void 0,It.clearDtsInfo(t),a.captionStream.reset()),a.timestampRolloverStream&&a.timestampRolloverStream.discontinuity()},this.setAudioAppendStart=function(e){n&&this.transmuxPipeline_.audioSegmentStream.setAudioAppendStart(e)},this.setRemux=function(t){var n=this.transmuxPipeline_;e.remux=t,n&&n.coalesceStream&&n.coalesceStream.setRemux(t)},this.alignGopsWith=function(e){t&&this.transmuxPipeline_.videoSegmentStream&&this.transmuxPipeline_.videoSegmentStream.alignGopsWith(e)},this.getLogTrigger_=function(e){var t=this;return function(n){n.stream=e,t.trigger("log",n)}},this.push=function(e){if(a){var t=Rt(e);t&&"aac"!==this.transmuxPipeline_.type?this.setupAacPipeline():t||"ts"===this.transmuxPipeline_.type||this.setupTsPipeline(),a=!1}this.transmuxPipeline_.headOfPipeline.push(e)},this.flush=function(){a=!0,this.transmuxPipeline_.headOfPipeline.flush()},this.endTimeline=function(){this.transmuxPipeline_.headOfPipeline.endTimeline()},this.reset=function(){this.transmuxPipeline_.headOfPipeline&&this.transmuxPipeline_.headOfPipeline.reset()},this.resetCaptions=function(){this.transmuxPipeline_.captionStream&&this.transmuxPipeline_.captionStream.reset()}}).prototype=new St;var zt,Gt,Wt,Ht,jt,qt={Transmuxer:_t,VideoSegmentStream:xt,AudioSegmentStream:Tt,AUDIO_PROPERTIES:Ot,VIDEO_PROPERTIES:Ft,generateSegmentTimingInfo:Ut},Kt=function(e){return e>>>0},Xt=function(e){var t="";return t+=String.fromCharCode(e[0]),t+=String.fromCharCode(e[1]),t+=String.fromCharCode(e[2]),t+=String.fromCharCode(e[3])},Yt=Kt,Zt=Xt,Jt=function(e,t){var n,r,a,i,s,o=[];if(!t.length)return null;for(n=0;n<e.byteLength;)r=Yt(e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3]),a=Zt(e.subarray(n+4,n+8)),i=r>1?n+r:e.byteLength,a===t[0]&&(1===t.length?o.push(e.subarray(n+8,i)):(s=Jt(e.subarray(n+8,i),t.slice(1))).length&&(o=o.concat(s))),n=i;return o},Qt=Kt,en=W.getUint64,tn=function(e){var t={version:e[0],flags:new Uint8Array(e.subarray(1,4))};return 1===t.version?t.baseMediaDecodeTime=en(e.subarray(4)):t.baseMediaDecodeTime=Qt(e[4]<<24|e[5]<<16|e[6]<<8|e[7]),t},nn=function(e){return{isLeading:(12&e[0])>>>2,dependsOn:3&e[0],isDependedOn:(192&e[1])>>>6,hasRedundancy:(48&e[1])>>>4,paddingValue:(14&e[1])>>>1,isNonSyncSample:1&e[1],degradationPriority:e[2]<<8|e[3]}},rn=function(e){var t,n={version:e[0],flags:new Uint8Array(e.subarray(1,4)),samples:[]},r=new DataView(e.buffer,e.byteOffset,e.byteLength),a=1&n.flags[2],i=4&n.flags[2],s=1&n.flags[1],o=2&n.flags[1],l=4&n.flags[1],u=8&n.flags[1],c=r.getUint32(4),h=8;for(a&&(n.dataOffset=r.getInt32(h),h+=4),i&&c&&(t={flags:nn(e.subarray(h,h+4))},h+=4,s&&(t.duration=r.getUint32(h),h+=4),o&&(t.size=r.getUint32(h),h+=4),u&&(1===n.version?t.compositionTimeOffset=r.getInt32(h):t.compositionTimeOffset=r.getUint32(h),h+=4),n.samples.push(t),c--);c--;)t={},s&&(t.duration=r.getUint32(h),h+=4),o&&(t.size=r.getUint32(h),h+=4),l&&(t.flags=nn(e.subarray(h,h+4)),h+=4),u&&(1===n.version?t.compositionTimeOffset=r.getInt32(h):t.compositionTimeOffset=r.getUint32(h),h+=4),n.samples.push(t);return n},an=function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength),r={version:e[0],flags:new Uint8Array(e.subarray(1,4)),trackId:n.getUint32(4)},a=1&r.flags[2],i=2&r.flags[2],s=8&r.flags[2],o=16&r.flags[2],l=32&r.flags[2],u=65536&r.flags[0],c=131072&r.flags[0];return t=8,a&&(t+=4,r.baseDataOffset=n.getUint32(12),t+=4),i&&(r.sampleDescriptionIndex=n.getUint32(t),t+=4),s&&(r.defaultSampleDuration=n.getUint32(t),t+=4),o&&(r.defaultSampleSize=n.getUint32(t),t+=4),l&&(r.defaultSampleFlags=n.getUint32(t)),u&&(r.durationIsEmpty=!0),!a&&c&&(r.baseDataOffsetIsMoof=!0),r},sn=(zt="undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{},pe.discardEmulationPreventionBytes),on=ke.CaptionStream,ln=Jt,un=tn,cn=rn,hn=an,dn=zt,pn=function(e,t){for(var n=e,r=0;r<t.length;r++){var a=t[r];if(n<a.size)return a;n-=a.size}return null},fn=function(e,t){var n=ln(e,["moof","traf"]),r=ln(e,["mdat"]),a={},i=[];return r.forEach((function(e,t){var r=n[t];i.push({mdat:e,traf:r})})),i.forEach((function(e){var n,r,i=e.mdat,s=e.traf,o=ln(s,["tfhd"]),l=hn(o[0]),u=l.trackId,c=ln(s,["tfdt"]),h=c.length>0?un(c[0]).baseMediaDecodeTime:0,d=ln(s,["trun"]);t===u&&d.length>0&&(n=function(e,t,n){var r=t,a=n.defaultSampleDuration||0,i=n.defaultSampleSize||0,s=n.trackId,o=[];return e.forEach((function(e){var t=cn(e).samples;t.forEach((function(e){void 0===e.duration&&(e.duration=a),void 0===e.size&&(e.size=i),e.trackId=s,e.dts=r,void 0===e.compositionTimeOffset&&(e.compositionTimeOffset=0),"bigint"==typeof r?(e.pts=r+dn.BigInt(e.compositionTimeOffset),r+=dn.BigInt(e.duration)):(e.pts=r+e.compositionTimeOffset,r+=e.duration)})),o=o.concat(t)})),o}(d,h,l),r=function(e,t,n){var r,a,i,s,o=new DataView(e.buffer,e.byteOffset,e.byteLength),l={logs:[],seiNals:[]};for(a=0;a+4<e.length;a+=i)if(i=o.getUint32(a),a+=4,!(i<=0))switch(31&e[a]){case 6:var u=e.subarray(a+1,a+1+i),c=pn(a,t);if(r={nalUnitType:"sei_rbsp",size:i,data:u,escapedRBSP:sn(u),trackId:n},c)r.pts=c.pts,r.dts=c.dts,s=c;else{if(!s){l.logs.push({level:"warn",message:"We've encountered a nal unit without data at "+a+" for trackId "+n+". See mux.js#223."});break}r.pts=s.pts,r.dts=s.dts}l.seiNals.push(r)}return l}(i,n,u),a[u]||(a[u]={seiNals:[],logs:[]}),a[u].seiNals=a[u].seiNals.concat(r.seiNals),a[u].logs=a[u].logs.concat(r.logs))})),a},mn=function(){var e,t,n,r,a,i,s=!1;this.isInitialized=function(){return s},this.init=function(t){e=new on,s=!0,i=!!t&&t.isPartial,e.on("data",(function(e){e.startTime=e.startPts/r,e.endTime=e.endPts/r,a.captions.push(e),a.captionStreams[e.stream]=!0})),e.on("log",(function(e){a.logs.push(e)}))},this.isNewInit=function(e,t){return!(e&&0===e.length||t&&"object"==typeof t&&0===Object.keys(t).length)&&(n!==e[0]||r!==t[n])},this.parse=function(e,i,s){var o;if(!this.isInitialized())return null;if(!i||!s)return null;if(this.isNewInit(i,s))n=i[0],r=s[n];else if(null===n||!r)return t.push(e),null;for(;t.length>0;){var l=t.shift();this.parse(l,i,s)}return o=function(e,t,n){if(null===t)return null;var r=fn(e,t)[t]||{};return{seiNals:r.seiNals,logs:r.logs,timescale:n}}(e,n,r),o&&o.logs&&(a.logs=a.logs.concat(o.logs)),null!==o&&o.seiNals?(this.pushNals(o.seiNals),this.flushStream(),a):a.logs.length?{logs:a.logs,captions:[],captionStreams:[]}:null},this.pushNals=function(t){if(!this.isInitialized()||!t||0===t.length)return null;t.forEach((function(t){e.push(t)}))},this.flushStream=function(){if(!this.isInitialized())return null;i?e.partialFlush():e.flush()},this.clearParsedCaptions=function(){a.captions=[],a.captionStreams={},a.logs=[]},this.resetCaptionStream=function(){if(!this.isInitialized())return null;e.reset()},this.clearAllCaptions=function(){this.clearParsedCaptions(),this.resetCaptionStream()},this.reset=function(){t=[],n=null,r=null,a?this.clearParsedCaptions():a={captions:[],captionStreams:{},logs:[]},this.resetCaptionStream()},this.reset()},gn=function(e){for(var t=0,n=String.fromCharCode(e[t]),r="";"\0"!==n;)r+=n,t++,n=String.fromCharCode(e[t]);return r+=n},yn=W.getUint64,vn=function(e,t){var n="\0"!==t.scheme_id_uri,r=0===e&&bn(t.presentation_time_delta)&&n,a=1===e&&bn(t.presentation_time)&&n;return!(e>1)&&r||a},bn=function(e){return void 0!==e||null!==e},xn=Kt,Tn=function(e){return("00"+e.toString(16)).slice(-2)},_n=Jt,wn=Xt,Sn={parseEmsgBox:function(e){var t,n,r,a,i,s,o,l=4,u=e[0];if(0===u)l+=(t=gn(e.subarray(l))).length,l+=(n=gn(e.subarray(l))).length,r=(c=new DataView(e.buffer)).getUint32(l),l+=4,i=c.getUint32(l),l+=4,s=c.getUint32(l),l+=4,o=c.getUint32(l),l+=4;else if(1===u){var c;r=(c=new DataView(e.buffer)).getUint32(l),l+=4,a=yn(e.subarray(l)),l+=8,s=c.getUint32(l),l+=4,o=c.getUint32(l),l+=4,l+=(t=gn(e.subarray(l))).length,l+=(n=gn(e.subarray(l))).length}var h={scheme_id_uri:t,value:n,timescale:r||1,presentation_time:a,presentation_time_delta:i,event_duration:s,id:o,message_data:new Uint8Array(e.subarray(l,e.byteLength))};return vn(u,h)?h:void 0},scaleTime:function(e,t,n,r){return e||0===e?e/t:r+n/t}},Cn=an,En=rn,kn=tn,In=W.getUint64,An=zt,Nn=ze.parseId3Frames;Gt=function(e,t){var n=_n(t,["moof","traf"]).reduce((function(t,n){var r,a=_n(n,["tfhd"])[0],i=xn(a[4]<<24|a[5]<<16|a[6]<<8|a[7]),s=e[i]||9e4,o=_n(n,["tfdt"])[0],l=new DataView(o.buffer,o.byteOffset,o.byteLength);let u;return"bigint"==typeof(r=1===o[0]?In(o.subarray(4,12)):l.getUint32(4))?u=r/An.BigInt(s):"number"!=typeof r||isNaN(r)||(u=r/s),u<Number.MAX_SAFE_INTEGER&&(u=Number(u)),u<t&&(t=u),t}),1/0);return"bigint"==typeof n||isFinite(n)?n:0},Wt=function(e){var t=_n(e,["moov","trak"]),n=[];return t.forEach((function(e){var t,r,a={},i=_n(e,["tkhd"])[0];i&&(r=(t=new DataView(i.buffer,i.byteOffset,i.byteLength)).getUint8(0),a.id=0===r?t.getUint32(12):t.getUint32(20));var s=_n(e,["mdia","hdlr"])[0];if(s){var o=wn(s.subarray(8,12));a.type="vide"===o?"video":"soun"===o?"audio":o}var l=_n(e,["mdia","minf","stbl","stsd"])[0];if(l){var u=l.subarray(8);a.codec=wn(u.subarray(4,8));var c,h=_n(u,[a.codec])[0];h&&(/^[asm]vc[1-9]$/i.test(a.codec)?(c=h.subarray(78),"avcC"===wn(c.subarray(4,8))&&c.length>11?(a.codec+=".",a.codec+=Tn(c[9]),a.codec+=Tn(c[10]),a.codec+=Tn(c[11])):a.codec="avc1.4d400d"):/^mp4[a,v]$/i.test(a.codec)?(c=h.subarray(28),"esds"===wn(c.subarray(4,8))&&c.length>20&&0!==c[19]?(a.codec+="."+Tn(c[19]),a.codec+="."+Tn(c[20]>>>2&63).replace(/^0/,"")):a.codec="mp4a.40.2"):a.codec=a.codec.toLowerCase())}var d=_n(e,["mdia","mdhd"])[0];d&&(a.timescale=Ht(d)),n.push(a)})),n},jt=function(e,t=0){return _n(e,["emsg"]).map((e=>{var n=Sn.parseEmsgBox(new Uint8Array(e)),r=Nn(n.message_data);return{cueTime:Sn.scaleTime(n.presentation_time,n.timescale,n.presentation_time_delta,t),duration:Sn.scaleTime(n.event_duration,n.timescale),frames:r}}))};var $n=Gt,Dn=Wt,Pn=(Ht=function(e){var t=0===e[0]?12:20;return xn(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])},jt),Rn=Ie,Mn=function(e){var t=31&e[1];return t<<=8,t|=e[2]},On=function(e){return!!(64&e[1])},Fn=function(e){var t=0;return(48&e[3])>>>4>1&&(t+=e[4]+1),t},Ln=function(e){switch(e){case 5:return"slice_layer_without_partitioning_rbsp_idr";case 6:return"sei_rbsp";case 7:return"seq_parameter_set_rbsp";case 8:return"pic_parameter_set_rbsp";case 9:return"access_unit_delimiter_rbsp";default:return null}},Bn={parseType:function(e,t){var n=Mn(e);return 0===n?"pat":n===t?"pmt":t?"pes":null},parsePat:function(e){var t=On(e),n=4+Fn(e);return t&&(n+=e[n]+1),(31&e[n+10])<<8|e[n+11]},parsePmt:function(e){var t={},n=On(e),r=4+Fn(e);if(n&&(r+=e[r]+1),1&e[r+5]){var a;a=3+((15&e[r+1])<<8|e[r+2])-4;for(var i=12+((15&e[r+10])<<8|e[r+11]);i<a;){var s=r+i;t[(31&e[s+1])<<8|e[s+2]]=e[s],i+=5+((15&e[s+3])<<8|e[s+4])}return t}},parsePayloadUnitStartIndicator:On,parsePesType:function(e,t){switch(t[Mn(e)]){case Rn.H264_STREAM_TYPE:return"video";case Rn.ADTS_STREAM_TYPE:return"audio";case Rn.METADATA_STREAM_TYPE:return"timed-metadata";default:return null}},parsePesTime:function(e){if(!On(e))return null;var t=4+Fn(e);if(t>=e.byteLength)return null;var n,r=null;return 192&(n=e[t+7])&&((r={}).pts=(14&e[t+9])<<27|(255&e[t+10])<<20|(254&e[t+11])<<12|(255&e[t+12])<<5|(254&e[t+13])>>>3,r.pts*=4,r.pts+=(6&e[t+13])>>>1,r.dts=r.pts,64&n&&(r.dts=(14&e[t+14])<<27|(255&e[t+15])<<20|(254&e[t+16])<<12|(255&e[t+17])<<5|(254&e[t+18])>>>3,r.dts*=4,r.dts+=(6&e[t+18])>>>1)),r},videoPacketContainsKeyFrame:function(e){for(var t=4+Fn(e),n=e.subarray(t),r=0,a=0,i=!1;a<n.byteLength-3;a++)if(1===n[a+2]){r=a+5;break}for(;r<n.byteLength;)switch(n[r]){case 0:if(0!==n[r-1]){r+=2;break}if(0!==n[r-2]){r++;break}a+3!==r-2&&"slice_layer_without_partitioning_rbsp_idr"===Ln(31&n[a+3])&&(i=!0);do{r++}while(1!==n[r]&&r<n.length);a=r-2,r+=3;break;case 1:if(0!==n[r-1]||0!==n[r-2]){r+=3;break}"slice_layer_without_partitioning_rbsp_idr"===Ln(31&n[a+3])&&(i=!0),a=r-2,r+=3;break;default:r+=3}return n=n.subarray(a),r-=a,a=0,n&&n.byteLength>3&&"slice_layer_without_partitioning_rbsp_idr"===Ln(31&n[a+3])&&(i=!0),i}},Vn=Ie,Un=Re.handleRollover,zn={};zn.ts=Bn,zn.aac=vt;var Gn=oe.ONE_SECOND_IN_TS,Wn=188,Hn=71,jn=function(e,t,n){for(var r,a,i,s,o=0,l=Wn,u=!1;l<=e.byteLength;)if(e[o]!==Hn||e[l]!==Hn&&l!==e.byteLength)o++,l++;else{if(r=e.subarray(o,l),"pes"===zn.ts.parseType(r,t.pid))a=zn.ts.parsePesType(r,t.table),i=zn.ts.parsePayloadUnitStartIndicator(r),"audio"===a&&i&&(s=zn.ts.parsePesTime(r))&&(s.type="audio",n.audio.push(s),u=!0);if(u)break;o+=Wn,l+=Wn}for(o=(l=e.byteLength)-Wn,u=!1;o>=0;)if(e[o]!==Hn||e[l]!==Hn&&l!==e.byteLength)o--,l--;else{if(r=e.subarray(o,l),"pes"===zn.ts.parseType(r,t.pid))a=zn.ts.parsePesType(r,t.table),i=zn.ts.parsePayloadUnitStartIndicator(r),"audio"===a&&i&&(s=zn.ts.parsePesTime(r))&&(s.type="audio",n.audio.push(s),u=!0);if(u)break;o-=Wn,l-=Wn}},qn=function(e,t,n){for(var r,a,i,s,o,l,u,c=0,h=Wn,d=!1,p={data:[],size:0};h<e.byteLength;)if(e[c]!==Hn||e[h]!==Hn)c++,h++;else{if(r=e.subarray(c,h),"pes"===zn.ts.parseType(r,t.pid))if(a=zn.ts.parsePesType(r,t.table),i=zn.ts.parsePayloadUnitStartIndicator(r),"video"===a&&(i&&!d&&(s=zn.ts.parsePesTime(r))&&(s.type="video",n.video.push(s),d=!0),!n.firstKeyFrame)){if(i&&0!==p.size){for(o=new Uint8Array(p.size),l=0;p.data.length;)u=p.data.shift(),o.set(u,l),l+=u.byteLength;if(zn.ts.videoPacketContainsKeyFrame(o)){var f=zn.ts.parsePesTime(o);f?(n.firstKeyFrame=f,n.firstKeyFrame.type="video"):console.warn("Failed to extract PTS/DTS from PES at first keyframe. This could be an unusual TS segment, or else mux.js did not parse your TS segment correctly. If you know your TS segments do contain PTS/DTS on keyframes please file a bug report! You can try ffprobe to double check for yourself.")}p.size=0}p.data.push(r),p.size+=r.byteLength}if(d&&n.firstKeyFrame)break;c+=Wn,h+=Wn}for(c=(h=e.byteLength)-Wn,d=!1;c>=0;)if(e[c]!==Hn||e[h]!==Hn)c--,h--;else{if(r=e.subarray(c,h),"pes"===zn.ts.parseType(r,t.pid))a=zn.ts.parsePesType(r,t.table),i=zn.ts.parsePayloadUnitStartIndicator(r),"video"===a&&i&&(s=zn.ts.parsePesTime(r))&&(s.type="video",n.video.push(s),d=!0);if(d)break;c-=Wn,h-=Wn}},Kn=function(e){var t={pid:null,table:null},n={};for(var r in function(e,t){for(var n,r=0,a=Wn;a<e.byteLength;)if(e[r]!==Hn||e[a]!==Hn)r++,a++;else{switch(n=e.subarray(r,a),zn.ts.parseType(n,t.pid)){case"pat":t.pid=zn.ts.parsePat(n);break;case"pmt":var i=zn.ts.parsePmt(n);t.table=t.table||{},Object.keys(i).forEach((function(e){t.table[e]=i[e]}))}r+=Wn,a+=Wn}}(e,t),t.table){if(t.table.hasOwnProperty(r))switch(t.table[r]){case Vn.H264_STREAM_TYPE:n.video=[],qn(e,t,n),0===n.video.length&&delete n.video;break;case Vn.ADTS_STREAM_TYPE:n.audio=[],jn(e,t,n),0===n.audio.length&&delete n.audio}}return n},Xn=function(e,t){var n;return n=zn.aac.isLikelyAacData(e)?function(e){for(var t,n=!1,r=0,a=null,i=null,s=0,o=0;e.length-o>=3;){switch(zn.aac.parseType(e,o)){case"timed-metadata":if(e.length-o<10){n=!0;break}if((s=zn.aac.parseId3TagSize(e,o))>e.length){n=!0;break}null===i&&(t=e.subarray(o,o+s),i=zn.aac.parseAacTimestamp(t)),o+=s;break;case"audio":if(e.length-o<7){n=!0;break}if((s=zn.aac.parseAdtsSize(e,o))>e.length){n=!0;break}null===a&&(t=e.subarray(o,o+s),a=zn.aac.parseSampleRate(t)),r++,o+=s;break;default:o++}if(n)return null}if(null===a||null===i)return null;var l=Gn/a;return{audio:[{type:"audio",dts:i,pts:i},{type:"audio",dts:i+1024*r*l,pts:i+1024*r*l}]}}(e):Kn(e),n&&(n.audio||n.video)?(function(e,t){if(e.audio&&e.audio.length){var n=t;(void 0===n||isNaN(n))&&(n=e.audio[0].dts),e.audio.forEach((function(e){e.dts=Un(e.dts,n),e.pts=Un(e.pts,n),e.dtsTime=e.dts/Gn,e.ptsTime=e.pts/Gn}))}if(e.video&&e.video.length){var r=t;if((void 0===r||isNaN(r))&&(r=e.video[0].dts),e.video.forEach((function(e){e.dts=Un(e.dts,r),e.pts=Un(e.pts,r),e.dtsTime=e.dts/Gn,e.ptsTime=e.pts/Gn})),e.firstKeyFrame){var a=e.firstKeyFrame;a.dts=Un(a.dts,r),a.pts=Un(a.pts,r),a.dtsTime=a.dts/Gn,a.ptsTime=a.pts/Gn}}}(n,t),n):null};class Yn{constructor(e,t){this.options=t||{},this.self=e,this.init()}init(){var e,t;this.transmuxer&&this.transmuxer.dispose(),this.transmuxer=new qt.Transmuxer(this.options),e=this.self,(t=this.transmuxer).on("data",(function(t){const n=t.initSegment;t.initSegment={data:n.buffer,byteOffset:n.byteOffset,byteLength:n.byteLength};const r=t.data;t.data=r.buffer,e.postMessage({action:"data",segment:t,byteOffset:r.byteOffset,byteLength:r.byteLength},[t.data])})),t.on("done",(function(t){e.postMessage({action:"done"})})),t.on("gopInfo",(function(t){e.postMessage({action:"gopInfo",gopInfo:t})})),t.on("videoSegmentTimingInfo",(function(t){const n={start:{decode:oe.videoTsToSeconds(t.start.dts),presentation:oe.videoTsToSeconds(t.start.pts)},end:{decode:oe.videoTsToSeconds(t.end.dts),presentation:oe.videoTsToSeconds(t.end.pts)},baseMediaDecodeTime:oe.videoTsToSeconds(t.baseMediaDecodeTime)};t.prependedContentDuration&&(n.prependedContentDuration=oe.videoTsToSeconds(t.prependedContentDuration)),e.postMessage({action:"videoSegmentTimingInfo",videoSegmentTimingInfo:n})})),t.on("audioSegmentTimingInfo",(function(t){const n={start:{decode:oe.videoTsToSeconds(t.start.dts),presentation:oe.videoTsToSeconds(t.start.pts)},end:{decode:oe.videoTsToSeconds(t.end.dts),presentation:oe.videoTsToSeconds(t.end.pts)},baseMediaDecodeTime:oe.videoTsToSeconds(t.baseMediaDecodeTime)};t.prependedContentDuration&&(n.prependedContentDuration=oe.videoTsToSeconds(t.prependedContentDuration)),e.postMessage({action:"audioSegmentTimingInfo",audioSegmentTimingInfo:n})})),t.on("id3Frame",(function(t){e.postMessage({action:"id3Frame",id3Frame:t})})),t.on("caption",(function(t){e.postMessage({action:"caption",caption:t})})),t.on("trackinfo",(function(t){e.postMessage({action:"trackinfo",trackInfo:t})})),t.on("audioTimingInfo",(function(t){e.postMessage({action:"audioTimingInfo",audioTimingInfo:{start:oe.videoTsToSeconds(t.start),end:oe.videoTsToSeconds(t.end)}})})),t.on("videoTimingInfo",(function(t){e.postMessage({action:"videoTimingInfo",videoTimingInfo:{start:oe.videoTsToSeconds(t.start),end:oe.videoTsToSeconds(t.end)}})})),t.on("log",(function(t){e.postMessage({action:"log",log:t})}))}pushMp4Captions(e){this.captionParser||(this.captionParser=new mn,this.captionParser.init());const t=new Uint8Array(e.data,e.byteOffset,e.byteLength),n=this.captionParser.parse(t,e.trackIds,e.timescales);this.self.postMessage({action:"mp4Captions",captions:n&&n.captions||[],logs:n&&n.logs||[],data:t.buffer},[t.buffer])}probeMp4StartTime({timescales:e,data:t}){const n=$n(e,t);this.self.postMessage({action:"probeMp4StartTime",startTime:n,data:t},[t.buffer])}probeMp4Tracks({data:e}){const t=Dn(e);this.self.postMessage({action:"probeMp4Tracks",tracks:t,data:e},[e.buffer])}probeEmsgID3({data:e,offset:t}){const n=Pn(e,t);this.self.postMessage({action:"probeEmsgID3",id3Frames:n,emsgData:e},[e.buffer])}probeTs({data:e,baseStartTime:t}){const n="number"!=typeof t||isNaN(t)?void 0:t*oe.ONE_SECOND_IN_TS,r=Xn(e,n);let a=null;r&&(a={hasVideo:r.video&&2===r.video.length||!1,hasAudio:r.audio&&2===r.audio.length||!1},a.hasVideo&&(a.videoStart=r.video[0].ptsTime),a.hasAudio&&(a.audioStart=r.audio[0].ptsTime)),this.self.postMessage({action:"probeTs",result:a,data:e},[e.buffer])}clearAllMp4Captions(){this.captionParser&&this.captionParser.clearAllCaptions()}clearParsedMp4Captions(){this.captionParser&&this.captionParser.clearParsedCaptions()}push(e){const t=new Uint8Array(e.data,e.byteOffset,e.byteLength);this.transmuxer.push(t)}reset(){this.transmuxer.reset()}setTimestampOffset(e){const t=e.timestampOffset||0;this.transmuxer.setBaseMediaDecodeTime(Math.round(oe.secondsToVideoTs(t)))}setAudioAppendStart(e){this.transmuxer.setAudioAppendStart(Math.ceil(oe.secondsToVideoTs(e.appendStart)))}setRemux(e){this.transmuxer.setRemux(e.remux)}flush(e){this.transmuxer.flush(),self.postMessage({action:"done",type:"transmuxed"})}endTimeline(){this.transmuxer.endTimeline(),self.postMessage({action:"endedtimeline",type:"transmuxed"})}alignGopsWith(e){this.transmuxer.alignGopsWith(e.gopsToAlignWith.slice())}}self.onmessage=function(e){"init"===e.data.action&&e.data.options?this.messageHandlers=new Yn(self,e.data.options):(this.messageHandlers||(this.messageHandlers=new Yn(self)),e.data&&e.data.action&&"init"!==e.data.action&&this.messageHandlers[e.data.action]&&this.messageHandlers[e.data.action](e.data))}})));var TransmuxWorker=factory(workerCode$1);const handleData_=(e,t,n)=>{const{type:r,initSegment:a,captions:i,captionStreams:s,metadata:o,videoFrameDtsTime:l,videoFramePtsTime:u}=e.data.segment;t.buffer.push({captions:i,captionStreams:s,metadata:o});const c=e.data.segment.boxes||{data:e.data.segment.data},h={type:r,data:new Uint8Array(c.data,c.data.byteOffset,c.data.byteLength),initSegment:new Uint8Array(a.data,a.byteOffset,a.byteLength)};void 0!==l&&(h.videoFrameDtsTime=l),void 0!==u&&(h.videoFramePtsTime=u),n(h)},handleDone_=({transmuxedData:e,callback:t})=>{e.buffer=[],t(e)},handleGopInfo_=(e,t)=>{t.gopInfo=e.data.gopInfo},processTransmux=e=>{const{transmuxer:t,bytes:n,audioAppendStart:r,gopsToAlignWith:a,remux:i,onData:s,onTrackInfo:o,onAudioTimingInfo:l,onVideoTimingInfo:u,onVideoSegmentTimingInfo:c,onAudioSegmentTimingInfo:h,onId3:d,onCaptions:p,onDone:f,onEndedTimeline:m,onTransmuxerLog:g,isEndOfTimeline:y}=e,v={buffer:[]};let b=y;if(t.onmessage=n=>{t.currentTransmux===e&&("data"===n.data.action&&handleData_(n,v,s),"trackinfo"===n.data.action&&o(n.data.trackInfo),"gopInfo"===n.data.action&&handleGopInfo_(n,v),"audioTimingInfo"===n.data.action&&l(n.data.audioTimingInfo),"videoTimingInfo"===n.data.action&&u(n.data.videoTimingInfo),"videoSegmentTimingInfo"===n.data.action&&c(n.data.videoSegmentTimingInfo),"audioSegmentTimingInfo"===n.data.action&&h(n.data.audioSegmentTimingInfo),"id3Frame"===n.data.action&&d([n.data.id3Frame],n.data.id3Frame.dispatchType),"caption"===n.data.action&&p(n.data.caption),"endedtimeline"===n.data.action&&(b=!1,m()),"log"===n.data.action&&g(n.data.log),"transmuxed"===n.data.type&&(b||(t.onmessage=null,handleDone_({transmuxedData:v,callback:f}),dequeue(t))))},r&&t.postMessage({action:"setAudioAppendStart",appendStart:r}),Array.isArray(a)&&t.postMessage({action:"alignGopsWith",gopsToAlignWith:a}),void 0!==i&&t.postMessage({action:"setRemux",remux:i}),n.byteLength){const e=n instanceof ArrayBuffer?n:n.buffer,r=n instanceof ArrayBuffer?0:n.byteOffset;t.postMessage({action:"push",data:e,byteOffset:r,byteLength:n.byteLength},[e])}y&&t.postMessage({action:"endTimeline"}),t.postMessage({action:"flush"})},dequeue=e=>{e.currentTransmux=null,e.transmuxQueue.length&&(e.currentTransmux=e.transmuxQueue.shift(),"function"==typeof e.currentTransmux?e.currentTransmux():processTransmux(e.currentTransmux))},processAction=(e,t)=>{e.postMessage({action:t}),dequeue(e)},enqueueAction=(e,t)=>{if(!t.currentTransmux)return t.currentTransmux=e,void processAction(t,e);t.transmuxQueue.push(processAction.bind(null,t,e))},reset=e=>{enqueueAction("reset",e)},endTimeline=e=>{enqueueAction("endTimeline",e)},transmux=e=>{if(!e.transmuxer.currentTransmux)return e.transmuxer.currentTransmux=e,void processTransmux(e);e.transmuxer.transmuxQueue.push(e)},createTransmuxer=e=>{const t=new TransmuxWorker;t.currentTransmux=null,t.transmuxQueue=[];const n=t.terminate;return t.terminate=()=>(t.currentTransmux=null,t.transmuxQueue.length=0,n.call(t)),t.postMessage({action:"init",options:e}),t};var segmentTransmuxer={reset:reset,endTimeline:endTimeline,transmux:transmux,createTransmuxer:createTransmuxer};const workerCallback=function(e){const t=e.transmuxer,n=e.endAction||e.action,r=e.callback,a=_extends$2({},e,{endAction:null,transmuxer:null,callback:null}),i=a=>{a.data.action===n&&(t.removeEventListener("message",i),a.data.data&&(a.data.data=new Uint8Array(a.data.data,e.byteOffset||0,e.byteLength||a.data.data.byteLength),e.data&&(e.data=a.data.data)),r(a.data))};if(t.addEventListener("message",i),e.data){const n=e.data instanceof ArrayBuffer;a.byteOffset=n?0:e.data.byteOffset,a.byteLength=e.data.byteLength;const r=[n?e.data:e.data.buffer];t.postMessage(a,r)}else t.postMessage(a)},REQUEST_ERRORS={FAILURE:2,TIMEOUT:-101,ABORTED:-102},abortAll=e=>{e.forEach((e=>{e.abort()}))},getRequestStats=e=>({bandwidth:e.bandwidth,bytesReceived:e.bytesReceived||0,roundTripTime:e.roundTripTime||0}),getProgressStats=e=>{const t=e.target,n={bandwidth:1/0,bytesReceived:0,roundTripTime:Date.now()-t.requestTime||0};return n.bytesReceived=e.loaded,n.bandwidth=Math.floor(n.bytesReceived/n.roundTripTime*8*1e3),n},handleErrors=(e,t)=>t.timedout?{status:t.status,message:"HLS request timed-out at URL: "+t.uri,code:REQUEST_ERRORS.TIMEOUT,xhr:t}:t.aborted?{status:t.status,message:"HLS request aborted at URL: "+t.uri,code:REQUEST_ERRORS.ABORTED,xhr:t}:e?{status:t.status,message:"HLS request errored at URL: "+t.uri,code:REQUEST_ERRORS.FAILURE,xhr:t}:"arraybuffer"===t.responseType&&0===t.response.byteLength?{status:t.status,message:"Empty HLS response at URL: "+t.uri,code:REQUEST_ERRORS.FAILURE,xhr:t}:null,handleKeyResponse=(e,t,n)=>(r,a)=>{const i=a.response,s=handleErrors(r,a);if(s)return n(s,e);if(16!==i.byteLength)return n({status:a.status,message:"Invalid HLS key at URL: "+a.uri,code:REQUEST_ERRORS.FAILURE,xhr:a},e);const o=new DataView(i),l=new Uint32Array([o.getUint32(0),o.getUint32(4),o.getUint32(8),o.getUint32(12)]);for(let e=0;e<t.length;e++)t[e].bytes=l;return n(null,e)},parseInitSegment=(e,t)=>{const n=detectContainerForBytes(e.map.bytes);if("mp4"!==n){const r=e.map.resolvedUri||e.map.uri;return t({internal:!0,message:`Found unsupported ${n||"unknown"} container for initialization segment at URL: ${r}`,code:REQUEST_ERRORS.FAILURE})}workerCallback({action:"probeMp4Tracks",data:e.map.bytes,transmuxer:e.transmuxer,callback:({tracks:n,data:r})=>(e.map.bytes=r,n.forEach((function(t){e.map.tracks=e.map.tracks||{},e.map.tracks[t.type]||(e.map.tracks[t.type]=t,"number"==typeof t.id&&t.timescale&&(e.map.timescales=e.map.timescales||{},e.map.timescales[t.id]=t.timescale))})),t(null))})},handleInitSegmentResponse=({segment:e,finishProcessingFn:t})=>(n,r)=>{const a=handleErrors(n,r);if(a)return t(a,e);const i=new Uint8Array(r.response);if(e.map.key)return e.map.encryptedBytes=i,t(null,e);e.map.bytes=i,parseInitSegment(e,(function(n){if(n)return n.xhr=r,n.status=r.status,t(n,e);t(null,e)}))},handleSegmentResponse=({segment:e,finishProcessingFn:t,responseType:n})=>(r,a)=>{const i=handleErrors(r,a);if(i)return t(i,e);const s="arraybuffer"!==n&&a.responseText?stringToArrayBuffer(a.responseText.substring(e.lastReachedChar||0)):a.response;return e.stats=getRequestStats(a),e.key?e.encryptedBytes=new Uint8Array(s):e.bytes=new Uint8Array(s),t(null,e)},transmuxAndNotify=({segment:e,bytes:t,trackInfoFn:n,timingInfoFn:r,videoSegmentTimingInfoFn:a,audioSegmentTimingInfoFn:i,id3Fn:s,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:c,doneFn:h,onTransmuxerLog:d})=>{const p=e.map&&e.map.tracks||{},f=Boolean(p.audio&&p.video);let m=r.bind(null,e,"audio","start");const g=r.bind(null,e,"audio","end");let y=r.bind(null,e,"video","start");const v=r.bind(null,e,"video","end");workerCallback({action:"probeTs",transmuxer:e.transmuxer,data:t,baseStartTime:e.baseStartTime,callback:r=>{e.bytes=t=r.data;const p=r.result;p&&(n(e,{hasAudio:p.hasAudio,hasVideo:p.hasVideo,isMuxed:f}),n=null),transmux({bytes:t,transmuxer:e.transmuxer,audioAppendStart:e.audioAppendStart,gopsToAlignWith:e.gopsToAlignWith,remux:f,onData:t=>{t.type="combined"===t.type?"video":t.type,c(e,t)},onTrackInfo:t=>{n&&(f&&(t.isMuxed=!0),n(e,t))},onAudioTimingInfo:e=>{m&&void 0!==e.start&&(m(e.start),m=null),g&&void 0!==e.end&&g(e.end)},onVideoTimingInfo:e=>{y&&void 0!==e.start&&(y(e.start),y=null),v&&void 0!==e.end&&v(e.end)},onVideoSegmentTimingInfo:e=>{a(e)},onAudioSegmentTimingInfo:e=>{i(e)},onId3:(t,n)=>{s(e,t,n)},onCaptions:t=>{o(e,[t])},isEndOfTimeline:l,onEndedTimeline:()=>{u()},onTransmuxerLog:d,onDone:t=>{h&&(t.type="combined"===t.type?"video":t.type,h(null,e,t))}})}})},handleSegmentBytes=({segment:e,bytes:t,trackInfoFn:n,timingInfoFn:r,videoSegmentTimingInfoFn:a,audioSegmentTimingInfoFn:i,id3Fn:s,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:c,doneFn:h,onTransmuxerLog:d})=>{let p=new Uint8Array(t);if(isLikelyFmp4MediaSegment(p)){e.isFmp4=!0;const{tracks:a}=e.map,i={isFmp4:!0,hasVideo:!!a.video,hasAudio:!!a.audio};a.audio&&a.audio.codec&&"enca"!==a.audio.codec&&(i.audioCodec=a.audio.codec),a.video&&a.video.codec&&"encv"!==a.video.codec&&(i.videoCodec=a.video.codec),a.video&&a.audio&&(i.isMuxed=!0),n(e,i);const l=(t,n)=>{c(e,{data:p,type:i.hasAudio&&!i.isMuxed?"audio":"video"}),n&&n.length&&s(e,n),t&&t.length&&o(e,t),h(null,e,{})};workerCallback({action:"probeMp4StartTime",timescales:e.map.timescales,data:p,transmuxer:e.transmuxer,callback:({data:n,startTime:s})=>{t=n.buffer,e.bytes=p=n,i.hasAudio&&!i.isMuxed&&r(e,"audio","start",s),i.hasVideo&&r(e,"video","start",s),workerCallback({action:"probeEmsgID3",data:p,transmuxer:e.transmuxer,offset:s,callback:({emsgData:n,id3Frames:r})=>{t=n.buffer,e.bytes=p=n,a.video&&n.byteLength&&e.transmuxer?workerCallback({action:"pushMp4Captions",endAction:"mp4Captions",transmuxer:e.transmuxer,data:p,timescales:e.map.timescales,trackIds:[a.video.id],callback:n=>{t=n.data.buffer,e.bytes=p=n.data,n.logs.forEach((function(e){d(merge(e,{stream:"mp4CaptionParser"}))})),l(n.captions,r)}}):l(void 0,r)}})}})}else if(e.transmuxer){if(void 0===e.container&&(e.container=detectContainerForBytes(p)),"ts"!==e.container&&"aac"!==e.container)return n(e,{hasAudio:!1,hasVideo:!1}),void h(null,e,{});transmuxAndNotify({segment:e,bytes:t,trackInfoFn:n,timingInfoFn:r,videoSegmentTimingInfoFn:a,audioSegmentTimingInfoFn:i,id3Fn:s,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:c,doneFn:h,onTransmuxerLog:d})}else h(null,e,{})},decrypt=function({id:e,key:t,encryptedBytes:n,decryptionWorker:r},a){const i=t=>{if(t.data.source===e){r.removeEventListener("message",i);const e=t.data.decrypted;a(new Uint8Array(e.bytes,e.byteOffset,e.byteLength))}};let s;r.addEventListener("message",i),s=t.bytes.slice?t.bytes.slice():new Uint32Array(Array.prototype.slice.call(t.bytes)),r.postMessage(createTransferableMessage({source:e,encrypted:n,key:s,iv:t.iv}),[n.buffer,s.buffer])},decryptSegment=({decryptionWorker:e,segment:t,trackInfoFn:n,timingInfoFn:r,videoSegmentTimingInfoFn:a,audioSegmentTimingInfoFn:i,id3Fn:s,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:c,doneFn:h,onTransmuxerLog:d})=>{decrypt({id:t.requestId,key:t.key,encryptedBytes:t.encryptedBytes,decryptionWorker:e},(e=>{t.bytes=e,handleSegmentBytes({segment:t,bytes:t.bytes,trackInfoFn:n,timingInfoFn:r,videoSegmentTimingInfoFn:a,audioSegmentTimingInfoFn:i,id3Fn:s,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:c,doneFn:h,onTransmuxerLog:d})}))},waitForCompletion=({activeXhrs:e,decryptionWorker:t,trackInfoFn:n,timingInfoFn:r,videoSegmentTimingInfoFn:a,audioSegmentTimingInfoFn:i,id3Fn:s,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:c,doneFn:h,onTransmuxerLog:d})=>{let p=0,f=!1;return(m,g)=>{if(!f){if(m)return f=!0,abortAll(e),h(m,g);if(p+=1,p===e.length){const p=function(){if(g.encryptedBytes)return decryptSegment({decryptionWorker:t,segment:g,trackInfoFn:n,timingInfoFn:r,videoSegmentTimingInfoFn:a,audioSegmentTimingInfoFn:i,id3Fn:s,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:c,doneFn:h,onTransmuxerLog:d});handleSegmentBytes({segment:g,bytes:g.bytes,trackInfoFn:n,timingInfoFn:r,videoSegmentTimingInfoFn:a,audioSegmentTimingInfoFn:i,id3Fn:s,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:c,doneFn:h,onTransmuxerLog:d})};if(g.endOfAllRequests=Date.now(),g.map&&g.map.encryptedBytes&&!g.map.bytes)return decrypt({decryptionWorker:t,id:g.requestId+"-init",encryptedBytes:g.map.encryptedBytes,key:g.map.key},(t=>{g.map.bytes=t,parseInitSegment(g,(t=>{if(t)return abortAll(e),h(t,g);p()}))}));p()}}}},handleLoadEnd=({loadendState:e,abortFn:t})=>n=>{n.target.aborted&&t&&!e.calledAbortFn&&(t(),e.calledAbortFn=!0)},handleProgress=({segment:e,progressFn:t,trackInfoFn:n,timingInfoFn:r,videoSegmentTimingInfoFn:a,audioSegmentTimingInfoFn:i,id3Fn:s,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:c})=>n=>{if(!n.target.aborted)return e.stats=merge(e.stats,getProgressStats(n)),!e.stats.firstBytesReceivedAt&&e.stats.bytesReceived&&(e.stats.firstBytesReceivedAt=Date.now()),t(n,e)},mediaSegmentRequest=({xhr:e,xhrOptions:t,decryptionWorker:n,segment:r,abortFn:a,progressFn:i,trackInfoFn:s,timingInfoFn:o,videoSegmentTimingInfoFn:l,audioSegmentTimingInfoFn:u,id3Fn:c,captionsFn:h,isEndOfTimeline:d,endedTimelineFn:p,dataFn:f,doneFn:m,onTransmuxerLog:g})=>{const y=[],v=waitForCompletion({activeXhrs:y,decryptionWorker:n,trackInfoFn:s,timingInfoFn:o,videoSegmentTimingInfoFn:l,audioSegmentTimingInfoFn:u,id3Fn:c,captionsFn:h,isEndOfTimeline:d,endedTimelineFn:p,dataFn:f,doneFn:m,onTransmuxerLog:g});if(r.key&&!r.key.bytes){const n=[r.key];r.map&&!r.map.bytes&&r.map.key&&r.map.key.resolvedUri===r.key.resolvedUri&&n.push(r.map.key);const a=e(merge(t,{uri:r.key.resolvedUri,responseType:"arraybuffer"}),handleKeyResponse(r,n,v));y.push(a)}if(r.map&&!r.map.bytes){if(r.map.key&&(!r.key||r.key.resolvedUri!==r.map.key.resolvedUri)){const n=e(merge(t,{uri:r.map.key.resolvedUri,responseType:"arraybuffer"}),handleKeyResponse(r,[r.map.key],v));y.push(n)}const n=e(merge(t,{uri:r.map.resolvedUri,responseType:"arraybuffer",headers:segmentXhrHeaders(r.map)}),handleInitSegmentResponse({segment:r,finishProcessingFn:v}));y.push(n)}const b=merge(t,{uri:r.part&&r.part.resolvedUri||r.resolvedUri,responseType:"arraybuffer",headers:segmentXhrHeaders(r)}),x=e(b,handleSegmentResponse({segment:r,finishProcessingFn:v,responseType:b.responseType}));x.addEventListener("progress",handleProgress({segment:r,progressFn:i,trackInfoFn:s,timingInfoFn:o,videoSegmentTimingInfoFn:l,audioSegmentTimingInfoFn:u,id3Fn:c,captionsFn:h,isEndOfTimeline:d,endedTimelineFn:p,dataFn:f})),y.push(x);const T={};return y.forEach((e=>{e.addEventListener("loadend",handleLoadEnd({loadendState:T,abortFn:a}))})),()=>abortAll(y)},logFn$1=logger("CodecUtils"),getCodecs=function(e){const t=e.attributes||{};if(t.CODECS)return parseCodecs(t.CODECS)},isMaat=(e,t)=>{const n=t.attributes||{};return e&&e.mediaGroups&&e.mediaGroups.AUDIO&&n.AUDIO&&e.mediaGroups.AUDIO[n.AUDIO]},isMuxed=(e,t)=>{if(!isMaat(e,t))return!0;const n=t.attributes||{},r=e.mediaGroups.AUDIO[n.AUDIO];for(const a in r)if(!r[a].uri&&!r[a].playlists)return!0;return!1},unwrapCodecList=function(e){const t={};return e.forEach((({mediaType:e,type:n,details:r})=>{t[e]=t[e]||[],t[e].push(translateLegacyCodec(`${n}${r}`))})),Object.keys(t).forEach((function(e){if(t[e].length>1)return logFn$1(`multiple ${e} codecs found as attributes: ${t[e].join(", ")}. Setting playlist codecs to null so that we wait for mux.js to probe segments for real codecs.`),void(t[e]=null);t[e]=t[e][0]})),t},codecCount=function(e){let t=0;return e.audio&&t++,e.video&&t++,t},codecsForPlaylist=function(e,t){const n=t.attributes||{},r=unwrapCodecList(getCodecs(t)||[]);if(isMaat(e,t)&&!r.audio&&!isMuxed(e,t)){const t=unwrapCodecList(codecsFromDefault(e,n.AUDIO)||[]);t.audio&&(r.audio=t.audio)}return r},logFn=logger("PlaylistSelector"),representationToString=function(e){if(!e||!e.playlist)return;const t=e.playlist;return JSON.stringify({id:t.id,bandwidth:e.bandwidth,width:e.width,height:e.height,codecs:t.attributes&&t.attributes.CODECS||""})},safeGetComputedStyle=function(e,t){if(!e)return"";const n=window$1$1.getComputedStyle(e);return n?n[t]:""},stableSort=function(e,t){const n=e.slice();e.sort((function(e,r){const a=t(e,r);return 0===a?n.indexOf(e)-n.indexOf(r):a}))},comparePlaylistBandwidth=function(e,t){let n,r;return e.attributes.BANDWIDTH&&(n=e.attributes.BANDWIDTH),n=n||window$1$1.Number.MAX_VALUE,t.attributes.BANDWIDTH&&(r=t.attributes.BANDWIDTH),r=r||window$1$1.Number.MAX_VALUE,n-r},comparePlaylistResolution=function(e,t){let n,r;return e.attributes.RESOLUTION&&e.attributes.RESOLUTION.width&&(n=e.attributes.RESOLUTION.width),n=n||window$1$1.Number.MAX_VALUE,t.attributes.RESOLUTION&&t.attributes.RESOLUTION.width&&(r=t.attributes.RESOLUTION.width),r=r||window$1$1.Number.MAX_VALUE,n===r&&e.attributes.BANDWIDTH&&t.attributes.BANDWIDTH?e.attributes.BANDWIDTH-t.attributes.BANDWIDTH:n-r};let simpleSelector=function(e,t,n,r,a,i){if(!e)return;const s={bandwidth:t,width:n,height:r,limitRenditionByPlayerDimensions:a};let o=e.playlists;Playlist.isAudioOnly(e)&&(o=i.getAudioTrackPlaylists_(),s.audioOnly=!0);let l=o.map((e=>{let t;const n=e.attributes&&e.attributes.RESOLUTION&&e.attributes.RESOLUTION.width,r=e.attributes&&e.attributes.RESOLUTION&&e.attributes.RESOLUTION.height;return t=e.attributes&&e.attributes.BANDWIDTH,t=t||window$1$1.Number.MAX_VALUE,{bandwidth:t,width:n,height:r,playlist:e}}));stableSort(l,((e,t)=>e.bandwidth-t.bandwidth)),l=l.filter((e=>!Playlist.isIncompatible(e.playlist)));let u=l.filter((e=>Playlist.isEnabled(e.playlist)));u.length||(u=l.filter((e=>!Playlist.isDisabled(e.playlist))));const c=u.filter((e=>e.bandwidth*Config.BANDWIDTH_VARIANCE<t));let h=c[c.length-1];const d=c.filter((e=>e.bandwidth===h.bandwidth))[0];if(!1===a){const e=d||u[0]||l[0];if(e&&e.playlist){let t="sortedPlaylistReps";return d&&(t="bandwidthBestRep"),u[0]&&(t="enabledPlaylistReps"),logFn(`choosing ${representationToString(e)} using ${t} with options`,s),e.playlist}return logFn("could not choose a playlist with options",s),null}const p=c.filter((e=>e.width&&e.height));stableSort(p,((e,t)=>e.width-t.width));const f=p.filter((e=>e.width===n&&e.height===r));h=f[f.length-1];const m=f.filter((e=>e.bandwidth===h.bandwidth))[0];let g,y,v,b;if(m||(g=p.filter((e=>e.width>n||e.height>r)),y=g.filter((e=>e.width===g[0].width&&e.height===g[0].height)),h=y[y.length-1],v=y.filter((e=>e.bandwidth===h.bandwidth))[0]),i.leastPixelDiffSelector){const e=p.map((e=>(e.pixelDiff=Math.abs(e.width-n)+Math.abs(e.height-r),e)));stableSort(e,((e,t)=>e.pixelDiff===t.pixelDiff?t.bandwidth-e.bandwidth:e.pixelDiff-t.pixelDiff)),b=e[0]}const x=b||v||m||d||u[0]||l[0];if(x&&x.playlist){let e="sortedPlaylistReps";return b?e="leastPixelDiffRep":v?e="resolutionPlusOneRep":m?e="resolutionBestRep":d?e="bandwidthBestRep":u[0]&&(e="enabledPlaylistReps"),logFn(`choosing ${representationToString(x)} using ${e} with options`,s),x.playlist}return logFn("could not choose a playlist with options",s),null};const lastBandwidthSelector=function(){const e=this.useDevicePixelRatio&&window$1$1.devicePixelRatio||1;return simpleSelector(this.playlists.main,this.systemBandwidth,parseInt(safeGetComputedStyle(this.tech_.el(),"width"),10)*e,parseInt(safeGetComputedStyle(this.tech_.el(),"height"),10)*e,this.limitRenditionByPlayerDimensions,this.playlistController_)},movingAverageBandwidthSelector=function(e){let t=-1,n=-1;if(e<0||e>1)throw new Error("Moving average bandwidth decay must be between 0 and 1.");return function(){const r=this.useDevicePixelRatio&&window$1$1.devicePixelRatio||1;return t<0&&(t=this.systemBandwidth,n=this.systemBandwidth),this.systemBandwidth>0&&this.systemBandwidth!==n&&(t=e*this.systemBandwidth+(1-e)*t,n=this.systemBandwidth),simpleSelector(this.playlists.main,t,parseInt(safeGetComputedStyle(this.tech_.el(),"width"),10)*r,parseInt(safeGetComputedStyle(this.tech_.el(),"height"),10)*r,this.limitRenditionByPlayerDimensions,this.playlistController_)}},minRebufferMaxBandwidthSelector=function(e){const{main:t,currentTime:n,bandwidth:r,duration:a,segmentDuration:i,timeUntilRebuffer:s,currentTimeline:o,syncController:l}=e,u=t.playlists.filter((e=>!Playlist.isIncompatible(e)));let c=u.filter(Playlist.isEnabled);c.length||(c=u.filter((e=>!Playlist.isDisabled(e))));const h=c.filter(Playlist.hasAttribute.bind(null,"BANDWIDTH")).map((e=>{const t=l.getSyncPoint(e,a,o,n)?1:2;return{playlist:e,rebufferingImpact:Playlist.estimateSegmentRequestTime(i,r,e)*t-s}})),d=h.filter((e=>e.rebufferingImpact<=0));return stableSort(d,((e,t)=>comparePlaylistBandwidth(t.playlist,e.playlist))),d.length?d[0]:(stableSort(h,((e,t)=>e.rebufferingImpact-t.rebufferingImpact)),h[0]||null)},lowestBitrateCompatibleVariantSelector=function(){const e=this.playlists.main.playlists.filter(Playlist.isEnabled);stableSort(e,((e,t)=>comparePlaylistBandwidth(e,t)));return e.filter((e=>!!codecsForPlaylist(this.playlists.main,e).video))[0]||null},concatSegments=e=>{let t,n=0;return e.bytes&&(t=new Uint8Array(e.bytes),e.segments.forEach((e=>{t.set(e,n),n+=e.byteLength}))),t},createCaptionsTrackIfNotExists=function(e,t,n){if(!e[n]){t.trigger({type:"usage",name:"vhs-608"});let r=n;/^cc708_/.test(n)&&(r="SERVICE"+n.split("_")[1]);const a=t.textTracks().getTrackById(r);if(a)e[n]=a;else{let a=n,i=n,s=!1;const o=(t.options_.vhs&&t.options_.vhs.captionServices||{})[r];o&&(a=o.label,i=o.language,s=o.default),e[n]=t.addRemoteTextTrack({kind:"captions",id:r,default:s,label:a,language:i},!1).track}}},addCaptionData=function({inbandTextTracks:e,captionArray:t,timestampOffset:n}){if(!t)return;const r=window$1$1.WebKitDataCue||window$1$1.VTTCue;t.forEach((t=>{const a=t.stream;t.content?t.content.forEach((i=>{const s=new r(t.startTime+n,t.endTime+n,i.text);s.line=i.line,s.align="left",s.position=i.position,s.positionAlign="line-left",e[a].addCue(s)})):e[a].addCue(new r(t.startTime+n,t.endTime+n,t.text))}))},deprecateOldCue=function(e){Object.defineProperties(e.frame,{id:{get:()=>(videojs.log.warn("cue.frame.id is deprecated. Use cue.value.key instead."),e.value.key)},value:{get:()=>(videojs.log.warn("cue.frame.value is deprecated. Use cue.value.data instead."),e.value.data)},privateData:{get:()=>(videojs.log.warn("cue.frame.privateData is deprecated. Use cue.value.data instead."),e.value.data)}})},addMetadata=({inbandTextTracks:e,metadataArray:t,timestampOffset:n,videoDuration:r})=>{if(!t)return;const a=window$1$1.WebKitDataCue||window$1$1.VTTCue,i=e.metadataTrack_;if(!i)return;if(t.forEach((e=>{const t=e.cueTime+n;!("number"!=typeof t||window$1$1.isNaN(t)||t<0)&&t<1/0&&e.frames&&e.frames.length&&e.frames.forEach((e=>{const n=new a(t,t,e.value||e.url||e.data||"");n.frame=e,n.value=e,deprecateOldCue(n),i.addCue(n)}))})),!i.cues||!i.cues.length)return;const s=i.cues,o=[];for(let c=0;c<s.length;c++)s[c]&&o.push(s[c]);const l=o.reduce(((e,t)=>{const n=e[t.startTime]||[];return n.push(t),e[t.startTime]=n,e}),{}),u=Object.keys(l).sort(((e,t)=>Number(e)-Number(t)));u.forEach(((e,t)=>{const n=l[e],a=isFinite(r)?r:e,i=Number(u[t+1])||a;n.forEach((e=>{e.endTime=i}))}))},dateRangeAttr={id:"ID",class:"CLASS",startDate:"START-DATE",duration:"DURATION",endDate:"END-DATE",endOnNext:"END-ON-NEXT",plannedDuration:"PLANNED-DURATION",scte35Out:"SCTE35-OUT",scte35In:"SCTE35-IN"},dateRangeKeysToOmit=new Set(["id","class","startDate","duration","endDate","endOnNext","startTime","endTime","processDateRange"]),addDateRangeMetadata=({inbandTextTracks:e,dateRanges:t})=>{const n=e.metadataTrack_;if(!n)return;const r=window$1$1.WebKitDataCue||window$1$1.VTTCue;t.forEach((e=>{for(const t of Object.keys(e)){if(dateRangeKeysToOmit.has(t))continue;const a=new r(e.startTime,e.endTime,"");a.id=e.id,a.type="com.apple.quicktime.HLS",a.value={key:dateRangeAttr[t],data:e[t]},"scte35Out"!==t&&"scte35In"!==t||(a.value.data=new Uint8Array(a.value.data.match(/[\da-f]{2}/gi)).buffer),n.addCue(a)}e.processDateRange()}))},createMetadataTrackIfNotExists=(e,t,n)=>{e.metadataTrack_||(e.metadataTrack_=n.addRemoteTextTrack({kind:"metadata",label:"Timed Metadata"},!1).track,videojs.browser.IS_ANY_SAFARI||(e.metadataTrack_.inBandMetadataTrackDispatchType=t))},removeCuesFromTrack=function(e,t,n){let r,a;if(n&&n.cues)for(r=n.cues.length;r--;)a=n.cues[r],a.startTime>=e&&a.endTime<=t&&n.removeCue(a)},removeDuplicateCuesFromTrack=function(e){const t=e.cues;if(!t)return;const n={};for(let r=t.length-1;r>=0;r--){const a=t[r],i=`${a.startTime}-${a.endTime}-${a.text}`;n[i]?e.removeCue(a):n[i]=a}},gopsSafeToAlignWith=(e,t,n)=>{if(null==t||!e.length)return[];const r=Math.ceil((t-n+3)*clock.ONE_SECOND_IN_TS);let a;for(a=0;a<e.length&&!(e[a].pts>r);a++);return e.slice(a)},updateGopBuffer=(e,t,n)=>{if(!t.length)return e;if(n)return t.slice();const r=t[0].pts;let a=0;for(;a<e.length&&!(e[a].pts>=r);a++);return e.slice(0,a).concat(t)},removeGopBuffer=(e,t,n,r)=>{const a=Math.ceil((t-r)*clock.ONE_SECOND_IN_TS),i=Math.ceil((n-r)*clock.ONE_SECOND_IN_TS),s=e.slice();let o=e.length;for(;o--&&!(e[o].pts<=i););if(-1===o)return s;let l=o+1;for(;l--&&!(e[l].pts<=a););return l=Math.max(l,0),s.splice(l,o-l+1),s},shallowEqual=function(e,t){if(!e&&!t||!e&&t||e&&!t)return!1;if(e===t)return!0;const n=Object.keys(e).sort(),r=Object.keys(t).sort();if(n.length!==r.length)return!1;for(let a=0;a<n.length;a++){const i=n[a];if(i!==r[a])return!1;if(e[i]!==t[i])return!1}return!0},QUOTA_EXCEEDED_ERR=22,getSyncSegmentCandidate=function(e,t,n){t=t||[];const r=[];let a=0;for(let i=0;i<t.length;i++){const s=t[i];if(e===s.timeline&&(r.push(i),a+=s.duration,a>n))return i}return 0===r.length?0:r[r.length-1]},MIN_BACK_BUFFER=1,CHECK_BUFFER_DELAY=500,finite=e=>"number"==typeof e&&isFinite(e),MIN_SEGMENT_DURATION_TO_SAVE_STATS=1/60,illegalMediaSwitch=(e,t,n)=>"main"===e&&t&&n?n.hasAudio||n.hasVideo?t.hasVideo&&!n.hasVideo?"Only audio found in segment when we expected video. We can't switch to audio only from a stream that had video. To get rid of this message, please add codec information to the manifest.":!t.hasVideo&&n.hasVideo?"Video found in segment when we expected only audio. We can't switch to a stream with video from an audio only stream. To get rid of this message, please add codec information to the manifest.":null:"Neither audio nor video found in segment.":null,safeBackBufferTrimTime=(e,t,n)=>{let r=t-Config.BACK_BUFFER_LENGTH;e.length&&(r=Math.max(r,e.start(0)));const a=t-n;return Math.min(a,r)},segmentInfoString=e=>{const{startOfSegment:t,duration:n,segment:r,part:a,playlist:{mediaSequence:i,id:s,segments:o=[]},mediaIndex:l,partIndex:u,timeline:c}=e,h=o.length-1;let d="mediaIndex/partIndex increment";e.getMediaInfoForTime?d=`getMediaInfoForTime (${e.getMediaInfoForTime})`:e.isSyncRequest&&(d="getSyncSegmentCandidate (isSyncRequest)"),e.independent&&(d+=` with independent ${e.independent}`);const p="number"==typeof u,f=e.segment.uri?"segment":"pre-segment",m=p?getKnownPartCount({preloadSegment:r})-1:0;return`${f} [${i+l}/${i+h}]`+(p?` part [${u}/${m}]`:"")+` segment start/end [${r.start} => ${r.end}]`+(p?` part start/end [${a.start} => ${a.end}]`:"")+` startOfSegment [${t}] duration [${n}] timeline [${c}] selected by [${d}] playlist [${s}]`},timingInfoPropertyForMedia=e=>`${e}TimingInfo`,timestampOffsetForSegment=({segmentTimeline:e,currentTimeline:t,startOfSegment:n,buffered:r,overrideCheck:a})=>a||e!==t?e<t?n:r.length?r.end(r.length-1):n:null,shouldWaitForTimelineChange=({timelineChangeController:e,currentTimeline:t,segmentTimeline:n,loaderType:r,audioDisabled:a})=>{if(t===n)return!1;if("audio"===r){const t=e.lastTimelineChange({type:"main"});return!t||t.to!==n}if("main"===r&&a){const t=e.pendingTimelineChange({type:"audio"});return!t||t.to!==n}return!1},mediaDuration=e=>{let t=0;return["video","audio"].forEach((function(n){const r=e[`${n}TimingInfo`];if(!r)return;const{start:a,end:i}=r;let s;"bigint"==typeof a||"bigint"==typeof i?s=window$1$1.BigInt(i)-window$1$1.BigInt(a):"number"==typeof a&&"number"==typeof i&&(s=i-a),void 0!==s&&s>t&&(t=s)})),"bigint"==typeof t&&t<Number.MAX_SAFE_INTEGER&&(t=Number(t)),t},segmentTooLong=({segmentDuration:e,maxDuration:t})=>!!e&&Math.round(e)>t+TIME_FUDGE_FACTOR,getTroublesomeSegmentDurationMessage=(e,t)=>{if("hls"!==t)return null;const n=mediaDuration({audioTimingInfo:e.audioTimingInfo,videoTimingInfo:e.videoTimingInfo});if(!n)return null;const r=e.playlist.targetDuration,a=segmentTooLong({segmentDuration:n,maxDuration:2*r}),i=segmentTooLong({segmentDuration:n,maxDuration:r}),s=`Segment with index ${e.mediaIndex} from playlist ${e.playlist.id} has a duration of ${n} when the reported duration is ${e.duration} and the target duration is ${r}. For HLS content, a duration in excess of the target duration may result in playback issues. See the HLS specification section on EXT-X-TARGETDURATION for more details: https://tools.ietf.org/html/draft-pantos-http-live-streaming-23#section-4.3.3.1`;return a||i?{severity:a?"warn":"info",message:s}:null};class SegmentLoader extends videojs.EventTarget{constructor(e,t={}){if(super(),!e)throw new TypeError("Initialization settings are required");if("function"!=typeof e.currentTime)throw new TypeError("No currentTime getter specified");if(!e.mediaSource)throw new TypeError("No MediaSource specified");this.bandwidth=e.bandwidth,this.throughput={rate:0,count:0},this.roundTrip=NaN,this.resetStats_(),this.mediaIndex=null,this.partIndex=null,this.hasPlayed_=e.hasPlayed,this.currentTime_=e.currentTime,this.seekable_=e.seekable,this.seeking_=e.seeking,this.duration_=e.duration,this.mediaSource_=e.mediaSource,this.vhs_=e.vhs,this.loaderType_=e.loaderType,this.currentMediaInfo_=void 0,this.startingMediaInfo_=void 0,this.segmentMetadataTrack_=e.segmentMetadataTrack,this.goalBufferLength_=e.goalBufferLength,this.sourceType_=e.sourceType,this.sourceUpdater_=e.sourceUpdater,this.inbandTextTracks_=e.inbandTextTracks,this.state_="INIT",this.timelineChangeController_=e.timelineChangeController,this.shouldSaveSegmentTimingInfo_=!0,this.parse708captions_=e.parse708captions,this.useDtsForTimestampOffset_=e.useDtsForTimestampOffset,this.captionServices_=e.captionServices,this.exactManifestTimings=e.exactManifestTimings,this.addMetadataToTextTrack=e.addMetadataToTextTrack,this.checkBufferTimeout_=null,this.error_=void 0,this.currentTimeline_=-1,this.shouldForceTimestampOffsetAfterResync_=!1,this.pendingSegment_=null,this.xhrOptions_=null,this.pendingSegments_=[],this.audioDisabled_=!1,this.isPendingTimestampOffset_=!1,this.gopBuffer_=[],this.timeMapping_=0,this.safeAppend_=!1,this.appendInitSegment_={audio:!0,video:!0},this.playlistOfLastInitSegment_={audio:null,video:null},this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_={id3:[],caption:[]},this.waitingOnRemove_=!1,this.quotaExceededErrorRetryTimeout_=null,this.activeInitSegmentId_=null,this.initSegments_={},this.cacheEncryptionKeys_=e.cacheEncryptionKeys,this.keyCache_={},this.decrypter_=e.decrypter,this.syncController_=e.syncController,this.syncPoint_={segmentIndex:0,time:0},this.transmuxer_=this.createTransmuxer_(),this.triggerSyncInfoUpdate_=()=>this.trigger("syncinfoupdate"),this.syncController_.on("syncinfoupdate",this.triggerSyncInfoUpdate_),this.mediaSource_.addEventListener("sourceopen",(()=>{this.isEndOfStream_()||(this.ended_=!1)})),this.fetchAtBuffer_=!1,this.logger_=logger(`SegmentLoader[${this.loaderType_}]`),Object.defineProperty(this,"state",{get(){return this.state_},set(e){e!==this.state_&&(this.logger_(`${this.state_} -> ${e}`),this.state_=e,this.trigger("statechange"))}}),this.sourceUpdater_.on("ready",(()=>{this.hasEnoughInfoToAppend_()&&this.processCallQueue_()})),"main"===this.loaderType_&&this.timelineChangeController_.on("pendingtimelinechange",(()=>{this.hasEnoughInfoToAppend_()&&this.processCallQueue_()})),"audio"===this.loaderType_&&this.timelineChangeController_.on("timelinechange",(()=>{this.hasEnoughInfoToLoad_()&&this.processLoadQueue_(),this.hasEnoughInfoToAppend_()&&this.processCallQueue_()}))}createTransmuxer_(){return segmentTransmuxer.createTransmuxer({remux:!1,alignGopsAtEnd:this.safeAppend_,keepOriginalTimestamps:!0,parse708captions:this.parse708captions_,captionServices:this.captionServices_})}resetStats_(){this.mediaBytesTransferred=0,this.mediaRequests=0,this.mediaRequestsAborted=0,this.mediaRequestsTimedout=0,this.mediaRequestsErrored=0,this.mediaTransferDuration=0,this.mediaSecondsLoaded=0,this.mediaAppends=0}dispose(){this.trigger("dispose"),this.state="DISPOSED",this.pause(),this.abort_(),this.transmuxer_&&this.transmuxer_.terminate(),this.resetStats_(),this.checkBufferTimeout_&&window$1$1.clearTimeout(this.checkBufferTimeout_),this.syncController_&&this.triggerSyncInfoUpdate_&&this.syncController_.off("syncinfoupdate",this.triggerSyncInfoUpdate_),this.off()}setAudio(e){this.audioDisabled_=!e,e?this.appendInitSegment_.audio=!0:this.sourceUpdater_.removeAudio(0,this.duration_())}abort(){"WAITING"===this.state?(this.abort_(),this.state="READY",this.paused()||this.monitorBuffer_()):this.pendingSegment_&&(this.pendingSegment_=null)}abort_(){this.pendingSegment_&&this.pendingSegment_.abortRequests&&this.pendingSegment_.abortRequests(),this.pendingSegment_=null,this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_.id3=[],this.metadataQueue_.caption=[],this.timelineChangeController_.clearPendingTimelineChange(this.loaderType_),this.waitingOnRemove_=!1,window$1$1.clearTimeout(this.quotaExceededErrorRetryTimeout_),this.quotaExceededErrorRetryTimeout_=null}checkForAbort_(e){return"APPENDING"!==this.state||this.pendingSegment_?!this.pendingSegment_||this.pendingSegment_.requestId!==e:(this.state="READY",!0)}error(e){return void 0!==e&&(this.logger_("error occurred:",e),this.error_=e),this.pendingSegment_=null,this.error_}endOfStream(){this.ended_=!0,this.transmuxer_&&segmentTransmuxer.reset(this.transmuxer_),this.gopBuffer_.length=0,this.pause(),this.trigger("ended")}buffered_(){const e=this.getMediaInfo_();if(!this.sourceUpdater_||!e)return createTimeRanges();if("main"===this.loaderType_){const{hasAudio:t,hasVideo:n,isMuxed:r}=e;if(n&&t&&!this.audioDisabled_&&!r)return this.sourceUpdater_.buffered();if(n)return this.sourceUpdater_.videoBuffered()}return this.sourceUpdater_.audioBuffered()}initSegmentForMap(e,t=!1){if(!e)return null;const n=initSegmentId(e);let r=this.initSegments_[n];return t&&!r&&e.bytes&&(this.initSegments_[n]=r={resolvedUri:e.resolvedUri,byterange:e.byterange,bytes:e.bytes,tracks:e.tracks,timescales:e.timescales}),r||e}segmentKey(e,t=!1){if(!e)return null;const n=segmentKeyId(e);let r=this.keyCache_[n];this.cacheEncryptionKeys_&&t&&!r&&e.bytes&&(this.keyCache_[n]=r={resolvedUri:e.resolvedUri,bytes:e.bytes});const a={resolvedUri:(r||e).resolvedUri};return r&&(a.bytes=r.bytes),a}couldBeginLoading_(){return this.playlist_&&!this.paused()}load(){if(this.monitorBuffer_(),this.playlist_)return"INIT"===this.state&&this.couldBeginLoading_()?this.init_():void(!this.couldBeginLoading_()||"READY"!==this.state&&"INIT"!==this.state||(this.state="READY"))}init_(){return this.state="READY",this.resetEverything(),this.monitorBuffer_()}playlist(e,t={}){if(!e)return;const n=this.playlist_,r=this.pendingSegment_;this.playlist_=e,this.xhrOptions_=t,"INIT"===this.state&&(e.syncInfo={mediaSequence:e.mediaSequence,time:0},"main"===this.loaderType_&&this.syncController_.setDateTimeMappingForStart(e));let a=null;if(n&&(n.id?a=n.id:n.uri&&(a=n.uri)),this.logger_(`playlist update [${a} => ${e.id||e.uri}]`),this.syncController_.updateMediaSequenceMap(e,this.currentTime_(),this.loaderType_),this.trigger("syncinfoupdate"),"INIT"===this.state&&this.couldBeginLoading_())return this.init_();if(!n||n.uri!==e.uri){if(null!==this.mediaIndex){!e.endList&&"number"==typeof e.partTargetDuration?this.resetLoader():this.resyncLoader()}return this.currentMediaInfo_=void 0,void this.trigger("playlistupdate")}const i=e.mediaSequence-n.mediaSequence;if(this.logger_(`live window shift [${i}]`),null!==this.mediaIndex)if(this.mediaIndex-=i,this.mediaIndex<0)this.mediaIndex=null,this.partIndex=null;else{const e=this.playlist_.segments[this.mediaIndex];if(this.partIndex&&(!e.parts||!e.parts.length||!e.parts[this.partIndex])){const e=this.mediaIndex;this.logger_(`currently processing part (index ${this.partIndex}) no longer exists.`),this.resetLoader(),this.mediaIndex=e}}r&&(r.mediaIndex-=i,r.mediaIndex<0?(r.mediaIndex=null,r.partIndex=null):(r.mediaIndex>=0&&(r.segment=e.segments[r.mediaIndex]),r.partIndex>=0&&r.segment.parts&&(r.part=r.segment.parts[r.partIndex]))),this.syncController_.saveExpiredSegmentInfo(n,e)}pause(){this.checkBufferTimeout_&&(window$1$1.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=null)}paused(){return null===this.checkBufferTimeout_}resetEverything(e){this.ended_=!1,this.activeInitSegmentId_=null,this.appendInitSegment_={audio:!0,video:!0},this.resetLoader(),this.remove(0,1/0,e),this.transmuxer_&&(this.transmuxer_.postMessage({action:"clearAllMp4Captions"}),this.transmuxer_.postMessage({action:"reset"}))}resetLoader(){this.fetchAtBuffer_=!1,this.resyncLoader()}resyncLoader(){this.transmuxer_&&segmentTransmuxer.reset(this.transmuxer_),this.mediaIndex=null,this.partIndex=null,this.syncPoint_=null,this.isPendingTimestampOffset_=!1,this.shouldForceTimestampOffsetAfterResync_=!0,this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_.id3=[],this.metadataQueue_.caption=[],this.abort(),this.transmuxer_&&this.transmuxer_.postMessage({action:"clearParsedMp4Captions"})}remove(e,t,n=(()=>{}),r=!1){if(t===1/0&&(t=this.duration_()),t<=e)return void this.logger_("skipping remove because end ${end} is <= start ${start}");if(!this.sourceUpdater_||!this.getMediaInfo_())return void this.logger_("skipping remove because no source updater or starting media info");let a=1;const i=()=>{a--,0===a&&n()};!r&&this.audioDisabled_||(a++,this.sourceUpdater_.removeAudio(e,t,i)),(r||"main"===this.loaderType_)&&(this.gopBuffer_=removeGopBuffer(this.gopBuffer_,e,t,this.timeMapping_),a++,this.sourceUpdater_.removeVideo(e,t,i));for(const s in this.inbandTextTracks_)removeCuesFromTrack(e,t,this.inbandTextTracks_[s]);removeCuesFromTrack(e,t,this.segmentMetadataTrack_),i()}monitorBuffer_(){this.checkBufferTimeout_&&window$1$1.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=window$1$1.setTimeout(this.monitorBufferTick_.bind(this),1)}monitorBufferTick_(){"READY"===this.state&&this.fillBuffer_(),this.checkBufferTimeout_&&window$1$1.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=window$1$1.setTimeout(this.monitorBufferTick_.bind(this),CHECK_BUFFER_DELAY)}fillBuffer_(){if(this.sourceUpdater_.updating())return;const e=this.chooseNextRequest_();e&&("number"==typeof e.timestampOffset&&(this.isPendingTimestampOffset_=!1,this.timelineChangeController_.pendingTimelineChange({type:this.loaderType_,from:this.currentTimeline_,to:e.timeline})),this.loadSegment_(e))}isEndOfStream_(e=this.mediaIndex,t=this.playlist_,n=this.partIndex){if(!t||!this.mediaSource_)return!1;const r="number"==typeof e&&t.segments[e],a=e+1===t.segments.length,i=!r||!r.parts||n+1===r.parts.length;return t.endList&&"open"===this.mediaSource_.readyState&&a&&i}chooseNextRequest_(){const e=this.buffered_(),t=lastBufferedEnd(e)||0,n=timeAheadOf(e,this.currentTime_()),r=!this.hasPlayed_()&&n>=1,a=n>=this.goalBufferLength_(),i=this.playlist_.segments;if(!i.length||r||a)return null;this.syncPoint_=this.syncPoint_||this.syncController_.getSyncPoint(this.playlist_,this.duration_(),this.currentTimeline_,this.currentTime_(),this.loaderType_);const s={partIndex:null,mediaIndex:null,startOfSegment:null,playlist:this.playlist_,isSyncRequest:Boolean(!this.syncPoint_)};if(s.isSyncRequest)s.mediaIndex=getSyncSegmentCandidate(this.currentTimeline_,i,t),this.logger_(`choose next request. Can not find sync point. Fallback to media Index: ${s.mediaIndex}`);else if(null!==this.mediaIndex){const e=i[this.mediaIndex],n="number"==typeof this.partIndex?this.partIndex:-1;s.startOfSegment=e.end?e.end:t,e.parts&&e.parts[n+1]?(s.mediaIndex=this.mediaIndex,s.partIndex=n+1):s.mediaIndex=this.mediaIndex+1}else{const{segmentIndex:e,startTime:n,partIndex:r}=Playlist.getMediaInfoForTime({exactManifestTimings:this.exactManifestTimings,playlist:this.playlist_,currentTime:this.fetchAtBuffer_?t:this.currentTime_(),startingPartIndex:this.syncPoint_.partIndex,startingSegmentIndex:this.syncPoint_.segmentIndex,startTime:this.syncPoint_.time});s.getMediaInfoForTime=this.fetchAtBuffer_?`bufferedEnd ${t}`:`currentTime ${this.currentTime_()}`,s.mediaIndex=e,s.startOfSegment=n,s.partIndex=r,this.logger_(`choose next request. Playlist switched and we have a sync point. Media Index: ${s.mediaIndex} `)}const o=i[s.mediaIndex];let l=o&&"number"==typeof s.partIndex&&o.parts&&o.parts[s.partIndex];if(!o||"number"==typeof s.partIndex&&!l)return null;"number"!=typeof s.partIndex&&o.parts&&(s.partIndex=0,l=o.parts[0]);const u=this.vhs_.playlists&&this.vhs_.playlists.main&&this.vhs_.playlists.main.independentSegments||this.playlist_.independentSegments;if(!n&&l&&!u&&!l.independent)if(0===s.partIndex){const e=i[s.mediaIndex-1],t=e.parts&&e.parts.length&&e.parts[e.parts.length-1];t&&t.independent&&(s.mediaIndex-=1,s.partIndex=e.parts.length-1,s.independent="previous segment")}else o.parts[s.partIndex-1].independent&&(s.partIndex-=1,s.independent="previous part");const c=this.mediaSource_&&"ended"===this.mediaSource_.readyState;return s.mediaIndex>=i.length-1&&c&&!this.seeking_()?null:(this.shouldForceTimestampOffsetAfterResync_&&(this.shouldForceTimestampOffsetAfterResync_=!1,s.forceTimestampOffset=!0,this.logger_("choose next request. Force timestamp offset after loader resync")),this.generateSegmentInfo_(s))}generateSegmentInfo_(e){const{independent:t,playlist:n,mediaIndex:r,startOfSegment:a,isSyncRequest:i,partIndex:s,forceTimestampOffset:o,getMediaInfoForTime:l}=e,u=n.segments[r],c="number"==typeof s&&u.parts[s],h={requestId:"segment-loader-"+Math.random(),uri:c&&c.resolvedUri||u.resolvedUri,mediaIndex:r,partIndex:c?s:null,isSyncRequest:i,startOfSegment:a,playlist:n,bytes:null,encryptedBytes:null,timestampOffset:null,timeline:u.timeline,duration:c&&c.duration||u.duration,segment:u,part:c,byteLength:0,transmuxer:this.transmuxer_,getMediaInfoForTime:l,independent:t},d=void 0!==o?o:this.isPendingTimestampOffset_;h.timestampOffset=this.timestampOffsetForSegment_({segmentTimeline:u.timeline,currentTimeline:this.currentTimeline_,startOfSegment:a,buffered:this.buffered_(),overrideCheck:d});const p=lastBufferedEnd(this.sourceUpdater_.audioBuffered());return"number"==typeof p&&(h.audioAppendStart=p-this.sourceUpdater_.audioTimestampOffset()),this.sourceUpdater_.videoBuffered().length&&(h.gopsToAlignWith=gopsSafeToAlignWith(this.gopBuffer_,this.currentTime_()-this.sourceUpdater_.videoTimestampOffset(),this.timeMapping_)),h}timestampOffsetForSegment_(e){return timestampOffsetForSegment(e)}earlyAbortWhenNeeded_(e){if(this.vhs_.tech_.paused()||!this.xhrOptions_.timeout||!this.playlist_.attributes.BANDWIDTH)return;if(Date.now()-(e.firstBytesReceivedAt||Date.now())<1e3)return;const t=this.currentTime_(),n=e.bandwidth,r=this.pendingSegment_.duration,a=Playlist.estimateSegmentRequestTime(r,n,this.playlist_,e.bytesReceived),i=timeUntilRebuffer(this.buffered_(),t,this.vhs_.tech_.playbackRate())-1;if(a<=i)return;const s=minRebufferMaxBandwidthSelector({main:this.vhs_.playlists.main,currentTime:t,bandwidth:n,duration:this.duration_(),segmentDuration:r,timeUntilRebuffer:i,currentTimeline:this.currentTimeline_,syncController:this.syncController_});if(!s)return;const o=a-i-s.rebufferingImpact;let l=.5;i<=TIME_FUDGE_FACTOR&&(l=1),!s.playlist||s.playlist.uri===this.playlist_.uri||o<l||(this.bandwidth=s.playlist.attributes.BANDWIDTH*Config.BANDWIDTH_VARIANCE+1,this.trigger("earlyabort"))}handleAbort_(e){this.logger_(`Aborting ${segmentInfoString(e)}`),this.mediaRequestsAborted+=1}handleProgress_(e,t){this.earlyAbortWhenNeeded_(t.stats),this.checkForAbort_(t.requestId)||this.trigger("progress")}handleTrackInfo_(e,t){this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId)||this.checkForIllegalMediaSwitch(t)||(t=t||{},shallowEqual(this.currentMediaInfo_,t)||(this.appendInitSegment_={audio:!0,video:!0},this.startingMediaInfo_=t,this.currentMediaInfo_=t,this.logger_("trackinfo update",t),this.trigger("trackinfo")),this.checkForAbort_(e.requestId)||(this.pendingSegment_.trackInfo=t,this.hasEnoughInfoToAppend_()&&this.processCallQueue_()))}handleTimingInfo_(e,t,n,r){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;const a=this.pendingSegment_,i=timingInfoPropertyForMedia(t);a[i]=a[i]||{},a[i][n]=r,this.logger_(`timinginfo: ${t} - ${n} - ${r}`),this.hasEnoughInfoToAppend_()&&this.processCallQueue_()}handleCaptions_(e,t){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;if(0===t.length)return void this.logger_("SegmentLoader received no captions from a caption event");if(!this.pendingSegment_.hasAppendedData_)return void this.metadataQueue_.caption.push(this.handleCaptions_.bind(this,e,t));const n=null===this.sourceUpdater_.videoTimestampOffset()?this.sourceUpdater_.audioTimestampOffset():this.sourceUpdater_.videoTimestampOffset(),r={};t.forEach((e=>{r[e.stream]=r[e.stream]||{startTime:1/0,captions:[],endTime:0};const t=r[e.stream];t.startTime=Math.min(t.startTime,e.startTime+n),t.endTime=Math.max(t.endTime,e.endTime+n),t.captions.push(e)})),Object.keys(r).forEach((e=>{const{startTime:t,endTime:a,captions:i}=r[e],s=this.inbandTextTracks_;this.logger_(`adding cues from ${t} -> ${a} for ${e}`),createCaptionsTrackIfNotExists(s,this.vhs_.tech_,e),removeCuesFromTrack(t,a,s[e]),addCaptionData({captionArray:i,inbandTextTracks:s,timestampOffset:n})})),this.transmuxer_&&this.transmuxer_.postMessage({action:"clearParsedMp4Captions"})}handleId3_(e,t,n){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;this.pendingSegment_.hasAppendedData_?this.addMetadataToTextTrack(n,t,this.duration_()):this.metadataQueue_.id3.push(this.handleId3_.bind(this,e,t,n))}processMetadataQueue_(){this.metadataQueue_.id3.forEach((e=>e())),this.metadataQueue_.caption.forEach((e=>e())),this.metadataQueue_.id3=[],this.metadataQueue_.caption=[]}processCallQueue_(){const e=this.callQueue_;this.callQueue_=[],e.forEach((e=>e()))}processLoadQueue_(){const e=this.loadQueue_;this.loadQueue_=[],e.forEach((e=>e()))}hasEnoughInfoToLoad_(){if("audio"!==this.loaderType_)return!0;const e=this.pendingSegment_;return!!e&&(!this.getCurrentMediaInfo_()||!shouldWaitForTimelineChange({timelineChangeController:this.timelineChangeController_,currentTimeline:this.currentTimeline_,segmentTimeline:e.timeline,loaderType:this.loaderType_,audioDisabled:this.audioDisabled_}))}getCurrentMediaInfo_(e=this.pendingSegment_){return e&&e.trackInfo||this.currentMediaInfo_}getMediaInfo_(e=this.pendingSegment_){return this.getCurrentMediaInfo_(e)||this.startingMediaInfo_}getPendingSegmentPlaylist(){return this.pendingSegment_?this.pendingSegment_.playlist:null}hasEnoughInfoToAppend_(){if(!this.sourceUpdater_.ready())return!1;if(this.waitingOnRemove_||this.quotaExceededErrorRetryTimeout_)return!1;const e=this.pendingSegment_,t=this.getCurrentMediaInfo_();if(!e||!t)return!1;const{hasAudio:n,hasVideo:r,isMuxed:a}=t;return!(r&&!e.videoTimingInfo)&&(!(n&&!this.audioDisabled_&&!a&&!e.audioTimingInfo)&&!shouldWaitForTimelineChange({timelineChangeController:this.timelineChangeController_,currentTimeline:this.currentTimeline_,segmentTimeline:e.timeline,loaderType:this.loaderType_,audioDisabled:this.audioDisabled_}))}handleData_(e,t){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;if(this.callQueue_.length||!this.hasEnoughInfoToAppend_())return void this.callQueue_.push(this.handleData_.bind(this,e,t));const n=this.pendingSegment_;if(this.setTimeMapping_(n.timeline),this.updateMediaSecondsLoaded_(n.part||n.segment),"closed"!==this.mediaSource_.readyState){if(e.map&&(e.map=this.initSegmentForMap(e.map,!0),n.segment.map=e.map),e.key&&this.segmentKey(e.key,!0),n.isFmp4=e.isFmp4,n.timingInfo=n.timingInfo||{},n.isFmp4)this.trigger("fmp4"),n.timingInfo.start=n[timingInfoPropertyForMedia(t.type)].start;else{const e=this.getCurrentMediaInfo_(),t="main"===this.loaderType_&&e&&e.hasVideo;let r;t&&(r=n.videoTimingInfo.start),n.timingInfo.start=this.trueSegmentStart_({currentStart:n.timingInfo.start,playlist:n.playlist,mediaIndex:n.mediaIndex,currentVideoTimestampOffset:this.sourceUpdater_.videoTimestampOffset(),useVideoTimingInfo:t,firstVideoFrameTimeForData:r,videoTimingInfo:n.videoTimingInfo,audioTimingInfo:n.audioTimingInfo})}if(this.updateAppendInitSegmentStatus(n,t.type),this.updateSourceBufferTimestampOffset_(n),n.isSyncRequest){this.updateTimingInfoEnd_(n),this.syncController_.saveSegmentTimingInfo({segmentInfo:n,shouldSaveTimelineMapping:"main"===this.loaderType_});const e=this.chooseNextRequest_();if(e.mediaIndex!==n.mediaIndex||e.partIndex!==n.partIndex)return void this.logger_("sync segment was incorrect, not appending");this.logger_("sync segment was correct, appending")}n.hasAppendedData_=!0,this.processMetadataQueue_(),this.appendData_(n,t)}}updateAppendInitSegmentStatus(e,t){"main"!==this.loaderType_||"number"!=typeof e.timestampOffset||e.changedTimestampOffset||(this.appendInitSegment_={audio:!0,video:!0}),this.playlistOfLastInitSegment_[t]!==e.playlist&&(this.appendInitSegment_[t]=!0)}getInitSegmentAndUpdateState_({type:e,initSegment:t,map:n,playlist:r}){if(n){const e=initSegmentId(n);if(this.activeInitSegmentId_===e)return null;t=this.initSegmentForMap(n,!0).bytes,this.activeInitSegmentId_=e}return t&&this.appendInitSegment_[e]?(this.playlistOfLastInitSegment_[e]=r,this.appendInitSegment_[e]=!1,this.activeInitSegmentId_=null,t):null}handleQuotaExceededError_({segmentInfo:e,type:t,bytes:n},r){const a=this.sourceUpdater_.audioBuffered(),i=this.sourceUpdater_.videoBuffered();a.length>1&&this.logger_("On QUOTA_EXCEEDED_ERR, found gaps in the audio buffer: "+timeRangesToArray(a).join(", ")),i.length>1&&this.logger_("On QUOTA_EXCEEDED_ERR, found gaps in the video buffer: "+timeRangesToArray(i).join(", "));const s=a.length?a.start(0):0,o=a.length?a.end(a.length-1):0,l=i.length?i.start(0):0,u=i.length?i.end(i.length-1):0;if(o-s<=MIN_BACK_BUFFER&&u-l<=MIN_BACK_BUFFER)return this.logger_(`On QUOTA_EXCEEDED_ERR, single segment too large to append to buffer, triggering an error. Appended byte length: ${n.byteLength}, audio buffer: ${timeRangesToArray(a).join(", ")}, video buffer: ${timeRangesToArray(i).join(", ")}, `),this.error({message:"Quota exceeded error with append of a single segment of content",excludeUntil:1/0}),void this.trigger("error");this.waitingOnRemove_=!0,this.callQueue_.push(this.appendToSourceBuffer_.bind(this,{segmentInfo:e,type:t,bytes:n}));const c=this.currentTime_()-MIN_BACK_BUFFER;this.logger_(`On QUOTA_EXCEEDED_ERR, removing audio/video from 0 to ${c}`),this.remove(0,c,(()=>{this.logger_(`On QUOTA_EXCEEDED_ERR, retrying append in ${MIN_BACK_BUFFER}s`),this.waitingOnRemove_=!1,this.quotaExceededErrorRetryTimeout_=window$1$1.setTimeout((()=>{this.logger_("On QUOTA_EXCEEDED_ERR, re-processing call queue"),this.quotaExceededErrorRetryTimeout_=null,this.processCallQueue_()}),1e3*MIN_BACK_BUFFER)}),!0)}handleAppendError_({segmentInfo:e,type:t,bytes:n},r){r&&(r.code!==QUOTA_EXCEEDED_ERR?(this.logger_("Received non QUOTA_EXCEEDED_ERR on append",r),this.error(`${t} append of ${n.length}b failed for segment #${e.mediaIndex} in playlist ${e.playlist.id}`),this.trigger("appenderror")):this.handleQuotaExceededError_({segmentInfo:e,type:t,bytes:n}))}appendToSourceBuffer_({segmentInfo:e,type:t,initSegment:n,data:r,bytes:a}){if(!a){const e=[r];let t=r.byteLength;n&&(e.unshift(n),t+=n.byteLength),a=concatSegments({bytes:t,segments:e})}this.sourceUpdater_.appendBuffer({segmentInfo:e,type:t,bytes:a},this.handleAppendError_.bind(this,{segmentInfo:e,type:t,bytes:a}))}handleSegmentTimingInfo_(e,t,n){if(!this.pendingSegment_||t!==this.pendingSegment_.requestId)return;const r=this.pendingSegment_.segment,a=`${e}TimingInfo`;r[a]||(r[a]={}),r[a].transmuxerPrependedSeconds=n.prependedContentDuration||0,r[a].transmuxedPresentationStart=n.start.presentation,r[a].transmuxedDecodeStart=n.start.decode,r[a].transmuxedPresentationEnd=n.end.presentation,r[a].transmuxedDecodeEnd=n.end.decode,r[a].baseMediaDecodeTime=n.baseMediaDecodeTime}appendData_(e,t){const{type:n,data:r}=t;if(!r||!r.byteLength)return;if("audio"===n&&this.audioDisabled_)return;const a=this.getInitSegmentAndUpdateState_({type:n,initSegment:t.initSegment,playlist:e.playlist,map:e.isFmp4?e.segment.map:null});this.appendToSourceBuffer_({segmentInfo:e,type:n,initSegment:a,data:r})}loadSegment_(e){this.state="WAITING",this.pendingSegment_=e,this.trimBackBuffer_(e),"number"==typeof e.timestampOffset&&this.transmuxer_&&this.transmuxer_.postMessage({action:"clearAllMp4Captions"}),this.hasEnoughInfoToLoad_()?this.updateTransmuxerAndRequestSegment_(e):this.loadQueue_.push((()=>{const t=_extends$2({},e,{forceTimestampOffset:!0});_extends$2(e,this.generateSegmentInfo_(t)),this.isPendingTimestampOffset_=!1,this.updateTransmuxerAndRequestSegment_(e)}))}updateTransmuxerAndRequestSegment_(e){this.shouldUpdateTransmuxerTimestampOffset_(e.timestampOffset)&&(this.gopBuffer_.length=0,e.gopsToAlignWith=[],this.timeMapping_=0,this.transmuxer_.postMessage({action:"reset"}),this.transmuxer_.postMessage({action:"setTimestampOffset",timestampOffset:e.timestampOffset}));const t=this.createSimplifiedSegmentObj_(e),n=this.isEndOfStream_(e.mediaIndex,e.playlist,e.partIndex),r=null!==this.mediaIndex,a=e.timeline!==this.currentTimeline_&&e.timeline>0,i=n||r&&a;this.logger_(`Requesting ${segmentInfoString(e)}`),t.map&&!t.map.bytes&&(this.logger_("going to request init segment."),this.appendInitSegment_={video:!0,audio:!0}),e.abortRequests=mediaSegmentRequest({xhr:this.vhs_.xhr,xhrOptions:this.xhrOptions_,decryptionWorker:this.decrypter_,segment:t,abortFn:this.handleAbort_.bind(this,e),progressFn:this.handleProgress_.bind(this),trackInfoFn:this.handleTrackInfo_.bind(this),timingInfoFn:this.handleTimingInfo_.bind(this),videoSegmentTimingInfoFn:this.handleSegmentTimingInfo_.bind(this,"video",e.requestId),audioSegmentTimingInfoFn:this.handleSegmentTimingInfo_.bind(this,"audio",e.requestId),captionsFn:this.handleCaptions_.bind(this),isEndOfTimeline:i,endedTimelineFn:()=>{this.logger_("received endedtimeline callback")},id3Fn:this.handleId3_.bind(this),dataFn:this.handleData_.bind(this),doneFn:this.segmentRequestFinished_.bind(this),onTransmuxerLog:({message:t,level:n,stream:r})=>{this.logger_(`${segmentInfoString(e)} logged from transmuxer stream ${r} as a ${n}: ${t}`)}})}trimBackBuffer_(e){const t=safeBackBufferTrimTime(this.seekable_(),this.currentTime_(),this.playlist_.targetDuration||10);t>0&&this.remove(0,t)}createSimplifiedSegmentObj_(e){const t=e.segment,n=e.part,r={resolvedUri:n?n.resolvedUri:t.resolvedUri,byterange:n?n.byterange:t.byterange,requestId:e.requestId,transmuxer:e.transmuxer,audioAppendStart:e.audioAppendStart,gopsToAlignWith:e.gopsToAlignWith,part:e.part},a=e.playlist.segments[e.mediaIndex-1];if(a&&a.timeline===t.timeline&&(a.videoTimingInfo?r.baseStartTime=a.videoTimingInfo.transmuxedDecodeEnd:a.audioTimingInfo&&(r.baseStartTime=a.audioTimingInfo.transmuxedDecodeEnd)),t.key){const n=t.key.iv||new Uint32Array([0,0,0,e.mediaIndex+e.playlist.mediaSequence]);r.key=this.segmentKey(t.key),r.key.iv=n}return t.map&&(r.map=this.initSegmentForMap(t.map)),r}saveTransferStats_(e){this.mediaRequests+=1,e&&(this.mediaBytesTransferred+=e.bytesReceived,this.mediaTransferDuration+=e.roundTripTime)}saveBandwidthRelatedStats_(e,t){this.pendingSegment_.byteLength=t.bytesReceived,e<MIN_SEGMENT_DURATION_TO_SAVE_STATS?this.logger_(`Ignoring segment's bandwidth because its duration of ${e} is less than the min to record ${MIN_SEGMENT_DURATION_TO_SAVE_STATS}`):(this.bandwidth=t.bandwidth,this.roundTrip=t.roundTripTime)}handleTimeout_(){this.mediaRequestsTimedout+=1,this.bandwidth=1,this.roundTrip=NaN,this.trigger("bandwidthupdate"),this.trigger("timeout")}segmentRequestFinished_(e,t,n){if(this.callQueue_.length)return void this.callQueue_.push(this.segmentRequestFinished_.bind(this,e,t,n));if(this.saveTransferStats_(t.stats),!this.pendingSegment_)return;if(t.requestId!==this.pendingSegment_.requestId)return;if(e){if(this.pendingSegment_=null,this.state="READY",e.code===REQUEST_ERRORS.ABORTED)return;return this.pause(),e.code===REQUEST_ERRORS.TIMEOUT?void this.handleTimeout_():(this.mediaRequestsErrored+=1,this.error(e),void this.trigger("error"))}const r=this.pendingSegment_;this.saveBandwidthRelatedStats_(r.duration,t.stats),r.endOfAllRequests=t.endOfAllRequests,n.gopInfo&&(this.gopBuffer_=updateGopBuffer(this.gopBuffer_,n.gopInfo,this.safeAppend_)),this.state="APPENDING",this.trigger("appending"),this.waitForAppendsToComplete_(r)}setTimeMapping_(e){const t=this.syncController_.mappingForTimeline(e);null!==t&&(this.timeMapping_=t)}updateMediaSecondsLoaded_(e){"number"==typeof e.start&&"number"==typeof e.end?this.mediaSecondsLoaded+=e.end-e.start:this.mediaSecondsLoaded+=e.duration}shouldUpdateTransmuxerTimestampOffset_(e){return null!==e&&("main"===this.loaderType_&&e!==this.sourceUpdater_.videoTimestampOffset()||!this.audioDisabled_&&e!==this.sourceUpdater_.audioTimestampOffset())}trueSegmentStart_({currentStart:e,playlist:t,mediaIndex:n,firstVideoFrameTimeForData:r,currentVideoTimestampOffset:a,useVideoTimingInfo:i,videoTimingInfo:s,audioTimingInfo:o}){if(void 0!==e)return e;if(!i)return o.start;const l=t.segments[n-1];return 0!==n&&l&&void 0!==l.start&&l.end===r+a?s.start:r}waitForAppendsToComplete_(e){const t=this.getCurrentMediaInfo_(e);if(!t)return this.error({message:"No starting media returned, likely due to an unsupported media format.",playlistExclusionDuration:1/0}),void this.trigger("error");const{hasAudio:n,hasVideo:r,isMuxed:a}=t,i="main"===this.loaderType_&&r,s=!this.audioDisabled_&&n&&!a;if(e.waitingOnAppends=0,!e.hasAppendedData_)return e.timingInfo||"number"!=typeof e.timestampOffset||(this.isPendingTimestampOffset_=!0),e.timingInfo={start:0},e.waitingOnAppends++,this.isPendingTimestampOffset_||(this.updateSourceBufferTimestampOffset_(e),this.processMetadataQueue_()),void this.checkAppendsDone_(e);i&&e.waitingOnAppends++,s&&e.waitingOnAppends++,i&&this.sourceUpdater_.videoQueueCallback(this.checkAppendsDone_.bind(this,e)),s&&this.sourceUpdater_.audioQueueCallback(this.checkAppendsDone_.bind(this,e))}checkAppendsDone_(e){this.checkForAbort_(e.requestId)||(e.waitingOnAppends--,0===e.waitingOnAppends&&this.handleAppendsDone_())}checkForIllegalMediaSwitch(e){const t=illegalMediaSwitch(this.loaderType_,this.getCurrentMediaInfo_(),e);return!!t&&(this.error({message:t,playlistExclusionDuration:1/0}),this.trigger("error"),!0)}updateSourceBufferTimestampOffset_(e){if(null===e.timestampOffset||"number"!=typeof e.timingInfo.start||e.changedTimestampOffset||"main"!==this.loaderType_)return;let t=!1;e.timestampOffset-=this.getSegmentStartTimeForTimestampOffsetCalculation_({videoTimingInfo:e.segment.videoTimingInfo,audioTimingInfo:e.segment.audioTimingInfo,timingInfo:e.timingInfo}),e.changedTimestampOffset=!0,e.timestampOffset!==this.sourceUpdater_.videoTimestampOffset()&&(this.sourceUpdater_.videoTimestampOffset(e.timestampOffset),t=!0),e.timestampOffset!==this.sourceUpdater_.audioTimestampOffset()&&(this.sourceUpdater_.audioTimestampOffset(e.timestampOffset),t=!0),t&&this.trigger("timestampoffset")}getSegmentStartTimeForTimestampOffsetCalculation_({videoTimingInfo:e,audioTimingInfo:t,timingInfo:n}){return this.useDtsForTimestampOffset_?e&&"number"==typeof e.transmuxedDecodeStart?e.transmuxedDecodeStart:t&&"number"==typeof t.transmuxedDecodeStart?t.transmuxedDecodeStart:n.start:n.start}updateTimingInfoEnd_(e){e.timingInfo=e.timingInfo||{};const t=this.getMediaInfo_(),n="main"===this.loaderType_&&t&&t.hasVideo&&e.videoTimingInfo?e.videoTimingInfo:e.audioTimingInfo;n&&(e.timingInfo.end="number"==typeof n.end?n.end:n.start+e.duration)}handleAppendsDone_(){if(this.pendingSegment_&&this.trigger("appendsdone"),!this.pendingSegment_)return this.state="READY",void(this.paused()||this.monitorBuffer_());const e=this.pendingSegment_;this.updateTimingInfoEnd_(e),this.shouldSaveSegmentTimingInfo_&&this.syncController_.saveSegmentTimingInfo({segmentInfo:e,shouldSaveTimelineMapping:"main"===this.loaderType_});const t=getTroublesomeSegmentDurationMessage(e,this.sourceType_);if(t&&("warn"===t.severity?videojs.log.warn(t.message):this.logger_(t.message)),this.recordThroughput_(e),this.pendingSegment_=null,this.state="READY",e.isSyncRequest&&(this.trigger("syncinfoupdate"),!e.hasAppendedData_))return void this.logger_(`Throwing away un-appended sync request ${segmentInfoString(e)}`);this.logger_(`Appended ${segmentInfoString(e)}`),this.addSegmentMetadataCue_(e),this.fetchAtBuffer_=!0,this.currentTimeline_!==e.timeline&&(this.timelineChangeController_.lastTimelineChange({type:this.loaderType_,from:this.currentTimeline_,to:e.timeline}),"main"!==this.loaderType_||this.audioDisabled_||this.timelineChangeController_.lastTimelineChange({type:"audio",from:this.currentTimeline_,to:e.timeline})),this.currentTimeline_=e.timeline,this.trigger("syncinfoupdate");const n=e.segment,r=e.part,a=n.end&&this.currentTime_()-n.end>3*e.playlist.targetDuration,i=r&&r.end&&this.currentTime_()-r.end>3*e.playlist.partTargetDuration;if(a||i)return this.logger_(`bad ${a?"segment":"part"} ${segmentInfoString(e)}`),void this.resetEverything();null!==this.mediaIndex&&this.trigger("bandwidthupdate"),this.trigger("progress"),this.mediaIndex=e.mediaIndex,this.partIndex=e.partIndex,this.isEndOfStream_(e.mediaIndex,e.playlist,e.partIndex)&&this.endOfStream(),this.trigger("appended"),e.hasAppendedData_&&this.mediaAppends++,this.paused()||this.monitorBuffer_()}recordThroughput_(e){if(e.duration<MIN_SEGMENT_DURATION_TO_SAVE_STATS)return void this.logger_(`Ignoring segment's throughput because its duration of ${e.duration} is less than the min to record ${MIN_SEGMENT_DURATION_TO_SAVE_STATS}`);const t=this.throughput.rate,n=Date.now()-e.endOfAllRequests+1,r=Math.floor(e.byteLength/n*8*1e3);this.throughput.rate+=(r-t)/++this.throughput.count}addSegmentMetadataCue_(e){if(!this.segmentMetadataTrack_)return;const t=e.segment,n=t.start,r=t.end;if(!finite(n)||!finite(r))return;removeCuesFromTrack(n,r,this.segmentMetadataTrack_);const a=window$1$1.WebKitDataCue||window$1$1.VTTCue,i={custom:t.custom,dateTimeObject:t.dateTimeObject,dateTimeString:t.dateTimeString,programDateTime:t.programDateTime,bandwidth:e.playlist.attributes.BANDWIDTH,resolution:e.playlist.attributes.RESOLUTION,codecs:e.playlist.attributes.CODECS,byteLength:e.byteLength,uri:e.uri,timeline:e.timeline,playlist:e.playlist.id,start:n,end:r},s=new a(n,r,JSON.stringify(i));s.value=i,this.segmentMetadataTrack_.addCue(s)}}function noop(){}const toTitleCase=function(e){return"string"!=typeof e?e:e.replace(/./,(e=>e.toUpperCase()))},bufferTypes=["video","audio"],updating=(e,t)=>{const n=t[`${e}Buffer`];return n&&n.updating||t.queuePending[e]},nextQueueIndexOfType=(e,t)=>{for(let n=0;n<t.length;n++){const r=t[n];if("mediaSource"===r.type)return null;if(r.type===e)return n}return null},shiftQueue=(e,t)=>{if(0===t.queue.length)return;let n=0,r=t.queue[n];if("mediaSource"!==r.type){if("mediaSource"!==e&&t.ready()&&"closed"!==t.mediaSource.readyState&&!updating(e,t)){if(r.type!==e){if(n=nextQueueIndexOfType(e,t.queue),null===n)return;r=t.queue[n]}return t.queue.splice(n,1),t.queuePending[e]=r,r.action(e,t),r.doneFn?void 0:(t.queuePending[e]=null,void shiftQueue(e,t))}}else t.updating()||"closed"===t.mediaSource.readyState||(t.queue.shift(),r.action(t),r.doneFn&&r.doneFn(),shiftQueue("audio",t),shiftQueue("video",t))},cleanupBuffer=(e,t)=>{const n=t[`${e}Buffer`],r=toTitleCase(e);n&&(n.removeEventListener("updateend",t[`on${r}UpdateEnd_`]),n.removeEventListener("error",t[`on${r}Error_`]),t.codecs[e]=null,t[`${e}Buffer`]=null)},inSourceBuffers=(e,t)=>e&&t&&-1!==Array.prototype.indexOf.call(e.sourceBuffers,t),actions={appendBuffer:(e,t,n)=>(r,a)=>{const i=a[`${r}Buffer`];if(inSourceBuffers(a.mediaSource,i)){a.logger_(`Appending segment ${t.mediaIndex}'s ${e.length} bytes to ${r}Buffer`);try{i.appendBuffer(e)}catch(e2){a.logger_(`Error with code ${e2.code} `+(e2.code===QUOTA_EXCEEDED_ERR?"(QUOTA_EXCEEDED_ERR) ":"")+`when appending segment ${t.mediaIndex} to ${r}Buffer`),a.queuePending[r]=null,n(e2)}}},remove:(e,t)=>(n,r)=>{const a=r[`${n}Buffer`];if(inSourceBuffers(r.mediaSource,a)){r.logger_(`Removing ${e} to ${t} from ${n}Buffer`);try{a.remove(e,t)}catch(e2){r.logger_(`Remove ${e} to ${t} from ${n}Buffer failed`)}}},timestampOffset:e=>(t,n)=>{const r=n[`${t}Buffer`];inSourceBuffers(n.mediaSource,r)&&(n.logger_(`Setting ${t}timestampOffset to ${e}`),r.timestampOffset=e)},callback:e=>(t,n)=>{e()},endOfStream:e=>t=>{if("open"===t.mediaSource.readyState){t.logger_(`Calling mediaSource endOfStream(${e||""})`);try{t.mediaSource.endOfStream(e)}catch(e2){videojs.log.warn("Failed to call media source endOfStream",e2)}}},duration:e=>t=>{t.logger_(`Setting mediaSource duration to ${e}`);try{t.mediaSource.duration=e}catch(e2){videojs.log.warn("Failed to set media source duration",e2)}},abort:()=>(e,t)=>{if("open"!==t.mediaSource.readyState)return;const n=t[`${e}Buffer`];if(inSourceBuffers(t.mediaSource,n)){t.logger_(`calling abort on ${e}Buffer`);try{n.abort()}catch(e2){videojs.log.warn(`Failed to abort on ${e}Buffer`,e2)}}},addSourceBuffer:(e,t)=>n=>{const r=toTitleCase(e),a=getMimeForCodec(t);n.logger_(`Adding ${e}Buffer with codec ${t} to mediaSource`);const i=n.mediaSource.addSourceBuffer(a);i.addEventListener("updateend",n[`on${r}UpdateEnd_`]),i.addEventListener("error",n[`on${r}Error_`]),n.codecs[e]=t,n[`${e}Buffer`]=i},removeSourceBuffer:e=>t=>{const n=t[`${e}Buffer`];if(cleanupBuffer(e,t),inSourceBuffers(t.mediaSource,n)){t.logger_(`Removing ${e}Buffer with codec ${t.codecs[e]} from mediaSource`);try{t.mediaSource.removeSourceBuffer(n)}catch(e2){videojs.log.warn(`Failed to removeSourceBuffer ${e}Buffer`,e2)}}},changeType:e=>(t,n)=>{const r=n[`${t}Buffer`],a=getMimeForCodec(e);if(inSourceBuffers(n.mediaSource,r)&&n.codecs[t]!==e){n.logger_(`changing ${t}Buffer codec from ${n.codecs[t]} to ${e}`);try{r.changeType(a),n.codecs[t]=e}catch(e2){videojs.log.warn(`Failed to changeType on ${t}Buffer`,e2)}}}},pushQueue=({type:e,sourceUpdater:t,action:n,doneFn:r,name:a})=>{t.queue.push({type:e,action:n,doneFn:r,name:a}),shiftQueue(e,t)},onUpdateend=(e,t)=>n=>{if(t.queuePending[e]){const n=t.queuePending[e].doneFn;t.queuePending[e]=null,n&&n(t[`${e}Error_`])}shiftQueue(e,t)};class SourceUpdater extends videojs.EventTarget{constructor(e){super(),this.mediaSource=e,this.sourceopenListener_=()=>shiftQueue("mediaSource",this),this.mediaSource.addEventListener("sourceopen",this.sourceopenListener_),this.logger_=logger("SourceUpdater"),this.audioTimestampOffset_=0,this.videoTimestampOffset_=0,this.queue=[],this.queuePending={audio:null,video:null},this.delayedAudioAppendQueue_=[],this.videoAppendQueued_=!1,this.codecs={},this.onVideoUpdateEnd_=onUpdateend("video",this),this.onAudioUpdateEnd_=onUpdateend("audio",this),this.onVideoError_=e=>{this.videoError_=e},this.onAudioError_=e=>{this.audioError_=e},this.createdSourceBuffers_=!1,this.initializedEme_=!1,this.triggeredReady_=!1}initializedEme(){this.initializedEme_=!0,this.triggerReady()}hasCreatedSourceBuffers(){return this.createdSourceBuffers_}hasInitializedAnyEme(){return this.initializedEme_}ready(){return this.hasCreatedSourceBuffers()&&this.hasInitializedAnyEme()}createSourceBuffers(e){this.hasCreatedSourceBuffers()||(this.addOrChangeSourceBuffers(e),this.createdSourceBuffers_=!0,this.trigger("createdsourcebuffers"),this.triggerReady())}triggerReady(){this.ready()&&!this.triggeredReady_&&(this.triggeredReady_=!0,this.trigger("ready"))}addSourceBuffer(e,t){pushQueue({type:"mediaSource",sourceUpdater:this,action:actions.addSourceBuffer(e,t),name:"addSourceBuffer"})}abort(e){pushQueue({type:e,sourceUpdater:this,action:actions.abort(e),name:"abort"})}removeSourceBuffer(e){this.canRemoveSourceBuffer()?pushQueue({type:"mediaSource",sourceUpdater:this,action:actions.removeSourceBuffer(e),name:"removeSourceBuffer"}):videojs.log.error("removeSourceBuffer is not supported!")}canRemoveSourceBuffer(){return!videojs.browser.IS_FIREFOX&&window$1$1.MediaSource&&window$1$1.MediaSource.prototype&&"function"==typeof window$1$1.MediaSource.prototype.removeSourceBuffer}static canChangeType(){return window$1$1.SourceBuffer&&window$1$1.SourceBuffer.prototype&&"function"==typeof window$1$1.SourceBuffer.prototype.changeType}canChangeType(){return this.constructor.canChangeType()}changeType(e,t){this.canChangeType()?pushQueue({type:e,sourceUpdater:this,action:actions.changeType(t),name:"changeType"}):videojs.log.error("changeType is not supported!")}addOrChangeSourceBuffers(e){if(!e||"object"!=typeof e||0===Object.keys(e).length)throw new Error("Cannot addOrChangeSourceBuffers to undefined codecs");Object.keys(e).forEach((t=>{const n=e[t];if(!this.hasCreatedSourceBuffers())return this.addSourceBuffer(t,n);this.canChangeType()&&this.changeType(t,n)}))}appendBuffer(e,t){const{segmentInfo:n,type:r,bytes:a}=e;if(this.processedAppend_=!0,"audio"===r&&this.videoBuffer&&!this.videoAppendQueued_)return this.delayedAudioAppendQueue_.push([e,t]),void this.logger_(`delayed audio append of ${a.length} until video append`);const i=t;if(pushQueue({type:r,sourceUpdater:this,action:actions.appendBuffer(a,n||{mediaIndex:-1},i),doneFn:t,name:"appendBuffer"}),"video"===r){if(this.videoAppendQueued_=!0,!this.delayedAudioAppendQueue_.length)return;const e=this.delayedAudioAppendQueue_.slice();this.logger_(`queuing delayed audio ${e.length} appendBuffers`),this.delayedAudioAppendQueue_.length=0,e.forEach((e=>{this.appendBuffer.apply(this,e)}))}}audioBuffered(){return inSourceBuffers(this.mediaSource,this.audioBuffer)&&this.audioBuffer.buffered?this.audioBuffer.buffered:createTimeRanges()}videoBuffered(){return inSourceBuffers(this.mediaSource,this.videoBuffer)&&this.videoBuffer.buffered?this.videoBuffer.buffered:createTimeRanges()}buffered(){const e=inSourceBuffers(this.mediaSource,this.videoBuffer)?this.videoBuffer:null,t=inSourceBuffers(this.mediaSource,this.audioBuffer)?this.audioBuffer:null;return t&&!e?this.audioBuffered():e&&!t?this.videoBuffered():bufferIntersection(this.audioBuffered(),this.videoBuffered())}setDuration(e,t=noop){pushQueue({type:"mediaSource",sourceUpdater:this,action:actions.duration(e),name:"duration",doneFn:t})}endOfStream(e=null,t=noop){"string"!=typeof e&&(e=void 0),pushQueue({type:"mediaSource",sourceUpdater:this,action:actions.endOfStream(e),name:"endOfStream",doneFn:t})}removeAudio(e,t,n=noop){this.audioBuffered().length&&0!==this.audioBuffered().end(0)?pushQueue({type:"audio",sourceUpdater:this,action:actions.remove(e,t),doneFn:n,name:"remove"}):n()}removeVideo(e,t,n=noop){this.videoBuffered().length&&0!==this.videoBuffered().end(0)?pushQueue({type:"video",sourceUpdater:this,action:actions.remove(e,t),doneFn:n,name:"remove"}):n()}updating(){return!(!updating("audio",this)&&!updating("video",this))}audioTimestampOffset(e){return void 0!==e&&this.audioBuffer&&this.audioTimestampOffset_!==e&&(pushQueue({type:"audio",sourceUpdater:this,action:actions.timestampOffset(e),name:"timestampOffset"}),this.audioTimestampOffset_=e),this.audioTimestampOffset_}videoTimestampOffset(e){return void 0!==e&&this.videoBuffer&&this.videoTimestampOffset!==e&&(pushQueue({type:"video",sourceUpdater:this,action:actions.timestampOffset(e),name:"timestampOffset"}),this.videoTimestampOffset_=e),this.videoTimestampOffset_}audioQueueCallback(e){this.audioBuffer&&pushQueue({type:"audio",sourceUpdater:this,action:actions.callback(e),name:"callback"})}videoQueueCallback(e){this.videoBuffer&&pushQueue({type:"video",sourceUpdater:this,action:actions.callback(e),name:"callback"})}dispose(){this.trigger("dispose"),bufferTypes.forEach((e=>{this.abort(e),this.canRemoveSourceBuffer()?this.removeSourceBuffer(e):this[`${e}QueueCallback`]((()=>cleanupBuffer(e,this)))})),this.videoAppendQueued_=!1,this.delayedAudioAppendQueue_.length=0,this.sourceopenListener_&&this.mediaSource.removeEventListener("sourceopen",this.sourceopenListener_),this.off()}}const uint8ToUtf8=e=>decodeURIComponent(escape(String.fromCharCode.apply(null,e))),bufferToHexString=e=>{const t=new Uint8Array(e);return Array.from(t).map((e=>e.toString(16).padStart(2,"0"))).join("")},VTT_LINE_TERMINATORS=new Uint8Array("\n\n".split("").map((e=>e.charCodeAt(0))));class NoVttJsError extends Error{constructor(){super("Trying to parse received VTT cues, but there is no WebVTT. Make sure vtt.js is loaded.")}}class VTTSegmentLoader extends SegmentLoader{constructor(e,t={}){super(e,t),this.mediaSource_=null,this.subtitlesTrack_=null,this.loaderType_="subtitle",this.featuresNativeTextTracks_=e.featuresNativeTextTracks,this.loadVttJs=e.loadVttJs,this.shouldSaveSegmentTimingInfo_=!1}createTransmuxer_(){return null}buffered_(){if(!this.subtitlesTrack_||!this.subtitlesTrack_.cues||!this.subtitlesTrack_.cues.length)return createTimeRanges();const e=this.subtitlesTrack_.cues;return createTimeRanges([[e[0].startTime,e[e.length-1].startTime]])}initSegmentForMap(e,t=!1){if(!e)return null;const n=initSegmentId(e);let r=this.initSegments_[n];if(t&&!r&&e.bytes){const t=VTT_LINE_TERMINATORS.byteLength+e.bytes.byteLength,a=new Uint8Array(t);a.set(e.bytes),a.set(VTT_LINE_TERMINATORS,e.bytes.byteLength),this.initSegments_[n]=r={resolvedUri:e.resolvedUri,byterange:e.byterange,bytes:a}}return r||e}couldBeginLoading_(){return this.playlist_&&this.subtitlesTrack_&&!this.paused()}init_(){return this.state="READY",this.resetEverything(),this.monitorBuffer_()}track(e){return void 0===e||(this.subtitlesTrack_=e,"INIT"===this.state&&this.couldBeginLoading_()&&this.init_()),this.subtitlesTrack_}remove(e,t){removeCuesFromTrack(e,t,this.subtitlesTrack_)}fillBuffer_(){const e=this.chooseNextRequest_();if(e){if(null===this.syncController_.timestampOffsetForTimeline(e.timeline)){const e=()=>{this.state="READY",this.paused()||this.monitorBuffer_()};return this.syncController_.one("timestampoffset",e),void(this.state="WAITING_ON_TIMELINE")}this.loadSegment_(e)}}timestampOffsetForSegment_(){return null}chooseNextRequest_(){return this.skipEmptySegments_(super.chooseNextRequest_())}skipEmptySegments_(e){for(;e&&e.segment.empty;){if(e.mediaIndex+1>=e.playlist.segments.length){e=null;break}e=this.generateSegmentInfo_({playlist:e.playlist,mediaIndex:e.mediaIndex+1,startOfSegment:e.startOfSegment+e.duration,isSyncRequest:e.isSyncRequest})}return e}stopForError(e){this.error(e),this.state="READY",this.pause(),this.trigger("error")}segmentRequestFinished_(e,t,n){if(!this.subtitlesTrack_)return void(this.state="READY");if(this.saveTransferStats_(t.stats),!this.pendingSegment_)return this.state="READY",void(this.mediaRequestsAborted+=1);if(e)return e.code===REQUEST_ERRORS.TIMEOUT&&this.handleTimeout_(),e.code===REQUEST_ERRORS.ABORTED?this.mediaRequestsAborted+=1:this.mediaRequestsErrored+=1,void this.stopForError(e);const r=this.pendingSegment_;this.saveBandwidthRelatedStats_(r.duration,t.stats),t.key&&this.segmentKey(t.key,!0),this.state="APPENDING",this.trigger("appending");const a=r.segment;if(a.map&&(a.map.bytes=t.map.bytes),r.bytes=t.bytes,"function"!=typeof window$1$1.WebVTT&&"function"==typeof this.loadVttJs)return this.state="WAITING_ON_VTTJS",void this.loadVttJs().then((()=>this.segmentRequestFinished_(e,t,n)),(()=>this.stopForError({message:"Error loading vtt.js"})));a.requested=!0;try{this.parseVTTCues_(r)}catch(e2){return void this.stopForError({message:e2.message})}if(this.updateTimeMapping_(r,this.syncController_.timelines[r.timeline],this.playlist_),r.cues.length?r.timingInfo={start:r.cues[0].startTime,end:r.cues[r.cues.length-1].endTime}:r.timingInfo={start:r.startOfSegment,end:r.startOfSegment+r.duration},r.isSyncRequest)return this.trigger("syncinfoupdate"),this.pendingSegment_=null,void(this.state="READY");r.byteLength=r.bytes.byteLength,this.mediaSecondsLoaded+=a.duration,r.cues.forEach((e=>{this.subtitlesTrack_.addCue(this.featuresNativeTextTracks_?new window$1$1.VTTCue(e.startTime,e.endTime,e.text):e)})),removeDuplicateCuesFromTrack(this.subtitlesTrack_),this.handleAppendsDone_()}handleData_(){}updateTimingInfoEnd_(){}parseVTTCues_(e){let t,n=!1;if("function"!=typeof window$1$1.WebVTT)throw new NoVttJsError;"function"==typeof window$1$1.TextDecoder?t=new window$1$1.TextDecoder("utf8"):(t=window$1$1.WebVTT.StringDecoder(),n=!0);const r=new window$1$1.WebVTT.Parser(window$1$1,window$1$1.vttjs,t);if(e.cues=[],e.timestampmap={MPEGTS:0,LOCAL:0},r.oncue=e.cues.push.bind(e.cues),r.ontimestampmap=t=>{e.timestampmap=t},r.onparsingerror=e=>{videojs.log.warn("Error encountered when parsing cues: "+e.message)},e.segment.map){let t=e.segment.map.bytes;n&&(t=uint8ToUtf8(t)),r.parse(t)}let a=e.bytes;n&&(a=uint8ToUtf8(a)),r.parse(a),r.flush()}updateTimeMapping_(e,t,n){const r=e.segment;if(!t)return;if(!e.cues.length)return void(r.empty=!0);const{MPEGTS:a,LOCAL:i}=e.timestampmap,s=a/clock.ONE_SECOND_IN_TS-i+t.mapping;if(e.cues.forEach((e=>{const n=e.endTime-e.startTime,r=0===a?e.startTime+s:this.handleRollover_(e.startTime+s,t.time);e.startTime=Math.max(r,0),e.endTime=Math.max(r+n,0)})),!n.syncInfo){const t=e.cues[0].startTime,a=e.cues[e.cues.length-1].startTime;n.syncInfo={mediaSequence:n.mediaSequence+e.mediaIndex,time:Math.min(t,a-r.duration)}}}handleRollover_(e,t){if(null===t)return e;let n=e*clock.ONE_SECOND_IN_TS;const r=t*clock.ONE_SECOND_IN_TS;let a;for(a=r<n?-8589934592:8589934592;Math.abs(n-r)>4294967296;)n+=a;return n/clock.ONE_SECOND_IN_TS}}const findAdCue=function(e,t){const n=e.cues;for(let r=0;r<n.length;r++){const e=n[r];if(t>=e.adStartTime&&t<=e.adEndTime)return e}return null},updateAdCues=function(e,t,n=0){if(!e.segments)return;let r,a=n;for(let i=0;i<e.segments.length;i++){const n=e.segments[i];if(r||(r=findAdCue(t,a+n.duration/2)),r){if("cueIn"in n){r.endTime=a,r.adEndTime=a,a+=n.duration,r=null;continue}if(a<r.endTime){a+=n.duration;continue}r.endTime+=n.duration}else if("cueOut"in n&&(r=new window$1$1.VTTCue(a,a+n.duration,n.cueOut),r.adStartTime=a,r.adEndTime=a+parseFloat(n.cueOut),t.addCue(r)),"cueOutCont"in n){const[e,i]=n.cueOutCont.split("/").map(parseFloat);r=new window$1$1.VTTCue(a,a+n.duration,""),r.adStartTime=a-e,r.adEndTime=r.adStartTime+i,t.addCue(r)}a+=n.duration}},MAX_MEDIA_SEQUENCE_DIFF_FOR_SYNC=86400,syncPointStrategies=[{name:"VOD",run:(e,t,n,r,a)=>{if(n!==1/0){return{time:0,segmentIndex:0,partIndex:null}}return null}},{name:"MediaSequence",run:(e,t,n,r,a,i)=>{if(!i)return null;const s=e.getMediaSequenceMap(i);if(!s||0===s.size)return null;if(void 0===t.mediaSequence||!Array.isArray(t.segments)||!t.segments.length)return null;let o=t.mediaSequence,l=0;for(const u of t.segments){const e=s.get(o);if(!e)break;if(a>=e.start&&a<e.end){if(Array.isArray(u.parts)&&u.parts.length){let t=e.start,n=0;for(const r of u.parts){const i=t,s=i+r.duration;if(a>=i&&a<s)return{time:e.start,segmentIndex:l,partIndex:n};n++,t=s}}return{time:e.start,segmentIndex:l,partIndex:null}}l++,o++}return null}},{name:"ProgramDateTime",run:(e,t,n,r,a)=>{if(!Object.keys(e.timelineToDatetimeMappings).length)return null;let i=null,s=null;const o=getPartsAndSegments(t);a=a||0;for(let l=0;l<o.length;l++){const n=o[t.endList||0===a?l:o.length-(l+1)],r=n.segment,u=e.timelineToDatetimeMappings[r.timeline];if(!u||!r.dateTimeObject)continue;let c=r.dateTimeObject.getTime()/1e3+u;if(r.parts&&"number"==typeof n.partIndex)for(let e=0;e<n.partIndex;e++)c+=r.parts[e].duration;const h=Math.abs(a-c);if(null!==s&&(0===h||s<h))break;s=h,i={time:c,segmentIndex:n.segmentIndex,partIndex:n.partIndex}}return i}},{name:"Segment",run:(e,t,n,r,a)=>{let i=null,s=null;a=a||0;const o=getPartsAndSegments(t);for(let l=0;l<o.length;l++){const e=o[t.endList||0===a?l:o.length-(l+1)],n=e.segment,u=e.part&&e.part.start||n&&n.start;if(n.timeline===r&&void 0!==u){const t=Math.abs(a-u);if(null!==s&&s<t)break;(!i||null===s||s>=t)&&(s=t,i={time:u,segmentIndex:e.segmentIndex,partIndex:e.partIndex})}}return i}},{name:"Discontinuity",run:(e,t,n,r,a)=>{let i=null;if(a=a||0,t.discontinuityStarts&&t.discontinuityStarts.length){let n=null;for(let r=0;r<t.discontinuityStarts.length;r++){const s=t.discontinuityStarts[r],o=t.discontinuitySequence+r+1,l=e.discontinuities[o];if(l){const e=Math.abs(a-l.time);if(null!==n&&n<e)break;(!i||null===n||n>=e)&&(n=e,i={time:l.time,segmentIndex:s,partIndex:null})}}}return i}},{name:"Playlist",run:(e,t,n,r,a)=>{if(t.syncInfo){return{time:t.syncInfo.time,segmentIndex:t.syncInfo.mediaSequence-t.mediaSequence,partIndex:null}}return null}}];class SyncController extends videojs.EventTarget{constructor(e={}){super(),this.timelines=[],this.discontinuities=[],this.timelineToDatetimeMappings={},this.mediaSequenceStorage_=new Map,this.logger_=logger("SyncController")}getMediaSequenceMap(e){return this.mediaSequenceStorage_.get(e)}updateMediaSequenceMap(e,t,n){if(void 0===e.mediaSequence||!Array.isArray(e.segments)||!e.segments.length)return;const r=this.getMediaSequenceMap(n),a=new Map;let i,s=e.mediaSequence;r?r.has(e.mediaSequence)?i=r.get(e.mediaSequence).start:(this.logger_(`MediaSequence sync for ${n} segment loader - received a gap between playlists.\nFallback base time to: ${t}.\nReceived media sequence: ${s}.\nCurrent map: `,r),i=t):i=0,this.logger_(`MediaSequence sync for ${n} segment loader.\nReceived media sequence: ${s}.\nbase time is ${i}\nCurrent map: `,r),e.segments.forEach((e=>{const t=i,n=t+e.duration,r={start:t,end:n};a.set(s,r),s++,i=n})),this.mediaSequenceStorage_.set(n,a)}getSyncPoint(e,t,n,r,a){if(t!==1/0){return syncPointStrategies.find((({name:e})=>"VOD"===e)).run(this,e,t)}const i=this.runStrategies_(e,t,n,r,a);if(!i.length)return null;for(const s of i){const{syncPoint:t,strategy:n}=s,{segmentIndex:a,time:i}=t;if(a<0)continue;const o=i,l=o+e.segments[a].duration;if(this.logger_(`Strategy: ${n}. Current time: ${r}. selected segment: ${a}. Time: [${o} -> ${l}]}`),r>=o&&r<l)return this.logger_("Found sync point with exact match: ",t),t}return this.selectSyncPoint_(i,{key:"time",value:r})}getExpiredTime(e,t){if(!e||!e.segments)return null;const n=this.runStrategies_(e,t,e.discontinuitySequence,0,"main");if(!n.length)return null;const r=this.selectSyncPoint_(n,{key:"segmentIndex",value:0});return r.segmentIndex>0&&(r.time*=-1),Math.abs(r.time+sumDurations({defaultDuration:e.targetDuration,durationList:e.segments,startIndex:r.segmentIndex,endIndex:0}))}runStrategies_(e,t,n,r,a){const i=[];for(let s=0;s<syncPointStrategies.length;s++){const o=syncPointStrategies[s],l=o.run(this,e,t,n,r,a);l&&(l.strategy=o.name,i.push({strategy:o.name,syncPoint:l}))}return i}selectSyncPoint_(e,t){let n=e[0].syncPoint,r=Math.abs(e[0].syncPoint[t.key]-t.value),a=e[0].strategy;for(let i=1;i<e.length;i++){const s=Math.abs(e[i].syncPoint[t.key]-t.value);s<r&&(r=s,n=e[i].syncPoint,a=e[i].strategy)}return this.logger_(`syncPoint for [${t.key}: ${t.value}] chosen with strategy [${a}]: [time:${n.time}, segmentIndex:${n.segmentIndex}`+("number"==typeof n.partIndex?`,partIndex:${n.partIndex}`:"")+"]"),n}saveExpiredSegmentInfo(e,t){const n=t.mediaSequence-e.mediaSequence;if(n>MAX_MEDIA_SEQUENCE_DIFF_FOR_SYNC)videojs.log.warn(`Not saving expired segment info. Media sequence gap ${n} is too large.`);else for(let r=n-1;r>=0;r--){const n=e.segments[r];if(n&&void 0!==n.start){t.syncInfo={mediaSequence:e.mediaSequence+r,time:n.start},this.logger_(`playlist refresh sync: [time:${t.syncInfo.time}, mediaSequence: ${t.syncInfo.mediaSequence}]`),this.trigger("syncinfoupdate");break}}}setDateTimeMappingForStart(e){if(this.timelineToDatetimeMappings={},e.segments&&e.segments.length&&e.segments[0].dateTimeObject){const t=e.segments[0],n=t.dateTimeObject.getTime()/1e3;this.timelineToDatetimeMappings[t.timeline]=-n}}saveSegmentTimingInfo({segmentInfo:e,shouldSaveTimelineMapping:t}){const n=this.calculateSegmentTimeMapping_(e,e.timingInfo,t),r=e.segment;n&&(this.saveDiscontinuitySyncInfo_(e),e.playlist.syncInfo||(e.playlist.syncInfo={mediaSequence:e.playlist.mediaSequence+e.mediaIndex,time:r.start}));const a=r.dateTimeObject;r.discontinuity&&t&&a&&(this.timelineToDatetimeMappings[r.timeline]=-a.getTime()/1e3)}timestampOffsetForTimeline(e){return void 0===this.timelines[e]?null:this.timelines[e].time}mappingForTimeline(e){return void 0===this.timelines[e]?null:this.timelines[e].mapping}calculateSegmentTimeMapping_(e,t,n){const r=e.segment,a=e.part;let i,s,o=this.timelines[e.timeline];if("number"==typeof e.timestampOffset)o={time:e.startOfSegment,mapping:e.startOfSegment-t.start},n&&(this.timelines[e.timeline]=o,this.trigger("timestampoffset"),this.logger_(`time mapping for timeline ${e.timeline}: [time: ${o.time}] [mapping: ${o.mapping}]`)),i=e.startOfSegment,s=t.end+o.mapping;else{if(!o)return!1;i=t.start+o.mapping,s=t.end+o.mapping}return a&&(a.start=i,a.end=s),(!r.start||i<r.start)&&(r.start=i),r.end=s,!0}saveDiscontinuitySyncInfo_(e){const t=e.playlist,n=e.segment;if(n.discontinuity)this.discontinuities[n.timeline]={time:n.start,accuracy:0};else if(t.discontinuityStarts&&t.discontinuityStarts.length)for(let r=0;r<t.discontinuityStarts.length;r++){const a=t.discontinuityStarts[r],i=t.discontinuitySequence+r+1,s=a-e.mediaIndex,o=Math.abs(s);if(!this.discontinuities[i]||this.discontinuities[i].accuracy>o){let r;r=s<0?n.start-sumDurations({defaultDuration:t.targetDuration,durationList:t.segments,startIndex:e.mediaIndex,endIndex:a}):n.end+sumDurations({defaultDuration:t.targetDuration,durationList:t.segments,startIndex:e.mediaIndex+1,endIndex:a}),this.discontinuities[i]={time:r,accuracy:o}}}}dispose(){this.trigger("dispose"),this.off()}}class TimelineChangeController extends videojs.EventTarget{constructor(){super(),this.pendingTimelineChanges_={},this.lastTimelineChanges_={}}clearPendingTimelineChange(e){this.pendingTimelineChanges_[e]=null,this.trigger("pendingtimelinechange")}pendingTimelineChange({type:e,from:t,to:n}){return"number"==typeof t&&"number"==typeof n&&(this.pendingTimelineChanges_[e]={type:e,from:t,to:n},this.trigger("pendingtimelinechange")),this.pendingTimelineChanges_[e]}lastTimelineChange({type:e,from:t,to:n}){return"number"==typeof t&&"number"==typeof n&&(this.lastTimelineChanges_[e]={type:e,from:t,to:n},delete this.pendingTimelineChanges_[e],this.trigger("timelinechange")),this.lastTimelineChanges_[e]}dispose(){this.trigger("dispose"),this.pendingTimelineChanges_={},this.lastTimelineChanges_={},this.off()}}const workerCode=transform(getWorkerString((function(){var e=function(){function e(){this.listeners={}}var t=e.prototype;return t.on=function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)},t.off=function(e,t){if(!this.listeners[e])return!1;var n=this.listeners[e].indexOf(t);return this.listeners[e]=this.listeners[e].slice(0),this.listeners[e].splice(n,1),n>-1},t.trigger=function(e){var t=this.listeners[e];if(t)if(2===arguments.length)for(var n=t.length,r=0;r<n;++r)t[r].call(this,arguments[1]);else for(var a=Array.prototype.slice.call(arguments,1),i=t.length,s=0;s<i;++s)t[s].apply(this,a)},t.dispose=function(){this.listeners={}},t.pipe=function(e){this.on("data",(function(t){e.push(t)}))},e}();
/*! @name pkcs7 @version 1.0.4 @license Apache-2.0 */let t=null;class n{constructor(e){let n,r,a;t||(t=function(){const e=[[[],[],[],[],[]],[[],[],[],[],[]]],t=e[0],n=e[1],r=t[4],a=n[4];let i,s,o;const l=[],u=[];let c,h,d,p,f,m;for(i=0;i<256;i++)u[(l[i]=i<<1^283*(i>>7))^i]=i;for(s=o=0;!r[s];s^=c||1,o=u[o]||1)for(p=o^o<<1^o<<2^o<<3^o<<4,p=p>>8^255&p^99,r[s]=p,a[p]=s,d=l[h=l[c=l[s]]],m=16843009*d^65537*h^257*c^16843008*s,f=257*l[p]^16843008*p,i=0;i<4;i++)t[i][s]=f=f<<24^f>>>8,n[i][p]=m=m<<24^m>>>8;for(i=0;i<5;i++)t[i]=t[i].slice(0),n[i]=n[i].slice(0);return e}()),this._tables=[[t[0][0].slice(),t[0][1].slice(),t[0][2].slice(),t[0][3].slice(),t[0][4].slice()],[t[1][0].slice(),t[1][1].slice(),t[1][2].slice(),t[1][3].slice(),t[1][4].slice()]];const i=this._tables[0][4],s=this._tables[1],o=e.length;let l=1;if(4!==o&&6!==o&&8!==o)throw new Error("Invalid aes key size");const u=e.slice(0),c=[];for(this._key=[u,c],n=o;n<4*o+28;n++)a=u[n-1],(n%o==0||8===o&&n%o==4)&&(a=i[a>>>24]<<24^i[a>>16&255]<<16^i[a>>8&255]<<8^i[255&a],n%o==0&&(a=a<<8^a>>>24^l<<24,l=l<<1^283*(l>>7))),u[n]=u[n-o]^a;for(r=0;n;r++,n--)a=u[3&r?n:n-4],c[r]=n<=4||r<4?a:s[0][i[a>>>24]]^s[1][i[a>>16&255]]^s[2][i[a>>8&255]]^s[3][i[255&a]]}decrypt(e,t,n,r,a,i){const s=this._key[1];let o,l,u,c=e^s[0],h=r^s[1],d=n^s[2],p=t^s[3];const f=s.length/4-2;let m,g=4;const y=this._tables[1],v=y[0],b=y[1],x=y[2],T=y[3],_=y[4];for(m=0;m<f;m++)o=v[c>>>24]^b[h>>16&255]^x[d>>8&255]^T[255&p]^s[g],l=v[h>>>24]^b[d>>16&255]^x[p>>8&255]^T[255&c]^s[g+1],u=v[d>>>24]^b[p>>16&255]^x[c>>8&255]^T[255&h]^s[g+2],p=v[p>>>24]^b[c>>16&255]^x[h>>8&255]^T[255&d]^s[g+3],g+=4,c=o,h=l,d=u;for(m=0;m<4;m++)a[(3&-m)+i]=_[c>>>24]<<24^_[h>>16&255]<<16^_[d>>8&255]<<8^_[255&p]^s[g++],o=c,c=h,h=d,d=p,p=o}}class r extends e{constructor(){super(e),this.jobs=[],this.delay=1,this.timeout_=null}processJob_(){this.jobs.shift()(),this.jobs.length?this.timeout_=setTimeout(this.processJob_.bind(this),this.delay):this.timeout_=null}push(e){this.jobs.push(e),this.timeout_||(this.timeout_=setTimeout(this.processJob_.bind(this),this.delay))}}const a=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24};class i{constructor(e,t,n,s){const o=i.STEP,l=new Int32Array(e.buffer),u=new Uint8Array(e.byteLength);let c=0;for(this.asyncStream_=new r,this.asyncStream_.push(this.decryptChunk_(l.subarray(c,c+o),t,n,u)),c=o;c<l.length;c+=o)n=new Uint32Array([a(l[c-4]),a(l[c-3]),a(l[c-2]),a(l[c-1])]),this.asyncStream_.push(this.decryptChunk_(l.subarray(c,c+o),t,n,u));this.asyncStream_.push((function(){var e;
/*! @name aes-decrypter @version 4.0.1 @license Apache-2.0 */s(null,(e=u).subarray(0,e.byteLength-e[e.byteLength-1]))}))}static get STEP(){return 32e3}decryptChunk_(e,t,r,i){return function(){const s=function(e,t,r){const i=new Int32Array(e.buffer,e.byteOffset,e.byteLength>>2),s=new n(Array.prototype.slice.call(t)),o=new Uint8Array(e.byteLength),l=new Int32Array(o.buffer);let u,c,h,d,p,f,m,g,y;for(u=r[0],c=r[1],h=r[2],d=r[3],y=0;y<i.length;y+=4)p=a(i[y]),f=a(i[y+1]),m=a(i[y+2]),g=a(i[y+3]),s.decrypt(p,f,m,g,l,y),l[y]=a(l[y]^u),l[y+1]=a(l[y+1]^c),l[y+2]=a(l[y+2]^h),l[y+3]=a(l[y+3]^d),u=p,c=f,h=m,d=g;return o}(e,t,r);i.set(s,e.byteOffset)}}}var s,o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};s="undefined"!=typeof window?window:void 0!==o?o:"undefined"!=typeof self?self:{};var l=s.BigInt||Number;l("0x1"),l("0x100"),l("0x10000"),l("0x1000000"),l("0x100000000"),l("0x10000000000"),l("0x1000000000000"),l("0x100000000000000"),l("0x10000000000000000"),function(){var e=new Uint16Array([65484]),t=new Uint8Array(e.buffer,e.byteOffset,e.byteLength);255===t[0]||t[0]}();const u=function(e){const t={};return Object.keys(e).forEach((n=>{const r=e[n];var a;a=r,("function"===ArrayBuffer.isView?ArrayBuffer.isView(a):a&&a.buffer instanceof ArrayBuffer)?t[n]={bytes:r.buffer,byteOffset:r.byteOffset,byteLength:r.byteLength}:t[n]=r})),t};self.onmessage=function(e){const t=e.data,n=new Uint8Array(t.encrypted.bytes,t.encrypted.byteOffset,t.encrypted.byteLength),r=new Uint32Array(t.key.bytes,t.key.byteOffset,t.key.byteLength/4),a=new Uint32Array(t.iv.bytes,t.iv.byteOffset,t.iv.byteLength/4);new i(n,r,a,(function(e,n){self.postMessage(u({source:t.source,decrypted:n}),[n.buffer])}))}})));var Decrypter=factory(workerCode);const audioTrackKind_=e=>{let t=e.default?"main":"alternative";return e.characteristics&&e.characteristics.indexOf("public.accessibility.describes-video")>=0&&(t="main-desc"),t},stopLoaders=(e,t)=>{e.abort(),e.pause(),t&&t.activePlaylistLoader&&(t.activePlaylistLoader.pause(),t.activePlaylistLoader=null)},startLoaders=(e,t)=>{t.activePlaylistLoader=e,e.load()},onGroupChanged=(e,t)=>()=>{const{segmentLoaders:{[e]:n,main:r},mediaTypes:{[e]:a}}=t,i=a.activeTrack(),s=a.getActiveGroup(),o=a.activePlaylistLoader,l=a.lastGroup_;s&&l&&s.id===l.id||(a.lastGroup_=s,a.lastTrack_=i,stopLoaders(n,a),s&&!s.isMainPlaylist&&(s.playlistLoader?(n.resyncLoader(),startLoaders(s.playlistLoader,a)):o&&r.resetEverything()))},onGroupChanging=(e,t)=>()=>{const{segmentLoaders:{[e]:n},mediaTypes:{[e]:r}}=t;r.lastGroup_=null,n.abort(),n.pause()},onTrackChanged=(e,t)=>()=>{const{mainPlaylistLoader:n,segmentLoaders:{[e]:r,main:a},mediaTypes:{[e]:i}}=t,s=i.activeTrack(),o=i.getActiveGroup(),l=i.activePlaylistLoader,u=i.lastTrack_;if((!u||!s||u.id!==s.id)&&(i.lastGroup_=o,i.lastTrack_=s,stopLoaders(r,i),o)){if(o.isMainPlaylist){if(!s||!u||s.id===u.id)return;const e=t.vhs.playlistController_,r=e.selectPlaylist();if(e.media()===r)return;return i.logger_(`track change. Switching main audio from ${u.id} to ${s.id}`),n.pause(),a.resetEverything(),void e.fastQualityChange_(r)}if("AUDIO"===e){if(!o.playlistLoader)return a.setAudio(!0),void a.resetEverything();r.setAudio(!0),a.setAudio(!1)}l!==o.playlistLoader?(r.track&&r.track(s),r.resetEverything(),startLoaders(o.playlistLoader,i)):startLoaders(o.playlistLoader,i)}},onError={AUDIO:(e,t)=>()=>{const{mediaTypes:{[e]:n},excludePlaylist:r}=t,a=n.activeTrack(),i=n.activeGroup(),s=(i.filter((e=>e.default))[0]||i[0]).id,o=n.tracks[s];if(a!==o){videojs.log.warn("Problem encountered loading the alternate audio track.Switching back to default.");for(const e in n.tracks)n.tracks[e].enabled=n.tracks[e]===o;n.onTrackChanged()}else r({error:{message:"Problem encountered loading the default audio track."}})},SUBTITLES:(e,t)=>()=>{const{mediaTypes:{[e]:n}}=t;videojs.log.warn("Problem encountered loading the subtitle track.Disabling subtitle track.");const r=n.activeTrack();r&&(r.mode="disabled"),n.onTrackChanged()}},setupListeners={AUDIO:(e,t,n)=>{if(!t)return;const{tech:r,requestOptions:a,segmentLoaders:{[e]:i}}=n;t.on("loadedmetadata",(()=>{const e=t.media();i.playlist(e,a),(!r.paused()||e.endList&&"none"!==r.preload())&&i.load()})),t.on("loadedplaylist",(()=>{i.playlist(t.media(),a),r.paused()||i.load()})),t.on("error",onError[e](e,n))},SUBTITLES:(e,t,n)=>{const{tech:r,requestOptions:a,segmentLoaders:{[e]:i},mediaTypes:{[e]:s}}=n;t.on("loadedmetadata",(()=>{const e=t.media();i.playlist(e,a),i.track(s.activeTrack()),(!r.paused()||e.endList&&"none"!==r.preload())&&i.load()})),t.on("loadedplaylist",(()=>{i.playlist(t.media(),a),r.paused()||i.load()})),t.on("error",onError[e](e,n))}},initialize={AUDIO:(e,t)=>{const{vhs:n,sourceType:r,segmentLoaders:{[e]:a},requestOptions:i,main:{mediaGroups:s},mediaTypes:{[e]:{groups:o,tracks:l,logger_:u}},mainPlaylistLoader:c}=t,h=isAudioOnly(c.main);s[e]&&0!==Object.keys(s[e]).length||(s[e]={main:{default:{default:!0}}},h&&(s[e].main.default.playlists=c.main.playlists));for(const d in s[e]){o[d]||(o[d]=[]);for(const a in s[e][d]){let p,f=s[e][d][a];if(h?(u(`AUDIO group '${d}' label '${a}' is a main playlist`),f.isMainPlaylist=!0,p=null):p="vhs-json"===r&&f.playlists?new PlaylistLoader(f.playlists[0],n,i):f.resolvedUri?new PlaylistLoader(f.resolvedUri,n,i):f.playlists&&"dash"===r?new DashPlaylistLoader(f.playlists[0],n,i,c):null,f=merge({id:a,playlistLoader:p},f),setupListeners[e](e,f.playlistLoader,t),o[d].push(f),void 0===l[a]){const e=new videojs.AudioTrack({id:a,kind:audioTrackKind_(f),enabled:!1,language:f.language,default:f.default,label:a});l[a]=e}}}a.on("error",onError[e](e,t))},SUBTITLES:(e,t)=>{const{tech:n,vhs:r,sourceType:a,segmentLoaders:{[e]:i},requestOptions:s,main:{mediaGroups:o},mediaTypes:{[e]:{groups:l,tracks:u}},mainPlaylistLoader:c}=t;for(const h in o[e]){l[h]||(l[h]=[]);for(const i in o[e][h]){if(!r.options_.useForcedSubtitles&&o[e][h][i].forced)continue;let d,p=o[e][h][i];if("hls"===a)d=new PlaylistLoader(p.resolvedUri,r,s);else if("dash"===a){if(!p.playlists.filter((e=>e.excludeUntil!==1/0)).length)return;d=new DashPlaylistLoader(p.playlists[0],r,s,c)}else"vhs-json"===a&&(d=new PlaylistLoader(p.playlists?p.playlists[0]:p.resolvedUri,r,s));if(p=merge({id:i,playlistLoader:d},p),setupListeners[e](e,p.playlistLoader,t),l[h].push(p),void 0===u[i]){const e=n.addRemoteTextTrack({id:i,kind:"subtitles",default:p.default&&p.autoselect,language:p.language,label:i},!1).track;u[i]=e}}}i.on("error",onError[e](e,t))},"CLOSED-CAPTIONS":(e,t)=>{const{tech:n,main:{mediaGroups:r},mediaTypes:{[e]:{groups:a,tracks:i}}}=t;for(const s in r[e]){a[s]||(a[s]=[]);for(const t in r[e][s]){const o=r[e][s][t];if(!/^(?:CC|SERVICE)/.test(o.instreamId))continue;const l=n.options_.vhs&&n.options_.vhs.captionServices||{};let u={label:t,language:o.language,instreamId:o.instreamId,default:o.default&&o.autoselect};if(l[u.instreamId]&&(u=merge(u,l[u.instreamId])),void 0===u.default&&delete u.default,a[s].push(merge({id:t},o)),void 0===i[t]){const e=n.addRemoteTextTrack({id:u.instreamId,kind:"captions",default:u.default,language:u.language,label:u.label},!1).track;i[t]=e}}}}},groupMatch=(e,t)=>{for(let n=0;n<e.length;n++){if(playlistMatch(t,e[n]))return!0;if(e[n].playlists&&groupMatch(e[n].playlists,t))return!0}return!1},activeGroup=(e,t)=>n=>{const{mainPlaylistLoader:r,mediaTypes:{[e]:{groups:a}}}=t,i=r.media();if(!i)return null;let s=null;i.attributes[e]&&(s=a[i.attributes[e]]);const o=Object.keys(a);if(!s)if("AUDIO"===e&&o.length>1&&isAudioOnly(t.main))for(let e=0;e<o.length;e++){const t=a[o[e]];if(groupMatch(t,i)){s=t;break}}else a.main?s=a.main:1===o.length&&(s=a[o[0]]);return void 0===n?s:null!==n&&s&&s.filter((e=>e.id===n.id))[0]||null},activeTrack={AUDIO:(e,t)=>()=>{const{mediaTypes:{[e]:{tracks:n}}}=t;for(const e in n)if(n[e].enabled)return n[e];return null},SUBTITLES:(e,t)=>()=>{const{mediaTypes:{[e]:{tracks:n}}}=t;for(const e in n)if("showing"===n[e].mode||"hidden"===n[e].mode)return n[e];return null}},getActiveGroup=(e,{mediaTypes:t})=>()=>{const n=t[e].activeTrack();return n?t[e].activeGroup(n):null},setupMediaGroups=e=>{["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach((t=>{initialize[t](t,e)}));const{mediaTypes:t,mainPlaylistLoader:n,tech:r,vhs:a,segmentLoaders:{AUDIO:i,main:s}}=e;["AUDIO","SUBTITLES"].forEach((n=>{t[n].activeGroup=activeGroup(n,e),t[n].activeTrack=activeTrack[n](n,e),t[n].onGroupChanged=onGroupChanged(n,e),t[n].onGroupChanging=onGroupChanging(n,e),t[n].onTrackChanged=onTrackChanged(n,e),t[n].getActiveGroup=getActiveGroup(n,e)}));const o=t.AUDIO.activeGroup();if(o){const e=(o.filter((e=>e.default))[0]||o[0]).id;t.AUDIO.tracks[e].enabled=!0,t.AUDIO.onGroupChanged(),t.AUDIO.onTrackChanged();t.AUDIO.getActiveGroup().playlistLoader?(s.setAudio(!1),i.setAudio(!0)):s.setAudio(!0)}n.on("mediachange",(()=>{["AUDIO","SUBTITLES"].forEach((e=>t[e].onGroupChanged()))})),n.on("mediachanging",(()=>{["AUDIO","SUBTITLES"].forEach((e=>t[e].onGroupChanging()))}));const l=()=>{t.AUDIO.onTrackChanged(),r.trigger({type:"usage",name:"vhs-audio-change"})};r.audioTracks().addEventListener("change",l),r.remoteTextTracks().addEventListener("change",t.SUBTITLES.onTrackChanged),a.on("dispose",(()=>{r.audioTracks().removeEventListener("change",l),r.remoteTextTracks().removeEventListener("change",t.SUBTITLES.onTrackChanged)})),r.clearTracks("audio");for(const u in t.AUDIO.tracks)r.audioTracks().addTrack(t.AUDIO.tracks[u])},createMediaTypes=()=>{const e={};return["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach((t=>{e[t]={groups:{},tracks:{},activePlaylistLoader:null,activeGroup:noop,activeTrack:noop,getActiveGroup:noop,onGroupChanged:noop,onTrackChanged:noop,lastTrack_:null,logger_:logger(`MediaGroups[${t}]`)}})),e};class SteeringManifest{constructor(){this.priority_=[],this.pathwayClones_=new Map}set version(e){1===e&&(this.version_=e)}set ttl(e){this.ttl_=e||300}set reloadUri(e){e&&(this.reloadUri_=resolveUrl(this.reloadUri_,e))}set priority(e){e&&e.length&&(this.priority_=e)}set pathwayClones(e){e&&e.length&&(this.pathwayClones_=new Map(e.map((e=>[e.ID,e]))))}get version(){return this.version_}get ttl(){return this.ttl_}get reloadUri(){return this.reloadUri_}get priority(){return this.priority_}get pathwayClones(){return this.pathwayClones_}}class ContentSteeringController extends videojs.EventTarget{constructor(e,t){super(),this.currentPathway=null,this.defaultPathway=null,this.queryBeforeStart=!1,this.availablePathways_=new Set,this.steeringManifest=new SteeringManifest,this.proxyServerUrl_=null,this.manifestType_=null,this.ttlTimeout_=null,this.request_=null,this.currentPathwayClones=new Map,this.nextPathwayClones=new Map,this.excludedSteeringManifestURLs=new Set,this.logger_=logger("Content Steering"),this.xhr_=e,this.getBandwidth_=t}assignTagProperties(e,t){this.manifestType_=t.serverUri?"HLS":"DASH";const n=t.serverUri||t.serverURL;if(!n)return this.logger_(`steering manifest URL is ${n}, cannot request steering manifest.`),void this.trigger("error");n.startsWith("data:")?this.decodeDataUriManifest_(n.substring(n.indexOf(",")+1)):(this.steeringManifest.reloadUri=resolveUrl(e,n),this.defaultPathway=t.pathwayId||t.defaultServiceLocation,this.queryBeforeStart=t.queryBeforeStart,this.proxyServerUrl_=t.proxyServerURL,this.defaultPathway&&!this.queryBeforeStart&&this.trigger("content-steering"))}requestSteeringManifest(e){const t=this.steeringManifest.reloadUri;if(!t)return;const n=e?t:this.getRequestURI(t);if(!n)return this.logger_("No valid content steering manifest URIs. Stopping content steering."),this.trigger("error"),void this.dispose();this.request_=this.xhr_({uri:n},((e,t)=>{if(e){if(410===t.status)return this.logger_(`manifest request 410 ${e}.`),this.logger_(`There will be no more content steering requests to ${n} this session.`),void this.excludedSteeringManifestURLs.add(n);if(429===t.status){const n=t.responseHeaders["retry-after"];return this.logger_(`manifest request 429 ${e}.`),this.logger_(`content steering will retry in ${n} seconds.`),void this.startTTLTimeout_(parseInt(n,10))}return this.logger_(`manifest failed to load ${e}.`),void this.startTTLTimeout_()}const r=JSON.parse(this.request_.responseText);this.assignSteeringProperties_(r),this.startTTLTimeout_()}))}setProxyServerUrl_(e){const t=new window$1$1.URL(e),n=new window$1$1.URL(this.proxyServerUrl_);return n.searchParams.set("url",encodeURI(t.toString())),this.setSteeringParams_(n.toString())}decodeDataUriManifest_(e){const t=JSON.parse(window$1$1.atob(e));this.assignSteeringProperties_(t)}setSteeringParams_(e){const t=new window$1$1.URL(e),n=this.getPathway(),r=this.getBandwidth_();if(n){const e=`_${this.manifestType_}_pathway`;t.searchParams.set(e,n)}if(r){const e=`_${this.manifestType_}_throughput`;t.searchParams.set(e,r)}return t.toString()}assignSteeringProperties_(e){if(this.steeringManifest.version=e.VERSION,!this.steeringManifest.version)return this.logger_(`manifest version is ${e.VERSION}, which is not supported.`),void this.trigger("error");this.steeringManifest.ttl=e.TTL,this.steeringManifest.reloadUri=e["RELOAD-URI"],this.steeringManifest.priority=e["PATHWAY-PRIORITY"]||e["SERVICE-LOCATION-PRIORITY"],this.steeringManifest.pathwayClones=e["PATHWAY-CLONES"],this.nextPathwayClones=this.steeringManifest.pathwayClones,this.availablePathways_.size||(this.logger_("There are no available pathways for content steering. Ending content steering."),this.trigger("error"),this.dispose());const t=(e=>{for(const t of e)if(this.availablePathways_.has(t))return t;return[...this.availablePathways_][0]})(this.steeringManifest.priority);this.currentPathway!==t&&(this.currentPathway=t,this.trigger("content-steering"))}getPathway(){return this.currentPathway||this.defaultPathway}getRequestURI(e){if(!e)return null;const t=e=>this.excludedSteeringManifestURLs.has(e);if(this.proxyServerUrl_){const n=this.setProxyServerUrl_(e);if(!t(n))return n}const n=this.setSteeringParams_(e);return t(n)?null:n}startTTLTimeout_(e=this.steeringManifest.ttl){const t=1e3*e;this.ttlTimeout_=window$1$1.setTimeout((()=>{this.requestSteeringManifest()}),t)}clearTTLTimeout_(){window$1$1.clearTimeout(this.ttlTimeout_),this.ttlTimeout_=null}abort(){this.request_&&this.request_.abort(),this.request_=null}dispose(){this.off("content-steering"),this.off("error"),this.abort(),this.clearTTLTimeout_(),this.currentPathway=null,this.defaultPathway=null,this.queryBeforeStart=null,this.proxyServerUrl_=null,this.manifestType_=null,this.ttlTimeout_=null,this.request_=null,this.excludedSteeringManifestURLs=new Set,this.availablePathways_=new Set,this.steeringManifest=new SteeringManifest}addAvailablePathway(e){e&&this.availablePathways_.add(e)}clearAvailablePathways(){this.availablePathways_.clear()}excludePathway(e){return this.availablePathways_.delete(e)}didDASHTagChange(e,t){return!t&&this.steeringManifest.reloadUri||t&&(resolveUrl(e,t.serverURL)!==this.steeringManifest.reloadUri||t.defaultServiceLocation!==this.defaultPathway||t.queryBeforeStart!==this.queryBeforeStart||t.proxyServerURL!==this.proxyServerUrl_)}getAvailablePathways(){return this.availablePathways_}}const ABORT_EARLY_EXCLUSION_SECONDS=10;let Vhs$1;const loaderStats=["mediaRequests","mediaRequestsAborted","mediaRequestsTimedout","mediaRequestsErrored","mediaTransferDuration","mediaBytesTransferred","mediaAppends"],sumLoaderStat=function(e){return this.audioSegmentLoader_[e]+this.mainSegmentLoader_[e]},shouldSwitchToMedia=function({currentPlaylist:e,buffered:t,currentTime:n,nextPlaylist:r,bufferLowWaterLine:a,bufferHighWaterLine:i,duration:s,bufferBasedABR:o,log:l}){if(!r)return videojs.log.warn("We received no playlist to switch to. Please check your stream."),!1;const u=`allowing switch ${e&&e.id||"null"} -> ${r.id}`;if(!e)return l(`${u} as current playlist is not set`),!0;if(r.id===e.id)return!1;const c=Boolean(findRange(t,n).length);if(!e.endList)return c||"number"!=typeof e.partTargetDuration?(l(`${u} as current playlist is live`),!0):(l(`not ${u} as current playlist is live llhls, but currentTime isn't in buffered.`),!1);const h=timeAheadOf(t,n),d=o?Config.EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE:Config.MAX_BUFFER_LOW_WATER_LINE;if(s<d)return l(`${u} as duration < max low water line (${s} < ${d})`),!0;const p=r.attributes.BANDWIDTH,f=e.attributes.BANDWIDTH;if(p<f&&(!o||h<i)){let e=`${u} as next bandwidth < current bandwidth (${p} < ${f})`;return o&&(e+=` and forwardBuffer < bufferHighWaterLine (${h} < ${i})`),l(e),!0}if((!o||p>f)&&h>=a){let e=`${u} as forwardBuffer >= bufferLowWaterLine (${h} >= ${a})`;return o&&(e+=` and next bandwidth > current bandwidth (${p} > ${f})`),l(e),!0}return l(`not ${u} as no switching criteria met`),!1};class PlaylistController extends videojs.EventTarget{constructor(e){super();const{src:t,withCredentials:n,tech:r,bandwidth:a,externVhs:i,useCueTags:s,playlistExclusionDuration:o,enableLowInitialPlaylist:l,sourceType:u,cacheEncryptionKeys:c,bufferBasedABR:h,leastPixelDiffSelector:d,captionServices:p}=e;if(!t)throw new Error("A non-empty playlist URL or JSON manifest string is required");let{maxPlaylistRetries:f}=e;null==f&&(f=1/0),Vhs$1=i,this.bufferBasedABR=Boolean(h),this.leastPixelDiffSelector=Boolean(d),this.withCredentials=n,this.tech_=r,this.vhs_=r.vhs,this.sourceType_=u,this.useCueTags_=s,this.playlistExclusionDuration=o,this.maxPlaylistRetries=f,this.enableLowInitialPlaylist=l,this.useCueTags_&&(this.cueTagsTrack_=this.tech_.addTextTrack("metadata","ad-cues"),this.cueTagsTrack_.inBandMetadataTrackDispatchType=""),this.requestOptions_={withCredentials:n,maxPlaylistRetries:f,timeout:null},this.on("error",this.pauseLoading),this.mediaTypes_=createMediaTypes(),this.mediaSource=new window$1$1.MediaSource,this.handleDurationChange_=this.handleDurationChange_.bind(this),this.handleSourceOpen_=this.handleSourceOpen_.bind(this),this.handleSourceEnded_=this.handleSourceEnded_.bind(this),this.mediaSource.addEventListener("durationchange",this.handleDurationChange_),this.mediaSource.addEventListener("sourceopen",this.handleSourceOpen_),this.mediaSource.addEventListener("sourceended",this.handleSourceEnded_),this.seekable_=createTimeRanges(),this.hasPlayed_=!1,this.syncController_=new SyncController(e),this.segmentMetadataTrack_=r.addRemoteTextTrack({kind:"metadata",label:"segment-metadata"},!1).track,this.decrypter_=new Decrypter,this.sourceUpdater_=new SourceUpdater(this.mediaSource),this.inbandTextTracks_={},this.timelineChangeController_=new TimelineChangeController,this.keyStatusMap_=new Map;const m={vhs:this.vhs_,parse708captions:e.parse708captions,useDtsForTimestampOffset:e.useDtsForTimestampOffset,captionServices:p,mediaSource:this.mediaSource,currentTime:this.tech_.currentTime.bind(this.tech_),seekable:()=>this.seekable(),seeking:()=>this.tech_.seeking(),duration:()=>this.duration(),hasPlayed:()=>this.hasPlayed_,goalBufferLength:()=>this.goalBufferLength(),bandwidth:a,syncController:this.syncController_,decrypter:this.decrypter_,sourceType:this.sourceType_,inbandTextTracks:this.inbandTextTracks_,cacheEncryptionKeys:c,sourceUpdater:this.sourceUpdater_,timelineChangeController:this.timelineChangeController_,exactManifestTimings:e.exactManifestTimings,addMetadataToTextTrack:this.addMetadataToTextTrack.bind(this)};this.mainPlaylistLoader_="dash"===this.sourceType_?new DashPlaylistLoader(t,this.vhs_,merge(this.requestOptions_,{addMetadataToTextTrack:this.addMetadataToTextTrack.bind(this)})):new PlaylistLoader(t,this.vhs_,merge(this.requestOptions_,{addDateRangesToTextTrack:this.addDateRangesToTextTrack_.bind(this)})),this.setupMainPlaylistLoaderListeners_(),this.mainSegmentLoader_=new SegmentLoader(merge(m,{segmentMetadataTrack:this.segmentMetadataTrack_,loaderType:"main"}),e),this.audioSegmentLoader_=new SegmentLoader(merge(m,{loaderType:"audio"}),e),this.subtitleSegmentLoader_=new VTTSegmentLoader(merge(m,{loaderType:"vtt",featuresNativeTextTracks:this.tech_.featuresNativeTextTracks,loadVttJs:()=>new Promise(((e,t)=>{function n(){r.off("vttjserror",a),e()}function a(){r.off("vttjsloaded",n),t()}r.one("vttjsloaded",n),r.one("vttjserror",a),r.addWebVttScript_()}))}),e);this.contentSteeringController_=new ContentSteeringController(this.vhs_.xhr,(()=>this.mainSegmentLoader_.bandwidth)),this.setupSegmentLoaderListeners_(),this.bufferBasedABR&&(this.mainPlaylistLoader_.one("loadedplaylist",(()=>this.startABRTimer_())),this.tech_.on("pause",(()=>this.stopABRTimer_())),this.tech_.on("play",(()=>this.startABRTimer_()))),loaderStats.forEach((e=>{this[e+"_"]=sumLoaderStat.bind(this,e)})),this.logger_=logger("pc"),this.triggeredFmp4Usage=!1,"none"===this.tech_.preload()?(this.loadOnPlay_=()=>{this.loadOnPlay_=null,this.mainPlaylistLoader_.load()},this.tech_.one("play",this.loadOnPlay_)):this.mainPlaylistLoader_.load(),this.timeToLoadedData__=-1,this.mainAppendsToLoadedData__=-1,this.audioAppendsToLoadedData__=-1;const g="none"===this.tech_.preload()?"play":"loadstart";this.tech_.one(g,(()=>{const e=Date.now();this.tech_.one("loadeddata",(()=>{this.timeToLoadedData__=Date.now()-e,this.mainAppendsToLoadedData__=this.mainSegmentLoader_.mediaAppends,this.audioAppendsToLoadedData__=this.audioSegmentLoader_.mediaAppends}))}))}mainAppendsToLoadedData_(){return this.mainAppendsToLoadedData__}audioAppendsToLoadedData_(){return this.audioAppendsToLoadedData__}appendsToLoadedData_(){const e=this.mainAppendsToLoadedData_(),t=this.audioAppendsToLoadedData_();return-1===e||-1===t?-1:e+t}timeToLoadedData_(){return this.timeToLoadedData__}checkABR_(e="abr"){const t=this.selectPlaylist();t&&this.shouldSwitchToMedia_(t)&&this.switchMedia_(t,e)}switchMedia_(e,t,n){const r=this.media(),a=r&&(r.id||r.uri),i=e&&(e.id||e.uri);a&&a!==i&&(this.logger_(`switch media ${a} -> ${i} from ${t}`),this.tech_.trigger({type:"usage",name:`vhs-rendition-change-${t}`})),this.mainPlaylistLoader_.media(e,n)}switchMediaForDASHContentSteering_(){["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach((e=>{const t=this.mediaTypes_[e],n=t?t.activeGroup():null,r=this.contentSteeringController_.getPathway();if(n&&r){const t=(n.length?n[0].playlists:n.playlists).filter((e=>e.attributes.serviceLocation===r));t.length&&this.mediaTypes_[e].activePlaylistLoader.media(t[0])}}))}startABRTimer_(){this.stopABRTimer_(),this.abrTimer_=window$1$1.setInterval((()=>this.checkABR_()),250)}stopABRTimer_(){this.tech_.scrubbing&&this.tech_.scrubbing()||(window$1$1.clearInterval(this.abrTimer_),this.abrTimer_=null)}getAudioTrackPlaylists_(){const e=this.main(),t=e&&e.playlists||[];if(!e||!e.mediaGroups||!e.mediaGroups.AUDIO)return t;const n=e.mediaGroups.AUDIO,r=Object.keys(n);let a;if(Object.keys(this.mediaTypes_.AUDIO.groups).length)a=this.mediaTypes_.AUDIO.activeTrack();else{const e=n.main||r.length&&n[r[0]];for(const t in e)if(e[t].default){a={label:t};break}}if(!a)return t;const i=[];for(const s in n)if(n[s][a.label]){const t=n[s][a.label];if(t.playlists&&t.playlists.length)i.push.apply(i,t.playlists);else if(t.uri)i.push(t);else if(e.playlists.length)for(let n=0;n<e.playlists.length;n++){const t=e.playlists[n];t.attributes&&t.attributes.AUDIO&&t.attributes.AUDIO===s&&i.push(t)}}return i.length?i:t}setupMainPlaylistLoaderListeners_(){this.mainPlaylistLoader_.on("loadedmetadata",(()=>{const e=this.mainPlaylistLoader_.media(),t=1.5*e.targetDuration*1e3;isLowestEnabledRendition(this.mainPlaylistLoader_.main,this.mainPlaylistLoader_.media())?this.requestOptions_.timeout=0:this.requestOptions_.timeout=t,e.endList&&"none"!==this.tech_.preload()&&(this.mainSegmentLoader_.playlist(e,this.requestOptions_),this.mainSegmentLoader_.load()),setupMediaGroups({sourceType:this.sourceType_,segmentLoaders:{AUDIO:this.audioSegmentLoader_,SUBTITLES:this.subtitleSegmentLoader_,main:this.mainSegmentLoader_},tech:this.tech_,requestOptions:this.requestOptions_,mainPlaylistLoader:this.mainPlaylistLoader_,vhs:this.vhs_,main:this.main(),mediaTypes:this.mediaTypes_,excludePlaylist:this.excludePlaylist.bind(this)}),this.triggerPresenceUsage_(this.main(),e),this.setupFirstPlay(),!this.mediaTypes_.AUDIO.activePlaylistLoader||this.mediaTypes_.AUDIO.activePlaylistLoader.media()?this.trigger("selectedinitialmedia"):this.mediaTypes_.AUDIO.activePlaylistLoader.one("loadedmetadata",(()=>{this.trigger("selectedinitialmedia")}))})),this.mainPlaylistLoader_.on("loadedplaylist",(()=>{this.loadOnPlay_&&this.tech_.off("play",this.loadOnPlay_);let e=this.mainPlaylistLoader_.media();if(!e){let t;if(this.attachContentSteeringListeners_(),this.initContentSteeringController_(),this.excludeUnsupportedVariants_(),this.enableLowInitialPlaylist&&(t=this.selectInitialPlaylist()),t||(t=this.selectPlaylist()),!t||!this.shouldSwitchToMedia_(t))return;this.initialMedia_=t,this.switchMedia_(this.initialMedia_,"initial");if(!("vhs-json"===this.sourceType_&&this.initialMedia_.segments))return;e=this.initialMedia_}this.handleUpdatedMediaPlaylist(e)})),this.mainPlaylistLoader_.on("error",(()=>{const e=this.mainPlaylistLoader_.error;this.excludePlaylist({playlistToExclude:e.playlist,error:e})})),this.mainPlaylistLoader_.on("mediachanging",(()=>{this.mainSegmentLoader_.abort(),this.mainSegmentLoader_.pause()})),this.mainPlaylistLoader_.on("mediachange",(()=>{const e=this.mainPlaylistLoader_.media(),t=1.5*e.targetDuration*1e3;isLowestEnabledRendition(this.mainPlaylistLoader_.main,this.mainPlaylistLoader_.media())?this.requestOptions_.timeout=0:this.requestOptions_.timeout=t,"dash"===this.sourceType_&&this.mainPlaylistLoader_.load(),this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.playlist(e,this.requestOptions_),this.waitingForFastQualityPlaylistReceived_?this.runFastQualitySwitch_():this.mainSegmentLoader_.load(),this.tech_.trigger({type:"mediachange",bubbles:!0})})),this.mainPlaylistLoader_.on("playlistunchanged",(()=>{const e=this.mainPlaylistLoader_.media();if("playlist-unchanged"===e.lastExcludeReason_)return;this.stuckAtPlaylistEnd_(e)&&(this.excludePlaylist({error:{message:"Playlist no longer updating.",reason:"playlist-unchanged"}}),this.tech_.trigger("playliststuck"))})),this.mainPlaylistLoader_.on("renditiondisabled",(()=>{this.tech_.trigger({type:"usage",name:"vhs-rendition-disabled"})})),this.mainPlaylistLoader_.on("renditionenabled",(()=>{this.tech_.trigger({type:"usage",name:"vhs-rendition-enabled"})}))}handleUpdatedMediaPlaylist(e){this.useCueTags_&&this.updateAdCues_(e),this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.playlist(e,this.requestOptions_),this.waitingForFastQualityPlaylistReceived_&&this.runFastQualitySwitch_(),this.updateDuration(!e.endList),this.tech_.paused()||(this.mainSegmentLoader_.load(),this.audioSegmentLoader_&&this.audioSegmentLoader_.load())}triggerPresenceUsage_(e,t){const n=e.mediaGroups||{};let r=!0;const a=Object.keys(n.AUDIO);for(const i in n.AUDIO)for(const e in n.AUDIO[i]){n.AUDIO[i][e].uri||(r=!1)}r&&this.tech_.trigger({type:"usage",name:"vhs-demuxed"}),Object.keys(n.SUBTITLES).length&&this.tech_.trigger({type:"usage",name:"vhs-webvtt"}),Vhs$1.Playlist.isAes(t)&&this.tech_.trigger({type:"usage",name:"vhs-aes"}),a.length&&Object.keys(n.AUDIO[a[0]]).length>1&&this.tech_.trigger({type:"usage",name:"vhs-alternate-audio"}),this.useCueTags_&&this.tech_.trigger({type:"usage",name:"vhs-playlist-cue-tags"})}shouldSwitchToMedia_(e){const t=this.mainPlaylistLoader_.media()||this.mainPlaylistLoader_.pendingMedia_,n=this.tech_.currentTime(),r=this.bufferLowWaterLine(),a=this.bufferHighWaterLine(),i=this.tech_.buffered();return shouldSwitchToMedia({buffered:i,currentTime:n,currentPlaylist:t,nextPlaylist:e,bufferLowWaterLine:r,bufferHighWaterLine:a,duration:this.duration(),bufferBasedABR:this.bufferBasedABR,log:this.logger_})}setupSegmentLoaderListeners_(){this.mainSegmentLoader_.on("bandwidthupdate",(()=>{this.checkABR_("bandwidthupdate"),this.tech_.trigger("bandwidthupdate")})),this.mainSegmentLoader_.on("timeout",(()=>{this.bufferBasedABR&&this.mainSegmentLoader_.load()})),this.bufferBasedABR||this.mainSegmentLoader_.on("progress",(()=>{this.trigger("progress")})),this.mainSegmentLoader_.on("error",(()=>{const e=this.mainSegmentLoader_.error();this.excludePlaylist({playlistToExclude:e.playlist,error:e})})),this.mainSegmentLoader_.on("appenderror",(()=>{this.error=this.mainSegmentLoader_.error_,this.trigger("error")})),this.mainSegmentLoader_.on("syncinfoupdate",(()=>{this.onSyncInfoUpdate_()})),this.mainSegmentLoader_.on("timestampoffset",(()=>{this.tech_.trigger({type:"usage",name:"vhs-timestamp-offset"})})),this.audioSegmentLoader_.on("syncinfoupdate",(()=>{this.onSyncInfoUpdate_()})),this.audioSegmentLoader_.on("appenderror",(()=>{this.error=this.audioSegmentLoader_.error_,this.trigger("error")})),this.mainSegmentLoader_.on("ended",(()=>{this.logger_("main segment loader ended"),this.onEndOfStream()})),this.mainSegmentLoader_.on("earlyabort",(e=>{this.bufferBasedABR||(this.delegateLoaders_("all",["abort"]),this.excludePlaylist({error:{message:"Aborted early because there isn't enough bandwidth to complete the request without rebuffering."},playlistExclusionDuration:ABORT_EARLY_EXCLUSION_SECONDS}))}));const e=()=>{if(!this.sourceUpdater_.hasCreatedSourceBuffers())return this.tryToCreateSourceBuffers_();const e=this.getCodecsOrExclude_();e&&this.sourceUpdater_.addOrChangeSourceBuffers(e)};this.mainSegmentLoader_.on("trackinfo",e),this.audioSegmentLoader_.on("trackinfo",e),this.mainSegmentLoader_.on("fmp4",(()=>{this.triggeredFmp4Usage||(this.tech_.trigger({type:"usage",name:"vhs-fmp4"}),this.triggeredFmp4Usage=!0)})),this.audioSegmentLoader_.on("fmp4",(()=>{this.triggeredFmp4Usage||(this.tech_.trigger({type:"usage",name:"vhs-fmp4"}),this.triggeredFmp4Usage=!0)})),this.audioSegmentLoader_.on("ended",(()=>{this.logger_("audioSegmentLoader ended"),this.onEndOfStream()}))}mediaSecondsLoaded_(){return Math.max(this.audioSegmentLoader_.mediaSecondsLoaded+this.mainSegmentLoader_.mediaSecondsLoaded)}load(){this.mainSegmentLoader_.load(),this.mediaTypes_.AUDIO.activePlaylistLoader&&this.audioSegmentLoader_.load(),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&this.subtitleSegmentLoader_.load()}fastQualityChange_(e=this.selectPlaylist()){e&&e===this.mainPlaylistLoader_.media()?this.logger_("skipping fastQualityChange because new media is same as old"):(this.switchMedia_(e,"fast-quality"),this.waitingForFastQualityPlaylistReceived_=!0)}runFastQualitySwitch_(){this.waitingForFastQualityPlaylistReceived_=!1,this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.resetEverything((()=>{this.tech_.setCurrentTime(this.tech_.currentTime())}))}play(){if(this.setupFirstPlay())return;this.tech_.ended()&&this.tech_.setCurrentTime(0),this.hasPlayed_&&this.load();const e=this.tech_.seekable();return this.tech_.duration()===1/0&&this.tech_.currentTime()<e.start(0)?this.tech_.setCurrentTime(e.end(e.length-1)):void 0}setupFirstPlay(){const e=this.mainPlaylistLoader_.media();if(!e||this.tech_.paused()||this.hasPlayed_)return!1;if(!e.endList||e.start){const t=this.seekable();if(!t.length)return!1;const n=t.end(0);let r=n;if(e.start){const a=e.start.timeOffset;r=a<0?Math.max(n+a,t.start(0)):Math.min(n,a)}this.trigger("firstplay"),this.tech_.setCurrentTime(r)}return this.hasPlayed_=!0,this.load(),!0}handleSourceOpen_(){if(this.tryToCreateSourceBuffers_(),this.tech_.autoplay()){const e=this.tech_.play();void 0!==e&&"function"==typeof e.then&&e.then(null,(e=>{}))}this.trigger("sourceopen")}handleSourceEnded_(){if(!this.inbandTextTracks_.metadataTrack_)return;const e=this.inbandTextTracks_.metadataTrack_.cues;if(!e||!e.length)return;const t=this.duration();e[e.length-1].endTime=isNaN(t)||Math.abs(t)===1/0?Number.MAX_VALUE:t}handleDurationChange_(){this.tech_.trigger("durationchange")}onEndOfStream(){let e=this.mainSegmentLoader_.ended_;if(this.mediaTypes_.AUDIO.activePlaylistLoader){const t=this.mainSegmentLoader_.getCurrentMediaInfo_();e=!t||t.hasVideo?e&&this.audioSegmentLoader_.ended_:this.audioSegmentLoader_.ended_}e&&(this.stopABRTimer_(),this.sourceUpdater_.endOfStream())}stuckAtPlaylistEnd_(e){if(!this.seekable().length)return!1;const t=this.syncController_.getExpiredTime(e,this.duration());if(null===t)return!1;const n=Vhs$1.Playlist.playlistEnd(e,t),r=this.tech_.currentTime(),a=this.tech_.buffered();if(!a.length)return n-r<=SAFE_TIME_DELTA;const i=a.end(a.length-1);return i-r<=SAFE_TIME_DELTA&&n-i<=SAFE_TIME_DELTA}excludePlaylist({playlistToExclude:e=this.mainPlaylistLoader_.media(),error:t={},playlistExclusionDuration:n}){if(e=e||this.mainPlaylistLoader_.media(),n=n||t.playlistExclusionDuration||this.playlistExclusionDuration,!e)return this.error=t,void("open"!==this.mediaSource.readyState?this.trigger("error"):this.sourceUpdater_.endOfStream("network"));e.playlistErrors_++;const r=this.mainPlaylistLoader_.main.playlists,a=r.filter(isEnabled),i=1===a.length&&a[0]===e;if(1===r.length&&n!==1/0)return videojs.log.warn(`Problem encountered with playlist ${e.id}. Trying again since it is the only playlist.`),this.tech_.trigger("retryplaylist"),this.mainPlaylistLoader_.load(i);if(i){if(this.main().contentSteering){const t=this.pathwayAttribute_(e),n=1e3*this.contentSteeringController_.steeringManifest.ttl;return this.contentSteeringController_.excludePathway(t),this.excludeThenChangePathway_(),void setTimeout((()=>{this.contentSteeringController_.addAvailablePathway(t)}),n)}let t=!1;r.forEach((n=>{if(n===e)return;const r=n.excludeUntil;void 0!==r&&r!==1/0&&(t=!0,delete n.excludeUntil)})),t&&(videojs.log.warn("Removing other playlists from the exclusion list because the last rendition is about to be excluded."),this.tech_.trigger("retryplaylist"))}let s;s=e.playlistErrors_>this.maxPlaylistRetries?1/0:Date.now()+1e3*n,e.excludeUntil=s,t.reason&&(e.lastExcludeReason_=t.reason),this.tech_.trigger("excludeplaylist"),this.tech_.trigger({type:"usage",name:"vhs-rendition-excluded"});const o=this.selectPlaylist();if(!o)return this.error="Playback cannot continue. No available working or supported playlists.",void this.trigger("error");const l=t.internal?this.logger_:videojs.log.warn,u=t.message?" "+t.message:"";l(`${t.internal?"Internal problem":"Problem"} encountered with playlist ${e.id}.${u} Switching to playlist ${o.id}.`),o.attributes.AUDIO!==e.attributes.AUDIO&&this.delegateLoaders_("audio",["abort","pause"]),o.attributes.SUBTITLES!==e.attributes.SUBTITLES&&this.delegateLoaders_("subtitle",["abort","pause"]),this.delegateLoaders_("main",["abort","pause"]);const c=o.targetDuration/2*1e3||5e3,h="number"==typeof o.lastRequest&&Date.now()-o.lastRequest<=c;return this.switchMedia_(o,"exclude",i||h)}pauseLoading(){this.delegateLoaders_("all",["abort","pause"]),this.stopABRTimer_()}delegateLoaders_(e,t){const n=[],r="all"===e;(r||"main"===e)&&n.push(this.mainPlaylistLoader_);const a=[];(r||"audio"===e)&&a.push("AUDIO"),(r||"subtitle"===e)&&(a.push("CLOSED-CAPTIONS"),a.push("SUBTITLES")),a.forEach((e=>{const t=this.mediaTypes_[e]&&this.mediaTypes_[e].activePlaylistLoader;t&&n.push(t)})),["main","audio","subtitle"].forEach((t=>{const r=this[`${t}SegmentLoader_`];!r||e!==t&&"all"!==e||n.push(r)})),n.forEach((e=>t.forEach((t=>{"function"==typeof e[t]&&e[t]()}))))}setCurrentTime(e){const t=findRange(this.tech_.buffered(),e);return this.mainPlaylistLoader_&&this.mainPlaylistLoader_.media()&&this.mainPlaylistLoader_.media().segments?t&&t.length?e:(this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.resetEverything(),this.mediaTypes_.AUDIO.activePlaylistLoader&&(this.audioSegmentLoader_.pause(),this.audioSegmentLoader_.resetEverything()),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&(this.subtitleSegmentLoader_.pause(),this.subtitleSegmentLoader_.resetEverything()),void this.load()):0}duration(){if(!this.mainPlaylistLoader_)return 0;const e=this.mainPlaylistLoader_.media();return e?e.endList?this.mediaSource?this.mediaSource.duration:Vhs$1.Playlist.duration(e):1/0:0}seekable(){return this.seekable_}onSyncInfoUpdate_(){let e;if(!this.mainPlaylistLoader_)return;let t=this.mainPlaylistLoader_.media();if(!t)return;let n=this.syncController_.getExpiredTime(t,this.duration());if(null===n)return;const r=this.mainPlaylistLoader_.main,a=Vhs$1.Playlist.seekable(t,n,Vhs$1.Playlist.liveEdgeDelay(r,t));if(0===a.length)return;if(this.mediaTypes_.AUDIO.activePlaylistLoader){if(t=this.mediaTypes_.AUDIO.activePlaylistLoader.media(),n=this.syncController_.getExpiredTime(t,this.duration()),null===n)return;if(e=Vhs$1.Playlist.seekable(t,n,Vhs$1.Playlist.liveEdgeDelay(r,t)),0===e.length)return}let i,s;this.seekable_&&this.seekable_.length&&(i=this.seekable_.end(0),s=this.seekable_.start(0)),e?e.start(0)>a.end(0)||a.start(0)>e.end(0)?this.seekable_=a:this.seekable_=createTimeRanges([[e.start(0)>a.start(0)?e.start(0):a.start(0),e.end(0)<a.end(0)?e.end(0):a.end(0)]]):this.seekable_=a,this.seekable_&&this.seekable_.length&&this.seekable_.end(0)===i&&this.seekable_.start(0)===s||(this.logger_(`seekable updated [${printableRange(this.seekable_)}]`),this.tech_.trigger("seekablechanged"))}updateDuration(e){if(this.updateDuration_&&(this.mediaSource.removeEventListener("sourceopen",this.updateDuration_),this.updateDuration_=null),"open"!==this.mediaSource.readyState)return this.updateDuration_=this.updateDuration.bind(this,e),void this.mediaSource.addEventListener("sourceopen",this.updateDuration_);if(e){const e=this.seekable();if(!e.length)return;return void((isNaN(this.mediaSource.duration)||this.mediaSource.duration<e.end(e.length-1))&&this.sourceUpdater_.setDuration(e.end(e.length-1)))}const t=this.tech_.buffered();let n=Vhs$1.Playlist.duration(this.mainPlaylistLoader_.media());t.length>0&&(n=Math.max(n,t.end(t.length-1))),this.mediaSource.duration!==n&&this.sourceUpdater_.setDuration(n)}dispose(){this.trigger("dispose"),this.decrypter_.terminate(),this.mainPlaylistLoader_.dispose(),this.mainSegmentLoader_.dispose(),this.contentSteeringController_.dispose(),this.keyStatusMap_.clear(),this.loadOnPlay_&&this.tech_.off("play",this.loadOnPlay_),["AUDIO","SUBTITLES"].forEach((e=>{const t=this.mediaTypes_[e].groups;for(const n in t)t[n].forEach((e=>{e.playlistLoader&&e.playlistLoader.dispose()}))})),this.audioSegmentLoader_.dispose(),this.subtitleSegmentLoader_.dispose(),this.sourceUpdater_.dispose(),this.timelineChangeController_.dispose(),this.stopABRTimer_(),this.updateDuration_&&this.mediaSource.removeEventListener("sourceopen",this.updateDuration_),this.mediaSource.removeEventListener("durationchange",this.handleDurationChange_),this.mediaSource.removeEventListener("sourceopen",this.handleSourceOpen_),this.mediaSource.removeEventListener("sourceended",this.handleSourceEnded_),this.off()}main(){return this.mainPlaylistLoader_.main}media(){return this.mainPlaylistLoader_.media()||this.initialMedia_}areMediaTypesKnown_(){const e=!!this.mediaTypes_.AUDIO.activePlaylistLoader,t=!!this.mainSegmentLoader_.getCurrentMediaInfo_(),n=!e||!!this.audioSegmentLoader_.getCurrentMediaInfo_();return!(!t||!n)}getCodecsOrExclude_(){const e={main:this.mainSegmentLoader_.getCurrentMediaInfo_()||{},audio:this.audioSegmentLoader_.getCurrentMediaInfo_()||{}},t=this.mainSegmentLoader_.getPendingSegmentPlaylist()||this.media();e.video=e.main;const n=codecsForPlaylist(this.main(),t),r={},a=!!this.mediaTypes_.AUDIO.activePlaylistLoader;if(e.main.hasVideo&&(r.video=n.video||e.main.videoCodec||DEFAULT_VIDEO_CODEC),e.main.isMuxed&&(r.video+=`,${n.audio||e.main.audioCodec||DEFAULT_AUDIO_CODEC}`),(e.main.hasAudio&&!e.main.isMuxed||e.audio.hasAudio||a)&&(r.audio=n.audio||e.main.audioCodec||e.audio.audioCodec||DEFAULT_AUDIO_CODEC,e.audio.isFmp4=e.main.hasAudio&&!e.main.isMuxed?e.main.isFmp4:e.audio.isFmp4),!r.audio&&!r.video)return void this.excludePlaylist({playlistToExclude:t,error:{message:"Could not determine codecs for playlist."},playlistExclusionDuration:1/0});const i={};let s;if(["video","audio"].forEach((function(t){if(r.hasOwnProperty(t)&&(n=e[t].isFmp4,a=r[t],!(n?browserSupportsCodec(a):muxerSupportsCodec(a)))){const n=e[t].isFmp4?"browser":"muxer";i[n]=i[n]||[],i[n].push(r[t]),"audio"===t&&(s=n)}var n,a})),a&&s&&t.attributes.AUDIO){const e=t.attributes.AUDIO;this.main().playlists.forEach((n=>{(n.attributes&&n.attributes.AUDIO)===e&&n!==t&&(n.excludeUntil=1/0)})),this.logger_(`excluding audio group ${e} as ${s} does not support codec(s): "${r.audio}"`)}if(!Object.keys(i).length){if(this.sourceUpdater_.hasCreatedSourceBuffers()&&!this.sourceUpdater_.canChangeType()){const e=[];if(["video","audio"].forEach((t=>{const n=(parseCodecs(this.sourceUpdater_.codecs[t]||"")[0]||{}).type,a=(parseCodecs(r[t]||"")[0]||{}).type;n&&a&&n.toLowerCase()!==a.toLowerCase()&&e.push(`"${this.sourceUpdater_.codecs[t]}" -> "${r[t]}"`)})),e.length)return void this.excludePlaylist({playlistToExclude:t,error:{message:`Codec switching not supported: ${e.join(", ")}.`,internal:!0},playlistExclusionDuration:1/0})}return r}{const e=Object.keys(i).reduce(((e,t)=>(e&&(e+=", "),e+=`${t} does not support codec(s): "${i[t].join(",")}"`)),"")+".";this.excludePlaylist({playlistToExclude:t,error:{internal:!0,message:e},playlistExclusionDuration:1/0})}}tryToCreateSourceBuffers_(){if("open"!==this.mediaSource.readyState||this.sourceUpdater_.hasCreatedSourceBuffers())return;if(!this.areMediaTypesKnown_())return;const e=this.getCodecsOrExclude_();if(!e)return;this.sourceUpdater_.createSourceBuffers(e);const t=[e.video,e.audio].filter(Boolean).join(",");this.excludeIncompatibleVariants_(t)}excludeUnsupportedVariants_(){const e=this.main().playlists,t=[];Object.keys(e).forEach((n=>{const r=e[n];if(-1!==t.indexOf(r.id))return;t.push(r.id);const a=codecsForPlaylist(this.main,r),i=[];!a.audio||muxerSupportsCodec(a.audio)||browserSupportsCodec(a.audio)||i.push(`audio codec ${a.audio}`),!a.video||muxerSupportsCodec(a.video)||browserSupportsCodec(a.video)||i.push(`video codec ${a.video}`),a.text&&"stpp.ttml.im1t"===a.text&&i.push(`text codec ${a.text}`),i.length&&(r.excludeUntil=1/0,this.logger_(`excluding ${r.id} for unsupported: ${i.join(", ")}`))}))}excludeIncompatibleVariants_(e){const t=[],n=this.main().playlists,r=unwrapCodecList(parseCodecs(e)),a=codecCount(r),i=r.video&&parseCodecs(r.video)[0]||null,s=r.audio&&parseCodecs(r.audio)[0]||null;Object.keys(n).forEach((e=>{const r=n[e];if(-1!==t.indexOf(r.id)||r.excludeUntil===1/0)return;t.push(r.id);const o=[],l=codecsForPlaylist(this.mainPlaylistLoader_.main,r),u=codecCount(l);if(l.audio||l.video){if(u!==a&&o.push(`codec count "${u}" !== "${a}"`),!this.sourceUpdater_.canChangeType()){const e=l.video&&parseCodecs(l.video)[0]||null,t=l.audio&&parseCodecs(l.audio)[0]||null;e&&i&&e.type.toLowerCase()!==i.type.toLowerCase()&&o.push(`video codec "${e.type}" !== "${i.type}"`),t&&s&&t.type.toLowerCase()!==s.type.toLowerCase()&&o.push(`audio codec "${t.type}" !== "${s.type}"`)}o.length&&(r.excludeUntil=1/0,this.logger_(`excluding ${r.id}: ${o.join(" && ")}`))}}))}updateAdCues_(e){let t=0;const n=this.seekable();n.length&&(t=n.start(0)),updateAdCues(e,this.cueTagsTrack_,t)}goalBufferLength(){const e=this.tech_.currentTime(),t=Config.GOAL_BUFFER_LENGTH,n=Config.GOAL_BUFFER_LENGTH_RATE,r=Math.max(t,Config.MAX_GOAL_BUFFER_LENGTH);return Math.min(t+e*n,r)}bufferLowWaterLine(){const e=this.tech_.currentTime(),t=Config.BUFFER_LOW_WATER_LINE,n=Config.BUFFER_LOW_WATER_LINE_RATE,r=Math.max(t,Config.MAX_BUFFER_LOW_WATER_LINE),a=Math.max(t,Config.EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE);return Math.min(t+e*n,this.bufferBasedABR?a:r)}bufferHighWaterLine(){return Config.BUFFER_HIGH_WATER_LINE}addDateRangesToTextTrack_(e){createMetadataTrackIfNotExists(this.inbandTextTracks_,"com.apple.streaming",this.tech_),addDateRangeMetadata({inbandTextTracks:this.inbandTextTracks_,dateRanges:e})}addMetadataToTextTrack(e,t,n){const r=this.sourceUpdater_.videoBuffer?this.sourceUpdater_.videoTimestampOffset():this.sourceUpdater_.audioTimestampOffset();createMetadataTrackIfNotExists(this.inbandTextTracks_,e,this.tech_),addMetadata({inbandTextTracks:this.inbandTextTracks_,metadataArray:t,timestampOffset:r,videoDuration:n})}pathwayAttribute_(e){return e.attributes["PATHWAY-ID"]||e.attributes.serviceLocation}initContentSteeringController_(){const e=this.main();if(e.contentSteering){for(const t of e.playlists)this.contentSteeringController_.addAvailablePathway(this.pathwayAttribute_(t));this.contentSteeringController_.assignTagProperties(e.uri,e.contentSteering),this.contentSteeringController_.queryBeforeStart?this.contentSteeringController_.requestSteeringManifest(!0):this.tech_.one("canplay",(()=>{this.contentSteeringController_.requestSteeringManifest()}))}}resetContentSteeringController_(){this.contentSteeringController_.clearAvailablePathways(),this.contentSteeringController_.dispose(),this.initContentSteeringController_()}attachContentSteeringListeners_(){this.contentSteeringController_.on("content-steering",this.excludeThenChangePathway_.bind(this)),"dash"===this.sourceType_&&this.mainPlaylistLoader_.on("loadedplaylist",(()=>{const e=this.main();(this.contentSteeringController_.didDASHTagChange(e.uri,e.contentSteering)||(()=>{const t=this.contentSteeringController_.getAvailablePathways(),n=[];for(const r of e.playlists){const e=r.attributes.serviceLocation;if(e&&(n.push(e),!t.has(e)))return!0}return!(n.length||!t.size)})())&&this.resetContentSteeringController_()}))}excludeThenChangePathway_(){const e=this.contentSteeringController_.getPathway();if(!e)return;this.handlePathwayClones_();const t=this.main().playlists,n=new Set;let r=!1;Object.keys(t).forEach((a=>{const i=t[a],s=this.pathwayAttribute_(i),o=s&&e!==s;i.excludeUntil===1/0&&"content-steering"===i.lastExcludeReason_&&!o&&(delete i.excludeUntil,delete i.lastExcludeReason_,r=!0);const l=!i.excludeUntil&&i.excludeUntil!==1/0;!n.has(i.id)&&o&&l&&(n.add(i.id),i.excludeUntil=1/0,i.lastExcludeReason_="content-steering",this.logger_(`excluding ${i.id} for ${i.lastExcludeReason_}`))})),"DASH"===this.contentSteeringController_.manifestType_&&Object.keys(this.mediaTypes_).forEach((t=>{const n=this.mediaTypes_[t];if(n.activePlaylistLoader){const t=n.activePlaylistLoader.media_;t&&t.attributes.serviceLocation!==e&&(r=!0)}})),r&&this.changeSegmentPathway_()}handlePathwayClones_(){const e=this.main().playlists,t=this.contentSteeringController_.currentPathwayClones,n=this.contentSteeringController_.nextPathwayClones;if(t&&t.size||n&&n.size){for(const[e,r]of t.entries()){n.get(e)||(this.mainPlaylistLoader_.updateOrDeleteClone(r),this.contentSteeringController_.excludePathway(e))}for(const[r,a]of n.entries()){const n=t.get(r);if(n)this.equalPathwayClones_(n,a)||(this.mainPlaylistLoader_.updateOrDeleteClone(a,!0),this.contentSteeringController_.addAvailablePathway(r));else{e.filter((e=>e.attributes["PATHWAY-ID"]===a["BASE-ID"])).forEach((e=>{this.mainPlaylistLoader_.addClonePathway(a,e)})),this.contentSteeringController_.addAvailablePathway(r)}}this.contentSteeringController_.currentPathwayClones=new Map(JSON.parse(JSON.stringify([...n])))}}equalPathwayClones_(e,t){if(e["BASE-ID"]!==t["BASE-ID"]||e.ID!==t.ID||e["URI-REPLACEMENT"].HOST!==t["URI-REPLACEMENT"].HOST)return!1;const n=e["URI-REPLACEMENT"].PARAMS,r=t["URI-REPLACEMENT"].PARAMS;for(const a in n)if(n[a]!==r[a])return!1;for(const a in r)if(n[a]!==r[a])return!1;return!0}changeSegmentPathway_(){const e=this.selectPlaylist();this.pauseLoading(),"DASH"===this.contentSteeringController_.manifestType_&&this.switchMediaForDASHContentSteering_(),this.switchMedia_(e,"content-steering")}excludeNonUsablePlaylistsByKeyId_(){if(!this.mainPlaylistLoader_||!this.mainPlaylistLoader_.main)return;let e=0;const t="non-usable";this.mainPlaylistLoader_.main.playlists.forEach((n=>{const r=this.mainPlaylistLoader_.getKeyIdSet(n);r&&r.size&&r.forEach((r=>{const a="usable",i=this.keyStatusMap_.has(r)&&this.keyStatusMap_.get(r)===a,s=n.lastExcludeReason_===t&&n.excludeUntil===1/0;i?i&&s&&(delete n.excludeUntil,delete n.lastExcludeReason_,this.logger_(`enabling playlist ${n.id} because key ID ${r} is ${a}`)):(n.excludeUntil!==1/0&&n.lastExcludeReason_!==t&&(n.excludeUntil=1/0,n.lastExcludeReason_=t,this.logger_(`excluding playlist ${n.id} because the key ID ${r} doesn't exist in the keyStatusMap or is not ${a}`)),e++)}))})),e>=this.mainPlaylistLoader_.main.playlists.length&&this.mainPlaylistLoader_.main.playlists.forEach((e=>{const n=e&&e.attributes&&e.attributes.RESOLUTION&&e.attributes.RESOLUTION.height<720,r=e.excludeUntil===1/0&&e.lastExcludeReason_===t;n&&r&&(delete e.excludeUntil,videojs.log.warn(`enabling non-HD playlist ${e.id} because all playlists were excluded due to ${t} key IDs`))}))}addKeyStatus_(e,t){const n=("string"==typeof e?e:bufferToHexString(e)).slice(0,32).toLowerCase();this.logger_(`KeyStatus '${t}' with key ID ${n} added to the keyStatusMap`),this.keyStatusMap_.set(n,t)}updatePlaylistByKeyStatus(e,t){this.addKeyStatus_(e,t),this.waitingForFastQualityPlaylistReceived_||this.excludeNonUsableThenChangePlaylist_(),this.mainPlaylistLoader_.off("loadedplaylist",this.excludeNonUsableThenChangePlaylist_.bind(this)),this.mainPlaylistLoader_.on("loadedplaylist",this.excludeNonUsableThenChangePlaylist_.bind(this))}excludeNonUsableThenChangePlaylist_(){this.excludeNonUsablePlaylistsByKeyId_(),this.fastQualityChange_()}}const enableFunction=(e,t,n)=>r=>{const a=e.main.playlists[t],i=isIncompatible(a),s=isEnabled(a);return void 0===r?s:(r?delete a.disabled:a.disabled=!0,r===s||i||(n(),r?e.trigger("renditionenabled"):e.trigger("renditiondisabled")),r)};class Representation{constructor(e,t,n){const{playlistController_:r}=e,a=r.fastQualityChange_.bind(r);if(t.attributes){const e=t.attributes.RESOLUTION;this.width=e&&e.width,this.height=e&&e.height,this.bandwidth=t.attributes.BANDWIDTH,this.frameRate=t.attributes["FRAME-RATE"]}this.codecs=codecsForPlaylist(r.main(),t),this.playlist=t,this.id=n,this.enabled=enableFunction(e.playlists,t.id,a)}}const renditionSelectionMixin=function(e){e.representations=()=>{const t=e.playlistController_.main(),n=isAudioOnly(t)?e.playlistController_.getAudioTrackPlaylists_():t.playlists;return n?n.filter((e=>!isIncompatible(e))).map(((t,n)=>new Representation(e,t,t.id))):[]}},timerCancelEvents=["seeking","seeked","pause","playing","error"];class PlaybackWatcher{constructor(e){this.playlistController_=e.playlistController,this.tech_=e.tech,this.seekable=e.seekable,this.allowSeeksWithinUnsafeLiveWindow=e.allowSeeksWithinUnsafeLiveWindow,this.liveRangeSafeTimeDelta=e.liveRangeSafeTimeDelta,this.media=e.media,this.consecutiveUpdates=0,this.lastRecordedTime=null,this.checkCurrentTimeTimeout_=null,this.logger_=logger("PlaybackWatcher"),this.logger_("initialize");const t=()=>this.monitorCurrentTime_(),n=()=>this.monitorCurrentTime_(),r=()=>this.techWaiting_(),a=()=>this.resetTimeUpdate_(),i=this.playlistController_,s=["main","subtitle","audio"],o={};s.forEach((e=>{o[e]={reset:()=>this.resetSegmentDownloads_(e),updateend:()=>this.checkSegmentDownloads_(e)},i[`${e}SegmentLoader_`].on("appendsdone",o[e].updateend),i[`${e}SegmentLoader_`].on("playlistupdate",o[e].reset),this.tech_.on(["seeked","seeking"],o[e].reset)}));const l=e=>{["main","audio"].forEach((t=>{i[`${t}SegmentLoader_`][e]("appended",this.seekingAppendCheck_)}))};this.seekingAppendCheck_=()=>{this.fixesBadSeeks_()&&(this.consecutiveUpdates=0,this.lastRecordedTime=this.tech_.currentTime(),l("off"))},this.clearSeekingAppendCheck_=()=>l("off"),this.watchForBadSeeking_=()=>{this.clearSeekingAppendCheck_(),l("on")},this.tech_.on("seeked",this.clearSeekingAppendCheck_),this.tech_.on("seeking",this.watchForBadSeeking_),this.tech_.on("waiting",r),this.tech_.on(timerCancelEvents,a),this.tech_.on("canplay",n),this.tech_.one("play",t),this.dispose=()=>{this.clearSeekingAppendCheck_(),this.logger_("dispose"),this.tech_.off("waiting",r),this.tech_.off(timerCancelEvents,a),this.tech_.off("canplay",n),this.tech_.off("play",t),this.tech_.off("seeking",this.watchForBadSeeking_),this.tech_.off("seeked",this.clearSeekingAppendCheck_),s.forEach((e=>{i[`${e}SegmentLoader_`].off("appendsdone",o[e].updateend),i[`${e}SegmentLoader_`].off("playlistupdate",o[e].reset),this.tech_.off(["seeked","seeking"],o[e].reset)})),this.checkCurrentTimeTimeout_&&window$1$1.clearTimeout(this.checkCurrentTimeTimeout_),this.resetTimeUpdate_()}}monitorCurrentTime_(){this.checkCurrentTime_(),this.checkCurrentTimeTimeout_&&window$1$1.clearTimeout(this.checkCurrentTimeTimeout_),this.checkCurrentTimeTimeout_=window$1$1.setTimeout(this.monitorCurrentTime_.bind(this),250)}resetSegmentDownloads_(e){const t=this.playlistController_[`${e}SegmentLoader_`];this[`${e}StalledDownloads_`]>0&&this.logger_(`resetting possible stalled download count for ${e} loader`),this[`${e}StalledDownloads_`]=0,this[`${e}Buffered_`]=t.buffered_()}checkSegmentDownloads_(e){const t=this.playlistController_,n=t[`${e}SegmentLoader_`],r=n.buffered_(),a=isRangeDifferent(this[`${e}Buffered_`],r);this[`${e}Buffered_`]=r,a?this.resetSegmentDownloads_(e):(this[`${e}StalledDownloads_`]++,this.logger_(`found #${this[`${e}StalledDownloads_`]} ${e} appends that did not increase buffer (possible stalled download)`,{playlistId:n.playlist_&&n.playlist_.id,buffered:timeRangesToArray(r)}),this[`${e}StalledDownloads_`]<10||(this.logger_(`${e} loader stalled download exclusion`),this.resetSegmentDownloads_(e),this.tech_.trigger({type:"usage",name:`vhs-${e}-download-exclusion`}),"subtitle"!==e&&t.excludePlaylist({error:{message:`Excessive ${e} segment downloading detected.`},playlistExclusionDuration:1/0})))}checkCurrentTime_(){if(this.tech_.paused()||this.tech_.seeking())return;const e=this.tech_.currentTime(),t=this.tech_.buffered();if(this.lastRecordedTime===e&&(!t.length||e+SAFE_TIME_DELTA>=t.end(t.length-1)))return this.techWaiting_();this.consecutiveUpdates>=5&&e===this.lastRecordedTime?(this.consecutiveUpdates++,this.waiting_()):e===this.lastRecordedTime?this.consecutiveUpdates++:(this.consecutiveUpdates=0,this.lastRecordedTime=e)}resetTimeUpdate_(){this.consecutiveUpdates=0}fixesBadSeeks_(){if(!this.tech_.seeking())return!1;const e=this.seekable(),t=this.tech_.currentTime();let n;if(this.afterSeekableWindow_(e,t,this.media(),this.allowSeeksWithinUnsafeLiveWindow)){n=e.end(e.length-1)}if(this.beforeSeekableWindow_(e,t)){const t=e.start(0);n=t+(t===e.end(0)?0:SAFE_TIME_DELTA)}if(void 0!==n)return this.logger_(`Trying to seek outside of seekable at time ${t} with seekable range ${printableRange(e)}. Seeking to ${n}.`),this.tech_.setCurrentTime(n),!0;const r=this.playlistController_.sourceUpdater_,a=this.tech_.buffered(),i=r.audioBuffer?r.audioBuffered():null,s=r.videoBuffer?r.videoBuffered():null,o=this.media(),l=o.partTargetDuration?o.partTargetDuration:2*(o.targetDuration-TIME_FUDGE_FACTOR),u=[i,s];for(let h=0;h<u.length;h++){if(!u[h])continue;if(timeAheadOf(u[h],t)<l)return!1}const c=findNextRange(a,t);return 0!==c.length&&(n=c.start(0)+SAFE_TIME_DELTA,this.logger_(`Buffered region starts (${c.start(0)})  just beyond seek point (${t}). Seeking to ${n}.`),this.tech_.setCurrentTime(n),!0)}waiting_(){if(this.techWaiting_())return;const e=this.tech_.currentTime(),t=this.tech_.buffered(),n=findRange(t,e);return n.length&&e+3<=n.end(0)?(this.resetTimeUpdate_(),this.tech_.setCurrentTime(e),this.logger_(`Stopped at ${e} while inside a buffered region [${n.start(0)} -> ${n.end(0)}]. Attempting to resume playback by seeking to the current time.`),void this.tech_.trigger({type:"usage",name:"vhs-unknown-waiting"})):void 0}techWaiting_(){const e=this.seekable(),t=this.tech_.currentTime();if(this.tech_.seeking())return!0;if(this.beforeSeekableWindow_(e,t)){const n=e.end(e.length-1);return this.logger_(`Fell out of live window at time ${t}. Seeking to live point (seekable end) ${n}`),this.resetTimeUpdate_(),this.tech_.setCurrentTime(n),this.tech_.trigger({type:"usage",name:"vhs-live-resync"}),!0}const n=this.tech_.vhs.playlistController_.sourceUpdater_,r=this.tech_.buffered();if(this.videoUnderflow_({audioBuffered:n.audioBuffered(),videoBuffered:n.videoBuffered(),currentTime:t}))return this.resetTimeUpdate_(),this.tech_.setCurrentTime(t),this.tech_.trigger({type:"usage",name:"vhs-video-underflow"}),!0;const a=findNextRange(r,t);return a.length>0&&(this.logger_(`Stopped at ${t} and seeking to ${a.start(0)}`),this.resetTimeUpdate_(),this.skipTheGap_(t),!0)}afterSeekableWindow_(e,t,n,r=!1){if(!e.length)return!1;let a=e.end(e.length-1)+SAFE_TIME_DELTA;const i=!n.endList,s="number"==typeof n.partTargetDuration;return i&&(s||r)&&(a=e.end(e.length-1)+3*n.targetDuration),t>a}beforeSeekableWindow_(e,t){return!!(e.length&&e.start(0)>0&&t<e.start(0)-this.liveRangeSafeTimeDelta)}videoUnderflow_({videoBuffered:e,audioBuffered:t,currentTime:n}){if(!e)return;let r;if(e.length&&t.length){const a=findRange(e,n-3),i=findRange(e,n),s=findRange(t,n);s.length&&!i.length&&a.length&&(r={start:a.end(0),end:s.end(0)})}else{findNextRange(e,n).length||(r=this.gapFromVideoUnderflow_(e,n))}return!!r&&(this.logger_(`Encountered a gap in video from ${r.start} to ${r.end}. Seeking to current time ${n}`),!0)}skipTheGap_(e){const t=this.tech_.buffered(),n=this.tech_.currentTime(),r=findNextRange(t,n);this.resetTimeUpdate_(),0!==r.length&&n===e&&(this.logger_("skipTheGap_:","currentTime:",n,"scheduled currentTime:",e,"nextRange start:",r.start(0)),this.tech_.setCurrentTime(r.start(0)+TIME_FUDGE_FACTOR),this.tech_.trigger({type:"usage",name:"vhs-gap-skip"}))}gapFromVideoUnderflow_(e,t){const n=findGaps(e);for(let r=0;r<n.length;r++){const e=n.start(r),a=n.end(r);if(t-e<4&&t-e>2)return{start:e,end:a}}return null}}const defaultOptions={errorInterval:30,getSource(e){return e(this.tech({IWillNotUseThisInPlugins:!0}).currentSource_||this.currentSource())}},initPlugin=function(e,t){let n=0,r=0;const a=merge(defaultOptions,t);e.ready((()=>{e.trigger({type:"usage",name:"vhs-error-reload-initialized"})}));const i=function(){r&&e.currentTime(r)},s=function(t){null!=t&&(r=e.duration()!==1/0&&e.currentTime()||0,e.one("loadedmetadata",i),e.src(t),e.trigger({type:"usage",name:"vhs-error-reload"}),e.play())},o=function(){if(Date.now()-n<1e3*a.errorInterval)e.trigger({type:"usage",name:"vhs-error-reload-canceled"});else{if(a.getSource&&"function"==typeof a.getSource)return n=Date.now(),a.getSource.call(e,s);videojs.log.error("ERROR: reloadSourceOnError - The option getSource must be a function!")}},l=function(){e.off("loadedmetadata",i),e.off("error",o),e.off("dispose",l)};e.on("error",o),e.on("dispose",l),e.reloadSourceOnError=function(t){l(),initPlugin(e,t)}},reloadSourceOnError=function(e){initPlugin(this,e)};var version$4="3.10.0",version$3="7.0.2",version$2="1.3.0",version$1="7.1.0",version="4.0.1";const Vhs={PlaylistLoader:PlaylistLoader,Playlist:Playlist,utils:utils,STANDARD_PLAYLIST_SELECTOR:lastBandwidthSelector,INITIAL_PLAYLIST_SELECTOR:lowestBitrateCompatibleVariantSelector,lastBandwidthSelector:lastBandwidthSelector,movingAverageBandwidthSelector:movingAverageBandwidthSelector,comparePlaylistBandwidth:comparePlaylistBandwidth,comparePlaylistResolution:comparePlaylistResolution,xhr:xhrFactory()};Object.keys(Config).forEach((e=>{Object.defineProperty(Vhs,e,{get:()=>(videojs.log.warn(`using Vhs.${e} is UNSAFE be sure you know what you are doing`),Config[e]),set(t){videojs.log.warn(`using Vhs.${e} is UNSAFE be sure you know what you are doing`),"number"!=typeof t||t<0?videojs.log.warn(`value of Vhs.${e} must be greater than or equal to 0`):Config[e]=t}})}));const LOCAL_STORAGE_KEY="videojs-vhs",handleVhsMediaChange=function(e,t){const n=t.media();let r=-1;for(let a=0;a<e.length;a++)if(e[a].id===n.id){r=a;break}e.selectedIndex_=r,e.trigger({selectedIndex:r,type:"change"})},handleVhsLoadedMetadata=function(e,t){t.representations().forEach((t=>{e.addQualityLevel(t)})),handleVhsMediaChange(e,t.playlists)};Vhs.canPlaySource=function(){return videojs.log.warn("VHS is no longer a tech. Please remove it from your player's techOrder.")};const emeKeySystems=(e,t,n)=>{if(!e)return e;let r={};t&&t.attributes&&t.attributes.CODECS&&(r=unwrapCodecList(parseCodecs(t.attributes.CODECS))),n&&n.attributes&&n.attributes.CODECS&&(r.audio=n.attributes.CODECS);const a=getMimeForCodec(r.video),i=getMimeForCodec(r.audio),s={};for(const o in e)s[o]={},i&&(s[o].audioContentType=i),a&&(s[o].videoContentType=a),t.contentProtection&&t.contentProtection[o]&&t.contentProtection[o].pssh&&(s[o].pssh=t.contentProtection[o].pssh),"string"==typeof e[o]&&(s[o].url=e[o]);return merge(e,s)},getAllPsshKeySystemsOptions=(e,t)=>e.reduce(((e,n)=>{if(!n.contentProtection)return e;const r=t.reduce(((e,t)=>{const r=n.contentProtection[t];return r&&r.pssh&&(e[t]={pssh:r.pssh}),e}),{});return Object.keys(r).length&&e.push(r),e}),[]),waitForKeySessionCreation=({player:e,sourceKeySystems:t,audioMedia:n,mainPlaylists:r})=>{if(!e.eme.initializeMediaKeys)return Promise.resolve();const a=n?r.concat([n]):r,i=getAllPsshKeySystemsOptions(a,Object.keys(t)),s=[],o=[];return i.forEach((t=>{o.push(new Promise(((t,n)=>{e.tech_.one("keysessioncreated",t)}))),s.push(new Promise(((n,r)=>{e.eme.initializeMediaKeys({keySystems:t},(e=>{e?r(e):n()}))})))})),Promise.race([Promise.all(s),Promise.race(o)])},setupEmeOptions=({player:e,sourceKeySystems:t,media:n,audioMedia:r})=>{const a=emeKeySystems(t,n,r);return!!a&&(e.currentSource().keySystems=a,!(a&&!e.eme)||(videojs.log.warn("DRM encrypted source cannot be decrypted without a DRM plugin"),!1))},getVhsLocalStorage=()=>{if(!window$1$1.localStorage)return null;const e=window$1$1.localStorage.getItem(LOCAL_STORAGE_KEY);if(!e)return null;try{return JSON.parse(e)}catch(e2){return null}},updateVhsLocalStorage=e=>{if(!window$1$1.localStorage)return!1;let t=getVhsLocalStorage();t=t?merge(t,e):e;try{window$1$1.localStorage.setItem(LOCAL_STORAGE_KEY,JSON.stringify(t))}catch(e2){return!1}return t},expandDataUri=e=>0===e.toLowerCase().indexOf("data:application/vnd.videojs.vhs+json,")?JSON.parse(e.substring(e.indexOf(",")+1)):e,addOnRequestHook=(e,t)=>{e._requestCallbackSet||(e._requestCallbackSet=new Set),e._requestCallbackSet.add(t)},addOnResponseHook=(e,t)=>{e._responseCallbackSet||(e._responseCallbackSet=new Set),e._responseCallbackSet.add(t)},removeOnRequestHook=(e,t)=>{e._requestCallbackSet&&(e._requestCallbackSet.delete(t),e._requestCallbackSet.size||delete e._requestCallbackSet)},removeOnResponseHook=(e,t)=>{e._responseCallbackSet&&(e._responseCallbackSet.delete(t),e._responseCallbackSet.size||delete e._responseCallbackSet)};Vhs.supportsNativeHls=function(){if(!document$2||!document$2.createElement)return!1;const e=document$2.createElement("video");if(!videojs.getTech("Html5").isSupported())return!1;return["application/vnd.apple.mpegurl","audio/mpegurl","audio/x-mpegurl","application/x-mpegurl","video/x-mpegurl","video/mpegurl","application/mpegurl"].some((function(t){return/maybe|probably/i.test(e.canPlayType(t))}))}(),Vhs.supportsNativeDash=!!(document$2&&document$2.createElement&&videojs.getTech("Html5").isSupported())&&/maybe|probably/i.test(document$2.createElement("video").canPlayType("application/dash+xml")),Vhs.supportsTypeNatively=e=>"hls"===e?Vhs.supportsNativeHls:"dash"===e&&Vhs.supportsNativeDash,Vhs.isSupported=function(){return videojs.log.warn("VHS is no longer a tech. Please remove it from your player's techOrder.")},Vhs.xhr.onRequest=function(e){addOnRequestHook(Vhs.xhr,e)},Vhs.xhr.onResponse=function(e){addOnResponseHook(Vhs.xhr,e)},Vhs.xhr.offRequest=function(e){removeOnRequestHook(Vhs.xhr,e)},Vhs.xhr.offResponse=function(e){removeOnResponseHook(Vhs.xhr,e)};const Component=videojs.getComponent("Component");class VhsHandler extends Component{constructor(e,t,n){if(super(t,n.vhs),"number"==typeof n.initialBandwidth&&(this.options_.bandwidth=n.initialBandwidth),this.logger_=logger("VhsHandler"),t.options_&&t.options_.playerId){const e=videojs.getPlayer(t.options_.playerId);this.player_=e}if(this.tech_=t,this.source_=e,this.stats={},this.ignoreNextSeekingEvent_=!1,this.setOptions_(),this.options_.overrideNative&&t.overrideNativeAudioTracks&&t.overrideNativeVideoTracks)t.overrideNativeAudioTracks(!0),t.overrideNativeVideoTracks(!0);else if(this.options_.overrideNative&&(t.featuresNativeVideoTracks||t.featuresNativeAudioTracks))throw new Error("Overriding native VHS requires emulated tracks. See https://git.io/vMpjB");this.on(document$2,["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],(e=>{const t=document$2.fullscreenElement||document$2.webkitFullscreenElement||document$2.mozFullScreenElement||document$2.msFullscreenElement;t&&t.contains(this.tech_.el())?this.playlistController_.fastQualityChange_():this.playlistController_.checkABR_()})),this.on(this.tech_,"seeking",(function(){this.ignoreNextSeekingEvent_?this.ignoreNextSeekingEvent_=!1:this.setCurrentTime(this.tech_.currentTime())})),this.on(this.tech_,"error",(function(){this.tech_.error()&&this.playlistController_&&this.playlistController_.pauseLoading()})),this.on(this.tech_,"play",this.play)}setOptions_(e={}){if(this.options_=merge(this.options_,e),this.options_.withCredentials=this.options_.withCredentials||!1,this.options_.limitRenditionByPlayerDimensions=!1!==this.options_.limitRenditionByPlayerDimensions,this.options_.useDevicePixelRatio=this.options_.useDevicePixelRatio||!1,this.options_.useBandwidthFromLocalStorage=void 0!==this.source_.useBandwidthFromLocalStorage?this.source_.useBandwidthFromLocalStorage:this.options_.useBandwidthFromLocalStorage||!1,this.options_.useForcedSubtitles=this.options_.useForcedSubtitles||!1,this.options_.useNetworkInformationApi=this.options_.useNetworkInformationApi||!1,this.options_.useDtsForTimestampOffset=this.options_.useDtsForTimestampOffset||!1,this.options_.customTagParsers=this.options_.customTagParsers||[],this.options_.customTagMappers=this.options_.customTagMappers||[],this.options_.cacheEncryptionKeys=this.options_.cacheEncryptionKeys||!1,this.options_.llhls=!1!==this.options_.llhls,this.options_.bufferBasedABR=this.options_.bufferBasedABR||!1,"number"!=typeof this.options_.playlistExclusionDuration&&(this.options_.playlistExclusionDuration=60),"number"!=typeof this.options_.bandwidth&&this.options_.useBandwidthFromLocalStorage){const e=getVhsLocalStorage();e&&e.bandwidth&&(this.options_.bandwidth=e.bandwidth,this.tech_.trigger({type:"usage",name:"vhs-bandwidth-from-local-storage"})),e&&e.throughput&&(this.options_.throughput=e.throughput,this.tech_.trigger({type:"usage",name:"vhs-throughput-from-local-storage"}))}"number"!=typeof this.options_.bandwidth&&(this.options_.bandwidth=Config.INITIAL_BANDWIDTH),this.options_.enableLowInitialPlaylist=this.options_.enableLowInitialPlaylist&&this.options_.bandwidth===Config.INITIAL_BANDWIDTH,["withCredentials","useDevicePixelRatio","limitRenditionByPlayerDimensions","bandwidth","customTagParsers","customTagMappers","cacheEncryptionKeys","playlistSelector","initialPlaylistSelector","bufferBasedABR","liveRangeSafeTimeDelta","llhls","useForcedSubtitles","useNetworkInformationApi","useDtsForTimestampOffset","exactManifestTimings","leastPixelDiffSelector"].forEach((e=>{void 0!==this.source_[e]&&(this.options_[e]=this.source_[e])})),this.limitRenditionByPlayerDimensions=this.options_.limitRenditionByPlayerDimensions,this.useDevicePixelRatio=this.options_.useDevicePixelRatio}setOptions(e={}){this.setOptions_(e)}src(e,t){if(!e)return;this.setOptions_(),this.options_.src=expandDataUri(this.source_.src),this.options_.tech=this.tech_,this.options_.externVhs=Vhs,this.options_.sourceType=simpleTypeFromSourceType(t),this.options_.seekTo=e=>{this.tech_.setCurrentTime(e)},this.playlistController_=new PlaylistController(this.options_);const n=merge({liveRangeSafeTimeDelta:SAFE_TIME_DELTA},this.options_,{seekable:()=>this.seekable(),media:()=>this.playlistController_.media(),playlistController:this.playlistController_});this.playbackWatcher_=new PlaybackWatcher(n),this.playlistController_.on("error",(()=>{const e=videojs.players[this.tech_.options_.playerId];let t=this.playlistController_.error;"object"!=typeof t||t.code?"string"==typeof t&&(t={message:t,code:3}):t.code=3,e.error(t)}));const r=this.options_.bufferBasedABR?Vhs.movingAverageBandwidthSelector(.55):Vhs.STANDARD_PLAYLIST_SELECTOR;this.playlistController_.selectPlaylist=this.selectPlaylist?this.selectPlaylist.bind(this):r.bind(this),this.playlistController_.selectInitialPlaylist=Vhs.INITIAL_PLAYLIST_SELECTOR.bind(this),this.playlists=this.playlistController_.mainPlaylistLoader_,this.mediaSource=this.playlistController_.mediaSource,Object.defineProperties(this,{selectPlaylist:{get(){return this.playlistController_.selectPlaylist},set(e){this.playlistController_.selectPlaylist=e.bind(this)}},throughput:{get(){return this.playlistController_.mainSegmentLoader_.throughput.rate},set(e){this.playlistController_.mainSegmentLoader_.throughput.rate=e,this.playlistController_.mainSegmentLoader_.throughput.count=1}},bandwidth:{get(){let e=this.playlistController_.mainSegmentLoader_.bandwidth;const t=window$1$1.navigator.connection||window$1$1.navigator.mozConnection||window$1$1.navigator.webkitConnection,n=1e7;if(this.options_.useNetworkInformationApi&&t){const r=1e3*t.downlink*1e3;e=r>=n&&e>=n?Math.max(e,r):r}return e},set(e){this.playlistController_.mainSegmentLoader_.bandwidth=e,this.playlistController_.mainSegmentLoader_.throughput={rate:0,count:0}}},systemBandwidth:{get(){const e=1/(this.bandwidth||1);let t;t=this.throughput>0?1/this.throughput:0;return Math.floor(1/(e+t))},set(){videojs.log.error('The "systemBandwidth" property is read-only')}}}),this.options_.bandwidth&&(this.bandwidth=this.options_.bandwidth),this.options_.throughput&&(this.throughput=this.options_.throughput),Object.defineProperties(this.stats,{bandwidth:{get:()=>this.bandwidth||0,enumerable:!0},mediaRequests:{get:()=>this.playlistController_.mediaRequests_()||0,enumerable:!0},mediaRequestsAborted:{get:()=>this.playlistController_.mediaRequestsAborted_()||0,enumerable:!0},mediaRequestsTimedout:{get:()=>this.playlistController_.mediaRequestsTimedout_()||0,enumerable:!0},mediaRequestsErrored:{get:()=>this.playlistController_.mediaRequestsErrored_()||0,enumerable:!0},mediaTransferDuration:{get:()=>this.playlistController_.mediaTransferDuration_()||0,enumerable:!0},mediaBytesTransferred:{get:()=>this.playlistController_.mediaBytesTransferred_()||0,enumerable:!0},mediaSecondsLoaded:{get:()=>this.playlistController_.mediaSecondsLoaded_()||0,enumerable:!0},mediaAppends:{get:()=>this.playlistController_.mediaAppends_()||0,enumerable:!0},mainAppendsToLoadedData:{get:()=>this.playlistController_.mainAppendsToLoadedData_()||0,enumerable:!0},audioAppendsToLoadedData:{get:()=>this.playlistController_.audioAppendsToLoadedData_()||0,enumerable:!0},appendsToLoadedData:{get:()=>this.playlistController_.appendsToLoadedData_()||0,enumerable:!0},timeToLoadedData:{get:()=>this.playlistController_.timeToLoadedData_()||0,enumerable:!0},buffered:{get:()=>timeRangesToArray(this.tech_.buffered()),enumerable:!0},currentTime:{get:()=>this.tech_.currentTime(),enumerable:!0},currentSource:{get:()=>this.tech_.currentSource_,enumerable:!0},currentTech:{get:()=>this.tech_.name_,enumerable:!0},duration:{get:()=>this.tech_.duration(),enumerable:!0},main:{get:()=>this.playlists.main,enumerable:!0},playerDimensions:{get:()=>this.tech_.currentDimensions(),enumerable:!0},seekable:{get:()=>timeRangesToArray(this.tech_.seekable()),enumerable:!0},timestamp:{get:()=>Date.now(),enumerable:!0},videoPlaybackQuality:{get:()=>this.tech_.getVideoPlaybackQuality(),enumerable:!0}}),this.tech_.one("canplay",this.playlistController_.setupFirstPlay.bind(this.playlistController_)),this.tech_.on("bandwidthupdate",(()=>{this.options_.useBandwidthFromLocalStorage&&updateVhsLocalStorage({bandwidth:this.bandwidth,throughput:Math.round(this.throughput)})})),this.playlistController_.on("selectedinitialmedia",(()=>{renditionSelectionMixin(this)})),this.playlistController_.sourceUpdater_.on("createdsourcebuffers",(()=>{this.setupEme_()})),this.on(this.playlistController_,"progress",(function(){this.tech_.trigger("progress")})),this.on(this.playlistController_,"firstplay",(function(){this.ignoreNextSeekingEvent_=!0})),this.setupQualityLevels_(),this.tech_.el()&&(this.mediaSourceUrl_=window$1$1.URL.createObjectURL(this.playlistController_.mediaSource),this.tech_.src(this.mediaSourceUrl_))}createKeySessions_(){const e=this.playlistController_.mediaTypes_.AUDIO.activePlaylistLoader;this.logger_("waiting for EME key session creation"),waitForKeySessionCreation({player:this.player_,sourceKeySystems:this.source_.keySystems,audioMedia:e&&e.media(),mainPlaylists:this.playlists.main.playlists}).then((()=>{this.logger_("created EME key session"),this.playlistController_.sourceUpdater_.initializedEme()})).catch((e=>{this.logger_("error while creating EME key session",e),this.player_.error({message:"Failed to initialize media keys for EME",code:3})}))}handleWaitingForKey_(){this.logger_("waitingforkey fired, attempting to create any new key sessions"),this.createKeySessions_()}setupEme_(){const e=this.playlistController_.mediaTypes_.AUDIO.activePlaylistLoader,t=setupEmeOptions({player:this.player_,sourceKeySystems:this.source_.keySystems,media:this.playlists.media(),audioMedia:e&&e.media()});this.player_.tech_.on("keystatuschange",(e=>{this.playlistController_.updatePlaylistByKeyStatus(e.keyId,e.status)})),this.handleWaitingForKey_=this.handleWaitingForKey_.bind(this),this.player_.tech_.on("waitingforkey",this.handleWaitingForKey_),t?this.createKeySessions_():this.playlistController_.sourceUpdater_.initializedEme()}setupQualityLevels_(){const e=videojs.players[this.tech_.options_.playerId];e&&e.qualityLevels&&!this.qualityLevels_&&(this.qualityLevels_=e.qualityLevels(),this.playlistController_.on("selectedinitialmedia",(()=>{handleVhsLoadedMetadata(this.qualityLevels_,this)})),this.playlists.on("mediachange",(()=>{handleVhsMediaChange(this.qualityLevels_,this.playlists)})))}static version(){return{"@videojs/http-streaming":version$4,"mux.js":version$3,"mpd-parser":version$2,"m3u8-parser":version$1,"aes-decrypter":version}}version(){return this.constructor.version()}canChangeType(){return SourceUpdater.canChangeType()}play(){this.playlistController_.play()}setCurrentTime(e){this.playlistController_.setCurrentTime(e)}duration(){return this.playlistController_.duration()}seekable(){return this.playlistController_.seekable()}dispose(){this.playbackWatcher_&&this.playbackWatcher_.dispose(),this.playlistController_&&this.playlistController_.dispose(),this.qualityLevels_&&this.qualityLevels_.dispose(),this.tech_&&this.tech_.vhs&&delete this.tech_.vhs,this.mediaSourceUrl_&&window$1$1.URL.revokeObjectURL&&(window$1$1.URL.revokeObjectURL(this.mediaSourceUrl_),this.mediaSourceUrl_=null),this.tech_&&this.tech_.off("waitingforkey",this.handleWaitingForKey_),super.dispose()}convertToProgramTime(e,t){return getProgramTime({playlist:this.playlistController_.media(),time:e,callback:t})}seekToProgramTime(e,t,n=!0,r=2){return seekToProgramTime({programTime:e,playlist:this.playlistController_.media(),retryCount:r,pauseAfterSeek:n,seekTo:this.options_.seekTo,tech:this.options_.tech,callback:t})}setupXhrHooks_(){this.xhr.onRequest=e=>{addOnRequestHook(this.xhr,e)},this.xhr.onResponse=e=>{addOnResponseHook(this.xhr,e)},this.xhr.offRequest=e=>{removeOnRequestHook(this.xhr,e)},this.xhr.offResponse=e=>{removeOnResponseHook(this.xhr,e)},this.player_.trigger("xhr-hooks-ready")}}const VhsSourceHandler={name:"videojs-http-streaming",VERSION:version$4,canHandleSource(e,t={}){const n=merge(videojs.options,t);return VhsSourceHandler.canPlayType(e.type,n)},handleSource(e,t,n={}){const r=merge(videojs.options,n);return t.vhs=new VhsHandler(e,t,r),t.vhs.xhr=xhrFactory(),t.vhs.setupXhrHooks_(),t.vhs.src(e.src,e.type),t.vhs},canPlayType(e,t){const n=simpleTypeFromSourceType(e);if(!n)return"";const r=VhsSourceHandler.getOverrideNative(t);return!Vhs.supportsTypeNatively(n)||r?"maybe":""},getOverrideNative(e={}){const{vhs:t={}}=e,n=!(videojs.browser.IS_ANY_SAFARI||videojs.browser.IS_IOS),{overrideNative:r=n}=t;return r}},supportsNativeMediaSources=()=>browserSupportsCodec("avc1.4d400d,mp4a.40.2");supportsNativeMediaSources()&&videojs.getTech("Html5").registerSourceHandler(VhsSourceHandler,0),videojs.VhsHandler=VhsHandler,videojs.VhsSourceHandler=VhsSourceHandler,videojs.Vhs=Vhs,videojs.use||videojs.registerComponent("Vhs",Vhs),videojs.options.vhs=videojs.options.vhs||{},videojs.getPlugin&&videojs.getPlugin("reloadSourceOnError")||videojs.registerPlugin("reloadSourceOnError",reloadSourceOnError);let defaultIndex=0;const orcLabels=["frontside","backside"],livenessLabels=["selfie"];function initFilesAndTabBtns(){const e=document.getElementById("fci-result-files");if(!e)return;const{ocrFiles:t,livenessFiles:n}=window.ekyc.resultStore,r=[...t.map((t=>{const n=document.createElement("img");n.classList.add("fci-result-file-item"),n.src=URL.createObjectURL(t);const r=createFileWrapper();return r.appendChild(n),e.appendChild(r),r})),...n.map((t=>{const n=document.createElement("video"),r=createFileWrapper();return n.muted=!0,n.setAttribute("muted","true"),n.setAttribute("controls","true"),n.setAttribute("controlsList","nodownload noplaybackrate"),n.setAttribute("disablePictureInPicture","true"),n.setAttribute("autoplay","false"),n.setAttribute("preload","auto"),n.setAttribute("data-setup","{}"),n.classList.add("fci-result-file-item","video-js"),n.src=URL.createObjectURL(t),r.appendChild(n),videojs(n,{controlBar:{pictureInPictureToggle:!1,volumePanel:!1,fullscreenToggle:!1}},(function(){this.play()})),e.appendChild(r),r}))];r.forEach(((e,t)=>{t===defaultIndex&&Utils.jq(e).addClass("fci-result-file-wrapper-active")}));const a=document.getElementById("fci-result-tabs");if(!a)return;[...t.map(((e,t)=>{const n=document.createElement("button");return n.classList.add("fci-result-tab-btn"),n.innerText=i18n(orcLabels[t]),a.appendChild(n),n})),...n.map(((e,t)=>{const n=document.createElement("button");return n.classList.add("fci-result-tab-btn"),n.innerText=i18n(livenessLabels[t]),a.appendChild(n),n}))].forEach(((e,t,n)=>{t===defaultIndex&&Utils.jq(e).addClass("fci-result-tab-btn-active"),e.onclick=()=>{n.forEach((e=>Utils.jq(e).removeClass("fci-result-tab-btn-active"))),Utils.jq(e).addClass("fci-result-tab-btn-active"),r.forEach(((e,n)=>{t===n?Utils.jq(e).addClass("fci-result-file-wrapper-active"):Utils.jq(e).removeClass("fci-result-file-wrapper-active")}))}}))}function createFileWrapper(){const e=document.createElement("div");return e.classList.add("fci-result-file-wrapper"),e}function initLivenessTable(){var e,t,n;const r=document.getElementById("fci-result-table-liveness");if(!r)return;const{livenessResult:a}=window.ekyc.resultStore,i=[{key:"liveness",value:"200"===(null==(e=null==a?void 0:a.liveness)?void 0:e.code)},{key:"facematch",value:"200"===(null==(t=null==a?void 0:a.face_match)?void 0:t.code)},{key:"similarity",value:`${(null==(n=null==a?void 0:a.face_match)?void 0:n.similarity)||"-"}%`}],s=document.createElement("table");i.forEach((e=>{const t=document.createElement("tr"),n=document.createElement("td");n.innerText=i18n(e.key);const r=document.createElement("td");r.innerText=e.value?handleParseString(`${e.value}`):"-",t.appendChild(n),t.appendChild(r),s.appendChild(t)})),r.appendChild(s)}function handleParseString(e){return e}function initOcrHeader(){const e=document.getElementById("fci-result-table-ocr-header");if(!e)return;e.innerText=i18n("ocrInformation");const{ocrResult:t}=window.ekyc.resultStore;Object.entries(t).length?e.style.display="flex":e.style.display="none"}function initOcrTable(){const e=document.getElementById("fci-result-table-ocr");if(!e)return;const{ocrResult:t}=window.ekyc.resultStore,n=document.createElement("table");Object.entries(t).forEach((([e,t])=>{const r=document.createElement("tr"),a=document.createElement("td"),i=document.createElement("span");i.innerText=i18n(e);const s=document.createElement("span");s.innerText=t?handleParseString(`${t}`):"-",a.appendChild(i),a.appendChild(s),r.appendChild(a),n.appendChild(r)})),e.appendChild(n)}function initFinishBtn(){const e=document.getElementById("fci-result-action-btn");e&&(e.innerText=i18n("continueTxt"),e.onclick=async()=>{await window.ekyc.dispose(),window.ekyc.moveToStep(0),handleChangeLayout()})}function initResult(){initFilesAndTabBtns(),initLivenessTable(),initOcrHeader(),initOcrTable(),initFinishBtn()}function resultHtml(){return'\n    <div id="fci-result-container">\n        <div id="fci-result-files"></div>\n        <div id="fci-result-tabs"></div>\n        <div id="fci-result-table-container">\n            <div id="fci-result-table-liveness"></div>\n            <div id="fci-result-table-ocr-header"></div>\n            <div id="fci-result-table-ocr"></div>\n            <div id="fci-result-action-btn-container">\n                <button id="fci-result-action-btn"\n                    class="fci-btn fci-btn-primary fci-btn-rounded"></button>\n            </div>\n        </div>\n    </div>'}function loadResult(e){Utils.load(e,resultHtml(),initResult)}const documentTypeDefine=[{type:"idr",label:"idCard",textKey:"id_result_title",icon:'\n            <svg width="30" height="30" viewBox="0 0 30 30" xmlns="http://www.w3.org/2000/svg">\n                <path d="M0 3.32515C0 1.48872 1.4877 0 3.32515 0H26.6748C28.5113 0 30 1.4877 30 3.32515V26.6748C30 28.5113 28.5123 30 26.6748 30H3.32515C1.48872 30 0 28.5123 0 26.6748V3.32515ZM5.59478 25H24.7458C22.6375 21.9775 19.1348 20 15.1703 20C11.2057 20 7.70303 21.9775 5.59478 25ZM15 16.6667C18.2217 16.6667 20.8333 14.055 20.8333 10.8333C20.8333 7.61167 18.2217 5 15 5C11.7783 5 9.16667 7.61167 9.16667 10.8333C9.16667 14.055 11.7783 16.6667 15 16.6667Z" fill="currentColor"/>\n            </svg>\n        '},{type:"dlr",label:"driverLicense",textKey:"driver_license_result_title",icon:'\n            <svg width="34" height="31" viewBox="0 0 34 31" xmlns="http://www.w3.org/2000/svg">\n                <path d="M28.6666 27.3333H5.33331V29C5.33331 29.9205 4.58711 30.6666 3.66665 30.6666H1.99998C1.07951 30.6666 0.333313 29.9205 0.333313 29V14L4.52221 2.82954C5.0101 1.52854 6.25383 0.666626 7.64331 0.666626H26.3566C27.7461 0.666626 28.9898 1.52854 29.4778 2.82954L33.6666 14V29C33.6666 29.9205 32.9205 30.6666 32 30.6666H30.3333C29.4128 30.6666 28.6666 29.9205 28.6666 29V27.3333ZM3.89331 14H30.1066L26.3566 3.99996H7.64331L3.89331 14ZM7.83331 22.3333C9.21403 22.3333 10.3333 21.214 10.3333 19.8333C10.3333 18.4526 9.21403 17.3333 7.83331 17.3333C6.4526 17.3333 5.33331 18.4526 5.33331 19.8333C5.33331 21.214 6.4526 22.3333 7.83331 22.3333ZM26.1666 22.3333C27.5473 22.3333 28.6666 21.214 28.6666 19.8333C28.6666 18.4526 27.5473 17.3333 26.1666 17.3333C24.786 17.3333 23.6666 18.4526 23.6666 19.8333C23.6666 21.214 24.786 22.3333 26.1666 22.3333Z" fill="currentColor"/>\n            </svg>\n        '},{type:"passport",label:"passport",textKey:"passport_result_title",icon:'\n            <svg width="30" height="34" viewBox="0 0 30 34" xmlns="http://www.w3.org/2000/svg">\n                <path d="M28.3333 0.333374C29.2538 0.333374 30 1.07957 30 2.00004V32C30 32.9205 29.2538 33.6667 28.3333 33.6667H1.66667C0.7462 33.6667 0 32.9205 0 32V2.00004C0 1.07957 0.7462 0.333374 1.66667 0.333374H28.3333ZM21.6667 23.6667H8.33333V27H21.6667V23.6667ZM15 7.00004C11.3181 7.00004 8.33333 9.98481 8.33333 13.6667C8.33333 17.3485 11.3181 20.3334 15 20.3334C18.6818 20.3334 21.6667 17.3485 21.6667 13.6667C21.6667 9.98481 18.6818 7.00004 15 7.00004ZM15 10.3334C16.841 10.3334 18.3333 11.8258 18.3333 13.6667C18.3333 15.5077 16.841 17 15 17C13.159 17 11.6667 15.5077 11.6667 13.6667C11.6667 11.8258 13.159 10.3334 15 10.3334Z" fill="currentColor"/>\n            </svg>\n        '}];function initDocsTitle(){const e=document.getElementById("fci-docs-title");e&&(e.innerText=window.ekyc.getText("please_choose_kyc")??i18n("pleaseSelectTypeOfEkyc"))}function onSelectDocumentType(e){window.ekyc.config.document_type=e,window.ekyc.onChangeNextStep(),handleChangeLayout()}function initSelectEkycDocs(){const e=document.getElementById("fci-docs-cards");if(!e)return;const t=window.ekyc.config.model_language;let n=[];!t||["vn","idn"].includes(t)?n=documentTypeDefine:"fil"===t&&(n=documentTypeDefine.filter((e=>"idr"!==e.type))),n.filter((e=>window.ekyc.config.selectable_documents.includes(e.type))).forEach((t=>{const n=document.createElement("div");n.classList.add("fci-docs-card"),n.innerHTML=`\n            ${t.icon}\n            <span>${window.ekyc.getText(t.textKey)??i18n(t.label)}</span>\n        `,n.onclick=()=>onSelectDocumentType(t.type),e.appendChild(n)}))}function initSelectEkyc(){initDocsTitle(),initSelectEkycDocs()}function selectEkycHtml(){return`\n        <div class="fci-select-ekyc-container">\n            <div class="fci-docs-wrapper">\n                <div id="fci-docs-title"></div>\n                <div id="fci-docs-cards"></div>\n            </div>\n            <div class="fci-docs-version">\n                ${i18n("version")} ${window.ekyc.version}\n            </div>\n        </div>\n    `}function loadSelectEkyc(e){Utils.load(e,selectEkycHtml(),initSelectEkyc)}function handleChangeLayout(){const e=document.getElementById("fci-layout-outlet");if(e)switch(![0,1,4].includes(window.ekyc.stepIndex)&&window.ekyc.config_setting.show_action_step?(setVisActionStep(!0),initActionStep()):setVisActionStep(!1),window.ekyc.stepIndex){case 1:loadAnimationGuide(e);break;case 2:loadOcr(e);break;case 3:loadPreviewImages(e);break;case 4:loadAnimationLiveness(e);break;case 5:loadLiveness(e);break;case 6:loadLivenessError(e);break;case 7:loadResult(e);break;default:loadSelectEkyc(e)}}function initActionStep(){const e=document.getElementById("fci-action-step-container");e&&loadActionStep(e)}function setLayoutLoading(e){const t=document.getElementById("fci-layout-loading");t&&(e?(t.style.inset="0",loadLoading(t)):(t.style.inset="unset",t.innerHTML=""))}function initLayout(){handleChangeLayout()}function layoutHtml(){return'\n        <div id="fci-layout-content"\n            class="fci-layout-content fci-scroll-custom">\n            <div id="fci-layout-loading"></div>\n            <div class="fci-layout-wrapper">\n                <div id="fci-action-step-container"></div>\n                <div class="fci-layout-outlet-container">\n                    <div id="fci-layout-outlet"></div>\n                </div>\n            </div>\n        </div>\n    '}function loadLayout(e){Utils.load(e,layoutHtml(),initLayout)}class FciEkycBase{constructor(){var e,t,n,r;__publicField(this,"_container",document.createElement("div")),__publicField(this,"_deviceType","web-sdk"),__publicField(this,"_sdkVersion","4.0.6"),__publicField(this,"config",{endpoint_init_session:{url:"",headers:{}},endpoint_ocr:{url:"",headers:{}},endpoint_liveness:{url:"",headers:{}},client_id:"",model_language:"vn",document_type:void 0,lang:"vi",selectable_documents:["idr","passport","dlr"],liveness_session_id:void 0,on_result:()=>null,upload_type:"capture",parent_element:null,asset_base_path:window.origin}),__publicField(this,"_assets_config",{}),__publicField(this,"config_setting"),__publicField(this,"_theme",{color:{fci_main_color:"#005bd2",fci_doc_version:"#636079",fci_doc_title_color:"#000000",fci_suggestion_color:"#616161",fci_bg_front_color:"#ff9800",fci_doc_front_color:"#FFFFFF",fci_nfc_title_color:"#636079",fci_nfc_message_color:"#393552",fci_nfc_cancel_color:"#76767c",fci_nfc_bg_cancel_color:"#F3F1FE",fci_live_guide_color:"#ffffff",fci_live_bg_guide_color:"#FF9800",fci_live_err_title_color:"#000000",fci_live_err_message_color:"#d84647",fci_live_err_content_color:"#d84647",fci_live_err_bg_content_color:"#ffebee"},text:{en:{please_choose_kyc:"Please select type of eKYC",id_result_title:"Identity card",passport_result_title:"Passport",driver_license_result_title:"Driver's license",kyc_video_title:"Record video of face",kyc_video_suggestion1:"Please keep your face in the recording area",kyc_account_verification_title:"Verify account",kyc_ready_to_scan:"Ready to scan",kyc_nfc_title:"Put your phone over the document",let_s_try_again:"Let's try that again",kyc_no_success:"Ekyc failed",kyc_try_again:"Try again"},vi:{please_choose_kyc:"Vui lòng chọn loại eKYC",id_result_title:"Thẻ căn cước công dân",passport_result_title:"Hộ chiếu",driver_license_result_title:"Giấy phép lái xe",kyc_video_title:"Quay video khuôn mặt",kyc_video_suggestion1:"Xin hãy giữ khuôn mặt nằm trong vùng quay",kyc_account_verification_title:"Xác thực tài khoản",kyc_ready_to_scan:"Sẵn sàng để quét",kyc_nfc_title:"Đặt điện thoại của bạn lên trên chip phía sau CCCD",let_s_try_again:"Hãy Thử Lại",kyc_no_success:"Ekyc thất bại",kyc_try_again:"Thử Lại"}}}),__publicField(this,"_sessionId"),__publicField(this,"_axiosInstance"),__publicField(this,"stepIndex",0),__publicField(this,"version",this._sdkVersion),__publicField(this,"resultStore",{ocrFiles:[],ocrResult:{},livenessFiles:[],livenessResult:null}),this._setRootColor(),this._axiosInstance=axios$1.create(),this._axiosInstance.interceptors.response.use((e=>e.data),(e=>{var t,n;return 403===(null==(t=null==e?void 0:e.response)?void 0:t.status)&&(console.log(e),alert((null==(n=null==e?void 0:e.response)?void 0:n.data.errorMessage)??"Phiên làm việc đã hết hạn"),this.dispose()),Promise.reject(e)})),navigator.mediaDevices&&(navigator.mediaDevices.getUserMedia=(null==(e=navigator.mediaDevices)?void 0:e.getUserMedia)||(null==(t=navigator.mediaDevices)?void 0:t.webkitGetUserMedia)||(null==(n=navigator.mediaDevices)?void 0:n.mozGetUserMedia)||(null==(r=navigator.mediaDevices)?void 0:r.msGetUserMedia)),this._container.classList.add("fci-layout-container"),this._handleSetAssetConfig()}_handleSetAssetConfig(){this._assets_config={animation_liveness_path:`${this.config.asset_base_path}/fci-assets/animations/animation_liveness.json`,animation_ocr_guide_path:`${this.config.asset_base_path}/fci-assets/animations/animation_ocr_guide.json`,animation_switch_path:`${this.config.asset_base_path}/fci-assets/animations/animation_switch.json`,ocr_model_path:`${this.config.asset_base_path}/fci-assets/models/object-detection/model.json`,image_background_path:`${this.config.asset_base_path}/fci-assets/images/background.png`,invalid_image_blur:`${this.config.asset_base_path}/fci-assets/images/invalid_image_blur.png`,invalid_image_missing_details:`${this.config.asset_base_path}/fci-assets/images/invalid_image_blur.png`,invalid_image_size:`${this.config.asset_base_path}/fci-assets/images/invalid_image_size.png`,facemesh_base_url:`${this.config.asset_base_path}/fci-assets/facemesh-solutions`,faceapi_base_url:`${this.config.asset_base_path}/fci-assets/models/face`}}moveToStep(e){this.stepIndex!==e&&(this.stepIndex=e)}onChangeNextStep(){this.stepIndex++}async _getSessionId(){return this._axiosInstance.request({url:`${this.config.endpoint_init_session.url}`,method:"POST",headers:{"device-type":this._deviceType,"sdk-version":this._sdkVersion,client_uuid:this.config.client_id,step:"init",...this.config.endpoint_init_session.headers??{}}})}async _initSessionId(){return this._getSessionId().then((e=>{this.config_setting=e.sdk_config,this._sessionId=e["session-id"]}))}async ocr(){const e=new FormData;return this.resultStore.ocrFiles.forEach((t=>{t&&e.append("files",t)})),this._axiosInstance.request({url:`${this.config.endpoint_ocr.url}`,method:"POST",data:e,headers:{"session-id":this._sessionId,"document-type":this.config.document_type,"device-type":this._deviceType,"sdk-version":this._sdkVersion,lang:this.config.lang,..."vn"===this.config.model_language?{}:{country:this.config.model_language},step:"ocr",...this.config.endpoint_ocr.headers??{}}})}async liveness(){const e=new FormData,t=this.resultStore.ocrFiles[0];t&&e.append("cmnd",t);const n=this.resultStore.livenessFiles[0];return n&&e.append("video",n),this._axiosInstance.request({url:`${this.config.endpoint_liveness.url}`,method:"POST",data:e,headers:{"session-id":this.config.liveness_session_id??this._sessionId,"device-type":this._deviceType,"sdk-version":this._sdkVersion,lang:this.config.lang,step:"liveness",...this.config.endpoint_liveness.headers??{}}})}_getResult(){return{ocrResult:this.resultStore.ocrResult,livenessResult:lodashExports.pick(this.resultStore.livenessResult,"face_match","liveness")}}handleCallback(){this.config.on_result&&"function"==typeof this.config.on_result&&this.config.on_result(this._getResult())}setTheme(e){const t=Object.entries(e).reduce(((e,[t,n])=>t in this._theme?{...e,[t]:n}:e),{});this._theme={...this._theme,...t},this._setRootColor()}_setRootColor(){Object.entries(this._theme.color).filter((([e,t])=>e.toLowerCase().includes("fci")&&e.toLowerCase().includes("color"))).forEach((([e,t])=>{const n=e.replace(/_/g,"-");document.documentElement.style.setProperty(`--${n}`,t)}))}getText(e){return this._theme.text[this.config.lang??"vi"][e]??e}_appendToContainer(){if(this.config.parent_element&&this.config.parent_element instanceof HTMLElement)this.config.parent_element.appendChild(this._container);else{const e=document.createElement("div");e.classList.add("fci-layout-container"),e.appendChild(this._container),document.body.appendChild(e)}}async init(e){this.config={...this.config,...e??{}},this._handleSetAssetConfig(),this.config.document_type?this.stepIndex=1:this.stepIndex=0,this.config.liveness_session_id&&(this.stepIndex=4),this._initSessionId().then((e=>{loadLayout(this._container),this._appendToContainer()})).catch((e=>{alert((null==e?void 0:e.message)??i18n("livenessLimitExceeded")),this.dispose()}))}dispose(){return new Promise(((e,t)=>{this._container.remove(),setTimeout((()=>{window.ekyc=new FciEkycBase,e(!0)}),10)}))}}function startEkyc(){window.ekyc=new FciEkycBase}startEkyc()}});export default require_sdk();
